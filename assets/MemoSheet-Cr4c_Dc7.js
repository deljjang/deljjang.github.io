import{h as E,Q as W,db as J,j as e,ck as Y,bh as T,x as k,K as q,a4 as g,q as G,o as X,n as Z,r as w,u as ee,z as te,s as se,i as ae,cM as D,br as ie,bs as re,A as Q,E as P,I as f,J as oe,bU as ne,bq as le}from"./index-C4YqBfyH.js";import{T as de}from"./TwLoading-DYDg3GBe.js";import{C as ce}from"./ComponentCard-CMgFEYwe.js";import{M as ue,T as A,a as me}from"./MemoComm-FLDQsQsr.js";import"./angle-right-DDFJUMhB.js";import"./HomeChartSemiDonut-DyhkAJ-y.js";import"./Favorite-CKWHtYYm.js";import"./fireMemoDetail-CBw5M8Fx.js";import"./HtmlCode-CAIKiTUk.js";import"./copy-vX7JQ4Of.js";import"./TwRadio-CX5yOyPk.js";import"./TwBadge-Ba-cKA3k.js";import"./HtmlCode-DZ_vUkWc.js";import"./toPropertyKey-DCwh5dYN.js";import"./SinyImageList-D6Kpk5bI.js";import"./ImageListItem-DqEeqcER.js";import"./CodeText-fxppnBeK.js";/* empty css                   */import"./AniButton-D1VPJeHo.js";import"./Button-21xMxktQ.js";import"./SinySelect-6OH1SdzQ.js";import"./Grid-DhK8B7Yl.js";import"./index-DKD786KS.js";import"./TextField-8i6et4_V.js";import"./InputAdornment-BEr7FXs5.js";import"./Popper-Cj9xFct9.js";import"./Chip-CFilIkDJ.js";import"./Card-SoMB8hAw.js";import"./CardContent-tuk8ICTj.js";import"./TwCheckbox-ioVFSBdA.js";import"./TwTextArea-Affj9i8w.js";import"./IpInfo-CGoAjiTK.js";const pe=({isOpen:L,onClose:C,onCreate:a})=>{const c={visible:{opacity:1},hidden:{opacity:0}},S={hidden:{y:"-50px",opacity:0,scale:.95},visible:{y:"0",opacity:1,scale:1,transition:{duration:.2,ease:"easeOut"}},exit:{y:"50px",opacity:0,scale:.95,transition:{duration:.15,ease:"easeIn"}}},{t:i}=E(),{register:b,control:y,handleSubmit:j,formState:{errors:v}}=W({defaultValues:{title:"",columns:[{title:"col_0",type:"text",width:100,data:"col_0"},{title:"col_1",type:"text",width:100,data:"col_1"},{title:"col_2",type:"text",width:100,data:"col_2"}]}}),{fields:h,append:N,remove:_}=J({control:y,name:"columns"}),$=[{value:"text",label:i("column_type_text")},{value:"numeric",label:i("column_type_numeric")},{value:"date",label:i("column_type_date")},{value:"checkbox",label:i("column_type_checkbox")}],o=l=>{if(!l.title||l.title.trim()===""){alert(i("sheet_title_required"));return}const x={...l,columns:l.columns.map((n,M)=>n.data&&(n.data==="id"||n.data==="title"||n.data==="description")?n:{...n,data:(n.title||"").toLowerCase().replace(/\s+/g,"_")||`col_${M}`})};a(x)};return e.jsx(Y,{children:L&&e.jsx(T.div,{className:"fixed inset-0 bg-black/70 bg-opacity-50 z-180 flex justify-center items-center",variants:c,initial:"hidden",animate:"visible",exit:"hidden",children:e.jsx(T.div,{variants:S,initial:"hidden",animate:"visible",exit:"exit",onClick:l=>l.stopPropagation(),children:e.jsx(ue,{isDraggable:!0,className:"w-full max-w-sm sm:max-w-xl max-h-[61vh] overflow-y-auto",title:i("create_new_sheet"),children:e.jsxs("form",{onSubmit:j(o),children:[e.jsx("div",{className:"mb-4",children:e.jsx(A,{...b("title",{required:i("sheet_title_required")}),label:i("sheet_title"),placeholder:i("sheet_title_placeholder"),error:!!v.title,helperText:v.title?.message})}),e.jsx("h3",{className:"text-md font-semibold mb-2",children:i("columns")}),e.jsx("div",{className:"space-y-3",children:h.map((l,x)=>e.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-5 gap-2 items-center p-2 ${k.border} rounded-md`,children:[e.jsx("div",{className:"sm:col-span-2",children:e.jsx(q,{name:`columns.${x}.title`,control:y,defaultValue:l.title,render:({field:n})=>e.jsx(A,{...n,placeholder:i("column_title")})})}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(q,{name:`columns.${x}.type`,control:y,defaultValue:l.type,render:({field:n})=>e.jsx(me,{...n,options:$,className:"dark:bg-gray-700"})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(g,{type:"button",size:"sm",color:"warning",onClick:()=>_(x),disabled:h.length<=1,children:i("delete")})})]},l.id))}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(g,{type:"button",onClick:()=>N({title:"",type:"text",data:""}),children:i("add_column")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{type:"button",variant:"outlined",onClick:C,children:i("cancel")}),e.jsx(g,{type:"submit",children:i("create")})]})]})]})})})})})};function He({onDeleteTab:L}){const C=t=>{if(!t)return"";const s=new Date(t),r=s.getFullYear(),m=String(s.getMonth()+1).padStart(2,"0"),d=String(s.getDate()).padStart(2,"0"),p=String(s.getHours()).padStart(2,"0"),u=String(s.getMinutes()).padStart(2,"0");return`${r}-${m}-${d} ${p}:${u}`},{user:a}=G(),{t:c}=E(),S=X();Z().sheetId;const[i,b]=w.useState(!1),[y,j]=w.useState(null),[v,h]=w.useState(""),[N,_]=w.useState({isOpen:!1}),{isExpanded:$}=ee(),o=te();w.useEffect(()=>{se({title:c("appSheet"),description:c("appSheet")})},[]);const l=(t=!0)=>a?new Promise(s=>{const r=Q(P,`memo_sheet/${a.uid}`);le(r,m=>{const d=m.val(),p=d?Object.keys(d).map(u=>({id:u,...d[u]})):[];p.sort((u,U)=>(U.createdAt||0)-(u.createdAt||0)),s(p)},{onlyOnce:!0})}):Promise.resolve([]),{data:x,isLoading:n}=ae({queryKey:["sheets",a?.uid],queryFn:()=>l(),enabled:!!a}),M=D({mutationFn:async t=>{const s=`memo_sheet/${a.uid}`,r=ie(re(Q(P),s)).key,m={title:t.title,columns:t.columns,createdAt:Date.now()};await f(`${s}/${r}`,m);const d=`memo_sheet_data/${a.uid}/${r}/data`,p={id:0,createdAt:Date.now()};return t.columns.forEach(u=>{u.data!=="id"&&u.data!=="createdAt"&&(p[u.data]="")}),await f(`${d}/0`,p),p.id=1,await f(`${d}/1`,p),r},onSuccess:t=>{o.invalidateQueries({queryKey:["sheets",a?.uid]}),b(!1),S(`/m/sheet/${t}`)}}),I=D({mutationFn:t=>{const s=f(`memo_sheet/${a.uid}/${t}`,null),r=f(`memo_sheet_data/${a.uid}/${t}`,null);return Promise.all([s,r]).then(()=>t)},onMutate:async t=>{await o.cancelQueries({queryKey:["sheets",a?.uid]});const s=o.getQueryData(["sheets",a?.uid]);return o.setQueryData(["sheets",a?.uid],r=>r?.filter(m=>m.id!==t)),{previousSheets:s}},onError:(t,s,r)=>{o.setQueryData(["sheets",a?.uid],r.previousSheets)},onSettled:t=>{o.invalidateQueries({queryKey:["sheets",a?.uid]}),o.invalidateQueries({queryKey:["sheetData",t]})}}),F=D({mutationFn:({sheetId:t,title:s})=>f(`memo_sheet/${a.uid}/${t}/title`,s),onMutate:async({sheetId:t,title:s})=>{await o.cancelQueries({queryKey:["sheets",a?.uid]});const r=o.getQueryData(["sheets",a?.uid]);return o.setQueryData(["sheets",a?.uid],m=>m?.map(d=>d.id===t?{...d,title:s}:d)),j(null),h(""),{previousSheets:r}},onError:(t,s,r)=>{o.setQueryData(["sheets",a?.uid],r.previousSheets)},onSettled:()=>{o.invalidateQueries({queryKey:["sheets",a?.uid]})}}),O=t=>{S(`/m/sheet/${t}`)},K=async(t,s)=>{s.stopPropagation(),_({isOpen:!0,title:c("delete_confirm_title"),message:c("delete_confirm_message"),color:"warning",onConfirm:()=>{I.mutate(t),_({isOpen:!1})},onClose:()=>_({isOpen:!1})})},V=(t,s)=>{s.stopPropagation(),j(t.id),h(t.title)},z=t=>{t.stopPropagation(),j(null),h("")},B=async(t,s)=>{if(s.stopPropagation(),!v.trim()){alert(c("sheet_title_required"));return}F.mutate({sheetId:t,title:v})},R=$?"grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3":"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5";if(n||a===void 0)return e.jsx(de,{});const H=e.jsxs("div",{className:`${k.between}`,children:[e.jsx(oe,{className:"text-md",children:c("memo_sheet_list")}),e.jsx(g,{variant:"ghost",color:"sky",onClick:()=>b(!0),children:c("create_new_sheet")})]});return e.jsxs(ce,{title:H,className:"my-5",children:[e.jsx(ne,{...N}),e.jsx(pe,{isOpen:i,onClose:()=>b(!1),onCreate:t=>M.mutate(t)}),e.jsx("div",{className:`grid ${R} gap-4`,children:x?.map(t=>e.jsx("div",{onClick:()=>y!==t.id&&O(t.id),className:`relative p-4 ${k.border} ${k.roundedSm} cursor-pointer hover:bg-gray-100 dark:hover:border-sky-500 dark:hover:bg-indigo-900/50 group`,children:y===t.id?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"text",value:v,onChange:s=>h(s.target.value),onClick:s=>s.stopPropagation(),className:"border p-2 rounded-md dark:bg-gray-700",autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{size:"sm",variant:"outlined",onClick:z,children:c("cancel")}),e.jsx(g,{size:"sm",onClick:s=>B(t.id,s),children:c("save")})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex h-8",children:[" ",e.jsx("h6",{className:" font-semibold pr-16 transition-transform duration-200 ease-in-out group-hover:scale-105 transform-origin-left dark:group-hover:text-lg",children:t.title})]}),e.jsxs("div",{className:"flex justify-between items-baseline mt-2 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"text-xs ",children:C(t.createdAt)}),e.jsxs("p",{className:"text-sm ",children:["(",t.count,")"]})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:s=>V(t,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})}),e.jsx("button",{onClick:s=>K(t.id,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},t.id))})]})}export{He as default};
