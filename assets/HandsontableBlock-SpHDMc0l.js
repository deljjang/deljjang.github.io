import{j as E}from"./index-BQN1J123.js";import{h as T,aL as S,aM as Y,N as j,aN as H,aO as L,aP as I,O as w}from"./App-BDW7-lXS.js";import{r as y}from"./router-v4BRDFYV.js";import"./vendor-CCYiWZgt.js";L(I);w();const q=({id:n,rootDb:t,memoId:r,index:o,block:a,onUpdate:m,onUpdateBlock:s,afterSelection:D,readOnly:d,showSearch:g=!0})=>{const h=y.useRef(null);y.useRef(null);const C=y.useMemo(()=>a.content.data?.map(i=>Array.isArray(i)?[...i]:i)||[],[a.content.data]),M=async(i,p,N)=>{if(d)return;const x=h.current?.hotInstance;if(!x)return;const b=a.content.columns.map((f,e)=>({...f,width:x.getColWidth(e)}));s(n,{content:{...a.content,columns:b}})},k=async(i,p)=>{if(d||p==="loadData"||typeof i!="object"||!Array.isArray(i))return;try{if(i[0].length!==4||i[0][2]===i[0][3])return}catch{return}const N=h.current?.hotInstance;if(N){const b=N.getSourceData().map(f=>Array.isArray(f)?[...f]:f);b.forEach((f,e)=>{Array.isArray(f)&&f.forEach((c,l)=>{c===null&&(b[e][l]="")})}),s(n,{content:{...a.content,data:b}})}};return E.jsx(E.Fragment,{children:E.jsx(z,{hotRef:h,columns:a.content.columns,rowData:C,colorData:a.content.colorData,colorTextData:a.content.colorTextData,afterChange:k,afterSelection:D,handleAfterColumnResize:M,showSearch:g,readOnly:d,isDraggable:!1})})},z=({hotRef:n,columns:t,rowData:r,colorData:o,colorTextData:a,afterChange:m,afterSelection:s,handleAfterColumnResize:D,showSearch:d,readOnly:g=!0})=>{const{theme:h}=T(e=>({theme:e.theme.mode})),C=y.useRef(null),[M,k]=y.useState("");y.useEffect(()=>{const e=n.current?.hotInstance;if(!e||!r)return;let c=!1;try{o&&o.forEach((l,R)=>{l&&l.forEach((u,A)=>{const F=e.getCellMeta(R,A).backgroundColor,v=u||void 0;F!==v&&(e.setCellMeta(R,A,"backgroundColor",v),c=!0)})})}catch{}try{a&&a.forEach((l,R)=>{l&&l.forEach((u,A)=>{const F=e.getCellMeta(R,A).color,v=u||void 0;F!==v&&(e.setCellMeta(R,A,"color",v),c=!0)})})}catch{}c&&e.render()},[r,o,a,n]);const i=[],p=y.useMemo(()=>{if(!t)return;const e=[];return t.forEach((c,l)=>{c.select&&i.push({value:l,text:c.title,label:c.title}),e.push({...c,title:c.title})}),e},[t]),N=y.useMemo(()=>p&&p.map((e,c)=>{const{readOnly:l,...R}=e;let u={...R,theme:h,isFirstColumn:p.indexOf(e)===0,data:c,colorData:o,colorTextData:a};return e.type==="numeric"?u={...u,type:"numeric",numericFormat:{pattern:"0,0.00"},originalRenderer:S.renderers.NumericRenderer}:e.type==="date"?u={...u,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:O},originalRenderer:S.renderers.DateRenderer}:e.type==="checkbox"?u={...u,type:"checkbox",className:"htCenter",originalRenderer:S.renderers.CheckboxRenderer}:u.originalRenderer=S.renderers.TextRenderer,{...u,renderer:K}}),[p,h,o,a]),x=h==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",b=e=>{e.key==="Enter"&&(e.preventDefault(),f())},f=()=>{const e=C.current.value;k(e);const c=n.current?.hotInstance;c&&c.render()};return E.jsxs("div",{className:"TwHotTable w-full",children:[d&&E.jsx(Y,{inputRef:C,onKeyDown:b,onSearch:f,className:"max-w-60"}),E.jsx(j,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:n,data:r,themeName:x,rowHeaders:!0,language:"ko-KR",colHeaders:t&&t.map(e=>e.title),autoWrapRow:!0,height:"auto",contextMenu:!g,search:M,observeChanges:!0,columnSorting:!0,afterChange:m,afterSelection:s,formulas:{engine:H.buildEmpty({licenseKey:"gpl-v3"})},columns:N,readOnly:g,manualColumnResize:!0,afterColumnResize:D,colWidths:t.map(e=>e.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})]})},K=(n,t,r,o,a,m,s)=>{typeof m=="number"&&!isNaN(m)?(m%1!==0?s.numericFormat={pattern:"0,0.00"}:s.numericFormat={pattern:"0,0"},S.renderers.NumericRenderer.apply(void 0,[n,t,r,o,a,m,s])):s.originalRenderer?s.originalRenderer.apply(void 0,[n,t,r,o,a,m,s]):S.renderers.TextRenderer.apply(void 0,[n,t,r,o,a,m,s]);const D=n.getSettings().search,d=s.theme,g=n.getCellMeta(r,o),h=s.backgroundColor||g.backgroundColor,C=s.color||g.color,M=s.colorData,k=s.colorTextData;t.style.backgroundColor="",t.style.color="",D&&m&&String(m).toLowerCase().includes(D.toLowerCase())?(t.style.backgroundColor=d==="dark"?"#facc15":"yellow",t.style.color="black"):(t.style.backgroundColor=h,h||(r%2===0?t.style.backgroundColor=d==="dark"?"#101010":"#ffffff":t.style.backgroundColor=d==="dark"?"#000000":"#f8f8f8")),C&&(t.style.color=C),M?.[r]?.[o]&&(t.style.backgroundColor=M[r]?.[o],t.classList.remove("htDimmed")),k?.[r]?.[o]&&(t.style.color=k[r]?.[o],t.classList.remove("htDimmed")),t.classList.remove("htDimmed")},O={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(n,t){const r=n.getDate(),o=n.getMonth()+1;return`${n.getFullYear()}-${o.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`},parse(n,t){const r=n.split("-");return new Date(r[0],r[1]-1,r[2])}};export{q as HandsontableBlock};
