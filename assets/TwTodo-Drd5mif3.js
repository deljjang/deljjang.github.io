import{j as o,C as le,b as x,aK as se,q as re,o as ae,c as T,f as I,d as ie,aL as N,aM as z,h as ce}from"./index-CvT5YaSg.js";import{T as F}from"./TwLabel--lVRpl81.js";import{H as de,r as ue}from"./ht-theme-main.min-Dd-b5YMk.js";import{D as me}from"./datetime-BDx6lZXm.js";import{u as ge}from"./index.esm-BjAQZWJ4.js";/* empty css                */import{s as u}from"./fireDatabase-V756jICp.js";import{n as fe}from"./commonUtil-BVvWhpjp.js";import{u as he}from"./useWindowDimensions-DFaRtNkh.js";import{T as xe}from"./TwDatePicker-BKuZG050.js";import{T as M}from"./TwInput-Dod_gj7Y.js";import{T as ye}from"./TwSelect-eOO_IWYR.js";import{A as v}from"./AniButton-Co6JiSmW.js";import{T as De}from"./Footer-BzN4yNqc.js";import"./Button-BL8t6y7w.js";import"./LinkItem-CPuYx88B.js";import"./Typography-CHb_Yaam.js";import"./TwLinkItem-DyZdov9f.js";import"./Divider-Bwjk2vy1.js";import"./dividerClasses-D1fPCAFU.js";import"./Link-CDtkXzdW.js";const pe=n=>o.jsxs(le,{sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[o.jsx(v,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:n.onInsert,children:"입력"}),o.jsx(v,{type:"button",size:"small",variant:"outlined",color:"error",onClick:n.onDelete,children:"삭제"}),o.jsx(v,{type:"button",size:"small",variant:"outlined",color:"success",onClick:n.onReload,children:"리로드"}),o.jsx(v,{type:"button",size:"small",variant:"outlined",onClick:n.onCsvSave,children:"csv저장"})]});ue();const ve=n=>{const{userId:d,baseUrl:p}=n,g=x.useRef(null),y=x.useRef(null),[S,U]=x.useState(),[H,R]=x.useState(0),{height:k}=he(),P=me.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),L={edTitle:"",edDate:P},{register:w,handleSubmit:V,trigger:W,reset:A,control:C,setValue:b,getValues:D,formState:{errors:f}}=ge({mode:"submit ",defaultValues:L}),{theme:q}=se(),O=q==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",Y=async e=>{console.log("onFunPost.data",e.id,e);const t=`${p}/${d}/`;if(e.id===void 0){const l=N(z(T(I),t)).key;console.log("onSubmit.newKey",l),e.id=l}return u(t+e.id+"/title",e.title),u(t+e.id+"/date",e.date),u(t+e.id+"/t1",e.t1),u(t+e.id+"/t2",e.t2),u(t+e.id+"/ing","1"),e},_=async()=>{const e=`${p}/${d}/`,t=re(T(I,e),ae("title"));ie(t,l=>{if(!l.exists())return;const a=l.val(),i=[];for(let r in a){const s=a[r];s.id=r,s.sort=`${s.ing}_${s.date}_${s.title}`,i.push(s)}const h=i.sort((r,s)=>r.sort>s.sort?1:-1).filter(r=>r.ing==="1"),c=i.sort((r,s)=>r.sort>s.sort?-1:1).filter(r=>r.ing==="2");U([...h,...c]),R(i.length)})};x.useEffect(()=>{w("edDate",{required:!0,minLength:10}),w("filterField1"),b("columns1",n.selectDefault),w("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}})},[]),x.useEffect(()=>{d!==void 0&&_()},[d]);const G=async()=>{K()},Z=async()=>{g.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:n.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},$=[],B={indicators:!0},E=[];n.columns.map((e,t)=>{e.select&&$.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&E.push(t)}),B.columns=E;const K=()=>{try{const e=g.current?.hotInstance,t=e?.getPlugin("filters");if(t){const l=D("columns1");console.log("onKeyUp.columns1=",l,"text=",D("filterField1")),n.columns.forEach((h,c)=>{t?.removeConditions(c)}),t?.addCondition(Number(l),"contains",[D("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",g.current);const i=e.getData().length;R(i)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function J(){console.log("onInputBtn.errors=",f),console.log("onInputBtn.edDate=",D("edDate")),console.log("onInputBtn.edTitle=",D("edTitle")),V(Q)()}function Q(e,t){console.log("onSubmit.data=",e),console.log("onSubmit.e=",t),console.log("onSubmit.errors=",f);const l=`${n.baseUrl}/${d}/`,a=N(z(T(I),l)).key;console.log("onSubmit.newKey",e.newKey),u(l+a+"/title",e.edTitle),u(l+a+"/date",e.edDate),u(l+a+"/ing","1"),A({edTitle:"",edDate:P})}const X=async(e,t)=>{if(console.log("afterChange.change=",e,", source=",t),console.log("afterChange.change.length=",e?.length),e!==null){const l=g.current?.hotInstance;if(l?.getPlugin("filters")){const i=l.getData(),h=[];e.forEach((c,r)=>{const s={};console.log("afterChange.index1=",r,", item1=",c[0]),n.columns.forEach((m,ne)=>{console.log("afterChange.filteredData=",i[c[0]],m),s[m.data]=i[c[0]][ne]}),console.log("afterChange.tmp=",s),h.push(s)}),console.log("afterChange.saveData=",h),h.forEach(async(c,r)=>{console.log("afterChange.item=",c);const s=await Y(c);console.log("afterChange.result=",r,", result=",s),S.map(m=>{(m.id===void 0||m.id===null)&&(console.log("afterChange.rowData1=",m),m.id=s?.id,console.log("afterChange.rowData2=",m))})}),l.render()}}},ee=async()=>{const e=g.current.hotInstance;if(console.log("onDelete:",e),e&&y.current!==null){if(e?.getPlugin("filters")){const l=e.getData();console.log("onDelete.filteredData=",l[y.current]);const a=l[y.current][n.keyId];console.log("onDelete.deleteId=",a),window.confirm("삭제하시겠습니까?")&&u(`${n.baseUrl}/${d}/${a}`,null)}e.alter("remove_row",y.current,1)}},j=e=>{const t=e.target.value;console.log("onChange.target=",e.target.value),b(e.target.name,t)};function te(e,t){console.log("handleChangeDate.dates=",e,"currentDateString=",t),b("edDate",t),W("edDate")}const oe=f?.edTitle?o.jsx("div",{className:"sm:grid-cols-12 md:grid-cols-12 lg:grid-cols-12 xl:grid-cols-12",children:o.jsx("p",{className:"error",children:f.edTitle?.message})}):"";return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[o.jsx(ye,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:C,className:"dark:bg-dark-900",defaultValue:n.selectDefault?n.selectDefault:"1",options:$,error:!!f.columns1,onChange:j}),o.jsx(M,{name:"filterField1",control:C,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",size:"small",onKeyUp:K,onChange:j}),o.jsx(xe,{control:C,id:"edDate",name:"edDate",label:"등록일자",placeholder:"일자 입력",onChange:te}),o.jsxs("div",{children:[o.jsx(F,{htmlFor:"edTitle",children:"등록제목"}),o.jsx(M,{name:"edTitle",label:"제목",placeholder:"제목 입력",variant:"filled",size:"small",onChange:j,style:{},error:!!f.edTitle})]})]}),oe,o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[o.jsx(F,{textAlign:"left",children:"건수 : "+fe(H)}),o.jsx(pe,{onInsert:J,onDelete:ee,onReload:G,onCsvSave:Z})]}),o.jsx("div",{style:{maxHeight:`${k}- 200`,overflow:"auto"},children:o.jsx(de,{ref:g,data:S,themeName:O,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:k-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:X,afterSelection:e=>{y.current=e},licenseKey:"non-commercial-and-evaluation",columns:n.columns,cells:(e,t)=>n.columns[t].readOnly===!0?{readOnly:!0}:{},colWidths:n.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:B})})]})},Ve=()=>{const{user:n}=ce(),d=[{title:"일자",data:"date",type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"1",type:"text",data:"t1",select:!1},{title:"2",type:"text",data:"t2",select:!1},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"진행중",type:"text",data:"ing",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}],p=[130,500,100,100,100];return!n||n?.uid===void 0?o.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:o.jsx(F,{children:"로그인을 해야 이용 가능합니다."})}):o.jsxs(o.Fragment,{children:[o.jsx(ve,{csvFileName:"exported_todo",baseUrl:"todo",columns:d,colWidths:p,selectDefault:"1",keyId:d.length-1,userId:n?.uid}),o.jsx(De,{})]})};export{Ve as default};
