import{j as t}from"./index-DPJ17llW.js";import{r as d}from"./router-BlMcuVHC.js";import{i as S,p as b,t as q,j as ae,k as O,a3 as oe,Q as de,V as D,a4 as ce,z as me,R as ue,a5 as he,a6 as ge,a7 as A,a8 as H,a9 as fe,aa as ve,ab as f,ac as xe,ad as ye,U as pe,s as je}from"./App-DyeRZbe8.js";import{D as we}from"./luxon-MrBZWWSV.js";import{u as be}from"./useWindowDimensions-c3RsCB5T.js";import{T as Ne}from"./TwSelect-CtPJupMn.js";import"./vendor-CCYiWZgt.js";const ke=({onInsert:u,onDelete:n,onReload:x,onCsvSave:p})=>{const{t:l}=S();return t.jsxs("div",{className:"my-2 flex justify-end items-center",children:[t.jsx(b,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:u,children:l("input")}),t.jsx(b,{type:"button",size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:n,children:l("delete")}),t.jsx(b,{type:"button",size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:x,children:l("reload")}),t.jsx(b,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:p,children:l("csv_save")})]})},v=[{title:"division",data:"dv",readOnly:!1,select:!0},{title:"title",type:"text",data:"title",select:!0},{title:"description1",type:"text",data:"t1",select:!0},{title:"description2",type:"text",data:"t2",select:!0},{title:"sort",type:"text",data:"sort",select:!1,hidden:!0},{title:"id",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}],Ce=()=>t.jsxs("div",{className:"w-full pt-5",children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})]}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end mt-2",children:[t.jsx("div",{className:"h-6 bg-gray-200 dark:bg-zinc-800 rounded w-24 animate-shimmer relative overflow-hidden"}),t.jsx("div",{className:"flex justify-end h-10",children:t.jsx("div",{className:"w-32 h-full bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})})]}),t.jsxs("div",{className:"mt-2 space-y-1",children:[t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-t-md animate-shimmer relative overflow-hidden"}),[...Array(10)].map((u,n)=>t.jsx("div",{className:"h-8 bg-gray-300 dark:bg-zinc-700 rounded animate-shimmer relative overflow-hidden"},n))]})]}),De=()=>t.jsxs("div",{className:"w-full pt-5",children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})]}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end mt-2",children:[t.jsx("div",{className:"h-6 bg-gray-200 dark:bg-zinc-800 rounded w-24 animate-shimmer relative overflow-hidden"}),t.jsx("div",{className:"flex justify-end h-10",children:t.jsx("div",{className:"w-32 h-full bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})})]}),t.jsxs("div",{className:"mt-2 space-y-1",children:[t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-t-md animate-shimmer relative overflow-hidden"}),[...Array(10)].map((u,n)=>t.jsx("div",{className:"h-8 bg-gray-300 dark:bg-zinc-700 rounded animate-shimmer relative overflow-hidden"},n))]})]});pe();const Se=({csvFileName:u="exported_sheet",baseUrl:n="sheet",selectDefault:x="1"})=>{const{user:p}=q(),l=p?.uid,{t:a}=S(),K=v.length-1,h=d.useRef(null),j=d.useRef(null),[N,L]=d.useState(),[W,z]=d.useState(0),{height:I,width:F}=be(),R=d.useRef(!1),G=ae(),Q=O(oe),{theme:U}=O(e=>({theme:e.theme.mode}));we.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:Z,reset:ze,control:_,setValue:E,getValues:k,formState:{errors:J}}=de({mode:"submit "}),X=U==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",Y=async e=>{const s=`${n}/${l}/`;if(e.id===void 0||e.id===null||e.id===""){const i=xe(ye(A(H),s)).key;e.id=i}return f(s+e.id+"/dv",e.dv),f(s+e.id+"/title",e.title),f(s+e.id+"/t1",e.t1),f(s+e.id+"/t2",e.t2),f(s+e.id+"/ing","1"),e},ee=async()=>{const e=`${n}/${l}/`,s=he(A(H,e),ge("dv"));fe(s,i=>{if(!i.exists())return;const m=i.val(),o=[];for(let c in m){const r=m[c];r.id=c,r.sort=`${r.dv}_${r.title}`,o.push(r)}o.sort((c,r)=>c.sort>r.sort?1:-1),L(o),z(o.length)})};d.useEffect(()=>{Z("filterField1"),E("columns1",x)},[]),d.useEffect(()=>{l!==void 0&&ee()},[l]),d.useEffect(()=>{F<500&&R.current===!1&&(R.current=!0)},[F]);const te=async()=>{B()},se=async()=>{h.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:u,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},T=[],P={indicators:!0},$=[],V=[];v.map((e,s)=>{e.select&&T.push({value:s,text:a(e.title),label:a(e.title)}),V.push({...e,title:a(e.title)}),e.hidden===!0&&$.push(s)}),P.columns=$;const B=()=>{try{const e=h.current?.hotInstance,s=e?.getPlugin("filters");if(s){const i=k("columns1");G(ve(k("filterField1"))),v.forEach((c,r)=>{s?.removeConditions(r)}),s?.addCondition(Number(i),"contains",[k("filterField1")]),s?.filter(),e?.render();const o=e.getData().length;z(o)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function re(){h.current.hotInstance.alter("insert_row_above",0,1)}const ne=async(e,s)=>{if(e===null)return;const i=h.current?.hotInstance,m=i?.getPlugin("filters");if(m==null)return;const o=i.getData(),c={};e.forEach(async(g,C)=>{c[g[0]]=g[0]});const r=[];Object.keys(c).map(g=>{const C=c[g],w={};v.forEach(async(y,le)=>{w[y.data]=o[C][le]}),r.push(w)}),r.forEach(async(g,C)=>{const w=await Y(g);N.map(y=>{(y.id===void 0||y.id===null)&&(y.id=w?.id)})}),i.render()},ie=async()=>{const e=h.current.hotInstance;if(e&&j.current!==null){if(e?.getPlugin("filters")){const m=e.getData()[j.current][K],o=a("delete_confirm_message");window.confirm(o)&&f(`${n}/${l}/${m}`,null)}e.alter("remove_row",j.current,1)}},M=e=>{const s=e.target.value;E(e.target.name,s)};return p===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:t.jsx(D,{children:a("login_required")})}):N?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx(Ne,{id:"columns1",name:"columns1",placeholder:a("search_column"),control:_,className:"dark:bg-dark-900",defaultValue:x||"1",options:T,error:!!J.columns1,onChange:M}),t.jsx(ce,{name:"filterField1",control:_,label:a("search"),placeholder:a("search_placeholder"),variant:"filled",margin:"none",onKeyUp:B,onChange:M,value:Q})]}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[t.jsx(D,{className:"align-middle pt-2 md:pt-0 text-right md:text-left",children:a("count")+" : "+me(W)}),t.jsx(ke,{onInsert:re,onDelete:ie,onReload:te,onCsvSave:se})]}),t.jsx("div",{className:"w-full",style:{maxHeight:`${I} - 210`,overflow:"auto"},children:t.jsx(ue,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:h,data:N,themeName:X,rowHeaders:!0,colHeaders:v.map(e=>a(e.title)),autoWrapRow:!0,height:I-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:ne,afterSelection:e=>{j.current=e},columns:V,cells:(e,s)=>v[s].readOnly===!0?{readOnly:!0}:{},manualColumnResize:!0,filters:!0,hiddenColumns:P,licenseKey:"non-commercial-and-evaluation"})})]}):t.jsx(De,{})};function $e(){const{user:u}=q(),{t:n}=S();return d.useEffect(()=>{je({title:"",description:""})},[]),u===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:t.jsx(D,{children:n("login_required")})}):t.jsx(d.Suspense,{fallback:t.jsx(Ce,{}),children:t.jsx(Se,{})})}export{$e as default};
