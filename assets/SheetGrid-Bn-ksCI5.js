import{h as q,j as s,bF as D,p as de,bW as V,r as d,bX as me,bh as fe,bY as he,aL as ge,N as xe,H as K,bC as pe,bB as ye,q as ve,O as be,bZ as we,b_ as Ce,z as L,A as M,b$ as je,G as p,c0 as De,c1 as Ne,Q as Ie}from"./index-B5STorGf.js";import{A as N}from"./AniButton-BzGnLuWI.js";const ke=({ui:I,onInsert:h,onDelete:g,onReload:v,onCsvSave:m})=>{const{t:i}=q();return I==="tailwind"?s.jsxs("div",{className:"my-2 flex justify-end items-center",children:[s.jsx(D,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:h,children:i("input")}),s.jsx(D,{type:"button",size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:g,children:i("delete")}),s.jsx(D,{type:"button",size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:v,children:i("reload")}),s.jsx(D,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:m,children:i("csv_save")})]}):s.jsxs("div",{className:"my-2 flex justify-end items-center gap-1",children:[s.jsx(N,{type:"button",size:"small",variant:"outlined",color:"warning",className:"mr-2",onClick:h,children:i("input")}),s.jsx(N,{type:"button",size:"small",variant:"outlined",color:"error",className:"mr-2",onClick:g,children:i("delete")}),s.jsx(N,{type:"button",size:"small",variant:"outlined",color:"success",className:"mr-2",onClick:v,children:i("reload")}),s.jsx(N,{type:"button",size:"small",variant:"outlined",color:"success",onClick:m,children:i("csv_save")})]})},y=[{title:"division",data:"dv",readOnly:!1,select:!0},{title:"title",type:"text",data:"title",select:!0},{title:"description1",type:"text",data:"t1",select:!0},{title:"description2",type:"text",data:"t2",select:!0},{title:"sort",type:"text",data:"sort",select:!1,hidden:!0},{title:"id",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];Ie();const Se=({csvFileName:I="exported_sheet",baseUrl:h="sheet",selectDefault:g="1"})=>{const{user:v}=de(),m=v?.uid,{ui:i}=V(),{t:a}=q(),G=y.length-1,u=d.useRef(null),C=d.useRef(null),[R,Z]=d.useState(),[Q,_]=d.useState(0),{height:F,width:S}=me(),E=d.useRef(!1),[z,U]=fe(he),{theme:X,settings:Y,colWidths:J,setColWidths:k}=V();ge.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:ee,reset:Re,control:$,setValue:P,getValues:j,formState:{errors:te}}=xe({mode:"submit "}),se=X==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",ne=async e=>{const t=`${h}/${m}/`;if(e.id===void 0||e.id===null||e.id===""){const n=De(Ne(L(M),t)).key;e.id=n}return p(t+e.id+"/dv",e.dv),p(t+e.id+"/title",e.title),p(t+e.id+"/t1",e.t1),p(t+e.id+"/t2",e.t2),p(t+e.id+"/ing","1"),e},oe=async()=>{const e=`${h}/${m}/`,t=we(L(M,e),Ce("dv"));je(t,n=>{if(!n.exists())return;const r=n.val(),l=[];for(let c in r){const o=r[c];o.id=c,o.sort=`${o.dv}_${o.title}`,l.push(o)}l.sort((c,o)=>c.sort>o.sort?1:-1),Z(l),_(l.length)})};d.useEffect(()=>{ee("filterField1"),P("columns1",g),console.log("SheetGrid.text=",z)},[]),d.useEffect(()=>{m!==void 0&&oe()},[m]),d.useEffect(()=>{S<500&&E.current===!1&&(E.current=!0,k([100,100,100,100,100,100]))},[S]),d.useEffect(()=>{u.current.hotInstance.addHook("afterColumnResize",function(t,n){const r=J;try{r[n]=t,k(r)}catch{k([130,300,100,100,100,100])}})},[u.current]);const re=async()=>{H()},le=async()=>{u.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:I,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},T=[],W={indicators:!0},B=[],A=[];y.map((e,t)=>{e.select&&T.push({value:t,text:a(e.title),label:a(e.title)}),A.push({...e,title:a(e.title)}),e.hidden===!0&&B.push(t)}),W.columns=B;const H=()=>{try{const e=u.current?.hotInstance,t=e?.getPlugin("filters");if(t){const n=j("columns1");console.log("onKeyUp.columns1=",n,"text=",j("filterField1")),U(j("filterField1")),y.forEach((c,o)=>{t?.removeConditions(o)}),t?.addCondition(Number(n),"contains",[j("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",u.current);const l=e.getData().length;_(l)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function ie(){u.current.hotInstance.alter("insert_row_above",0,1)}const ae=async(e,t)=>{if(e===null)return;const n=u.current?.hotInstance,r=n?.getPlugin("filters");if(r==null)return;const l=n.getData(),c={};e.forEach(async(f,b)=>{c[f[0]]=f[0]}),console.log("afterChange.lines=",c);const o=[];Object.keys(c).map(f=>{const b=c[f];console.log("afterChange.lines.key=",f,", lines=",b);const w={};y.forEach(async(x,ue)=>{w[x.data]=l[b][ue]}),o.push(w)}),console.log("afterChange.saveData=",o),o.forEach(async(f,b)=>{const w=await ne(f);console.log("afterChange.result=",b,", result=",w),R.map(x=>{(x.id===void 0||x.id===null)&&(x.id=w?.id,console.log("afterChange.rowData2=",x))})}),n.render()},ce=async()=>{const e=u.current.hotInstance;if(e&&C.current!==null){if(e?.getPlugin("filters")){const r=e.getData()[C.current][G],l=a("delete_confirm_message");window.confirm(l)&&p(`${h}/${m}/${r}`,null)}e.alter("remove_row",C.current,1)}},O=e=>{const t=e.target.value;P(e.target.name,t)};return v===void 0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:s.jsx(K,{children:a("login_required")})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[s.jsx(pe,{id:"columns1",name:"columns1",placeholder:a("search_column"),control:$,className:"dark:bg-dark-900",defaultValue:g||"1",options:T,error:!!te.columns1,onChange:O}),s.jsx(ye,{name:"filterField1",control:$,label:a("search"),placeholder:a("search_placeholder"),variant:"filled",margin:"none",onKeyUp:H,onChange:O,value:z})]}),s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[s.jsx(K,{textAlign:"left",children:a("count")+" : "+ve(Q)}),s.jsx(ke,{ui:i,onInsert:ie,onDelete:ce,onReload:re,onCsvSave:le})]}),s.jsx("div",{className:"w-full",style:{maxHeight:`${F} - 210`,overflow:"auto"},children:s.jsx(be,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:u,data:R,themeName:se,rowHeaders:!0,colHeaders:y.map(e=>a(e.title)),autoWrapRow:!0,height:F-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:ae,afterSelection:e=>{C.current=e},columns:A,cells:(e,t)=>y[t].readOnly===!0?{readOnly:!0}:{},colWidths:Y.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:W,licenseKey:"non-commercial-and-evaluation"})})]})};export{Se as S};
