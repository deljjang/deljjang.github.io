import{V as ne,j as e,U as De,s as se,B as W,be as Q,r as d,q as le,o as re,a as H,f as K,b as ie,d as ee,cn as ye,aN as Z,aO as X,n as je,p as _,c as be,x as ve}from"./index-B5nT--g1.js";import{f as te}from"./MuiCard-CRLxYq80.js";import{L as Ce}from"./Loading-DhmNF301.js";import{T as we,a as Te}from"./Tabs-DokAfVMZ.js";import{n as Se,s as Ie}from"./commonUtil-DB6xv_HR.js";import{D as Fe,S as ke}from"./SinyDate-ZIVdqllB.js";import{D as ae}from"./datetime-BDx6lZXm.js";import{u as ce,C as Be}from"./index.esm-EunXJFlp.js";import{A as Y}from"./AniButton-CkGw9Lpj.js";import{S as J}from"./SinyItem-Dg9KOg-j.js";import{G as w}from"./Grid-Dx0wwJgL.js";import{T as q}from"./TextField-Dp_qZ_qf.js";import{I as N}from"./IconButton-BdLUpEDQ.js";import{D as oe}from"./Divider-C9VtL-JT.js";import{H as $e,r as Le}from"./ht-theme-main.min-DlYzX6xg.js";/* empty css                */import{S as Re}from"./SinySelect-DPrftvBy.js";import{u as Me}from"./useTheme-D1XSnGu8.js";import{C as de}from"./Container-CIu-ORg8.js";import"./Card-3cRNFPJI.js";import"./CardContent-DmLsNBv5.js";import"./CircularProgress-DaaeTxou.js";import"./ownerWindow-DvT1GKkC.js";import"./KeyboardArrowRight-DlGJTcin.js";import"./useSlotProps-DtEju_Dd.js";import"./resolveComponentProps-ROUE0EeA.js";import"./createSvgIcon-DZPPBzfa.js";import"./useControlled-eix3VZFE.js";import"./isMuiElement-sqRWOPwT.js";import"./index-BWMeF9zH.js";import"./index-Chjiymov.js";import"./Menu-DkYVsrMC.js";import"./utils-DxSd3qJb.js";import"./InputAdornment-CHtZHik0.js";import"./Popper-D9D7ZB8Z.js";import"./Button-CAVRkE9X.js";import"./Chip-DAac7Fka.js";import"./dividerClasses-DQkGGggF.js";import"./MenuItem-TvFuN44U.js";import"./styled-hopnhVU9.js";const Ee=ne(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),We=ne(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),Ye=se(W)(({theme:o})=>({backgroundColor:o.palette.mode==="dark"?Q.dark.backgroundColor:Q.light.backgroundColor,borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",alignContent:"center",justifyContent:"center",overflowX:"auto"}));function Pe({tabValue:o,onChange:s,tabs:i}){const a=De(),c=se(we)({"&.Mui-selected":{color:a.palette.text}});return e.jsx(Ye,{index:o,style:{width:"100%"},children:e.jsx(Te,{value:o,onChange:s,variant:"scrollable",scrollButtons:!1,allowScrollButtonsMobile:!0,"aria-label":"secondary tabs example",children:i.map(u=>e.jsx(c,{label:u.label},u.id))})})}const ze=o=>{const[s,i]=d.useState(o),[a,c]=d.useState([]),[u,h]=d.useState(),x=d.useCallback(T=>{const F=le(H(K,T),re("title"));ie(F,L=>{if(!L.exists())return;const g=L.val(),v=[];for(let D in g){const f=g[D];f.id=D,f.sort=`${f.ing}_${f.date}_${f.title}`,(u===""||u===void 0||(f.memo+"").toLowerCase().indexOf(u.toLowerCase())>-1)&&v.push(f)}const P=v.sort((D,f)=>D.sort>f.sort?1:-1).filter(D=>D.ing==="1"),p=v.sort((D,f)=>D.sort>f.sort?-1:1).filter(D=>D.ing==="2");c([...P,...p])})},[u]);return d.useEffect(()=>{s!==""&&x(s)},[x,s,u]),[a,i,h]},He=o=>{const{userId:s}=o,[i,a]=ze("");console.log("TodoDetail.todoList=",i);const c=ae.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),u={edTitle:"",edDate:c},{register:h,handleSubmit:x,reset:T,getValues:F,setFocus:L,formState:{errors:g,isSubmitting:v,submitCount:P}}=ce({mode:"submit ",defaultValues:u}),p=d.useRef();d.useEffect(()=>{h("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:3,message:"3글자 이상 입력해주세요."}}),h("edDate",{required:!0,minLength:10})}),d.useEffect(()=>{s!==void 0&&a(`todo/${s}`)},[s]);async function D(l){console.log("onInputBtn.errors=",g),console.log("onInputBtn.isSubmitting=",v),console.log("onInputBtn.edDate=",F("edDate")),console.log("onInputBtn.edTitle=",F("edTitle")),console.log("onInputBtn.submitCount=",P),l.preventDefault(),x(k)()}const f=()=>{o.handleGoogleLogin()};if(s===void 0)return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:[e.jsx(J,{children:"로그인을 해야 이용가능합니다."}),e.jsx(Y,{type:"button",size:"small",variant:"outlined",color:"success",sx:{mt:30},onClick:f,children:"로그인"})]});const G=(l,y)=>{l.preventDefault(),console.log("onEdit.item=",y),L("edTitle"),T({edTitle:y.title,edDate:y.date}),p.current=y.id,console.log("onEdit.todoId=",p.current)},U=l=>{l.preventDefault(),console.log("onCancel.item="),T({edTitle:""}),p.current=void 0},V=(l,y)=>{l.preventDefault(),window.confirm("삭제하시겠습니까?")&&setFireData(`todo/${s}/${y.id}`,null)},O=(l,y)=>{l.preventDefault(),window.confirm("완료하시겠습니까?")&&setFireData(`todo/${s}/${y.id}/ing`,"2")},z=l=>console.error(l);function k(l,y){console.log("onSubmit.data=",l),console.log("onSubmit.e=",y),console.log("onSubmit.todoId=",p.current),console.log("onSubmit.errors=",g);const j=`todo/${s}/`;if(p.current===void 0){const R=Z(X(H(K),j)).key;console.log("onSubmit.newKey",R),p.current=R}setFireData(j+p.current+"/title",l.edTitle),setFireData(j+p.current+"/date",l.edDate),setFireData(j+p.current+"/ing","1"),p.current=void 0,T({edTitle:"",edDate:c})}return e.jsxs(e.Fragment,{children:[e.jsxs(W,{sx:{width:"100%",flexGrow:1,m:2},children:[e.jsx("div",{id:"back-to-top-anchor"}),e.jsx("form",{onSubmit:x(k,z),children:e.jsxs(w,{container:!0,spacing:2,columns:{xs:12,md:12},children:[e.jsx(w,{item:!0,xs:12,children:e.jsx(q,{type:"date",style:{paddingTop:"2px"},fullWidth:!0,placeholder:"일자",...h("edDate"),variant:"standard"})}),e.jsx(w,{item:!0,xs:9,sm:10,children:e.jsxs(W,{sx:{display:"flex",alignItems:"normal",justifyContent:"center"},children:[e.jsx(q,{fullWidth:!0,style:{paddingTop:"2px"},placeholder:"Todo Input",...h("edTitle"),variant:"standard",error:!!g.edTitle}),e.jsx(N,{style:{marginTop:"-4px"},"aria-label":"bookmark",onClick:l=>U(l),children:e.jsx(Ee,{sx:{color:"action.active"}})})]})}),e.jsx(w,{item:!0,xs:3,sm:2,children:e.jsx(Y,{variant:"outlined",fullWidth:!0,onClick:l=>D(l),color:"success",size:"small",disabled:v,children:"입력"})}),e.jsx(w,{item:!0,xs:12,sm:12,children:g?.edTitle?e.jsx("p",{className:"error",children:g.edTitle?.message}):null})]})}),i?.map((l,y)=>e.jsxs("div",{children:[e.jsxs(W,{sx:{display:"plex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(ee,{component:"div",variant:"body2",color:"text.prime",children:l.date}),e.jsxs(W,{sx:{display:"plex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[l.ing==="1"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{"aria-label":"완료",onClick:j=>O(j,l),children:e.jsx(We,{})}),e.jsx(N,{"aria-label":"edit",onClick:j=>G(j,l),children:e.jsx(ye,{})})]}),e.jsx(N,{"aria-label":"delete",onClick:j=>V(j,l),children:e.jsx(Fe,{sx:{color:"rgba(120, 0, 0, 3)"}})})]})]}),e.jsx(ee,{component:"div",variant:"body",color:"text.prime",children:l.title}),e.jsx(oe,{})]},y))]}),e.jsx(oe,{})]})},Ke=o=>e.jsxs(W,{sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[e.jsx(Y,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:o.onInsert,children:"입력"}),e.jsx(Y,{type:"button",size:"small",variant:"outlined",color:"error",onClick:o.onDelete,children:"삭제"}),e.jsx(Y,{type:"button",size:"small",variant:"outlined",color:"success",onClick:o.onReload,children:"리로드"}),e.jsx(Y,{type:"button",size:"small",variant:"outlined",onClick:o.onCsvSave,children:"csv저장"})]}),Ge=({name:o,label:s,control:i,defaultValue:a,placeholder:c,variant:u="filled",margin:h="none",size:x="small",xsSize:T=12,mdSize:F=6,onKeyUp:L})=>e.jsx(w,{item:!0,xs:T,md:F,children:e.jsx(Be,{control:i,name:o,defaultValue:a,render:({field:g})=>e.jsx(q,{label:s,placeholder:c,value:g.value,inputRef:g.ref,onChange:v=>{g.onChange(v)},size:x,defaultValue:a,variant:u,margin:h,fullWidth:!0,onKeyUp:L,...g})})});Le();const Ue=o=>{const{userId:s,baseUrl:i}=o,a=d.useRef(null),c=d.useRef(null),[u,h]=d.useState(),[x,T]=d.useState(0),{height:F}=je(),g=Me().palette.mode==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",v=ae.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),P={edTitle:"",edDate:v},p=async t=>{console.log("onFunPost.data",t.id,t);const n=`${i}/${s}/`;if(t.id===void 0){const r=Z(X(H(K),n)).key;console.log("onSubmit.newKey",r),t.id=r}return setFireData(n+t.id+"/title",t.title),setFireData(n+t.id+"/date",t.date),setFireData(n+t.id+"/t1",t.t1),setFireData(n+t.id+"/t2",t.t2),setFireData(n+t.id+"/ing","1"),t},D=async()=>{const t=`${i}/${s}/`,n=le(H(K,t),re("title"));ie(n,r=>{if(!r.exists())return;const C=r.val(),S=[];for(let b in C){const m=C[b];m.id=b,m.sort=`${m.ing}_${m.date}_${m.title}`,S.push(m)}const E=S.sort((b,m)=>b.sort>m.sort?1:-1).filter(b=>b.ing==="1"),I=S.sort((b,m)=>b.sort>m.sort?-1:1).filter(b=>b.ing==="2");h([...E,...I]),T(S.length)})};d.useEffect(()=>{k("edDate",{required:!0,minLength:10}),k("filterField1"),A("columns1",o.selectDefault)},[]),d.useEffect(()=>{s!==void 0&&D()},[s]);const f=async()=>{z()},G=async()=>{a.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:o.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},U=[],V={indicators:!0},O=[];o.columns.map((t,n)=>{t.select&&U.push({value:n,text:t.title}),t.hidden===!0&&O.push(n)}),V.columns=O;const z=()=>{try{const t=a.current?.hotInstance,n=t?.getPlugin("filters");if(n){const r=B("columns1");console.log("onKeyUp.columns1=",r,"text=",B("filterField1")),o.columns.forEach((E,I)=>{n?.removeConditions(I)}),n?.addCondition(Number(r),"contains",[B("filterField1")]),n?.filter(),t?.render(),console.log("filtersPlugin=",n),console.log("hotRef=",a.current);const S=t.getData().length;T(S)}}catch(t){console.error("Error:",t),console.error("Error:",t.message)}},{register:k,handleSubmit:l,trigger:y,reset:j,control:R,setValue:A,getValues:B,formState:{errors:M}}=ce({mode:"submit ",defaultValues:P});async function ue(){console.log("onInputBtn.errors=",M),console.log("onInputBtn.edDate=",B("edDate")),console.log("onInputBtn.edTitle=",B("edTitle")),l(me)()}function me(t,n){console.log("onSubmit.data=",t),console.log("onSubmit.e=",n),console.log("onSubmit.errors=",M);const r=`${o.baseUrl}/${s}/`,C=Z(X(H(K),r)).key;console.log("onSubmit.newKey",t.newKey),setFireData(r+C+"/title",t.edTitle),setFireData(r+C+"/date",t.edDate),setFireData(r+C+"/ing","1"),j({edTitle:"",edDate:v})}const fe=async(t,n)=>{if(console.log("afterChange.change=",t,", source=",n),console.log("afterChange.change.length=",t?.length),t!==null){const r=a.current?.hotInstance;if(r?.getPlugin("filters")){const S=r.getData(),E=[];t.forEach((I,b)=>{const m={};console.log("afterChange.index1=",b,", item1=",I[0]),o.columns.forEach(($,pe)=>{console.log("afterChange.filteredData=",S[I[0]],$),m[$.data]=S[I[0]][pe]}),console.log("afterChange.tmp=",m),E.push(m)}),console.log("afterChange.saveData=",E),E.forEach(async(I,b)=>{console.log("afterChange.item=",I);const m=await p(I);console.log("afterChange.result=",b,", result=",m),u.map($=>{($.id===void 0||$.id===null)&&(console.log("afterChange.rowData1=",$),$.id=m?.id,console.log("afterChange.rowData2=",$))})}),r.render()}}},ge=async()=>{const t=a.current.hotInstance;if(console.log("onDelete:",t),t&&c.current!==null){if(t?.getPlugin("filters")){const r=t.getData();console.log("onDelete.filteredData=",r[c.current]);const C=r[c.current][o.keyId];console.log("onDelete.deleteId=",C),window.confirm("삭제하시겠습니까?")&&setFireData(`${o.baseUrl}/${s}/${C}`,null)}t.alter("remove_row",c.current,1)}};function he(t){console.log("handleChangeDate=",t);let n=_(t);n.format("YYYY-MM-DD HH:mm:ss"),console.log("handleChangeDate.dayjs=",n.format("YYYY-MM-DD HH:mm:ss")),A("edDate",n.format("YYYY-MM-DD")),y("edDate")}const xe=M?.edTitle?e.jsx(w,{item:!0,xs:12,children:e.jsx("p",{className:"error",children:M.edTitle?.message})}):"";return e.jsxs(de,{style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},sx:{mt:0},children:[e.jsxs(w,{container:!0,spacing:3,children:[e.jsx(Re,{id:"columns1",label:"조회 컬럼",mdSize:3,control:R,defaultValue:o.selectDefault?o.selectDefault:"1",selectList:U,error:!!M.columns1,onChange:t=>{t.preventDefault();const n=t.target.value;console.log("columns1=",B("columns1")),A("columns1",n),n!=""&&z()}}),e.jsx(Ge,{...k("filterField1"),name:"filterField1",control:R,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",size:"small",mdSize:9,fullWidth:!0,onKeyUp:z}),e.jsx(ke,{control:R,id:"edDate",label:"일자",mdSize:3,value:_(B("edDate")),...k("edDate"),defaultValue:_(B("edDate")),onChange:he}),e.jsx(w,{item:!0,xs:12,md:9,children:e.jsx(q,{...k("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목 입력",variant:"filled",size:"small",style:{},error:!!M.edTitle})}),xe,e.jsx(w,{item:!0,xs:12,md:3,sx:{paddingTop:["0 !important","0 !important","0.5rem !important"]},children:e.jsx(J,{textAlign:"left",children:"건수 : "+Se(x)})}),e.jsx(w,{item:!0,xs:12,md:9,sx:{paddingTop:["0 !important","0 !important","0.5rem !important"]},children:e.jsx(Ke,{onInsert:ue,onDelete:ge,onReload:f,onCsvSave:G})})]}),e.jsx("div",{style:{maxHeight:`${F}- 200`,overflow:"auto"},children:e.jsx($e,{ref:a,data:u,themeName:g,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:F-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:fe,afterSelection:t=>{c.current=t},licenseKey:"non-commercial-and-evaluation",columns:o.columns,cells:(t,n)=>o.columns[n].readOnly===!0?{readOnly:!0}:{},colWidths:o.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:V})})]})},Ve=({userId:o})=>{const s=[{title:"일자",data:"date",type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"1",type:"text",data:"t1",select:!1},{title:"2",type:"text",data:"t2",select:!1},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"진행중",type:"text",data:"ing",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}],i=[130,500,100,100,100];return o===void 0?e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:e.jsx(J,{children:"로그인을 해야 이용가능합니다."})}):e.jsx(Ue,{csvFileName:"exported_todo",baseUrl:"todo",columns:s,colWidths:i,selectDefault:"1",keyId:s.length-1,userId:o})},$t=()=>{const{user:o,handleGoogleLogin:s}=be(),[i,a]=d.useState(0),c=[{label:"그리도",id:"grid"},{label:"리스트",id:"list"}];d.useEffect(()=>{Ie({title:"Todo",description:""})},[]),d.useEffect(()=>{const h=c.findIndex(x=>`#${x.id}`===window.location.hash);a(h!==-1?h:i)},[i]);const u=(h,x)=>{window.location.hash=`#${c[x].id}`,a(x)};return e.jsx(ve,{sideType:"todo",title:"TODO",children:e.jsxs(de,{maxWidth:"lg",sx:{mt:3},children:[e.jsx(Pe,{tabValue:i,onChange:u,tabs:c}),e.jsxs(d.Suspense,{fallback:e.jsx(Ce,{}),children:[e.jsx(te,{value:i,index:0,style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},children:e.jsx(Ve,{userId:o?.uid||!1,handleGoogleLogin:s})}),e.jsx(te,{value:i,index:1,style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},children:e.jsx(He,{userId:o?.uid,handleGoogleLogin:s})})]})]})})};export{$t as TodoCommon,$t as default};
