import{j as S}from"./index-B8hDyh-S.js";import{e as T,bK as x,bL as Y,I as j,bM as H,bN as L,bO as A,J as I}from"./App-B7wpVSnF.js";import{r as R}from"./router-v4BRDFYV.js";import"./vendor-CCYiWZgt.js";L(A);I();const V=({id:n,rootDb:t,memoId:r,index:a,block:o,onUpdate:l,onUpdateBlock:s,afterSelection:k,readOnly:h,showSearch:y=!0})=>{const f=R.useRef(null);R.useRef(null);const C=async(u,w,g)=>{if(h)return;const d=f.current?.hotInstance;if(!d)return;const p=o.content.columns.map((E,M)=>({...E,width:d.getColWidth(M)}));console.log("handleAfterColumnResize.newColumns=",p),s(n,{content:{...o.content,columns:p}})},D=async(u,w)=>{if(h||w==="loadData"||typeof u!="object"||!Array.isArray(u))return;try{if(u[0].length!==4||u[0][2]===u[0][3])return}catch{return}const g=f.current?.hotInstance;if(g){const d=g.getSourceData();d.forEach((p,E)=>{Array.isArray(p)&&p.forEach((M,e)=>{M===null&&(d[E][e]="")})}),s(n,{content:{...o.content,data:d}})}};return S.jsx(S.Fragment,{children:S.jsx(z,{hotRef:f,columns:o.content.columns,rowData:o.content.data,colorData:o.content.colorData,colorTextData:o.content.colorTextData,gridData:o.content,afterChange:D,afterSelection:k,handleAfterColumnResize:C,showSearch:y,readOnly:h,isDraggable:!1})})},z=({hotRef:n,columns:t,rowData:r,colorData:a,colorTextData:o,afterChange:l,afterSelection:s,handleAfterColumnResize:k,showSearch:h,readOnly:y=!0})=>{const{theme:f}=T(e=>({theme:e.theme.mode})),C=R.useRef(null),[D,u]=R.useState("");R.useEffect(()=>{const e=n.current?.hotInstance;if(!e||!r)return;let c=!1;try{a&&a.forEach((m,b)=>{m&&m.forEach((i,N)=>{const F=e.getCellMeta(b,N).backgroundColor,v=i||void 0;F!==v&&(e.setCellMeta(b,N,"backgroundColor",v),c=!0)})})}catch{}try{o&&o.forEach((m,b)=>{m&&m.forEach((i,N)=>{const F=e.getCellMeta(b,N).color,v=i||void 0;F!==v&&(e.setCellMeta(b,N,"color",v),c=!0)})})}catch{}c&&e.render()},[r,a,o,n]);const w=[],g=R.useMemo(()=>{if(!t)return;const e=[];return t.forEach((c,m)=>{c.select&&w.push({value:m,text:c.title,label:c.title}),e.push({...c,title:c.title})}),e},[t]),d=R.useMemo(()=>g&&g.map((e,c)=>{const{readOnly:m,...b}=e;let i={...b,theme:f,isFirstColumn:g.indexOf(e)===0,data:c,colorData:a,colorTextData:o};return e.type==="numeric"?i={...i,type:"numeric",numericFormat:{pattern:"0,0.00"},originalRenderer:x.renderers.NumericRenderer}:e.type==="date"?i={...i,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:W},originalRenderer:x.renderers.DateRenderer}:e.type==="checkbox"?i={...i,type:"checkbox",className:"htCenter",originalRenderer:x.renderers.CheckboxRenderer}:i.originalRenderer=x.renderers.TextRenderer,{...i,renderer:K}}),[g,f,a,o]),p=f==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",E=e=>{e.key==="Enter"&&(e.preventDefault(),M())},M=()=>{const e=C.current.value;u(e);const c=n.current?.hotInstance;c&&c.render()};return S.jsxs("div",{className:"TwHotTable w-full",children:[h&&S.jsx(Y,{inputRef:C,onKeyDown:E,onSearch:M,className:"max-w-60"}),S.jsx(j,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:n,data:r,themeName:p,rowHeaders:!0,language:"ko-KR",colHeaders:t&&t.map(e=>e.title),autoWrapRow:!0,height:"auto",contextMenu:!y,search:D,observeChanges:!0,columnSorting:!0,afterChange:l,afterSelection:s,formulas:{engine:H.buildEmpty({licenseKey:"gpl-v3"})},columns:d,readOnly:y,manualColumnResize:!0,afterColumnResize:k,colWidths:t.map(e=>e.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})]})},K=(n,t,r,a,o,l,s)=>{typeof l=="number"&&!isNaN(l)?(l%1!==0?s.numericFormat={pattern:"0,0.00"}:s.numericFormat={pattern:"0,0"},x.renderers.NumericRenderer.apply(void 0,[n,t,r,a,o,l,s])):s.originalRenderer?s.originalRenderer.apply(void 0,[n,t,r,a,o,l,s]):x.renderers.TextRenderer.apply(void 0,[n,t,r,a,o,l,s]);const k=n.getSettings().search,h=s.theme,y=n.getCellMeta(r,a),f=s.backgroundColor||y.backgroundColor,C=s.color||y.color,D=s.colorData,u=s.colorTextData;t.style.backgroundColor="",t.style.color="",k&&l&&String(l).toLowerCase().includes(k.toLowerCase())?(t.style.backgroundColor=h==="dark"?"#facc15":"yellow",t.style.color="black"):(t.style.backgroundColor=f,f||(r%2===0?t.style.backgroundColor=h==="dark"?"#101010":"#ffffff":t.style.backgroundColor=h==="dark"?"#000000":"#f8f8f8")),C&&(t.style.color=C),D?.[r]?.[a]&&(t.style.backgroundColor=D[r]?.[a],t.classList.remove("htDimmed")),u?.[r]?.[a]&&(t.style.color=u[r]?.[a],t.classList.remove("htDimmed")),t.classList.remove("htDimmed")},W={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(n,t){const r=n.getDate(),a=n.getMonth()+1;return`${n.getFullYear()}-${a.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`},parse(n,t){const r=n.split("-");return new Date(r[0],r[1]-1,r[2])}};export{V as HandsontableBlock};
