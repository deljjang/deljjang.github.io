import{d9 as s,Q as U,da as Ce,db as je,dc as _e,dd as $e,de as f,df as Re,dg as ke,dh as Ne,di as Se,dj as He,dk as De,dl as Ie,dm as Me,dn as Ee,dp as Te,dq as Fe,dr as ze,ds as Ae,dt as Le,du as J,dv as Oe,dw as Pe,dx as X,dy as $,dz as Be,dA as Ve,dB as Z,dC as Ye,dD as Ge,dE as ee,dF as We,dG as Ke,dH as se,dI as Qe,dJ as W,dK as qe,h as te,j as r,a1 as w,p as Ue,bg as K,n as Je,r as m,u as Xe,bh as Ze,N as es,ca as Q,H as D,ci as ss,be as ts,w as j,dL as rs,O as ns,bm as as,bn as os,z as ls,A as is,bo as ds,G as v}from"./index-DXrHB5H9.js";import{L as cs}from"./HtmlCode-DJArA0bE.js";import{A as _}from"./AniButton-CMKBF52j.js";import{M as q}from"./HtmlCode-ATTyzmHc.js";import"./HtmlText-XuUuU8Ey.js";import"./index-D6m3UoLf.js";/* empty css                   */import"./Button-C1mNwFdL.js";import"./copy-CmU072mq.js";import"./ComponentCard-CQ3YBJfP.js";import"./TwRadio-DR-1b0rS.js";import"./TwBadge-D6Ek9YqN.js";import"./toPropertyKey-DCwh5dYN.js";function us(n){const t=typeof window>"u"?!1:window.jQuery;t&&(t.fn.handsontable=function(h){const i=this.first();let a=i.data("handsontable");if(typeof h!="string"){const p=h||{};return a?a.updateSettings(p):(a=new n.Core(i[0],p),i.data("handsontable",a),a.init()),i}let d;if(a)if(typeof a[h]<"u"){for(var l=arguments.length,y=new Array(l>1?l-1:0),u=1;u<l;u++)y[u-1]=arguments[u];d=a[h].call(a,...y),h==="destroy"&&i.removeData()}else throw new Error(`Handsontable do not provide action: ${h}`);return d})}var I,M,E,T,F;U();us(s);s.__GhostTable=Ce;s._getListenersCounter=je;s._getRegisteredMapsCounter=_e;s.EventManager=$e;const ms=[Re,ke,Ne,Se,He,De,Ie,Me,Ee,Te,Fe,ze],hs=[Ae,Le];s.helper={};s.dom={};f(ms,n=>{f(Object.getOwnPropertyNames(n),t=>{t.charAt(0)!=="_"&&(s.helper[t]=n[t])})});f(hs,n=>{f(Object.getOwnPropertyNames(n),t=>{t.charAt(0)!=="_"&&(s.dom[t]=n[t])})});s.cellTypes=(I=s.cellTypes)!==null&&I!==void 0?I:{};f(Oe(),n=>{s.cellTypes[n]=J(n)});s.cellTypes.registerCellType=Pe;s.cellTypes.getCellType=J;s.editors=(M=s.editors)!==null&&M!==void 0?M:{};f(Be(),n=>{s.editors[`${$(n)}Editor`]=X(n)});s.editors.registerEditor=Ve;s.editors.getEditor=X;s.renderers=(E=s.renderers)!==null&&E!==void 0?E:{};f(Ye(),n=>{const t=Z(n);n==="base"&&(s.renderers.cellDecorator=t),s.renderers[`${$(n)}Renderer`]=t});s.renderers.registerRenderer=Ge;s.renderers.getRenderer=Z;s.validators=(T=s.validators)!==null&&T!==void 0?T:{};f(We(),n=>{s.validators[`${$(n)}Validator`]=ee(n)});s.validators.registerValidator=Ke;s.validators.getValidator=ee;s.plugins=(F=s.plugins)!==null&&F!==void 0?F:{};f(Qe(),n=>{s.plugins[n]=se(n)});s.plugins[`${$(W.PLUGIN_KEY)}Plugin`]=W;s.plugins.registerPlugin=qe;s.plugins.getPlugin=se;const gs=({ui:n,onInsert:t,onDelete:h,onReload:i,onCsvSave:a,onSaveAll:d})=>{const{t:l}=te();return n==="tailwind"?r.jsxs("div",{className:"my-2 flex justify-end items-center",children:[r.jsx(w,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:d,children:l("save")}),r.jsx(w,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:t,children:l("insert")}),r.jsx(w,{size:"sm",variant:"outlined",color:"warning",className:"mr-1",onClick:h,children:l("delete")}),r.jsx(w,{size:"sm",variant:"outlined",color:"brand",className:"ml-1",onClick:a,children:l("csv_save")})]}):r.jsxs("div",{className:"my-2 flex justify-end items-center gap-1",children:[r.jsx(_,{type:"button",size:"small",variant:"outlined",color:"warning",className:"mr-2",onClick:t,children:l("insert")}),r.jsx(_,{type:"button",size:"small",variant:"outlined",color:"error",className:"mr-2",onClick:h,children:l("delete")}),r.jsx(_,{type:"button",size:"small",variant:"outlined",color:"success",className:"mr-2",onClick:i,children:l("reload")}),r.jsx(_,{type:"button",size:"small",variant:"outlined",color:"success",onClick:a,children:l("csv_save")})]})},fs=(n,t,h,i,a,d,l)=>{l.originalRenderer?l.originalRenderer.apply(void 0,[n,t,h,i,a,d,l]):s.renderers.TextRenderer.apply(void 0,[n,t,h,i,a,d,l]);const y=n.getSettings().search,u=l.theme,p=l.isFirstColumn;t.style.backgroundColor="",t.style.color="",y&&d&&String(d).toLowerCase().includes(y.toLowerCase())?(t.style.backgroundColor=u==="dark"?"#facc15":"yellow",t.style.color="black"):(p?t.style.backgroundColor=u==="dark"?"#4b5563":"#e0e0e0":h%2===0?t.style.backgroundColor=u==="dark"?"#101010":"#ffffff":t.style.backgroundColor=u==="dark"?"#000000":"#f8f8f8",t.style.color="")};U();const Fs=({detailData:n})=>{const{user:t}=Ue(),{ui:h}=K(),{t:i}=te(),{sheetId:a}=Je(),[d,l]=m.useState([]),{isMobileFooter:y}=Xe(),u=m.useRef(null);m.useRef(null);const p=m.useRef(null),b=m.useRef(null),[re,z]=m.useState(),{height:ps,width:bs}=Ze(),[ne,ae]=m.useState(""),[oe,A]=m.useState({isOpen:!1}),[L,O]=m.useState({show:!1,message:""}),[R,P]=m.useState(""),[le,k]=m.useState(!1),[C,B]=m.useState(""),{theme:N}=K(),{register:ie,reset:xs,control:ys,setValue:vs,getValues:ws,formState:{errors:Cs}}=es({mode:"submit "}),de=N==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",ce=async()=>{if(!a)return;const e=`memo_sheet_data/${t?.uid}/${a}/data`,o=as(ls(is,e),os(d.length>0?d[0].data:"title"));ds(o,g=>{if(!g.exists()){z([]);return}const c=g.val(),x=[];for(let S in c){const H=c[S];x.push(H)}z(x)})};function ue(){const e=n?.scrollY?n.scrollY:0;window.scrollTo({top:e})}m.useEffect(()=>{a&&t&&(Q(`memo_sheet/${t?.uid}/${a}/columns`).then(e=>{l(e||[{title:"title",data:"title",type:"text"}]),ie("filterField1")}),Q(`memo_sheet_data/${t?.uid}/${a}/memo`).then(e=>{P(e||"")}),ue())},[a,t]),m.useEffect(()=>{a&&d.length>0&&ce()},[a,d]);const me=async()=>{u.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:`sheet_${a}`,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},he=[],V=m.useMemo(()=>{const e=[];return d.forEach((o,g)=>{o.select&&he.push({value:g,text:o.title,label:o.title}),e.push({...o,title:o.title})}),e},[d]);d.map((e,o)=>{e.hidden});async function ge(){const e=u.current?.hotInstance;if(!e)return;let o;b.current!==null&&b.current>=0?(o=b.current+1,e.alter("insert_row_below",b.current,1)):(o=0,e.alter("insert_row_above",0,1)),e.selectCell(o,0)}const fe=async()=>{v(`memo_sheet_data/${t?.uid}/${a}/memo`,C),P(C),k(!1)},pe=()=>{B(R),k(!0)},be=e=>(v(`memo_sheet_data/${t?.uid}/${a}/data`,e),v(`memo_sheet/${t?.uid}/${a}/createdAt`,Date.now()),v(`memo_sheet/${t?.uid}/${a}/count`,e.length),e),Y=async(e=!0)=>{const o=u.current?.hotInstance;if(!o)return;const g=o.getSourceData();g.forEach((c,x)=>{c.id=x}),await be(g),e&&(O({show:!0,message:i("save_completed")}),setTimeout(()=>{O({show:!1,message:""})},2e3))},xe=async(e,o)=>{},ye=async(e,o,g)=>{Y(!1);const c=u.current?.hotInstance;if(!c)return;const x=d.map((S,H)=>({...S,width:c.getColWidth(H)}));l(x),v(`memo_sheet/${t?.uid}/${a}/columns`,x)},ve=async()=>{const e=u.current.hotInstance;if(e&&b.current!==null){const o=b.current,c=e.getSourceDataAtRow(o).id;A({isOpen:!0,title:i("delete_confirm_title"),message:i("delete_confirm_message_simple"),color:"warning",onConfirm:()=>{v(`memo_sheet_data/${t?.uid}/${a}/data/${c}`,null)},onClose:()=>A({isOpen:!1})})}};if(t===void 0)return r.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:r.jsx(D,{children:i("login_required")})});const G=()=>{const e=p.current.value;ae(e);const o=u.current?.hotInstance;o&&o.render()},we=e=>{e.key==="Enter"&&(e.preventDefault(),G())};return r.jsxs("div",{className:"pt-5 relative",children:[r.jsx(ss,{children:L.show&&r.jsx(ts.div,{initial:{y:"-100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"-100%",opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"fixed top-50 left-1/2 -translate-x-1/2 z-[2000] p-3 rounded-lg shadow-lg bg-green-500 text-white font-semibold",children:L.message})}),r.jsx(cs,{...oe}),r.jsx("div",{className:"mb-4",children:le?r.jsxs("div",{className:`${j.card} p-4`,children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx(D,{children:i("input")}),r.jsx("textarea",{className:"w-full h-64 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",value:C,onChange:e=>B(e.target.value),autoFocus:!0})]}),r.jsxs("div",{children:[r.jsx(D,{children:i("preview")}),r.jsx("div",{className:"prose dark:prose-invert max-w-none p-2 border rounded h-64 overflow-y-auto dark:bg-gray-700 dark:border-gray-600",children:r.jsx(q,{children:C})})]})]}),r.jsxs("div",{className:"mt-2 flex justify-end gap-2",children:[r.jsx(w,{variant:"outlined",color:j.button.indigo,size:"sm",onClick:()=>k(!1),children:i("cancel")}),r.jsx(w,{color:j.button.indigo,onClick:fe,children:i("save")})]})]}):r.jsx("div",{className:`${j.card} p-4 min-h-[4rem] cursor-pointer prose dark:prose-invert max-w-none`,onDoubleClick:pe,children:R?r.jsx(q,{children:R}):r.jsx("p",{className:"text-gray-400",children:i("double_click_to_edit_memo")})})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 pb-2",children:[r.jsx(rs,{inputRef:p,onKeyDown:we,onSearch:G}),r.jsx(gs,{ui:h,onInsert:ge,onDelete:ve,onCsvSave:me,onSaveAll:Y})]}),r.jsx("div",{className:"w-full",children:r.jsx(ns,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:u,data:re,themeName:de,rowHeaders:!0,colHeaders:d.map(e=>e.title),autoWrapRow:!0,height:"auto",contextMenu:!0,search:ne,observeChanges:!0,columnSorting:!0,afterChange:xe,afterSelection:e=>{b.current=e},columns:m.useMemo(()=>V.map(e=>{const{readOnly:o,...g}=e;let c={...g,theme:N};return e.type==="numeric"?c={...c,type:"numeric",numericFormat:{pattern:"0,0"},originalRenderer:s.renderers.NumericRenderer}:e.type==="date"?c={...c,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,originalRenderer:s.renderers.DateRenderer}:e.type==="checkbox"?c={...c,type:"checkbox",className:"htCenter",originalRenderer:s.renderers.CheckboxRenderer}:c.originalRenderer=s.renderers.TextRenderer,{...c,renderer:fs}}),[V,N]),manualColumnResize:!0,afterColumnResize:ye,colWidths:d.map(e=>e.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})})]})};export{Fs as MemoSheetGrid,Fs as default};
