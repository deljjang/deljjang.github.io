import{cl as k,S as vu,cm as Uc,cn as bc,co as xc,cp as Pc,cq as Xt,cr as Vc,cs as Dc,ct as Bc,cu as kc,cv as Gc,cw as Hc,cx as Wc,cy as Yc,cz as zc,cA as Xc,cB as $c,cC as Kc,cD as jc,cE as qc,cF as Iu,cG as Qc,cH as Zc,cI as Ou,cJ as Ys,cK as Jc,cL as ed,cM as Mu,cN as td,cO as rd,cP as wu,cQ as nd,cR as sd,cS as _u,cT as id,cU as Qa,cV as ad,cW as od,cX as ud,cY as hd,cZ as ld,c_ as cd,c$ as dd,d0 as pd,d1 as fd,d2 as md,d3 as gd,d4 as Ed,d5 as Rd,d6 as Td,d7 as Nd,d8 as Sd,d9 as Ad,da as yd,db as Cd,dc as vd,dd as Id,de as Od,df as Md,dg as wd,dh as _d,di as Ld,dj as Fd,dk as Ud,dl as bd,dm as xd,dn as Pd,dp as Vd,dq as Dd,dr as Bd,ds as kd,dt as Gd,du as Hd,dv as Wd,dw as Yd,dx as zd,dy as Xd,dz as $d,dA as Kd,dB as jd,dC as qd,dD as Qd,dE as Zd,dF as Jd,dG as ep,dH as tp,dI as rp,dJ as np,dK as sp,dL as ip,dM as ap,dN as op,dO as up,dP as hp,dQ as lp,dR as cp,dS as dp,dT as pp,dU as fp,dV as mp,dW as gp,dX as Ep,dY as Rp,dZ as Tp,d_ as Np,d$ as Sp,e0 as Ap,e1 as yp,e2 as Cp,a0 as Lu,r as Ge,j as he,Q as vp,e3 as Ip,q as Op,h as Mp,n as wp,I as _p,ck as Lp,bf as Fp,y as Up}from"./index-D7hKsLfU.js";import{M as bp}from"./HtmlCode-n6jfa_zJ.js";function xp(s){const e=typeof window>"u"?!1:window.jQuery;e&&(e.fn.handsontable=function(t){const r=this.first();let n=r.data("handsontable");if(typeof t!="string"){const l=t||{};return n?n.updateSettings(l):(n=new s.Core(r[0],l),r.data("handsontable",n),n.init()),r}let i;if(n)if(typeof n[t]<"u"){for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];i=n[t].call(n,...o),t==="destroy"&&r.removeData()}else throw new Error(`Handsontable do not provide action: ${t}`);return i})}var di,pi,fi,mi,gi;vu();xp(k);k.__GhostTable=Uc;k._getListenersCounter=bc;k._getRegisteredMapsCounter=xc;k.EventManager=Pc;const Pp=[Vc,Dc,Bc,kc,Gc,Hc,Wc,Yc,zc,Xc,$c,Kc],Vp=[jc,qc];k.helper={};k.dom={};Xt(Pp,s=>{Xt(Object.getOwnPropertyNames(s),e=>{e.charAt(0)!=="_"&&(k.helper[e]=s[e])})});Xt(Vp,s=>{Xt(Object.getOwnPropertyNames(s),e=>{e.charAt(0)!=="_"&&(k.dom[e]=s[e])})});k.cellTypes=(di=k.cellTypes)!==null&&di!==void 0?di:{};Xt(Qc(),s=>{k.cellTypes[s]=Iu(s)});k.cellTypes.registerCellType=Zc;k.cellTypes.getCellType=Iu;k.editors=(pi=k.editors)!==null&&pi!==void 0?pi:{};Xt(Jc(),s=>{k.editors[`${Ys(s)}Editor`]=Ou(s)});k.editors.registerEditor=ed;k.editors.getEditor=Ou;k.renderers=(fi=k.renderers)!==null&&fi!==void 0?fi:{};Xt(td(),s=>{const e=Mu(s);s==="base"&&(k.renderers.cellDecorator=e),k.renderers[`${Ys(s)}Renderer`]=e});k.renderers.registerRenderer=rd;k.renderers.getRenderer=Mu;k.validators=(mi=k.validators)!==null&&mi!==void 0?mi:{};Xt(nd(),s=>{k.validators[`${Ys(s)}Validator`]=wu(s)});k.validators.registerValidator=sd;k.validators.getValidator=wu;k.plugins=(gi=k.plugins)!==null&&gi!==void 0?gi:{};Xt(id(),s=>{k.plugins[s]=_u(s)});k.plugins[`${Ys(Qa.PLUGIN_KEY)}Plugin`]=Qa;k.plugins.registerPlugin=ad;k.plugins.getPlugin=_u;/**
 * @preserve
 * Authors: Hwang, Gun-gu
 * Last updated: Aug 20, 2018
 *
 * Description: Definition file for Korean - Korea language-country.
 */const Dp={languageCode:"ko-KR",[Cp]:"위쪽에 행 삽입",[yp]:"아래쪽에 행 삽입",[Ap]:"왼쪽에 열 삽입",[Sp]:"오른쪽에 열 삽입",[Np]:["행 삭제","여러 행 삭제"],[Tp]:["열 삭제","여러 열 삭제"],[Rp]:"되돌리기",[Ep]:"다시하기",[gp]:"읽기 전용",[mp]:"열 지우기",[fp]:"정렬",[pp]:"왼쪽",[dp]:"중앙",[cp]:"오른쪽",[lp]:"자동",[hp]:"위쪽",[up]:"가운데",[op]:"아래쪽",[ap]:"열 고정",[ip]:"열 고정 해제",[sp]:"테두리",[np]:"위쪽",[rp]:"오른쪽",[tp]:"아래쪽",[ep]:"왼쪽",[Jd]:"테두리 지우기",[Zd]:"댓글 달기",[Qd]:"댓글 편집",[qd]:"댓글 삭제",[jd]:"읽기 전용 댓글",[Kd]:"셀 병합",[$d]:"셀 병합 해제",[Xd]:"복사",[zd]:"잘라내기",[Yd]:"자녀 행 추가",[Wd]:"부모행에서 제거",[Hd]:["열 숨기기","여러 열 숨기기"],[Gd]:["열 숨기기 해제","여러 열 숨기기 해제"],[kd]:["행 숨기기","여러 행 숨기기"],[Bd]:["행 숨기기 해제","여러 행 숨기기 해제"],[Dd]:"조건없음",[Vd]:"비어있음",[Pd]:"비어있지 않음",[xd]:"같",[bd]:"같지 않음",[Ud]:"시작 문자",[Fd]:"끝 문자",[Ld]:"포함",[_d]:"포함하지 않음",[wd]:"보다 큼",[Md]:"크거나 같음",[Od]:"보다 작",[Id]:"작거나 같음",[vd]:"사이",[Cd]:"사이 제외",[yd]:"다음",[Ad]:"전",[Sd]:"오늘",[Nd]:"내일",[Td]:"어제",[Rd]:"공란",[Ed]:"조건부 필터",[gd]:"값 필터",[md]:"그리고",[fd]:"또는",[pd]:"전체선택",[dd]:"지우기",[cd]:"확인",[ld]:"취소",[hd]:"찾기",[ud]:"값",[od]:"두번째 값"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var de;(function(s){s.RELATIVE="RELATIVE",s.ABSOLUTE="ABSOLUTE"})(de||(de={}));class De{constructor(e,t,r){this.type=e,this.col=t,this.sheet=r}static absolute(e,t){return new De(de.ABSOLUTE,e,t)}static relative(e,t){return new De(de.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleColumnAddress(e).col-r.toSimpleColumnAddress(e).col}isColumnAbsolute(){return this.type===de.ABSOLUTE}isColumnRelative(){return this.type===de.RELATIVE}isAbsolute(){return this.type===de.ABSOLUTE&&this.sheet!==void 0}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new De(this.type,this.col+t,n)}shiftedByColumns(e){return new De(this.type,this.col+e,this.sheet)}toSimpleColumnAddress(e){const t=yt(this,e);let r=this.col;return this.isColumnRelative()&&(r=e.col+this.col),il(t,r)}shiftRelativeDimensions(e,t){const r=this.isColumnRelative()?this.col+e:this.col;return new De(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnAbsolute()?this.col+e:this.col;return new De(this.type,r,this.sheet)}withSheet(e){return new De(this.type,this.col,e)}isInvalid(e){return this.toSimpleColumnAddress(e).col<0}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case de.RELATIVE:return`${t}#COLR${this.col}`;case de.ABSOLUTE:return`${t}#COLA${this.col}`}}unparse(e){const t=this.toSimpleColumnAddress(e);if(NE(t))return;const r=Xs(t.col);return`${this.type===de.ABSOLUTE?"$":""}${r}`}exceedsSheetSizeLimits(e){return this.col>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ue{constructor(e,t,r){this.type=e,this.row=t,this.sheet=r}static absolute(e,t){return new Ue(de.ABSOLUTE,e,t)}static relative(e,t){return new Ue(de.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleRowAddress(e).row-r.toSimpleRowAddress(e).row}isRowAbsolute(){return this.type===de.ABSOLUTE}isRowRelative(){return this.type===de.RELATIVE}isAbsolute(){return this.type===de.ABSOLUTE&&this.sheet!==void 0}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new Ue(this.type,this.row+r,n)}shiftedByRows(e){return new Ue(this.type,this.row+e,this.sheet)}toSimpleRowAddress(e){const t=yt(this,e);let r=this.row;return this.isRowRelative()&&(r=e.row+this.row),sl(t,r)}shiftRelativeDimensions(e,t){const r=this.isRowRelative()?this.row+t:this.row;return new Ue(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isRowAbsolute()?this.row+t:this.row;return new Ue(this.type,r,this.sheet)}withSheet(e){return new Ue(this.type,this.row,e)}isInvalid(e){return this.toSimpleRowAddress(e).row<0}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case de.RELATIVE:return`${t}#ROWR${this.row}`;case de.ABSOLUTE:return`${t}#ROWA${this.row}`}}unparse(e){const t=this.toSimpleRowAddress(e);return TE(t)?void 0:`${this.type===de.ABSOLUTE?"$":""}${t.row+1}`}exceedsSheetSizeLimits(e){return this.row>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var K;(function(s){s.CELL_REFERENCE_RELATIVE="CELL_REFERENCE",s.CELL_REFERENCE_ABSOLUTE="CELL_REFERENCE_ABSOLUTE",s.CELL_REFERENCE_ABSOLUTE_COL="CELL_REFERENCE_ABSOLUTE_COL",s.CELL_REFERENCE_ABSOLUTE_ROW="CELL_REFERENCE_ABSOLUTE_ROW"})(K||(K={}));class Z{constructor(e,t,r,n){this.col=e,this.row=t,this.type=r,this.sheet=n}static fromColAndRow(e,t,r){return(e.isColumnAbsolute()&&t.isRowAbsolute()?Z.absolute.bind(this):e.isColumnAbsolute()?Z.absoluteCol.bind(this):t.isRowAbsolute()?Z.absoluteRow.bind(this):Z.relative.bind(this))(e.col,t.row,r)}static relative(e,t,r){return new Z(e,t,K.CELL_REFERENCE_RELATIVE,r)}static absolute(e,t,r){return new Z(e,t,K.CELL_REFERENCE_ABSOLUTE,r)}static absoluteCol(e,t,r){return new Z(e,t,K.CELL_REFERENCE_ABSOLUTE_COL,r)}static absoluteRow(e,t,r){return new Z(e,t,K.CELL_REFERENCE_ABSOLUTE_ROW,r)}toSimpleCellAddress(e){const t=yt(this,e);return this.type===K.CELL_REFERENCE_ABSOLUTE?M(t,this.col,this.row):this.type===K.CELL_REFERENCE_ABSOLUTE_ROW?M(t,e.col+this.col,this.row):this.type===K.CELL_REFERENCE_ABSOLUTE_COL?M(t,this.col,e.row+this.row):M(t,e.col+this.col,e.row+this.row)}toColumnAddress(){const e=this.isColumnRelative()?de.RELATIVE:de.ABSOLUTE;return new De(e,this.col,this.sheet)}toRowAddress(){const e=this.isRowRelative()?de.RELATIVE:de.ABSOLUTE;return new Ue(e,this.row,this.sheet)}toSimpleColumnAddress(e){const t=yt(this,e);let r=this.col;return this.isColumnRelative()&&(r+=e.col),il(t,r)}toSimpleRowAddress(e){const t=yt(this,e);let r=this.row;return this.isRowRelative()&&(r+=e.row),sl(t,r)}isRowAbsolute(){return this.type===K.CELL_REFERENCE_ABSOLUTE||this.type===K.CELL_REFERENCE_ABSOLUTE_ROW}isColumnAbsolute(){return this.type===K.CELL_REFERENCE_ABSOLUTE||this.type===K.CELL_REFERENCE_ABSOLUTE_COL}isColumnRelative(){return this.type===K.CELL_REFERENCE_RELATIVE||this.type===K.CELL_REFERENCE_ABSOLUTE_ROW}isRowRelative(){return this.type===K.CELL_REFERENCE_RELATIVE||this.type===K.CELL_REFERENCE_ABSOLUTE_COL}isAbsolute(){return this.type===K.CELL_REFERENCE_ABSOLUTE&&this.sheet!==void 0}shiftedByRows(e){return new Z(this.col,this.row+e,this.type,this.sheet)}shiftedByColumns(e){return new Z(this.col+e,this.row,this.type,this.sheet)}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new Z(this.col+t,this.row+r,this.type,n)}withSheet(e){return new Z(this.col,this.row,this.type,e)}isInvalid(e){return ze(this.toSimpleCellAddress(e))}shiftRelativeDimensions(e,t){const r=this.isColumnAbsolute()?this.col:this.col+e,n=this.isRowAbsolute()?this.row:this.row+t;return new Z(r,n,this.type,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnRelative()?this.col:this.col+e,n=this.isRowRelative()?this.row:this.row+t;return new Z(r,n,this.type,this.sheet)}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case K.CELL_REFERENCE_RELATIVE:return`${t}#${this.row}R${this.col}`;case K.CELL_REFERENCE_ABSOLUTE:return`${t}#${this.row}A${this.col}`;case K.CELL_REFERENCE_ABSOLUTE_COL:return`${t}#${this.row}AC${this.col}`;case K.CELL_REFERENCE_ABSOLUTE_ROW:return`${t}#${this.row}AR${this.col}`}}unparse(e){const t=this.toSimpleCellAddress(e);if(ze(t))return;const r=Xs(t.col),n=this.type===K.CELL_REFERENCE_ABSOLUTE||this.type===K.CELL_REFERENCE_ABSOLUTE_ROW?"$":"";return`${this.type===K.CELL_REFERENCE_ABSOLUTE||this.type===K.CELL_REFERENCE_ABSOLUTE_COL?"$":""}${r}${n}${t.row+1}`}exceedsSheetSizeLimits(e,t){return this.row>=t||this.col>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Ln=":",Be="$",Bp="\\s+",kp="[ \\t\\n\\r]+",zs="A-Za-zÀ-ʯ",ca=`${zs}0-9_.`,Fu=`[${zs}0-9_]+`,Gp="'(((?!').|'')*)'",Jr=`(${Fu}|${Gp})!`,Uu=`(${Jr})?\\${Be}?[A-Za-z]+\\${Be}?[0-9]+`,Za=`(${Jr})?\\${Be}?[A-Za-z]+`,Ja=`(${Jr})?\\${Be}?[0-9]+`,bu="[rR][0-9]*[cC][0-9]*",Hp=`(${Uu})[^${ca}]`,xu=`[${zs}_][${ca}]*`,Wp=["0","1","2","3","4","5","6","7","8","9"],Pu=[...Array.from(Array(26)).map((s,e)=>e+65),...Array.from(Array(26)).map((s,e)=>e+97),...Array.from(Array(496)).map((s,e)=>e+192)].map(s=>String.fromCharCode(s));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Vu=new RegExp(`^(${Jr})?(\\${Be}?)([A-Za-z]+)(\\${Be}?)([0-9]+)$`),Yp=new RegExp(`^(${Jr})?(\\${Be}?)([A-Za-z]+)$`),zp=new RegExp(`^(${Jr})?(\\${Be}?)([0-9]+)$`),Xp=new RegExp(`^${Fu}$`),br=(s,e,t)=>{const r=Vu.exec(e),n=da(r[6]);let i=$s(r,s);if(i===void 0)return;i===null&&(i=void 0);const a=Number(r[8])-1;return r[5]===Be&&r[7]===Be?Z.absolute(n,a,i):r[5]===Be?Z.absoluteCol(n,a-t.row,i):r[7]===Be?Z.absoluteRow(n-t.col,a,i):Z.relative(n-t.col,a-t.row,i)},Rs=(s,e,t)=>{const r=Yp.exec(e);let n=$s(r,s);if(n===void 0)return;n===null&&(n=void 0);const i=da(r[6]);return r[5]===Be?De.absolute(i,n):De.relative(i-t.col,n)},Ts=(s,e,t)=>{const r=zp.exec(e);let n=$s(r,s);if(n===void 0)return;n===null&&(n=void 0);const i=Number(r[6])-1;return r[5]===Be?Ue.absolute(i,n):Ue.relative(i-t.row,n)},Fi=(s,e,t)=>{const r=Vu.exec(e);if(!r)return;const n=da(r[6]);let i=$s(r,s);if(i===void 0)return;i===null&&(i=t);const a=Number(r[8])-1;return M(i,n,a)},$p=(s,e,t)=>{const r=e.split(Ln);if(r.length!==2)return;const[n,i]=r,a=Fi(s,n,t);if(a===void 0)return;const o=Fi(s,i,a.sheet);if(o!==void 0&&a.sheet===o.sheet)return $i(a,o)},Ns=(s,e,t)=>{const r=Xs(e.col),n=Du(e.sheet,s);if(n!==void 0)return t!==e.sheet?`${n}!${r}${e.row+1}`:`${r}${e.row+1}`},Kp=(s,e,t)=>{const r=Ns(s,e.start,t),n=Ns(s,e.end,e.start.sheet);if(!(r===void 0||n===void 0))return`${r}${Ln}${n}`};function da(s){return s.length===1?s.toUpperCase().charCodeAt(0)-65:s.split("").reduce((e,t)=>e*26+(t.toUpperCase().charCodeAt(0)-64),0)-1}function Xs(s){let e="";for(;s>=0;)e=String.fromCharCode(s%26+97)+e,s=Math.floor(s/26)-1;return e.toUpperCase()}function Du(s,e){let t=e(s);if(t!==void 0)return Xp.test(t)?t:(t=t.replace(/'/g,"''"),`'${t}'`)}function $s(s,e){var t;let r=(t=s[3])!==null&&t!==void 0?t:s[2];return r?(r=r.replace(/''/g,"'"),e(r)):null}function J(s){return s&&s.length===0}function Kt(s){return s==null?[]:Object.keys(s)}function be(s){for(var e=[],t=Object.keys(s),r=0;r<t.length;r++)e.push(s[t[r]]);return e}function jp(s,e){for(var t=[],r=Kt(s),n=0;n<r.length;n++){var i=r[n];t.push(e.call(null,s[i],i))}return t}function _(s,e){for(var t=[],r=0;r<s.length;r++)t.push(e.call(null,s[r],r));return t}function Ke(s){for(var e=[],t=0;t<s.length;t++){var r=s[t];Array.isArray(r)?e=e.concat(Ke(r)):e.push(r)}return e}function dt(s){return J(s)?void 0:s[0]}function Bu(s){var e=s&&s.length;return e?s[e-1]:void 0}function b(s,e){if(Array.isArray(s))for(var t=0;t<s.length;t++)e.call(null,s[t],t);else if(fa(s))for(var r=Kt(s),t=0;t<r.length;t++){var n=r[t],i=s[n];e.call(null,i,n)}else throw Error("non exhaustive match")}function xt(s){return typeof s=="string"}function pt(s){return s===void 0}function or(s){return s instanceof Function}function we(s,e){return e===void 0&&(e=1),s.slice(e,s.length)}function Sn(s,e){return e===void 0&&(e=1),s.slice(0,s.length-e)}function Ct(s,e){var t=[];if(Array.isArray(s))for(var r=0;r<s.length;r++){var n=s[r];e.call(null,n)&&t.push(n)}return t}function Ar(s,e){return Ct(s,function(t){return!e(t)})}function gt(s,e){for(var t=Object.keys(s),r={},n=0;n<t.length;n++){var i=t[n],a=s[i];e(a)&&(r[i]=a)}return r}function U(s,e){return fa(s)?s.hasOwnProperty(e):!1}function Se(s,e){return qr(s,function(t){return t===e})!==void 0}function je(s){for(var e=[],t=0;t<s.length;t++)e.push(s[t]);return e}function Fn(s){var e={};for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t]);return e}function qr(s,e){for(var t=0;t<s.length;t++){var r=s[t];if(e.call(null,r))return r}}function qp(s,e){for(var t=[],r=0;r<s.length;r++){var n=s[r];e.call(null,n)&&t.push(n)}return t}function Le(s,e,t){for(var r=Array.isArray(s),n=r?s:be(s),i=r?[]:Kt(s),a=t,o=0;o<n.length;o++)a=e.call(null,a,n[o],r?o:i[o]);return a}function Un(s){return Ar(s,function(e){return e==null})}function pa(s,e){e===void 0&&(e=function(r){return r});var t=[];return Le(s,function(r,n){var i=e(n);return Se(t,i)?r:(t.push(i),r.concat(n))},[])}function At(s){return Array.isArray(s)}function $t(s){return s instanceof RegExp}function fa(s){return s instanceof Object}function ct(s,e){for(var t=0;t<s.length;t++)if(!e(s[t],t))return!1;return!0}function Ks(s,e){return Ar(s,function(t){return Se(e,t)})}function ku(s,e){for(var t=0;t<s.length;t++)if(e(s[t]))return!0;return!1}function Qp(s,e){for(var t=0;t<s.length;t++)if(s[t]===e)return t;return-1}function vt(s){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r++)for(var n=e[r],i=Kt(n),a=0;a<i.length;a++){var o=i[a];s[o]=n[o]}return s}function Zp(s){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r++){var n=e[r];if(!pt(n))for(var i=Kt(n),a=0;a<i.length;a++){var o=i[a];U(s,o)||(s[o]=n[o])}}return s}function js(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return Zp.apply(null,[{}].concat(s))}function Gu(s,e){var t={};return b(s,function(r){var n=e(r),i=t[n];i?i.push(r):t[n]=[r]}),t}function eo(s,e){for(var t=Fn(s),r=Kt(e),n=0;n<r.length;n++){var i=r[n],a=e[i];t[i]=a}return t}function Ae(){}function to(s){return s}function Jp(s){for(var e=[],t=0;t<s.length;t++){var r=s[t];e.push(r!==void 0?r:void 0)}return e}function Ui(s){console&&console.error&&console.error("Error: "+s)}function ma(s){console&&console.warn&&console.warn("Warning: "+s)}function ro(){return typeof Map=="function"}function ef(s,e){e.forEach(function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach(function(n){if(n!=="constructor"){var i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(s.prototype,n,i):s.prototype[n]=t.prototype[n]}})})}function Hu(s){function e(){}e.prototype=s;var t=new e;function r(){return typeof t.bar}return r(),r(),s}function Ss(s){return s[s.length-1]}function Wu(s){var e=new Date().getTime(),t=s(),r=new Date().getTime(),n=r-e;return{time:n,value:t}}var is={exports:{}},tf=is.exports,no;function rf(){return no||(no=1,function(s){(function(e,t){s.exports?s.exports=t():e.regexpToAst=t()})(typeof self<"u"?self:tf,function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(R){this.idx=R.idx,this.input=R.input,this.groupIdx=R.groupIdx},e.prototype.pattern=function(R){this.idx=0,this.input=R,this.groupIdx=0,this.consumeChar("/");var A=this.disjunction();this.consumeChar("/");for(var S={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":o(S,"global");break;case"i":o(S,"ignoreCase");break;case"m":o(S,"multiLine");break;case"u":o(S,"unicode");break;case"y":o(S,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:S,value:A}},e.prototype.disjunction=function(){var R=[];for(R.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),R.push(this.alternative());return{type:"Disjunction",value:R}},e.prototype.alternative=function(){for(var R=[];this.isTerm();)R.push(this.term());return{type:"Alternative",value:R}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var R;switch(this.popChar()){case"=":R="Lookahead";break;case"!":R="NegativeLookahead";break}u(R);var A=this.disjunction();return this.consumeChar(")"),{type:R,value:A}}l()},e.prototype.quantifier=function(R){var A;switch(this.popChar()){case"*":A={atLeast:0,atMost:1/0};break;case"+":A={atLeast:1,atMost:1/0};break;case"?":A={atLeast:0,atMost:1};break;case"{":var S=this.integerIncludingZero();switch(this.popChar()){case"}":A={atLeast:S,atMost:S};break;case",":var y;this.isDigit()?(y=this.integerIncludingZero(),A={atLeast:S,atMost:y}):A={atLeast:S,atMost:1/0},this.consumeChar("}");break}if(R===!0&&A===void 0)return;u(A);break}if(!(R===!0&&A===void 0))return u(A),this.peekChar(0)==="?"?(this.consumeChar("?"),A.greedy=!1):A.greedy=!0,A.type="Quantifier",A},e.prototype.atom=function(){var R;switch(this.peekChar()){case".":R=this.dotAll();break;case"\\":R=this.atomEscape();break;case"[":R=this.characterClass();break;case"(":R=this.group();break}return R===void 0&&this.isPatternCharacter()&&(R=this.patternCharacter()),u(R),this.isQuantifier()&&(R.quantifier=this.quantifier()),R},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[i(`
`),i("\r"),i("\u2028"),i("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var R=this.positiveInteger();return{type:"GroupBackReference",value:R}},e.prototype.characterClassEscape=function(){var R,A=!1;switch(this.popChar()){case"d":R=d;break;case"D":R=d,A=!0;break;case"s":R=E;break;case"S":R=E,A=!0;break;case"w":R=f;break;case"W":R=f,A=!0;break}return u(R),{type:"Set",value:R,complement:A}},e.prototype.controlEscapeAtom=function(){var R;switch(this.popChar()){case"f":R=i("\f");break;case"n":R=i(`
`);break;case"r":R=i("\r");break;case"t":R=i("	");break;case"v":R=i("\v");break}return u(R),{type:"Character",value:R}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var R=this.popChar();if(/[a-zA-Z]/.test(R)===!1)throw Error("Invalid ");var A=R.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:A}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:i("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var R=this.popChar();return{type:"Character",value:i(R)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var R=this.popChar();return{type:"Character",value:i(R)}}},e.prototype.characterClass=function(){var R=[],A=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),A=!0);this.isClassAtom();){var S=this.classAtom(),y=S.type==="Character";if(y&&this.isRangeDash()){this.consumeChar("-");var C=this.classAtom(),O=C.type==="Character";if(O){if(C.value<S.value)throw Error("Range out of order in character class");R.push({from:S.value,to:C.value})}else a(S.value,R),R.push(i("-")),a(C.value,R)}else a(S.value,R)}return this.consumeChar("]"),{type:"Set",complement:A,value:R}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:i("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var R=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),R=!1;break;default:this.groupIdx++;break}var A=this.disjunction();this.consumeChar(")");var S={type:"Group",capturing:R,value:A};return R&&(S.idx=this.groupIdx),S},e.prototype.positiveInteger=function(){var R=this.popChar();if(n.test(R)===!1)throw Error("Expecting a positive integer");for(;r.test(this.peekChar(0));)R+=this.popChar();return parseInt(R,10)},e.prototype.integerIncludingZero=function(){var R=this.popChar();if(r.test(R)===!1)throw Error("Expecting an integer");for(;r.test(this.peekChar(0));)R+=this.popChar();return parseInt(R,10)},e.prototype.patternCharacter=function(){var R=this.popChar();switch(R){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:i(R)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},e.prototype.isDigit=function(){return r.test(this.peekChar(0))},e.prototype.isClassAtom=function(R){switch(R===void 0&&(R=0),this.peekChar(R)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}},e.prototype.isQuantifier=function(){var R=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(R)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(R){for(var A="",S=0;S<R;S++){var y=this.popChar();if(t.test(y)===!1)throw Error("Expecting a HexDecimal digits");A+=y}var C=parseInt(A,16);return{type:"Character",value:C}},e.prototype.peekChar=function(R){return R===void 0&&(R=0),this.input[this.idx+R]},e.prototype.popChar=function(){var R=this.peekChar(0);return this.consumeChar(),R},e.prototype.consumeChar=function(R){if(R!==void 0&&this.input[this.idx]!==R)throw Error("Expected: '"+R+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t=/[0-9a-fA-F]/,r=/[0-9]/,n=/[1-9]/;function i(R){return R.charCodeAt(0)}function a(R,A){R.length!==void 0?R.forEach(function(S){A.push(S)}):A.push(R)}function o(R,A){if(R[A]===!0)throw"duplicate flag "+A;R[A]=!0}function u(R){if(R===void 0)throw Error("Internal Error - Should never get here!")}function l(){throw Error("Internal Error - Should never get here!")}var c,d=[];for(c=i("0");c<=i("9");c++)d.push(c);var f=[i("_")].concat(d);for(c=i("a");c<=i("z");c++)f.push(c);for(c=i("A");c<=i("Z");c++)f.push(c);var E=[i(" "),i("\f"),i(`
`),i("\r"),i("	"),i("\v"),i("	"),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i("\u2028"),i("\u2029"),i(" "),i(" "),i("　"),i("\uFEFF")];function N(){}return N.prototype.visitChildren=function(R){for(var A in R){var S=R[A];R.hasOwnProperty(A)&&(S.type!==void 0?this.visit(S):Array.isArray(S)&&S.forEach(function(y){this.visit(y)},this))}},N.prototype.visit=function(R){switch(R.type){case"Pattern":this.visitPattern(R);break;case"Flags":this.visitFlags(R);break;case"Disjunction":this.visitDisjunction(R);break;case"Alternative":this.visitAlternative(R);break;case"StartAnchor":this.visitStartAnchor(R);break;case"EndAnchor":this.visitEndAnchor(R);break;case"WordBoundary":this.visitWordBoundary(R);break;case"NonWordBoundary":this.visitNonWordBoundary(R);break;case"Lookahead":this.visitLookahead(R);break;case"NegativeLookahead":this.visitNegativeLookahead(R);break;case"Character":this.visitCharacter(R);break;case"Set":this.visitSet(R);break;case"Group":this.visitGroup(R);break;case"GroupBackReference":this.visitGroupBackReference(R);break;case"Quantifier":this.visitQuantifier(R);break}this.visitChildren(R)},N.prototype.visitPattern=function(R){},N.prototype.visitFlags=function(R){},N.prototype.visitDisjunction=function(R){},N.prototype.visitAlternative=function(R){},N.prototype.visitStartAnchor=function(R){},N.prototype.visitEndAnchor=function(R){},N.prototype.visitWordBoundary=function(R){},N.prototype.visitNonWordBoundary=function(R){},N.prototype.visitLookahead=function(R){},N.prototype.visitNegativeLookahead=function(R){},N.prototype.visitCharacter=function(R){},N.prototype.visitSet=function(R){},N.prototype.visitGroup=function(R){},N.prototype.visitGroupBackReference=function(R){},N.prototype.visitQuantifier=function(R){},{RegExpParser:e,BaseRegExpVisitor:N,VERSION:"0.4.0"}})}(is)),is.exports}var bn=rf(),as={},nf=new bn.RegExpParser;function qs(s){var e=s.toString();if(as.hasOwnProperty(e))return as[e];var t=nf.pattern(e);return as[e]=t,t}function sf(){as={}}var af=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Yu="Complement Sets are not supported for first char optimization",As=`Unable to use "first char" lexer optimizations:
`;function of(s,e){e===void 0&&(e=!1);try{var t=qs(s),r=bi(t.value,{},t.flags.ignoreCase);return r}catch(i){if(i.message===Yu)e&&ma(""+As+("	Unable to optimize: < "+s.toString()+` >
`)+`	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{var n="";e&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Ui(As+`
`+("	Failed parsing: < "+s.toString()+` >
`)+("	Using the regexp-to-ast library version: "+bn.VERSION+`
`)+"	Please open an issue at: https://github.com/bd82/regexp-to-ast/issues"+n)}}return[]}function bi(s,e,t){switch(s.type){case"Disjunction":for(var r=0;r<s.value.length;r++)bi(s.value[r],e,t);break;case"Alternative":for(var n=s.value,r=0;r<n.length;r++){var i=n[r];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var a=i;switch(a.type){case"Character":Hn(a.value,e,t);break;case"Set":if(a.complement===!0)throw Error(Yu);b(a.value,function(l){if(typeof l=="number")Hn(l,e,t);else{var c=l;if(t===!0)for(var d=c.from;d<=c.to;d++)Hn(d,e,t);else{for(var d=c.from;d<=c.to&&d<an;d++)Hn(d,e,t);if(c.to>=an)for(var f=c.from>=an?c.from:an,E=c.to,N=ar(f),R=ar(E),A=N;A<=R;A++)e[A]=A}}});break;case"Group":bi(a.value,e,t);break;default:throw Error("Non Exhaustive Match")}var o=a.quantifier!==void 0&&a.quantifier.atLeast===0;if(a.type==="Group"&&xi(a)===!1||a.type!=="Group"&&o===!1)break}break;default:throw Error("non exhaustive match!")}return be(e)}function Hn(s,e,t){var r=ar(s);e[r]=r,t===!0&&uf(s,e)}function uf(s,e){var t=String.fromCharCode(s),r=t.toUpperCase();if(r!==t){var n=ar(r.charCodeAt(0));e[n]=n}else{var i=t.toLowerCase();if(i!==t){var n=ar(i.charCodeAt(0));e[n]=n}}}function so(s,e){return qr(s.value,function(t){if(typeof t=="number")return Se(e,t);var r=t;return qr(e,function(n){return r.from<=n&&n<=r.to})!==void 0})}function xi(s){return s.quantifier&&s.quantifier.atLeast===0?!0:s.value?At(s.value)?ct(s.value,xi):xi(s.value):!1}var hf=function(s){af(e,s);function e(t){var r=s.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return e.prototype.visitChildren=function(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}s.prototype.visitChildren.call(this,t)}},e.prototype.visitCharacter=function(t){Se(this.targetCharCodes,t.value)&&(this.found=!0)},e.prototype.visitSet=function(t){t.complement?so(t,this.targetCharCodes)===void 0&&(this.found=!0):so(t,this.targetCharCodes)!==void 0&&(this.found=!0)},e}(bn.BaseRegExpVisitor);function ga(s,e){if(e instanceof RegExp){var t=qs(e),r=new hf(s);return r.visit(t),r.found}else return qr(e,function(n){return Se(s,n.charCodeAt(0))})!==void 0}var zu=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Pt="PATTERN",Tr="defaultMode",Wn="modes",Xu=typeof new RegExp("(?:)").sticky=="boolean";function lf(s,e){e=js(e,{useSticky:Xu,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:function(y,C){return C()}});var t=e.tracer;t("initCharCodeToOptimizedIndexMap",function(){Uf()});var r;t("Reject Lexer.NA",function(){r=Ar(s,function(y){return y[Pt]===$e.NA})});var n=!1,i;t("Transform Patterns",function(){n=!1,i=_(r,function(y){var C=y[Pt];if($t(C)){var O=C.source;return O.length===1&&O!=="^"&&O!=="$"&&O!=="."?O:O.length===2&&O[0]==="\\"&&!Se(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],O[1])?O[1]:e.useSticky?ao(C):io(C)}else{if(or(C))return n=!0,{exec:C};if(U(C,"exec"))return n=!0,C;if(typeof C=="string"){if(C.length===1)return C;var te=C.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),j=new RegExp(te);return e.useSticky?ao(j):io(j)}else throw Error("non exhaustive match")}})});var a,o,u,l,c;t("misc mapping",function(){a=_(r,function(y){return y.tokenTypeIdx}),o=_(r,function(y){var C=y.GROUP;if(C!==$e.SKIPPED){if(xt(C))return C;if(pt(C))return!1;throw Error("non exhaustive match")}}),u=_(r,function(y){var C=y.LONGER_ALT;if(C){var O=Qp(r,C);return O}}),l=_(r,function(y){return y.PUSH_MODE}),c=_(r,function(y){return U(y,"POP_MODE")})});var d;t("Line Terminator Handling",function(){var y=ju(e.lineTerminatorCharacters);d=_(r,function(C){return!1}),e.positionTracking!=="onlyOffset"&&(d=_(r,function(C){if(U(C,"LINE_BREAKS"))return C.LINE_BREAKS;if(Ku(C,y)===!1)return ga(y,C.PATTERN)}))});var f,E,N,R;t("Misc Mapping #2",function(){f=_(r,$u),E=_(i,_f),N=Le(r,function(y,C){var O=C.GROUP;return xt(O)&&O!==$e.SKIPPED&&(y[O]=[]),y},{}),R=_(i,function(y,C){return{pattern:i[C],longerAlt:u[C],canLineTerminator:d[C],isCustom:f[C],short:E[C],group:o[C],push:l[C],pop:c[C],tokenTypeIdx:a[C],tokenType:r[C]}})});var A=!0,S=[];return e.safeMode||t("First Char Optimization",function(){S=Le(r,function(y,C,O){if(typeof C.PATTERN=="string"){var te=C.PATTERN.charCodeAt(0),j=ar(te);Ei(y,j,R[O])}else if(At(C.START_CHARS_HINT)){var q;b(C.START_CHARS_HINT,function(re){var ne=typeof re=="string"?re.charCodeAt(0):re,X=ar(ne);q!==X&&(q=X,Ei(y,X,R[O]))})}else if($t(C.PATTERN))if(C.PATTERN.unicode)A=!1,e.ensureOptimizations&&Ui(""+As+("	Unable to analyze < "+C.PATTERN.toString()+` > pattern.
`)+`	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{var Ee=of(C.PATTERN,e.ensureOptimizations);J(Ee)&&(A=!1),b(Ee,function(re){Ei(y,re,R[O])})}else e.ensureOptimizations&&Ui(""+As+("	TokenType: <"+C.name+`> is using a custom token pattern without providing <start_chars_hint> parameter.
`)+`	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),A=!1;return y},[])}),t("ArrayPacking",function(){S=Jp(S)}),{emptyGroups:N,patternIdxToConfig:R,charCodeToPatternIdxToConfig:S,hasCustom:n,canBeOptimized:A}}function cf(s,e){var t=[],r=pf(s);t=t.concat(r.errors);var n=ff(r.valid),i=n.valid;return t=t.concat(n.errors),t=t.concat(df(i)),t=t.concat(Af(i)),t=t.concat(yf(i,e)),t=t.concat(Cf(i)),t}function df(s){var e=[],t=Ct(s,function(r){return $t(r[Pt])});return e=e.concat(gf(t)),e=e.concat(Tf(t)),e=e.concat(Nf(t)),e=e.concat(Sf(t)),e=e.concat(Ef(t)),e}function pf(s){var e=Ct(s,function(n){return!U(n,Pt)}),t=_(e,function(n){return{message:"Token Type: ->"+n.name+"<- missing static 'PATTERN' property",type:ge.MISSING_PATTERN,tokenTypes:[n]}}),r=Ks(s,e);return{errors:t,valid:r}}function ff(s){var e=Ct(s,function(n){var i=n[Pt];return!$t(i)&&!or(i)&&!U(i,"exec")&&!xt(i)}),t=_(e,function(n){return{message:"Token Type: ->"+n.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:ge.INVALID_PATTERN,tokenTypes:[n]}}),r=Ks(s,e);return{errors:t,valid:r}}var mf=/[^\\][\$]/;function gf(s){var e=function(n){zu(i,n);function i(){var a=n!==null&&n.apply(this,arguments)||this;return a.found=!1,a}return i.prototype.visitEndAnchor=function(a){this.found=!0},i}(bn.BaseRegExpVisitor),t=Ct(s,function(n){var i=n[Pt];try{var a=qs(i),o=new e;return o.visit(a),o.found}catch{return mf.test(i.source)}}),r=_(t,function(n){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+n.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ge.EOI_ANCHOR_FOUND,tokenTypes:[n]}});return r}function Ef(s){var e=Ct(s,function(r){var n=r[Pt];return n.test("")}),t=_(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:ge.EMPTY_MATCH_PATTERN,tokenTypes:[r]}});return t}var Rf=/[^\\[][\^]|^\^/;function Tf(s){var e=function(n){zu(i,n);function i(){var a=n!==null&&n.apply(this,arguments)||this;return a.found=!1,a}return i.prototype.visitStartAnchor=function(a){this.found=!0},i}(bn.BaseRegExpVisitor),t=Ct(s,function(n){var i=n[Pt];try{var a=qs(i),o=new e;return o.visit(a),o.found}catch{return Rf.test(i.source)}}),r=_(t,function(n){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+n.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ge.SOI_ANCHOR_FOUND,tokenTypes:[n]}});return r}function Nf(s){var e=Ct(s,function(r){var n=r[Pt];return n instanceof RegExp&&(n.multiline||n.global)}),t=_(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:ge.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}});return t}function Sf(s){var e=[],t=_(s,function(i){return Le(s,function(a,o){return i.PATTERN.source===o.PATTERN.source&&!Se(e,o)&&o.PATTERN!==$e.NA&&(e.push(o),a.push(o)),a},[])});t=Un(t);var r=Ct(t,function(i){return i.length>1}),n=_(r,function(i){var a=_(i,function(u){return u.name}),o=dt(i).PATTERN;return{message:"The same RegExp pattern ->"+o+"<-"+("has been used in all of the following Token Types: "+a.join(", ")+" <-"),type:ge.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}});return n}function Af(s){var e=Ct(s,function(r){if(!U(r,"GROUP"))return!1;var n=r.GROUP;return n!==$e.SKIPPED&&n!==$e.NA&&!xt(n)}),t=_(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:ge.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}});return t}function yf(s,e){var t=Ct(s,function(n){return n.PUSH_MODE!==void 0&&!Se(e,n.PUSH_MODE)}),r=_(t,function(n){var i="Token Type: ->"+n.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+n.PUSH_MODE+"<-which does not exist";return{message:i,type:ge.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[n]}});return r}function Cf(s){var e=[],t=Le(s,function(r,n,i){var a=n.PATTERN;return a===$e.NA||(xt(a)?r.push({str:a,idx:i,tokenType:n}):$t(a)&&If(a)&&r.push({str:a.source,idx:i,tokenType:n})),r},[]);return b(s,function(r,n){b(t,function(i){var a=i.str,o=i.idx,u=i.tokenType;if(n<o&&vf(a,r.PATTERN)){var l="Token: ->"+u.name+`<- can never be matched.
`+("Because it appears AFTER the Token Type ->"+r.name+"<-")+`in the lexer's definition.
See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:l,type:ge.UNREACHABLE_PATTERN,tokenTypes:[r,u]})}})}),e}function vf(s,e){if($t(e)){var t=e.exec(s);return t!==null&&t.index===0}else{if(or(e))return e(s,0,[],{});if(U(e,"exec"))return e.exec(s,0,[],{});if(typeof e=="string")return e===s;throw Error("non exhaustive match")}}function If(s){var e=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return qr(e,function(t){return s.source.indexOf(t)!==-1})===void 0}function io(s){var e=s.ignoreCase?"i":"";return new RegExp("^(?:"+s.source+")",e)}function ao(s){var e=s.ignoreCase?"iy":"y";return new RegExp(""+s.source,e)}function Of(s,e,t){var r=[];return U(s,Tr)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Tr+`> property in its definition
`,type:ge.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),U(s,Wn)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Wn+`> property in its definition
`,type:ge.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),U(s,Wn)&&U(s,Tr)&&!U(s.modes,s.defaultMode)&&r.push({message:"A MultiMode Lexer cannot be initialized with a "+Tr+": <"+s.defaultMode+`>which does not exist
`,type:ge.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),U(s,Wn)&&b(s.modes,function(n,i){b(n,function(a,o){pt(a)&&r.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+("<"+i+"> at index: <"+o+`>
`),type:ge.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),r}function Mf(s,e,t){var r=[],n=!1,i=Un(Ke(jp(s.modes,function(u){return u}))),a=Ar(i,function(u){return u[Pt]===$e.NA}),o=ju(t);return e&&b(a,function(u){var l=Ku(u,o);if(l!==!1){var c=Ff(u,l),d={message:c,type:l.issue,tokenType:u};r.push(d)}else U(u,"LINE_BREAKS")?u.LINE_BREAKS===!0&&(n=!0):ga(o,u.PATTERN)&&(n=!0)}),e&&!n&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:ge.NO_LINE_BREAKS_FLAGS}),r}function wf(s){var e={},t=Kt(s);return b(t,function(r){var n=s[r];if(At(n))e[r]=[];else throw Error("non exhaustive match")}),e}function $u(s){var e=s.PATTERN;if($t(e))return!1;if(or(e))return!0;if(U(e,"exec"))return!0;if(xt(e))return!1;throw Error("non exhaustive match")}function _f(s){return xt(s)&&s.length===1?s.charCodeAt(0):!1}var Lf={test:function(s){for(var e=s.length,t=this.lastIndex;t<e;t++){var r=s.charCodeAt(t);if(r===10)return this.lastIndex=t+1,!0;if(r===13)return s.charCodeAt(t+1)===10?this.lastIndex=t+2:this.lastIndex=t+1,!0}return!1},lastIndex:0};function Ku(s,e){if(U(s,"LINE_BREAKS"))return!1;if($t(s.PATTERN)){try{ga(e,s.PATTERN)}catch(t){return{issue:ge.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}else{if(xt(s.PATTERN))return!1;if($u(s))return{issue:ge.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function Ff(s,e){if(e.issue===ge.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
`+("	The problem is in the <"+s.name+`> Token Type
`)+("	 Root cause: "+e.errMsg+`.
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(e.issue===ge.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
`+("	The problem is in the <"+s.name+`> Token Type
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function ju(s){var e=_(s,function(t){return xt(t)&&t.length>0?t.charCodeAt(0):t});return e}function Ei(s,e,t){s[e]===void 0?s[e]=[t]:s[e].push(t)}var an=256;function ar(s){return s<an?s:os[s]}var os=[];function Uf(){if(J(os)){os=new Array(65536);for(var s=0;s<65536;s++)os[s]=s>255?255+~~(s/255):s}}function Qs(s,e){var t=s.tokenTypeIdx;return t===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[t]===!0}function ys(s,e){return s.tokenTypeIdx===e.tokenTypeIdx}var oo=1,qu={};function xn(s){var e=bf(s);xf(e),Vf(e),Pf(e),b(e,function(t){t.isParent=t.categoryMatches.length>0})}function bf(s){for(var e=je(s),t=s,r=!0;r;){t=Un(Ke(_(t,function(i){return i.CATEGORIES})));var n=Ks(t,e);e=e.concat(n),J(n)?r=!1:t=n}return e}function xf(s){b(s,function(e){Zu(e)||(qu[oo]=e,e.tokenTypeIdx=oo++),uo(e)&&!At(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),uo(e)||(e.CATEGORIES=[]),Df(e)||(e.categoryMatches=[]),Bf(e)||(e.categoryMatchesMap={})})}function Pf(s){b(s,function(e){e.categoryMatches=[],b(e.categoryMatchesMap,function(t,r){e.categoryMatches.push(qu[r].tokenTypeIdx)})})}function Vf(s){b(s,function(e){Qu([],e)})}function Qu(s,e){b(s,function(t){e.categoryMatchesMap[t.tokenTypeIdx]=!0}),b(e.CATEGORIES,function(t){var r=s.concat(e);Se(r,t)||Qu(r,t)})}function Zu(s){return U(s,"tokenTypeIdx")}function uo(s){return U(s,"CATEGORIES")}function Df(s){return U(s,"categoryMatches")}function Bf(s){return U(s,"categoryMatchesMap")}function kf(s){return U(s,"tokenTypeIdx")}var Gf={buildUnableToPopLexerModeMessage:function(s){return"Unable to pop Lexer Mode after encountering Token ->"+s.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(s,e,t,r,n){return"unexpected character: ->"+s.charAt(e)+"<- at offset: "+e+","+(" skipped "+t+" characters.")}},ge;(function(s){s[s.MISSING_PATTERN=0]="MISSING_PATTERN",s[s.INVALID_PATTERN=1]="INVALID_PATTERN",s[s.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",s[s.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",s[s.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",s[s.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",s[s.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",s[s.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",s[s.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",s[s.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",s[s.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",s[s.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",s[s.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",s[s.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",s[s.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",s[s.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",s[s.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"})(ge||(ge={}));var on={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:Gf,traceInitPerf:!1,skipValidations:!1};Object.freeze(on);var $e=function(){function s(e,t){var r=this;if(t===void 0&&(t=on),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},typeof t=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=eo(on,t);var n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var i,a=!0;r.TRACE_INIT("Lexer Config handling",function(){if(r.config.lineTerminatorsPattern===on.lineTerminatorsPattern)r.config.lineTerminatorsPattern=Lf;else if(r.config.lineTerminatorCharacters===on.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');r.trackStartLines=/full|onlyStart/i.test(r.config.positionTracking),r.trackEndLines=/full/i.test(r.config.positionTracking),At(e)?(i={modes:{}},i.modes[Tr]=je(e),i[Tr]=Tr):(a=!1,i=Fn(e))}),r.config.skipValidations===!1&&(r.TRACE_INIT("performRuntimeChecks",function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(Of(i,r.trackStartLines,r.config.lineTerminatorCharacters))}),r.TRACE_INIT("performWarningRuntimeChecks",function(){r.lexerDefinitionWarning=r.lexerDefinitionWarning.concat(Mf(i,r.trackStartLines,r.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},b(i.modes,function(c,d){i.modes[d]=Ar(c,function(f){return pt(f)})});var o=Kt(i.modes);if(b(i.modes,function(c,d){r.TRACE_INIT("Mode: <"+d+"> processing",function(){if(r.modes.push(d),r.config.skipValidations===!1&&r.TRACE_INIT("validatePatterns",function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(cf(c,o))}),J(r.lexerDefinitionErrors)){xn(c);var f;r.TRACE_INIT("analyzeTokenTypes",function(){f=lf(c,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:r.TRACE_INIT.bind(r)})}),r.patternIdxToConfig[d]=f.patternIdxToConfig,r.charCodeToPatternIdxToConfig[d]=f.charCodeToPatternIdxToConfig,r.emptyGroups=eo(r.emptyGroups,f.emptyGroups),r.hasCustom=f.hasCustom||r.hasCustom,r.canModeBeOptimized[d]=f.canBeOptimized}})}),r.defaultMode=i.defaultMode,!J(r.lexerDefinitionErrors)&&!r.config.deferDefinitionErrorsHandling){var u=_(r.lexerDefinitionErrors,function(c){return c.message}),l=u.join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+l)}b(r.lexerDefinitionWarning,function(c){ma(c.message)}),r.TRACE_INIT("Choosing sub-methods implementations",function(){if(Xu?(r.chopInput=to,r.match=r.matchWithTest):(r.updateLastIndex=Ae,r.match=r.matchWithExec),a&&(r.handleModes=Ae),r.trackStartLines===!1&&(r.computeNewColumn=to),r.trackEndLines===!1&&(r.updateTokenEndLineColumnLocation=Ae),/full/i.test(r.config.positionTracking))r.createTokenInstance=r.createFullToken;else if(/onlyStart/i.test(r.config.positionTracking))r.createTokenInstance=r.createStartOnlyToken;else if(/onlyOffset/i.test(r.config.positionTracking))r.createTokenInstance=r.createOffsetOnlyToken;else throw Error('Invalid <positionTracking> config option: "'+r.config.positionTracking+'"');r.hasCustom?(r.addToken=r.addTokenUsingPush,r.handlePayload=r.handlePayloadWithCustom):(r.addToken=r.addTokenUsingMemberAccess,r.handlePayload=r.handlePayloadNoCustom)}),r.TRACE_INIT("Failed Optimization Warnings",function(){var c=Le(r.canModeBeOptimized,function(d,f,E){return f===!1&&d.push(E),d},[]);if(t.ensureOptimizations&&!J(c))throw Error("Lexer Modes: < "+c.join(", ")+` > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),r.TRACE_INIT("clearRegExpParserCache",function(){sf()}),r.TRACE_INIT("toFastProperties",function(){Hu(r)})})}return s.prototype.tokenize=function(e,t){if(t===void 0&&(t=this.defaultMode),!J(this.lexerDefinitionErrors)){var r=_(this.lexerDefinitionErrors,function(a){return a.message}),n=r.join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+n)}var i=this.tokenizeInternal(e,t);return i},s.prototype.tokenizeInternal=function(e,t){var r=this,n,i,a,o,u,l,c,d,f,E,N,R,A,S,y=e,C=y.length,O=0,te=0,j=this.hasCustom?0:Math.floor(e.length/10),q=new Array(j),Ee=[],re=this.trackStartLines?1:void 0,ne=this.trackStartLines?1:void 0,X=wf(this.emptyGroups),at=this.trackStartLines,xe=this.config.lineTerminatorsPattern,ot=0,ke=[],Pe=[],Mr=[],Vn=[];Object.freeze(Vn);var cr=void 0;function Dn(){return ke}function Bn(Ve){var nn=ar(Ve),wr=Pe[nn];return wr===void 0?Vn:wr}var ii=function(Ve){if(Mr.length===1&&Ve.tokenType.PUSH_MODE===void 0){var nn=r.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ve);Ee.push({offset:Ve.startOffset,line:Ve.startLine!==void 0?Ve.startLine:void 0,column:Ve.startColumn!==void 0?Ve.startColumn:void 0,length:Ve.image.length,message:nn})}else{Mr.pop();var wr=Bu(Mr);ke=r.patternIdxToConfig[wr],Pe=r.charCodeToPatternIdxToConfig[wr],ot=ke.length;var Fc=r.canModeBeOptimized[wr]&&r.config.safeMode===!1;Pe&&Fc?cr=Bn:cr=Dn}};function kn(Ve){Mr.push(Ve),Pe=this.charCodeToPatternIdxToConfig[Ve],ke=this.patternIdxToConfig[Ve],ot=ke.length,ot=ke.length;var nn=this.canModeBeOptimized[Ve]&&this.config.safeMode===!1;Pe&&nn?cr=Bn:cr=Dn}kn.call(this,t);for(var Qe;O<C;){u=null;var $a=y.charCodeAt(O),Ka=cr($a),Lc=Ka.length;for(n=0;n<Lc;n++){Qe=Ka[n];var qt=Qe.pattern;l=null;var tn=Qe.short;if(tn!==!1?$a===tn&&(u=qt):Qe.isCustom===!0?(S=qt.exec(y,O,q,X),S!==null?(u=S[0],S.payload!==void 0&&(l=S.payload)):u=null):(this.updateLastIndex(qt,O),u=this.match(qt,e,O)),u!==null){if(o=Qe.longerAlt,o!==void 0){var ai=ke[o],oi=ai.pattern;c=null,ai.isCustom===!0?(S=oi.exec(y,O,q,X),S!==null?(a=S[0],S.payload!==void 0&&(c=S.payload)):a=null):(this.updateLastIndex(oi,O),a=this.match(oi,e,O)),a&&a.length>u.length&&(u=a,l=c,Qe=ai)}break}}if(u!==null){if(d=u.length,f=Qe.group,f!==void 0&&(E=Qe.tokenTypeIdx,N=this.createTokenInstance(u,O,E,Qe.tokenType,re,ne,d),this.handlePayload(N,l),f===!1?te=this.addToken(q,te,N):X[f].push(N)),e=this.chopInput(e,d),O=O+d,ne=this.computeNewColumn(ne,d),at===!0&&Qe.canLineTerminator===!0){var Gn=0,ui=void 0,hi=void 0;xe.lastIndex=0;do ui=xe.test(u),ui===!0&&(hi=xe.lastIndex-1,Gn++);while(ui===!0);Gn!==0&&(re=re+Gn,ne=d-hi,this.updateTokenEndLineColumnLocation(N,f,hi,Gn,re,ne,d))}this.handleModes(Qe,ii,kn,N)}else{for(var li=O,ja=re,qa=ne,rn=!1;!rn&&O<C;)for(y.charCodeAt(O),e=this.chopInput(e,1),O++,i=0;i<ot;i++){var ci=ke[i],qt=ci.pattern,tn=ci.short;if(tn!==!1?y.charCodeAt(O)===tn&&(rn=!0):ci.isCustom===!0?rn=qt.exec(y,O,q,X)!==null:(this.updateLastIndex(qt,O),rn=qt.exec(e)!==null),rn===!0)break}R=O-li,A=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(y,li,R,ja,qa),Ee.push({offset:li,line:ja,column:qa,length:R,message:A})}}return this.hasCustom||(q.length=te),{tokens:q,groups:X,errors:Ee}},s.prototype.handleModes=function(e,t,r,n){if(e.pop===!0){var i=e.push;t(n),i!==void 0&&r.call(this,i)}else e.push!==void 0&&r.call(this,e.push)},s.prototype.chopInput=function(e,t){return e.substring(t)},s.prototype.updateLastIndex=function(e,t){e.lastIndex=t},s.prototype.updateTokenEndLineColumnLocation=function(e,t,r,n,i,a,o){var u,l;t!==void 0&&(u=r===o-1,l=u?-1:0,n===1&&u===!0||(e.endLine=i+l,e.endColumn=a-1+-l))},s.prototype.computeNewColumn=function(e,t){return e+t},s.prototype.createTokenInstance=function(){return null},s.prototype.createOffsetOnlyToken=function(e,t,r,n){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:n}},s.prototype.createStartOnlyToken=function(e,t,r,n,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:r,tokenType:n}},s.prototype.createFullToken=function(e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:n}},s.prototype.addToken=function(e,t,r){return 666},s.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},s.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,t++,t},s.prototype.handlePayload=function(e,t){},s.prototype.handlePayloadNoCustom=function(e,t){},s.prototype.handlePayloadWithCustom=function(e,t){t!==null&&(e.payload=t)},s.prototype.match=function(e,t,r){return null},s.prototype.matchWithTest=function(e,t,r){var n=e.test(t);return n===!0?t.substring(r,e.lastIndex):null},s.prototype.matchWithExec=function(e,t){var r=e.exec(t);return r!==null?r[0]:r},s.prototype.TRACE_INIT=function(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--> <"+e+">");var n=Wu(t),i=n.time,a=n.value,o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(r+"<-- <"+e+"> time: "+i+"ms"),this.traceInitIndent--,a}else return t()},s.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",s.NA=/NOT_APPLICABLE/,s}();function Yr(s){return Ju(s)?s.LABEL:s.name}function Ju(s){return xt(s.LABEL)&&s.LABEL!==""}var Hf="parent",ho="categories",lo="label",co="group",po="push_mode",fo="pop_mode",mo="longer_alt",go="line_breaks",Eo="start_chars_hint";function H(s){return Wf(s)}function Wf(s){var e=s.pattern,t={};if(t.name=s.name,pt(e)||(t.PATTERN=e),U(s,Hf))throw`The parent property is no longer supported.
See: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.`;return U(s,ho)&&(t.CATEGORIES=s[ho]),xn([t]),U(s,lo)&&(t.LABEL=s[lo]),U(s,co)&&(t.GROUP=s[co]),U(s,fo)&&(t.POP_MODE=s[fo]),U(s,po)&&(t.PUSH_MODE=s[po]),U(s,mo)&&(t.LONGER_ALT=s[mo]),U(s,go)&&(t.LINE_BREAKS=s[go]),U(s,Eo)&&(t.START_CHARS_HINT=s[Eo]),t}var yr=H({name:"EOF",pattern:$e.NA});xn([yr]);function Ea(s,e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:r,startLine:n,endLine:i,startColumn:a,endColumn:o,tokenTypeIdx:s.tokenTypeIdx,tokenType:s}}function Q(s,e){return Qs(s,e)}var jt=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Vt=function(){function s(e){this.definition=e}return s.prototype.accept=function(e){e.visit(this),b(this.definition,function(t){t.accept(e)})},s}(),nt=function(s){jt(e,s);function e(t){var r=s.call(this,[])||this;return r.idx=1,vt(r,gt(t,function(n){return n!==void 0})),r}return Object.defineProperty(e.prototype,"definition",{get:function(){return this.referencedRule!==void 0?this.referencedRule.definition:[]},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.accept=function(t){t.visit(this)},e}(Vt),en=function(s){jt(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.orgText="",vt(r,gt(t,function(n){return n!==void 0})),r}return e}(Vt),qe=function(s){jt(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.ignoreAmbiguities=!1,vt(r,gt(t,function(n){return n!==void 0})),r}return e}(Vt),_e=function(s){jt(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,vt(r,gt(t,function(n){return n!==void 0})),r}return e}(Vt),ft=function(s){jt(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,vt(r,gt(t,function(n){return n!==void 0})),r}return e}(Vt),mt=function(s){jt(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,vt(r,gt(t,function(n){return n!==void 0})),r}return e}(Vt),me=function(s){jt(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,vt(r,gt(t,function(n){return n!==void 0})),r}return e}(Vt),st=function(s){jt(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,vt(r,gt(t,function(n){return n!==void 0})),r}return e}(Vt),it=function(s){jt(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,r.ignoreAmbiguities=!1,r.hasPredicates=!1,vt(r,gt(t,function(n){return n!==void 0})),r}return e}(Vt),oe=function(){function s(e){this.idx=1,vt(this,gt(e,function(t){return t!==void 0}))}return s.prototype.accept=function(e){e.visit(this)},s}();function Yf(s){return _(s,us)}function us(s){function e(n){return _(n,us)}if(s instanceof nt)return{type:"NonTerminal",name:s.nonTerminalName,idx:s.idx};if(s instanceof qe)return{type:"Flat",definition:e(s.definition)};if(s instanceof _e)return{type:"Option",idx:s.idx,definition:e(s.definition)};if(s instanceof ft)return{type:"RepetitionMandatory",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof mt)return{type:"RepetitionMandatoryWithSeparator",name:s.name,idx:s.idx,separator:us(new oe({terminalType:s.separator})),definition:e(s.definition)};if(s instanceof st)return{type:"RepetitionWithSeparator",name:s.name,idx:s.idx,separator:us(new oe({terminalType:s.separator})),definition:e(s.definition)};if(s instanceof me)return{type:"Repetition",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof it)return{type:"Alternation",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof oe){var t={type:"Terminal",name:s.terminalType.name,label:Yr(s.terminalType),idx:s.idx},r=s.terminalType.PATTERN;return s.terminalType.PATTERN&&(t.pattern=$t(r)?r.source:r),t}else{if(s instanceof en)return{type:"Rule",name:s.name,orgText:s.orgText,definition:e(s.definition)};throw Error("non exhaustive match")}}var Zs=function(){function s(){}return s.prototype.walk=function(e,t){var r=this;t===void 0&&(t=[]),b(e.definition,function(n,i){var a=we(e.definition,i+1);if(n instanceof nt)r.walkProdRef(n,a,t);else if(n instanceof oe)r.walkTerminal(n,a,t);else if(n instanceof qe)r.walkFlat(n,a,t);else if(n instanceof _e)r.walkOption(n,a,t);else if(n instanceof ft)r.walkAtLeastOne(n,a,t);else if(n instanceof mt)r.walkAtLeastOneSep(n,a,t);else if(n instanceof st)r.walkManySep(n,a,t);else if(n instanceof me)r.walkMany(n,a,t);else if(n instanceof it)r.walkOr(n,a,t);else throw Error("non exhaustive match")})},s.prototype.walkTerminal=function(e,t,r){},s.prototype.walkProdRef=function(e,t,r){},s.prototype.walkFlat=function(e,t,r){var n=t.concat(r);this.walk(e,n)},s.prototype.walkOption=function(e,t,r){var n=t.concat(r);this.walk(e,n)},s.prototype.walkAtLeastOne=function(e,t,r){var n=[new _e({definition:e.definition})].concat(t,r);this.walk(e,n)},s.prototype.walkAtLeastOneSep=function(e,t,r){var n=Ro(e,t,r);this.walk(e,n)},s.prototype.walkMany=function(e,t,r){var n=[new _e({definition:e.definition})].concat(t,r);this.walk(e,n)},s.prototype.walkManySep=function(e,t,r){var n=Ro(e,t,r);this.walk(e,n)},s.prototype.walkOr=function(e,t,r){var n=this,i=t.concat(r);b(e.definition,function(a){var o=new qe({definition:[a]});n.walk(o,i)})},s}();function Ro(s,e,t){var r=[new _e({definition:[new oe({terminalType:s.separator})].concat(s.definition)})],n=r.concat(e,t);return n}var Ir=function(){function s(){}return s.prototype.visit=function(e){var t=e;switch(t.constructor){case nt:return this.visitNonTerminal(t);case qe:return this.visitFlat(t);case _e:return this.visitOption(t);case ft:return this.visitRepetitionMandatory(t);case mt:return this.visitRepetitionMandatoryWithSeparator(t);case st:return this.visitRepetitionWithSeparator(t);case me:return this.visitRepetition(t);case it:return this.visitAlternation(t);case oe:return this.visitTerminal(t);case en:return this.visitRule(t);default:throw Error("non exhaustive match")}},s.prototype.visitNonTerminal=function(e){},s.prototype.visitFlat=function(e){},s.prototype.visitOption=function(e){},s.prototype.visitRepetition=function(e){},s.prototype.visitRepetitionMandatory=function(e){},s.prototype.visitRepetitionMandatoryWithSeparator=function(e){},s.prototype.visitRepetitionWithSeparator=function(e){},s.prototype.visitAlternation=function(e){},s.prototype.visitTerminal=function(e){},s.prototype.visitRule=function(e){},s}(),zf=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function Xf(s){return s instanceof qe||s instanceof _e||s instanceof me||s instanceof ft||s instanceof mt||s instanceof st||s instanceof oe||s instanceof en}function Cs(s,e){e===void 0&&(e=[]);var t=s instanceof _e||s instanceof me||s instanceof st;return t?!0:s instanceof it?ku(s.definition,function(r){return Cs(r,e)}):s instanceof nt&&Se(e,s)?!1:s instanceof Vt?(s instanceof nt&&e.push(s),ct(s.definition,function(r){return Cs(r,e)})):!1}function $f(s){return s instanceof it}function Tt(s){if(s instanceof nt)return"SUBRULE";if(s instanceof _e)return"OPTION";if(s instanceof it)return"OR";if(s instanceof ft)return"AT_LEAST_ONE";if(s instanceof mt)return"AT_LEAST_ONE_SEP";if(s instanceof st)return"MANY_SEP";if(s instanceof me)return"MANY";if(s instanceof oe)return"CONSUME";throw Error("non exhaustive match")}var Kf=function(s){zf(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return e.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},e.prototype.visitTerminal=function(t){var r=t.terminalType.name+this.separator+"Terminal";U(this.dslMethods,r)||(this.dslMethods[r]=[]),this.dslMethods[r].push(t)},e.prototype.visitNonTerminal=function(t){var r=t.nonTerminalName+this.separator+"Terminal";U(this.dslMethods,r)||(this.dslMethods[r]=[]),this.dslMethods[r].push(t)},e.prototype.visitOption=function(t){this.dslMethods.option.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.dslMethods.repetitionWithSeparator.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.dslMethods.repetitionMandatory.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)},e.prototype.visitRepetition=function(t){this.dslMethods.repetition.push(t)},e.prototype.visitAlternation=function(t){this.dslMethods.alternation.push(t)},e}(Ir),Yn=new Kf;function jf(s){Yn.reset(),s.accept(Yn);var e=Yn.dslMethods;return Yn.reset(),e}function Pn(s){if(s instanceof nt)return Pn(s.referencedRule);if(s instanceof oe)return Zf(s);if(Xf(s))return qf(s);if($f(s))return Qf(s);throw Error("non exhaustive match")}function qf(s){for(var e=[],t=s.definition,r=0,n=t.length>r,i,a=!0;n&&a;)i=t[r],a=Cs(i),e=e.concat(Pn(i)),r=r+1,n=t.length>r;return pa(e)}function Qf(s){var e=_(s.definition,function(t){return Pn(t)});return pa(Ke(e))}function Zf(s){return[s.terminalType]}var eh="_~IN~_",Jf=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),em=function(s){Jf(e,s);function e(t){var r=s.call(this)||this;return r.topProd=t,r.follows={},r}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},e.prototype.walkTerminal=function(t,r,n){},e.prototype.walkProdRef=function(t,r,n){var i=rm(t.referencedRule,t.idx)+this.topProd.name,a=r.concat(n),o=new qe({definition:a}),u=Pn(o);this.follows[i]=u},e}(Zs);function tm(s){var e={};return b(s,function(t){var r=new em(t).startWalking();vt(e,r)}),e}function rm(s,e){return s.name+e+eh}var nm=4,ur=8,sm=8,zr=1<<ur,vs=2<<ur,cn=3<<ur,dn=4<<ur,pn=5<<ur,kr=6<<ur;function fn(s,e,t){return t|e|s}var im=32-sm;function th(s,e,t,r){var n=r+1<<im;return fn(s,e,t)|n}var am=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function To(s,e){isNaN(s.startOffset)===!0?(s.startOffset=e.startOffset,s.endOffset=e.endOffset):s.endOffset<e.endOffset&&(s.endOffset=e.endOffset)}function No(s,e){isNaN(s.startOffset)===!0?(s.startOffset=e.startOffset,s.startColumn=e.startColumn,s.startLine=e.startLine,s.endOffset=e.endOffset,s.endColumn=e.endColumn,s.endLine=e.endLine):s.endOffset<e.endOffset&&(s.endOffset=e.endOffset,s.endColumn=e.endColumn,s.endLine=e.endLine)}function om(s,e,t){s.children[t]===void 0?s.children[t]=[e]:s.children[t].push(e)}function So(s,e,t){s.children[e]===void 0?s.children[e]=[t]:s.children[e].push(t)}var Ra=function(s){am(e,s);function e(t){var r=s.call(this)||this;return r.result=[],r.ruleIdx=t,r}return e.prototype.collectNamedDSLMethod=function(t,r,n){if(!pt(t.name)){var i=void 0;if(t instanceof _e||t instanceof me||t instanceof ft||t instanceof it)i=new r({definition:t.definition,idx:t.idx});else if(t instanceof mt||t instanceof st)i=new r({definition:t.definition,idx:t.idx,separator:t.separator});else throw Error("non exhaustive match");var a=[i],o=fn(this.ruleIdx,n,t.idx);this.result.push({def:a,key:o,name:t.name,orgProd:t})}},e.prototype.visitOption=function(t){this.collectNamedDSLMethod(t,_e,vs)},e.prototype.visitRepetition=function(t){this.collectNamedDSLMethod(t,me,cn)},e.prototype.visitRepetitionMandatory=function(t){this.collectNamedDSLMethod(t,ft,dn)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.collectNamedDSLMethod(t,mt,kr)},e.prototype.visitRepetitionWithSeparator=function(t){this.collectNamedDSLMethod(t,st,pn)},e.prototype.visitAlternation=function(t){var r=this;this.collectNamedDSLMethod(t,it,zr);var n=t.definition.length>1;b(t.definition,function(i,a){if(!pt(i.name)){var o=i.definition;n?o=[new _e({definition:i.definition})]:o=i.definition;var u=th(r.ruleIdx,zr,t.idx,a);r.result.push({def:o,key:u,name:i.name,orgProd:i})}})},e}(Ir);function um(s,e){var t={allRuleNames:[]};return b(s,function(r){var n=e[r.name];t.allRuleNames.push(r.name);var i=new Ra(n);r.accept(i),b(i.result,function(a){a.def,a.key;var o=a.name;t.allRuleNames.push(r.name+o)})}),t}var Or=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),hm=function(s){Or(e,s);function e(t,r){var n=s.call(this)||this;return n.topProd=t,n.path=r,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}return e.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=je(this.path.ruleStack).reverse(),this.occurrenceStack=je(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},e.prototype.walk=function(t,r){r===void 0&&(r=[]),this.found||s.prototype.walk.call(this,t,r)},e.prototype.walkProdRef=function(t,r,n){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){var i=r.concat(n);this.updateExpectedNext(),this.walk(t.referencedRule,i)}},e.prototype.updateExpectedNext=function(){J(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},e}(Zs),lm=function(s){Or(e,s);function e(t,r){var n=s.call(this,t,r)||this;return n.path=r,n.nextTerminalName="",n.nextTerminalOccurrence=0,n.nextTerminalName=n.path.lastTok.name,n.nextTerminalOccurrence=n.path.lastTokOccurrence,n}return e.prototype.walkTerminal=function(t,r,n){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){var i=r.concat(n),a=new qe({definition:i});this.possibleTokTypes=Pn(a),this.found=!0}},e}(hm),Js=function(s){Or(e,s);function e(t,r){var n=s.call(this)||this;return n.topRule=t,n.occurrence=r,n.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},n}return e.prototype.startWalking=function(){return this.walk(this.topRule),this.result},e}(Zs),cm=function(s){Or(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkMany=function(t,r,n){if(t.idx===this.occurrence){var i=dt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof oe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkMany.call(this,t,r,n)},e}(Js),Ao=function(s){Or(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkManySep=function(t,r,n){if(t.idx===this.occurrence){var i=dt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof oe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkManySep.call(this,t,r,n)},e}(Js),dm=function(s){Or(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkAtLeastOne=function(t,r,n){if(t.idx===this.occurrence){var i=dt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof oe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkAtLeastOne.call(this,t,r,n)},e}(Js),yo=function(s){Or(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkAtLeastOneSep=function(t,r,n){if(t.idx===this.occurrence){var i=dt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof oe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkAtLeastOneSep.call(this,t,r,n)},e}(Js);function Pi(s,e,t){t===void 0&&(t=[]),t=je(t);var r=[],n=0;function i(l){return l.concat(we(s,n+1))}function a(l){var c=Pi(i(l),e,t);return r.concat(c)}for(;t.length<e&&n<s.length;){var o=s[n];if(o instanceof qe)return a(o.definition);if(o instanceof nt)return a(o.definition);if(o instanceof _e)r=a(o.definition);else if(o instanceof ft){var u=o.definition.concat([new me({definition:o.definition})]);return a(u)}else if(o instanceof mt){var u=[new qe({definition:o.definition}),new me({definition:[new oe({terminalType:o.separator})].concat(o.definition)})];return a(u)}else if(o instanceof st){var u=o.definition.concat([new me({definition:[new oe({terminalType:o.separator})].concat(o.definition)})]);r=a(u)}else if(o instanceof me){var u=o.definition.concat([new me({definition:o.definition})]);r=a(u)}else{if(o instanceof it)return b(o.definition,function(l){r=a(l.definition)}),r;if(o instanceof oe)t.push(o.terminalType);else throw Error("non exhaustive match")}n++}return r.push({partialPath:t,suffixDef:we(s,n)}),r}function rh(s,e,t,r){var n="EXIT_NONE_TERMINAL",i=[n],a="EXIT_ALTERNATIVE",o=!1,u=e.length,l=u-r-1,c=[],d=[];for(d.push({idx:-1,def:s,ruleStack:[],occurrenceStack:[]});!J(d);){var f=d.pop();if(f===a){o&&Bu(d).idx<=l&&d.pop();continue}var E=f.def,N=f.idx,R=f.ruleStack,A=f.occurrenceStack;if(!J(E)){var S=E[0];if(S===n){var y={idx:N,def:we(E),ruleStack:Sn(R),occurrenceStack:Sn(A)};d.push(y)}else if(S instanceof oe)if(N<u-1){var C=N+1,O=e[C];if(t(O,S.terminalType)){var y={idx:C,def:we(E),ruleStack:R,occurrenceStack:A};d.push(y)}}else if(N===u-1)c.push({nextTokenType:S.terminalType,nextTokenOccurrence:S.idx,ruleStack:R,occurrenceStack:A}),o=!0;else throw Error("non exhaustive match");else if(S instanceof nt){var te=je(R);te.push(S.nonTerminalName);var j=je(A);j.push(S.idx);var y={idx:N,def:S.definition.concat(i,we(E)),ruleStack:te,occurrenceStack:j};d.push(y)}else if(S instanceof _e){var q={idx:N,def:we(E),ruleStack:R,occurrenceStack:A};d.push(q),d.push(a);var Ee={idx:N,def:S.definition.concat(we(E)),ruleStack:R,occurrenceStack:A};d.push(Ee)}else if(S instanceof ft){var re=new me({definition:S.definition,idx:S.idx}),ne=S.definition.concat([re],we(E)),y={idx:N,def:ne,ruleStack:R,occurrenceStack:A};d.push(y)}else if(S instanceof mt){var X=new oe({terminalType:S.separator}),re=new me({definition:[X].concat(S.definition),idx:S.idx}),ne=S.definition.concat([re],we(E)),y={idx:N,def:ne,ruleStack:R,occurrenceStack:A};d.push(y)}else if(S instanceof st){var q={idx:N,def:we(E),ruleStack:R,occurrenceStack:A};d.push(q),d.push(a);var X=new oe({terminalType:S.separator}),at=new me({definition:[X].concat(S.definition),idx:S.idx}),ne=S.definition.concat([at],we(E)),Ee={idx:N,def:ne,ruleStack:R,occurrenceStack:A};d.push(Ee)}else if(S instanceof me){var q={idx:N,def:we(E),ruleStack:R,occurrenceStack:A};d.push(q),d.push(a);var at=new me({definition:S.definition,idx:S.idx}),ne=S.definition.concat([at],we(E)),Ee={idx:N,def:ne,ruleStack:R,occurrenceStack:A};d.push(Ee)}else if(S instanceof it)for(var xe=S.definition.length-1;xe>=0;xe--){var ot=S.definition[xe],ke={idx:N,def:ot.definition.concat(we(E)),ruleStack:R,occurrenceStack:A};d.push(ke),d.push(a)}else if(S instanceof qe)d.push({idx:N,def:S.definition.concat(we(E)),ruleStack:R,occurrenceStack:A});else if(S instanceof en)d.push(pm(S,N,R,A));else throw Error("non exhaustive match")}}return c}function pm(s,e,t,r){var n=je(t);n.push(s.name);var i=je(r);return i.push(1),{idx:e,def:s.definition,ruleStack:n,occurrenceStack:i}}var nh=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ee;(function(s){s[s.OPTION=0]="OPTION",s[s.REPETITION=1]="REPETITION",s[s.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",s[s.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",s[s.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",s[s.ALTERNATION=5]="ALTERNATION"})(ee||(ee={}));function fm(s){if(s instanceof _e)return ee.OPTION;if(s instanceof me)return ee.REPETITION;if(s instanceof ft)return ee.REPETITION_MANDATORY;if(s instanceof mt)return ee.REPETITION_MANDATORY_WITH_SEPARATOR;if(s instanceof st)return ee.REPETITION_WITH_SEPARATOR;if(s instanceof it)return ee.ALTERNATION;throw Error("non exhaustive match")}function mm(s,e,t,r,n,i){var a=Ta(s,e,t),o=ah(a)?ys:Qs;return i(a,r,o,n)}function gm(s,e,t,r,n,i){var a=Na(s,e,n,t),o=ah(a)?ys:Qs;return i(a[0],o,r)}function Em(s,e,t,r){var n=s.length,i=ct(s,function(u){return ct(u,function(l){return l.length===1})});if(e)return function(u){for(var l=_(u,function(C){return C.GATE}),c=0;c<n;c++){var d=s[c],f=d.length,E=l[c];if(!(E!==void 0&&E.call(this)===!1))e:for(var N=0;N<f;N++){for(var R=d[N],A=R.length,S=0;S<A;S++){var y=this.LA(S+1);if(t(y,R[S])===!1)continue e}return c}}};if(i&&!r){var a=_(s,function(u){return Ke(u)}),o=Le(a,function(u,l,c){return b(l,function(d){U(u,d.tokenTypeIdx)||(u[d.tokenTypeIdx]=c),b(d.categoryMatches,function(f){U(u,f)||(u[f]=c)})}),u},[]);return function(){var u=this.LA(1);return o[u.tokenTypeIdx]}}else return function(){for(var u=0;u<n;u++){var l=s[u],c=l.length;e:for(var d=0;d<c;d++){for(var f=l[d],E=f.length,N=0;N<E;N++){var R=this.LA(N+1);if(t(R,f[N])===!1)continue e}return u}}}}function Rm(s,e,t){var r=ct(s,function(l){return l.length===1}),n=s.length;if(r&&!t){var i=Ke(s);if(i.length===1&&J(i[0].categoryMatches)){var a=i[0],o=a.tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===o}}else{var u=Le(i,function(l,c,d){return l[c.tokenTypeIdx]=!0,b(c.categoryMatches,function(f){l[f]=!0}),l},[]);return function(){var l=this.LA(1);return u[l.tokenTypeIdx]===!0}}}else return function(){e:for(var l=0;l<n;l++){for(var c=s[l],d=c.length,f=0;f<d;f++){var E=this.LA(f+1);if(e(E,c[f])===!1)continue e}return!0}return!1}}var Tm=function(s){nh(e,s);function e(t,r,n){var i=s.call(this)||this;return i.topProd=t,i.targetOccurrence=r,i.targetProdType=n,i}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},e.prototype.checkIsTarget=function(t,r,n,i){return t.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1},e.prototype.walkOption=function(t,r,n){this.checkIsTarget(t,ee.OPTION,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkAtLeastOne=function(t,r,n){this.checkIsTarget(t,ee.REPETITION_MANDATORY,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkAtLeastOneSep=function(t,r,n){this.checkIsTarget(t,ee.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkMany=function(t,r,n){this.checkIsTarget(t,ee.REPETITION,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkManySep=function(t,r,n){this.checkIsTarget(t,ee.REPETITION_WITH_SEPARATOR,r,n)||s.prototype.walkOption.call(this,t,r,n)},e}(Zs),sh=function(s){nh(e,s);function e(t,r,n){var i=s.call(this)||this;return i.targetOccurrence=t,i.targetProdType=r,i.targetRef=n,i.result=[],i}return e.prototype.checkIsTarget=function(t,r){t.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)},e.prototype.visitOption=function(t){this.checkIsTarget(t,ee.OPTION)},e.prototype.visitRepetition=function(t){this.checkIsTarget(t,ee.REPETITION)},e.prototype.visitRepetitionMandatory=function(t){this.checkIsTarget(t,ee.REPETITION_MANDATORY)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.checkIsTarget(t,ee.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.visitRepetitionWithSeparator=function(t){this.checkIsTarget(t,ee.REPETITION_WITH_SEPARATOR)},e.prototype.visitAlternation=function(t){this.checkIsTarget(t,ee.ALTERNATION)},e}(Ir);function Co(s){for(var e=new Array(s),t=0;t<s;t++)e[t]=[];return e}function Ri(s){for(var e=[""],t=0;t<s.length;t++){for(var r=s[t],n=[],i=0;i<e.length;i++){var a=e[i];n.push(a+"_"+r.tokenTypeIdx);for(var o=0;o<r.categoryMatches.length;o++){var u="_"+r.categoryMatches[o];n.push(a+u)}}e=n}return e}function Nm(s,e,t){for(var r=0;r<s.length;r++)if(r!==t)for(var n=s[r],i=0;i<e.length;i++){var a=e[i];if(n[a]===!0)return!1}return!0}function ih(s,e){for(var t=_(s,function(c){return Pi([c],1)}),r=Co(t.length),n=_(t,function(c){var d={};return b(c,function(f){var E=Ri(f.partialPath);b(E,function(N){d[N]=!0})}),d}),i=t,a=1;a<=e;a++){var o=i;i=Co(o.length);for(var u=function(c){for(var d=o[c],f=0;f<d.length;f++){var E=d[f].partialPath,N=d[f].suffixDef,R=Ri(E),A=Nm(n,R,c);if(A||J(N)||E.length===e){var S=r[c];if(Vi(S,E)===!1){S.push(E);for(var y=0;y<R.length;y++){var C=R[y];n[c][C]=!0}}}else{var O=Pi(N,a+1,E);i[c]=i[c].concat(O),b(O,function(te){var j=Ri(te.partialPath);b(j,function(q){n[c][q]=!0})})}}},l=0;l<o.length;l++)u(l)}return r}function Ta(s,e,t,r){var n=new sh(s,ee.ALTERNATION,r);return e.accept(n),ih(n.result,t)}function Na(s,e,t,r){var n=new sh(s,t);e.accept(n);var i=n.result,a=new Tm(e,s,t),o=a.startWalking(),u=new qe({definition:i}),l=new qe({definition:o});return ih([u,l],r)}function Vi(s,e){e:for(var t=0;t<s.length;t++){var r=s[t];if(r.length===e.length){for(var n=0;n<r.length;n++){var i=e[n],a=r[n],o=i===a||a.categoryMatchesMap[i.tokenTypeIdx]!==void 0;if(o===!1)continue e}return!0}}return!1}function Sm(s,e){return s.length<e.length&&ct(s,function(t,r){var n=e[r];return t===n||n.categoryMatchesMap[t.tokenTypeIdx]})}function ah(s){return ct(s,function(e){return ct(e,function(t){return ct(t,function(r){return J(r.categoryMatches)})})})}var Sa=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function Am(s,e,t,r,n,i){var a=_(s,function(y){return Cm(y,n)}),o=_(s,function(y){return hh(y,y,n)}),u=[],l=[],c=[];ct(o,J)&&(u=_(s,function(y){return Fm(y,n)}),l=_(s,function(y){return Um(y,e,r,n)}),c=Pm(s,e,n));var d=Bm(s,t,n),f=_(t,function(y){return wm(y,n)}),E=ym(s,n),N=km(s,n),R=_(s,function(y){return xm(y,n)}),A=_(s,function(y){return Om(y,n)}),S=_(s,function(y){return _m(y,s,i,n)});return Ke(a.concat(f,E,N,c,o,u,l,d,R,A,S))}function ym(s,e){var t=[];return b(s,function(r){var n=new Ra("");r.accept(n);var i=_(n.result,function(a){return a.orgProd});t.push(_(i,function(a){return Mm(r,a,e)}))}),Ke(t)}function Cm(s,e){var t=new Im;s.accept(t);var r=t.allProductions,n=Gu(r,vm),i=gt(n,function(o){return o.length>1}),a=_(be(i),function(o){var u=dt(o),l=e.buildDuplicateFoundError(s,o),c=Tt(u),d={message:l,type:Ie.DUPLICATE_PRODUCTIONS,ruleName:s.name,dslName:c,occurrence:u.idx},f=oh(u);return f&&(d.parameter=f),d});return a}function vm(s){return Tt(s)+"_#_"+s.idx+"_#_"+oh(s)}function oh(s){return s instanceof oe?s.terminalType.name:s instanceof nt?s.nonTerminalName:""}var Im=function(s){Sa(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.allProductions=[],t}return e.prototype.visitNonTerminal=function(t){this.allProductions.push(t)},e.prototype.visitOption=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e.prototype.visitAlternation=function(t){this.allProductions.push(t)},e.prototype.visitTerminal=function(t){this.allProductions.push(t)},e}(Ir),Cr=/^[a-zA-Z_]\w*$/,uh=new RegExp(Cr.source.replace("^","^\\$"));function Om(s,e){var t=[],r=s.name;return r.match(Cr)||t.push({message:e.buildInvalidRuleNameError({topLevelRule:s,expectedPattern:Cr}),type:Ie.INVALID_RULE_NAME,ruleName:r}),t}function Mm(s,e,t){var r=[],n;return e.name.match(uh)||(n=t.buildInvalidNestedRuleNameError(s,e),r.push({message:n,type:Ie.INVALID_NESTED_RULE_NAME,ruleName:s.name})),r}function wm(s,e){var t=[],r=s.name;return r.match(Cr)||t.push({message:e.buildTokenNameError({tokenType:s,expectedPattern:Cr}),type:Ie.INVALID_TOKEN_NAME}),t}function _m(s,e,t,r){var n=[],i=Le(e,function(o,u){return u.name===s.name?o+1:o},0);if(i>1){var a=r.buildDuplicateRuleNameError({topLevelRule:s,grammarName:t});n.push({message:a,type:Ie.DUPLICATE_RULE_NAME,ruleName:s.name})}return n}function Lm(s,e,t){var r=[],n;return Se(e,s)||(n="Invalid rule override, rule: ->"+s+"<- cannot be overridden in the grammar: ->"+t+"<-as it is not defined in any of the super grammars ",r.push({message:n,type:Ie.INVALID_RULE_OVERRIDE,ruleName:s})),r}function hh(s,e,t,r){r===void 0&&(r=[]);var n=[],i=hs(e.definition);if(J(i))return[];var a=s.name,o=Se(i,s);o&&n.push({message:t.buildLeftRecursionError({topLevelRule:s,leftRecursionPath:r}),type:Ie.LEFT_RECURSION,ruleName:a});var u=Ks(i,r.concat([s])),l=_(u,function(c){var d=je(r);return d.push(c),hh(s,c,t,d)});return n.concat(Ke(l))}function hs(s){var e=[];if(J(s))return e;var t=dt(s);if(t instanceof nt)e.push(t.referencedRule);else if(t instanceof qe||t instanceof _e||t instanceof ft||t instanceof mt||t instanceof st||t instanceof me)e=e.concat(hs(t.definition));else if(t instanceof it)e=Ke(_(t.definition,function(a){return hs(a.definition)}));else if(!(t instanceof oe))throw Error("non exhaustive match");var r=Cs(t),n=s.length>1;if(r&&n){var i=we(s);return e.concat(hs(i))}else return e}var Aa=function(s){Sa(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.alternations=[],t}return e.prototype.visitAlternation=function(t){this.alternations.push(t)},e}(Ir);function Fm(s,e){var t=new Aa;s.accept(t);var r=t.alternations,n=Le(r,function(i,a){var o=Sn(a.definition),u=_(o,function(l,c){var d=rh([l],[],null,1);return J(d)?{message:e.buildEmptyAlternationError({topLevelRule:s,alternation:a,emptyChoiceIdx:c}),type:Ie.NONE_LAST_EMPTY_ALT,ruleName:s.name,occurrence:a.idx,alternative:c+1}:null});return i.concat(Un(u))},[]);return n}function Um(s,e,t,r){var n=new Aa;s.accept(n);var i=n.alternations,a=t[s.name];a&&(i=Ar(i,function(u){return a[Tt(u)+(u.idx===0?"":u.idx)]})),i=Ar(i,function(u){return u.ignoreAmbiguities===!0});var o=Le(i,function(u,l){var c=l.idx,d=l.maxLookahead||e,f=Ta(c,s,d,l),E=Vm(f,l,s,r),N=Dm(f,l,s,r);return u.concat(E,N)},[]);return o}var bm=function(s){Sa(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.allProductions=[],t}return e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e}(Ir);function xm(s,e){var t=new Aa;s.accept(t);var r=t.alternations,n=Le(r,function(i,a){return a.definition.length>255&&i.push({message:e.buildTooManyAlternativesError({topLevelRule:s,alternation:a}),type:Ie.TOO_MANY_ALTS,ruleName:s.name,occurrence:a.idx}),i},[]);return n}function Pm(s,e,t){var r=[];return b(s,function(n){var i=new bm;n.accept(i);var a=i.allProductions;b(a,function(o){var u=fm(o),l=o.maxLookahead||e,c=o.idx,d=Na(c,n,u,l),f=d[0];if(J(Ke(f))){var E=t.buildEmptyRepetitionError({topLevelRule:n,repetition:o});r.push({message:E,type:Ie.NO_NON_EMPTY_LOOKAHEAD,ruleName:n.name})}})}),r}function Vm(s,e,t,r){var n=[],i=Le(s,function(o,u,l){return e.definition[l].ignoreAmbiguities===!0||b(u,function(c){var d=[l];b(s,function(f,E){l!==E&&Vi(f,c)&&e.definition[E].ignoreAmbiguities!==!0&&d.push(E)}),d.length>1&&!Vi(n,c)&&(n.push(c),o.push({alts:d,path:c}))}),o},[]),a=_(i,function(o){var u=_(o.alts,function(c){return c+1}),l=r.buildAlternationAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:u,prefixPath:o.path});return{message:l,type:Ie.AMBIGUOUS_ALTS,ruleName:t.name,occurrence:e.idx,alternatives:[o.alts]}});return a}function Dm(s,e,t,r){var n=[],i=Le(s,function(a,o,u){var l=_(o,function(c){return{idx:u,path:c}});return a.concat(l)},[]);return b(i,function(a){var o=e.definition[a.idx];if(o.ignoreAmbiguities!==!0){var u=a.idx,l=a.path,c=qp(i,function(f){return e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<u&&Sm(f.path,l)}),d=_(c,function(f){var E=[f.idx+1,u+1],N=e.idx===0?"":e.idx,R=r.buildAlternationPrefixAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:E,prefixPath:f.path});return{message:R,type:Ie.AMBIGUOUS_PREFIX_ALTS,ruleName:t.name,occurrence:N,alternatives:E}});n=n.concat(d)}}),n}function Bm(s,e,t){var r=[],n=_(e,function(i){return i.name});return b(s,function(i){var a=i.name;if(Se(n,a)){var o=t.buildNamespaceConflictError(i);r.push({message:o,type:Ie.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:a})}}),r}function km(s,e){var t=[];return b(s,function(r){var n=new Ra("");r.accept(n);var i=Gu(n.result,function(o){return o.name}),a=gt(i,function(o){return o.length>1});b(be(a),function(o){var u=_(o,function(c){return c.orgProd}),l=e.buildDuplicateNestedRuleNameError(r,u);t.push({message:l,type:Ie.DUPLICATE_NESTED_NAME,ruleName:r.name})})}),t}var lh={buildMismatchTokenMessage:function(s){var e=s.expected,t=s.actual;s.previous,s.ruleName;var r=Ju(e),n=r?"--> "+Yr(e)+" <--":"token of type --> "+e.name+" <--",i="Expecting "+n+" but found --> '"+t.image+"' <--";return i},buildNotAllInputParsedMessage:function(s){var e=s.firstRedundant;return s.ruleName,"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage:function(s){var e=s.expectedPathsPerAlt,t=s.actual;s.previous;var r=s.customUserDescription;s.ruleName;var n="Expecting: ",i=dt(t).image,a=`
but found: '`+i+"'";if(r)return n+r+a;var o=Le(e,function(d,f){return d.concat(f)},[]),u=_(o,function(d){return"["+_(d,function(f){return Yr(f)}).join(", ")+"]"}),l=_(u,function(d,f){return"  "+(f+1)+". "+d}),c=`one of these possible Token sequences:
`+l.join(`
`);return n+c+a},buildEarlyExitMessage:function(s){var e=s.expectedIterationPaths,t=s.actual,r=s.customUserDescription;s.ruleName;var n="Expecting: ",i=dt(t).image,a=`
but found: '`+i+"'";if(r)return n+r+a;var o=_(e,function(l){return"["+_(l,function(c){return Yr(c)}).join(",")+"]"}),u=`expecting at least one iteration which starts with one of these possible Token sequences::
  `+("<"+o.join(" ,")+">");return n+u+a}};Object.freeze(lh);var Gm={buildRuleNotFoundError:function(s,e){var t="Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+s.name+"<-";return t}},ya={buildDuplicateFoundError:function(s,e){function t(c){return c instanceof oe?c.terminalType.name:c instanceof nt?c.nonTerminalName:""}var r=s.name,n=dt(e),i=n.idx,a=Tt(n),o=t(n),u=i>0,l="->"+a+(u?i:"")+"<- "+(o?"with argument: ->"+o+"<-":"")+`
                  appears more than once (`+e.length+" times) in the top level rule: ->"+r+`<-.                  
                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildInvalidNestedRuleNameError:function(s,e){var t="Invalid nested rule name: ->"+e.name+"<- inside rule: ->"+s.name+`<-
`+("it must match the pattern: ->"+uh.toString()+`<-.
`)+"Note that this means a nested rule name must start with the '$'(dollar) sign.";return t},buildDuplicateNestedRuleNameError:function(s,e){var t=dt(e).name,r="Duplicate nested rule name: ->"+t+"<- inside rule: ->"+s.name+`<-
A nested name must be unique in the scope of a top level grammar rule.`;return r},buildNamespaceConflictError:function(s){var e=`Namespace conflict found in grammar.
`+("The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+s.name+`>.
`)+`To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`;return e},buildAlternationPrefixAmbiguityError:function(s){var e=_(s.prefixPath,function(n){return Yr(n)}).join(", "),t=s.alternation.idx===0?"":s.alternation.idx,r="Ambiguous alternatives: <"+s.ambiguityIndices.join(" ,")+`> due to common lookahead prefix
`+("in <OR"+t+"> inside <"+s.topLevelRule.name+`> Rule,
`)+("<"+e+`> may appears as a prefix path in all these alternatives.
`)+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`;return r},buildAlternationAmbiguityError:function(s){var e=_(s.prefixPath,function(n){return Yr(n)}).join(", "),t=s.alternation.idx===0?"":s.alternation.idx,r="Ambiguous Alternatives Detected: <"+s.ambiguityIndices.join(" ,")+"> in <OR"+t+">"+(" inside <"+s.topLevelRule.name+`> Rule,
`)+("<"+e+`> may appears as a prefix path in all these alternatives.
`);return r=r+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError:function(s){var e=Tt(s.repetition);s.repetition.idx!==0&&(e+=s.repetition.idx);var t="The repetition <"+e+"> within Rule <"+s.topLevelRule.name+`> can never consume any tokens.
This could lead to an infinite loop.`;return t},buildTokenNameError:function(s){var e=s.tokenType.name,t="Invalid Grammar Token name: ->"+e+"<- it must match the pattern: ->"+s.expectedPattern.toString()+"<-";return t},buildEmptyAlternationError:function(s){var e="Ambiguous empty alternative: <"+(s.emptyChoiceIdx+1)+">"+(" in <OR"+s.alternation.idx+"> inside <"+s.topLevelRule.name+`> Rule.
`)+"Only the last alternative may be an empty alternative.";return e},buildTooManyAlternativesError:function(s){var e=`An Alternation cannot have more than 256 alternatives:
`+("<OR"+s.alternation.idx+"> inside <"+s.topLevelRule.name+`> Rule.
 has `+(s.alternation.definition.length+1)+" alternatives.");return e},buildLeftRecursionError:function(s){var e=s.topLevelRule.name,t=_(s.leftRecursionPath,function(i){return i.name}),r=e+" --> "+t.concat([e]).join(" --> "),n=`Left Recursion found in grammar.
`+("rule: <"+e+`> can be invoked from itself (directly or indirectly)
`)+(`without consuming any Tokens. The grammar path that causes this is: 
 `+r+`
`)+` To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring.`;return n},buildInvalidRuleNameError:function(s){var e=s.topLevelRule.name,t=s.expectedPattern.toString(),r="Invalid grammar rule name: ->"+e+"<- it must match the pattern: ->"+t+"<-";return r},buildDuplicateRuleNameError:function(s){var e;s.topLevelRule instanceof en?e=s.topLevelRule.name:e=s.topLevelRule;var t="Duplicate definition, rule: ->"+e+"<- is already defined in the grammar: ->"+s.grammarName+"<-";return t}},Hm=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function Wm(s,e){var t=new Ym(s,e);return t.resolveRefs(),t.errors}var Ym=function(s){Hm(e,s);function e(t,r){var n=s.call(this)||this;return n.nameToTopRule=t,n.errMsgProvider=r,n.errors=[],n}return e.prototype.resolveRefs=function(){var t=this;b(be(this.nameToTopRule),function(r){t.currTopLevel=r,r.accept(t)})},e.prototype.visitNonTerminal=function(t){var r=this.nameToTopRule[t.nonTerminalName];if(r)t.referencedRule=r;else{var n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:n,type:Ie.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}},e}(Ir);function zm(s){s=js(s,{errMsgProvider:Gm});var e={};return b(s.rules,function(t){e[t.name]=t}),Wm(e,s.errMsgProvider)}function Xm(s){return s=js(s,{errMsgProvider:ya,ignoredIssues:{}}),Am(s.rules,s.maxLookahead,s.tokenTypes,s.ignoredIssues,s.errMsgProvider,s.grammarName)}var ch="MismatchedTokenException",dh="NoViableAltException",ph="EarlyExitException",fh="NotAllInputParsedException",mh=[ch,dh,ph,fh];Object.freeze(mh);function Is(s){return Se(mh,s.name)}function Ca(s,e,t){this.name=ch,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}Ca.prototype=Error.prototype;function gh(s,e,t){this.name=dh,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}gh.prototype=Error.prototype;function Eh(s,e){this.name=fh,this.message=s,this.token=e,this.resyncedTokens=[]}Eh.prototype=Error.prototype;function Rh(s,e,t){this.name=ph,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}Rh.prototype=Error.prototype;var Ti={},Th="InRuleRecoveryException";function Nh(s){this.name=Th,this.message=s}Nh.prototype=Error.prototype;var $m=function(){function s(){}return s.prototype.initRecoverable=function(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=U(e,"recoveryEnabled")?e.recoveryEnabled:Ye.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Km)},s.prototype.getTokenToInsert=function(e){var t=Ea(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},s.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},s.prototype.tryInRepetitionRecovery=function(e,t,r,n){for(var i=this,a=this.findReSyncTokenType(),o=this.exportLexerState(),u=[],l=!1,c=this.LA(1),d=this.LA(1),f=function(){var E=i.LA(0),N=i.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:c,previous:E,ruleName:i.getCurrRuleFullName()}),R=new Ca(N,c,i.LA(0));R.resyncedTokens=Sn(u),i.SAVE_ERROR(R)};!l;)if(this.tokenMatcher(d,n)){f();return}else if(r.call(this)){f(),e.apply(this,t);return}else this.tokenMatcher(d,a)?l=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,u));this.importLexerState(o)},s.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,r){return!(r===!1||e===void 0||t===void 0||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))},s.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t),n=this.getNextPossibleTokenTypes(r);return n},s.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t)){var r=this.getTokenToInsert(e);return r}if(this.canRecoverWithSingleTokenDeletion(e)){var n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new Nh("sad sad panda")},s.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},s.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e)||J(t))return!1;var n=this.LA(1),i=qr(t,function(a){return r.tokenMatcher(n,a)})!==void 0;return i},s.prototype.canRecoverWithSingleTokenDeletion=function(e){var t=this.tokenMatcher(this.LA(2),e);return t},s.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return Se(r,e)},s.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var n=t.tokenType;if(Se(e,n))return n;t=this.LA(r),r++}},s.prototype.getCurrFollowKey=function(){if(this.RULE_STACK.length===1)return Ti;var e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(r)}},s.prototype.buildFullFollowKeyStack=function(){var e=this,t=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return J(this.LAST_EXPLICIT_RULE_STACK)||(t=_(this.LAST_EXPLICIT_RULE_STACK,function(n){return e.RULE_STACK[n]}),r=_(this.LAST_EXPLICIT_RULE_STACK,function(n){return e.RULE_OCCURRENCE_STACK[n]})),_(t,function(n,i){return i===0?Ti:{ruleName:e.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:e.shortRuleNameToFullName(t[i-1])}})},s.prototype.flattenFollowSet=function(){var e=this,t=_(this.buildFullFollowKeyStack(),function(r){return e.getFollowSetFromFollowKey(r)});return Ke(t)},s.prototype.getFollowSetFromFollowKey=function(e){if(e===Ti)return[yr];var t=e.ruleName+e.idxInCallingRule+eh+e.inRule;return this.resyncFollows[t]},s.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,yr)||t.push(e),t},s.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return Sn(t)},s.prototype.attemptInRepetitionRecovery=function(e,t,r,n,i,a,o){},s.prototype.getCurrentGrammarPath=function(e,t){var r=this.getHumanReadableRuleStack(),n=je(this.RULE_OCCURRENCE_STACK),i={ruleStack:r,occurrenceStack:n,lastTok:e,lastTokOccurrence:t};return i},s.prototype.getHumanReadableRuleStack=function(){var e=this;return J(this.LAST_EXPLICIT_RULE_STACK)?_(this.RULE_STACK,function(t){return e.shortRuleNameToFullName(t)}):_(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])})},s}();function Km(s,e,t,r,n,i,a){var o=this.getKeyForAutomaticLookahead(r,n),u=this.firstAfterRepMap[o];if(u===void 0){var l=this.getCurrRuleFullName(),c=this.getGAstProductions()[l],d=new i(c,n);u=d.startWalking(),this.firstAfterRepMap[o]=u}var f=u.token,E=u.occurrence,N=u.isEndOfRule;this.RULE_STACK.length===1&&N&&f===void 0&&(f=yr,E=1),this.shouldInRepetitionRecoveryBeTried(f,E,a)&&this.tryInRepetitionRecovery(s,e,t,f)}var jm=function(){function s(){}return s.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=U(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Ye.dynamicTokensEnabled,this.maxLookahead=U(e,"maxLookahead")?e.maxLookahead:Ye.maxLookahead,this.lookAheadFuncsCache=ro()?new Map:[],ro()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},s.prototype.preComputeLookaheadFunctions=function(e){var t=this;b(e,function(r){t.TRACE_INIT(r.name+" Rule Lookahead",function(){var n=jf(r),i=n.alternation,a=n.repetition,o=n.option,u=n.repetitionMandatory,l=n.repetitionMandatoryWithSeparator,c=n.repetitionWithSeparator;b(i,function(d){var f=d.idx===0?"":d.idx;t.TRACE_INIT(""+Tt(d)+f,function(){var E=mm(d.idx,r,d.maxLookahead||t.maxLookahead,d.hasPredicates,t.dynamicTokensEnabled,t.lookAheadBuilderForAlternatives),N=fn(t.fullRuleNameToShort[r.name],zr,d.idx);t.setLaFuncCache(N,E)})}),b(a,function(d){t.computeLookaheadFunc(r,d.idx,cn,ee.REPETITION,d.maxLookahead,Tt(d))}),b(o,function(d){t.computeLookaheadFunc(r,d.idx,vs,ee.OPTION,d.maxLookahead,Tt(d))}),b(u,function(d){t.computeLookaheadFunc(r,d.idx,dn,ee.REPETITION_MANDATORY,d.maxLookahead,Tt(d))}),b(l,function(d){t.computeLookaheadFunc(r,d.idx,kr,ee.REPETITION_MANDATORY_WITH_SEPARATOR,d.maxLookahead,Tt(d))}),b(c,function(d){t.computeLookaheadFunc(r,d.idx,pn,ee.REPETITION_WITH_SEPARATOR,d.maxLookahead,Tt(d))})})})},s.prototype.computeLookaheadFunc=function(e,t,r,n,i,a){var o=this;this.TRACE_INIT(""+a+(t===0?"":t),function(){var u=gm(t,e,i||o.maxLookahead,o.dynamicTokensEnabled,n,o.lookAheadBuilderForOptional),l=fn(o.fullRuleNameToShort[e.name],r,t);o.setLaFuncCache(l,u)})},s.prototype.lookAheadBuilderForOptional=function(e,t,r){return Rm(e,t,r)},s.prototype.lookAheadBuilderForAlternatives=function(e,t,r,n){return Em(e,t,r,n)},s.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return fn(r,e,t)},s.prototype.getLaFuncFromCache=function(e){},s.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},s.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},s.prototype.setLaFuncCache=function(e,t){},s.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},s.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},s}();function qm(s){return ei(s.constructor)}var Qm=/^\s*function\s*(\S*)\s*\(/,vo="name";function ei(s){var e=s.name;if(e)return e;var t=s.toString().match(Qm)[1];return t}function Sh(s,e){var t=Object.getOwnPropertyDescriptor(s,vo);return pt(t)||t.configurable?(Object.defineProperty(s,vo,{enumerable:!1,configurable:!0,writable:!1,value:e}),!0):!1}function Zm(s,e){for(var t=Kt(s),r=t.length,n=0;n<r;n++)for(var i=t[n],a=s[i],o=a.length,u=0;u<o;u++){var l=a[u];l.tokenTypeIdx===void 0&&(l.fullName!==void 0?this[l.fullName](l.children,e):this[l.name](l.children,e))}}function Jm(s,e){var t=function(){};Sh(t,s+"BaseSemantics");var r={visit:function(n,i){if(At(n)&&(n=n[0]),!pt(n))return n.fullName!==void 0?this[n.fullName](n.children,i):this[n.name](n.children,i)},validateVisitor:function(){var n=tg(this,e);if(!J(n)){var i=_(n,function(a){return a.msg});throw Error("Errors Detected in CST Visitor <"+ei(this.constructor)+`>:
	`+(""+i.join(`

`).replace(/\n/g,`
	`)))}}};return t.prototype=r,t.prototype.constructor=t,t._RULE_NAMES=e,t}function eg(s,e,t){var r=function(){};Sh(r,s+"BaseSemanticsWithDefaults");var n=Object.create(t.prototype);return b(e,function(i){n[i]=Zm}),r.prototype=n,r.prototype.constructor=r,r}var Os;(function(s){s[s.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",s[s.MISSING_METHOD=1]="MISSING_METHOD"})(Os||(Os={}));function tg(s,e){var t=rg(s,e),r=sg(s,e);return t.concat(r)}function rg(s,e){var t=_(e,function(r){if(!or(s[r]))return{msg:"Missing visitor method: <"+r+"> on "+ei(s.constructor)+" CST Visitor.",type:Os.MISSING_METHOD,methodName:r}});return Un(t)}var ng=["constructor","visit","validateVisitor"];function sg(s,e){var t=[];for(var r in s)Cr.test(r)&&or(s[r])&&!Se(ng,r)&&!Se(e,r)&&t.push({msg:"Redundant visitor method: <"+r+"> on "+ei(s.constructor)+` CST Visitor
There is no Grammar Rule corresponding to this method's name.
`+("For utility methods on visitor classes use methods names that do not match /"+Cr.source+"/."),type:Os.REDUNDANT_METHOD,methodName:r});return t}var ig=function(){function s(){}return s.prototype.initTreeBuilder=function(e){if(this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=U(e,"outputCst")?e.outputCst:Ye.outputCst,this.nodeLocationTracking=U(e,"nodeLocationTracking")?e.nodeLocationTracking:Ye.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Ae,this.cstFinallyStateUpdate=Ae,this.cstPostTerminal=Ae,this.cstPostNonTerminal=Ae,this.cstPostRule=Ae,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=No,this.setNodeLocationFromNode=No,this.cstPostRule=Ae,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Ae,this.setNodeLocationFromNode=Ae,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=To,this.setNodeLocationFromNode=To,this.cstPostRule=Ae,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Ae,this.setNodeLocationFromNode=Ae,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Ae,this.setNodeLocationFromNode=Ae,this.cstPostRule=Ae,this.setInitialNodeLocation=Ae;else throw Error('Invalid <nodeLocationTracking> config option: "'+e.nodeLocationTracking+'"')},s.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},s.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},s.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},s.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},s.prototype.cstNestedInvocationStateUpdate=function(e,t){var r={name:e,fullName:this.shortRuleNameToFull[this.getLastExplicitRuleShortName()]+e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},s.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1);var r={name:e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},s.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},s.prototype.cstNestedFinallyStateUpdate=function(){var e=this.CST_STACK.pop();this.cstPostRule(e)},s.prototype.cstPostRuleFull=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?(r.endOffset=t.endOffset,r.endLine=t.endLine,r.endColumn=t.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)},s.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?r.endOffset=t.endOffset:r.startOffset=NaN},s.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];om(r,t,e),this.setNodeLocationFromToken(r.location,t)},s.prototype.cstPostNonTerminal=function(e,t){if(this.isBackTracking()!==!0){var r=this.CST_STACK[this.CST_STACK.length-1];So(r,t,e),this.setNodeLocationFromNode(r.location,e.location)}},s.prototype.getBaseCstVisitorConstructor=function(){if(pt(this.baseCstVisitorConstructor)){var e=Jm(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},s.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(pt(this.baseCstVisitorWithDefaultsConstructor)){var e=eg(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},s.prototype.nestedRuleBeforeClause=function(e,t){var r;if(e.NAME!==void 0)return r=e.NAME,this.nestedRuleInvocationStateUpdate(r,t),r},s.prototype.nestedAltBeforeClause=function(e,t,r,n){var i=this.getLastExplicitRuleShortName(),a=th(i,r,t,n),o;if(e.NAME!==void 0)return o=e.NAME,this.nestedRuleInvocationStateUpdate(o,a),{shortName:a,nestedName:o}},s.prototype.nestedRuleFinallyClause=function(e,t){var r=this.CST_STACK,n=r[r.length-1];this.nestedRuleFinallyStateUpdate();var i=r[r.length-1];So(i,t,n),this.setNodeLocationFromNode(i.location,n.location)},s.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},s.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},s.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},s.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},s.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},s.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},s.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},s.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},s}(),ag=function(){function s(){}return s.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(s.prototype,"input",{get:function(){return this.tokVector},set:function(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),s.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):ws},s.prototype.LA=function(e){var t=this.currIdx+e;return t<0||this.tokVectorLength<=t?ws:this.tokVector[t]},s.prototype.consumeToken=function(){this.currIdx++},s.prototype.exportLexerState=function(){return this.currIdx},s.prototype.importLexerState=function(e){this.currIdx=e},s.prototype.resetLexerState=function(){this.currIdx=-1},s.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},s.prototype.getLexerPosition=function(){return this.exportLexerState()},s}(),og=function(){function s(){}return s.prototype.ACTION=function(e){return e.call(this)},s.prototype.consume=function(e,t,r){return this.consumeInternal(t,e,r)},s.prototype.subrule=function(e,t,r){return this.subruleInternal(t,e,r)},s.prototype.option=function(e,t){return this.optionInternal(t,e)},s.prototype.or=function(e,t){return this.orInternal(t,e)},s.prototype.many=function(e,t){return this.manyInternal(e,t)},s.prototype.atLeastOne=function(e,t){return this.atLeastOneInternal(e,t)},s.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},s.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},s.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},s.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},s.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},s.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},s.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},s.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},s.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},s.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},s.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},s.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},s.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},s.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},s.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},s.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},s.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},s.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},s.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},s.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},s.prototype.OPTION=function(e){return this.optionInternal(e,0)},s.prototype.OPTION1=function(e){return this.optionInternal(e,1)},s.prototype.OPTION2=function(e){return this.optionInternal(e,2)},s.prototype.OPTION3=function(e){return this.optionInternal(e,3)},s.prototype.OPTION4=function(e){return this.optionInternal(e,4)},s.prototype.OPTION5=function(e){return this.optionInternal(e,5)},s.prototype.OPTION6=function(e){return this.optionInternal(e,6)},s.prototype.OPTION7=function(e){return this.optionInternal(e,7)},s.prototype.OPTION8=function(e){return this.optionInternal(e,8)},s.prototype.OPTION9=function(e){return this.optionInternal(e,9)},s.prototype.OR=function(e){return this.orInternal(e,0)},s.prototype.OR1=function(e){return this.orInternal(e,1)},s.prototype.OR2=function(e){return this.orInternal(e,2)},s.prototype.OR3=function(e){return this.orInternal(e,3)},s.prototype.OR4=function(e){return this.orInternal(e,4)},s.prototype.OR5=function(e){return this.orInternal(e,5)},s.prototype.OR6=function(e){return this.orInternal(e,6)},s.prototype.OR7=function(e){return this.orInternal(e,7)},s.prototype.OR8=function(e){return this.orInternal(e,8)},s.prototype.OR9=function(e){return this.orInternal(e,9)},s.prototype.MANY=function(e){this.manyInternal(0,e)},s.prototype.MANY1=function(e){this.manyInternal(1,e)},s.prototype.MANY2=function(e){this.manyInternal(2,e)},s.prototype.MANY3=function(e){this.manyInternal(3,e)},s.prototype.MANY4=function(e){this.manyInternal(4,e)},s.prototype.MANY5=function(e){this.manyInternal(5,e)},s.prototype.MANY6=function(e){this.manyInternal(6,e)},s.prototype.MANY7=function(e){this.manyInternal(7,e)},s.prototype.MANY8=function(e){this.manyInternal(8,e)},s.prototype.MANY9=function(e){this.manyInternal(9,e)},s.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},s.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},s.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},s.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},s.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},s.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},s.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},s.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},s.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},s.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},s.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},s.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},s.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},s.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},s.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},s.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},s.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},s.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},s.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},s.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},s.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},s.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},s.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},s.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},s.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},s.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},s.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},s.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},s.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},s.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},s.prototype.RULE=function(e,t,r){if(r===void 0&&(r=_s),Se(this.definedRulesNames,e)){var n=ya.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),i={message:n,type:Ie.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}this.definedRulesNames.push(e);var a=this.defineRule(e,t,r);return this[e]=a,a},s.prototype.OVERRIDE_RULE=function(e,t,r){r===void 0&&(r=_s);var n=[];n=n.concat(Lm(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,n);var i=this.defineRule(e,t,r);return this[e]=i,i},s.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(n){if(Is(n))return!1;throw n}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},s.prototype.getGAstProductions=function(){return this.gastProductionsCache},s.prototype.getSerializedGastProductions=function(){return Yf(be(this.gastProductionsCache))},s}(),ug=function(){function s(){}return s.prototype.initRecognizerEngine=function(e,t){if(this.className=qm(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ys,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},U(t,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(At(e)){if(J(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(At(e))this.tokensMap=Le(e,function(a,o){return a[o.name]=o,a},{});else if(U(e,"modes")&&ct(Ke(be(e.modes)),kf)){var r=Ke(be(e.modes)),n=pa(r);this.tokensMap=Le(n,function(a,o){return a[o.name]=o,a},{})}else if(fa(e))this.tokensMap=Fn(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=yr;var i=ct(be(e),function(a){return J(a.categoryMatches)});this.tokenMatcher=i?ys:Qs,xn(be(this.tokensMap))},s.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+`> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);var n=U(r,"resyncEnabled")?r.resyncEnabled:_s.resyncEnabled,i=U(r,"recoveryValueFunc")?r.recoveryValueFunc:_s.recoveryValueFunc,a=this.ruleShortNameIdx<<nm+ur;this.ruleShortNameIdx++,this.shortRuleNameToFull[a]=e,this.fullRuleNameToShort[e]=a;function o(c){try{if(this.outputCst===!0){t.apply(this,c);var d=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(d),d}else return t.apply(this,c)}catch(f){return this.invokeRuleCatch(f,n,i)}finally{this.ruleFinallyStateUpdate()}}var u;u=function(c,d){return c===void 0&&(c=0),this.ruleInvocationStateUpdate(a,e,c),o.call(this,d)};var l="ruleName";return u[l]=e,u.originalGrammarAction=t,u},s.prototype.invokeRuleCatch=function(e,t,r){var n=this.RULE_STACK.length===1,i=t&&!this.isBackTracking()&&this.recoveryEnabled;if(Is(e)){var a=e;if(i){var o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))if(a.resyncedTokens=this.reSyncTo(o),this.outputCst){var u=this.CST_STACK[this.CST_STACK.length-1];return u.recoveredNode=!0,u}else return r();else{if(this.outputCst){var u=this.CST_STACK[this.CST_STACK.length-1];u.recoveredNode=!0,a.partialCstResult=u}throw a}}else{if(n)return this.moveToTerminatedState(),r();throw a}}else throw e},s.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(vs,t),n=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(vs,t);return this.optionInternalLogic(e,t,r)},s.prototype.optionInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(e.DEF!==void 0){if(a=e.DEF,o=e.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=e;if(i.call(this)===!0)return a.call(this)},s.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(dn,e),n=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(dn,e);this.atLeastOneInternalLogic(e,t,r)},s.prototype.atLeastOneInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(t.DEF!==void 0){if(a=t.DEF,o=t.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=t;if(i.call(this)===!0)for(var l=this.doSingleRepetition(a);i.call(this)===!0&&l===!0;)l=this.doSingleRepetition(a);else throw this.raiseEarlyExitException(e,ee.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],i,dn,e,dm)},s.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(kr,e),n=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(kr,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},s.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var n=this,i=t.DEF,a=t.SEP,o=this.getLaFuncFromCache(r);if(o.call(this)===!0){i.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),a)};this.tokenMatcher(this.LA(1),a)===!0;)this.CONSUME(a),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,a,u,i,yo],u,kr,e,yo)}else throw this.raiseEarlyExitException(e,ee.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)},s.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(cn,e),n=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(cn,e);return this.manyInternalLogic(e,t,r)},s.prototype.manyInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(t.DEF!==void 0){if(a=t.DEF,o=t.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=t;for(var l=!0;i.call(this)===!0&&l===!0;)l=this.doSingleRepetition(a);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],i,cn,e,cm,l)},s.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(pn,e),n=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(pn,e);this.manySepFirstInternalLogic(e,t,r)},s.prototype.manySepFirstInternalLogic=function(e,t,r){var n=this,i=t.DEF,a=t.SEP,o=this.getLaFuncFromCache(r);if(o.call(this)===!0){i.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),a)};this.tokenMatcher(this.LA(1),a)===!0;)this.CONSUME(a),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,a,u,i,Ao],u,pn,e,Ao)}},s.prototype.repetitionSepSecondInternal=function(e,t,r,n,i){for(;r();)this.CONSUME(t),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,n,i],r,kr,e,i)},s.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();e.call(this);var r=this.getLexerPosition();return r>t},s.prototype.orInternalNoCst=function(e,t){var r=At(e)?e:e.DEF,n=this.getKeyForAutomaticLookahead(zr,t),i=this.getLaFuncFromCache(n),a=i.call(this,r);if(a!==void 0){var o=r[a];return o.ALT.call(this)}this.raiseNoAltException(t,e.ERR_MSG)},s.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(zr,t),n=this.nestedRuleBeforeClause(e,r);try{var i=At(e)?e:e.DEF,a=this.getLaFuncFromCache(r),o=a.call(this,i);if(o!==void 0){var u=i[o],l=this.nestedAltBeforeClause(u,t,zr,o);try{return u.ALT.call(this)}finally{l!==void 0&&this.nestedRuleFinallyClause(l.shortName,l.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Eh(t,e))}},s.prototype.subruleInternal=function(e,t,r){var n;try{var i=r!==void 0?r.ARGS:void 0;return n=e.call(this,t,i),this.cstPostNonTerminal(n,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),n}catch(a){this.subruleInternalError(a,r,e.ruleName)}},s.prototype.subruleInternalError=function(e,t,r){throw Is(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,t!==void 0&&t.LABEL!==void 0?t.LABEL:r),delete e.partialCstResult),e},s.prototype.consumeInternal=function(e,t,r){var n;try{var i=this.LA(1);this.tokenMatcher(i,e)===!0?(this.consumeToken(),n=i):this.consumeInternalError(e,i,r)}catch(a){n=this.consumeInternalRecovery(e,t,a)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,n),n},s.prototype.consumeInternalError=function(e,t,r){var n,i=this.LA(0);throw r!==void 0&&r.ERR_MSG?n=r.ERR_MSG:n=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Ca(n,t,i))},s.prototype.consumeInternalRecovery=function(e,t,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){var n=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,n)}catch(i){throw i.name===Th?r:i}}else throw r},s.prototype.saveRecogState=function(){var e=this.errors,t=je(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},s.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},s.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},s.prototype.isBackTracking=function(){return this.isBackTrackingStack.length!==0},s.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]},s.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull[e]},s.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),yr)},s.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},s}(),hg=function(){function s(){}return s.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=js(e.errorMessageProvider,Ye.errorMessageProvider)},s.prototype.SAVE_ERROR=function(e){if(Is(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:je(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(s.prototype,"errors",{get:function(){return je(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),s.prototype.raiseEarlyExitException=function(e,t,r){for(var n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],a=Na(e,i,t,this.maxLookahead),o=a[0],u=[],l=1;l<=this.maxLookahead;l++)u.push(this.LA(l));var c=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:o,actual:u,previous:this.LA(0),customUserDescription:r,ruleName:n});throw this.SAVE_ERROR(new Rh(c,this.LA(1),this.LA(0)))},s.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),n=this.getGAstProductions()[r],i=Ta(e,n,this.maxLookahead),a=[],o=1;o<=this.maxLookahead;o++)a.push(this.LA(o));var u=this.LA(0),l=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:a,previous:u,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new gh(l,this.LA(1),u))},s}(),lg=function(){function s(){}return s.prototype.initContentAssist=function(){},s.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache[e];if(pt(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return rh([r],t,this.tokenMatcher,this.maxLookahead)},s.prototype.getNextPossibleTokenTypes=function(e){var t=dt(e.ruleStack),r=this.getGAstProductions(),n=r[t],i=new lm(n,e).startWalking();return i},s}(),ti={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(ti);var Io=!0,Oo=Math.pow(2,ur)-1,Ah=H({name:"RECORDING_PHASE_TOKEN",pattern:$e.NA});xn([Ah]);var yh=Ea(Ah,`This IToken indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(yh);var cg={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,children:{}},dg=function(){function s(){}return s.prototype.initGastRecorder=function(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1},s.prototype.enableRecording=function(){var e=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var t=function(n){var i=n>0?n:"";e["CONSUME"+i]=function(a,o){return this.consumeInternalRecord(a,n,o)},e["SUBRULE"+i]=function(a,o){return this.subruleInternalRecord(a,n,o)},e["OPTION"+i]=function(a){return this.optionInternalRecord(a,n)},e["OR"+i]=function(a){return this.orInternalRecord(a,n)},e["MANY"+i]=function(a){this.manyInternalRecord(n,a)},e["MANY_SEP"+i]=function(a){this.manySepFirstInternalRecord(n,a)},e["AT_LEAST_ONE"+i]=function(a){this.atLeastOneInternalRecord(n,a)},e["AT_LEAST_ONE_SEP"+i]=function(a){this.atLeastOneSepFirstInternalRecord(n,a)}},r=0;r<10;r++)t(r);e.consume=function(n,i,a){return this.consumeInternalRecord(i,n,a)},e.subrule=function(n,i,a){return this.subruleInternalRecord(i,n,a)},e.option=function(n,i){return this.optionInternalRecord(i,n)},e.or=function(n,i){return this.orInternalRecord(i,n)},e.many=function(n,i){this.manyInternalRecord(n,i)},e.atLeastOne=function(n,i){this.atLeastOneInternalRecord(n,i)},e.ACTION=e.ACTION_RECORD,e.BACKTRACK=e.BACKTRACK_RECORD,e.LA=e.LA_RECORD})},s.prototype.disableRecording=function(){var e=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var t=0;t<10;t++){var r=t>0?t:"";delete e["CONSUME"+r],delete e["SUBRULE"+r],delete e["OPTION"+r],delete e["OR"+r],delete e["MANY"+r],delete e["MANY_SEP"+r],delete e["AT_LEAST_ONE"+r],delete e["AT_LEAST_ONE_SEP"+r]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})},s.prototype.ACTION_RECORD=function(e){},s.prototype.BACKTRACK_RECORD=function(e,t){return function(){return!0}},s.prototype.LA_RECORD=function(e){return ws},s.prototype.topLevelRuleRecord=function(e,t){try{var r=new en({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}},s.prototype.optionInternalRecord=function(e,t){return sn.call(this,_e,e,t)},s.prototype.atLeastOneInternalRecord=function(e,t){sn.call(this,ft,t,e)},s.prototype.atLeastOneSepFirstInternalRecord=function(e,t){sn.call(this,mt,t,e,Io)},s.prototype.manyInternalRecord=function(e,t){sn.call(this,me,t,e)},s.prototype.manySepFirstInternalRecord=function(e,t){sn.call(this,st,t,e,Io)},s.prototype.orInternalRecord=function(e,t){return pg.call(this,e,t)},s.prototype.subruleInternalRecord=function(e,t,r){if(Ms(t),!e||U(e,"ruleName")===!1){var n=new Error("<SUBRULE"+Mo(t)+"> argument is invalid"+(" expecting a Parser method reference but got: <"+JSON.stringify(e)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw n.KNOWN_RECORDER_ERROR=!0,n}var i=Ss(this.recordingProdStack),a=e.ruleName,o=new nt({idx:t,nonTerminalName:a,referencedRule:void 0});return i.definition.push(o),this.outputCst?cg:ti},s.prototype.consumeInternalRecord=function(e,t,r){if(Ms(t),!Zu(e)){var n=new Error("<CONSUME"+Mo(t)+"> argument is invalid"+(" expecting a TokenType reference but got: <"+JSON.stringify(e)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw n.KNOWN_RECORDER_ERROR=!0,n}var i=Ss(this.recordingProdStack),a=new oe({idx:t,terminalType:e});return i.definition.push(a),yh},s}();function sn(s,e,t,r){r===void 0&&(r=!1),Ms(t);var n=Ss(this.recordingProdStack),i=or(e)?e:e.DEF,a=new s({definition:[],idx:t});return U(e,"NAME")&&(a.name=e.NAME),r&&(a.separator=e.SEP),U(e,"MAX_LOOKAHEAD")&&(a.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(a),i.call(this),n.definition.push(a),this.recordingProdStack.pop(),ti}function pg(s,e){var t=this;Ms(e);var r=Ss(this.recordingProdStack),n=At(s)===!1,i=n===!1?s:s.DEF,a=new it({definition:[],idx:e,ignoreAmbiguities:n&&s.IGNORE_AMBIGUITIES===!0});U(s,"NAME")&&(a.name=s.NAME),U(s,"MAX_LOOKAHEAD")&&(a.maxLookahead=s.MAX_LOOKAHEAD);var o=ku(i,function(u){return or(u.GATE)});return a.hasPredicates=o,r.definition.push(a),b(i,function(u){var l=new qe({definition:[]});a.definition.push(l),U(u,"NAME")&&(l.name=u.NAME),U(u,"IGNORE_AMBIGUITIES")?l.ignoreAmbiguities=u.IGNORE_AMBIGUITIES:U(u,"GATE")&&(l.ignoreAmbiguities=!0),t.recordingProdStack.push(l),u.ALT.call(t),t.recordingProdStack.pop()}),ti}function Mo(s){return s===0?"":""+s}function Ms(s){if(s<0||s>Oo){var e=new Error("Invalid DSL Method idx value: <"+s+`>
	`+("Idx value must be a none negative value smaller than "+(Oo+1)));throw e.KNOWN_RECORDER_ERROR=!0,e}}var fg=function(){function s(){}return s.prototype.initPerformanceTracer=function(e){if(U(e,"traceInitPerf")){var t=e.traceInitPerf,r=typeof t=="number";this.traceInitMaxIdent=r?t:1/0,this.traceInitPerf=r?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=Ye.traceInitPerf;this.traceInitIndent=-1},s.prototype.TRACE_INIT=function(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--> <"+e+">");var n=Wu(t),i=n.time,a=n.value,o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(r+"<-- <"+e+"> time: "+i+"ms"),this.traceInitIndent--,a}else return t()},s}(),Ch=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ws=Ea(yr,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(ws);var Ye=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:lh,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),_s=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),Ie;(function(s){s[s.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",s[s.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",s[s.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",s[s.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",s[s.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",s[s.LEFT_RECURSION=5]="LEFT_RECURSION",s[s.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",s[s.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",s[s.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",s[s.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",s[s.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",s[s.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",s[s.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",s[s.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",s[s.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"})(Ie||(Ie={}));function mg(s){return s===void 0&&(s=void 0),function(){return s}}var va=function(){function s(e,t){t===void 0&&(t=Ye),this.ignoredIssues=Ye.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1;var r=this;r.initErrorHandler(t),r.initLexerAdapter(),r.initLooksAhead(t),r.initRecognizerEngine(e,t),r.initRecoverable(t),r.initTreeBuilder(t),r.initContentAssist(),r.initGastRecorder(t),r.initPerformanceTracer(t),U(t,"ignoredIssues")&&t.ignoredIssues!==Ye.ignoredIssues&&ma(`The <ignoredIssues> IParserConfig property is soft-deprecated and will be removed in future versions.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.`),this.ignoredIssues=U(t,"ignoredIssues")?t.ignoredIssues:Ye.ignoredIssues,this.skipValidations=U(t,"skipValidations")?t.skipValidations:Ye.skipValidations}return s.performSelfAnalysis=function(e){e.performSelfAnalysis()},s.prototype.performSelfAnalysis=function(){var e=this;this.TRACE_INIT("performSelfAnalysis",function(){var t;e.selfAnalysisDone=!0;var r=e.className;e.TRACE_INIT("toFastProps",function(){Hu(e)}),e.TRACE_INIT("Grammar Recording",function(){try{e.enableRecording(),b(e.definedRulesNames,function(i){var a=e[i],o=a.originalGrammarAction,u=void 0;e.TRACE_INIT(i+" Rule",function(){u=e.topLevelRuleRecord(i,o)}),e.gastProductionsCache[i]=u})}finally{e.disableRecording()}});var n=[];if(e.TRACE_INIT("Grammar Resolving",function(){n=zm({rules:be(e.gastProductionsCache)}),e.definitionErrors.push.apply(e.definitionErrors,n)}),e.TRACE_INIT("Grammar Validations",function(){if(J(n)&&e.skipValidations===!1){var i=Xm({rules:be(e.gastProductionsCache),maxLookahead:e.maxLookahead,tokenTypes:be(e.tokensMap),ignoredIssues:e.ignoredIssues,errMsgProvider:ya,grammarName:r});e.definitionErrors.push.apply(e.definitionErrors,i)}}),J(e.definitionErrors)&&(e.recoveryEnabled&&e.TRACE_INIT("computeAllProdsFollows",function(){var i=tm(be(e.gastProductionsCache));e.resyncFollows=i}),e.TRACE_INIT("ComputeLookaheadFunctions",function(){e.preComputeLookaheadFunctions(be(e.gastProductionsCache))})),e.TRACE_INIT("expandAllNestedRuleNames",function(){var i=um(be(e.gastProductionsCache),e.fullRuleNameToShort);e.allRuleNames=i.allRuleNames}),!s.DEFER_DEFINITION_ERRORS_HANDLING&&!J(e.definitionErrors))throw t=_(e.definitionErrors,function(i){return i.message}),new Error(`Parser Definition Errors detected:
 `+t.join(`
-------------------------------
`))})},s.DEFER_DEFINITION_ERRORS_HANDLING=!1,s}();ef(va,[$m,jm,ig,ag,ug,og,hg,lg,dg,fg]);(function(s){Ch(e,s);function e(t,r){r===void 0&&(r=Ye);var n=this,i=Fn(r);return i.outputCst=!0,n=s.call(this,t,i)||this,n}return e})(va);var gg=function(s){Ch(e,s);function e(t,r){r===void 0&&(r=Ye);var n=this,i=Fn(r);return i.outputCst=!1,n=s.call(this,t,i)||this,n}return e}(va);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const wo=(s,e)=>({type:s,message:e});var ce;(function(s){s.LexingError="LexingError",s.ParserError="ParsingError",s.StaticOffsetError="StaticOffsetError",s.StaticOffsetOutOfRangeError="StaticOffsetOutOfRangeError",s.RangeOffsetNotAllowed="RangeOffsetNotAllowed",s.InvalidRangeSize="InvalidRangeSize"})(ce||(ce={}));var g;(function(s){s.EMPTY="EMPTY",s.NUMBER="NUMBER",s.STRING="STRING",s.MINUS_UNARY_OP="MINUS_UNARY_OP",s.PLUS_UNARY_OP="PLUS_UNARY_OP",s.PERCENT_OP="PERCENT_OP",s.CONCATENATE_OP="CONCATENATE_OP",s.EQUALS_OP="EQUALS_OP",s.NOT_EQUAL_OP="NOT_EQUAL_OP",s.GREATER_THAN_OP="GREATER_THAN_OP",s.LESS_THAN_OP="LESS_THAN_OP",s.GREATER_THAN_OR_EQUAL_OP="GREATER_THAN_OR_EQUAL_OP",s.LESS_THAN_OR_EQUAL_OP="LESS_THAN_OR_EQUAL_OP",s.PLUS_OP="PLUS_OP",s.MINUS_OP="MINUS_OP",s.TIMES_OP="TIMES_OP",s.DIV_OP="DIV_OP",s.POWER_OP="POWER_OP",s.FUNCTION_CALL="FUNCTION_CALL",s.NAMED_EXPRESSION="NAMED_EXPRESSION",s.PARENTHESIS="PARENTHESES",s.CELL_REFERENCE="CELL_REFERENCE",s.CELL_RANGE="CELL_RANGE",s.COLUMN_RANGE="COLUMN_RANGE",s.ROW_RANGE="ROW_RANGE",s.ERROR="ERROR",s.ERROR_WITH_RAW_INPUT="ERROR_WITH_RAW_INPUT",s.ARRAY="ARRAY"})(g||(g={}));var Je;(function(s){s[s.RELATIVE=0]="RELATIVE",s[s.START_ABSOLUTE=1]="START_ABSOLUTE",s[s.BOTH_ABSOLUTE=2]="BOTH_ABSOLUTE"})(Je||(Je={}));const Eg=s=>({type:g.EMPTY,leadingWhitespace:s?.image}),Rg=(s,e)=>({type:g.NUMBER,value:s,leadingWhitespace:e?.image}),Tg=s=>{var e;return{type:g.STRING,value:s.image.slice(1,-1),leadingWhitespace:(e=s.leadingWhitespace)===null||e===void 0?void 0:e.image}},_o=(s,e)=>({type:g.CELL_REFERENCE,reference:s,leadingWhitespace:e?.image}),Lo=(s,e,t,r)=>(Ia(s,e,t),{type:g.CELL_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r}),Ng=(s,e,t,r)=>(Ia(s,e,t),{type:g.COLUMN_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r?.image}),Sg=(s,e,t,r)=>(Ia(s,e,t),{type:g.ROW_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r?.image}),Ag=(s,e,t)=>({type:g.CONCATENATE_OP,left:s,right:e,leadingWhitespace:t?.image}),yg=(s,e,t)=>({type:g.EQUALS_OP,left:s,right:e,leadingWhitespace:t?.image}),Cg=(s,e,t)=>({type:g.NOT_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),vg=(s,e,t)=>({type:g.GREATER_THAN_OP,left:s,right:e,leadingWhitespace:t?.image}),Ig=(s,e,t)=>({type:g.LESS_THAN_OP,left:s,right:e,leadingWhitespace:t?.image}),Og=(s,e,t)=>({type:g.GREATER_THAN_OR_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),Mg=(s,e,t)=>({type:g.LESS_THAN_OR_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),wg=(s,e,t)=>({type:g.PLUS_OP,left:s,right:e,leadingWhitespace:t?.image}),_g=(s,e,t)=>({type:g.MINUS_OP,left:s,right:e,leadingWhitespace:t?.image}),Lg=(s,e,t)=>({type:g.TIMES_OP,left:s,right:e,leadingWhitespace:t?.image}),Fg=(s,e,t)=>({type:g.DIV_OP,left:s,right:e,leadingWhitespace:t?.image}),Ug=(s,e,t)=>({type:g.POWER_OP,left:s,right:e,leadingWhitespace:t?.image}),bg=(s,e)=>({type:g.MINUS_UNARY_OP,value:s,leadingWhitespace:e?.image}),xg=(s,e)=>({type:g.PLUS_UNARY_OP,value:s,leadingWhitespace:e?.image}),Pg=(s,e)=>({type:g.PERCENT_OP,value:s,leadingWhitespace:e?.image}),Vg=(s,e,t,r,n)=>({type:g.FUNCTION_CALL,procedureName:s,args:e,leadingWhitespace:t?.image,internalWhitespace:r?.image,hyperlink:n}),Fo=(s,e,t)=>({type:g.ARRAY,args:s,leadingWhitespace:e?.image,internalWhitespace:t?.image}),Dg=(s,e)=>({type:g.NAMED_EXPRESSION,expressionName:s,leadingWhitespace:e?.image}),Bg=(s,e,t)=>({type:g.PARENTHESIS,expression:s,leadingWhitespace:e?.image,internalWhitespace:t?.image}),_t=(s,e)=>({type:g.ERROR,error:s,leadingWhitespace:e?.image}),_r=(s,e,t)=>({type:g.ERROR_WITH_RAW_INPUT,error:e,rawInput:s,leadingWhitespace:t?.image}),Di=()=>({type:g.ERROR,error:p.parsingError()});function Ia(s,e,t){if(s.sheet!==void 0&&e.sheet===void 0||s.sheet===void 0&&e.sheet!==void 0)throw new Error("Start address inconsistent with end address");if(s.sheet===void 0&&t!==Je.RELATIVE||s.sheet!==void 0&&t===Je.RELATIVE)throw new Error("Sheet address inconsistent with sheet reference type")}function W(s,e){return(e??"")+s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const vh={[g.PLUS_OP]:"+",[g.MINUS_OP]:"-",[g.TIMES_OP]:"*",[g.DIV_OP]:"/",[g.CONCATENATE_OP]:"&",[g.POWER_OP]:"^",[g.EQUALS_OP]:"=",[g.NOT_EQUAL_OP]:"<>",[g.GREATER_THAN_OP]:">",[g.GREATER_THAN_OR_EQUAL_OP]:">=",[g.LESS_THAN_OP]:"<",[g.LESS_THAN_OR_EQUAL_OP]:"<="};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const kg=(s,e,t,r)=>({ast:s,relativeDependencies:e,hasVolatileFunction:t,hasStructuralChangeFunction:r});class Gg{constructor(e){this.functionRegistry=e,this.cache=new Map}set(e,t){const r=ni(t,this.functionRegistry),n=kg(t,r,Qt(t,this.functionRegistry.isFunctionVolatile),Qt(t,this.functionRegistry.isFunctionDependentOnSheetStructureChange));return this.cache.set(e,n),n}get(e){return this.cache.get(e)}maybeSetAndThenGet(e,t){const r=this.cache.get(e);return r!==void 0?r.ast:(this.set(e,t),t)}}const Qt=(s,e)=>{switch(s.type){case g.EMPTY:case g.NUMBER:case g.STRING:case g.ERROR:case g.ERROR_WITH_RAW_INPUT:case g.CELL_REFERENCE:case g.CELL_RANGE:case g.COLUMN_RANGE:case g.ROW_RANGE:case g.NAMED_EXPRESSION:return!1;case g.PERCENT_OP:case g.PLUS_UNARY_OP:case g.MINUS_UNARY_OP:return Qt(s.value,e);case g.CONCATENATE_OP:case g.EQUALS_OP:case g.NOT_EQUAL_OP:case g.LESS_THAN_OP:case g.GREATER_THAN_OP:case g.LESS_THAN_OR_EQUAL_OP:case g.GREATER_THAN_OR_EQUAL_OP:case g.MINUS_OP:case g.PLUS_OP:case g.TIMES_OP:case g.DIV_OP:case g.POWER_OP:return Qt(s.left,e)||Qt(s.right,e);case g.PARENTHESIS:return Qt(s.expression,e);case g.FUNCTION_CALL:return e(s.procedureName)?!0:s.args.some(t=>Qt(t,e));case g.ARRAY:return s.args.some(t=>t.some(r=>Qt(r,e)))}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class T{}T.DistinctSigns="Distinct signs.";T.WrongArgNumber="Wrong number of arguments.";T.EmptyArg="Empty function argument.";T.EmptyArray="Empty array not allowed.";T.ArrayDimensions="Array dimensions are not compatible.";T.NoSpaceForArrayResult="No space for array result.";T.ValueSmall="Value too small.";T.ValueLarge="Value too large.";T.BadCriterion="Incorrect criterion.";T.RangeManySheets="Range spans more than one sheet.";T.CellRangeExpected="Cell range expected.";T.WrongDimension="Wrong range dimension.";T.ScalarExpected="Cell range not allowed.";T.NumberCoercion="Value cannot be coerced to number.";T.NumberExpected="Number argument expected.";T.IntegerExpected="Value needs to be an integer.";T.BadMode="Mode not recognized.";T.DateBounds="Date outside of bounds.";T.OutOfSheet="Resulting reference is out of the sheet.";T.WrongType="Wrong type of argument.";T.NaN="NaN or infinite value encountered.";T.EqualLength="Ranges need to be of equal length.";T.Negative="Value cannot be negative.";T.NotBinary="String does not represent a binary number.";T.NotOctal="String does not represent an octal number.";T.NotHex="String does not represent a hexadecimal number.";T.EndStartPeriod="End period needs to be at least start period.";T.CellRefExpected="Cell reference expected.";T.EmptyRange="Empty range not allowed.";T.BadRef="Address is not correct.";T.NumberRange="Number-only range expected.";T.ValueNotFound="Value not found.";T.ValueBaseLarge="Value in base too large.";T.ValueBaseSmall="Value in base too small.";T.ValueBaseLong="Value in base too long.";T.NegativeLength="Length cannot be negative.";T.PatternNotFound="Pattern not found.";T.OneValue="Needs at least one value.";T.TwoValues="Range needs to contain at least two elements.";T.ThreeValues="Range needs to contain at least three elements.";T.IndexBounds="Index out of bounds.";T.IndexLarge="Index too large.";T.Formula="Expected formula.";T.NegativeCount="Count cannot be negative.";T.ParseError="Parsing error.";T.SheetRef="Sheet does not exist.";T.PeriodLong="Period number cannot exceed life length.";T.InvalidDate="Invalid date.";T.BitshiftLong="Result of bitshift is too long.";T.EmptyString="Empty-string argument not allowed.";T.LengthBounds="Length out of bounds.";T.NegativeTime="Time cannot be negative.";T.NoDefault="No default option.";T.NoConditionMet="None of the conditions were met.";T.Selector="Selector cannot exceed the number of arguments.";T.StartEndDate="Start date needs to be earlier than end date.";T.IncorrectDateTime="String does not represent correct DateTime.";T.CharacterCodeBounds="Character code out of bounds.";T.NonZero="Argument cannot be 0.";T.LessThanOne="Argument cannot be less than 1.";T.WeekendString="Incorrect weekend bitmask string.";T.InvalidRoman="Invalid roman numeral.";T.WrongOrder="Wrong order of values.";T.ComplexNumberExpected="Complex number expected.";T.ShouldBeIorJ="Should be 'i' or 'j'.";T.SizeMismatch="Array dimensions mismatched.";T.FunctionName=s=>`Function name ${s} not recognized.`;T.NamedExpressionName=s=>`Named expression ${s} not recognized.`;T.LicenseKey=s=>`License key is ${s}.`;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Hg{constructor(){this.POSSIBLE_START_CHARACTERS=[...Pu,...Wp,Be,"'","_"],this.cellReferenceRegexp=new RegExp(Hp,"y")}match(e,t){this.cellReferenceRegexp.lastIndex=t;const r=this.cellReferenceRegexp.exec(e+"@");return r==null||r[1]==null?null:(r[0]=r[1],r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Wg{constructor(){this.POSSIBLE_START_CHARACTERS=[...Pu,"_"],this.namedExpressionRegexp=new RegExp(xu,"y"),this.r1c1CellRefRegexp=new RegExp(`^${bu}$`)}match(e,t){this.namedExpressionRegexp.lastIndex=t;const r=this.namedExpressionRegexp.exec(e);return r==null||r[0]==null||this.r1c1CellRefRegexp.test(r[0])?null:r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const An=H({name:"AdditionOp",pattern:$e.NA}),Bi=H({name:"PlusOp",pattern:/\+/,categories:An}),ki=H({name:"MinusOp",pattern:/-/,categories:An}),ri=H({name:"MultiplicationOp",pattern:$e.NA}),Ih=H({name:"TimesOp",pattern:/\*/,categories:ri}),Oh=H({name:"DivOp",pattern:/\//,categories:ri}),Gi=H({name:"PowerOp",pattern:/\^/}),Mh=H({name:"PercentOp",pattern:/%/}),hr=H({name:"BooleanOp",pattern:$e.NA}),Hi=H({name:"EqualsOp",pattern:/=/,categories:hr}),wh=H({name:"NotEqualOp",pattern:/<>/,categories:hr}),_h=H({name:"GreaterThanOp",pattern:/>/,categories:hr}),Lh=H({name:"LessThanOp",pattern:/</,categories:hr}),Fh=H({name:"GreaterThanOrEqualOp",pattern:/>=/,categories:hr}),Uh=H({name:"LessThanOrEqualOp",pattern:/<=/,categories:hr}),bh=H({name:"ConcatenateOp",pattern:/&/}),Wi=H({name:"LParen",pattern:/\(/}),ls=H({name:"RParen",pattern:/\)/}),xh=H({name:"ArrayLParen",pattern:/{/}),Ph=H({name:"ArrayRParen",pattern:/}/}),Vh=H({name:"StringLiteral",pattern:/"([^"\\]*(\\.[^"\\]*)*)"/}),Dh=H({name:"ErrorLiteral",pattern:/#[A-Za-z0-9\/]+[?!]?/}),yn=H({name:"RangeSeparator",pattern:new RegExp(Ln)}),Oa=H({name:"ColumnRange",pattern:new RegExp(`${Za}${Ln}${Za}`)}),Ma=H({name:"RowRange",pattern:new RegExp(`${Ja}${Ln}${Ja}`)}),wa=H({name:"ProcedureName",pattern:new RegExp(`([${zs}][${ca}]*)\\(`)}),Ni=new Hg,tr=H({name:"CellReference",pattern:Ni.match.bind(Ni),start_chars_hint:Ni.POSSIBLE_START_CHARACTERS,line_breaks:!1}),Si=new Wg,Bh=H({name:"NamedExpression",pattern:Si.match.bind(Si),start_chars_hint:Si.POSSIBLE_START_CHARACTERS,line_breaks:!1}),_a=s=>{const e=s.translationPackage.getFunctionTranslation("OFFSET"),t=s.errorMapping,r=s.translationPackage.buildFunctionMapping(),n=new RegExp(s.ignoreWhiteSpace==="standard"?kp:Bp),i=H({name:"WhiteSpace",pattern:n}),a=H({name:"ArrayRowSep",pattern:s.arrayRowSeparator}),o=H({name:"ArrayColSep",pattern:s.arrayColumnSeparator}),u=H({name:"NumberLiteral",pattern:new RegExp(`(([${s.decimalSeparator}]\\d+)|(\\d+([${s.decimalSeparator}]\\d*)?))(e[+-]?\\d+)?`)}),l=H({name:"OffsetProcedureName",pattern:new RegExp(e,"i")});let c,d;s.functionArgSeparator===s.arrayColumnSeparator?(c=o,d=[]):s.functionArgSeparator===s.arrayRowSeparator?(c=a,d=[]):(c=H({name:"ArgSeparator",pattern:s.functionArgSeparator}),d=[c]);const f=[i,Bi,ki,Ih,Oh,Gi,Hi,wh,Mh,Fh,Uh,_h,Lh,Wi,ls,xh,Ph,l,wa,yn,...d,Oa,Ma,u,Vh,Dh,bh,hr,An,ri,tr,Bh,a,o];return{ArgSeparator:c,NumberLiteral:u,OffsetProcedureName:l,ArrayRowSeparator:a,ArrayColSeparator:o,WhiteSpace:i,allTokens:f,errorMapping:t,functionMapping:r,decimalSeparator:s.decimalSeparator,maxColumns:s.maxColumns,maxRows:s.maxRows}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Gr extends gg{constructor(e,t){super(e.allTokens,{outputCst:!1,maxLookahead:7}),this.booleanExpressionOrEmpty=this.RULE("booleanExpressionOrEmpty",()=>this.OR([{ALT:()=>this.SUBRULE(this.booleanExpression)},{ALT:mg(Eg())}])),this.procedureExpression=this.RULE("procedureExpression",()=>{var r;const n=this.CONSUME(wa),i=n.image.toUpperCase().slice(0,-1),a=(r=this.lexerConfig.functionMapping[i])!==null&&r!==void 0?r:i,o=[];let u=this.SUBRULE(this.booleanExpressionOrEmpty);this.MANY(()=>{var c;const d=this.CONSUME(this.lexerConfig.ArgSeparator);u.type===g.EMPTY&&(u.leadingWhitespace=(c=d.leadingWhitespace)===null||c===void 0?void 0:c.image),o.push(u),u=this.SUBRULE2(this.booleanExpressionOrEmpty)}),o.push(u),o.length===1&&o[0].type===g.EMPTY&&(o.length=0);const l=this.CONSUME(ls);return Vg(a,o,n.leadingWhitespace,l.leadingWhitespace)}),this.namedExpressionExpression=this.RULE("namedExpressionExpression",()=>{const r=this.CONSUME(Bh);return Dg(r.image,r.leadingWhitespace)}),this.offsetProcedureExpression=this.RULE("offsetProcedureExpression",()=>{const r=[];return this.CONSUME(this.lexerConfig.OffsetProcedureName),this.CONSUME(Wi),this.MANY_SEP({SEP:this.lexerConfig.ArgSeparator,DEF:()=>{r.push(this.SUBRULE(this.booleanExpression))}}),this.CONSUME(ls),this.handleOffsetHeuristic(r)}),this.columnRangeExpression=this.RULE("columnRangeExpression",()=>{const r=this.CONSUME(Oa),[n,i]=r.image.split(":"),a=this.ACTION(()=>Rs(this.sheetMapping,n,this.formulaAddress)),o=this.ACTION(()=>Rs(this.sheetMapping,i,this.formulaAddress));if(a===void 0||o===void 0)return _t(new p(m.REF));if(a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns)||o.exceedsSheetSizeLimits(this.lexerConfig.maxColumns))return _r(r.image,new p(m.NAME),r.leadingWhitespace);if(a.sheet===void 0&&o.sheet!==void 0)return this.parsingError(ce.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:l,sheetRefType:c}=Gr.fixSheetIdsForRangeEnds(a,o);return Ng(u,l,c,r.leadingWhitespace)}),this.rowRangeExpression=this.RULE("rowRangeExpression",()=>{const r=this.CONSUME(Ma),[n,i]=r.image.split(":"),a=this.ACTION(()=>Ts(this.sheetMapping,n,this.formulaAddress)),o=this.ACTION(()=>Ts(this.sheetMapping,i,this.formulaAddress));if(a===void 0||o===void 0)return _t(new p(m.REF));if(a.exceedsSheetSizeLimits(this.lexerConfig.maxRows)||o.exceedsSheetSizeLimits(this.lexerConfig.maxRows))return _r(r.image,new p(m.NAME),r.leadingWhitespace);if(a.sheet===void 0&&o.sheet!==void 0)return this.parsingError(ce.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:l,sheetRefType:c}=Gr.fixSheetIdsForRangeEnds(a,o);return Sg(u,l,c,r.leadingWhitespace)}),this.cellReference=this.RULE("cellReference",()=>{const r=this.CONSUME(tr),n=this.ACTION(()=>br(this.sheetMapping,r.image,this.formulaAddress));return n===void 0?_r(r.image,new p(m.REF),r.leadingWhitespace):n.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?_r(r.image,new p(m.NAME),r.leadingWhitespace):_o(n,r.leadingWhitespace)}),this.endRangeReference=this.RULE("endRangeReference",r=>{var n;const i=this.CONSUME(tr),a=this.ACTION(()=>br(this.sheetMapping,r.image,this.formulaAddress)),o=this.ACTION(()=>br(this.sheetMapping,i.image,this.formulaAddress));return a===void 0||o===void 0?this.ACTION(()=>_r(`${r.image}:${i.image}`,new p(m.REF),r.leadingWhitespace)):a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)||o.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?this.ACTION(()=>_r(`${r.image}:${i.image}`,new p(m.NAME),r.leadingWhitespace)):this.buildCellRange(a,o,(n=r.leadingWhitespace)===null||n===void 0?void 0:n.image)}),this.endOfRangeExpression=this.RULE("endOfRangeExpression",r=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeReference,{ARGS:[r]})},{ALT:()=>{var n;const i=this.SUBRULE(this.offsetProcedureExpression),a=this.ACTION(()=>br(this.sheetMapping,r.image,this.formulaAddress));return a===void 0?_t(new p(m.REF)):i.type===g.CELL_REFERENCE?this.buildCellRange(a,i.reference,(n=r.leadingWhitespace)===null||n===void 0?void 0:n.image):this.parsingError(ce.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.cellRangeExpression=this.RULE("cellRangeExpression",()=>{const r=this.CONSUME(tr);return this.CONSUME2(yn),this.SUBRULE(this.endOfRangeExpression,{ARGS:[r]})}),this.endRangeWithOffsetStartReference=this.RULE("endRangeWithOffsetStartReference",r=>{const n=this.CONSUME(tr),i=this.ACTION(()=>br(this.sheetMapping,n.image,this.formulaAddress));return i===void 0?this.ACTION(()=>_t(new p(m.REF))):this.buildCellRange(r.reference,i,r.leadingWhitespace)}),this.endOfRangeWithOffsetStartExpression=this.RULE("endOfRangeWithOffsetStartExpression",r=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeWithOffsetStartReference,{ARGS:[r]})},{ALT:()=>{const n=this.SUBRULE(this.offsetProcedureExpression);return n.type===g.CELL_REFERENCE?this.buildCellRange(r.reference,n.reference,r.leadingWhitespace):this.parsingError(ce.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.offsetExpression=this.RULE("offsetExpression",()=>{const r=this.SUBRULE(this.offsetProcedureExpression);let n;return this.OPTION(()=>{this.CONSUME(yn),r.type===g.CELL_RANGE?n=this.parsingError(ce.RangeOffsetNotAllowed,"Range offset not allowed here"):n=this.SUBRULE(this.endOfRangeWithOffsetStartExpression,{ARGS:[r]})}),n!==void 0?n:r}),this.insideArrayExpression=this.RULE("insideArrayExpression",()=>{const r=[[]];return r[r.length-1].push(this.SUBRULE(this.booleanExpression)),this.MANY(()=>{this.OR([{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayColSeparator),r[r.length-1].push(this.SUBRULE2(this.booleanExpression))}},{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayRowSeparator),r.push([]),r[r.length-1].push(this.SUBRULE3(this.booleanExpression))}}])}),Fo(r)}),this.parenthesisExpression=this.RULE("parenthesisExpression",()=>{const r=this.CONSUME(Wi),n=this.SUBRULE(this.booleanExpression),i=this.CONSUME(ls);return Bg(n,r.leadingWhitespace,i.leadingWhitespace)}),this.arrayExpression=this.RULE("arrayExpression",()=>this.OR([{ALT:()=>{const r=this.CONSUME(xh),n=this.SUBRULE(this.insideArrayExpression),i=this.CONSUME(Ph);return Fo(n.args,r.leadingWhitespace,i.leadingWhitespace)}},{ALT:()=>this.SUBRULE(this.parenthesisExpression)}])),this.numericStringToNumber=r=>{const n=r.replace(this.lexerConfig.decimalSeparator,".");return Number(n)},this.positiveAtomicExpression=this.RULE("positiveAtomicExpression",()=>{var r;return this.OR((r=this.atomicExpCache)!==null&&r!==void 0?r:this.atomicExpCache=[{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.SUBRULE(this.cellRangeExpression)},{ALT:()=>this.SUBRULE(this.columnRangeExpression)},{ALT:()=>this.SUBRULE(this.rowRangeExpression)},{ALT:()=>this.SUBRULE(this.offsetExpression)},{ALT:()=>this.SUBRULE(this.cellReference)},{ALT:()=>this.SUBRULE(this.procedureExpression)},{ALT:()=>this.SUBRULE(this.namedExpressionExpression)},{ALT:()=>{const n=this.CONSUME(this.lexerConfig.NumberLiteral);return Rg(this.numericStringToNumber(n.image),n.leadingWhitespace)}},{ALT:()=>{const n=this.CONSUME(Vh);return Tg(n)}},{ALT:()=>{const n=this.CONSUME(Dh),i=n.image.toUpperCase(),a=this.lexerConfig.errorMapping[i];return a?_t(new p(a),n.leadingWhitespace):this.parsingError(ce.ParserError,"Unknown error literal")}}])}),this.rightUnaryOpAtomicExpression=this.RULE("rightUnaryOpAtomicExpression",()=>{const r=this.SUBRULE(this.positiveAtomicExpression),n=this.OPTION(()=>this.CONSUME(Mh));return n?Pg(r,n.leadingWhitespace):r}),this.atomicExpression=this.RULE("atomicExpression",()=>this.OR([{ALT:()=>{const r=this.CONSUME(An),n=this.SUBRULE(this.atomicExpression);return Q(r,Bi)?xg(n,r.leadingWhitespace):Q(r,ki)?bg(n,r.leadingWhitespace):(this.customParsingError=wo(ce.ParserError,"Mismatched token type"),this.customParsingError)}},{ALT:()=>this.SUBRULE2(this.rightUnaryOpAtomicExpression)}])),this.powerExpression=this.RULE("powerExpression",()=>{let r=this.SUBRULE(this.atomicExpression);return this.MANY(()=>{const n=this.CONSUME(Gi),i=this.SUBRULE2(this.atomicExpression);Q(n,Gi)?r=Ug(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{let r=this.SUBRULE(this.powerExpression);return this.MANY(()=>{const n=this.CONSUME(ri),i=this.SUBRULE2(this.powerExpression);Q(n,Ih)?r=Lg(r,i,n.leadingWhitespace):Q(n,Oh)?r=Fg(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.additionExpression=this.RULE("additionExpression",()=>{let r=this.SUBRULE(this.multiplicationExpression);return this.MANY(()=>{const n=this.CONSUME(An),i=this.SUBRULE2(this.multiplicationExpression);Q(n,Bi)?r=wg(r,i,n.leadingWhitespace):Q(n,ki)?r=_g(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.concatenateExpression=this.RULE("concatenateExpression",()=>{let r=this.SUBRULE(this.additionExpression);return this.MANY(()=>{const n=this.CONSUME(bh),i=this.SUBRULE2(this.additionExpression);r=Ag(r,i,n.leadingWhitespace)}),r}),this.booleanExpression=this.RULE("booleanExpression",()=>{let r=this.SUBRULE(this.concatenateExpression);return this.MANY(()=>{const n=this.CONSUME(hr),i=this.SUBRULE2(this.concatenateExpression);Q(n,Hi)?r=yg(r,i,n.leadingWhitespace):Q(n,wh)?r=Cg(r,i,n.leadingWhitespace):Q(n,_h)?r=vg(r,i,n.leadingWhitespace):Q(n,Lh)?r=Ig(r,i,n.leadingWhitespace):Q(n,Fh)?r=Og(r,i,n.leadingWhitespace):Q(n,Uh)?r=Mg(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.formula=this.RULE("formula",()=>(this.CONSUME(Hi),this.SUBRULE(this.booleanExpression))),this.lexerConfig=e,this.sheetMapping=t,this.formulaAddress=M(0,0,0),this.performSelfAnalysis()}parseFromTokens(e,t){this.input=e;let r=this.formulaWithContext(t),n=[];return this.customParsingError&&n.push(this.customParsingError),n=n.concat(this.errors.map(i=>({type:ce.ParserError,message:i.message}))),n.length>0&&(r=Di()),{ast:r,errors:n}}reset(){super.reset(),this.customParsingError=void 0}formulaWithContext(e){return this.formulaAddress=e,this.formula()}buildCellRange(e,t,r){if(e.sheet===void 0&&t.sheet!==void 0)return this.parsingError(ce.ParserError,"Malformed range expression");const{firstEnd:n,secondEnd:i,sheetRefType:a}=Gr.fixSheetIdsForRangeEnds(e,t);return Lo(n,i,a,r)}static fixSheetIdsForRangeEnds(e,t){const r=Gr.rangeSheetReferenceType(e.sheet,t.sheet),n=e.sheet!==void 0&&t.sheet===void 0?t.withSheet(e.sheet):t;return{firstEnd:e,secondEnd:n,sheetRefType:r}}handleOffsetHeuristic(e){var t;const r=e[0];if(r.type!==g.CELL_REFERENCE)return this.parsingError(ce.StaticOffsetError,"First argument to OFFSET is not a reference");const n=e[1];let i;if(n.type===g.NUMBER&&Number.isInteger(n.value))i=n.value;else if(n.type===g.PLUS_UNARY_OP&&n.value.type===g.NUMBER&&Number.isInteger(n.value.value))i=n.value.value;else if(n.type===g.MINUS_UNARY_OP&&n.value.type===g.NUMBER&&Number.isInteger(n.value.value))i=-n.value.value;else return this.parsingError(ce.StaticOffsetError,"Second argument to OFFSET is not a static number");const a=e[2];let o;if(a.type===g.NUMBER&&Number.isInteger(a.value))o=a.value;else if(a.type===g.PLUS_UNARY_OP&&a.value.type===g.NUMBER&&Number.isInteger(a.value.value))o=a.value.value;else if(a.type===g.MINUS_UNARY_OP&&a.value.type===g.NUMBER&&Number.isInteger(a.value.value))o=-a.value.value;else return this.parsingError(ce.StaticOffsetError,"Third argument to OFFSET is not a static number");const u=e[3];let l;if(u===void 0)l=1;else if(u.type===g.NUMBER){if(l=u.value,l<1)return this.parsingError(ce.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(l))return this.parsingError(ce.StaticOffsetError,"Fourth argument to OFFSET is not integer")}else return this.parsingError(ce.StaticOffsetError,"Fourth argument to OFFSET is not a static number");const c=e[4];let d;if(c===void 0)d=1;else if(c.type===g.NUMBER){if(d=c.value,d<1)return this.parsingError(ce.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(d))return this.parsingError(ce.StaticOffsetError,"Fifth argument to OFFSET is not integer")}else return this.parsingError(ce.StaticOffsetError,"Fifth argument to OFFSET is not a static number");const f=new Z(r.reference.col+o,r.reference.row+i,r.reference.type,(t=r.reference.sheet)!==null&&t!==void 0?t:void 0);let E=f.col,N=f.row;if((r.reference.type===K.CELL_REFERENCE_RELATIVE||r.reference.type===K.CELL_REFERENCE_ABSOLUTE_COL)&&(N=N+this.formulaAddress.row),(r.reference.type===K.CELL_REFERENCE_RELATIVE||r.reference.type===K.CELL_REFERENCE_ABSOLUTE_ROW)&&(E=E+this.formulaAddress.col),E<0||N<0)return _t(new p(m.REF,T.OutOfSheet));if(d===1&&l===1)return _o(f);{const R=new Z(f.col+d-1,f.row+l-1,f.type,f.sheet),A=r.reference.sheet==null?Je.RELATIVE:Je.BOTH_ABSOLUTE;return Lo(f,R,A)}}parsingError(e,t){return this.customParsingError=wo(e,t),Di()}static rangeSheetReferenceType(e,t){return e===void 0?Je.RELATIVE:t===void 0?Je.START_ABSOLUTE:Je.BOTH_ABSOLUTE}}class Ls{constructor(e){this.lexerConfig=e,this.lexer=new $e(e.allTokens,{ensureOptimizations:!0})}tokenizeFormula(e){const t=this.lexer.tokenize(e);let r=t.tokens;return r=this.trimTrailingWhitespaces(r),r=this.skipWhitespacesInsideRanges(r),r=this.skipWhitespacesBeforeArgSeparators(r),t.tokens=r,t}skipWhitespacesInsideRanges(e){return Ls.filterTokensByNeighbors(e,(t,r,n)=>(Q(t,tr)||Q(t,yn))&&Q(r,this.lexerConfig.WhiteSpace)&&(Q(n,tr)||Q(n,yn)))}skipWhitespacesBeforeArgSeparators(e){return Ls.filterTokensByNeighbors(e,(t,r,n)=>!Q(t,this.lexerConfig.ArgSeparator)&&Q(r,this.lexerConfig.WhiteSpace)&&Q(n,this.lexerConfig.ArgSeparator))}static filterTokensByNeighbors(e,t){if(e.length<3)return e;let r=0;const n=[e[r++]];for(;r<e.length-1;)t(e[r-1],e[r],e[r+1])||n.push(e[r]),++r;return n.push(e[r]),n}trimTrailingWhitespaces(e){return e.length>0&&Q(e[e.length-1],this.lexerConfig.WhiteSpace)&&e.pop(),e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class kh{constructor(e,t,r,n){this.config=e,this.lexerConfig=t,this.sheetMappingFn=r,this.namedExpressions=n}unparse(e,t){return"="+this.unparseAst(e,t)}unparseAst(e,t){var r,n;switch(e.type){case g.EMPTY:return W("",e.leadingWhitespace);case g.NUMBER:return W(Gh(e.value,this.config.decimalSeparator),e.leadingWhitespace);case g.STRING:return W('"'+e.value+'"',e.leadingWhitespace);case g.FUNCTION_CALL:{const i=e.args.map(u=>u!==void 0?this.unparseAst(u,t):"").join(this.config.functionArgSeparator),o=(this.config.translationPackage.isFunctionTranslated(e.procedureName)?this.config.translationPackage.getFunctionTranslation(e.procedureName):e.procedureName)+"("+i+W(")",e.internalWhitespace);return W(o,e.leadingWhitespace)}case g.NAMED_EXPRESSION:{const i=(r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.sheet))===null||r===void 0?void 0:r.displayName;return W(i||e.expressionName,e.leadingWhitespace)}case g.CELL_REFERENCE:{let i;return e.reference.sheet!==void 0?i=this.unparseSheetName(e.reference.sheet)+"!":i="",i+=(n=e.reference.unparse(t))!==null&&n!==void 0?n:this.config.translationPackage.getErrorTranslation(m.REF),W(i,e.leadingWhitespace)}case g.COLUMN_RANGE:case g.ROW_RANGE:case g.CELL_RANGE:return W(this.formatRange(e,t),e.leadingWhitespace);case g.PLUS_UNARY_OP:{const i=this.unparseAst(e.value,t);return W("+",e.leadingWhitespace)+i}case g.MINUS_UNARY_OP:{const i=this.unparseAst(e.value,t);return W("-",e.leadingWhitespace)+i}case g.PERCENT_OP:return this.unparseAst(e.value,t)+W("%",e.leadingWhitespace);case g.ERROR:{const i=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:m.ERROR);return W(i,e.leadingWhitespace)}case g.ERROR_WITH_RAW_INPUT:return W(e.rawInput,e.leadingWhitespace);case g.PARENTHESIS:{const a="("+this.unparseAst(e.expression,t)+W(")",e.internalWhitespace);return W(a,e.leadingWhitespace)}case g.ARRAY:{const i="{"+e.args.map(a=>a.map(o=>this.unparseAst(o,t)).join(this.config.arrayColumnSeparator)).join(this.config.arrayRowSeparator)+W("}",e.internalWhitespace);return W(i,e.leadingWhitespace)}default:{const i=this.unparseAst(e.left,t),a=this.unparseAst(e.right,t);return i+W(vh[e.type],e.leadingWhitespace)+a}}}unparseSheetName(e){const t=Du(e,this.sheetMappingFn);if(t===void 0)throw new ae(e);return t}formatRange(e,t){let r="",n="";e.start.sheet!==void 0&&e.sheetReferenceType!==Je.RELATIVE&&(r=this.unparseSheetName(e.start.sheet)+"!"),e.end.sheet!==void 0&&e.sheetReferenceType===Je.BOTH_ABSOLUTE&&(n=this.unparseSheetName(e.end.sheet)+"!");const i=e.start.unparse(t),a=e.end.unparse(t);return i===void 0||a===void 0?this.config.translationPackage.getErrorTranslation(m.REF):`${r}${i}:${n}${a}`}}function Gh(s,e){return s.toString().replace(".",e)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mn{constructor(e,t,r){this.config=e,this.functionRegistry=t,this.sheetMapping=r,this.statsCacheUsed=0,this.lexerConfig=_a(e),this.lexer=new Ls(this.lexerConfig),this.formulaParser=new Gr(this.lexerConfig,this.sheetMapping),this.cache=new Gg(this.functionRegistry)}parse(e,t){this.formulaAddress=t;const r=this.tokenizeFormula(e);if(r.errors.length>0){const d=r.errors.map(f=>({type:ce.LexingError,message:f.message}));return{ast:Di(),errors:d,hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]}}const n=this.computeHashFromTokens(r.tokens,t);let i=this.cache.get(n);if(i!==void 0)++this.statsCacheUsed;else{const d=this.bindWhitespacesToTokens(r.tokens),f=this.formulaParser.parseFromTokens(d,t);if(f.errors.length>0)return Object.assign(Object.assign({},f),{hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]});i=this.cache.set(n,f.ast)}const{ast:a,hasVolatileFunction:o,hasStructuralChangeFunction:u}=i,l=this.convertReversedRangesToRegularRanges(a),c=ni(l,this.functionRegistry);return{ast:l,errors:[],hasVolatileFunction:o,hasStructuralChangeFunction:u,dependencies:c}}convertReversedRangesToRegularRanges(e){switch(e.type){case g.EMPTY:case g.NUMBER:case g.STRING:case g.ERROR:case g.ERROR_WITH_RAW_INPUT:case g.CELL_REFERENCE:case g.NAMED_EXPRESSION:return e;case g.CELL_RANGE:{const{start:t,end:r}=e,n=this.orderCellRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case g.COLUMN_RANGE:{const{start:t,end:r}=e,n=this.orderColumnRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case g.ROW_RANGE:{const{start:t,end:r}=e,n=this.orderRowRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case g.PERCENT_OP:case g.PLUS_UNARY_OP:case g.MINUS_UNARY_OP:{const t=this.convertReversedRangesToRegularRanges(e.value);return Object.assign(Object.assign({},e),{value:t})}case g.CONCATENATE_OP:case g.EQUALS_OP:case g.NOT_EQUAL_OP:case g.LESS_THAN_OP:case g.GREATER_THAN_OP:case g.LESS_THAN_OR_EQUAL_OP:case g.GREATER_THAN_OR_EQUAL_OP:case g.MINUS_OP:case g.PLUS_OP:case g.TIMES_OP:case g.DIV_OP:case g.POWER_OP:{const t=this.convertReversedRangesToRegularRanges(e.left),r=this.convertReversedRangesToRegularRanges(e.right);return Object.assign(Object.assign({},e),{left:t,right:r})}case g.PARENTHESIS:{const t=this.convertReversedRangesToRegularRanges(e.expression);return Object.assign(Object.assign({},e),{expression:t})}case g.FUNCTION_CALL:{const t=e.args.map(r=>this.convertReversedRangesToRegularRanges(r));return Object.assign(Object.assign({},e),{args:t})}case g.ARRAY:{const t=e.args.map(r=>r.map(n=>this.convertReversedRangesToRegularRanges(n)));return Object.assign(Object.assign({},e),{args:t})}}}orderCellRangeEnds(e,t){const r=[e,t],[n,i]=r.map(c=>c.toColumnAddress()).sort(De.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(c=>c.toRowAddress()).sort(Ue.compareByAbsoluteAddress(this.formulaAddress)),[u,l]=r.map(c=>c.sheet).sort(mn.compareSheetIds.bind(this));return{start:Z.fromColAndRow(n,a,u),end:Z.fromColAndRow(i,o,l)}}orderColumnRangeEnds(e,t){const r=[e,t],[n,i]=r.sort(De.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(u=>u.sheet).sort(mn.compareSheetIds.bind(this));return{start:new De(n.type,n.col,a),end:new De(i.type,i.col,o)}}orderRowRangeEnds(e,t){const r=[e,t],[n,i]=r.sort(Ue.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(u=>u.sheet).sort(mn.compareSheetIds.bind(this));return{start:new Ue(n.type,n.row,a),end:new Ue(i.type,i.row,o)}}static compareSheetIds(e,t){return e=e??1/0,t=t??1/0,e-t}fetchCachedResultForAst(e){const t=this.computeHashFromAst(e);return this.fetchCachedResult(t)}fetchCachedResult(e){const t=this.cache.get(e);if(t===void 0)throw new Error("There is no AST with such key in the cache");{const{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,relativeDependencies:a}=t;return{ast:r,errors:[],hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}}}computeHashFromTokens(e,t){var r;let n="",i=0;for(;i<e.length;){const a=e[i];if(Q(a,tr)){const o=br(this.sheetMapping,a.image,t);o===void 0?n=n.concat(a.image):n=n.concat(o.hash(!0))}else if(Q(a,wa)){const o=a.image.toUpperCase().slice(0,-1),u=(r=this.lexerConfig.functionMapping[o])!==null&&r!==void 0?r:o;n=n.concat(u,"(")}else if(Q(a,Oa)){const[o,u]=a.image.split(":"),l=Rs(this.sheetMapping,o,t),c=Rs(this.sheetMapping,u,t);l===void 0||c===void 0?n=n.concat("!REF"):n=n.concat(l.hash(!0),":",c.hash(!0))}else if(Q(a,Ma)){const[o,u]=a.image.split(":"),l=Ts(this.sheetMapping,o,t),c=Ts(this.sheetMapping,u,t);l===void 0||c===void 0?n=n.concat("!REF"):n=n.concat(l.hash(!0),":",c.hash(!0))}else n=n.concat(a.image);i++}return n}rememberNewAst(e){const t=this.computeHashFromAst(e);return this.cache.maybeSetAndThenGet(t,e)}computeHashFromAst(e){return"="+this.computeHashOfAstNode(e)}computeHashOfAstNode(e){switch(e.type){case g.EMPTY:return e.leadingWhitespace||"";case g.NUMBER:return W(Gh(e.value,this.config.decimalSeparator),e.leadingWhitespace);case g.STRING:return W('"'+e.value+'"',e.leadingWhitespace);case g.NAMED_EXPRESSION:return W(e.expressionName,e.leadingWhitespace);case g.FUNCTION_CALL:{const t=e.args.map(n=>this.computeHashOfAstNode(n)).join(this.config.functionArgSeparator),r=e.procedureName+"("+t+W(")",e.internalWhitespace);return W(r,e.leadingWhitespace)}case g.CELL_REFERENCE:return W(e.reference.hash(!0),e.leadingWhitespace);case g.COLUMN_RANGE:case g.ROW_RANGE:case g.CELL_RANGE:{const t=e.start.hash(e.sheetReferenceType!==Je.RELATIVE),r=e.end.hash(e.sheetReferenceType===Je.BOTH_ABSOLUTE);return W(t+":"+r,e.leadingWhitespace)}case g.MINUS_UNARY_OP:return W("-"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case g.PLUS_UNARY_OP:return W("+"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case g.PERCENT_OP:return this.computeHashOfAstNode(e.value)+W("%",e.leadingWhitespace);case g.ERROR:{const t=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:m.ERROR);return W(t,e.leadingWhitespace)}case g.ERROR_WITH_RAW_INPUT:return W(e.rawInput,e.leadingWhitespace);case g.ARRAY:{const t=e.args.map(r=>r.map(n=>this.computeHashOfAstNode(n)).join(",")).join(";");return W("{"+t+W("}",e.internalWhitespace),e.leadingWhitespace)}case g.PARENTHESIS:{const r="("+this.computeHashOfAstNode(e.expression)+W(")",e.internalWhitespace);return W(r,e.leadingWhitespace)}default:return this.computeHashOfAstNode(e.left)+W(vh[e.type],e.leadingWhitespace)+this.computeHashOfAstNode(e.right)}}bindWhitespacesToTokens(e){const t=[],r=e[0];Q(r,this.lexerConfig.WhiteSpace)||t.push(r);for(let n=1;n<e.length;++n){const i=e[n];if(Q(i,this.lexerConfig.WhiteSpace))continue;const a=e[n-1];Q(a,this.lexerConfig.WhiteSpace)&&(i.leadingWhitespace=a),t.push(i)}return t}tokenizeFormula(e){return this.lexer.tokenizeFormula(e)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const xr=(s,e,t,r)=>{switch(s.type){case g.EMPTY:case g.NUMBER:case g.STRING:case g.ERROR:return;case g.NAMED_EXPRESSION:{r&&t.push(new Wt(s.expressionName));return}case g.CELL_REFERENCE:{r&&t.push(new Hh(s.reference));return}case g.CELL_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new Yg(s.start,s.end));return}case g.COLUMN_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new zg(s.start,s.end));return}case g.ROW_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new Xg(s.start,s.end));return}case g.PERCENT_OP:case g.PLUS_UNARY_OP:case g.MINUS_UNARY_OP:{xr(s.value,e,t,!0);return}case g.CONCATENATE_OP:case g.EQUALS_OP:case g.NOT_EQUAL_OP:case g.LESS_THAN_OP:case g.GREATER_THAN_OP:case g.LESS_THAN_OR_EQUAL_OP:case g.GREATER_THAN_OR_EQUAL_OP:case g.MINUS_OP:case g.PLUS_OP:case g.TIMES_OP:case g.DIV_OP:case g.POWER_OP:xr(s.left,e,t,!0),xr(s.right,e,t,!0);return;case g.PARENTHESIS:xr(s.expression,e,t,r);return;case g.FUNCTION_CALL:{const n=!e.doesFunctionNeedArgumentToBeComputed(s.procedureName);s.args.forEach(i=>xr(i,e,t,n));return}}},ni=(s,e)=>{const t=new Array;return xr(s,e,t,!0),t};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Hh{constructor(e){this.dependency=e}absolutize(e){return this.dependency.toSimpleCellAddress(e)}}class Yg{constructor(e,t){this.start=e,this.end=t}absolutize(e){return new F(this.start.toSimpleCellAddress(e),this.end.toSimpleCellAddress(e))}}class zg{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleColumnAddress(e),r=this.end.toSimpleColumnAddress(e);return new Yt(t.sheet,t.col,r.col)}}class Xg{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleRowAddress(e),r=this.end.toSimpleRowAddress(e);return new zt(t.sheet,t.row,r.row)}}class Wt{constructor(e){this.name=e}absolutize(e){return this}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Lt=(s,e)=>s.map(t=>t.absolutize(e)),$g=s=>s.filter(e=>e instanceof Wt?!0:e instanceof F?!(ze(e.start)||ze(e.end)):!ze(e));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const B=Symbol("Empty value");function I(s){return s instanceof Dt?s.val:s}class Dt{constructor(e,t){this.val=e,this.format=t}fromNumber(e){return new this.constructor(e)}}function La(s,e){if(typeof s=="number")return e;{const t=s.fromNumber(e);return t.format=s.format,t}}class Fa extends Dt{getDetailedType(){return L.NUMBER_DATE}}class Yi extends Dt{getDetailedType(){return L.NUMBER_CURRENCY}}class Ua extends Dt{getDetailedType(){return L.NUMBER_TIME}}class ba extends Dt{getDetailedType(){return L.NUMBER_DATETIME}}class cs extends Dt{getDetailedType(){return L.NUMBER_PERCENT}}function z(s){return typeof s=="number"||s instanceof Dt}var L;(function(s){s.NUMBER_RAW="NUMBER_RAW",s.NUMBER_DATE="NUMBER_DATE",s.NUMBER_TIME="NUMBER_TIME",s.NUMBER_DATETIME="NUMBER_DATETIME",s.NUMBER_CURRENCY="NUMBER_CURRENCY",s.NUMBER_PERCENT="NUMBER_PERCENT"})(L||(L={}));function Kg(s){return s instanceof Dt?s.getDetailedType():L.NUMBER_RAW}function jg(s){if(s instanceof Dt)return s.format}function Fs(s){return s instanceof Dt?{type:s.getDetailedType(),format:s.format}:{type:L.NUMBER_RAW}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class w{constructor(e,t,r,n){this._data=e,this.range=t,this.dependencyGraph=r,this._hasOnlyNumbers=n,this.size=e===void 0?new V(t.effectiveWidth(r),t.effectiveHeight(r)):new V(e[0].length,e.length)}get data(){return this.ensureThatComputed(),this._data}static fromRange(e,t,r){return new w(e,t,r,!0)}static onlyNumbers(e){return new w(e,void 0,void 0,!0)}static onlyValues(e){return new w(e,void 0,void 0,void 0)}static onlyRange(e,t){return new w(void 0,e,t,void 0)}static fromScalar(e){return new w([[e]],void 0,void 0,void 0)}isAdHoc(){return this.range===void 0}width(){return this.size.width}height(){return this.size.height}valuesFromTopLeftCorner(){this.ensureThatComputed();const e=[];for(let t=0;t<this._data.length;t++)for(let r=0;r<this._data[0].length;r++)e.push(this._data[t][r]);return e}*effectiveAddressesFromData(e){for(let t=0;t<this.data.length;++t){const r=this.data[t];for(let n=0;n<r.length;++n)yield M(e.sheet,e.col+n,e.row+t)}}*entriesFromTopLeftCorner(e){this.ensureThatComputed();for(let t=0;t<this.size.height;++t)for(let r=0;r<this.size.width;++r)yield[this._data[t][r],M(e.sheet,e.col+r,e.row+t)]}*iterateValuesFromTopLeftCorner(){yield*this.valuesFromTopLeftCorner()}numberOfElements(){return this.size.width*this.size.height}hasOnlyNumbers(){if(this._hasOnlyNumbers===void 0){this._hasOnlyNumbers=!0;for(const e of this.data)for(const t of e)if(typeof t!="number")return this._hasOnlyNumbers=!1,!1}return this._hasOnlyNumbers}rawNumbers(){return this._data}rawData(){var e;return this.ensureThatComputed(),(e=this._data)!==null&&e!==void 0?e:[]}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}ensureThatComputed(){this._data===void 0&&(this._hasOnlyNumbers=!0,this._data=this.range.addressesArrayMap(this.dependencyGraph,e=>{const t=this.dependencyGraph.getCellValue(e);return t instanceof w?(this._hasOnlyNumbers=!1,new p(m.VALUE,T.ScalarExpected)):(z(t)||(this._hasOnlyNumbers=!1),t)}))}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class nr{constructor(){this.changes=new Map}static empty(){return new nr}addAll(e){for(const t of e.changes.values())this.add(t.address,t);return this}addChange(e,t,r){this.addInterpreterValue(e,t,r)}exportChanges(e){let t=[];return this.changes.forEach(r=>{const n=e.exportChange(r);Array.isArray(n)?t=t.concat(n):t.push(n)}),t}getChanges(){return Array.from(this.changes.values())}isEmpty(){return this.changes.size===0}add(e,t){const r=t.value;if(r instanceof w)for(const n of r.effectiveAddressesFromData(e))this.changes.delete(gn(n));this.changes.set(gn(e),t)}addInterpreterValue(e,t,r){this.add(t,{address:t,value:e,oldValue:r})}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Xe{constructor(e,t,r){if(this.sheet=e,this.rowStart=t,this.rowEnd=r,t<0)throw Error("Starting row cant be less than 0");if(r<t)throw Error("Row span cant end before start")}get numberOfRows(){return this.rowEnd-this.rowStart+1}get start(){return this.rowStart}get end(){return this.rowEnd}static fromNumberOfRows(e,t,r){return new Xe(e,t,t+r-1)}static fromRowStartAndEnd(e,t,r){return new Xe(e,t,r)}*rows(){for(let e=this.rowStart;e<=this.rowEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.rowStart,e.rowStart),r=Math.min(this.rowEnd,e.rowEnd);return t>r?null:new Xe(this.sheet,t,r)}firstRow(){return new Xe(this.sheet,this.rowStart,this.rowStart)}}class et{constructor(e,t,r){if(this.sheet=e,this.columnStart=t,this.columnEnd=r,t<0)throw Error("Starting column cant be less than 0");if(r<t)throw Error("Column span cant end before start")}get numberOfColumns(){return this.columnEnd-this.columnStart+1}get start(){return this.columnStart}get end(){return this.columnEnd}static fromNumberOfColumns(e,t,r){return new et(e,t,t+r-1)}static fromColumnStartAndEnd(e,t,r){return new et(e,t,r)}*columns(){for(let e=this.columnStart;e<=this.columnEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.columnStart,e.columnStart),r=Math.min(this.columnEnd,e.columnEnd);return t>r?null:new et(this.sheet,t,r)}firstColumn(){return new et(this.sheet,this.columnStart,this.columnStart)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var x;(function(s){s.BUILD_ENGINE_TOTAL="BUILD_ENGINE_TOTAL",s.PARSER="PARSER",s.GRAPH_BUILD="GRAPH_BUILD",s.COLLECT_DEPENDENCIES="COLLECT_DEPENDENCIES",s.PROCESS_DEPENDENCIES="PROCESS_DEPENDENCIES",s.TOP_SORT="TOP_SORT",s.BUILD_COLUMN_INDEX="BUILD_COLUMN_INDEX",s.EVALUATION="EVALUATION",s.VLOOKUP="VLOOKUP",s.TRANSFORM_ASTS="TRANSFORM_ASTS",s.TRANSFORM_ASTS_POSTPONED="TRANSFORM_ASTS_POSTPONED",s.ADJUSTING_ADDRESS_MAPPING="ADJUSTING_ADDRESS_MAPPING",s.ADJUSTING_ARRAY_MAPPING="ADJUSTING_ARRAY_MAPPING",s.ADJUSTING_RANGES="ADJUSTING_RANGES",s.ADJUSTING_GRAPH="ADJUSTING_GRAPH",s.CRITERION_FUNCTION_FULL_CACHE_USED="CRITERION_FUNCTION_FULL_CACHE_USED",s.CRITERION_FUNCTION_PARTIAL_CACHE_USED="CRITERION_FUNCTION_PARTIAL_CACHE_USED"})(x||(x={}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Wh{constructor(){this.stats=new Map([[x.CRITERION_FUNCTION_FULL_CACHE_USED,0],[x.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0]]),this.startTimes=new Map}incrementCriterionFunctionFullCacheUsed(){var e;const t=((e=this.stats.get(x.CRITERION_FUNCTION_FULL_CACHE_USED))!==null&&e!==void 0?e:0)+1;this.stats.set(x.CRITERION_FUNCTION_FULL_CACHE_USED,t)}incrementCriterionFunctionPartialCacheUsed(){var e;const t=((e=this.stats.get(x.CRITERION_FUNCTION_PARTIAL_CACHE_USED))!==null&&e!==void 0?e:0)+1;this.stats.set(x.CRITERION_FUNCTION_PARTIAL_CACHE_USED,t)}reset(){this.stats.clear(),this.startTimes.clear(),this.stats.set(x.CRITERION_FUNCTION_FULL_CACHE_USED,0),this.stats.set(x.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0)}start(e){if(this.startTimes.get(e))throw Error(`Statistics ${e} already started`);this.startTimes.set(e,Date.now())}end(e){var t;const r=Date.now(),n=this.startTimes.get(e);if(n){let i=(t=this.stats.get(e))!==null&&t!==void 0?t:0;i+=r-n,this.stats.set(e,i),this.startTimes.delete(e)}else throw Error(`Statistics ${e} not started`)}measure(e,t){this.start(e);const r=t();return this.end(e),r}snapshot(){return new Map(this.stats)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class qg extends Wh{incrementCriterionFunctionFullCacheUsed(){}incrementCriterionFunctionPartialCacheUsed(){}start(e){}end(e){}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ae extends Error{constructor(e){super(`There's no sheet with id = ${e}`)}}class Yh extends Error{constructor(e){super(`There's no sheet with name '${e}'`)}}class Cn extends Error{constructor(e){super(`Sheet with name ${e} already exists`)}}class Nr extends Error{constructor(){super("Sheet size limit exceeded")}}class ds extends Error{constructor(){super("This is not a formula")}}class zh extends Error{constructor(e){super(`Address (row = ${e.row}, col = ${e.col}) is invalid`)}}class Re extends Error{constructor(e){super(`Invalid arguments, expected ${e}`)}}class vn extends Error{constructor(e,t){super(`Sheets ${e} and ${t} are not equal.`)}}class Xh extends Error{constructor(e){super(`Name of Named Expression '${e}' is already present`)}}class $h extends Error{constructor(e){super(`Name of Named Expression '${e}' is invalid`)}}class In extends Error{constructor(e){super(`Named Expression '${e}' does not exist`)}}class Kh extends Error{constructor(){super("There is no operation to undo")}}class jh extends Error{constructor(){super("There is no operation to redo")}}class qh extends Error{constructor(){super("There is nothing to paste")}}function Qg(s,e){switch(typeof e){case"function":case"symbol":return e.toString();case"bigint":return"BigInt("+e.toString()+")";default:return e instanceof RegExp?"RegExp("+e.toString()+")":e}}class Qh extends Error{constructor(e){super(`Unable to parse value: ${JSON.stringify(e,Qg,4)}`)}}class Y extends Error{constructor(e,t){super(`Expected value of type: ${e} for config parameter: ${t}`)}}class Zg extends Error{constructor(e){super(`Config parameter ${e} cannot be empty.`)}}class Zh extends Error{constructor(e,t){super(`Config parameter ${e} should be at least ${t}`)}}class Jh extends Error{constructor(e,t){super(`Config parameter ${e} should be at most ${t}`)}}class el extends Error{constructor(e,t){super(`Expected one of ${e} for config parameter: ${t}`)}}class tl extends Error{constructor(){super("Computations are suspended")}}class Pr extends Error{constructor(e){super(`Translation for ${e} is missing in the translation package you're using.`)}}class rl extends Error{constructor(e){super(`Cannot register translation for function with id: ${e}`)}}class zi extends Error{constructor(){super("Language not registered.")}}class nl extends Error{constructor(){super("Language already registered.")}}class Qr extends Error{static functionNotDeclaredInPlugin(e,t){return new Qr(`Function with id ${e} not declared in plugin ${t}`)}static functionMethodNotFound(e,t){return new Qr(`Function method ${e} not found in plugin ${t}`)}}class Sr extends Error{static cannotRegisterFunctionWithId(e){return new Sr(`Cannot register function with id ${e}`)}static cannotUnregisterFunctionWithId(e){return new Sr(`Cannot unregister function with id ${e}`)}static cannotUnregisterProtectedPlugin(){return new Sr("Cannot unregister protected plugin")}}class Hr extends Error{constructor(){super("Cannot perform this operation, source location has an array inside.")}}class Us extends Error{constructor(){super("Cannot perform this operation, target location has an array inside.")}}class xa extends Error{constructor(){super("Relative addresses not allowed in named expressions.")}}class Jg extends Error{constructor(e,t){super(`Alias id ${e} in plugin ${t} already defined as a function or alias.`)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class eE{constructor(e){this.policy=e,this.mapping=new Map}getCell(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new ae(e.sheet);return t.getCell(e)}fetchCell(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new ae(e.sheet);const r=t.getCell(e);if(!r)throw Error("Vertex for address missing in AddressMapping");return r}strategyFor(e){const t=this.mapping.get(e);if(t===void 0)throw new ae(e);return t}addSheet(e,t){if(this.mapping.has(e))throw Error("Sheet already added");this.mapping.set(e,t)}autoAddSheet(e,t){const{height:r,width:n,fill:i}=t,a=this.policy.call(i);this.addSheet(e,new a(n,r))}getCellValue(e){const t=this.getCell(e);return t===void 0?B:t instanceof fe?t.getArrayCellValue(e):t.getCellValue()}getRawValue(e){const t=this.getCell(e);return t instanceof sr?t.getValues().rawValue:t instanceof fe?t.getArrayCellRawValue(e):null}setCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized");r.setCell(e,t)}moveCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized.");if(e.sheet!==t.sheet)throw Error("Cannot move cells between sheets.");if(r.has(t))throw new Error("Cannot move cell. Destination already occupied.");const n=r.getCell(e);if(n===void 0)throw new Error("Cannot move cell. No cell with such address.");this.setCell(t,n),this.removeCell(e)}removeCell(e){const t=this.mapping.get(e.sheet);if(!t)throw Error("Sheet not initialized");t.removeCell(e)}has(e){const t=this.mapping.get(e.sheet);return t===void 0?!1:t.has(e)}getHeight(e){const t=this.mapping.get(e);if(t===void 0)throw new ae(e);return t.getHeight()}getWidth(e){const t=this.mapping.get(e);if(!t)throw new ae(e);return t.getWidth()}addRows(e,t,r){const n=this.mapping.get(e);if(n===void 0)throw new ae(e);n.addRows(t,r)}removeRows(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new ae(e.sheet);t.removeRows(e)}removeSheet(e){this.mapping.delete(e)}addColumns(e,t,r){const n=this.mapping.get(e);if(n===void 0)throw new ae(e);n.addColumns(t,r)}removeColumns(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new ae(e.sheet);t.removeColumns(e)}*verticesFromRowsSpan(e){yield*this.mapping.get(e.sheet).verticesFromRowsSpan(e)}*verticesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).verticesFromColumnsSpan(e)}*entriesFromRowsSpan(e){yield*this.mapping.get(e.sheet).entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).entriesFromColumnsSpan(e)}*entries(){for(const[e,t]of this.mapping.entries())yield*t.getEntries(e)}*sheetEntries(e){const t=this.mapping.get(e);if(t!==void 0)yield*t.getEntries(e);else throw new ae(e)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class tE{constructor(){this.arrayMapping=new Map}getArray(e){const t=this.getArrayByCorner(e.start);if(t?.getRange().sameAs(e))return t}getArrayByCorner(e){return this.arrayMapping.get(gn(e))}setArray(e,t){this.arrayMapping.set(gn(e.start),t)}removeArray(e){typeof e=="string"?this.arrayMapping.delete(e):this.arrayMapping.delete(gn(e.start))}count(){return this.arrayMapping.size}*arraysInRows(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetRows(e.sheet,e.rowStart,e.rowEnd)&&(yield[t,r])}*arraysInCols(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetColumn(e.sheet,e.columnStart,e.columnEnd)&&(yield[t,r])}isFormulaArrayInRow(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetRows(e,t))return!0;return!1}isFormulaArrayInAllRows(e){let t=!0;for(const r of e.rows())this.isFormulaArrayInRow(e.sheet,r)||(t=!1);return t}isFormulaArrayInColumn(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetColumn(e,t))return!0;return!1}isFormulaArrayInAllColumns(e){let t=!0;for(const r of e.columns())this.isFormulaArrayInColumn(e.sheet,r)||(t=!1);return t}isFormulaArrayInRange(e){for(const t of this.arrayMapping.values())if(t.getRange().doesOverlap(e))return!0;return!1}isFormulaArrayAtAddress(e){for(const t of this.arrayMapping.values())if(t.getRange().addressInRange(e))return!0;return!1}moveArrayVerticesAfterRowByRows(e,t,r){this.updateArrayVerticesInSheet(e,(n,i)=>{const a=i.getRange();return t<=a.start.row?[a.shifted(0,r),i]:void 0})}moveArrayVerticesAfterColumnByColumns(e,t,r){this.updateArrayVerticesInSheet(e,(n,i)=>{const a=i.getRange();return t<=a.start.col?[a.shifted(r,0),i]:void 0})}updateArrayVerticesInSheet(e,t){const r=Array();for(const[n,i]of this.arrayMapping.entries()){if(i.sheet!==e)continue;const a=t(n,i);a!==void 0&&(this.removeArray(n),r.push(a))}r.forEach(([n,i])=>{this.setArray(n,i)})}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class un{constructor(e){this.size=e}width(){return this.size.width}height(){return this.size.height}get(e,t){throw Error("Array not computed yet.")}simpleRangeValue(){throw Error("Array not computed yet.")}}class Zr{constructor(e){if(this.size=new V(e.length>0?e[0].length:0,e.length),this.array=e,this.size.width<=0||this.size.height<=0)throw Error("Incorrect array size")}static fromInterpreterValue(e){return e instanceof w?new Zr(e.data):new Zr([[e]])}simpleRangeValue(){return w.onlyValues(this.array)}addRows(e,t){this.array.splice(e,0,...this.nullArrays(t,this.width())),this.size.height+=t}addColumns(e,t){for(let r=0;r<this.height();r++)this.array[r].splice(e,0,...new Array(t).fill(B));this.size.width+=t}removeRows(e,t){if(this.outOfBound(0,e)||this.outOfBound(0,t))throw Error("Array index out of bound");const r=t-e+1;this.array.splice(e,r),this.size.height-=r}removeColumns(e,t){if(this.outOfBound(e,0)||this.outOfBound(t,0))throw Error("Array index out of bound");const r=t-e+1;for(const n of this.array)n.splice(e,r);this.size.width-=r}nullArrays(e,t){const r=[];for(let n=0;n<e;++n)r.push(new Array(t).fill(B));return r}get(e,t){if(this.outOfBound(e,t))throw Error("Array index out of bound");return this.array[t][e]}set(e,t,r){if(this.outOfBound(e,t))throw Error("Array index out of bound");this.array[t][e]=r}width(){return this.size.width}height(){return this.size.height}raw(){return this.array}resize(e){if(this.height()<e.height&&isFinite(e.height)&&this.addRows(this.height(),e.height-this.height()),this.height()>e.height||(this.width()<e.width&&isFinite(e.width)&&this.addColumns(this.width(),e.width-this.width()),this.width()>e.width))throw Error("Resizing to smaller array")}outOfBound(e,t){return e<0||t<0||t>this.size.height-1||e>this.size.width-1}}class Ai{constructor(e,t){this.error=e,this.size=t}get(e,t){return this.error}width(){return this.size.width}height(){return this.size.height}simpleRangeValue(){return this.error}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class tt{constructor(e,t,r){this.formula=e,this.cellAddress=t,this.version=r}get width(){return 1}get height(){return 1}static fromAst(e,t,r,n){return r.isScalar()?new Ft(e,t,n):new fe(e,t,r,n)}getFormula(e){return this.ensureRecentData(e),this.formula}ensureRecentData(e){if(this.version!=e.version()){const[t,r,n]=e.applyTransformations(this.formula,this.cellAddress,this.version);this.formula=t,this.cellAddress=r,this.version=n}}getAddress(e){return this.ensureRecentData(e),this.cellAddress}}class fe extends tt{constructor(e,t,r,n=0){super(e,t,n),r.isRef?this.array=new Ai(new p(m.REF,T.NoSpaceForArrayResult),V.error()):this.array=new un(r)}get width(){return this.array.width()}get height(){return this.array.height()}get sheet(){return this.cellAddress.sheet}get leftCorner(){return this.cellAddress}setCellValue(e){if(e instanceof p)return this.setErrorValue(e),e;const t=Zr.fromInterpreterValue(e);return t.resize(this.array.size),this.array=t,e}getCellValue(){if(this.array instanceof un)throw Error("Array not computed yet.");return this.array.simpleRangeValue()}valueOrUndef(){if(!(this.array instanceof un))return this.array.simpleRangeValue()}getArrayCellValue(e){const t=e.col-this.cellAddress.col,r=e.row-this.cellAddress.row;try{return this.array.get(t,r)}catch{return new p(m.REF)}}getArrayCellRawValue(e){const t=this.getArrayCellValue(e);if(!(t instanceof p||t===B))return I(t)}setArrayCellValue(e,t){const r=e.col-this.cellAddress.col,n=e.row-this.cellAddress.row;this.array instanceof Zr&&this.array.set(r,n,t)}setNoSpace(){return this.array=new Ai(new p(m.SPILL,T.NoSpaceForArrayResult),V.error()),this.getCellValue()}getRange(){return F.spanFrom(this.cellAddress,this.width,this.height)}getRangeOrUndef(){return F.spanFromOrUndef(this.cellAddress,this.width,this.height)}setAddress(e){this.cellAddress=e}setFormula(e){this.formula=e}spansThroughSheetRows(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.row<=r&&t<this.cellAddress.row+this.height}spansThroughSheetColumn(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.col<=r&&t<this.cellAddress.col+this.width}isComputed(){return!(this.array instanceof un)}columnsFromArray(){return et.fromNumberOfColumns(this.cellAddress.sheet,this.cellAddress.col,this.width)}rowsFromArray(){return Xe.fromNumberOfRows(this.cellAddress.sheet,this.cellAddress.row,this.height)}ensureRecentData(e){}isLeftCorner(e){return Mn(this.cellAddress,e)}setErrorValue(e){this.array=new Ai(e,this.array.size)}}class Ft extends tt{constructor(e,t,r){super(e,t,r)}valueOrUndef(){return this.cachedCellValue}setCellValue(e){return this.cachedCellValue=e,this.cachedCellValue}getCellValue(){if(this.cachedCellValue!==void 0)return this.cachedCellValue;throw Error("Value of the formula cell is not computed.")}isComputed(){return this.cachedCellValue!==void 0}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Fe{constructor(e){this.range=e,this.functionCache=new Map,this.criterionFunctionCache=new Map,this.dependentCacheRanges=new Set,this.bruteForce=!1}get start(){return this.range.start}get end(){return this.range.end}get sheet(){return this.range.start.sheet}getFunctionValue(e){return this.functionCache.get(e)}setFunctionValue(e,t){this.functionCache.set(e,t)}getCriterionFunctionValue(e,t){var r;return(r=this.getCriterionFunctionValues(e).get(t))===null||r===void 0?void 0:r[0]}getCriterionFunctionValues(e){var t;return(t=this.criterionFunctionCache.get(e))!==null&&t!==void 0?t:new Map}setCriterionFunctionValues(e,t){this.criterionFunctionCache.set(e,t)}addDependentCacheRange(e){e!==this&&this.dependentCacheRanges.add(e)}clearCache(){this.functionCache.clear(),this.criterionFunctionCache.clear(),this.dependentCacheRanges.forEach(e=>e.criterionFunctionCache.clear()),this.dependentCacheRanges.clear()}getStart(){return this.start}getEnd(){return this.end}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const rE=(s,e,t,r,n)=>{if(e instanceof Fe){const o=e.range.intersectionWith(t);return o!==void 0?Array.from(o.addresses(n)):[]}let i,a;if(e instanceof tt)i=e.getFormula(r),a=e.getAddress(r);else return[];return ni(i,s).filter(o=>o instanceof Hh).map(o=>o.dependency.toSimpleCellAddress(a)).filter(o=>t.addressInRange(o))};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Gt;(function(s){s[s.ON_STACK=0]="ON_STACK",s[s.PROCESSED=1]="PROCESSED",s[s.POPPED=2]="POPPED"})(Gt||(Gt={}));class nE{constructor(e=[],t=[]){this.nodesSparseArray=e,this.edgesSparseArray=t,this.entranceTime=[],this.low=[],this.parent=[],this.inSCC=[],this.nodeStatus=[],this.order=[],this.sccNonSingletons=[],this.timeCounter=0}getTopSortedWithSccSubgraphFrom(e,t,r){const n=e.reverse();return n.forEach(i=>this.runDFS(i)),this.postprocess(n,r,t)}getAdjacentNodeIds(e){return this.edgesSparseArray[e].filter(t=>t!==void 0&&this.nodesSparseArray[t])}runDFS(e){if(this.nodeStatus[e]!==void 0)return;this.nodeStatus[e]=Gt.ON_STACK;const t=[e],r=[];for(;t.length>0;){const n=t[t.length-1];switch(this.nodeStatus[n]){case Gt.ON_STACK:{this.handleOnStack(n,r,t);break}case Gt.PROCESSED:{this.handleProcessed(n,r,t);break}case Gt.POPPED:{t.pop();break}}}}handleOnStack(e,t,r){this.entranceTime[e]=this.timeCounter,this.low[e]=this.timeCounter,this.timeCounter++,t.push(e),this.getAdjacentNodeIds(e).forEach(n=>{this.entranceTime[n]===void 0&&(r.push(n),this.parent[n]=e,this.nodeStatus[n]=Gt.ON_STACK)}),this.nodeStatus[e]=Gt.PROCESSED}handleProcessed(e,t,r){let n=this.entranceTime[e];if(this.getAdjacentNodeIds(e).forEach(i=>{this.inSCC[i]||(n=this.parent[i]===e?Math.min(n,this.low[i]):Math.min(n,this.entranceTime[i]))}),this.low[e]=n,n===this.entranceTime[e]){const i=[];do i.push(t[t.length-1]),t.pop();while(i[i.length-1]!==e);i.forEach(a=>{this.inSCC[a]=!0}),this.order.push(...i),i.length>1&&i.forEach(a=>{this.sccNonSingletons[a]=!0})}r.pop(),this.nodeStatus[e]=Gt.POPPED}postprocess(e,t,r){const n=[];e.forEach(o=>{n[o]=!0});const i=[],a=[];return this.order.reverse(),this.order.forEach(o=>{const u=this.getAdjacentNodeIds(o);this.sccNonSingletons[o]||u.includes(o)?(a.push(this.nodesSparseArray[o]),t(this.nodesSparseArray[o]),u.forEach(l=>n[l]=!0)):(i.push(this.nodesSparseArray[o]),n[o]&&r(this.nodesSparseArray[o])&&u.forEach(l=>n[l]=!0))}),{sorted:i,cycled:a}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class sE{constructor(e,t){this.rawValue=e,this.processFn=t,this.processedValue=null}getProcessedValue(){return this.processedValue===null&&(this.processedValue=this.processFn(this.rawValue)),this.processedValue}markAsModified(){this.processedValue=null}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class iE{constructor(e){this.dependencyQuery=e,this.nodesSparseArray=[],this.edgesSparseArray=[],this.nodesIds=new Map,this.dirtyAndVolatileNodeIds=new sE({dirty:[],volatile:[]},t=>this.processDirtyAndVolatileNodeIds(t)),this.infiniteRangeIds=new Set,this.changingWithStructureNodeIds=[],this.nextId=0}getNodes(){return this.nodesSparseArray.filter(e=>e!==void 0)}hasNode(e){return this.nodesIds.has(e)}existsEdge(e,t){const r=this.getNodeId(e),n=this.getNodeId(t);return r===void 0||n===void 0?!1:this.edgesSparseArray[r].includes(n)}adjacentNodes(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);return new Set(this.edgesSparseArray[t].filter(r=>r!==void 0).map(r=>this.nodesSparseArray[r]))}adjacentNodesCount(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);return this.fixEdgesArrayForNode(t).length}addNodeAndReturnId(e){const t=this.nodesIds.get(e);if(t!==void 0)return t;const r=this.nextId;return this.nextId++,this.nodesSparseArray[r]=e,this.edgesSparseArray[r]=[],this.nodesIds.set(e,r),r}addEdge(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0)throw this.missingNodeError(e);if(n===void 0)throw this.missingNodeError(t);this.edgesSparseArray[r].includes(n)||this.edgesSparseArray[r].push(n)}removeNode(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);this.edgesSparseArray[t].length>0&&(this.edgesSparseArray[t].forEach(n=>this.dirtyAndVolatileNodeIds.rawValue.dirty.push(n)),this.dirtyAndVolatileNodeIds.markAsModified());const r=this.removeDependencies(e);return delete this.nodesSparseArray[t],delete this.edgesSparseArray[t],this.infiniteRangeIds.delete(t),this.nodesIds.delete(e),r}removeEdge(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0)throw this.missingNodeError(e);if(n===void 0)throw this.missingNodeError(t);const i=this.edgesSparseArray[r].indexOf(n);if(i===-1)throw new Error("Edge does not exist");delete this.edgesSparseArray[r][i]}removeEdgeIfExists(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0||n===void 0)return;const i=this.edgesSparseArray[r].indexOf(n);i!==-1&&delete this.edgesSparseArray[r][i]}topSortWithScc(){return this.getTopSortedWithSccSubgraphFrom(this.getNodes(),()=>!0,()=>{})}getTopSortedWithSccSubgraphFrom(e,t,r){const n=new nE(this.nodesSparseArray,this.edgesSparseArray),i=e.map(a=>this.getNodeId(a)).filter(a=>a!==void 0);return n.getTopSortedWithSccSubgraphFrom(i,t,r)}markNodeAsVolatile(e){const t=this.getNodeId(e);t!==void 0&&(this.dirtyAndVolatileNodeIds.rawValue.volatile.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsDirty(e){const t=this.getNodeId(e);t!==void 0&&(this.dirtyAndVolatileNodeIds.rawValue.dirty.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}getDirtyAndVolatileNodes(){return this.dirtyAndVolatileNodeIds.getProcessedValue()}clearDirtyNodes(){this.dirtyAndVolatileNodeIds.rawValue.dirty=[],this.dirtyAndVolatileNodeIds.markAsModified()}markNodeAsChangingWithStructure(e){const t=this.getNodeId(e);t!==void 0&&this.changingWithStructureNodeIds.push(t)}markChangingWithStructureNodesAsDirty(){this.changingWithStructureNodeIds.length<=0||(this.dirtyAndVolatileNodeIds.rawValue.dirty=[...this.dirtyAndVolatileNodeIds.rawValue.dirty,...this.changingWithStructureNodeIds],this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsInfiniteRange(e){const t=this.getNodeIdIfNotNumber(e);t!==void 0&&this.infiniteRangeIds.add(t)}getInfiniteRanges(){return[...this.infiniteRangeIds].map(e=>({node:this.nodesSparseArray[e],id:e}))}getNodeId(e){return this.nodesIds.get(e)}getNodeIdIfNotNumber(e){return typeof e=="number"?e:this.nodesIds.get(e)}fixEdgesArrayForNode(e){const t=this.edgesSparseArray[e];return this.edgesSparseArray[e]=t.filter(r=>r!==void 0&&this.nodesSparseArray[r]),this.edgesSparseArray[e]}removeDependencies(e){const t=this.dependencyQuery(e);return t.forEach(([r,n])=>{this.removeEdgeIfExists(n,e)}),t}processDirtyAndVolatileNodeIds({dirty:e,volatile:t}){return[...new Set([...e,...t])].map(r=>this.nodesSparseArray[r]).filter(r=>r!==void 0)}missingNodeError(e){return new Error(`Unknown node ${e}`)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class aE{constructor(){this.rangeMapping=new Map}getMappingSize(e){var t,r;return(r=(t=this.rangeMapping.get(e))===null||t===void 0?void 0:t.size)!==null&&r!==void 0?r:0}setRange(e){let t=this.rangeMapping.get(e.getStart().sheet);t===void 0&&(t=new Map,this.rangeMapping.set(e.getStart().sheet,t));const r=ps(e.getStart(),e.getEnd());t.set(r,e)}removeRange(e){const t=e.getStart().sheet,r=this.rangeMapping.get(t);if(r===void 0)return;const n=ps(e.getStart(),e.getEnd());r.delete(n),r.size===0&&this.rangeMapping.delete(t)}getRange(e,t){const r=this.rangeMapping.get(e.sheet),n=ps(e,t);return r?.get(n)}fetchRange(e,t){const r=this.getRange(e,t);if(!r)throw Error("Range does not exist");return r}truncateRanges(e,t){const r=Array(),n=Array(),i=Array(),a=e.sheet;for(const[u,l]of this.entriesFromSheet(e.sheet)){const c=l.range;e.start<=t(l.range.end)&&(c.removeSpan(e),c.shouldBeRemoved()?(this.removeByKey(a,u),r.push(l)):n.push([u,l]),i.push(l))}const o=[];n.sort((u,l)=>uE(u[1],l[1],t));for(const[u,l]of n){const c=oE(l.range);if(c===u)continue;const d=this.getByKey(a,c);this.removeByKey(a,u),d!==void 0&&l!=d?o.push([d,l]):this.setRange(l)}return{verticesToRemove:r,verticesToMerge:o,verticesWithChangedSize:i}}moveAllRangesInSheetAfterRowByRows(e,t,r){return this.updateVerticesFromSheet(e,(n,i)=>t<=i.start.row?(i.range.shiftByRows(r),{changedSize:!1,vertex:i}):t>i.start.row&&t<=i.end.row?(i.range.expandByRows(r),{changedSize:!0,vertex:i}):void 0)}moveAllRangesInSheetAfterColumnByColumns(e,t,r){return this.updateVerticesFromSheet(e,(n,i)=>t<=i.start.col?(i.range.shiftByColumns(r),{changedSize:!1,vertex:i}):t>i.start.col&&t<=i.end.col?(i.range.expandByColumns(r),{changedSize:!0,vertex:i}):void 0)}moveRangesInsideSourceRange(e,t,r,n){this.updateVerticesFromSheet(e.sheet,(i,a)=>{if(e.containsRange(a.range))return a.range.shiftByColumns(t),a.range.shiftByRows(r),a.range.moveToSheet(n),{changedSize:!1,vertex:a}})}removeRangesInSheet(e){if(this.rangeMapping.has(e)){const t=this.rangeMapping.get(e).values();return this.rangeMapping.delete(e),t}return[][Symbol.iterator]()}*rangesInSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.values())}*rangeVerticesContainedInRange(e){for(const t of this.rangesInSheet(e.sheet))e.containsRange(t.range)&&(yield t)}findSmallerRange(e){if(e.height()>1&&Number.isFinite(e.height())){const t=M(e.end.sheet,e.end.col,e.end.row-1),r=this.getRange(e.start,t);if(r!==void 0){const n=F.fromSimpleCellAddresses(M(e.start.sheet,e.start.col,e.end.row),e.end);return{smallerRangeVertex:r,restRange:n}}}return{restRange:e}}*entriesFromSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.entries())}removeByKey(e,t){this.rangeMapping.get(e).delete(t)}getByKey(e,t){var r;return(r=this.rangeMapping.get(e))===null||r===void 0?void 0:r.get(t)}updateVerticesFromSheet(e,t){const r=Array();for(const[n,i]of this.entriesFromSheet(e)){const a=t(n,i);a!==void 0&&(this.removeByKey(e,n),r.push(a))}return r.forEach(n=>{this.setRange(n.vertex)}),{verticesWithChangedSize:r.filter(n=>n.changedSize).map(n=>n.vertex)}}}function ps(s,e){return`${s.col},${s.row},${e.col},${e.row}`}function oE(s){return ps(s.start,s.end)}const uE=(s,e,t)=>{const r=t(s.range.start),n=t(s.range.start);if(r===n){const i=t(s.range.end),a=t(e.range.end);return i-a}else return r-n};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class hE{constructor(e,t,r){this.functions=e,this.errors=t,this.ui=r,this._protectedTranslations={VERSION:"VERSION"},this.checkUI(),this.checkErrors(),this.checkFunctionTranslations(this.functions),Object.assign(this.functions,this._protectedTranslations)}extendFunctions(e){this.checkFunctionTranslations(e),Object.assign(this.functions,e)}buildFunctionMapping(){return Object.keys(this.functions).reduce((e,t)=>(e[this.functions[t]]=t,e),{})}buildErrorMapping(){return Object.keys(this.errors).reduce((e,t)=>(e[this.errors[t]]=t,e),{})}isFunctionTranslated(e){return this.functions[e]!==void 0}getFunctionTranslations(e){const t=[];for(const r of e)this.isFunctionTranslated(r)&&t.push(this.functions[r]);return t}getFunctionTranslation(e){const t=this.functions[e];if(t===void 0)throw new Pr(`functions.${e}`);return t}getMaybeFunctionTranslation(e){return this.functions[e]}getErrorTranslation(e){if(e===m.LIC)return`#${m.LIC}!`;const t=this.errors[e];if(t===void 0)throw new Pr(`errors.${e}`);return t}getUITranslation(e){const t=this.ui[e];if(t===void 0)throw new Pr(`ui.${e}`);return t}checkUI(){for(const e of Object.values(On))if(!(e in this.ui))throw new Pr(`ui.${e}`)}checkErrors(){for(const e of Object.values(m))if(!(e in this.errors)&&e!==m.LIC)throw new Pr(`errors.${e}`)}checkFunctionTranslations(e){const t=new Set(Object.getOwnPropertyNames(e));for(const r of Object.getOwnPropertyNames(this._protectedTranslations))if(t.has(r))throw new rl(r)}}function lE(s){return new hE(Object.assign({},s.functions),Object.assign({},s.errors),Object.assign({},s.ui))}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var On;(function(s){s.NEW_SHEET_PREFIX="NEW_SHEET_PREFIX"})(On||(On={}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Vr(s){return s.toLowerCase()}class cE{constructor(e,t){this.id=e,this.displayName=t}get canonicalName(){return Vr(this.displayName)}}class dE{constructor(e){this.languages=e,this.mappingFromCanonicalName=new Map,this.mappingFromId=new Map,this.lastSheetId=-1,this.fetch=t=>{const r=this.mappingFromCanonicalName.get(Vr(t));if(r===void 0)throw new Yh(t);return r.id},this.get=t=>{var r;return(r=this.mappingFromCanonicalName.get(Vr(t)))===null||r===void 0?void 0:r.id},this.fetchDisplayName=t=>this.fetchSheetById(t).displayName,this.sheetNamePrefix=e.getUITranslation(On.NEW_SHEET_PREFIX)}addSheet(e=`${this.sheetNamePrefix}${this.lastSheetId+2}`){const t=Vr(e);if(this.mappingFromCanonicalName.has(t))throw new Cn(e);this.lastSheetId++;const r=new cE(this.lastSheetId,e);return this.store(r),r.id}removeSheet(e){const t=this.fetchSheetById(e);e==this.lastSheetId&&--this.lastSheetId,this.mappingFromCanonicalName.delete(t.canonicalName),this.mappingFromId.delete(t.id)}getDisplayName(e){var t;return(t=this.mappingFromId.get(e))===null||t===void 0?void 0:t.displayName}*displayNames(){for(const e of this.mappingFromCanonicalName.values())yield e.displayName}numberOfSheets(){return this.mappingFromCanonicalName.size}hasSheetWithId(e){return this.mappingFromId.has(e)}hasSheetWithName(e){return this.mappingFromCanonicalName.has(Vr(e))}renameSheet(e,t){const r=this.fetchSheetById(e),n=r.displayName;if(n===t)return;const i=this.mappingFromCanonicalName.get(Vr(t));if(i!==void 0&&i.id!==r.id)throw new Cn(t);const a=r.canonicalName;return this.mappingFromCanonicalName.delete(a),r.displayName=t,this.store(r),n}sheetNames(){return Array.from(this.mappingFromId.values()).map(e=>e.displayName)}store(e){this.mappingFromId.set(e.id,e),this.mappingFromCanonicalName.set(e.canonicalName,e)}fetchSheetById(e){const t=this.mappingFromId.get(e);if(t===void 0)throw new ae(e);return t}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Pa{constructor(e,t,r,n,i,a,o,u){this.addressMapping=e,this.rangeMapping=t,this.sheetMapping=r,this.arrayMapping=n,this.stats=i,this.lazilyTransformingAstService=a,this.functionRegistry=o,this.namedExpressions=u,this.changes=nr.empty(),this.dependencyQueryAddresses=l=>{if(l instanceof Fe)return this.rangeDependencyQuery(l).map(([c,d])=>c);{const c=this.formulaDependencyQuery(l);if(c!==void 0){const[d,f]=c;return f.map(E=>E instanceof Wt?this.namedExpressions.namedExpressionOrPlaceholder(E.name,d.sheet).address:le(E)?E:$i(E.start,E.end))}else return[]}},this.dependencyQueryVertices=l=>{if(l instanceof Fe)return this.rangeDependencyQuery(l);{const c=this.formulaDependencyQuery(l);if(c!==void 0){const[d,f]=c;return f.map(E=>{if(E instanceof F)return[E.start,this.rangeMapping.fetchRange(E.start,E.end)];if(E instanceof Wt){const N=this.namedExpressions.namedExpressionOrPlaceholder(E.name,d.sheet);return[N.address,this.addressMapping.fetchCell(N.address)]}else return[E,this.addressMapping.fetchCell(E)]})}else return[]}},this.rangeDependencyQuery=l=>{const c=[],{smallerRangeVertex:d,restRange:f}=this.rangeMapping.findSmallerRange(l.range);let E;d!==void 0&&this.graph.adjacentNodes(d).has(l)?(E=f,c.push([new F(d.start,d.end),d])):E=l.range;for(const N of E.addresses(this)){const R=this.addressMapping.getCell(N);R!==void 0&&c.push([N,R])}return c},this.formulaDependencyQuery=l=>{let c,d;if(l instanceof tt)d=l.getAddress(this.lazilyTransformingAstService),c=l.getFormula(this.lazilyTransformingAstService);else return;const f=ni(c,this.functionRegistry);return[d,Lt(f,d)]},this.graph=new iE(this.dependencyQueryVertices)}static buildEmpty(e,t,r,n,i){return new Pa(new eE(t.chooseAddressMappingPolicy),new aE,new dE(t.translationPackage),new tE,i,e,r,n)}setFormulaToCell(e,t,r,n,i,a){const o=tt.fromAst(t,e,n,this.lazilyTransformingAstService.version());return this.exchangeOrAddFormulaVertex(o),this.processCellDependencies(r,o),this.graph.markNodeAsDirty(o),i&&this.markAsVolatile(o),a&&this.markAsDependentOnStructureChange(o),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setParsingErrorToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);return this.exchangeOrAddGraphNode(r,t),this.addressMapping.setCell(e,t),this.graph.markNodeAsDirty(t),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setValueToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);if(r instanceof fe&&this.arrayMapping.removeArray(r.getRange()),r instanceof sr)r.getValues().rawValue!==t.rawValue&&(r.setValues(t),this.graph.markNodeAsDirty(r));else{const n=new sr(t.parsedValue,t.rawValue);this.exchangeOrAddGraphNode(r,n),this.addressMapping.setCell(e,n),this.graph.markNodeAsDirty(n)}return this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setCellEmpty(e){const t=this.shrinkPossibleArrayAndGetCell(e);if(t===void 0)return nr.empty();if(this.graph.adjacentNodes(t).size>0){const r=new er;this.exchangeGraphNode(t,r),this.graph.adjacentNodesCount(r)===0?(this.removeVertex(r),this.addressMapping.removeCell(e)):(this.graph.markNodeAsDirty(r),this.addressMapping.setCell(e,r))}else this.removeVertex(t),this.addressMapping.removeCell(e);return this.getAndClearContentChanges()}clearDirtyVertices(){this.graph.clearDirtyNodes()}verticesToRecompute(){return this.graph.getDirtyAndVolatileNodes()}processCellDependencies(e,t){const r=this.graph.getNodeId(t);e.forEach(n=>{if(n instanceof F){const i=n;let a=this.getRange(i.start,i.end);a===void 0&&(a=new Fe(i),this.rangeMapping.setRange(a)),this.graph.addNodeAndReturnId(a);const o=this.graph.getNodeId(a);i.isFinite()||this.graph.markNodeAsInfiniteRange(o);const{smallerRangeVertex:u,restRange:l}=this.rangeMapping.findSmallerRange(i);if(u!==void 0){if(this.graph.addEdge(u,o),a.bruteForce){a.bruteForce=!1;for(const d of i.addresses(this))this.graph.removeEdge(this.fetchCell(d),o)}}else a.bruteForce=!0;const c=this.arrayMapping.getArray(l);if(c!==void 0)this.graph.addEdge(c,o);else for(const d of l.addresses(this)){const{vertex:f,id:E}=this.fetchCellOrCreateEmpty(d);this.graph.addEdge(E??f,o)}this.graph.addEdge(o,r),i.isFinite()&&this.correctInfiniteRangesDependenciesByRangeVertex(a)}else if(n instanceof Wt){const i=t.getAddress(this.lazilyTransformingAstService).sheet,{vertex:a,id:o}=this.fetchNamedExpressionVertex(n.name,i);this.graph.addEdge(o??a,r)}else{const{vertex:i,id:a}=this.fetchCellOrCreateEmpty(n);this.graph.addEdge(a??i,r)}})}fetchNamedExpressionVertex(e,t){const r=this.namedExpressions.namedExpressionOrPlaceholder(e,t);return this.fetchCellOrCreateEmpty(r.address)}exchangeNode(e,t){const r=this.fetchCellOrCreateEmpty(e).vertex,n=this.fetchCellOrCreateEmpty(t).vertex;this.addressMapping.removeCell(e),this.exchangeGraphNode(r,n)}fetchCellOrCreateEmpty(e){const t=this.addressMapping.getCell(e);if(t!==void 0)return{vertex:t,id:void 0};const r=new er,n=this.graph.addNodeAndReturnId(r);return this.addressMapping.setCell(e,r),{vertex:r,id:n}}removeRows(e){this.stats.measure(x.ADJUSTING_GRAPH,()=>{for(const[r,n]of this.addressMapping.entriesFromRowsSpan(e)){for(const i of this.graph.adjacentNodes(n))this.graph.markNodeAsDirty(i);if(n instanceof fe)if(n.isLeftCorner(r))this.shrinkArrayToCorner(n),this.arrayMapping.removeArray(n.getRange());else continue;this.removeVertex(n)}}),this.stats.measure(x.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeRows(e)});const t=this.stats.measure(x.ADJUSTING_RANGES,()=>{const r=this.truncateRanges(e,n=>n.row);return this.getArrayVerticesRelatedToRanges(r)});return this.stats.measure(x.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterRemovingRows(e.sheet,e.rowStart,e.numberOfRows)}),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}removeSheet(e){this.clearSheet(e);for(const[t,r]of this.addressMapping.sheetEntries(e)){for(const n of this.graph.adjacentNodes(r))this.graph.markNodeAsDirty(n);this.removeVertex(r),this.addressMapping.removeCell(t)}this.stats.measure(x.ADJUSTING_RANGES,()=>{const t=this.rangeMapping.removeRangesInSheet(e);for(const r of t)this.removeVertex(r);this.stats.measure(x.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeSheet(e)})})}clearSheet(e){const t=new Set;for(const[r,n]of this.addressMapping.sheetEntries(e))n instanceof fe?t.add(n):this.setCellEmpty(r);for(const r of t.values())this.setArrayEmpty(r);this.addStructuralNodesToChangeSet()}removeColumns(e){this.stats.measure(x.ADJUSTING_GRAPH,()=>{for(const[r,n]of this.addressMapping.entriesFromColumnsSpan(e)){for(const i of this.graph.adjacentNodes(n))this.graph.markNodeAsDirty(i);if(n instanceof fe)if(n.isLeftCorner(r))this.shrinkArrayToCorner(n),this.arrayMapping.removeArray(n.getRange());else continue;this.removeVertex(n)}}),this.stats.measure(x.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeColumns(e)});const t=this.stats.measure(x.ADJUSTING_RANGES,()=>{const r=this.truncateRanges(e,n=>n.col);return this.getArrayVerticesRelatedToRanges(r)});return this.stats.measure(x.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterRemovingColumns(e.sheet,e.columnStart,e.numberOfColumns)),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}addRows(e){this.stats.measure(x.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addRows(e.sheet,e.rowStart,e.numberOfRows)});const t=this.stats.measure(x.ADJUSTING_RANGES,()=>{const r=this.rangeMapping.moveAllRangesInSheetAfterRowByRows(e.sheet,e.rowStart,e.numberOfRows);return this.fixRangesWhenAddingRows(e.sheet,e.rowStart,e.numberOfRows),this.getArrayVerticesRelatedToRanges(r.verticesWithChangedSize)});this.stats.measure(x.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterAddingRow(e.sheet,e.rowStart,e.numberOfRows)});for(const r of this.addressMapping.verticesFromRowsSpan(e))this.graph.markNodeAsDirty(r);return this.addStructuralNodesToChangeSet(),{affectedArrays:t}}addColumns(e){this.stats.measure(x.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addColumns(e.sheet,e.columnStart,e.numberOfColumns)});const t=this.stats.measure(x.ADJUSTING_RANGES,()=>{const r=this.rangeMapping.moveAllRangesInSheetAfterColumnByColumns(e.sheet,e.columnStart,e.numberOfColumns);return this.fixRangesWhenAddingColumns(e.sheet,e.columnStart,e.numberOfColumns),this.getArrayVerticesRelatedToRanges(r.verticesWithChangedSize)});this.stats.measure(x.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterAddingColumn(e.sheet,e.columnStart,e.numberOfColumns));for(const r of this.addressMapping.verticesFromColumnsSpan(e))this.graph.markNodeAsDirty(r);return this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}isThereSpaceForArray(e){const t=e.getRangeOrUndef();if(t===void 0)return!1;for(const r of t.addresses(this)){const n=this.addressMapping.getCell(r);if(n!==void 0&&!(n instanceof er)&&n!==e)return!1}return!0}moveCells(e,t,r,n){for(const i of e.addressesWithDirection(t,r,this)){const a=M(n,i.col+t,i.row+r);let o=this.addressMapping.getCell(i);const u=this.addressMapping.getCell(a);if(this.addressMapping.removeCell(i),o!==void 0){this.graph.markNodeAsDirty(o),this.addressMapping.setCell(a,o);let l;for(const c of this.graph.adjacentNodes(o))c instanceof Fe&&!e.containsRange(c.range)&&(l=l??this.fetchCellOrCreateEmpty(i).vertex,this.graph.addEdge(l,c),this.graph.removeEdge(o,c));l&&(this.graph.markNodeAsDirty(l),this.addressMapping.setCell(i,l))}if(u!==void 0){o===void 0&&this.addressMapping.removeCell(a);for(const l of this.graph.adjacentNodes(u))o=o??this.fetchCellOrCreateEmpty(a).vertex,this.graph.addEdge(o,l),this.graph.markNodeAsDirty(o);this.removeVertex(u)}}for(const i of this.rangeMapping.rangeVerticesContainedInRange(e))for(const a of this.graph.adjacentNodes(i))if(a instanceof Fe&&!e.containsRange(a.range)){this.graph.removeEdge(i,a);for(const o of i.range.addresses(this)){const{vertex:u,id:l}=this.fetchCellOrCreateEmpty(o);this.graph.addEdge(l??u,a),this.addressMapping.setCell(o,u),this.graph.markNodeAsDirty(u)}}this.rangeMapping.moveRangesInsideSourceRange(e,t,r,n)}setArrayEmpty(e){const t=F.spanFrom(e.getAddress(this.lazilyTransformingAstService),e.width,e.height),r=this.graph.adjacentNodes(e);for(const n of t.addresses(this))this.addressMapping.removeCell(n);for(const n of r.values()){const i=rE(this.functionRegistry,n,e.getRange(),this.lazilyTransformingAstService,this);for(const a of i){const{vertex:o,id:u}=this.fetchCellOrCreateEmpty(a);this.graph.addEdge(u??o,n)}i.length>0&&this.graph.markNodeAsDirty(n)}this.removeVertex(e),this.arrayMapping.removeArray(e.getRange())}addVertex(e,t){this.graph.addNodeAndReturnId(t),this.addressMapping.setCell(e,t)}addArrayVertex(e,t){this.graph.addNodeAndReturnId(t),this.setAddressMappingForArrayVertex(t,e)}*arrayFormulaNodes(){for(const e of this.graph.getNodes())e instanceof fe&&(yield e)}*entriesFromRowsSpan(e){yield*this.addressMapping.entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.addressMapping.entriesFromColumnsSpan(e)}fetchCell(e){return this.addressMapping.fetchCell(e)}getCell(e){return this.addressMapping.getCell(e)}getCellValue(e){return this.addressMapping.getCellValue(e)}getRawValue(e){return this.addressMapping.getRawValue(e)}getScalarValue(e){const t=this.addressMapping.getCellValue(e);return t instanceof w?new p(m.VALUE,T.ScalarExpected):t}existsEdge(e,t){return this.graph.existsEdge(e,t)}getSheetId(e){return this.sheetMapping.fetch(e)}getSheetHeight(e){return this.addressMapping.getHeight(e)}getSheetWidth(e){return this.addressMapping.getWidth(e)}getArray(e){return this.arrayMapping.getArray(e)}getRange(e,t){return this.rangeMapping.getRange(e,t)}topSortWithScc(){return this.graph.topSortWithScc()}markAsVolatile(e){this.graph.markNodeAsVolatile(e)}markAsDependentOnStructureChange(e){this.graph.markNodeAsChangingWithStructure(e)}forceApplyPostponedTransformations(){for(const e of this.graph.getNodes())e instanceof Ft&&e.ensureRecentData(this.lazilyTransformingAstService)}*rawValuesFromRange(e){for(const t of e.addresses(this)){const r=this.getScalarValue(t);r!==B&&(yield[I(r),t])}}computeListOfValuesInRange(e){const t=[];for(const r of e.addresses(this)){const n=this.getScalarValue(r);t.push(n)}return t}shrinkArrayToCorner(e){this.cleanAddressMappingUnderArray(e);for(const t of this.adjacentArrayVertices(e)){let r;t instanceof tt?r=this.formulaDirectDependenciesToArray(t,e):r=this.rangeDirectDependenciesToArray(t,e);let n=!1;for(const[i,a]of r)e.isLeftCorner(i)&&(n=!0),this.graph.addEdge(a,t),this.graph.markNodeAsDirty(a);n||this.graph.removeEdge(e,t)}this.graph.markNodeAsDirty(e)}isArrayInternalCell(e){const t=this.getCell(e);return t instanceof fe&&!t.isLeftCorner(e)}getAndClearContentChanges(){const e=this.changes;return this.changes=nr.empty(),e}getAdjacentNodesAddresses(e){const t=this.graph.adjacentNodes(e),r=[];return t.forEach(n=>{const i=n;i instanceof Fe?r.push($i(i.start,i.end)):r.push(i.getAddress(this.lazilyTransformingAstService))}),r}exchangeGraphNode(e,t){this.graph.addNodeAndReturnId(t);const r=this.graph.adjacentNodes(e);this.removeVertex(e),r.forEach(n=>{this.graph.hasNode(n)&&this.graph.addEdge(t,n)})}setArray(e,t){this.arrayMapping.setArray(e,t)}correctInfiniteRangesDependency(e){const t=this.graph.getInfiniteRanges().filter(({node:a})=>a.range.addressInRange(e));if(t.length<=0)return;const{vertex:r,id:n}=this.fetchCellOrCreateEmpty(e),i=n??this.graph.getNodeId(r);t.forEach(({id:a})=>{this.graph.addEdge(i,a)})}exchangeOrAddGraphNode(e,t){e?this.exchangeGraphNode(e,t):this.graph.addNodeAndReturnId(t)}getArrayVerticesRelatedToRanges(e){const t=new Set;return e.forEach(r=>{this.graph.hasNode(r)&&this.graph.adjacentNodes(r).forEach(n=>{n instanceof fe&&t.add(n)})}),t}correctInfiniteRangesDependenciesByRangeVertex(e){this.graph.getInfiniteRanges().forEach(({id:t,node:r})=>{const n=e.range.intersectionWith(r.range);n!==void 0&&n.addresses(this).forEach(i=>{const{vertex:a,id:o}=this.fetchCellOrCreateEmpty(i);this.graph.addEdge(o??a,t)})})}cleanAddressMappingUnderArray(e){const t=e.getRange();for(const r of t.addresses(this)){const n=e.getArrayCellValue(r);this.getCell(r)===e?e.isLeftCorner(r)?this.changes.addChange(new p(m.REF),r,n):(this.addressMapping.removeCell(r),this.changes.addChange(B,r,n)):this.changes.addChange(B,r,n)}}*formulaDirectDependenciesToArray(e,t){var r;const[,n]=(r=this.formulaDependencyQuery(e))!==null&&r!==void 0?r:[];if(n!==void 0){for(const i of n)if(!(i instanceof Wt||i instanceof F)&&t.getRange().addressInRange(i)){const a=this.fetchCellOrCreateEmpty(i).vertex;yield[i,a]}}}*rangeDirectDependenciesToArray(e,t){const{restRange:r}=this.rangeMapping.findSmallerRange(e.range);for(const n of r.addresses(this))if(t.getRange().addressInRange(n)){const i=this.fetchCellOrCreateEmpty(n).vertex;yield[n,i]}}*adjacentArrayVertices(e){const t=this.graph.adjacentNodes(e);for(const r of t)(r instanceof tt||r instanceof Fe)&&(yield r)}addStructuralNodesToChangeSet(){this.graph.markChangingWithStructureNodesAsDirty()}fixRangesWhenAddingRows(e,t,r){const n=Array.from(this.rangeMapping.rangesInSheet(e));for(const i of n)if(i.range.includesRow(t+r))if(i.bruteForce){const a=i.range.rangeWithSameWidth(t,r);for(const o of a.addresses(this)){const{vertex:u,id:l}=this.fetchCellOrCreateEmpty(o);this.graph.addEdge(l??u,i)}}else{let a=i,o=this.rangeMapping.findSmallerRange(a.range);if(o.smallerRangeVertex!==void 0)continue;for(;o.smallerRangeVertex===void 0;){const u=new Fe(F.spanFrom(a.range.start,a.range.width(),a.range.height()-1));this.rangeMapping.setRange(u),this.graph.addNodeAndReturnId(u);const l=new F(M(a.range.start.sheet,a.range.start.col,a.range.end.row),a.range.end);this.addAllFromRange(l,a),this.graph.addEdge(u,a),a=u,o=this.rangeMapping.findSmallerRange(a.range)}this.graph.addEdge(o.smallerRangeVertex,a),this.addAllFromRange(o.restRange,a),this.graph.removeEdge(o.smallerRangeVertex,i)}}addAllFromRange(e,t){for(const r of e.addresses(this)){const{vertex:n,id:i}=this.fetchCellOrCreateEmpty(r);this.graph.addEdge(i??n,t)}}fixRangesWhenAddingColumns(e,t,r){for(const n of this.rangeMapping.rangesInSheet(e))if(n.range.includesColumn(t+r)){let i;n.bruteForce?i=n.range.rangeWithSameHeight(t,r):i=F.spanFrom(M(e,t,n.range.end.row),r,1);for(const a of i.addresses(this)){const{vertex:o,id:u}=this.fetchCellOrCreateEmpty(a);this.graph.addEdge(u??o,n)}}}exchangeOrAddFormulaVertex(e){const t=e.getAddress(this.lazilyTransformingAstService),r=F.spanFrom(t,e.width,e.height),n=this.shrinkPossibleArrayAndGetCell(t);if(e instanceof fe&&this.setArray(r,e),this.exchangeOrAddGraphNode(n,e),this.addressMapping.setCell(t,e),e instanceof fe){if(!this.isThereSpaceForArray(e))return;for(const i of r.addresses(this)){if(e.isLeftCorner(i))continue;const a=this.getCell(i);this.exchangeOrAddGraphNode(a,e)}}for(const i of r.addresses(this))this.addressMapping.setCell(i,e)}setAddressMappingForArrayVertex(e,t){if(this.addressMapping.setCell(t,e),!(e instanceof fe))return;const r=F.spanFromOrUndef(t,e.width,e.height);if(r!==void 0&&(this.setArray(r,e),!!this.isThereSpaceForArray(e)))for(const n of r.addresses(this))this.addressMapping.setCell(n,e)}truncateRanges(e,t){const{verticesToRemove:r,verticesToMerge:n,verticesWithChangedSize:i}=this.rangeMapping.truncateRanges(e,t);for(const[a,o]of n)this.mergeRangeVertices(a,o);for(const a of r)this.removeVertexAndCleanupDependencies(a);return i}fixArraysAfterAddingRow(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInRows(Xe.fromRowStartAndEnd(e,t-1,t-1))){const i=n.getRange();for(let a=i.start.col;a<=i.end.col;++a)for(let o=t;o<=i.end.row;++o){const u=M(e,a,o),l=M(e,a,o+r),c=n.getArrayCellValue(u);this.addressMapping.moveCell(l,u),this.changes.addChange(B,l,c)}}}fixArraysAfterRemovingRows(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,-r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInRows(Xe.fromRowStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(n))for(const i of n.getRange().addresses(this))this.addressMapping.setCell(i,n);else this.setNoSpaceIfArray(n)}fixArraysAfterAddingColumn(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInCols(et.fromColumnStartAndEnd(e,t-1,t-1))){const i=n.getRange();for(let a=i.start.row;a<=i.end.row;++a)for(let o=t;o<=i.end.col;++o){const u=M(e,o,a),l=M(e,o+r,a),c=n.getArrayCellValue(u);this.addressMapping.moveCell(l,u),this.changes.addChange(B,l,c)}}}fixArraysAfterRemovingColumns(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,-r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInCols(et.fromColumnStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(n))for(const i of n.getRange().addresses(this))this.addressMapping.setCell(i,n);else this.setNoSpaceIfArray(n)}shrinkPossibleArrayAndGetCell(e){const t=this.getCell(e);return t instanceof fe?(this.setNoSpaceIfArray(t),this.getCell(e)):t}setNoSpaceIfArray(e){e instanceof fe&&(this.shrinkArrayToCorner(e),e.setNoSpace())}removeVertex(e){this.removeVertexAndCleanupDependencies(e),e instanceof Fe&&this.rangeMapping.removeRange(e)}mergeRangeVertices(e,t){const r=this.graph.adjacentNodes(t);this.removeVertexAndCleanupDependencies(t),this.graph.removeEdgeIfExists(e,t),r.forEach(n=>{this.graph.hasNode(n)&&this.graph.addEdge(e,n)})}removeVertexAndCleanupDependencies(e){const t=new Set(this.graph.removeNode(e));for(;t.size>0;){const r=t.values().next().value;t.delete(r);const[n,i]=r;this.graph.hasNode(i)&&this.graph.adjacentNodesCount(i)===0&&((i instanceof Fe||i instanceof er)&&this.graph.removeNode(i).forEach(a=>t.add(a)),i instanceof Fe?this.rangeMapping.removeRange(i):i instanceof er&&this.addressMapping.removeCell(n))}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class er{constructor(){}getCellValue(){return B}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class sr{constructor(e,t){this.parsedValue=e,this.rawValue=t}getValues(){return{parsedValue:this.parsedValue,rawValue:this.rawValue}}setValues(e){this.parsedValue=e.parsedValue,this.rawValue=e.rawValue}getCellValue(){return this.parsedValue}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Xr{constructor(e,t){this.errors=e,this.rawInput=t}getCellValue(){const e=this.errors.map(t=>t.message).find(t=>t);return p.parsingError(e)}getFormula(){return this.rawInput}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pE{constructor(e,t){this.width=e,this.height=t,this.mapping=new Map}getCell(e){var t;return(t=this.mapping.get(e.col))===null||t===void 0?void 0:t.get(e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1);let r=this.mapping.get(e.col);r||(r=new Map,this.mapping.set(e.col,r)),r.set(e.row,t)}has(e){var t;return!!(!((t=this.mapping.get(e.col))===null||t===void 0)&&t.get(e.row))}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){var t;(t=this.mapping.get(e.col))===null||t===void 0||t.delete(e.row)}addRows(e,t){this.mapping.forEach(r=>{const n=new Map;r.forEach((i,a)=>{a>=e&&(n.set(a+t,i),r.delete(a))}),n.forEach((i,a)=>{r.set(a,i)})}),this.height+=t}addColumns(e,t){const r=new Map;this.mapping.forEach((n,i)=>{i>=e&&(r.set(i+t,n),this.mapping.delete(i))}),r.forEach((n,i)=>{this.mapping.set(i,n)}),this.width+=t}removeRows(e){this.mapping.forEach(n=>{const i=new Map;n.forEach((a,o)=>{o>=e.rowStart&&(n.delete(o),o>e.rowEnd&&i.set(o-e.numberOfRows,a))}),i.forEach((a,o)=>{n.set(o,a)})});const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){const t=new Map;this.mapping.forEach((i,a)=>{a>=e.columnStart&&(this.mapping.delete(a),a>e.columnEnd&&t.set(a-e.numberOfColumns,i))}),t.forEach((i,a)=>{this.mapping.set(a,i)});const r=Math.min(this.width-1,e.columnEnd),n=Math.max(0,r-e.columnStart+1);this.width=Math.max(0,this.width-n)}*getEntries(e){for(const[t,r]of this.mapping)for(const[n,i]of r)yield[M(e,t,n),i]}*verticesFromColumn(e){const t=this.mapping.get(e);if(t!==void 0)for(const[r,n]of t)yield n}*verticesFromRow(e){for(const t of this.mapping.values()){const r=t.get(e);r!==void 0&&(yield r)}}*verticesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(r!==void 0)for(const[n,i]of r)yield i}}*verticesFromRowsSpan(e){for(const t of this.mapping.values())for(const r of e.rows()){const n=t.get(r);n!==void 0&&(yield n)}}*entriesFromRowsSpan(e){for(const[t,r]of this.mapping.entries())for(const n of e.rows()){const i=r.get(n);i!==void 0&&(yield[M(e.sheet,t,n),i])}}*entriesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(r!==void 0)for(const[n,i]of r.entries())yield[M(e.sheet,t,n),i]}}*vertices(){for(const[e,t]of this.mapping)for(const[r,n]of t)n!==void 0&&(yield n)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class fE{constructor(e,t){this.width=e,this.height=t,this.mapping=new Array(t);for(let r=0;r<t;r++)this.mapping[r]=new Array(e)}getCell(e){return this.getCellVertex(e.col,e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1),this.mapping[e.row]||(this.mapping[e.row]=new Array(this.width)),this.mapping[e.row][e.col]=t}has(e){const t=this.mapping[e.row];return t?!!t[e.col]:!1}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){this.mapping[e.row]!==void 0&&delete this.mapping[e.row][e.col]}addRows(e,t){const r=[];for(let n=0;n<t;n++)r.push(new Array(this.width));this.mapping.splice(e,0,...r),this.height+=t}addColumns(e,t){for(let r=0;r<this.height;r++)this.mapping[r]!==void 0&&this.mapping[r].splice(e,0,...new Array(t));this.width+=t}removeRows(e){this.mapping.splice(e.rowStart,e.numberOfRows);const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){for(let n=0;n<this.height;n++)this.mapping[n]!==void 0&&this.mapping[n].splice(e.columnStart,e.numberOfColumns);const t=Math.min(this.width-1,e.columnEnd),r=Math.max(0,t-e.columnStart+1);this.width=Math.max(0,this.width-r)}*getEntries(e){for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r){const n=this.getCellVertex(r,t);n&&(yield[M(e,r,t),n])}}*verticesFromColumn(e){for(let t=0;t<this.height;++t){const r=this.getCellVertex(e,t);r&&(yield r)}}*verticesFromRow(e){for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}*verticesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const n=this.getCellVertex(t,r);n&&(yield n)}}*verticesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const n=this.getCellVertex(t,r);n&&(yield n)}}*entriesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const n=this.getCellVertex(t,r);n&&(yield[M(e.sheet,t,r),n])}}*entriesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const n=this.getCellVertex(t,r);n&&(yield[M(e.sheet,t,r),n])}}*vertices(){for(let e=0;e<this.height;++e)for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}getCellVertex(e,t){var r;return(r=this.mapping[t])===null||r===void 0?void 0:r[e]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var m;(function(s){s.DIV_BY_ZERO="DIV_BY_ZERO",s.NAME="NAME",s.VALUE="VALUE",s.NUM="NUM",s.NA="NA",s.CYCLE="CYCLE",s.REF="REF",s.SPILL="SPILL",s.LIC="LIC",s.ERROR="ERROR"})(m||(m={}));var He;(function(s){s.FORMULA="FORMULA",s.VALUE="VALUE",s.ARRAY="ARRAY",s.EMPTY="EMPTY",s.ARRAYFORMULA="ARRAYFORMULA"})(He||(He={}));const mE=(s,e)=>s instanceof fe?s.isLeftCorner(e)?He.ARRAYFORMULA:He.ARRAY:s instanceof Ft||s instanceof Xr?He.FORMULA:s instanceof sr?He.VALUE:He.EMPTY;var bs;(function(s){s.EMPTY="EMPTY",s.NUMBER="NUMBER",s.STRING="STRING",s.BOOLEAN="BOOLEAN",s.ERROR="ERROR"})(bs||(bs={}));var Xi;(function(s){s.NUMBER="NUMBER"})(Xi||(Xi={}));const St=Object.assign(Object.assign({},bs),Xi),gE=Object.assign(Object.assign({},bs),L),Uo=s=>{switch(s){case St.EMPTY:return 0;case St.NUMBER:return 1;case St.STRING:return 2;case St.BOOLEAN:return 3;case St.ERROR:return 4}throw new Error("Cell value not computed")},xs=s=>{if(s===B)return St.EMPTY;if(s instanceof p||s instanceof w)return St.ERROR;if(typeof s=="string")return St.STRING;if(z(s))return St.NUMBER;if(typeof s=="boolean")return St.BOOLEAN;throw new Error("Cell value not computed")},EE=s=>z(s)?Kg(s):xs(s),RE=s=>{if(z(s))return jg(s)};class p{constructor(e,t,r){this.type=e,this.message=t,this.root=r}static parsingError(e){return new p(m.ERROR,`${T.ParseError}${e?" "+e:""}`)}attachRootVertex(e){return this.root===void 0?new p(this.type,this.message,e):this}}const sl=(s,e)=>({sheet:s,row:e}),TE=s=>s.row<0,il=(s,e)=>({sheet:s,col:e}),NE=s=>s.col<0,M=(s,e,t)=>({sheet:s,col:e,row:t}),ze=s=>s.col<0||s.row<0,SE=(s,e,t,r)=>M(e,s.col+t,s.row+r),gn=s=>`${s.sheet},${s.row},${s.col}`;function le(s){var e,t,r;return s&&(typeof s=="object"||typeof s=="function")&&typeof((e=s)===null||e===void 0?void 0:e.sheet)=="number"&&typeof((t=s)===null||t===void 0?void 0:t.col)=="number"&&typeof((r=s)===null||r===void 0?void 0:r.row)=="number"}const yt=(s,e)=>{var t;return(t=s.sheet)!==null&&t!==void 0?t:e.sheet},Mn=(s,e)=>s.sheet===e.sheet&&s.col===e.col&&s.row===e.row;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const AE="AbsoluteCellRange: Wrong range size";function Ze(s){if(s&&(typeof s=="object"||typeof s=="function")){const e=s;return"start"in e&&le(e.start)&&"end"in e&&le(e.end)}else return!1}const $i=(s,e)=>({start:s,end:e});class F{constructor(e,t){if(e.sheet!==t.sheet)throw new vn(e.sheet,t.sheet);this.start=M(e.sheet,e.col,e.row),this.end=M(t.sheet,t.col,t.row)}get sheet(){return this.start.sheet}static fromSimpleCellAddresses(e,t){if(e.sheet!==t.sheet)throw new vn(e.sheet,t.sheet);const r=t.col-e.col,n=t.row-e.row;return Number.isFinite(n)&&Number.isFinite(r)?new F(e,t):Number.isFinite(n)?new zt(e.sheet,e.row,t.row):new Yt(e.sheet,e.col,t.col)}static fromAst(e,t){return e.type===g.CELL_RANGE?F.fromCellRange(e,t):e.type===g.COLUMN_RANGE?Yt.fromColumnRange(e,t):zt.fromRowRangeAst(e,t)}static fromAstOrUndef(e,t){try{return F.fromAst(e,t)}catch{return}}static fromCellRange(e,t){return new F(e.start.toSimpleCellAddress(t),e.end.toSimpleCellAddress(t))}static spanFrom(e,t,r){const n=F.spanFromOrUndef(e,t,r);if(n===void 0)throw new Error(AE);return n}static spanFromOrUndef(e,t,r){if(!Number.isFinite(t)&&Number.isFinite(r))return e.col!==0?void 0:new zt(e.sheet,e.row,e.row+r-1);if(!Number.isFinite(r)&&Number.isFinite(t))return e.row!==0?void 0:new Yt(e.sheet,e.col,e.col+t-1);if(Number.isFinite(r)&&Number.isFinite(t))return new F(e,M(e.sheet,e.col+t-1,e.row+r-1))}static fromCoordinates(e,t,r,n,i){return new F(M(e,t,r),M(e,n,i))}isFinite(){return Number.isFinite(this.size())}doesOverlap(e){return!(this.start.sheet!=e.start.sheet||this.end.row<e.start.row||this.start.row>e.end.row||this.end.col<e.start.col||this.start.col>e.end.col)}addressInRange(e){return this.sheet!==e.sheet?!1:this.start.row<=e.row&&this.end.row>=e.row&&this.start.col<=e.col&&this.end.col>=e.col}columnInRange(e){return this.sheet!==e.sheet?!1:this.start.col<=e.col&&this.end.col>=e.col}rowInRange(e){return this.sheet!==e.sheet?!1:this.start.row<=e.row&&this.end.row>=e.row}containsRange(e){return this.addressInRange(e.start)&&this.addressInRange(e.end)}intersectionWith(e){if(this.sheet!==e.start.sheet)return;const t=Math.max(this.start.row,e.start.row),r=Math.min(this.end.row,e.end.row),n=Math.max(this.start.col,e.start.col),i=Math.min(this.end.col,e.end.col);if(!(t>r||n>i))return new F(M(this.sheet,n,t),M(this.sheet,i,r))}includesRow(e){return this.start.row<e&&this.end.row>=e}includesColumn(e){return this.start.col<e&&this.end.col>=e}shiftByRows(e){this.start.row+=e,this.end.row+=e}expandByRows(e){this.end.row+=e}shiftByColumns(e){this.start.col+=e,this.end.col+=e}shifted(e,t){return F.spanFrom(M(this.sheet,this.start.col+e,this.start.row+t),this.width(),this.height())}expandByColumns(e){this.end.col+=e}moveToSheet(e){this.start.sheet=e,this.end.sheet=e}removeSpan(e){e instanceof Xe?this.removeRows(e.start,e.end):this.removeColumns(e.start,e.end)}shouldBeRemoved(){return this.width()<=0||this.height()<=0}rangeWithSameWidth(e,t){return F.spanFrom(M(this.sheet,this.start.col,e),this.width(),t)}rangeWithSameHeight(e,t){return F.spanFrom(M(this.sheet,e,this.start.row),t,this.height())}toString(){return`${this.start.sheet},${this.start.col},${this.start.row},${this.end.col},${this.end.row}`}width(){return this.end.col-this.start.col+1}height(){return this.end.row-this.start.row+1}size(){return this.height()*this.width()}arrayOfAddressesInRange(){const e=[];for(let t=0;t<this.height();++t){e[t]=[];for(let r=0;r<this.width();++r){const n=M(this.sheet,this.start.col+r,this.start.row+t);e[t].push(n)}}return e}withStart(e){return new F(e,this.end)}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}sameAs(e){return Mn(this.start,e.start)&&Mn(this.end,e.end)}addressesArrayMap(e,t){const r=[];let n=this.start.row;for(;n<=this.effectiveEndRow(e);){let i=this.start.col;const a=[];for(;i<=this.effectiveEndColumn(e);)a.push(t(M(this.start.sheet,i,n))),i++;r.push(a),n++}return r}addresses(e){const t=[];let r=this.start.row;const n=this.effectiveEndRow(e),i=this.effectiveEndColumn(e);for(;r<=n;){let a=this.start.col;for(;a<=i;)t.push(M(this.start.sheet,a,r)),a++;r++}return t}*addressesWithDirection(e,t,r){if(e>0)if(t>0){let n=this.effectiveEndRow(r);for(;n>=this.start.row;){let i=this.effectiveEndColumn(r);for(;i>=this.start.col;)yield M(this.start.sheet,i,n),i-=1;n-=1}}else{let n=this.start.row;for(;n<=this.effectiveEndRow(r);){let i=this.effectiveEndColumn(r);for(;i>=this.start.col;)yield M(this.start.sheet,i,n),i-=1;n+=1}}else if(t>0){let n=this.effectiveEndRow(r);for(;n>=this.start.row;){let i=this.start.col;for(;i<=this.effectiveEndColumn(r);)yield M(this.start.sheet,i,n),i+=1;n-=1}}else{let n=this.start.row;for(;n<=this.effectiveEndRow(r);){let i=this.start.col;for(;i<=this.effectiveEndColumn(r);)yield M(this.start.sheet,i,n),i+=1;n+=1}}}getAddress(e,t){if(e<0||t<0||t>this.height()-1||e>this.width()-1)throw Error("Index out of bound");return M(this.start.sheet,this.start.col+e,this.start.row+t)}exceedsSheetSizeLimits(e,t){return this.end.col>=e||this.end.row>=t}effectiveEndColumn(e){return this.end.col}effectiveEndRow(e){return this.end.row}effectiveWidth(e){return this.width()}effectiveHeight(e){return this.height()}removeRows(e,t){if(!(e>this.end.row)){if(t<this.start.row){const r=t-e+1;return this.shiftByRows(-r)}e<=this.start.row&&(this.start.row=e),this.end.row-=Math.min(t,this.end.row)-e+1}}removeColumns(e,t){if(!(e>this.end.col)){if(t<this.start.col){const r=t-e+1;return this.shiftByColumns(-r)}e<=this.start.col&&(this.start.col=e),this.end.col-=Math.min(t,this.end.col)-e+1}}}class Yt extends F{constructor(e,t,r){super(M(e,t,0),M(e,r,Number.POSITIVE_INFINITY))}static fromColumnRange(e,t){const r=e.start.toSimpleColumnAddress(t),n=e.end.toSimpleColumnAddress(t);if(r.sheet!==n.sheet)throw new vn(r.sheet,n.sheet);return new Yt(r.sheet,r.col,n.col)}shouldBeRemoved(){return this.width()<=0}shiftByRows(e){}expandByRows(e){}shifted(e,t){return new Yt(this.sheet,this.start.col+e,this.end.col+e)}rangeWithSameHeight(e,t){return new Yt(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.col>=e}effectiveEndRow(e){return this.effectiveHeight(e)-1}effectiveHeight(e){return e.getSheetHeight(this.sheet)}removeRows(e,t){}}class zt extends F{constructor(e,t,r){super(M(e,0,t),M(e,Number.POSITIVE_INFINITY,r))}static fromRowRangeAst(e,t){const r=e.start.toSimpleRowAddress(t),n=e.end.toSimpleRowAddress(t);if(r.sheet!==n.sheet)throw new vn(r.sheet,n.sheet);return new zt(r.sheet,r.row,n.row)}shouldBeRemoved(){return this.height()<=0}shiftByColumns(e){}expandByColumns(e){}shifted(e,t){return new zt(this.sheet,this.start.row+t,this.end.row+t)}rangeWithSameWidth(e,t){return new zt(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.row>=t}effectiveEndColumn(e){return this.effectiveWidth(e)-1}effectiveWidth(e){return e.getSheetWidth(this.sheet)}removeColumns(e,t){}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class bt{constructor(e,t,r){this.formulaAddress=e,this.arraysFlag=t,this.formulaVertex=r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function yE(s){const e=s.caseSensitive?s.accentSensitive?"variant":"case":s.accentSensitive?"accent":"base",t=s.caseFirst,r=s.ignorePunctuation;return new Intl.Collator(s.localeLang,{sensitivity:e,caseFirst:t,ignorePunctuation:r})}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const CE="i",vE=/^\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij]))\s*(([+-])\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij])))?$/;class IE{constructor(e,t,r){this.config=e,this.dateTimeHelper=t,this.numberLiteralsHelper=r,this.lt=(n,i)=>this.compare(n,i)<0,this.leq=(n,i)=>this.compare(n,i)<=0,this.gt=(n,i)=>this.compare(n,i)>0,this.geq=(n,i)=>this.compare(n,i)>=0,this.eq=(n,i)=>this.compare(n,i)===0,this.neq=(n,i)=>this.compare(n,i)!==0,this.pow=(n,i)=>Math.pow(I(n),I(i)),this.addWithEpsilonRaw=(n,i)=>{const a=n+i;return Math.abs(a)<this.actualEps*Math.abs(n)?0:a},this.addWithEpsilon=(n,i)=>{const a=Po(n,i);return this.ExtendedNumberFactory(this.addWithEpsilonRaw(I(n),I(i)),a)},this.unaryMinus=n=>La(n,-I(n)),this.unaryPlus=n=>n,this.unaryPercent=n=>new cs(I(n)/100),this.concat=(n,i)=>n.concat(i),this.nonstrictadd=(n,i)=>n instanceof p?n:i instanceof p?i:typeof n=="number"?typeof i=="number"?this.addWithEpsilonRaw(n,i):n:typeof i=="number"?i:0,this.subtract=(n,i)=>{const a=Po(n,i),o=I(n),u=I(i);let l=o-u;return Math.abs(l)<this.actualEps*Math.abs(o)&&(l=0),this.ExtendedNumberFactory(l,a)},this.divide=(n,i)=>{const a=I(n),o=I(i);if(o===0)return new p(m.DIV_BY_ZERO);{const u=Vo(n,i);return this.ExtendedNumberFactory(a/o,u)}},this.multiply=(n,i)=>{const a=Vo(n,i);return this.ExtendedNumberFactory(I(n)*I(i),a)},this.manyToExactComplex=n=>{const i=[];for(const a of n){if(a instanceof p)return a;if(z(a)||typeof a=="string"){const o=this.coerceScalarToComplex(a);o instanceof p||i.push(o)}}return i},this.coerceNumbersExactRanges=n=>this.manyToNumbers(n,this.manyToExactNumbers),this.coerceNumbersCoerceRangesDropNulls=n=>this.manyToNumbers(n,this.manyToCoercedNumbersDropNulls),this.manyToExactNumbers=n=>{const i=[];for(const a of n){if(a instanceof p)return a;z(a)&&i.push(I(a))}return i},this.manyToOnlyNumbersDropNulls=n=>{const i=[];for(const a of n){if(a instanceof p)return a;if(z(a))i.push(I(a));else if(a!==B)return new p(m.VALUE,T.NumberExpected)}return i},this.manyToCoercedNumbersDropNulls=n=>{const i=[];for(const a of n){if(a instanceof p)return a;if(a===B)continue;const o=this.coerceScalarToNumberOrError(a);z(o)&&i.push(I(o))}return i},this.collator=yE(e),this.actualEps=e.smartRounding?e.precisionEpsilon:0}eqMatcherFunction(e){const t=this.buildRegex(e);return r=>typeof r=="string"&&t.test(this.normalizeString(r))}neqMatcherFunction(e){const t=this.buildRegex(e);return r=>typeof r!="string"||!t.test(this.normalizeString(r))}searchString(e,t){var r;const i=this.buildRegex(e,!1).exec(t);return(r=i?.index)!==null&&r!==void 0?r:-1}requiresRegex(e){if(!this.config.useRegularExpressions&&!this.config.useWildcards)return!this.config.matchWholeCell;for(let t=0;t<e.length;t++){const r=e.charAt(t);if(wn(r)||this.config.useRegularExpressions&&_n(r))return!0}return!1}floatCmp(e,t){const r=I(e),n=I(t),i=1+this.actualEps;return n>=0&&r*i>=n&&r<=n*i||n<=0&&r*i<=n&&r>=n*i?0:r>n?1:-1}coerceScalarToNumberOrError(e){var t;return e instanceof p?e:(t=this.coerceToMaybeNumber(e))!==null&&t!==void 0?t:new p(m.VALUE,T.NumberCoercion)}coerceToMaybeNumber(e){var t;return(t=this.coerceNonDateScalarToMaybeNumber(e))!==null&&t!==void 0?t:typeof e=="string"?this.dateTimeHelper.dateStringToDateNumber(e):void 0}coerceNonDateScalarToMaybeNumber(e){if(e===B)return 0;if(typeof e=="string"){if(e==="")return 0;const t=this.coerceStringToMaybePercentNumber(e);if(t!==void 0)return t;const r=this.coerceStringToMaybeCurrencyNumber(e);return r!==void 0?r:this.numberLiteralsHelper.numericStringToMaybeNumber(e.trim())}else return z(e)?e:typeof e=="boolean"?Number(e):void 0}coerceStringToMaybePercentNumber(e){const t=e.trim();if(t.endsWith("%")){const r=t.slice(0,t.length-1).trim(),n=this.numberLiteralsHelper.numericStringToMaybeNumber(r);if(n!==void 0)return new cs(n/100)}}coerceStringToMaybeCurrencyNumber(e){const t=this.currencyMatcher(e.trim());if(t!==void 0){const[r,n]=t,i=this.numberLiteralsHelper.numericStringToMaybeNumber(n);if(i!==void 0)return new Yi(i,r)}}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length).trim()];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length).trim()]}}coerceComplexExactRanges(e){const t=[];for(const n of e)if(n instanceof w)t.push(n);else if(n!==B){const i=this.coerceScalarToComplex(n);if(i instanceof p)return i;t.push(i)}const r=[];for(const n of t)if(n instanceof w){const i=this.manyToExactComplex(n.valuesFromTopLeftCorner());if(i instanceof p)return i;r.push(...i)}else r.push(n);return r}coerceScalarToComplex(e){return e instanceof p?e:e===B?[0,0]:z(e)?[I(e),0]:typeof e=="string"?this.coerceStringToComplex(e):new p(m.NUM,T.ComplexNumberExpected)}ExtendedNumberFactory(e,t){const{type:r,format:n}=t;switch(r){case L.NUMBER_RAW:return e;case L.NUMBER_CURRENCY:return new Yi(e,n??this.config.currencySymbol[0]);case L.NUMBER_DATE:return new Fa(e,n);case L.NUMBER_DATETIME:return new ba(e,n);case L.NUMBER_TIME:return new Ua(e,n);case L.NUMBER_PERCENT:return new cs(e,n)}}buildRegex(e,t=!0){e=this.normalizeString(e);let r,n=this.config.useWildcards,i=this.config.useRegularExpressions;if(i)try{RegExp(e)}catch{i=!1,n=!1}return i?r=_E(e,this.config.caseSensitive):n?r=ME(e,this.config.caseSensitive):r=wE(e,this.config.caseSensitive),this.config.matchWholeCell&&t?RegExp("^("+r+")$"):RegExp(r)}normalizeString(e){return this.config.caseSensitive||(e=e.toLowerCase()),this.config.accentSensitive||(e=ll(e,"nfd").replace(/[\u0300-\u036f]/g,"")),e}compare(e,t){if(typeof e=="string"||typeof t=="string"){const r=typeof e=="string"?this.dateTimeHelper.dateStringToDateNumber(e):e,n=typeof t=="string"?this.dateTimeHelper.dateStringToDateNumber(t):t;if(z(r)&&z(n))return this.floatCmp(r,n)}return e===B?e=bo(t):t===B&&(t=bo(e)),typeof e=="string"&&typeof t=="string"?this.stringCmp(e,t):typeof e=="boolean"&&typeof t=="boolean"?xo(Ki(e),Ki(t)):z(e)&&z(t)?this.floatCmp(e,t):e===B&&t===B?0:xo(Uo(xs(e)),Uo(xs(t)))}stringCmp(e,t){return this.collator.compare(e,t)}manyToNumbers(e,t){const r=[];for(const i of e)if(i instanceof w)r.push(i);else{const a=I(this.coerceScalarToNumberOrError(i));if(a instanceof p)return a;r.push(a)}const n=[];for(const i of r)if(i instanceof w){const a=t(i.valuesFromTopLeftCorner());if(a instanceof p)return a;n.push(...a)}else n.push(i);return n}coerceStringToComplex(e){const t=vE.exec(e);if(t===null)return new p(m.NUM,T.ComplexNumberExpected);let r;if(t[6]!==void 0?r=t[1]==="-"?[0,-1]:[0,1]:r=this.parseComplexToken(t[1]+t[3],t[5]),r instanceof p||t[8]===void 0)return r;let n;return t[14]!==void 0?n=t[9]==="-"?[0,-1]:[0,1]:n=this.parseComplexToken(t[9]+t[11],t[13]),n instanceof p?n:t[5]!==""||t[13]===""?new p(m.NUM,T.ComplexNumberExpected):t[8]==="+"?[r[0]+n[0],r[1]+n[1]]:[r[0]-n[0],r[1]-n[1]]}parseComplexToken(e,t){const r=I(this.coerceNonDateScalarToMaybeNumber(e));return r===void 0?new p(m.NUM,T.ComplexNumberExpected):t===""?[r,0]:[0,r]}}function ue([s,e],t){if(!isFinite(s)||!isFinite(e))return new p(m.NUM,T.NaN);if(t=t??CE,e===0)return`${s}`;const r=`${e===-1||e===1?"":Math.abs(e)}${t}`;return s===0?`${e<0?"-":""}${r}`:`${s}${e<0?"-":"+"}${r}`}function al(s){return s instanceof w?s:w.fromScalar(s)}function Ki(s){return Number(s)}function bo(s){return typeof s=="string"?"":z(s)?0:typeof s=="boolean"?!1:B}function ol(s){if(s instanceof p||typeof s=="boolean")return s;if(s===B)return!1;if(z(s))return I(s)!==0;{const e=s.toUpperCase();return e==="TRUE"?!0:e==="FALSE"||e===""?!1:void 0}}function ji(s){return s instanceof p||typeof s=="string"?s:s===B?"":z(s)?I(s).toString():s?"TRUE":"FALSE"}function zn(s){return s===B?0:s}function xo(s,e){const t=I(s),r=I(e);return t>r?1:t<r?-1:0}function ul(s){return isNaN(s)||s===1/0||s===-1/0}function hl(s){return s===0?0:s}function wn(s){return["*","?"].includes(s)}const OE=["{","}","[","]","(",")","<",">","=",".","+","-",",","\\","$","^","!"];function _n(s){return OE.includes(s)}function ME(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);if(n==="~"){if(r==s.length-1){t+="~";continue}const i=s.charAt(r+1);wn(i)||_n(i)?(t+="\\"+i,r++):(t+=i,r++)}else wn(n)?t+="."+n:_n(n)?t+="\\"+n:e?t+=n:t+=n.toLowerCase()}return t}function wE(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);wn(n)||_n(n)?t+="\\"+n:e?t+=n:t+=n.toLowerCase()}return t}function _E(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);wn(n)||_n(n)||e?t+=n:t+=n.toLowerCase()}return t}function Po(s,e){const{type:t,format:r}=Fs(s),{type:n,format:i}=Fs(e);if(t===L.NUMBER_RAW)return{type:n,format:i};if(n===L.NUMBER_RAW)return{type:t,format:r};if((t===L.NUMBER_DATETIME||t===L.NUMBER_DATE)&&(n===L.NUMBER_DATETIME||n===L.NUMBER_DATE))return{type:L.NUMBER_RAW};if(t===L.NUMBER_TIME){if(n===L.NUMBER_DATE)return{type:L.NUMBER_DATETIME,format:`${i} ${r}`};if(n===L.NUMBER_DATETIME)return{type:L.NUMBER_DATETIME,format:i}}if(n===L.NUMBER_TIME){if(t===L.NUMBER_DATE)return{type:L.NUMBER_DATETIME,format:`${r} ${i}`};if(t===L.NUMBER_DATETIME)return{type:L.NUMBER_DATETIME,format:r}}return{type:t,format:r}}function Vo(s,e){let{type:t,format:r}=Fs(s),{type:n,format:i}=Fs(e);return t===L.NUMBER_PERCENT&&(t=L.NUMBER_RAW,r=void 0),n===L.NUMBER_PERCENT&&(n=L.NUMBER_RAW,i=void 0),t===L.NUMBER_RAW?{type:n,format:i}:n===L.NUMBER_RAW?{type:t,format:r}:{type:L.NUMBER_RAW}}function En(s){return ll(s.toLowerCase(),"nfd").replace(/[\u0300-\u036f]/g,"")}function fs(s,e){var t;if(s.isAdHoc())return(t=s.data[0])===null||t===void 0?void 0:t[0];const r=s.range;if(e.formulaAddress.sheet===r.sheet){if(r.width()===1){const n=e.formulaAddress.row-r.start.row;if(n>=0&&n<r.height())return s.data[n][0]}else if(r.height()===1){const n=e.formulaAddress.col-r.start.col;if(n>=0&&n<r.width())return s.data[0][n]}}}function ll(s,e){return s.normalize(e.toUpperCase())}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var h;(function(s){s.STRING="STRING",s.NUMBER="NUMBER",s.BOOLEAN="BOOLEAN",s.SCALAR="SCALAR",s.NOERROR="NOERROR",s.RANGE="RANGE",s.INTEGER="INTEGER",s.COMPLEX="COMPLEX",s.ANY="ANY"})(h||(h={}));class P{constructor(e){this.coerceScalarToNumberOrError=t=>this.arithmeticHelper.coerceScalarToNumberOrError(t),this.runFunction=(t,r,n,i)=>{const a=this.evaluateArguments(t,r,n),o=a.map(([N,R])=>N),u=a.map(([N,R])=>R),l=this.buildMetadataForEachArgumentValue(o.length,n),c=r.arraysFlag&&!n.vectorizationForbidden;if(!this.isNumberOfArgumentValuesValid(l,o.length))return new p(m.NA,T.WrongArgNumber);const[d,f]=c?this.calculateSizeOfVectorizedResultArray(o,l):[1,1];if(d===1&&f===1){const N=this.vectorizeAndBroadcastArgumentsIfNecessary(c,o,l,0,0);return this.calculateSingleCellOfResultArray(r,N,l,u,i,n.returnNumberType)}const E=[...Array(d).keys()].map(N=>[...Array(f).keys()].map(R=>{const A=this.vectorizeAndBroadcastArgumentsIfNecessary(c,o,l,N,R),S=this.calculateSingleCellOfResultArray(r,A,l,u,i,n.returnNumberType);if(S instanceof w)throw new Error("Function returning array cannot be vectorized.");return S}));return w.onlyValues(E)},this.runFunctionWithReferenceArgument=(t,r,n,i,a,o=()=>new p(m.NA,T.CellRefExpected))=>{if(t.length===0)return this.returnNumberWrapper(i(),n.returnNumberType);if(t.length>1)return new p(m.NA,T.WrongArgNumber);let u=t[0];for(;u.type===g.PARENTHESIS;)u=u.expression;let l;if(u.type===g.CELL_REFERENCE)l=u.reference.toSimpleCellAddress(r.formulaAddress);else if(u.type===g.CELL_RANGE||u.type===g.COLUMN_RANGE||u.type===g.ROW_RANGE)try{l=F.fromAst(u,r.formulaAddress).start}catch{return new p(m.REF,T.CellRefExpected)}return l!==void 0?this.returnNumberWrapper(a(l),n.returnNumberType):this.runFunction(t,r,n,o)},this.interpreter=e,this.dependencyGraph=e.dependencyGraph,this.columnSearch=e.columnSearch,this.config=e.config,this.serialization=e.serialization,this.arraySizePredictor=e.arraySizePredictor,this.dateTimeHelper=e.dateTimeHelper,this.arithmeticHelper=e.arithmeticHelper}evaluateAst(e,t){return this.interpreter.evaluateAst(e,t)}arraySizeForAst(e,t){return this.arraySizePredictor.checkArraySizeForAst(e,t)}listOfScalarValues(e,t){const r=[];for(const n of e){const i=this.evaluateAst(n,t);if(i instanceof w)for(const a of i.valuesFromTopLeftCorner())r.push([a,!0]);else r.push([i,!1])}return r}coerceToType(e,t,r){let n;if(e instanceof w)switch(t.argumentType){case h.RANGE:case h.ANY:n=e;break;default:{const i=fs(e,r);if(i===void 0)return;e=i}}if(!(e instanceof w))switch(t.argumentType){case h.INTEGER:case h.NUMBER:const i=this.coerceScalarToNumberOrError(e);if(!z(i)){n=i;break}const a=I(i);if(t.maxValue!==void 0&&a>t.maxValue)return new p(m.NUM,T.ValueLarge);if(t.minValue!==void 0&&a<t.minValue)return new p(m.NUM,T.ValueSmall);if(t.lessThan!==void 0&&a>=t.lessThan)return new p(m.NUM,T.ValueLarge);if(t.greaterThan!==void 0&&a<=t.greaterThan)return new p(m.NUM,T.ValueSmall);if(t.argumentType===h.INTEGER&&!Number.isInteger(a))return new p(m.NUM,T.IntegerExpected);n=i;break;case h.STRING:n=ji(e);break;case h.BOOLEAN:n=ol(e);break;case h.SCALAR:case h.NOERROR:case h.ANY:n=e;break;case h.RANGE:if(e instanceof p)return e;n=al(e);break;case h.COMPLEX:return this.arithmeticHelper.coerceScalarToComplex(I(e))}return t.passSubtype||n===void 0?n:I(n)}calculateSingleCellOfResultArray(e,t,r,n,i,a){const o=this.coerceArgumentsToRequiredTypes(e,t,r,n);if(o instanceof p)return o;const u=i(...o);return this.returnNumberWrapper(u,a)}coerceArgumentsToRequiredTypes(e,t,r,n){const i=[];for(let a=0;a<r.length;a++){const o=r[a],u=t[a]!==void 0?t[a]:o?.defaultValue;if(u===void 0){i.push(void 0);continue}const l=this.coerceToType(u,o,e);if(l===void 0&&!n[a])return new p(m.VALUE,T.WrongType);if(l instanceof p&&o.argumentType!==h.SCALAR)return l;i.push(l)}return i}vectorizeAndBroadcastArgumentsIfNecessary(e,t,r,n,i){return t.map((a,o)=>e&&this.isRangePassedAsAScalarArgument(a,r[o])?this.vectorizeAndBroadcastRangeArgument(a,n,i):a)}vectorizeAndBroadcastRangeArgument(e,t,r){var n;const i=e.height()===1?0:t,a=e.width()===1?0:r;return(n=e.data[i])===null||n===void 0?void 0:n[a]}evaluateArguments(e,t,r){return r.expandRanges?this.listOfScalarValues(e,t):e.map(n=>[this.evaluateAst(n,t),!1])}buildMetadataForEachArgumentValue(e,t){const r=t.parameters?[...t.parameters]:[];if(t.repeatLastArgs!==void 0&&Number.isInteger(t.repeatLastArgs)&&t.repeatLastArgs>0)for(;e>r.length;)r.push(...r.slice(r.length-t.repeatLastArgs));return r}isNumberOfArgumentValuesValid(e,t){return t>e.length?!1:t<e.length?e.slice(t).every(i=>i?.optionalArg||i?.defaultValue!==void 0):!0}calculateSizeOfVectorizedResultArray(e,t){const r=e.filter((a,o)=>this.isRangePassedAsAScalarArgument(a,t[o])),n=Math.max(1,...r.map(a=>a.height())),i=Math.max(1,...r.map(a=>a.width()));return[n,i]}isRangePassedAsAScalarArgument(e,t){return e==null||t==null?!1:e instanceof w&&![h.RANGE,h.ANY].includes(t.argumentType)}metadata(e){const t=this.constructor.implementedFunctions[e];if(t!==void 0)return t;throw new Error(`No metadata for function ${e}.`)}returnNumberWrapper(e,t,r){return t!==void 0&&z(e)?this.arithmeticHelper.ExtendedNumberFactory(I(e),{type:t,format:r}):e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class V{constructor(e,t,r=!1){this.width=e,this.height=t,this.isRef=r}static error(){return new V(1,1,!0)}static scalar(){return new V(1,1,!1)}isScalar(){return this.width===1&&this.height===1||this.isRef}}function LE(s,e){return new V(Math.max(s.width,e.width),Math.max(s.height,e.height))}function FE(s){return new V(s.width,s.height)}class UE{constructor(e,t){this.config=e,this.functionRegistry=t}checkArraySize(e,t){return this.checkArraySizeForAst(e,{formulaAddress:t,arraysFlag:this.config.useArrayArithmetic})}checkArraySizeForAst(e,t){switch(e.type){case g.FUNCTION_CALL:return this.checkArraySizeForFunction(e,t);case g.COLUMN_RANGE:case g.ROW_RANGE:case g.CELL_RANGE:{const r=F.fromAstOrUndef(e,t.formulaAddress);return r===void 0?V.error():new V(r.width(),r.height(),!0)}case g.ARRAY:{const r=[],n=[];for(const o of e.args){const u=o.map(d=>this.checkArraySizeForAst(d,t)),l=Math.min(...u.map(d=>d.height)),c=u.reduce((d,f)=>d+f.width,0);r.push(l),n.push(c)}const i=r.reduce((o,u)=>o+u,0),a=Math.min(...n);return new V(a,i)}case g.STRING:case g.NUMBER:return V.scalar();case g.CELL_REFERENCE:return new V(1,1,!0);case g.DIV_OP:case g.CONCATENATE_OP:case g.EQUALS_OP:case g.GREATER_THAN_OP:case g.GREATER_THAN_OR_EQUAL_OP:case g.LESS_THAN_OP:case g.LESS_THAN_OR_EQUAL_OP:case g.MINUS_OP:case g.NOT_EQUAL_OP:case g.PLUS_OP:case g.POWER_OP:case g.TIMES_OP:{const r=this.checkArraySizeForAst(e.left,t),n=this.checkArraySizeForAst(e.right,t);return!t.arraysFlag&&(r.height>1||r.width>1||n.height>1||n.width>1)?V.error():LE(r,n)}case g.MINUS_UNARY_OP:case g.PLUS_UNARY_OP:case g.PERCENT_OP:{const r=this.checkArraySizeForAst(e.value,t);return!t.arraysFlag&&(r.height>1||r.width>1)?V.error():FE(r)}case g.PARENTHESIS:return this.checkArraySizeForAst(e.expression,t);case g.EMPTY:return V.error();default:return V.error()}}checkArraySizeForFunction(e,t){const r=this.functionRegistry.getArraySizeFunction(e.procedureName);if(r!==void 0)return r(e,t);const n=this.functionRegistry.getMetadata(e.procedureName);if(n===void 0||n.expandRanges||!t.arraysFlag||n.vectorizationForbidden||n.parameters===void 0)return new V(1,1);const i=e.args.map(l=>{var c;return this.checkArraySizeForAst(l,new bt(t.formulaAddress,t.arraysFlag||((c=n?.enableArrayArithmeticForArguments)!==null&&c!==void 0?c:!1)))}),a=[...n.parameters];if(n.repeatLastArgs!==void 0&&a.length<i.length&&(i.length-a.length)%n.repeatLastArgs!==0)return V.error();for(;a.length<i.length;){if(n.repeatLastArgs===void 0)return V.error();a.push(...a.slice(a.length-n.repeatLastArgs))}let o=1,u=1;for(let l=0;l<i.length;l++)a[l].argumentType!==h.RANGE&&a[l].argumentType!==h.ANY&&(u=Math.max(u,i[l].height),o=Math.max(o,i[l].width));return new V(o,u)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class cl{constructor(e,t,r){var n;this.value=t,this.address=r,this.type=e.type,this.message=(n=e.message)!==null&&n!==void 0?n:""}toString(){return this.value}valueOf(){return this.value}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function $(s,e,t){if(typeof s>"u")return rt.defaultConfig[t];if(typeof e=="string"){if(typeof s===e)return s;throw new Y(e,t)}else{if(e.includes(s))return s;throw new el(e.map(r=>`'${r}'`).join(" "),t)}}function Lr(s,e,t){if(s<t)throw new Zh(e,t)}function bE(s,e,t){if(s>t)throw new Jh(e,t)}function Xn(s,e,t,r){if(e(s))return s;if(typeof s>"u")return rt.defaultConfig[r];throw new Y(t,r)}function Do(...s){const e=new Map;s.forEach(r=>{const n=e.get(r.value)||[];n.push(r.name),e.set(r.value,n)});const t=[];for(const r of e.values())r.length>1&&t.push(r);if(t.length>0){t.forEach(n=>n.sort());const r=t.map(n=>`[${n}]`).join("; ");throw new Error(`Config initialization failed. Parameters in conflict: ${r}`)}}function v(s,e,t){if(typeof s!==e)throw new Y(e,t)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Va=new RegExp("^ss(\\.(s+|0+))?$"),xE=new RegExp("^[0-9/.\\-: ]+[ap]?m?$"),PE=new RegExp("\\s+"),dl=new RegExp("[ /.-]"),qi=":",Bo=1e3,VE=pl(kE),DE=pl(GE);function BE(s,e,t){if(e===void 0&&t===void 0)return;let r=s.replace(PE," ").trim().toLowerCase();if(!HE(r))return;let n=r.substring(r.length-2);n==="am"||n==="pm"?r=r.substring(0,r.length-2).trim():(n=r.substring(r.length-1),n==="a"||n==="p"?r=r.substring(0,r.length-1).trim():n=void 0);const i=r.split(dl);i.length>=2&&i[i.length-2].includes(qi)&&(i[i.length-2]=i[i.length-2]+"."+i[i.length-1],i.pop());const a=i[i.length-1].split(qi);if(n!==void 0&&a.push(n),i.length===1)return ko(a,t);if(a.length===1)return Go(i,e);const o=Go(i.slice(0,i.length-1),e),u=ko(a,t);if(o!==void 0)return u===void 0?void 0:Object.assign(Object.assign({},o),u)}function ko(s,e){var t,r,n;if(e===void 0)return;const{itemsCount:i,hourItem:a,minuteItem:o,secondItem:u}=VE(e);let l;if(s[s.length-1]==="am"||s[s.length-1]==="a"?(l=!1,s.pop()):(s[s.length-1]==="pm"||s[s.length-1]==="p")&&(l=!0,s.pop()),s.length!==i)return;const c=Number((t=s[u])!==null&&t!==void 0?t:"0");if(!Number.isFinite(c))return;const d=Math.round(c*Bo)/Bo,f=Number((r=s[o])!==null&&r!==void 0?r:"0");if(!(Number.isFinite(f)&&Number.isInteger(f)))return;const E=Number((n=s[a])!==null&&n!==void 0?n:"0");return!(Number.isFinite(E)&&Number.isInteger(E))||l!==void 0&&(E<0||E>12)?void 0:{hours:l!==void 0?E%12+(l?12:0):E,minutes:f,seconds:d}}function Go(s,e){var t;if(e===void 0)return;const{itemsCount:r,dayItem:n,monthItem:i,shortYearItem:a,longYearItem:o}=DE(e);if(s.length!==r)return;const u=Number(s[n]);if(!(Number.isFinite(u)&&Number.isInteger(u)))return;const l=Number(s[i]);if(!(Number.isFinite(l)&&Number.isInteger(l))||s[o]&&s[a])return;const c=Number((t=s[o])!==null&&t!==void 0?t:s[a]);if(Number.isFinite(c)&&Number.isInteger(c)&&!(s[o]&&(c<1e3||c>9999))&&!(s[a]&&(c<0||c>99)))return{year:c,month:l,day:u}}function kE(s){const e=s.toLowerCase().trim(),r=(e.endsWith("am/pm")?e.substring(0,e.length-5):e.endsWith("a/p")?e.substring(0,s.length-3):e).trim().split(qi);return{itemsCount:r.length,hourItem:r.indexOf("hh"),minuteItem:r.indexOf("mm"),secondItem:r.findIndex(n=>Va.test(n))}}function GE(s){const e=s.toLowerCase().trim().split(dl);return{itemsCount:e.length,dayItem:e.indexOf("dd"),monthItem:e.indexOf("mm"),shortYearItem:e.indexOf("yy"),longYearItem:e.indexOf("yyyy")}}function HE(s){return xE.test(s)}function pl(s){const e={};return t=>{const r=e[t];if(r!==void 0)return r;const n=s(t);return e[t]=n,n}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Qi=[31,28,31,30,31,30,31,31,30,31,30,31],Wr=[0,31,59,90,120,151,181,212,243,273,304,334],$n=60,Kn=60,Zi=24;function Rn(s){return s&&(typeof s=="object"||typeof s=="function")?"year"in s&&typeof s.year=="number"&&"month"in s&&typeof s.month=="number"&&"day"in s&&typeof s.day=="number":!1}function fl(s){return s&&(typeof s=="object"||typeof s=="function")?"hours"in s&&typeof s.hours=="number"&&"minutes"in s&&typeof s.minutes=="number"&&"seconds"in s&&typeof s.seconds=="number":!1}const WE={year:9999,month:12,day:31};class YE{constructor(e){this.config=e,this.minDateAbsoluteValue=this.dateToNumberFromZero(e.nullDate),this.maxDateValue=this.dateToNumber(WE),this.leapYear1900=e.leapYear1900,!this.leapYear1900&&0<=this.dateToNumber({year:1900,month:2,day:28})?this.epochYearZero=this.numberToSimpleDate(2).year:this.epochYearZero=this.numberToSimpleDate(1).year,this.parseDateTime=e.parseDateTime}getWithinBounds(e){return e<=this.maxDateValue&&e>=0?e:void 0}dateStringToDateNumber(e){const{dateTime:t,dateFormat:r="",timeFormat:n=""}=this.parseDateTimeFromConfigFormats(e);if(t!==void 0)return fl(t)?Rn(t)?new ba(Kr(t)+this.dateToNumber(t),r+" "+n):new Ua(Kr(t),n):Rn(t)?new Fa(this.dateToNumber(t),r):0}parseDateTimeFromConfigFormats(e){return this.parseDateTimeFromFormats(e,this.config.dateFormats,this.config.timeFormats)}getNullYear(){return this.config.nullYear}getEpochYearZero(){return this.epochYearZero}isValidDate(e){return isNaN(e.year)||isNaN(e.month)||isNaN(e.day)||e.day!==Math.round(e.day)||e.month!==Math.round(e.month)||e.year!==Math.round(e.year)||e.year<1582||e.month<1||e.month>12||e.day<1?!1:this.isLeapYear(e.year)&&e.month===2?e.day<=29:e.day<=Qi[e.month-1]}dateToNumber(e){return this.dateToNumberFromZero(e)-this.minDateAbsoluteValue}relativeNumberToAbsoluteNumber(e){return e+this.minDateAbsoluteValue-(this.leapYear1900?1:0)}numberToSimpleDate(e){const t=Math.floor(e)+this.minDateAbsoluteValue;let r=Math.floor(t/365.2425);this.dateToNumberFromZero({year:r+1,month:1,day:1})<=t?r++:this.dateToNumberFromZero({year:r-1,month:1,day:1})>t&&r--;const n=t-this.dateToNumberFromZero({year:r,month:1,day:1}),i=zE(n-(this.isLeapYear(r)&&n>=59?1:0)),a=n-Wr[i]-(this.isLeapYear(r)&&i>1?1:0);return{year:r,month:i+1,day:a+1}}numberToSimpleDateTime(e){const t=$r(e%1),r=Math.floor(t.hours/Zi);t.hours=t.hours%Zi;const n=this.numberToSimpleDate(Math.floor(e)+r);return Object.assign(Object.assign({},n),t)}leapYearsCount(e){return Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400)+(this.config.leapYear1900&&e>=1900?1:0)}daysInMonth(e,t){return this.isLeapYear(e)&&t===2?29:Qi[t-1]}endOfMonth(e){return{year:e.year,month:e.month,day:this.daysInMonth(e.year,e.month)}}toBasisUS(e,t){return e.day===31&&(e.day=30),e.day===30&&t.day===31&&(t.day=30),e.month===2&&e.day===this.daysInMonth(e.year,e.month)&&(e.day=30,t.month===2&&t.day===this.daysInMonth(t.year,t.month)&&(t.day=30)),[e,t]}yearLengthForBasis(e,t){return e.year!==t.year?e.year+1!==t.year||e.month<t.month||e.month===t.month&&e.day<t.day?(this.leapYearsCount(t.year)-this.leapYearsCount(e.year-1))/(t.year-e.year+1)+365:this.countLeapDays(t)!==this.countLeapDays({year:e.year,month:e.month,day:e.day-1})?366:365:this.isLeapYear(e.year)?366:365}parseSingleFormat(e,t,r){const n=this.parseDateTime(e,t,r);if(!(Rn(n)&&(n.year>=0&&n.year<100&&(n.year<this.getNullYear()?n.year+=2e3:n.year+=1900),!this.isValidDate(n))))return n}parseDateTimeFromFormats(e,t,r){const n=t.length===0?[void 0]:t,i=r.length===0?[void 0]:r;for(const a of n)for(const o of i){const u=this.parseSingleFormat(e,a,o);if(u!==void 0)return{dateTime:u,timeFormat:o,dateFormat:a}}return{}}countLeapDays(e){return e.month>2||e.month===2&&e.day>=29?this.leapYearsCount(e.year):this.leapYearsCount(e.year-1)}dateToNumberFromZero(e){return 365*e.year+Wr[e.month-1]+e.day-1+(e.month<=2?this.leapYearsCount(e.year-1):this.leapYearsCount(e.year))}isLeapYear(e){return e%4?!1:e%100?!0:e%400?e===1900&&this.config.leapYear1900:!0}}function zE(s){let e=0;return Wr[e+6]<=s&&(e+=6),Wr[e+3]<=s&&(e+=3),Wr[e+2]<=s?e+=2:Wr[e+1]<=s&&(e+=1),e}function Ho(s,e){const t=12*s.year+s.month-1+e;return{year:Math.floor(t/12),month:t%12+1,day:s.day}}function XE(s){return{year:s.year,month:s.month,day:Math.min(s.day,Qi[s.month-1])}}function yi(s){return Math.round(s*3600*24)/(3600*24)}function $E(s,e=1){return Math.round(s*e)/e}function $r(s){const e=s*Zi*Kn*$n,t=$E(e%$n,1e5)%$n,r=(e-t)/$n,n=Math.round(r%Kn)%Kn,i=(r-n)/Kn;return{hours:Math.round(i),minutes:n,seconds:t}}function Kr(s){return((s.seconds/60+s.minutes)/60+s.hours)/24}function Wo(s){return{year:s.year,month:s.month,day:Math.min(30,s.day)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class KE{call(){return fE}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Yo=/(\\.|dd|DD|d|D|mm|MM|m|M|YYYY|YY|yyyy|yy|HH|hh|H|h|ss(\.(0+|s+))?|s|AM\/PM|am\/pm|A\/P|a\/p|\[mm]|\[MM]|\[hh]|\[HH])/g,zo=/(\\.|[#0]+(\.[#0]*)?)/g;var Ut;(function(s){s.FORMAT="FORMAT",s.FREE_TEXT="FREE_TEXT"})(Ut||(Ut={}));function jn(s,e){return{type:s,value:e}}var Ps;(function(s){s.DATE="DATE",s.NUMBER="NUMBER",s.STRING="STRING"})(Ps||(Ps={}));function jE(s){Yo.lastIndex=0;const e=[];let t;do t=Yo.exec(s),t!==null&&e.push(t);while(t);return e}function qE(s){zo.lastIndex=0;const e=zo.exec(s);return e!==null?[e]:[]}function ml(s,e){const t=[];let r=0;for(let i=0;i<s.length;++i){const a=s[i];if(a.index!==r){const o=e.substr(r,a.index-r);t.push(jn(Ut.FREE_TEXT,o))}a[0].startsWith("\\")?t.push(jn(Ut.FREE_TEXT,a[0])):t.push(jn(Ut.FORMAT,a[0])),r=a.index+a[0].length}const n=s[s.length-1];if(n.index+n[0].length<e.length){const i=e.substr(n.index+n[0].length,e.length);t.push(jn(Ut.FREE_TEXT,i))}return t}function gl(s){const e=jE(s);if(!e.every(t=>El(t)))return{type:Ps.DATE,tokens:ml(e,s)}}function QE(s){const e=qE(s);if(!e.every(t=>El(t)))return{type:Ps.NUMBER,tokens:ml(e,s)}}function El(s){return s[0].startsWith("\\")}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function ZE(s,e,t,r){const n=t.stringifyDateTime(r.numberToSimpleDateTime(s),e);if(n!==void 0)return n;const i=t.stringifyDuration($r(s),e);if(i!==void 0)return i;const a=QE(e);return a!==void 0?eR(a.tokens,s):e}function We(s,e){let t=`${s}`;for(;t.length<e;)t="0"+t;return t}function JE(s,e){let t=`${s}`;for(;t.length<e;)t=t+"0";return t}function Xo(s,e){return s.split(e).length-1}function eR(s,e){let t="";for(let r=0;r<s.length;++r){const n=s[r];if(n.type===Ut.FREE_TEXT){t+=n.value;continue}const i=n.value.split("."),a=i[0],o=i[1]||"",u=i[1]?".":"",l=Number(e.toFixed(o.length)).toString().split(".");let c=l[0]||"",d=l[1]||"";if(a.length>c.length){const E=Xo(a.substr(0,a.length-c.length),"0");c=We(c,E+c.length)}const f=Xo(o.substr(d.length,o.length-d.length),"0");d=JE(d,f+d.length),t+=c+u+d}return t}function tR(s,e){const t=gl(e);if(t===void 0)return;const r=t.tokens;let n="";for(const i of r){if(i.type===Ut.FREE_TEXT){n+=i.value;continue}switch(i.value.toLowerCase()){case"h":case"hh":{n+=We(s.hours,i.value.length),s.hours=0;break}case"[hh]":{n+=We(s.hours,i.value.length-2),s.hours=0;break}case"m":case"mm":{n+=We(s.minutes,i.value.length),s.minutes=0;break}case"[mm]":{n+=We(s.minutes+60*s.hours,i.value.length-2),s.minutes=0,s.hours=0;break}case"s":case"ss":{n+=We(Math.floor(s.seconds),i.value.length);break}default:{if(Va.test(i.value)){const a=Math.max(i.value.length-3,0);n+=`${s.seconds<10?"0":""}${Math.floor(s.seconds*Math.pow(10,a))/Math.pow(10,a)}`;continue}return}}}return n}function rR(s,e){const t=gl(e);if(t===void 0)return;const r=t.tokens;let n="",i=!1;const a=r.some(o=>o.type===Ut.FORMAT&&(o.value==="a/p"||o.value==="A/P"||o.value==="am/pm"||o.value==="AM/PM"));for(let o=0;o<r.length;o++){const u=r[o];if(u.type===Ut.FREE_TEXT){n+=u.value;continue}switch(u.value.toLowerCase()){case"h":case"hh":{i=!0,n+=We(a?(s.hours+11)%12+1:s.hours,u.value.length);break}case"d":case"dd":{n+=We(s.day,u.value.length);break}case"s":case"ss":{n+=We(Math.floor(s.seconds),u.value.length);break}case"m":case"mm":{o+1<r.length&&r[o+1].value.startsWith(":")&&(i=!0),i?n+=We(s.minutes,u.value.length):n+=We(s.month,u.value.length),i=!0;break}case"yy":{n+=We(s.year%100,u.value.length);break}case"yyyy":{n+=s.year;break}case"am/pm":case"a/p":{const[l,c]=u.value.split("/");n+=s.hours<12?l:c;break}default:{if(Va.test(u.value)){const l=u.value.length-3;n+=`${s.seconds<10?"0":""}${Math.floor(s.seconds*Math.pow(10,l))/Math.pow(10,l)}`;continue}return}}}return n}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Ji="length",Tn=s=>parseInt(s,16),$o=s=>parseInt(s,10),Ci=s=>(s+"").replace(/\-/g,""),Vs=(s,e,t)=>s.substr(e,t),Et=s=>s.codePointAt(0)-65;function nR(s){return Ci(s)[Ji]===25?Tn(Vs(Ci(s),Tn("12"),Et("F")))/(Tn(Vs(Ci(s),Et("C"),Et("Y")>>4))||(~~![][Ji]<<3)+1):0}function sR(s){if(s=(s+"").replace(/\-/g,""),s[Ji]!==Et("Z"))return!1;let e=0;return[[0,Et("G")+1],[Et("H"),Et("H")-1],[Et("G")+Et("H"),Et("G")]].reduce((t,[r,n],i)=>(t|=($o(`${$o(Tn(Vs(s,e+r-(i===0?0:2),n+(i?2:0)))+(Tn(Vs(s,e+r+n,2))+[]).padStart(2,"0"))}`)%97||2)>>1,e+=2,t),Et("A"))==="1">>1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const iR={invalid:()=>"The license key for HyperFormula is invalid.",expired:({keyValidityDate:s})=>`The license key for HyperFormula expired on ${s}, and is not valid for the installed version.`,missing:()=>"The license key for HyperFormula is missing."};let Ko=!1;function aR(s){const e={template:"missing",vars:{}};if(s==="gpl-v3"||s==="internal-use-in-handsontable")e.template="valid";else if(typeof s=="string"&&sR(s)){const[t,r,n]="14/10/2025".split("/"),i=Math.floor(new Date(`${r}/${t}/${n}`).getTime()/864e5),a=nR(s);e.vars.keyValidityDate=oR(new Date((a+1)*864e5)),i>a?e.template="expired":e.template="valid"}else s!==""&&(e.template="invalid");return!Ko&&e.template!=="valid"&&(console.warn(iR[e.template](e.vars)),Ko=!0),e.template}function oR(s){const t=["January","February","March","April","May","June","July","August","September","October","November","December"][s.getMonth()],r=s.getDate(),n=s.getFullYear();return`${t} ${r}, ${n}`}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var se;(function(s){class e{constructor(u){this.value=u,this.value=La(this.value,hl(I(this.value)))}}s.Number=e;class t{constructor(u){this.value=u}}s.String=t;class r{constructor(u){this.value=u}}s.Boolean=r;class n{static getSingletonInstance(){return n.instance||(n.instance=new n),n.instance}}s.Empty=n;class i{constructor(u){this.formula=u}}s.Formula=i;class a{constructor(u,l){this.value=new p(u,l)}}s.Error=a})(se||(se={}));function uR(s){return s.startsWith("=")}function hR(s){const e=s.toLowerCase();return e==="true"||e==="false"}function lR(s,e){const t=s.toUpperCase();return/#[A-Za-z0-9\/]+[?!]?/.test(t)&&Object.prototype.hasOwnProperty.call(e,t)}class cR{constructor(e,t,r){this.config=e,this.dateHelper=t,this.numberLiteralsHelper=r}parse(e){if(e==null)return se.Empty.getSingletonInstance();if(typeof e=="number")return ul(e)?new se.Error(m.NUM,T.ValueLarge):new se.Number(e);if(typeof e=="boolean")return new se.Boolean(e);if(e instanceof Date){const t=this.dateHelper.dateToNumber({day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()}),r=Kr({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()+e.getMilliseconds()/1e3}),n=t+r;return n<0?new se.Error(m.NUM,T.DateBounds):n%1===0?new se.Number(new Fa(n,"Date()")):n<1?new se.Number(new Ua(n,"Date()")):new se.Number(new ba(n,"Date()"))}else if(typeof e=="string"){if(hR(e))return new se.Boolean(e.toLowerCase()==="true");if(uR(e))return new se.Formula(e);if(lR(e,this.config.errorMapping))return new se.Error(this.config.errorMapping[e.toUpperCase()]);{let t=e.trim(),r=0,n;if(t.endsWith("%"))r=1,t=t.slice(0,t.length-1);else{const o=this.currencyMatcher(t);o!==void 0&&(r=2,[n,t]=o)}const i=this.numberLiteralsHelper.numericStringToMaybeNumber(t);if(i!==void 0){let o;return r===1?o=new cs(i/100):r===2?o=new Yi(i,n):o=i,new se.Number(o)}const a=this.dateHelper.dateStringToDateNumber(t);return a!==void 0?new se.Number(a):new se.String(e.startsWith("'")?e.slice(1):e)}}else throw new Qh(e)}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length)];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length)]}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Er;(function(s){s[s.COPY=0]="COPY",s[s.CUT=1]="CUT"})(Er||(Er={}));var Me;(function(s){s[s.VALUE=0]="VALUE",s[s.EMPTY=1]="EMPTY",s[s.FORMULA=2]="FORMULA",s[s.PARSING_ERROR=3]="PARSING_ERROR"})(Me||(Me={}));class jo{constructor(e,t,r,n,i){this.sourceLeftCorner=e,this.width=t,this.height=r,this.type=n,this.content=i}*getContent(e){if(this.content!==void 0)for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r)yield[M(e.sheet,e.col+r,e.row+t),this.content[t][r]]}}class dR{constructor(e,t,r){this.dependencyGraph=t,this.operations=r,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}cut(e,t,r){this.clipboard=new jo(e,t,r,Er.CUT)}copy(e,t,r){const n=[];for(let i=0;i<r;++i){n[i]=[];for(let a=0;a<t;++a){const o=this.operations.getClipboardCell(M(e.sheet,e.col+a,e.row+i));n[i].push(o)}}this.clipboard=new jo(e,t,r,Er.COPY,n)}abortCut(){this.clipboard&&this.clipboard.type===Er.CUT&&this.clear()}clear(){this.clipboard=void 0}ensureItIsPossibleToCopyPaste(e){if(this.clipboard===void 0)return;if(ze(e)||!this.dependencyGraph.sheetMapping.hasSheetWithId(e.sheet))throw new Re("a valid target address.");const t=F.spanFrom(e,this.clipboard.width,this.clipboard.height);if(t.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new Nr;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new Error("It is not possible to paste onto an array")}isCutClipboard(){return this.clipboard!==void 0&&this.clipboard.type===Er.CUT}isCopyClipboard(){return this.clipboard!==void 0&&this.clipboard.type===Er.COPY}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ds{constructor(e,t,r,n){this.displayName=e,this.address=t,this.added=r,this.options=n}normalizeExpressionName(){return this.displayName.toLowerCase()}copy(){return new Ds(this.displayName,this.address,this.added,this.options)}}class pR{constructor(){this.mapping=new Map}has(e){return this.mapping.has(this.normalizeExpressionName(e))}isNameAvailable(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);return!(r&&r.added)}add(e){this.mapping.set(e.normalizeExpressionName(),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}getExisting(e){const t=this.mapping.get(this.normalizeExpressionName(e));if(t&&t.added)return t}remove(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);r&&(r.added=!1)}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}normalizeExpressionName(e){return e.toLowerCase()}}class qo{constructor(){this.mapping=new Map}add(e){this.mapping.set(this.normalizeExpressionName(e.displayName),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}has(e){return this.mapping.has(this.normalizeExpressionName(e))}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}isNameAvailable(e){const t=this.normalizeExpressionName(e);return!this.mapping.has(t)}remove(e){const t=this.normalizeExpressionName(e);this.mapping.get(t)&&this.mapping.delete(t)}normalizeExpressionName(e){return e.toLowerCase()}}class vr{constructor(){this.nextNamedExpressionRow=0,this.workbookStore=new pR,this.worksheetStores=new Map,this.addressCache=new Map}isNameAvailable(e,t){var r,n;return t===void 0?this.workbookStore.isNameAvailable(e):(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.isNameAvailable(e))!==null&&n!==void 0?n:!0}namedExpressionInAddress(e){const t=this.addressCache.get(e);if(t&&t.added)return t}namedExpressionForScope(e,t){var r;return t===void 0?this.workbookStore.getExisting(e):(r=this.worksheetStore(t))===null||r===void 0?void 0:r.get(e)}nearestNamedExpression(e,t){var r,n;return(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.get(e))!==null&&n!==void 0?n:this.workbookStore.getExisting(e)}isExpressionInScope(e,t){var r,n;return(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.has(e))!==null&&n!==void 0?n:!1}isNameValid(e){const t=new RegExp(`^${Uu}$`),r=new RegExp(`^${bu}$`),n=new RegExp(`^${xu}$`);return t.test(e)||r.test(e)?!1:n.test(e)}addNamedExpression(e,t,r){const n=t===void 0?this.workbookStore:this.worksheetStoreOrCreate(t);let i=n.get(e);return i!==void 0?(i.added=!0,i.displayName=e,i.options=r):(i=new Ds(e,this.nextAddress(),!0,r),n.add(i)),this.addressCache.set(i.address.row,i),i}restoreNamedExpression(e,t){const r=t===void 0?this.workbookStore:this.worksheetStoreOrCreate(t);return e.added=!0,r.add(e),this.addressCache.set(e.address.row,e),e}namedExpressionOrPlaceholder(e,t){var r;return(r=this.worksheetStoreOrCreate(t).get(e))!==null&&r!==void 0?r:this.workbookNamedExpressionOrPlaceholder(e)}workbookNamedExpressionOrPlaceholder(e){let t=this.workbookStore.get(e);return t===void 0&&(t=new Ds(e,this.nextAddress(),!1),this.workbookStore.add(t)),t}remove(e,t){let r;t===void 0?r=this.workbookStore:r=this.worksheetStore(t);const n=r?.get(e);if(r===void 0||n===void 0||!n.added)throw Error("Named expression does not exist");r.remove(e),r instanceof qo&&r.mapping.size===0&&this.worksheetStores.delete(t),this.addressCache.delete(n.address.row)}getAllNamedExpressionsNamesInScope(e){return this.getAllNamedExpressions().filter(({scope:t})=>t===e).map(t=>t.expression.displayName)}getAllNamedExpressionsNames(){return this.getAllNamedExpressions().map(e=>e.expression.displayName)}getAllNamedExpressions(){const e=[];return this.workbookStore.getAllNamedExpressions().forEach(t=>{e.push({expression:t,scope:void 0})}),this.worksheetStores.forEach((t,r)=>{t.getAllNamedExpressions().forEach(n=>{e.push({expression:n,scope:r})})}),e}getAllNamedExpressionsForScope(e){var t,r;return e===void 0?this.workbookStore.getAllNamedExpressions():(r=(t=this.worksheetStores.get(e))===null||t===void 0?void 0:t.getAllNamedExpressions())!==null&&r!==void 0?r:[]}worksheetStoreOrCreate(e){let t=this.worksheetStores.get(e);return t||(t=new qo,this.worksheetStores.set(e,t)),t}worksheetStore(e){return this.worksheetStores.get(e)}nextAddress(){return M(vr.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}}vr.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;const Zt=s=>{switch(s.type){case g.EMPTY:case g.NUMBER:case g.STRING:case g.ERROR:case g.ERROR_WITH_RAW_INPUT:return!1;case g.CELL_REFERENCE:return!s.reference.isAbsolute();case g.CELL_RANGE:case g.COLUMN_RANGE:case g.ROW_RANGE:return!s.start.isAbsolute();case g.NAMED_EXPRESSION:return!1;case g.PERCENT_OP:case g.PLUS_UNARY_OP:case g.MINUS_UNARY_OP:return Zt(s.value);case g.CONCATENATE_OP:case g.EQUALS_OP:case g.NOT_EQUAL_OP:case g.LESS_THAN_OP:case g.GREATER_THAN_OP:case g.LESS_THAN_OR_EQUAL_OP:case g.GREATER_THAN_OR_EQUAL_OP:case g.MINUS_OP:case g.PLUS_OP:case g.TIMES_OP:case g.DIV_OP:case g.POWER_OP:return Zt(s.left)||Zt(s.right);case g.PARENTHESIS:return Zt(s.expression);case g.FUNCTION_CALL:return s.args.some(e=>Zt(e));case g.ARRAY:return s.args.some(e=>e.some(t=>Zt(t)))}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class lr{performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[n,i]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService)),a=t.rememberNewAst(n);r.setFormula(a),r.setAddress(i)}}transformSingleAst(e,t){const r=this.transformAst(e,t),n=this.fixNodeAddress(t);return[r,n]}transformAst(e,t){switch(e.type){case g.CELL_REFERENCE:return this.transformCellReferenceAst(e,t);case g.CELL_RANGE:return this.transformCellRangeAst(e,t);case g.COLUMN_RANGE:return this.transformColumnRangeAst(e,t);case g.ROW_RANGE:return this.transformRowRangeAst(e,t);case g.EMPTY:case g.ERROR:case g.NUMBER:case g.NAMED_EXPRESSION:case g.ERROR_WITH_RAW_INPUT:case g.STRING:return e;case g.PERCENT_OP:case g.MINUS_UNARY_OP:case g.PLUS_UNARY_OP:return Object.assign(Object.assign({},e),{value:this.transformAst(e.value,t)});case g.FUNCTION_CALL:return Object.assign(Object.assign({},e),{procedureName:e.procedureName,args:e.args.map(r=>this.transformAst(r,t))});case g.PARENTHESIS:return Object.assign(Object.assign({},e),{expression:this.transformAst(e.expression,t)});case g.ARRAY:return Object.assign(Object.assign({},e),{args:e.args.map(r=>r.map(n=>this.transformAst(n,t)))});default:return Object.assign(Object.assign({},e),{left:this.transformAst(e.left,t),right:this.transformAst(e.right,t)})}}transformCellReferenceAst(e,t){const r=this.transformCellAddress(e.reference,t);return r instanceof Z?Object.assign(Object.assign({},e),{reference:r}):r===m.REF?_t(new p(m.REF)):e}transformCellRangeAst(e,t){const r=this.transformCellRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===m.REF?_t(new p(m.REF)):e}transformColumnRangeAst(e,t){const r=this.transformColumnRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===m.REF?_t(new p(m.REF)):e}transformRowRangeAst(e,t){const r=this.transformRowRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===m.REF?_t(new p(m.REF)):e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class fR extends lr{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!1}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=yt(e,t);if(r!==this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet)return!1;const n=e.toSimpleColumnAddress(t);return r===this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet?this.columnsSpan.columnStart<=n.col?e.shiftedByColumns(this.columnsSpan.numberOfColumns):!1:t.sheet===this.columnsSpan.sheet&&r!==this.columnsSpan.sheet?e.isColumnAbsolute()||t.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(-this.columnsSpan.numberOfColumns):e.isColumnAbsolute()?e.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(this.columnsSpan.numberOfColumns):e.toSimpleColumnAddress(t).col<this.columnsSpan.columnStart?t.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(-this.columnsSpan.numberOfColumns):t.col<this.columnsSpan.columnStart?e.shiftedByColumns(this.columnsSpan.numberOfColumns):!1}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col+this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n===m.REF||i===m.REF?m.REF:n||i?[n||e,i||t]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ea extends lr{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!1}transformColumnRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}transformCellAddress(e,t){const r=yt(e,t);if(r!==this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet)return!1;const n=e.toSimpleRowAddress(t);return r===this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet?this.rowsSpan.rowStart<=n.row?e.shiftedByRows(this.rowsSpan.numberOfRows):!1:t.sheet===this.rowsSpan.sheet&&r!==this.rowsSpan.sheet?e.isRowAbsolute()||t.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(-this.rowsSpan.numberOfRows):e.isRowAbsolute()?e.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(this.rowsSpan.numberOfRows):n.row<this.rowsSpan.rowStart?t.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(-this.rowsSpan.numberOfRows):t.row<this.rowsSpan.rowStart?e.shiftedByRows(this.rowsSpan.numberOfRows):!1}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row+this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n===m.REF||i===m.REF?m.REF:n||i?[n||e,i||t]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mR extends lr{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return e.isInvalid(t)?m.REF:!1}transformCellRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?m.REF:!1}transformColumnRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?m.REF:!1}transformRowRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?m.REF:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class gR extends lr{constructor(e,t,r,n){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=n,this.dependentFormulaTransformer=new ER(e,t,r,n)}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}transformSingleAst(e,t){return this.sourceRange.addressInRange(t)?[this.transformAst(e,t),this.fixNodeAddress(t)]:this.dependentFormulaTransformer.transformSingleAst(e,t)}fixNodeAddress(e){return M(this.toSheet,e.col+this.toRight,e.row+this.toBottom)}transformCellAddress(e,t){return this.transformAddress(e,t)}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformAddress(e,t){const r=this.sourceRange;if(e instanceof Z){const n=e.toSimpleCellAddress(t);if(r.addressInRange(n))return e.shiftAbsoluteDimensions(this.toRight,this.toBottom)}return e.shiftRelativeDimensions(-this.toRight,-this.toBottom)}transformRange(e,t,r){const n=this.sourceRange;if(e instanceof Z&&t instanceof Z){const i=e.toSimpleCellAddress(r),a=t.toSimpleCellAddress(r);if(n.addressInRange(i)&&n.addressInRange(a))return[e.shiftAbsoluteDimensions(this.toRight,this.toBottom),t.shiftAbsoluteDimensions(this.toRight,this.toBottom)]}return[e.shiftRelativeDimensions(-this.toRight,-this.toBottom),t.shiftRelativeDimensions(-this.toRight,-this.toBottom)]}}class ER extends lr{constructor(e,t,r,n){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=n}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.shouldMove(e,t)?e.moved(this.toSheet,this.toRight,this.toBottom):!1}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}shouldMove(e,t){return e instanceof Z?this.sourceRange.addressInRange(e.toSimpleCellAddress(t)):e instanceof Ue?this.sourceRange.rowInRange(e.toSimpleRowAddress(t))&&!this.sourceRange.isFinite():this.sourceRange.columnInRange(e.toSimpleColumnAddress(t))&&!this.sourceRange.isFinite()}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n&&i?[n,i]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class RR extends lr{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!0}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=yt(e,t);if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet!==r)return!1;if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet===r){const n=e.toSimpleColumnAddress(t);if(n.col<this.columnsSpan.columnStart)return!1;if(n.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet!==r){if(e.isColumnAbsolute())return!1;if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet===r)if(e.isColumnAbsolute()){if(e.col<this.columnsSpan.columnStart)return!1;if(e.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}else{const n=e.toSimpleColumnAddress(t);if(n.col<this.columnsSpan.columnStart){if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}else if(n.col>this.columnsSpan.columnEnd){if(t.col<this.columnsSpan.columnStart)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns);if(t.col>this.columnsSpan.columnEnd)return!1}}return m.REF}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col-this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const n=yt(e,r);let i=e,a=t;if(this.columnsSpan.sheet===n){const l=e.toSimpleColumnAddress(r),c=t.toSimpleColumnAddress(r);if(this.columnsSpan.columnStart<=l.col&&this.columnsSpan.columnEnd>=c.col)return m.REF;l.col>=this.columnsSpan.columnStart&&l.col<=this.columnsSpan.columnEnd&&(i=e.shiftedByColumns(this.columnsSpan.columnEnd-l.col+1)),c.col>=this.columnsSpan.columnStart&&c.col<=this.columnsSpan.columnEnd&&(a=t.shiftedByColumns(-(c.col-this.columnsSpan.columnStart+1)))}const o=this.transformCellAddress(i,r),u=this.transformCellAddress(a,r);if(o===!1&&u===!1)return[i,a];if(o===m.REF||u===m.REF)throw Error("Cannot happen");return[o||i,u||a]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ta extends lr{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!0}transformColumnRangeAst(e,t){return e}transformCellAddress(e,t){const r=yt(e,t);if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet!==r)return!1;if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet===r){const n=e.toSimpleRowAddress(t);if(n.row<this.rowsSpan.rowStart)return!1;if(n.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet!==r){if(e.isRowAbsolute())return!1;if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet===r)if(e.isRowAbsolute()){if(e.row<this.rowsSpan.rowStart)return!1;if(e.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}else{const n=e.toSimpleRowAddress(t);if(n.row<this.rowsSpan.rowStart){if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}else if(n.row>this.rowsSpan.rowEnd){if(t.row<this.rowsSpan.rowStart)return e.shiftedByRows(-this.rowsSpan.numberOfRows);if(t.row>this.rowsSpan.rowEnd)return!1}}return m.REF}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row-this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const n=yt(e,r);let i=e,a=t;if(this.rowsSpan.sheet===n){const l=e.toSimpleRowAddress(r),c=t.toSimpleRowAddress(r);if(this.rowsSpan.rowStart<=l.row&&this.rowsSpan.rowEnd>=c.row)return m.REF;l.row>=this.rowsSpan.rowStart&&l.row<=this.rowsSpan.rowEnd&&(i=e.shiftedByRows(this.rowsSpan.rowEnd-l.row+1)),c.row>=this.rowsSpan.rowStart&&c.row<=this.rowsSpan.rowEnd&&(a=t.shiftedByRows(-(c.row-this.rowsSpan.rowStart+1)))}const o=this.transformCellAddress(i,r),u=this.transformCellAddress(a,r);return o===!1&&u===!1?[i,a]:o===m.REF||u===m.REF?m.REF:[o||i,u||a]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class TR extends lr{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[n]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService));r.setFormula(n)}}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.transformAddress(e)}transformCellRange(e,t,r){return this.transformAddress(e)}transformColumnRange(e,t,r){return this.transformAddress(e)}transformRowRange(e,t,r){return this.transformAddress(e)}transformAddress(e){return e.sheet===this.sheet?m.REF:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Rl(s){if(!Array.isArray(s))throw new Re("an array of arrays.");for(let e=0;e<s.length;e++)if(!Array.isArray(s[e]))throw new Re("an array of arrays.")}function Bs(s){let e=0,t=0,r=0;for(let i=0;i<s.length;i++){let a=0;for(let o=0;o<s[i].length;o++){const u=s[i][o];u!=null&&(a=o+1,++r)}e=Math.max(e,a),a>0&&(t=i+1)}const n=e*t;return{height:t,width:e,fill:n===0?0:r/n}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Tl{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return ks(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>Xe.fromNumberOfRows(this.sheet,e[0],e[1]))}}class Nl{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return Gs(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>Xe.fromNumberOfRows(this.sheet,e[0],e[1]))}}class Sl{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return Gs(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>et.fromNumberOfColumns(this.sheet,e[0],e[1]))}}class Al{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return ks(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>et.fromNumberOfColumns(this.sheet,e[0],e[1]))}}class NR{constructor(e,t,r,n,i,a,o,u,l){this.dependencyGraph=t,this.columnSearch=r,this.cellContentParser=n,this.parser=i,this.stats=a,this.lazilyTransformingAstService=o,this.namedExpressions=u,this.arraySizePredictor=l,this.changes=nr.empty(),this.allocateNamedExpressionAddressSpace(),this.maxColumns=e.maxColumns,this.maxRows=e.maxRows}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}removeRows(e){const t=[];for(const r of e.rowsSpans()){const n=this.doRemoveRows(r);n&&t.push(n)}return t}addRows(e){for(const t of e.rowsSpans())this.doAddRows(t)}addColumns(e){for(const t of e.columnsSpans())this.doAddColumns(t)}removeColumns(e){const t=[];for(const r of e.columnsSpans()){const n=this.doRemoveColumns(r);n&&t.push(n)}return t}removeSheet(e){this.dependencyGraph.removeSheet(e);let t=0;this.stats.measure(x.TRANSFORM_ASTS,()=>{const n=new TR(e);n.performEagerTransformations(this.dependencyGraph,this.parser),t=this.lazilyTransformingAstService.addTransformation(n)}),this.sheetMapping.removeSheet(e),this.columnSearch.removeSheet(e);const r=this.namedExpressions.getAllNamedExpressionsForScope(e).map(n=>this.removeNamedExpression(n.normalizeExpressionName(),e));return{version:t,scopedNamedExpressions:r}}removeSheetByName(e){const t=this.sheetMapping.fetch(e);return this.removeSheet(t)}clearSheet(e){this.dependencyGraph.clearSheet(e),this.columnSearch.removeSheet(e)}addSheet(e){const t=this.sheetMapping.addSheet(e),r=[];return this.dependencyGraph.addressMapping.autoAddSheet(t,Bs(r)),this.sheetMapping.fetchDisplayName(t)}renameSheet(e,t){return this.sheetMapping.renameSheet(e,t)}moveRows(e,t,r,n){const i=Xe.fromNumberOfRows(e,n,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddRows(i),n<t&&(t+=r);const a=M(e,0,t),o=M(e,0,n);this.moveCells(a,Number.POSITIVE_INFINITY,r,o);const u=Xe.fromNumberOfRows(e,t,r);return this.doRemoveRows(u),this.lazilyTransformingAstService.commitCombinedMode()}moveColumns(e,t,r,n){const i=et.fromNumberOfColumns(e,n,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddColumns(i),n<t&&(t+=r);const a=M(e,t,0),o=M(e,n,0);this.moveCells(a,r,Number.POSITIVE_INFINITY,o);const u=et.fromNumberOfColumns(e,t,r);return this.doRemoveColumns(u),this.lazilyTransformingAstService.commitCombinedMode()}moveCells(e,t,r,n){this.ensureItIsPossibleToMoveCells(e,t,r,n);const i=F.spanFrom(e,t,r),a=F.spanFrom(n,t,r),o=n.col-e.col,u=n.row-e.row,l=n.sheet,c=this.getRangeClipboardCells(a),d=this.dependencyGraph.rawValuesFromRange(a);this.columnSearch.removeValues(d);const f=this.dependencyGraph.rawValuesFromRange(i);this.columnSearch.moveValues(f,o,u,l);let E=0;this.stats.measure(x.TRANSFORM_ASTS,()=>{const R=new gR(i,o,u,l);R.performEagerTransformations(this.dependencyGraph,this.parser),E=this.lazilyTransformingAstService.addTransformation(R)}),this.dependencyGraph.moveCells(i,o,u,l);const N=this.updateNamedExpressionsForMovedCells(e,t,r,n);return{version:E,overwrittenCellsData:c,addedGlobalNamedExpressions:N}}setRowOrder(e,t){const r=[];let n=[];for(const[i,a]of t)if(i!==a){const o=F.spanFrom({sheet:e,col:0,row:i},1/0,1),u=this.getRangeClipboardCells(o);n=n.concat(u),r.push(u.map(([{sheet:l,col:c},d])=>[{sheet:l,col:c,row:a},d]))}return r.forEach(i=>this.restoreClipboardCells(e,i.values())),n}setColumnOrder(e,t){const r=[];let n=[];for(const[i,a]of t)if(i!==a){const o=F.spanFrom({sheet:e,col:i,row:0},1,1/0),u=this.getRangeClipboardCells(o);n=n.concat(u),r.push(u.map(([{sheet:l,col:c,row:d},f])=>[{sheet:l,col:a,row:d},f]))}return r.forEach(i=>this.restoreClipboardCells(e,i.values())),n}addNamedExpression(e,t,r,n){const i=this.namedExpressions.addNamedExpression(e,r,n);this.storeNamedExpressionInCell(i.address,t),this.adjustNamedExpressionEdges(i,e,r)}restoreNamedExpression(e,t,r){const n=e.displayName;this.restoreCell(e.address,t);const i=this.namedExpressions.restoreNamedExpression(e,r);this.adjustNamedExpressionEdges(i,n,r)}changeNamedExpressionExpression(e,t,r,n){const i=this.namedExpressions.namedExpressionForScope(e,r);if(!i)throw new In(e);const a=i.copy();i.options=n;const o=this.getClipboardCell(i.address);return this.storeNamedExpressionInCell(i.address,t),[a,o]}removeNamedExpression(e,t){const r=this.namedExpressions.namedExpressionForScope(e,t);if(!r)throw new In(e);this.namedExpressions.remove(r.displayName,t);const n=this.getClipboardCell(r.address);if(t!==void 0){const i=this.namedExpressions.workbookNamedExpressionOrPlaceholder(e);this.dependencyGraph.exchangeNode(r.address,i.address)}else this.dependencyGraph.setCellEmpty(r.address);return[r,n]}ensureItIsPossibleToMoveCells(e,t,r,n){if(ze(e)||!(Hs(t)&&Hs(r)||SR(e,t,r))||ze(n)||!this.sheetMapping.hasSheetWithId(e.sheet)||!this.sheetMapping.hasSheetWithId(n.sheet))throw new Re("a valid range of cells to move.");const i=F.spanFrom(e,t,r),a=F.spanFrom(n,t,r);if(a.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new Nr;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new Hr;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(a))throw new Us}restoreClipboardCells(e,t){const r=[];for(const[n,i]of t)if(this.restoreCell(n,i),i.type===Me.FORMULA){const{dependencies:a}=this.parser.fetchCachedResult(i.hash);r.push(...this.updateNamedExpressionsForTargetAddress(e,n,a))}return r}restoreCell(e,t){switch(t.type){case Me.VALUE:{this.setValueToCell(t,e);break}case Me.FORMULA:{this.setFormulaToCellFromCache(t.hash,e);break}case Me.EMPTY:{this.setCellEmpty(e);break}case Me.PARSING_ERROR:{this.setParsingErrorToCell(t.rawInput,t.errors,e);break}}}getOldContent(e){const t=this.dependencyGraph.getCell(e);if(t===void 0||t instanceof er)return[e,{type:Me.EMPTY}];if(t instanceof sr)return[e,Object.assign({type:Me.VALUE},t.getValues())];if(t instanceof tt)return[t.getAddress(this.lazilyTransformingAstService),{type:Me.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))}];if(t instanceof Xr)return[e,{type:Me.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}];throw Error("Trying to copy unsupported type")}getClipboardCell(e){const t=this.dependencyGraph.getCell(e);if(t===void 0||t instanceof er)return{type:Me.EMPTY};if(t instanceof sr)return Object.assign({type:Me.VALUE},t.getValues());if(t instanceof fe){const r=t.getArrayCellValue(e);return r===B?{type:Me.EMPTY}:{type:Me.VALUE,parsedValue:r,rawValue:t.getArrayCellRawValue(e)}}else{if(t instanceof Ft)return{type:Me.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))};if(t instanceof Xr)return{type:Me.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}}throw Error("Trying to copy unsupported type")}getSheetClipboardCells(e){const t=this.dependencyGraph.getSheetHeight(e),r=this.dependencyGraph.getSheetWidth(e),n=new Array(t);for(let i=0;i<t;i++){n[i]=new Array(r);for(let a=0;a<r;a++){const o=M(e,a,i);n[i][a]=this.getClipboardCell(o)}}return n}getRangeClipboardCells(e){const t=[];for(const r of e.addresses(this.dependencyGraph))t.push([r,this.getClipboardCell(r)]);return t}setCellContent(e,t){const r=this.cellContentParser.parse(t),n=this.getOldContent(e);if(r instanceof se.Formula){const i=this.parser.parse(r.formula,e),{ast:a,errors:o}=i;if(o.length>0)this.setParsingErrorToCell(r.formula,o,e);else try{const u=this.arraySizePredictor.checkArraySize(a,e);if(u.width<=0||u.height<=0)throw Error("Incorrect array size");this.setFormulaToCell(e,u,i)}catch(u){if(!u.message)throw u;const l={type:ce.InvalidRangeSize,message:"Invalid range size."};this.setParsingErrorToCell(r.formula,[l],e)}}else r instanceof se.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e);return n}setSheetContent(e,t){this.clearSheet(e);for(let r=0;r<t.length;r++)for(let n=0;n<t[r].length;n++){const i=M(e,n,r);this.setCellContent(i,t[r][n])}}setParsingErrorToCell(e,t,r){const n=this.dependencyGraph.getCellValue(r),i=new Xr(t,e),a=this.dependencyGraph.setParsingErrorToCell(r,i);this.columnSearch.remove(I(n),r),this.columnSearch.applyChanges(a.getChanges()),this.changes.addAll(a),this.changes.addChange(i.getCellValue(),r)}setFormulaToCell(e,t,{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}){const o=this.dependencyGraph.getCellValue(e),u=this.dependencyGraph.setFormulaToCell(e,r,Lt(a,e),t,n,i);this.columnSearch.remove(I(o),e),this.columnSearch.applyChanges(u.getChanges()),this.changes.addAll(u)}setValueToCell(e,t){const r=this.dependencyGraph.getCellValue(t),n=this.dependencyGraph.setValueToCell(t,e);this.columnSearch.change(I(r),I(e.parsedValue),t),this.columnSearch.applyChanges(n.getChanges().filter(i=>!Mn(i.address,t))),this.changes.addAll(n),this.changes.addChange(e.parsedValue,t)}setCellEmpty(e){if(this.dependencyGraph.isArrayInternalCell(e))return;const t=this.dependencyGraph.getCellValue(e),r=this.dependencyGraph.setCellEmpty(e);this.columnSearch.remove(I(t),e),this.columnSearch.applyChanges(r.getChanges()),this.changes.addAll(r),this.changes.addChange(B,e)}setFormulaToCellFromCache(e,t){const{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}=this.parser.fetchCachedResult(e),o=Lt(a,t),[u]=new mR(t.sheet).transformSingleAst(r,t);this.parser.rememberNewAst(u);const l=$g(o),c=this.arraySizePredictor.checkArraySize(r,t);this.dependencyGraph.setFormulaToCell(t,u,l,c,n,i)}rowEffectivelyNotInSheet(e,t){const r=this.dependencyGraph.addressMapping.getHeight(t);return e>=r}getAndClearContentChanges(){const e=this.changes;return this.changes=nr.empty(),e}forceApplyPostponedTransformations(){this.dependencyGraph.forceApplyPostponedTransformations()}doRemoveRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const t=[];for(const[a]of this.dependencyGraph.entriesFromRowsSpan(e))t.push({address:a,cellType:this.getClipboardCell(a)});const{affectedArrays:r,contentChanges:n}=this.dependencyGraph.removeRows(e);this.columnSearch.applyChanges(n.getChanges());let i=0;return this.stats.measure(x.TRANSFORM_ASTS,()=>{const a=new ta(e);a.performEagerTransformations(this.dependencyGraph,this.parser),i=this.lazilyTransformingAstService.addTransformation(a)}),this.rewriteAffectedArrays(r),{version:i,removedCells:t,rowFrom:e.rowStart,rowCount:e.numberOfRows}}doRemoveColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const t=[];for(const[a]of this.dependencyGraph.entriesFromColumnsSpan(e))t.push({address:a,cellType:this.getClipboardCell(a)});const{affectedArrays:r,contentChanges:n}=this.dependencyGraph.removeColumns(e);this.columnSearch.applyChanges(n.getChanges()),this.columnSearch.removeColumns(e);let i=0;return this.stats.measure(x.TRANSFORM_ASTS,()=>{const a=new RR(e);a.performEagerTransformations(this.dependencyGraph,this.parser),i=this.lazilyTransformingAstService.addTransformation(a)}),this.rewriteAffectedArrays(r),{version:i,removedCells:t,columnFrom:e.columnStart,columnCount:e.numberOfColumns}}doAddRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const{affectedArrays:t}=this.dependencyGraph.addRows(e);this.stats.measure(x.TRANSFORM_ASTS,()=>{const r=new ea(e);r.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(r)}),this.rewriteAffectedArrays(t)}rewriteAffectedArrays(e){for(const t of e.values()){if(t.array.size.isRef)continue;const r=t.getFormula(this.lazilyTransformingAstService),n=t.getAddress(this.lazilyTransformingAstService),i=this.parser.computeHashFromAst(r);this.setFormulaToCellFromCache(i,n)}}doAddColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const{affectedArrays:t,contentChanges:r}=this.dependencyGraph.addColumns(e);this.columnSearch.addColumns(e),this.columnSearch.applyChanges(r.getChanges()),this.stats.measure(x.TRANSFORM_ASTS,()=>{const n=new fR(e);n.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(n)}),this.rewriteAffectedArrays(t)}columnEffectivelyNotInSheet(e,t){const r=this.dependencyGraph.addressMapping.getWidth(t);return e>=r}adjustNamedExpressionEdges(e,t,r){if(r===void 0)return;const{vertex:n,id:i}=this.dependencyGraph.fetchCellOrCreateEmpty(e.address),a=i??this.dependencyGraph.graph.getNodeId(n),o=this.namedExpressions.workbookNamedExpressionOrPlaceholder(t),{vertex:u,id:l}=this.dependencyGraph.fetchCellOrCreateEmpty(o.address),c=l??this.dependencyGraph.graph.getNodeId(u);for(const d of this.dependencyGraph.graph.adjacentNodes(u))if(d instanceof Ft&&d.getAddress(this.lazilyTransformingAstService).sheet===r){const f=d.getFormula(this.lazilyTransformingAstService),E=d.getAddress(this.lazilyTransformingAstService),{dependencies:N}=this.parser.fetchCachedResultForAst(f);for(const R of Lt(N,E))R instanceof Wt&&R.name.toLowerCase()===e.displayName.toLowerCase()&&(this.dependencyGraph.graph.removeEdgeIfExists(c,d),this.dependencyGraph.graph.addEdge(a,d))}}storeNamedExpressionInCell(e,t){const r=this.cellContentParser.parse(t);if(r instanceof se.Formula){const n=this.parser.parse(r.formula,M(-1,0,0));if(Zt(n.ast))throw new xa;const{ast:i,hasVolatileFunction:a,hasStructuralChangeFunction:o,dependencies:u}=n;this.dependencyGraph.setFormulaToCell(e,i,Lt(u,e),V.scalar(),a,o)}else r instanceof se.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e)}updateNamedExpressionsForMovedCells(e,t,r,n){if(e.sheet===n.sheet)return[];const i=[],a=F.spanFrom(n,t,r);for(const o of a.addresses(this.dependencyGraph)){const u=this.addressMapping.fetchCell(o);if(u instanceof Ft&&o.sheet!==e.sheet){const l=u.getFormula(this.lazilyTransformingAstService),{dependencies:c}=this.parser.fetchCachedResultForAst(l);i.push(...this.updateNamedExpressionsForTargetAddress(e.sheet,o,c))}}return i}updateNamedExpressionsForTargetAddress(e,t,r){if(e===t.sheet)return[];const n=[],i=this.addressMapping.fetchCell(t);for(const a of Lt(r,t)){if(!(a instanceof Wt))continue;const o=a.name,u=this.dependencyGraph.fetchNamedExpressionVertex(o,e).vertex,c=this.namedExpressions.isExpressionInScope(o,t.sheet)?this.dependencyGraph.fetchNamedExpressionVertex(o,t.sheet).vertex:this.copyOrFetchGlobalNamedExpressionVertex(o,u,n);c!==u&&(this.dependencyGraph.graph.removeEdgeIfExists(u,i),this.dependencyGraph.graph.addEdge(c,i))}return n}allocateNamedExpressionAddressSpace(){this.dependencyGraph.addressMapping.addSheet(vr.SHEET_FOR_WORKBOOK_EXPRESSIONS,new pE(0,0))}copyOrFetchGlobalNamedExpressionVertex(e,t,r){let n=this.namedExpressions.namedExpressionForScope(e);if(n===void 0)if(n=this.namedExpressions.addNamedExpression(e),r.push(n.normalizeExpressionName()),t instanceof Ft){const i=this.parser.fetchCachedResultForAst(t.getFormula(this.lazilyTransformingAstService)),{ast:a,hasVolatileFunction:o,hasStructuralChangeFunction:u,dependencies:l}=i;this.dependencyGraph.setFormulaToCell(n.address,a,Lt(l,n.address),V.scalar(),o,u)}else t instanceof er?this.setCellEmpty(n.address):t instanceof sr&&this.setValueToCell(t.getValues(),n.address);return this.dependencyGraph.fetchCellOrCreateEmpty(n.address).vertex}}function ks(s){if(s.length<=1)return s;const e=[...s].sort(([n],[i])=>n-i),t=e.reduce((n,[i,a])=>{const o=n[n.length-1],u=o[0]+o[1];return i<=u?o[1]+=Math.max(0,a-(u-i)):n.push([i,a]),n},[e[0]]);let r=0;for(let n=0;n<t.length;++n)t[n][0]-=r,r+=t[n][1];return t}function Gs(s){if(s.length<=1)return s;const e=[...s].sort(([n],[i])=>n-i),t=e.reduce((n,[i,a])=>{const o=n[n.length-1];return i===o[0]?o[1]=Math.max(o[1],a):n.push([i,a]),n},[e[0]]);let r=0;for(let n=0;n<t.length;++n)t[n][0]+=r,r+=t[n][1];return t}function Hs(s){return Number.isInteger(s)&&s>0}function SR(s,e,t){return s.row===0&&Hs(e)&&t===Number.POSITIVE_INFINITY||s.col===0&&Hs(t)&&e===Number.POSITIVE_INFINITY}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Te{}class AR extends Te{constructor(e,t){super(),this.command=e,this.rowsRemovals=t}doUndo(e){e.undoRemoveRows(this)}doRedo(e){e.redoRemoveRows(this)}}class yR extends Te{constructor(e,t,r,n,i,a,o){super(),this.sourceLeftCorner=e,this.width=t,this.height=r,this.destinationLeftCorner=n,this.overwrittenCellsData=i,this.addedGlobalNamedExpressions=a,this.version=o}doUndo(e){e.undoMoveCells(this)}doRedo(e){e.redoMoveCells(this)}}class CR extends Te{constructor(e){super(),this.command=e}doUndo(e){e.undoAddRows(this)}doRedo(e){e.redoAddRows(this)}}class vR extends Te{constructor(e,t,r){super(),this.sheetId=e,this.rowMapping=t,this.oldContent=r}doUndo(e){e.undoSetRowOrder(this)}doRedo(e){e.redoSetRowOrder(this)}}class IR extends Te{constructor(e,t,r){super(),this.sheetId=e,this.columnMapping=t,this.oldContent=r}doUndo(e){e.undoSetColumnOrder(this)}doRedo(e){e.redoSetColumnOrder(this)}}class OR extends Te{constructor(e,t,r){super(),this.sheetId=e,this.oldSheetContent=t,this.newSheetContent=r}doUndo(e){e.undoSetSheetContent(this)}doRedo(e){e.redoSetSheetContent(this)}}class MR extends Te{constructor(e,t,r,n,i){super(),this.sheet=e,this.startRow=t,this.numberOfRows=r,this.targetRow=n,this.version=i,this.undoStart=this.startRow<this.targetRow?this.targetRow-this.numberOfRows:this.targetRow,this.undoEnd=this.startRow>this.targetRow?this.startRow+this.numberOfRows:this.startRow}doUndo(e){e.undoMoveRows(this)}doRedo(e){e.redoMoveRows(this)}}class wR extends Te{constructor(e,t,r,n,i){super(),this.sheet=e,this.startColumn=t,this.numberOfColumns=r,this.targetColumn=n,this.version=i,this.undoStart=this.startColumn<this.targetColumn?this.targetColumn-this.numberOfColumns:this.targetColumn,this.undoEnd=this.startColumn>this.targetColumn?this.startColumn+this.numberOfColumns:this.startColumn}doUndo(e){e.undoMoveColumns(this)}doRedo(e){e.redoMoveColumns(this)}}class _R extends Te{constructor(e){super(),this.command=e}doUndo(e){e.undoAddColumns(this)}doRedo(e){e.redoAddColumns(this)}}class LR extends Te{constructor(e,t){super(),this.command=e,this.columnsRemovals=t}doUndo(e){e.undoRemoveColumns(this)}doRedo(e){e.redoRemoveColumns(this)}}class FR extends Te{constructor(e){super(),this.sheetName=e}doUndo(e){e.undoAddSheet(this)}doRedo(e){e.redoAddSheet(this)}}class UR extends Te{constructor(e,t,r,n,i){super(),this.sheetName=e,this.sheetId=t,this.oldSheetContent=r,this.scopedNamedExpressions=n,this.version=i}doUndo(e){e.undoRemoveSheet(this)}doRedo(e){e.redoRemoveSheet(this)}}class bR extends Te{constructor(e,t,r){super(),this.sheetId=e,this.oldName=t,this.newName=r}doUndo(e){e.undoRenameSheet(this)}doRedo(e){e.redoRenameSheet(this)}}class xR extends Te{constructor(e,t){super(),this.sheetId=e,this.oldSheetContent=t}doUndo(e){e.undoClearSheet(this)}doRedo(e){e.redoClearSheet(this)}}class PR extends Te{constructor(e){super(),this.cellContents=e}doUndo(e){e.undoSetCellContents(this)}doRedo(e){e.redoSetCellContents(this)}}class VR extends Te{constructor(e,t,r,n){super(),this.targetLeftCorner=e,this.oldContent=t,this.newContent=r,this.addedGlobalNamedExpressions=n}doUndo(e){e.undoPaste(this)}doRedo(e){e.redoPaste(this)}}class DR extends Te{constructor(e,t,r,n){super(),this.name=e,this.newContent=t,this.scope=r,this.options=n}doUndo(e){e.undoAddNamedExpression(this)}doRedo(e){e.redoAddNamedExpression(this)}}class BR extends Te{constructor(e,t,r){super(),this.namedExpression=e,this.content=t,this.scope=r}doUndo(e){e.undoRemoveNamedExpression(this)}doRedo(e){e.redoRemoveNamedExpression(this)}}class kR extends Te{constructor(e,t,r,n,i){super(),this.namedExpression=e,this.newContent=t,this.oldContent=r,this.scope=n,this.options=i}doUndo(e){e.undoChangeNamedExpression(this)}doRedo(e){e.redoChangeNamedExpression(this)}}class GR extends Te{constructor(){super(...arguments),this.operations=[]}add(e){this.operations.push(e)}*reversedOperations(){for(let e=this.operations.length-1;e>=0;e--)yield this.operations[e]}doUndo(e){e.undoBatch(this)}doRedo(e){e.redoBatch(this)}}class HR{constructor(e,t){this.operations=t,this.oldData=new Map,this.undoStack=[],this.redoStack=[],this.undoLimit=e.undoLimit}saveOperation(e){this.batchUndoEntry!==void 0?this.batchUndoEntry.add(e):this.addUndoEntry(e)}beginBatchMode(){this.batchUndoEntry=new GR}commitBatchMode(){if(this.batchUndoEntry===void 0)throw Error("Batch mode wasn't started");this.addUndoEntry(this.batchUndoEntry),this.batchUndoEntry=void 0}storeDataForVersion(e,t,r){this.oldData.has(e)||this.oldData.set(e,[]),this.oldData.get(e).push([t,r])}clearRedoStack(){this.redoStack=[]}clearUndoStack(){this.undoStack=[]}isUndoStackEmpty(){return this.undoStack.length===0}isRedoStackEmpty(){return this.redoStack.length===0}undo(){const e=this.undoStack.pop();if(!e)throw Error("Attempted to undo without operation on stack");this.undoEntry(e),this.redoStack.push(e)}undoBatch(e){for(const t of e.reversedOperations())this.undoEntry(t)}undoRemoveRows(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},rowsRemovals:r}=e;for(let n=r.length-1;n>=0;--n){const i=r[n];this.operations.addRows(new Nl(t,[[i.rowFrom,i.rowCount]]));for(const{address:a,cellType:o}of i.removedCells)this.operations.restoreCell(a,o);this.restoreOldDataFromVersion(i.version-1)}}undoRemoveColumns(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},columnsRemovals:r}=e;for(let n=r.length-1;n>=0;--n){const i=r[n];this.operations.addColumns(new Sl(t,[[i.columnFrom,i.columnCount]]));for(const{address:a,cellType:o}of i.removedCells)this.operations.restoreCell(a,o);this.restoreOldDataFromVersion(i.version-1)}}undoAddRows(e){const t=e.command.rowsSpans();for(let r=t.length-1;r>=0;--r){const n=t[r];this.operations.removeRows(new Tl(e.command.sheet,[[n.rowStart,n.numberOfRows]]))}}undoAddColumns(e){const t=e.command.columnsSpans();for(let r=t.length-1;r>=0;--r){const n=t[r];this.operations.removeColumns(new Al(e.command.sheet,[[n.columnStart,n.numberOfColumns]]))}}undoSetCellContents(e){for(const t of e.cellContents){const r=t.address,[n,i]=t.oldContent;Mn(r,n)||this.operations.setCellEmpty(r),this.operations.restoreCell(n,i)}}undoPaste(e){this.restoreOperationOldContent(e.oldContent);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoMoveRows(e){const{sheet:t}=e;this.operations.moveRows(t,e.undoStart,e.numberOfRows,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveColumns(e){const{sheet:t}=e;this.operations.moveColumns(t,e.undoStart,e.numberOfColumns,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveCells(e){this.operations.forceApplyPostponedTransformations(),this.operations.moveCells(e.destinationLeftCorner,e.width,e.height,e.sourceLeftCorner),this.restoreOperationOldContent(e.overwrittenCellsData),this.restoreOldDataFromVersion(e.version-1);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoAddSheet(e){const{sheetName:t}=e;this.operations.removeSheetByName(t)}undoRemoveSheet(e){this.operations.forceApplyPostponedTransformations();const{oldSheetContent:t,sheetId:r}=e;this.operations.addSheet(e.sheetName);for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=M(r,a,n);this.operations.restoreCell(u,o)}}for(const[n,i]of e.scopedNamedExpressions)this.operations.restoreNamedExpression(n,i,r);this.restoreOldDataFromVersion(e.version-1)}undoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.oldName)}undoClearSheet(e){const{oldSheetContent:t,sheetId:r}=e;for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=M(r,a,n);this.operations.restoreCell(u,o)}}}undoSetSheetContent(e){const{oldSheetContent:t,sheetId:r}=e;this.operations.clearSheet(r);for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=M(r,a,n);this.operations.restoreCell(u,o)}}}undoAddNamedExpression(e){this.operations.removeNamedExpression(e.name,e.scope)}undoRemoveNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.content,e.scope)}undoChangeNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.oldContent,e.scope)}undoSetRowOrder(e){this.restoreOperationOldContent(e.oldContent)}undoSetColumnOrder(e){this.restoreOperationOldContent(e.oldContent)}redo(){const e=this.redoStack.pop();if(!e)throw Error("Attempted to redo without operation on stack");this.redoEntry(e),this.undoStack.push(e)}redoBatch(e){for(const t of e.operations)this.redoEntry(t)}redoRemoveRows(e){this.operations.removeRows(e.command)}redoMoveCells(e){this.operations.moveCells(e.sourceLeftCorner,e.width,e.height,e.destinationLeftCorner)}redoRemoveColumns(e){this.operations.removeColumns(e.command)}redoPaste(e){const{targetLeftCorner:t,newContent:r}=e,n=r.length,i=r[0].length;for(let a=0;a<n;++a)for(let o=0;o<i;++o){const u=M(t.sheet,t.col+o,t.row+a);this.operations.restoreCell(u,r[a][o])}}redoSetCellContents(e){for(const t of e.cellContents)this.operations.setCellContent(t.address,t.newContent)}redoAddRows(e){this.operations.addRows(e.command)}redoAddColumns(e){this.operations.addColumns(e.command)}redoRemoveSheet(e){this.operations.removeSheetByName(e.sheetName)}redoAddSheet(e){this.operations.addSheet(e.sheetName)}redoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.newName)}redoMoveRows(e){this.operations.moveRows(e.sheet,e.startRow,e.numberOfRows,e.targetRow)}redoMoveColumns(e){this.operations.moveColumns(e.sheet,e.startColumn,e.numberOfColumns,e.targetColumn)}redoClearSheet(e){this.operations.clearSheet(e.sheetId)}redoSetSheetContent(e){const{sheetId:t,newSheetContent:r}=e;this.operations.setSheetContent(t,r)}redoAddNamedExpression(e){this.operations.addNamedExpression(e.name,e.newContent,e.scope,e.options)}redoRemoveNamedExpression(e){this.operations.removeNamedExpression(e.namedExpression.displayName,e.scope)}redoChangeNamedExpression(e){this.operations.changeNamedExpressionExpression(e.namedExpression.displayName,e.newContent,e.scope,e.options)}redoSetRowOrder(e){this.operations.setRowOrder(e.sheetId,e.rowMapping)}redoSetColumnOrder(e){this.operations.setColumnOrder(e.sheetId,e.columnMapping)}addUndoEntry(e){this.undoStack.push(e),this.undoStack.splice(0,Math.max(0,this.undoStack.length-this.undoLimit))}undoEntry(e){e.doUndo(this)}restoreOperationOldContent(e){for(const[t,r]of e)this.operations.restoreCell(t,r)}redoEntry(e){e.doRedo(this)}restoreOldDataFromVersion(e){const t=this.oldData.get(e)||[];for(const r of t){const[n,i]=r;this.operations.setFormulaToCellFromCache(i,n)}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class WR{constructor(e,t,r,n,i,a,o,u,l,c){this.operations=t,this.undoRedo=r,this.clipboardOperations=n,this.dependencyGraph=i,this.columnSearch=a,this.parser=o,this.cellContentParser=u,this.lazilyTransformingAstService=l,this.namedExpressions=c,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}get sheetMapping(){return this.dependencyGraph.sheetMapping}addRows(e,...t){const r=new Nl(e,t);this.ensureItIsPossibleToAddRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(r),this.undoRedo.saveOperation(new CR(r))}removeRows(e,...t){const r=new Tl(e,t);this.ensureItIsPossibleToRemoveRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.removeRows(r);this.undoRedo.saveOperation(new AR(r,n))}addColumns(e,...t){const r=new Sl(e,t);this.ensureItIsPossibleToAddColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(r),this.undoRedo.saveOperation(new _R(r))}removeColumns(e,...t){const r=new Al(e,t);this.ensureItIsPossibleToRemoveColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.removeColumns(r);this.undoRedo.saveOperation(new LR(r,n))}moveCells(e,t,r,n){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const{version:i,overwrittenCellsData:a,addedGlobalNamedExpressions:o}=this.operations.moveCells(e,t,r,n);this.undoRedo.saveOperation(new yR(e,t,r,n,a,o,i))}moveRows(e,t,r,n){this.ensureItIsPossibleToMoveRows(e,t,r,n),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const i=this.operations.moveRows(e,t,r,n);this.undoRedo.saveOperation(new MR(e,t,r,n,i))}moveColumns(e,t,r,n){this.ensureItIsPossibleToMoveColumns(e,t,r,n),this.undoRedo.clearRedoStack();const i=this.operations.moveColumns(e,t,r,n);this.undoRedo.saveOperation(new wR(e,t,r,n,i))}cut(e,t,r){this.clipboardOperations.cut(e,t,r)}ensureItIsPossibleToCopy(e,t,r){if(!Fr(t))throw new Re("width to be positive integer.");if(!Fr(r))throw new Re("height to be positive integer.")}copy(e,t,r){this.ensureItIsPossibleToCopy(e,t,r),this.clipboardOperations.copy(e,t,r)}paste(e){const t=this.clipboardOperations.clipboard;if(t===void 0)throw new qh;if(this.clipboardOperations.isCutClipboard())this.moveCells(t.sourceLeftCorner,t.width,t.height,e);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(e);const r=F.spanFrom(e,t.width,t.height),n=this.operations.getRangeClipboardCells(r);this.undoRedo.clearRedoStack();const i=this.operations.restoreClipboardCells(t.sourceLeftCorner.sheet,t.getContent(e));this.undoRedo.saveOperation(new VR(e,n,t.content,i))}}beginUndoRedoBatchMode(){this.undoRedo.beginBatchMode()}commitUndoRedoBatchMode(){this.undoRedo.commitBatchMode()}isClipboardEmpty(){return this.clipboardOperations.clipboard===void 0}clearClipboard(){this.clipboardOperations.clear()}addSheet(e){e!==void 0&&this.ensureItIsPossibleToAddSheet(e),this.undoRedo.clearRedoStack();const t=this.operations.addSheet(e);return this.undoRedo.saveOperation(new FR(t)),t}removeSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.sheetMapping.fetchDisplayName(e),r=this.operations.getSheetClipboardCells(e),{version:n,scopedNamedExpressions:i}=this.operations.removeSheet(e);this.undoRedo.saveOperation(new UR(t,e,r,i,n))}renameSheet(e,t){this.ensureItIsPossibleToRenameSheet(e,t);const r=this.operations.renameSheet(e,t);return r!==void 0&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new bR(e,r,t))),r}clearSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.operations.getSheetClipboardCells(e);this.operations.clearSheet(e),this.undoRedo.saveOperation(new xR(e,t))}setCellContents(e,t){if(!(t instanceof Array))t=[[t]];else for(let n=0;n<t.length;n++)if(!(t[n]instanceof Array))throw new Re("an array of arrays or a raw cell value.");this.ensureItIsPossibleToChangeCellContents(e,t),this.undoRedo.clearRedoStack();const r=[];for(let n=0;n<t.length;n++)for(let i=0;i<t[n].length;i++){const a={sheet:e.sheet,row:e.row+n,col:e.col+i},o=t[n][i];this.clipboardOperations.abortCut();const u=this.operations.setCellContent(a,o);r.push({address:a,newContent:o,oldContent:u})}this.undoRedo.saveOperation(new PR(r))}setSheetContent(e,t){this.ensureScopeIdIsValid(e),this.ensureItIsPossibleToChangeSheetContents(e,t),Rl(t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.getSheetClipboardCells(e);this.operations.setSheetContent(e,t),this.undoRedo.saveOperation(new OR(e,r,t))}setRowOrder(e,t){this.validateSwapRowIndexes(e,t),this.testRowOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setRowOrder(e,t);this.undoRedo.saveOperation(new vR(e,t,r))}validateSwapRowIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new ae(e);this.validateRowOrColumnMapping(e,t,"row")}testColumnOrderForArrays(e,t){for(const[r,n]of t)if(r!==n){const i=F.spanFrom({sheet:e,col:r,row:0},1,1/0);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new Hr}}setColumnOrder(e,t){this.validateSwapColumnIndexes(e,t),this.testColumnOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setColumnOrder(e,t);this.undoRedo.saveOperation(new IR(e,t,r))}validateSwapColumnIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new ae(e);this.validateRowOrColumnMapping(e,t,"column")}testRowOrderForArrays(e,t){for(const[r,n]of t)if(r!==n){const i=F.spanFrom({sheet:e,col:0,row:r},1/0,1);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new Hr}}mappingFromOrder(e,t,r){if(!this.sheetMapping.hasSheetWithId(e))throw new ae(e);const n=r==="row"?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e);if(t.length!==n)throw new Re(`number of ${r}s provided to be sheet ${r==="row"?"height":"width"}.`);const i=[];for(let a=0;a<n;a++)t[a]!==a&&i.push([a,t[a]]);return i}undo(){if(this.undoRedo.isUndoStackEmpty())throw new Kh;this.clipboardOperations.abortCut(),this.undoRedo.undo()}redo(){if(this.undoRedo.isRedoStackEmpty())throw new jh;this.clipboardOperations.abortCut(),this.undoRedo.redo()}addNamedExpression(e,t,r,n){this.ensureItIsPossibleToAddNamedExpression(e,t,r),this.operations.addNamedExpression(e,t,r,n),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new DR(e,t,r,n))}changeNamedExpressionExpression(e,t,r,n){this.ensureItIsPossibleToChangeNamedExpression(e,r,t);const[i,a]=this.operations.changeNamedExpressionExpression(e,r,t,n);this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new kR(i,r,a,t,n))}removeNamedExpression(e,t){this.ensureScopeIdIsValid(t);const[r,n]=this.operations.removeNamedExpression(e,t);return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new BR(r,n,t)),r}ensureItIsPossibleToAddNamedExpression(e,t,r){this.ensureScopeIdIsValid(r),this.ensureNamedExpressionNameIsValid(e,r),this.ensureNamedExpressionIsValid(t)}ensureItIsPossibleToChangeNamedExpression(e,t,r){if(this.ensureScopeIdIsValid(r),this.namedExpressions.namedExpressionForScope(e,r)===void 0)throw new In(e);this.ensureNamedExpressionIsValid(t)}isItPossibleToRemoveNamedExpression(e,t){if(this.ensureScopeIdIsValid(t),this.namedExpressions.namedExpressionForScope(e,t)===void 0)throw new In(e)}ensureItIsPossibleToAddRows(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new ae(e);const r=this.dependencyGraph.getSheetHeight(e),n=t.map(i=>i[1]).reduce((i,a)=>i+a,0);if(r+n>this.maxRows)throw new Nr;for(const[i,a]of t)if(!dr(i)||!Fr(a))throw new Re("row number to be nonnegative and number of rows to add to be positive.")}ensureItIsPossibleToRemoveRows(e,...t){for(const[r,n]of t){const i=r+n-1;if(!dr(r)||!dr(i))throw new Re("starting and ending row to be nonnegative.");if(i<r)throw new Re("starting row to be smaller than the ending row.");if(!this.sheetMapping.hasSheetWithId(e))throw new ae(e)}}ensureItIsPossibleToAddColumns(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new ae(e);const r=this.dependencyGraph.getSheetWidth(e),n=t.map(i=>i[1]).reduce((i,a)=>i+a,0);if(r+n>this.maxColumns)throw new Nr;for(const[i,a]of t)if(!dr(i)||!Fr(a))throw new Re("column number to be nonnegative and number of columns to add to be positive.")}ensureItIsPossibleToRemoveColumns(e,...t){for(const[r,n]of t){const i=r+n-1;if(!dr(r)||!dr(i))throw new Re("starting and ending column to be nonnegative.");if(i<r)throw new Re("starting column to be smaller than the ending column.");if(!this.sheetMapping.hasSheetWithId(e))throw new ae(e)}}ensureItIsPossibleToMoveRows(e,t,r,n){this.ensureItIsPossibleToAddRows(e,[n,r]);const i=M(e,0,t),a=M(e,0,n);if(!this.sheetMapping.hasSheetWithId(e)||ze(i)||ze(a)||!Fr(r)||n<=t+r&&n>=t)throw new Re("a valid range of rows to move.");const o=this.dependencyGraph.getSheetWidth(e),u=F.spanFrom(i,o,r);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(u))throw new Hr;if(n>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllRows(Xe.fromNumberOfRows(e,n-1,2)))throw new Us}ensureItIsPossibleToMoveColumns(e,t,r,n){this.ensureItIsPossibleToAddColumns(e,[n,r]);const i=M(e,t,0),a=M(e,n,0);if(!this.sheetMapping.hasSheetWithId(e)||ze(i)||ze(a)||!Fr(r)||n<=t+r&&n>=t)throw new Re("a valid range of columns to move.");const o=this.dependencyGraph.getSheetHeight(e),u=F.spanFrom(i,r,o);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(u))throw new Hr;if(n>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllColumns(et.fromNumberOfColumns(e,n-1,2)))throw new Us}ensureItIsPossibleToAddSheet(e){if(this.sheetMapping.hasSheetWithName(e))throw new Cn(e)}ensureItIsPossibleToRenameSheet(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new ae(e);const r=this.sheetMapping.get(t);if(r!==void 0&&r!==e)throw new Cn(t)}ensureItIsPossibleToChangeContent(e){if(ze(e))throw new zh(e);if(!this.sheetMapping.hasSheetWithId(e.sheet))throw new ae(e.sheet)}ensureItIsPossibleToChangeCellContents(e,t){const r=Bs(t),n=F.spanFrom(e,r.width,r.height);this.ensureRangeInSizeLimits(n);for(const i of n.addresses(this.dependencyGraph))this.ensureItIsPossibleToChangeContent(i)}ensureItIsPossibleToChangeSheetContents(e,t){const r=Bs(t),n=F.spanFrom(M(e,0,0),r.width,r.height);this.ensureRangeInSizeLimits(n)}ensureRangeInSizeLimits(e){if(e.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new Nr}isThereSomethingToUndo(){return!this.undoRedo.isUndoStackEmpty()}isThereSomethingToRedo(){return!this.undoRedo.isRedoStackEmpty()}getAndClearContentChanges(){return this.operations.getAndClearContentChanges()}ensureScopeIdIsValid(e){if(e!==void 0&&!this.sheetMapping.hasSheetWithId(e))throw new ae(e)}validateRowOrColumnMapping(e,t,r){const n=r==="row"?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e),i=t.map(([o,u])=>o).sort((o,u)=>o-u),a=t.map(([o,u])=>u).sort((o,u)=>o-u);for(let o=0;o<i.length;o++){if(!dr(i[o])||i[o]>=n)throw new Re(`${r} numbers to be nonnegative integers and less than sheet ${r==="row"?"height":"width"}.`);if(i[o]===i[o+1])throw new Re(`source ${r} numbers to be unique.`);if(i[o]!==a[o])throw new Re(`target ${r} numbers to be permutation of source ${r} numbers.`)}}ensureNamedExpressionNameIsValid(e,t){if(!this.namedExpressions.isNameValid(e))throw new $h(e);if(!this.namedExpressions.isNameAvailable(e,t))throw new Xh(e)}ensureNamedExpressionIsValid(e){const t=this.cellContentParser.parse(e);if(t instanceof se.Formula){const r=this.parser.parse(t.formula,M(-1,0,0));if(Zt(r.ast))throw new xa}}}function Fr(s){return Number.isInteger(s)&&s>0}function dr(s){return Number.isInteger(s)&&s>=0}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class YR{constructor(e,t,r,n,i,a){this.config=e,this.stats=t,this.interpreter=r,this.lazilyTransformingAstService=n,this.dependencyGraph=i,this.columnSearch=a}run(){this.stats.start(x.TOP_SORT);const{sorted:e,cycled:t}=this.dependencyGraph.topSortWithScc();this.stats.end(x.TOP_SORT),this.stats.measure(x.EVALUATION,()=>{this.recomputeFormulas(t,e)})}partialRun(e){const t=nr.empty();return this.stats.measure(x.EVALUATION,()=>{this.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(e,r=>{if(r instanceof tt){const n=r.isComputed()?r.getCellValue():void 0,i=this.recomputeFormulaVertexValue(r);if(i!==n){const a=r.getAddress(this.lazilyTransformingAstService);return t.addChange(i,a),this.columnSearch.change(I(n),I(i),a),!0}return!1}else return r instanceof Fe&&r.clearCache(),!0},r=>{if(r instanceof Fe)r.clearCache();else if(r instanceof tt){const n=r.getAddress(this.lazilyTransformingAstService);this.columnSearch.remove(I(r.valueOrUndef()),n);const i=new p(m.CYCLE,void 0,r);r.setCellValue(i),t.addChange(i,n)}})}),t}runAndForget(e,t,r){const n=[];for(const a of Lt(r,t))if(a instanceof F){const o=a;if(this.dependencyGraph.getRange(o.start,o.end)===void 0){const u=new Fe(o);this.dependencyGraph.rangeMapping.setRange(u),n.push(u)}}const i=this.evaluateAstToCellValue(e,new bt(t,this.config.useArrayArithmetic));return n.forEach(a=>{this.dependencyGraph.rangeMapping.removeRange(a)}),i}recomputeFormulas(e,t){e.forEach(r=>{r instanceof tt&&r.setCellValue(new p(m.CYCLE,void 0,r))}),t.forEach(r=>{if(r instanceof tt){const n=this.recomputeFormulaVertexValue(r),i=r.getAddress(this.lazilyTransformingAstService);this.columnSearch.add(I(n),i)}else r instanceof Fe&&r.clearCache()})}recomputeFormulaVertexValue(e){const t=e.getAddress(this.lazilyTransformingAstService);if(e instanceof fe&&(e.array.size.isRef||!this.dependencyGraph.isThereSpaceForArray(e)))return e.setNoSpace();{const r=e.getFormula(this.lazilyTransformingAstService),n=this.evaluateAstToCellValue(r,new bt(t,this.config.useArrayArithmetic,e));return e.setCellValue(n)}}evaluateAstToCellValue(e,t){const r=this.interpreter.evaluateAst(e,t);return r instanceof w?r:r===B&&this.config.evaluateNullToZero?0:r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ra{constructor(e,t){this.address=e,this.newValue=t}get col(){return this.address.col}get row(){return this.address.row}get sheet(){return this.address.sheet}get value(){return this.newValue}}class yl{constructor(e,t){this.name=e,this.newValue=t}}class zR{constructor(e,t,r,n){this.config=e,this.namedExpressions=t,this.sheetIndexMapping=r,this.lazilyTransformingService=n}exportChange(e){const t=e.value,r=e.address;if(r.sheet===vr.SHEET_FOR_WORKBOOK_EXPRESSIONS){const n=this.namedExpressions.namedExpressionInAddress(r.row);if(!n)throw new Error("Missing named expression");return new yl(n.displayName,this.exportScalarOrRange(t))}else if(t instanceof w){const n=[];for(const[i,a]of t.entriesFromTopLeftCorner(r))n.push(new ra(a,this.exportValue(i)));return n}else return new ra(r,this.exportValue(t))}exportValue(e){return e instanceof w?this.detailedError(new p(m.VALUE,T.ScalarExpected)):this.config.smartRounding&&z(e)?this.cellValueRounding(I(e)):e instanceof p?this.detailedError(e):e===B?null:I(e)}exportScalarOrRange(e){return e instanceof w?e.rawData().map(t=>t.map(r=>this.exportValue(r))):this.exportValue(e)}detailedError(e){var t,r;let n;const i=(t=e.root)===null||t===void 0?void 0:t.getAddress(this.lazilyTransformingService);return i!==void 0&&(i.sheet===vr.SHEET_FOR_WORKBOOK_EXPRESSIONS?n=(r=this.namedExpressions.namedExpressionInAddress(i.row))===null||r===void 0?void 0:r.displayName:n=Ns(this.sheetIndexMapping,i,-1)),new cl(e,this.config.translationPackage.getErrorTranslation(e.type),n)}cellValueRounding(e){if(e===0)return e;const t=Math.floor(Math.log10(Math.abs(e))),r=Math.pow(10,this.config.precisionRounding-t);return e<0?-Math.round(-e*r)/r:Math.round(e*r)/r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class XR{constructor(e,t,r,n,i,a){this.dependencyGraph=e,this.columnSearch=t,this.parser=r,this.cellContentParser=n,this.stats=i,this.arraySizePredictor=a,this.buildStrategy=new $R(e,t,r,i,n,a)}buildGraph(e,t){const r=t.measure(x.COLLECT_DEPENDENCIES,()=>this.buildStrategy.run(e));this.dependencyGraph.getAndClearContentChanges(),t.measure(x.PROCESS_DEPENDENCIES,()=>this.processDependencies(r))}processDependencies(e){e.forEach((t,r)=>{this.dependencyGraph.processCellDependencies(t,r)})}}class $R{constructor(e,t,r,n,i,a){this.dependencyGraph=e,this.columnIndex=t,this.parser=r,this.stats=n,this.cellContentParser=i,this.arraySizePredictor=a}run(e){const t=new Map;for(const r in e){const n=this.dependencyGraph.getSheetId(r),i=e[r];for(let a=0;a<i.length;++a){const o=i[a];for(let u=0;u<o.length;++u){const l=o[u],c=M(n,u,a),d=this.cellContentParser.parse(l);if(d instanceof se.Formula){const f=this.stats.measure(x.PARSER,()=>this.parser.parse(d.formula,c));if(f.errors.length>0){this.shrinkArrayIfNeeded(c);const E=new Xr(f.errors,d.formula);this.dependencyGraph.addVertex(c,E)}else{this.shrinkArrayIfNeeded(c);const E=this.arraySizePredictor.checkArraySize(f.ast,c);if(E.isScalar()){const N=new Ft(f.ast,c,0);t.set(N,Lt(f.dependencies,c)),this.dependencyGraph.addVertex(c,N),f.hasVolatileFunction&&this.dependencyGraph.markAsVolatile(N),f.hasStructuralChangeFunction&&this.dependencyGraph.markAsDependentOnStructureChange(N)}else{const N=new fe(f.ast,c,new V(E.width,E.height));t.set(N,Lt(f.dependencies,c)),this.dependencyGraph.addArrayVertex(c,N)}}}else if(!(d instanceof se.Empty)){this.shrinkArrayIfNeeded(c);const f=new sr(d.value,l);this.columnIndex.add(I(d.value),c),this.dependencyGraph.addVertex(c,f)}}}}return t}shrinkArrayIfNeeded(e){const t=this.dependencyGraph.getCell(e);t instanceof fe&&this.dependencyGraph.shrinkArrayToCorner(t)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const qn=new Map([["gpl-v3",1],["missing",2],["invalid",3],["expired",4]]);class Cl extends P{version(e,t){return this.runFunction(e.args,t,this.metadata("VERSION"),()=>{const{licenseKeyValidityState:r,licenseKey:n}=this.config;let i;return qn.has(n)?i=qn.get(n):qn.has(r)?i=qn.get(r):r==="valid"&&(i=n.slice(-5)),`HyperFormula v${Oe.version}, ${i}`})}}Cl.implementedFunctions={VERSION:{method:"version",parameters:[]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function vi(s,e){var t;let r=e.implementedFunctions[s];const n=(t=e.aliases)===null||t===void 0?void 0:t[s];if(n!==void 0){if(r!==void 0)throw new Jg(s,e.name);r=e.implementedFunctions[n]}if(r===void 0)throw Qr.functionNotDeclaredInPlugin(s,e.name);return r}class Ne{constructor(e){if(this.config=e,this.functions=new Map,this.arraySizeFunctions=new Map,this.volatileFunctions=new Set,this.arrayFunctions=new Set,this.structuralChangeFunctions=new Set,this.functionsWhichDoesNotNeedArgumentsToBeComputed=new Set,this.functionsMetadata=new Map,this.doesFunctionNeedArgumentToBeComputed=t=>this.functionsWhichDoesNotNeedArgumentsToBeComputed.has(t),this.isFunctionVolatile=t=>this.volatileFunctions.has(t),this.isArrayFunction=t=>this.arrayFunctions.has(t),this.isFunctionDependentOnSheetStructureChange=t=>this.structuralChangeFunctions.has(t),e.functionPlugins.length>0){this.instancePlugins=new Map;for(const t of e.functionPlugins)Ne.loadPluginFunctions(t,this.instancePlugins)}else this.instancePlugins=new Map(Ne.plugins);for(const[t,r]of Ne.protectedFunctions())Ne.loadFunctionUnprotected(r,t,this.instancePlugins);for(const[t,r]of this.instancePlugins.entries())this.categorizeFunction(t,vi(t,r))}static registerFunctionPlugin(e,t){this.loadPluginFunctions(e,this.plugins),t!==void 0&&this.loadTranslations(t)}static registerFunction(e,t,r){this.loadPluginFunction(t,e,this.plugins),r!==void 0&&this.loadTranslations(r)}static unregisterFunction(e){if(this.functionIsProtected(e))throw Sr.cannotUnregisterFunctionWithId(e);this.plugins.delete(e)}static unregisterFunctionPlugin(e){for(const t of this.protectedPlugins())if(t===e)throw Sr.cannotUnregisterProtectedPlugin();for(const[t,r]of this.plugins.entries())r===e&&this.plugins.delete(t)}static unregisterAll(){this.plugins.clear()}static getRegisteredFunctionIds(){return[...Array.from(this.plugins.keys()),...Array.from(this._protectedPlugins.keys())]}static getPlugins(){return Array.from(new Set(this.plugins.values()).values())}static getFunctionPlugin(e){if(!this.functionIsProtected(e))return this.plugins.get(e)}static functionIsProtected(e){return this._protectedPlugins.has(e)}static loadTranslations(e){const t=new Set(Oe.getRegisteredLanguagesCodes());Object.keys(e).forEach(r=>{t.has(r)&&Oe.getLanguage(r).extendFunctions(e[r])})}static loadPluginFunctions(e,t){Object.keys(e.implementedFunctions).forEach(r=>{this.loadPluginFunction(e,r,t)}),e.aliases!==void 0&&Object.keys(e.aliases).forEach(r=>{this.loadPluginFunction(e,r,t)})}static loadPluginFunction(e,t,r){if(this.functionIsProtected(t))throw Sr.cannotRegisterFunctionWithId(t);this.loadFunctionUnprotected(e,t,r)}static handleDeprecatedMetadata(e,t){t&&t.arrayFunction!==void 0&&(console.warn(`${e}: 'arrayFunction' parameter is deprecated since 3.1.0; Use 'enableArrayArithmeticForArguments' instead.`),t.enableArrayArithmeticForArguments=t.arrayFunction),t&&t.arraySizeMethod!==void 0&&(console.warn(`${e}: 'arraySizeMethod' parameter is deprecated since 3.1.0; Use 'sizeOfResultArrayMethod' instead.`),t.sizeOfResultArrayMethod=t.arraySizeMethod)}static loadFunctionUnprotected(e,t,r){const n=vi(t,e),i=n.method;if(this.handleDeprecatedMetadata(t,n),Object.prototype.hasOwnProperty.call(e.prototype,i))r.set(t,e);else throw Qr.functionMethodNotFound(i,e.name)}static*protectedFunctions(){for(const[e,t]of this._protectedPlugins)t!==void 0&&(yield[e,t])}static*protectedPlugins(){for(const[,e]of this._protectedPlugins)e!==void 0&&(yield e)}initializePlugins(e){const t=[];for(const[r,n]of this.instancePlugins.entries()){let i=t.find(l=>l instanceof n);i===void 0&&(i=new n(e),t.push(i));const a=vi(r,n),o=a.method;this.functions.set(r,[o,i]);const u=a.sizeOfResultArrayMethod;u!==void 0&&this.arraySizeFunctions.set(r,[u,i])}}getFunctionPlugin(e){if(!Ne.functionIsProtected(e))return this.instancePlugins.get(e)}getFunction(e){const t=this.functions.get(e);if(t!==void 0&&this.config.translationPackage.isFunctionTranslated(e)){const[r,n]=t;return(i,a)=>n[r](i,a)}else return}getArraySizeFunction(e){const t=this.arraySizeFunctions.get(e);if(t!==void 0&&this.config.translationPackage.isFunctionTranslated(e)){const[r,n]=t;return(i,a)=>n[r](i,a)}else return}getMetadata(e){return this.functionsMetadata.get(e)}getPlugins(){const e=new Set;for(const[t,r]of this.instancePlugins)Ne.functionIsProtected(t)||e.add(r);return Array.from(e)}getRegisteredFunctionIds(){return Array.from(this.functions.keys())}categorizeFunction(e,t){t.isVolatile&&this.volatileFunctions.add(e),t.enableArrayArithmeticForArguments&&this.arrayFunctions.add(e),t.doesNotNeedArgumentsToBeComputed&&this.functionsWhichDoesNotNeedArgumentsToBeComputed.add(e),t.isDependentOnSheetStructureChange&&this.structuralChangeFunctions.add(e),this.functionsMetadata.set(e,t)}}Ne.plugins=new Map;Ne._protectedPlugins=new Map([["VERSION",Cl],["OFFSET",void 0]]);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Ce;(function(s){s.GREATER_THAN="GREATER_THAN",s.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",s.LESS_THAN="LESS_THAN",s.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",s.NOT_EQUAL="NOT_EQUAL",s.EQUAL="EQUAL"})(Ce||(Ce={}));const Qn=(s,e)=>({operator:s,value:e});class KR{constructor(e){var t,r,n,i;this.trueString=(r=(t=e.translationPackage.getMaybeFunctionTranslation("TRUE"))===null||t===void 0?void 0:t.toLowerCase())!==null&&r!==void 0?r:"true",this.falseString=(i=(n=e.translationPackage.getMaybeFunctionTranslation("FALSE"))===null||n===void 0?void 0:n.toLowerCase())!==null&&i!==void 0?i:"false"}fromCellValue(e,t){if(typeof e!="string"&&typeof e!="boolean"&&typeof e!="number")return;const r=this.parseCriterion(e,t);if(r!==void 0)return{raw:e,lambda:QR(r,t)}}parseCriterion(e,t){if(typeof e=="number"||typeof e=="boolean")return Qn(Ce.EQUAL,e);if(typeof e=="string"){const r=jR.exec(e);let n,i;r?(i=qR(r[1]),n=r[2]):(i=Ce.EQUAL,n=e);const a=t.coerceToMaybeNumber(n),o=n.toLowerCase()===this.trueString?!0:n.toLowerCase()===this.falseString?!1:void 0;if(i===void 0)return;if(n==="")return Qn(i,null);if(a===void 0){if(i===Ce.EQUAL||i===Ce.NOT_EQUAL)return Qn(i,o??n)}else return Qn(i,I(a))}}}const jR=/([<>=]+)(.*)/;function qR(s){switch(s){case">":return Ce.GREATER_THAN;case">=":return Ce.GREATER_THAN_OR_EQUAL;case"<":return Ce.LESS_THAN;case"<=":return Ce.LESS_THAN_OR_EQUAL;case"<>":return Ce.NOT_EQUAL;case"=":return Ce.EQUAL;default:return}}const QR=(s,e)=>{switch(s.operator){case Ce.GREATER_THAN:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)>0:t=>!1;case Ce.GREATER_THAN_OR_EQUAL:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)>=0:t=>!1;case Ce.LESS_THAN:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)<0:t=>!1;case Ce.LESS_THAN_OR_EQUAL:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)<=0:t=>!1;case Ce.EQUAL:return typeof s.value=="number"?t=>{if(typeof t=="number")return e.floatCmp(t,s.value)===0;if(typeof t=="string"){if(t==="")return!1;const r=e.coerceToMaybeNumber(t);return r===void 0?!1:e.floatCmp(r,s.value)===0}else return!1}:typeof s.value=="string"?e.eqMatcherFunction(s.value):typeof s.value=="boolean"?t=>typeof t=="boolean"&&t===s.value:t=>t===B;case Ce.NOT_EQUAL:return typeof s.value=="number"?t=>{if(typeof t=="number")return e.floatCmp(t,s.value)!==0;if(typeof t=="string"){if(t==="")return!0;const r=e.coerceToMaybeNumber(t);return r===void 0?!0:e.floatCmp(r,s.value)!==0}else return!0}:typeof s.value=="string"?e.neqMatcherFunction(s.value):typeof s.value=="boolean"?t=>typeof t!="boolean"||t!==s.value:t=>t!==B}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ZR{constructor(e,t,r,n,i,a,o,u,l,c){this.config=e,this.dependencyGraph=t,this.columnSearch=r,this.stats=n,this.arithmeticHelper=i,this.functionRegistry=a,this.namedExpressions=o,this.serialization=u,this.arraySizePredictor=l,this.dateTimeHelper=c,this.equalOp=(d,f)=>ut(this.arithmeticHelper.eq,d,f),this.notEqualOp=(d,f)=>ut(this.arithmeticHelper.neq,d,f),this.greaterThanOp=(d,f)=>ut(this.arithmeticHelper.gt,d,f),this.lessThanOp=(d,f)=>ut(this.arithmeticHelper.lt,d,f),this.greaterThanOrEqualOp=(d,f)=>ut(this.arithmeticHelper.geq,d,f),this.lessThanOrEqualOp=(d,f)=>ut(this.arithmeticHelper.leq,d,f),this.concatOp=(d,f)=>ut(this.arithmeticHelper.concat,ji(d),ji(f)),this.plusOp=(d,f)=>ut(this.arithmeticHelper.addWithEpsilon,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.minusOp=(d,f)=>ut(this.arithmeticHelper.subtract,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.timesOp=(d,f)=>ut(this.arithmeticHelper.multiply,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.powerOp=(d,f)=>ut(this.arithmeticHelper.pow,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.divOp=(d,f)=>ut(this.arithmeticHelper.divide,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.unaryMinusOp=d=>Qo(this.arithmeticHelper.unaryMinus,this.arithmeticHelper.coerceScalarToNumberOrError(d)),this.percentOp=d=>Qo(this.arithmeticHelper.unaryPercent,this.arithmeticHelper.coerceScalarToNumberOrError(d)),this.unaryPlusOp=d=>this.arithmeticHelper.unaryPlus(d),this.functionRegistry.initializePlugins(this),this.criterionBuilder=new KR(e)}evaluateAst(e,t){let r=this.evaluateAstWithoutPostprocessing(e,t);if(z(r)){if(ul(I(r)))return new p(m.NUM,T.NaN);r=La(r,hl(I(r)))}return r instanceof w&&r.height()===1&&r.width()===1&&([[r]]=r.data),JR(r,t.formulaVertex)}evaluateAstWithoutPostprocessing(e,t){switch(e.type){case g.EMPTY:return B;case g.CELL_REFERENCE:{const r=e.reference.toSimpleCellAddress(t.formulaAddress);return ze(r)?new p(m.REF,T.BadRef):this.dependencyGraph.getCellValue(r)}case g.NUMBER:case g.STRING:return e.value;case g.CONCATENATE_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.concatOp,r,n,t)}case g.EQUALS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.equalOp,r,n,t)}case g.NOT_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.notEqualOp,r,n,t)}case g.GREATER_THAN_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOp,r,n,t)}case g.LESS_THAN_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOp,r,n,t)}case g.GREATER_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOrEqualOp,r,n,t)}case g.LESS_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOrEqualOp,r,n,t)}case g.PLUS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.plusOp,r,n,t)}case g.MINUS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.minusOp,r,n,t)}case g.TIMES_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.timesOp,r,n,t)}case g.POWER_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.powerOp,r,n,t)}case g.DIV_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.divOp,r,n,t)}case g.PLUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryPlusOp,r,t)}case g.MINUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryMinusOp,r,t)}case g.PERCENT_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.percentOp,r,t)}case g.FUNCTION_CALL:{if(this.config.licenseKeyValidityState!=="valid"&&!Ne.functionIsProtected(e.procedureName))return new p(m.LIC,T.LicenseKey(this.config.licenseKeyValidityState));const r=this.functionRegistry.getFunction(e.procedureName);return r!==void 0?r(e,new bt(t.formulaAddress,t.arraysFlag||this.functionRegistry.isArrayFunction(e.procedureName),t.formulaVertex)):new p(m.NAME,T.FunctionName(e.procedureName))}case g.NAMED_EXPRESSION:{const r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.formulaAddress.sheet);return r?this.dependencyGraph.getCellValue(r.address):new p(m.NAME,T.NamedExpressionName(e.expressionName))}case g.CELL_RANGE:{if(!this.rangeSpansOneSheet(e))return new p(m.REF,T.RangeManySheets);const r=F.fromCellRange(e,t.formulaAddress),n=this.dependencyGraph.getArray(r);if(n){const i=n.array;if(i instanceof un)throw new Error("Array should be already computed");if(i instanceof p)return i;if(i instanceof Zr)return w.fromRange(i.raw(),r,this.dependencyGraph);throw new Error("Unknown array")}else return w.onlyRange(r,this.dependencyGraph)}case g.COLUMN_RANGE:{if(!this.rangeSpansOneSheet(e))return new p(m.REF,T.RangeManySheets);const r=Yt.fromColumnRange(e,t.formulaAddress);return w.onlyRange(r,this.dependencyGraph)}case g.ROW_RANGE:{if(!this.rangeSpansOneSheet(e))return new p(m.REF,T.RangeManySheets);const r=zt.fromRowRangeAst(e,t.formulaAddress);return w.onlyRange(r,this.dependencyGraph)}case g.PARENTHESIS:return this.evaluateAst(e.expression,t);case g.ARRAY:{let r;const n=[];for(const i of e.args){let a;const o=[];for(const l of i){const c=al(this.evaluateAst(l,t)),d=c.height();if(a===void 0)a=d,o.push(...c.data);else if(a===d)for(let f=0;f<d;f++)o[f].push(...c.data[f]);else return new p(m.REF,T.SizeMismatch)}const u=o[0].length;if(r===void 0)r=u,n.push(...o);else if(r===u)n.push(...o);else return new p(m.REF,T.SizeMismatch)}return w.onlyValues(n)}case g.ERROR_WITH_RAW_INPUT:case g.ERROR:return e.error}}rangeSpansOneSheet(e){return e.start.sheet===e.end.sheet}unaryRangeWrapper(e,t,r){var n;if(t instanceof w&&!r.arraysFlag&&(t=(n=fs(t,r))!==null&&n!==void 0?n:new p(m.VALUE,T.ScalarExpected)),t instanceof p)return t;if(t instanceof w){const i=t.data.map(a=>a.map(e));return w.onlyValues(i)}return e(t)}binaryRangeWrapper(e,t,r,n){var i,a;if(t instanceof w&&!n.arraysFlag&&(t=(i=fs(t,n))!==null&&i!==void 0?i:new p(m.VALUE,T.ScalarExpected)),t instanceof p)return t;if(r instanceof w&&!n.arraysFlag&&(r=(a=fs(r,n))!==null&&a!==void 0?a:new p(m.VALUE,T.ScalarExpected)),r instanceof p)return r;if(t instanceof w||r instanceof w){if(!(t instanceof w))if(r.isAdHoc()){const c=r.data;for(let d=0;d<c.length;d++)for(let f=0;f<c[0].length;f++)c[d][f]=e(t,c[d][f]);return w.onlyValues(c)}else t=w.fromScalar(t);if(!(r instanceof w))if(t.isAdHoc()){const c=t.data;for(let d=0;d<c.length;d++)for(let f=0;f<c[0].length;f++)c[d][f]=e(c[d][f],r);return w.onlyValues(c)}else r=w.fromScalar(r);if(t.width()===r.width()&&t.height()===r.height()){if(t.isAdHoc()){const c=t.data,d=r.data;for(let f=0;f<c.length;f++)for(let E=0;E<c[0].length;E++)c[f][E]=e(c[f][E],d[f][E]);return w.onlyValues(c)}if(r.isAdHoc()){const c=t.data,d=r.data;for(let f=0;f<c.length;f++)for(let E=0;E<c[0].length;E++)d[f][E]=e(c[f][E],d[f][E]);return w.onlyValues(d)}}const o=Math.max(t.width(),r.width()),u=Math.max(t.height(),r.height()),l=Array(u);for(let c=0;c<u;c++)l[c]=Array(o);for(let c=0;c<u;c++){const d=t.height()!==1?c:0,f=r.height()!==1?c:0;for(let E=0;E<o;E++){const N=t.width()!==1?E:0,R=r.width()!==1?E:0;d<t.height()&&f<r.height()&&N<t.width()&&R<r.width()?l[c][E]=e(t.data[d][N],r.data[f][R]):l[c][E]=new p(m.NA)}}return w.onlyValues(l)}return e(t,r)}}function Qo(s,e){return e instanceof p?e:s(e)}function ut(s,e,t){return e instanceof p?e:t instanceof p?t:s(e,t)}function JR(s,e){return s instanceof p&&e!==void 0?s.attachRootVertex(e):s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class eT{constructor(e){this.sheet=e,this.transformations=[]}add(e){this.transformations.push(e)}performEagerTransformations(e,t){this.transformations.forEach(r=>r.performEagerTransformations(e,t))}transformSingleAst(e,t){let[r,n]=[e,t];return this.transformations.forEach(i=>{[r,n]=i.transformSingleAst(r,n)}),[r,n]}isIrreversible(){return!0}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class tT{constructor(e){this.stats=e,this.transformations=[]}version(){return this.transformations.length}addTransformation(e){return this.combinedTransformer!==void 0?this.combinedTransformer.add(e):this.transformations.push(e),this.version()}beginCombinedMode(e){this.combinedTransformer=new eT(e)}commitCombinedMode(){if(this.combinedTransformer===void 0)throw Error("Combined mode wasn't started");return this.transformations.push(this.combinedTransformer),this.combinedTransformer=void 0,this.version()}applyTransformations(e,t,r){this.stats.start(x.TRANSFORM_ASTS_POSTPONED);for(let i=r;i<this.transformations.length;i++){const a=this.transformations[i];a.isIrreversible()&&(this.undoRedo.storeDataForVersion(i,t,this.parser.computeHashFromAst(e)),this.parser.rememberNewAst(e));const[o,u]=a.transformSingleAst(e,t);e=o,t=u}const n=this.parser.rememberNewAst(e);return this.stats.end(x.TRANSFORM_ASTS_POSTPONED),[n,t,this.transformations.length]}*getTransformationsFrom(e,t){for(let r=e;r<this.transformations.length;r++){const n=this.transformations[r];(!t||t(n))&&(yield n)}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Mt=-1;function rT(s,e,{searchCoordinate:t,orderingDirection:r,ifNoMatch:n},i){const a=e.start[t],o=t==="col"?e.effectiveEndColumn(i):e.effectiveEndRow(i),u=t==="col"?f=>I(i.getCellValue(M(e.sheet,f,e.start.row))):f=>I(i.getCellValue(M(e.sheet,e.start.col,f))),l=r==="asc"?(f,E)=>Ws(f,E):(f,E)=>-Ws(f,E),c=nT(f=>l(s,u(f))>=0,a,o),d=u(c);if(d===s)return c-a;if(n==="returnLowerBound"){if(c===Mt)return r==="asc"?Mt:0;if(typeof d!=typeof s)return Mt;if(r==="asc")return c-a;const f=c+1;return f<=o?f-a:Mt}if(n==="returnUpperBound"){if(c===Mt)return r==="asc"?0:Mt;if(typeof d!=typeof s)return Mt;if(r==="desc")return c-a;const f=c+1;return f<=o?f-a:Mt}return Mt}function nT(s,e,t){let r=e,n=t;for(;r<n;){const i=Math.ceil((r+n)/2);s(i)?r=i:n=i-1}return r===n&&s(r)?r:Mt}function Ws(s,e){return typeof s==typeof e?s===B?0:s<e?-1:s>e?1:0:s===B?-1:e===B?1:e instanceof p||typeof s=="number"&&typeof e=="string"||typeof s=="number"&&typeof e=="boolean"?-1:typeof s=="string"&&typeof e=="number"?1:typeof s=="string"&&typeof e=="boolean"?-1:1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Zo=-1;class vl{constructor(e){this.dependencyGraph=e}advancedFind(e,t,{returnOccurrence:r}={returnOccurrence:"first"}){const n=t.range,i=n===void 0?t.valuesFromTopLeftCorner():this.dependencyGraph.computeListOfValuesInRange(n),a=r==="first"?0:i.length-1,o=r==="first"?l=>l<i.length:l=>l>=0,u=r==="first"?l=>l+1:l=>l-1;for(let l=a;o(l);l=u(l))if(e(I(i[l])))return l;return Zo}basicFind(e,t,r,{ordering:n,ifNoMatch:i,returnOccurrence:a}){const o=typeof e=="string"?En(e):e,u=t.range;return u===void 0?this.findNormalizedValue(o,t.valuesFromTopLeftCorner(),i,a):n==="none"?this.findNormalizedValue(o,this.dependencyGraph.computeListOfValuesInRange(u),i,a):rT(o,u,{searchCoordinate:r,orderingDirection:n,ifNoMatch:i},this.dependencyGraph)}findNormalizedValue(e,t,r="returnNotFound",n="first"){const i=t.map(I).map(f=>typeof f=="string"?En(f):f);if(r==="returnNotFound")return n==="first"?i.indexOf(e):i.lastIndexOf(e);const a=r==="returnLowerBound"?(f,E)=>Ws(f,E):(f,E)=>-Ws(f,E);let o=r==="returnLowerBound"?-1/0:1/0,u=Zo;const l=n==="first"?0:i.length-1,c=n==="first"?f=>f<i.length:f=>f>=0,d=n==="first"?f=>f+1:f=>f-1;for(let f=l;c(f);f=d(f)){const E=i[f];if(E===e)return f;a(E,e)>0||a(o,E)<0&&(o=E,u=f)}return u}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Il extends vl{constructor(e){super(e),this.dependencyGraph=e}add(e,t){}remove(e,t){}change(e,t,r){}applyChanges(e){}addColumns(e){}removeColumns(e){}removeSheet(e){}moveValues(e,t,r,n){}removeValues(e){}find(e,t,r){return this.basicFind(e,t,"row",r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Rr{constructor(e,t,r){this.dependencyGraph=e,this.config=t,this.stats=r,this.index=new Map,this.transformingService=this.dependencyGraph.lazilyTransformingAstService,this.binarySearchStrategy=new Il(e)}add(e,t){if(!(e===B||e instanceof p))if(e instanceof w)for(const[r,n]of e.entriesFromTopLeftCorner(t))this.addSingleCellValue(I(r),n);else this.addSingleCellValue(e,t)}remove(e,t){if(e!==void 0)if(e instanceof w)for(const[r,n]of e.entriesFromTopLeftCorner(t))this.removeSingleValue(I(r),n);else this.removeSingleValue(e,t)}change(e,t,r){e!==t&&(this.remove(e,r),this.add(t,r))}applyChanges(e){for(const t of e)t.oldValue!==void 0&&this.change(I(t.oldValue),I(t.value),t.address)}moveValues(e,t,r,n){for(const[i,a]of e){const o=SE(a,n,t,r);this.remove(i,a),this.add(i,o)}}removeValues(e){for(const[t,r]of e)this.remove(t,r)}find(e,t,{ordering:r,ifNoMatch:n,returnOccurrence:i}){i==null&&(i=r==="none"?"first":"last");const a=this.findUsingColumnIndex(e,t,i);return a!==void 0?a:this.binarySearchStrategy.find(e,t,{ordering:r,ifNoMatch:n,returnOccurrence:i})}findUsingColumnIndex(e,t,r){const n=t.range;if(n===void 0)return;this.ensureRecentData(n.sheet,n.start.col,e);const i=this.getColumnMap(n.sheet,n.start.col);if(!i)return-1;const a=typeof e=="string"?En(e):e,o=i.get(a);if(!o||!o.index||o.index.length===0)return;const u=Rr.findRowBelongingToRange(o,n,r);return u!==void 0?u-n.start.row:void 0}static findRowBelongingToRange(e,t,r){const n=t.start.row,i=t.end.row,a=r==="first"?pr(n,e.index,"upperBound"):pr(i,e.index,"lowerBound");if(a===-1)return;const o=e.index[a];return o>=n&&o<=i?o:void 0}advancedFind(e,t,r={returnOccurrence:"first"}){return this.binarySearchStrategy.advancedFind(e,t,r)}addColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,0,...Array(e.numberOfColumns))}removeColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,e.numberOfColumns)}removeSheet(e){this.index.delete(e)}getColumnMap(e,t){this.index.has(e)||this.index.set(e,[]);const r=this.index.get(e);let n=r[t];return n||(n=new Map,r[t]=n),n}getValueIndex(e,t,r){const n=this.getColumnMap(e,t);let i=this.getColumnMap(e,t).get(r);return i||(i={version:this.transformingService.version(),index:[]},n.set(r,i)),i}ensureRecentData(e,t,r){const n=this.getValueIndex(e,t,r),i=this.transformingService.version();if(n.version===i)return;const a=this.transformingService.getTransformationsFrom(n.version,o=>o.sheet===e&&(o instanceof ea||o instanceof ta));for(const o of a)o instanceof ea?this.addRows(t,o.rowsSpan,r):o instanceof ta&&this.removeRows(t,o.rowsSpan,r);n.version=i}addSingleCellValue(e,t){this.stats.measure(x.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e),typeof e=="string"&&(e=En(e));const r=this.getValueIndex(t.sheet,t.col,e);Rr.addValue(r,t.row)})}removeSingleValue(e,t){this.stats.measure(x.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e);const r=this.getColumnMap(t.sheet,t.col);typeof e=="string"&&(e=En(e));const n=r.get(e);if(!n)return;const i=pr(t.row,n.index);i>-1&&n.index.splice(i,1),n.index.length===0&&r.delete(e),r.size===0&&delete this.index.get(t.sheet)[t.col]})}addRows(e,t,r){const n=this.getValueIndex(t.sheet,e,r);Rr.shiftRows(n,t.rowStart,t.numberOfRows)}removeRows(e,t,r){const n=this.getValueIndex(t.sheet,e,r);Rr.removeRowsFromValues(n,t),Rr.shiftRows(n,t.rowEnd+1,-t.numberOfRows)}static addValue(e,t){const r=pr(t,e.index,"lowerBound");e.index[r]===t||e.index.splice(r+1,0,t)}static removeRowsFromValues(e,t){const r=pr(t.rowStart,e.index,"upperBound"),n=pr(t.rowEnd,e.index,"lowerBound");r>-1&&n>-1&&r<=n&&e.index[r]<=t.rowEnd&&e.index.splice(r,n-r+1)}static shiftRows(e,t,r){const n=pr(t,e.index,"upperBound");if(n!==-1)for(let i=n;i<e.index.length;++i)e.index[i]+=r}}function pr(s,e,t="upperBound"){let r=0,n=e.length-1;for(;r<=n;){const o=Math.floor((r+n)/2);if(s>e[o])r=o+1;else if(s<e[o])n=o-1;else return o}const i=t==="lowerBound"?n:r;return i>=0&&i<=e.length?i:-1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function sT(s,e,t){return e.useColumnIndex?new Rr(s,e,t):new Il(s)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class iT{constructor(e){this.config=e;const t=this.config.thousandSeparator==="."?`\\${this.config.thousandSeparator}`:this.config.thousandSeparator,r=this.config.decimalSeparator==="."?`\\${this.config.decimalSeparator}`:this.config.decimalSeparator;this.numberPattern=new RegExp(`^([+-]?((${r}\\d+)|(\\d+(${t}\\d{3,})*(${r}\\d*)?)))(e[+-]?\\d+)?$`),this.allThousandSeparatorsRegex=new RegExp(`${t}`,"g")}numericStringToMaybeNumber(e){if(this.numberPattern.test(e)){const t=this.numericStringToNumber(e);return isNaN(t)?void 0:t}}numericStringToNumber(e){const t=e.replace(this.allThousandSeparatorsRegex,"").replace(this.config.decimalSeparator,".");return Number(t)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Da{constructor(e,t,r){this.dependencyGraph=e,this.unparser=t,this.exporter=r}getCellHyperlink(e){const t=this.dependencyGraph.getCell(e);if(t instanceof Ft){const r=t.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(r.procedureName==="HYPERLINK")return r.hyperlink}}getCellFormula(e,t){const r=this.dependencyGraph.getCell(e);if(r instanceof Ft){const n=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);return t=t??e,this.unparser.unparse(n,t)}else if(r instanceof fe){const n=r.getAddress(this.dependencyGraph.lazilyTransformingAstService);if(n.row!==e.row||n.col!==e.col||n.sheet!==e.sheet)return;t=t??e;const i=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(i!==void 0)return this.unparser.unparse(i,t)}else if(r instanceof Xr)return r.getFormula()}getCellSerialized(e,t){var r;return(r=this.getCellFormula(e,t))!==null&&r!==void 0?r:this.getRawValue(e)}getCellValue(e){return this.exporter.exportValue(this.dependencyGraph.getScalarValue(e))}getRawValue(e){return this.dependencyGraph.getRawValue(e)}getSheetValues(e){return this.genericSheetGetter(e,t=>this.getCellValue(t))}getSheetFormulas(e){return this.genericSheetGetter(e,t=>this.getCellFormula(t))}genericSheetGetter(e,t){const r=this.dependencyGraph.getSheetHeight(e),n=this.dependencyGraph.getSheetWidth(e),i=new Array(r);for(let a=0;a<r;a++){i[a]=new Array(n);for(let o=0;o<n;o++){const u=M(e,o,a);i[a][o]=t(u)}for(let o=n-1;o>=0&&(i[a][o]===null||i[a][o]===void 0);o--)i[a].pop()}for(let a=r-1;a>=0&&i[a].length===0;a--)i.pop();return i}genericAllSheetsGetter(e){const t={};for(const r of this.dependencyGraph.sheetMapping.displayNames()){const n=this.dependencyGraph.sheetMapping.fetch(r);t[r]=e(n)}return t}getSheetSerialized(e){return this.genericSheetGetter(e,t=>this.getCellSerialized(t))}getAllSheetsValues(){return this.genericAllSheetsGetter(e=>this.getSheetValues(e))}getAllSheetsFormulas(){return this.genericAllSheetsGetter(e=>this.getSheetFormulas(e))}getAllSheetsSerialized(){return this.genericAllSheetsGetter(e=>this.getSheetSerialized(e))}getAllNamedExpressionsSerialized(){const e=[];let t=0;for(const r of this.dependencyGraph.sheetMapping.displayNames()){const n=this.dependencyGraph.sheetMapping.fetch(r);e[n]=t,t++}return this.dependencyGraph.namedExpressions.getAllNamedExpressions().map(r=>({name:r.expression.displayName,expression:this.getCellSerialized(r.expression.address),scope:r.scope!==void 0?e[r.scope]:void 0,options:r.expression.options}))}withNewConfig(e,t){const r=new kh(e,_a(e),this.dependencyGraph.sheetMapping.fetchDisplayName,t);return new Da(this.dependencyGraph,r,this.exporter)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Zn{static buildFromSheets(e,t={},r=[]){const n=new rt(t);return this.buildEngine(n,e,r)}static buildFromSheet(e,t={},r=[]){const n=new rt(t),i=n.translationPackage.getUITranslation(On.NEW_SHEET_PREFIX)+"1";return this.buildEngine(n,{[i]:e},r)}static buildEmpty(e={},t=[]){return this.buildEngine(new rt(e),{},t)}static rebuildWithConfig(e,t,r,n){return this.buildEngine(e,t,r,n)}static buildEngine(e,t={},r=[],n=e.useStats?new Wh:new qg){n.start(x.BUILD_ENGINE_TOTAL);const i=new vr,a=new Ne(e),o=new tT(n),u=Pa.buildEmpty(o,e,a,i,n),l=sT(u,e,n),c=u.sheetMapping,d=u.addressMapping;for(const X in t)if(Object.prototype.hasOwnProperty.call(t,X)){const at=t[X];Rl(at);const xe=Bs(at);if(xe.height>e.maxRows||xe.width>e.maxColumns)throw new Nr;const ot=c.addSheet(X);d.autoAddSheet(ot,xe)}const f=new mn(e,a,c.get);o.parser=f;const E=new kh(e,_a(e),c.fetchDisplayName,i),N=new YE(e),R=new iT(e),A=new IE(e,N,R),S=new cR(e,N,R),y=new UE(e,a),C=new NR(e,u,l,S,f,n,o,i,y),O=new HR(e,C);o.undoRedo=O;const te=new dR(e,u,C),j=new WR(e,C,O,te,u,l,f,S,o,i),q=new zR(e,i,c.fetchDisplayName,o),Ee=new Da(u,E,q),re=new ZR(e,u,l,n,A,a,i,Ee,y,N);n.measure(x.GRAPH_BUILD,()=>{new XR(u,l,f,S,n,y).buildGraph(t,n)}),r.forEach(X=>{j.ensureItIsPossibleToAddNamedExpression(X.name,X.expression,X.scope),j.operations.addNamedExpression(X.name,X.expression,X.scope,X.options)});const ne=new YR(e,n,re,o,u,l);return ne.run(),n.end(x.BUILD_ENGINE_TOTAL),{config:e,stats:n,dependencyGraph:u,columnSearch:l,parser:f,unparser:E,cellContentParser:S,evaluator:ne,lazilyTransformingAstService:o,crudOperations:j,exporter:q,namedExpressions:i,serialization:Ee,functionRegistry:a}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function aT(s){for(const[e,t]of Object.entries(s))t instanceof Function?s[e]=oT(t):delete s[e]}function oT(s){return()=>{throw new Error(`The "${s}" method cannot be called because this HyperFormula instance has been destroyed`)}}var Jn={exports:{}},Jo;function uT(){if(Jo)return Jn.exports;Jo=1;function s(){}return s.prototype={on:function(e,t,r){var n=this.e||(this.e={});return(n[e]||(n[e]=[])).push({fn:t,ctx:r}),this},once:function(e,t,r){var n=this;function i(){n.off(e,i),t.apply(r,arguments)}return i._=t,this.on(e,i,r)},emit:function(e){var t=[].slice.call(arguments,1),r=((this.e||(this.e={}))[e]||[]).slice(),n=0,i=r.length;for(n;n<i;n++)r[n].fn.apply(r[n].ctx,t);return this},off:function(e,t){var r=this.e||(this.e={}),n=r[e],i=[];if(n&&t)for(var a=0,o=n.length;a<o;a++)n[a].fn!==t&&n[a].fn._!==t&&i.push(n[a]);return i.length?r[e]=i:delete r[e],this}},Jn.exports=s,Jn.exports.TinyEmitter=s,Jn.exports}var hT=uT();/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var wt;(function(s){s.SheetAdded="sheetAdded",s.SheetRemoved="sheetRemoved",s.SheetRenamed="sheetRenamed",s.NamedExpressionAdded="namedExpressionAdded",s.NamedExpressionRemoved="namedExpressionRemoved",s.ValuesUpdated="valuesUpdated",s.EvaluationSuspended="evaluationSuspended",s.EvaluationResumed="evaluationResumed"})(wt||(wt={}));class lT extends hT.TinyEmitter{emit(e,...t){return super.emit(e,...t),this}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Oe{constructor(e,t,r,n,i,a,o,u,l,c,d,f,E,N){this._config=e,this._stats=t,this._dependencyGraph=r,this._columnSearch=n,this._parser=i,this._unparser=a,this._cellContentParser=o,this._evaluator=u,this._lazilyTransformingAstService=l,this._crudOperations=c,this._exporter=d,this._namedExpressions=f,this._serialization=E,this._functionRegistry=N,this._emitter=new lT,this._evaluationSuspended=!1}static get defaultConfig(){return cT()}get graph(){return this.dependencyGraph.graph}get rangeMapping(){return this.dependencyGraph.rangeMapping}get arrayMapping(){return this.dependencyGraph.arrayMapping}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}get dependencyGraph(){return this._dependencyGraph}get evaluator(){return this._evaluator}get columnSearch(){return this._columnSearch}get lazilyTransformingAstService(){return this._lazilyTransformingAstService}get licenseKeyValidityState(){return this._config.licenseKeyValidityState}static buildFromArray(e,t={},r=[]){return this.buildFromEngineState(Zn.buildFromSheet(e,t,r))}static buildFromSheets(e,t={},r=[]){return this.buildFromEngineState(Zn.buildFromSheets(e,t,r))}static buildEmpty(e={},t=[]){return this.buildFromEngineState(Zn.buildEmpty(e,t))}static getLanguage(e){v(e,"string","languageCode");const t=this.registeredLanguages.get(e);if(t===void 0)throw new zi;return t}static registerLanguage(e,t){if(v(e,"string","languageCode"),this.registeredLanguages.has(e))throw new nl;this.registeredLanguages.set(e,lE(t))}static unregisterLanguage(e){if(v(e,"string","languageCode"),this.registeredLanguages.has(e))this.registeredLanguages.delete(e);else throw new zi}static getRegisteredLanguagesCodes(){return Array.from(this.registeredLanguages.keys())}static registerFunctionPlugin(e,t){Ne.registerFunctionPlugin(e,t)}static unregisterFunctionPlugin(e){Ne.unregisterFunctionPlugin(e)}static registerFunction(e,t,r){v(e,"string","functionId"),Ne.registerFunction(e,t,r)}static unregisterFunction(e){v(e,"string","functionId"),Ne.unregisterFunction(e)}static unregisterAllFunctions(){Ne.unregisterAll()}static getRegisteredFunctionNames(e){v(e,"string","code");const t=Ne.getRegisteredFunctionIds();return this.getLanguage(e).getFunctionTranslations(t)}static getFunctionPlugin(e){return v(e,"string","functionId"),Ne.getFunctionPlugin(e)}static getAllFunctionPlugins(){return Ne.getPlugins()}static buildFromEngineState(e){return new Oe(e.config,e.stats,e.dependencyGraph,e.columnSearch,e.parser,e.unparser,e.cellContentParser,e.evaluator,e.lazilyTransformingAstService,e.crudOperations,e.exporter,e.namedExpressions,e.serialization,e.functionRegistry)}getCellValue(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellValue(e)}getCellFormula(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");return this._serialization.getCellFormula(e)}getCellHyperlink(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellHyperlink(e)}getCellSerialized(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellSerialized(e)}getSheetValues(e){return v(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetValues(e)}getSheetFormulas(e){return v(e,"number","sheetId"),this._serialization.getSheetFormulas(e)}getSheetSerialized(e){return v(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetSerialized(e)}getAllSheetsDimensions(){return this._serialization.genericAllSheetsGetter(e=>this.getSheetDimensions(e))}getSheetDimensions(e){return v(e,"number","sheetId"),{width:this.dependencyGraph.getSheetWidth(e),height:this.dependencyGraph.getSheetHeight(e)}}getAllSheetsValues(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsValues()}getAllSheetsFormulas(){return this._serialization.getAllSheetsFormulas()}getAllSheetsSerialized(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsSerialized()}updateConfig(e){Object.entries(e).every(([r,n])=>this._config[r]===n)||this.rebuildWithConfig(e)}getConfig(){return this._config.getConfig()}rebuildAndRecalculate(){this.rebuildWithConfig({})}getStats(){return this._stats.snapshot()}undo(){return this._crudOperations.undo(),this.recomputeIfDependencyGraphNeedsIt()}redo(){return this._crudOperations.redo(),this.recomputeIfDependencyGraphNeedsIt()}isThereSomethingToUndo(){return this._crudOperations.isThereSomethingToUndo()}isThereSomethingToRedo(){return this._crudOperations.isThereSomethingToRedo()}isItPossibleToSetCellContents(e){let t;if(le(e))t=new F(e,e);else if(Ze(e))t=new F(e.start,e.end);else throw new Y("SimpleCellAddress | SimpleCellRange","address");try{this._crudOperations.ensureRangeInSizeLimits(t);for(const r of t.addresses(this._dependencyGraph))this._crudOperations.ensureItIsPossibleToChangeContent(r)}catch{return!1}return!0}setCellContents(e,t){return this._crudOperations.setCellContents(e,t),this.recomputeIfDependencyGraphNeedsIt()}swapRowIndexes(e,t){return v(e,"number","sheetId"),this._crudOperations.setRowOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapRowIndexes(e,t){v(e,"number","sheetId");try{return this._crudOperations.validateSwapRowIndexes(e,t),this._crudOperations.testRowOrderForArrays(e,t),!0}catch{return!1}}setRowOrder(e,t){v(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"row");return this.swapRowIndexes(e,r)}isItPossibleToSetRowOrder(e,t){v(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"row");return this._crudOperations.validateSwapRowIndexes(e,r),this._crudOperations.testRowOrderForArrays(e,r),!0}catch{return!1}}swapColumnIndexes(e,t){return v(e,"number","sheetId"),this._crudOperations.setColumnOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapColumnIndexes(e,t){v(e,"number","sheetId");try{return this._crudOperations.validateSwapColumnIndexes(e,t),this._crudOperations.testColumnOrderForArrays(e,t),!0}catch{return!1}}setColumnOrder(e,t){v(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"column");return this.swapColumnIndexes(e,r)}isItPossibleToSetColumnOrder(e,t){v(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"column");return this._crudOperations.validateSwapColumnIndexes(e,r),this._crudOperations.testColumnOrderForArrays(e,r),!0}catch{return!1}}isItPossibleToAddRows(e,...t){v(e,"number","sheetId");const r=Gs(t);try{return this._crudOperations.ensureItIsPossibleToAddRows(e,...r),!0}catch{return!1}}addRows(e,...t){return v(e,"number","sheetId"),this._crudOperations.addRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveRows(e,...t){v(e,"number","sheetId");const r=ks(t);try{return this._crudOperations.ensureItIsPossibleToRemoveRows(e,...r),!0}catch{return!1}}removeRows(e,...t){return v(e,"number","sheetId"),this._crudOperations.removeRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToAddColumns(e,...t){v(e,"number","sheetId");const r=Gs(t);try{return this._crudOperations.ensureItIsPossibleToAddColumns(e,...r),!0}catch{return!1}}addColumns(e,...t){return v(e,"number","sheetId"),this._crudOperations.addColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveColumns(e,...t){v(e,"number","sheetId");const r=ks(t);try{return this._crudOperations.ensureItIsPossibleToRemoveColumns(e,...r),!0}catch{return!1}}removeColumns(e,...t){return v(e,"number","sheetId"),this._crudOperations.removeColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveCells(e,t){if(!le(t))throw new Y("SimpleCellAddress","destinationLeftCorner");if(!Ze(e))throw new Y("SimpleCellRange","source");try{const r=new F(e.start,e.end);return this._crudOperations.operations.ensureItIsPossibleToMoveCells(r.start,r.width(),r.height(),t),!0}catch{return!1}}moveCells(e,t){if(!le(t))throw new Y("SimpleCellAddress","destinationLeftCorner");if(!Ze(e))throw new Y("SimpleCellRange","source");const r=new F(e.start,e.end);return this._crudOperations.moveCells(r.start,r.width(),r.height(),t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveRows(e,t,r,n){v(e,"number","sheetId"),v(t,"number","startRow"),v(r,"number","numberOfRows"),v(n,"number","targetRow");try{return this._crudOperations.ensureItIsPossibleToMoveRows(e,t,r,n),!0}catch{return!1}}moveRows(e,t,r,n){return v(e,"number","sheetId"),v(t,"number","startRow"),v(r,"number","numberOfRows"),v(n,"number","targetRow"),this._crudOperations.moveRows(e,t,r,n),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveColumns(e,t,r,n){v(e,"number","sheetId"),v(t,"number","startColumn"),v(r,"number","numberOfColumns"),v(n,"number","targetColumn");try{return this._crudOperations.ensureItIsPossibleToMoveColumns(e,t,r,n),!0}catch{return!1}}moveColumns(e,t,r,n){return v(e,"number","sheetId"),v(t,"number","startColumn"),v(r,"number","numberOfColumns"),v(n,"number","targetColumn"),this._crudOperations.moveColumns(e,t,r,n),this.recomputeIfDependencyGraphNeedsIt()}copy(e){if(!Ze(e))throw new Y("SimpleCellRange","source");const t=new F(e.start,e.end);return this._crudOperations.copy(t.start,t.width(),t.height()),this.getRangeValues(e)}cut(e){if(!Ze(e))throw new Y("SimpleCellRange","source");const t=new F(e.start,e.end);return this._crudOperations.cut(t.start,t.width(),t.height()),this.getRangeValues(e)}paste(e){if(!le(e))throw new Y("SimpleCellAddress","targetLeftCorner");return this.ensureEvaluationIsNotSuspended(),this._crudOperations.paste(e),this.recomputeIfDependencyGraphNeedsIt()}isClipboardEmpty(){return this._crudOperations.isClipboardEmpty()}clearClipboard(){this._crudOperations.clearClipboard()}clearRedoStack(){this._crudOperations.undoRedo.clearRedoStack()}clearUndoStack(){this._crudOperations.undoRedo.clearUndoStack()}getRangeValues(e){if(!Ze(e))throw new Y("SimpleCellRange","source");return new F(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellValue(n)))}getRangeFormulas(e){if(!Ze(e))throw new Y("SimpleCellRange","source");return new F(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellFormula(n)))}getRangeSerialized(e){if(!Ze(e))throw new Y("SimpleCellRange","source");return new F(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellSerialized(n)))}getFillRangeData(e,t,r=!1){if(!Ze(e))throw new Y("SimpleCellRange","source");if(!Ze(t))throw new Y("SimpleCellRange","target");const n=new F(e.start,e.end),i=new F(t.start,t.end);return this.ensureEvaluationIsNotSuspended(),i.arrayOfAddressesInRange().map(a=>a.map(o=>{const u=((o.row-(r?t:e).start.row)%n.height()+n.height())%n.height()+e.start.row,l=((o.col-(r?t:e).start.col)%n.width()+n.width())%n.width()+e.start.col;return this._serialization.getCellSerialized({row:u,col:l,sheet:n.sheet},o)}))}isItPossibleToAddSheet(e){v(e,"string","sheetName");try{return this._crudOperations.ensureItIsPossibleToAddSheet(e),!0}catch{return!1}}addSheet(e){e!==void 0&&v(e,"string","sheetName");const t=this._crudOperations.addSheet(e);return this._emitter.emit(wt.SheetAdded,t),t}isItPossibleToRemoveSheet(e){v(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch{return!1}}removeSheet(e){v(e,"number","sheetId");const t=this.sheetMapping.getDisplayName(e);this._crudOperations.removeSheet(e);const r=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(wt.SheetRemoved,t,r),r}isItPossibleToClearSheet(e){v(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch{return!1}}clearSheet(e){return v(e,"number","sheetId"),this._crudOperations.clearSheet(e),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToReplaceSheetContent(e,t){v(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),this._crudOperations.ensureItIsPossibleToChangeSheetContents(e,t),!0}catch{return!1}}setSheetContent(e,t){return v(e,"number","sheetId"),this._crudOperations.setSheetContent(e,t),this.recomputeIfDependencyGraphNeedsIt()}simpleCellAddressFromString(e,t){return v(e,"string","cellAddress"),v(t,"number","sheetId"),Fi(this.sheetMapping.get,e,t)}simpleCellRangeFromString(e,t){return v(e,"string","cellRange"),v(t,"number","sheetId"),$p(this.sheetMapping.get,e,t)}simpleCellAddressToString(e,t={}){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");const r=typeof t=="number"?t:t.includeSheetName?e.sheet+1:e.sheet;return Ns(this.sheetMapping.fetchDisplayName,e,r)}simpleCellRangeToString(e,t={}){if(!Ze(e))throw new Y("SimpleCellRange","cellRange");const r=typeof t=="number"?t:t.includeSheetName?e.start.sheet+e.end.sheet+1:e.start.sheet;return Kp(this.sheetMapping.fetchDisplayName,e,r)}getCellDependents(e){let t;if(le(e))t=this._dependencyGraph.addressMapping.getCell(e);else if(Ze(e))t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end);else throw new Y("SimpleCellAddress | SimpleCellRange",e);return t===void 0?[]:this._dependencyGraph.getAdjacentNodesAddresses(t)}getCellPrecedents(e){let t;if(le(e))t=this._dependencyGraph.addressMapping.getCell(e);else if(Ze(e))t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end);else throw new Y("SimpleCellAddress | SimpleCellRange",e);return t===void 0?[]:this._dependencyGraph.dependencyQueryAddresses(t)}getSheetName(e){return v(e,"number","sheetId"),this.sheetMapping.getDisplayName(e)}getSheetNames(){return this.sheetMapping.sheetNames()}getSheetId(e){return v(e,"string","sheetName"),this.sheetMapping.get(e)}doesSheetExist(e){return v(e,"string","sheetName"),this.sheetMapping.hasSheetWithName(e)}getCellType(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");const t=this.dependencyGraph.getCell(e);return mE(t,e)}doesCellHaveSimpleValue(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");return this.getCellType(e)===He.VALUE}doesCellHaveFormula(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===He.FORMULA||t===He.ARRAYFORMULA}isCellEmpty(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");return this.getCellType(e)===He.EMPTY}isCellPartOfArray(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===He.ARRAY||t===He.ARRAYFORMULA}getCellValueType(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return xs(t)}getCellValueDetailedType(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return EE(t)}getCellValueFormat(e){if(!le(e))throw new Y("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return RE(t)}countSheets(){return this.sheetMapping.numberOfSheets()}isItPossibleToRenameSheet(e,t){v(e,"number","sheetId"),v(t,"string","newName");try{return this._crudOperations.ensureItIsPossibleToRenameSheet(e,t),!0}catch{return!1}}renameSheet(e,t){v(e,"number","sheetId"),v(t,"string","newName");const r=this._crudOperations.renameSheet(e,t);r!==void 0&&this._emitter.emit(wt.SheetRenamed,r,t)}batch(e){this.suspendEvaluation(),this._crudOperations.beginUndoRedoBatchMode();try{e()}catch(t){throw this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation(),t}return this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation()}suspendEvaluation(){this._evaluationSuspended=!0,this._emitter.emit(wt.EvaluationSuspended)}resumeEvaluation(){this._evaluationSuspended=!1;const e=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(wt.EvaluationResumed,e),e}isEvaluationSuspended(){return this._evaluationSuspended}isItPossibleToAddNamedExpression(e,t,r){v(e,"string","expressionName"),r!==void 0&&v(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToAddNamedExpression(e,t,r),!0}catch{return!1}}addNamedExpression(e,t,r,n){v(e,"string","expressionName"),r!==void 0&&v(r,"number","scope"),this._crudOperations.addNamedExpression(e,t,r,n);const i=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(wt.NamedExpressionAdded,e,i),i}getNamedExpressionValue(e,t){v(e,"string","expressionName"),t!==void 0&&v(t,"number","scope"),this.ensureEvaluationIsNotSuspended(),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);if(r)return this._serialization.getCellValue(r.address)}getNamedExpressionFormula(e,t){v(e,"string","expressionName"),t!==void 0&&v(t,"number","scope"),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);if(r!==void 0)return this._serialization.getCellFormula(r.address)}getNamedExpression(e,t){v(e,"string","expressionName"),t!==void 0&&v(t,"number","scope");const r=this._namedExpressions.namedExpressionForScope(e,t);if(r===void 0)return;const n=this._serialization.getCellFormula(r.address);return{name:e,scope:t,expression:n,options:r.options}}isItPossibleToChangeNamedExpression(e,t,r){v(e,"string","expressionName"),r!==void 0&&v(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToChangeNamedExpression(e,t,r),!0}catch{return!1}}changeNamedExpression(e,t,r,n){return v(e,"string","expressionName"),r!==void 0&&v(r,"number","scope"),this._crudOperations.changeNamedExpressionExpression(e,r,t,n),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveNamedExpression(e,t){v(e,"string","expressionName"),t!==void 0&&v(t,"number","scope");try{return this._crudOperations.isItPossibleToRemoveNamedExpression(e,t),!0}catch{return!1}}removeNamedExpression(e,t){v(e,"string","expressionName"),t!==void 0&&v(t,"number","scope");const r=this._crudOperations.removeNamedExpression(e,t);if(r){const n=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(wt.NamedExpressionRemoved,r.displayName,n),n}else return[]}listNamedExpressions(e){return e!==void 0&&v(e,"number","scope"),this._crudOperations.ensureScopeIdIsValid(e),this._namedExpressions.getAllNamedExpressionsNamesInScope(e)}getAllNamedExpressionsSerialized(){return this._serialization.getAllNamedExpressionsSerialized()}normalizeFormula(e){v(e,"string","formulaString");const{ast:t,address:r}=this.extractTemporaryFormula(e);if(t===void 0)throw new ds;return this._unparser.unparse(t,r)}calculateFormula(e,t){v(e,"string","formulaString"),v(t,"number","sheetId"),this._crudOperations.ensureScopeIdIsValid(t);const{ast:r,address:n,dependencies:i}=this.extractTemporaryFormula(e,t);if(r===void 0)throw new ds;const a=this.evaluator.runAndForget(r,n,i);return this._exporter.exportScalarOrRange(a)}getNamedExpressionsFromFormula(e){v(e,"string","formulaString");const{ast:t,dependencies:r}=this.extractTemporaryFormula(e);if(t===void 0)throw new ds;const n=r.filter(a=>a instanceof Wt).map(a=>a.name);return[...new Set(n)]}validateFormula(e){v(e,"string","formulaString");const{ast:t}=this.extractTemporaryFormula(e);return t!==void 0}getRegisteredFunctionNames(){return Oe.getLanguage(this._config.language).getFunctionTranslations(this._functionRegistry.getRegisteredFunctionIds())}getFunctionPlugin(e){return v(e,"string","functionId"),this._functionRegistry.getFunctionPlugin(e)}getAllFunctionPlugins(){return this._functionRegistry.getPlugins()}numberToDateTime(e){return v(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDateTime(e)}numberToDate(e){return v(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDate(e)}numberToTime(e){return v(e,"number","val"),$r(e)}on(e,t){this._emitter.on(e,t)}once(e,t){this._emitter.once(e,t)}off(e,t){this._emitter.off(e,t)}destroy(){aT(this)}ensureEvaluationIsNotSuspended(){if(this._evaluationSuspended)throw new tl}extractTemporaryFormula(e,t=1){const r=this._cellContentParser.parse(e),n={sheet:t,col:0,row:0};if(!(r instanceof se.Formula))return{address:n,dependencies:[]};const{ast:i,errors:a,dependencies:o}=this._parser.parse(r.formula,n);return a.length>0?{address:n,dependencies:[]}:{ast:i,address:n,dependencies:o}}rebuildWithConfig(e){const t=this._config.mergeConfig(e),r=this._config.mergeConfig({language:e.language}),n=this._serialization.withNewConfig(r,this._namedExpressions).getAllSheetsSerialized(),i=this._serialization.getAllNamedExpressionsSerialized(),a=Zn.rebuildWithConfig(t,n,i,this._stats);this._config=a.config,this._stats=a.stats,this._dependencyGraph=a.dependencyGraph,this._columnSearch=a.columnSearch,this._parser=a.parser,this._unparser=a.unparser,this._cellContentParser=a.cellContentParser,this._evaluator=a.evaluator,this._lazilyTransformingAstService=a.lazilyTransformingAstService,this._crudOperations=a.crudOperations,this._exporter=a.exporter,this._namedExpressions=a.namedExpressions,this._serialization=a.serialization,this._functionRegistry=a.functionRegistry}recomputeIfDependencyGraphNeedsIt(){if(this._evaluationSuspended)return[];{const e=this._crudOperations.getAndClearContentChanges(),t=this.dependencyGraph.verticesToRecompute();this.dependencyGraph.clearDirtyVertices(),t.length>0&&e.addAll(this.evaluator.partialRun(t));const r=e.exportChanges(this._exporter);return e.isEmpty()||this._emitter.emit(wt.ValuesUpdated,r),r}}}Oe.version="3.1.0";Oe.buildDate="14/10/2025 09:41:56";Oe.releaseDate="14/10/2025";Oe.languages={};Oe.registeredLanguages=new Map;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const eu=new WeakMap;class rt{constructor(e={},t=!0){const{accentSensitive:r,caseSensitive:n,caseFirst:i,chooseAddressMappingPolicy:a,context:o,currencySymbol:u,dateFormats:l,decimalSeparator:c,evaluateNullToZero:d,functionArgSeparator:f,functionPlugins:E,ignorePunctuation:N,leapYear1900:R,localeLang:A,language:S,ignoreWhiteSpace:y,licenseKey:C,matchWholeCell:O,arrayColumnSeparator:te,arrayRowSeparator:j,maxRows:q,maxColumns:Ee,nullYear:re,nullDate:ne,parseDateTime:X,precisionEpsilon:at,precisionRounding:xe,stringifyDateTime:ot,stringifyDuration:ke,smartRounding:Pe,timeFormats:Mr,thousandSeparator:Vn,useArrayArithmetic:cr,useStats:Dn,undoLimit:Bn,useColumnIndex:ii,useRegularExpressions:kn,useWildcards:Qe}=e;this.useArrayArithmetic=$(cr,"boolean","useArrayArithmetic"),this.accentSensitive=$(r,"boolean","accentSensitive"),this.caseSensitive=$(n,"boolean","caseSensitive"),this.caseFirst=$(i,["upper","lower","false"],"caseFirst"),this.ignorePunctuation=$(N,"boolean","ignorePunctuation"),this.chooseAddressMappingPolicy=a??rt.defaultConfig.chooseAddressMappingPolicy,this.dateFormats=[...Xn(l,Array.isArray,"array","dateFormats")],this.timeFormats=[...Xn(Mr,Array.isArray,"array","timeFormats")],this.functionArgSeparator=$(f,"string","functionArgSeparator"),this.decimalSeparator=$(c,[".",","],"decimalSeparator"),this.language=$(S,"string","language"),this.ignoreWhiteSpace=$(y,["standard","any"],"ignoreWhiteSpace"),this.licenseKey=$(C,"string","licenseKey"),this.thousandSeparator=$(Vn,["",","," ","."],"thousandSeparator"),this.arrayColumnSeparator=$(te,[",",";"],"arrayColumnSeparator"),this.arrayRowSeparator=$(j,[";","|"],"arrayRowSeparator"),this.localeLang=$(A,"string","localeLang"),this.functionPlugins=[...E??rt.defaultConfig.functionPlugins],this.smartRounding=$(Pe,"boolean","smartRounding"),this.evaluateNullToZero=$(d,"boolean","evaluateNullToZero"),this.nullYear=$(re,"number","nullYear"),Lr(this.nullYear,"nullYear",0),bE(this.nullYear,"nullYear",100),this.precisionRounding=$(xe,"number","precisionRounding"),Lr(this.precisionRounding,"precisionRounding",0),this.precisionEpsilon=$(at,"number","precisionEpsilon"),Lr(this.precisionEpsilon,"precisionEpsilon",0),this.useColumnIndex=$(ii,"boolean","useColumnIndex"),this.useStats=$(Dn,"boolean","useStats"),this.parseDateTime=$(X,"function","parseDateTime"),this.stringifyDateTime=$(ot,"function","stringifyDateTime"),this.stringifyDuration=$(ke,"function","stringifyDuration"),this.translationPackage=Oe.getLanguage(this.language),this.errorMapping=this.translationPackage.buildErrorMapping(),this.nullDate=Xn(ne,Rn,"IDate","nullDate"),this.leapYear1900=$(R,"boolean","leapYear1900"),this.undoLimit=$(Bn,"number","undoLimit"),this.useRegularExpressions=$(kn,"boolean","useRegularExpressions"),this.useWildcards=$(Qe,"boolean","useWildcards"),this.matchWholeCell=$(O,"boolean","matchWholeCell"),Lr(this.undoLimit,"undoLimit",0),this.maxRows=$(q,"number","maxRows"),Lr(this.maxRows,"maxRows",1),this.maxColumns=$(Ee,"number","maxColumns"),this.currencySymbol=this.setupCurrencySymbol(u),Lr(this.maxColumns,"maxColumns",1),this.context=o,eu.set(this,{licenseKeyValidityState:aR(this.licenseKey)}),Do({value:this.decimalSeparator,name:"decimalSeparator"},{value:this.functionArgSeparator,name:"functionArgSeparator"},{value:this.thousandSeparator,name:"thousandSeparator"}),Do({value:this.arrayRowSeparator,name:"arrayRowSeparator"},{value:this.arrayColumnSeparator,name:"arrayColumnSeparator"})}setupCurrencySymbol(e){const t=[...Xn(e,Array.isArray,"array","currencySymbol")];return t.forEach(r=>{if(typeof r!="string")throw new Y("string[]","currencySymbol");if(r==="")throw new Zg("currencySymbol")}),t}get licenseKeyValidityState(){return eu.get(this).licenseKeyValidityState}getConfig(){return Ol(this)}mergeConfig(e){const t=Object.assign({},this.getConfig(),e);return new rt(t,!1)}static warnDeprecatedOptions(e){}static warnDeprecatedIfUsed(e,t,r,n){e!==void 0&&console.warn(n===void 0?`${t} option is deprecated since ${r}`:`${t} option is deprecated since ${r}, please use ${n}`)}}rt.defaultConfig={accentSensitive:!1,currencySymbol:["$"],caseSensitive:!1,caseFirst:"lower",context:void 0,chooseAddressMappingPolicy:new KE,dateFormats:["DD/MM/YYYY","DD/MM/YY"],decimalSeparator:".",evaluateNullToZero:!1,functionArgSeparator:",",functionPlugins:[],ignorePunctuation:!1,language:"enGB",ignoreWhiteSpace:"standard",licenseKey:"",leapYear1900:!1,localeLang:"en",matchWholeCell:!0,arrayColumnSeparator:",",arrayRowSeparator:";",maxRows:4e4,maxColumns:18278,nullYear:30,nullDate:{year:1899,month:12,day:30},parseDateTime:BE,precisionEpsilon:1e-13,precisionRounding:10,smartRounding:!0,stringifyDateTime:rR,stringifyDuration:tR,timeFormats:["hh:mm","hh:mm:ss.sss"],thousandSeparator:"",undoLimit:20,useRegularExpressions:!1,useWildcards:!0,useColumnIndex:!1,useStats:!1,useArrayArithmetic:!1};function Ol(s){var e;const t={};for(const r in rt.defaultConfig){const n=(e=s[r])!==null&&e!==void 0?e:rt.defaultConfig[r];Array.isArray(n)?t[r]=[...n]:t[r]=n}return t}function cT(){return Ol({})}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const na={errors:{CYCLE:"#CYCLE!",DIV_BY_ZERO:"#DIV/0!",ERROR:"#ERROR!",NA:"#N/A",NAME:"#NAME?",NUM:"#NUM!",REF:"#REF!",SPILL:"#SPILL!",VALUE:"#VALUE!"},functions:{FILTER:"FILTER",ADDRESS:"ADDRESS",ARRAY_CONSTRAIN:"ARRAY_CONSTRAIN",ARRAYFORMULA:"ARRAYFORMULA",ABS:"ABS",ACOS:"ACOS",ACOSH:"ACOSH",ACOT:"ACOT",ACOTH:"ACOTH",AND:"AND",ARABIC:"ARABIC",ASIN:"ASIN",ASINH:"ASINH",ATAN2:"ATAN2",ATAN:"ATAN",ATANH:"ATANH",AVERAGE:"AVERAGE",AVERAGEA:"AVERAGEA",AVERAGEIF:"AVERAGEIF",BASE:"BASE",BIN2DEC:"BIN2DEC",BIN2HEX:"BIN2HEX",BIN2OCT:"BIN2OCT",BITAND:"BITAND",BITLSHIFT:"BITLSHIFT",BITOR:"BITOR",BITRSHIFT:"BITRSHIFT",BITXOR:"BITXOR",CEILING:"CEILING",CHAR:"CHAR",CHOOSE:"CHOOSE",CLEAN:"CLEAN",CODE:"CODE",COLUMN:"COLUMN",COLUMNS:"COLUMNS",CONCATENATE:"CONCATENATE",CORREL:"CORREL",COS:"COS",COSH:"COSH",COT:"COT",COTH:"COTH",COUNT:"COUNT",COUNTA:"COUNTA",COUNTBLANK:"COUNTBLANK",COUNTIF:"COUNTIF",COUNTIFS:"COUNTIFS",COUNTUNIQUE:"COUNTUNIQUE",CSC:"CSC",CSCH:"CSCH",CUMIPMT:"CUMIPMT",CUMPRINC:"CUMPRINC",DATE:"DATE",DATEDIF:"DATEDIF",DATEVALUE:"DATEVALUE",DAY:"DAY",DAYS360:"DAYS360",DAYS:"DAYS",DB:"DB",DDB:"DDB",DEC2BIN:"DEC2BIN",DEC2HEX:"DEC2HEX",DEC2OCT:"DEC2OCT",DECIMAL:"DECIMAL",DEGREES:"DEGREES",DELTA:"DELTA",DOLLARDE:"DOLLARDE",DOLLARFR:"DOLLARFR",EDATE:"EDATE",EFFECT:"EFFECT",EOMONTH:"EOMONTH",ERF:"ERF",ERFC:"ERFC",EVEN:"EVEN",EXACT:"EXACT",EXP:"EXP",FALSE:"FALSE",FIND:"FIND",FORMULATEXT:"FORMULATEXT",FV:"FV",FVSCHEDULE:"FVSCHEDULE",HEX2BIN:"HEX2BIN",HEX2DEC:"HEX2DEC",HEX2OCT:"HEX2OCT",HLOOKUP:"HLOOKUP",HOUR:"HOUR",HYPERLINK:"HYPERLINK",IF:"IF",IFERROR:"IFERROR",IFNA:"IFNA",IFS:"IFS",INDEX:"INDEX",INT:"INT",INTERVAL:"INTERVAL",IPMT:"IPMT",ISBINARY:"ISBINARY",ISBLANK:"ISBLANK",ISERR:"ISERR",ISERROR:"ISERROR",ISEVEN:"ISEVEN",ISFORMULA:"ISFORMULA",ISLOGICAL:"ISLOGICAL",ISNA:"ISNA",ISNONTEXT:"ISNONTEXT",ISNUMBER:"ISNUMBER",ISODD:"ISODD",ISOWEEKNUM:"ISOWEEKNUM",ISPMT:"ISPMT",ISREF:"ISREF",ISTEXT:"ISTEXT",LEFT:"LEFT",LEN:"LEN",LN:"LN",LOG10:"LOG10",LOG:"LOG",LOWER:"LOWER",MATCH:"MATCH",MAX:"MAX",MAXA:"MAXA",MAXIFS:"MAXIFS",MAXPOOL:"MAXPOOL",MEDIAN:"MEDIAN",MEDIANPOOL:"MEDIANPOOL",MID:"MID",MIN:"MIN",MINA:"MINA",MINIFS:"MINIFS",MINUTE:"MINUTE",MIRR:"MIRR",MMULT:"MMULT",MOD:"MOD",MONTH:"MONTH",NA:"NA",NETWORKDAYS:"NETWORKDAYS","NETWORKDAYS.INTL":"NETWORKDAYS.INTL",NOMINAL:"NOMINAL",NOT:"NOT",NOW:"NOW",NPER:"NPER",NPV:"NPV",OCT2BIN:"OCT2BIN",OCT2DEC:"OCT2DEC",OCT2HEX:"OCT2HEX",ODD:"ODD",OFFSET:"OFFSET",OR:"OR",PI:"PI",PMT:"PMT",PDURATION:"PDURATION",PRODUCT:"PRODUCT",POWER:"POWER",PPMT:"PPMT",PROPER:"PROPER",PV:"PV",RADIANS:"RADIANS",RAND:"RAND",RATE:"RATE",REPLACE:"REPLACE",REPT:"REPT",RIGHT:"RIGHT",ROMAN:"ROMAN",ROUND:"ROUND",ROUNDDOWN:"ROUNDDOWN",ROUNDUP:"ROUNDUP",ROW:"ROW",ROWS:"ROWS",RRI:"RRI",SEARCH:"SEARCH",SEC:"SEC",SECH:"SECH",SECOND:"SECOND",SHEET:"SHEET",SHEETS:"SHEETS",SIN:"SIN",SINH:"SINH",SLN:"SLN",SPLIT:"SPLIT",SQRT:"SQRT",STDEVA:"STDEVA","STDEV.P":"STDEV.P",STDEVPA:"STDEVPA","STDEV.S":"STDEV.S",SUBSTITUTE:"SUBSTITUTE",SUBTOTAL:"SUBTOTAL",SUM:"SUM",SUMIF:"SUMIF",SUMIFS:"SUMIFS",SUMPRODUCT:"SUMPRODUCT",SUMSQ:"SUMSQ",SWITCH:"SWITCH",SYD:"SYD",T:"T",TAN:"TAN",TANH:"TANH",TBILLEQ:"TBILLEQ",TBILLPRICE:"TBILLPRICE",TBILLYIELD:"TBILLYIELD",TEXT:"TEXT",TIME:"TIME",TIMEVALUE:"TIMEVALUE",TODAY:"TODAY",TRANSPOSE:"TRANSPOSE",TRIM:"TRIM",TRUE:"TRUE",TRUNC:"TRUNC",UNICHAR:"UNICHAR",UNICODE:"UNICODE",UPPER:"UPPER",VARA:"VARA","VAR.P":"VAR.P",VARPA:"VARPA","VAR.S":"VAR.S",VLOOKUP:"VLOOKUP",WEEKDAY:"WEEKDAY",WEEKNUM:"WEEKNUM",WORKDAY:"WORKDAY","WORKDAY.INTL":"WORKDAY.INTL",XNPV:"XNPV",XOR:"XOR",XLOOKUP:"XLOOKUP",YEAR:"YEAR",YEARFRAC:"YEARFRAC","HF.ADD":"HF.ADD","HF.CONCAT":"HF.CONCAT","HF.DIVIDE":"HF.DIVIDE","HF.EQ":"HF.EQ","HF.GT":"HF.GT","HF.GTE":"HF.GTE","HF.LT":"HF.LT","HF.LTE":"HF.LTE","HF.MINUS":"HF.MINUS","HF.MULTIPLY":"HF.MULTIPLY","HF.NE":"HF.NE","HF.POW":"HF.POW","HF.UMINUS":"HF.UMINUS","HF.UNARY_PERCENT":"HF.UNARY_PERCENT","HF.UPLUS":"HF.UPLUS",VARP:"VARP",VAR:"VAR",STDEVP:"STDEVP",STDEV:"STDEV","EXPON.DIST":"EXPON.DIST",FISHER:"FISHER",FISHERINV:"FISHERINV",GAMMA:"GAMMA","GAMMA.DIST":"GAMMA.DIST",GAMMALN:"GAMMALN","GAMMALN.PRECISE":"GAMMALN.PRECISE","GAMMA.INV":"GAMMA.INV",GAUSS:"GAUSS",FACT:"FACT",FACTDOUBLE:"FACTDOUBLE",COMBIN:"COMBIN",COMBINA:"COMBINA",GCD:"GCD",LCM:"LCM",MROUND:"MROUND",MULTINOMIAL:"MULTINOMIAL",QUOTIENT:"QUOTIENT",RANDBETWEEN:"RANDBETWEEN",SERIESSUM:"SERIESSUM",SIGN:"SIGN",SQRTPI:"SQRTPI",SUMX2MY2:"SUMX2MY2",SUMX2PY2:"SUMX2PY2",SUMXMY2:"SUMXMY2",EXPONDIST:"EXPONDIST",GAMMADIST:"GAMMADIST",GAMMAINV:"GAMMAINV","BETA.DIST":"BETA.DIST",BETADIST:"BETADIST","BETA.INV":"BETA.INV",BETAINV:"BETAINV","BINOM.DIST":"BINOM.DIST",BINOMDIST:"BINOMDIST","BINOM.INV":"BINOM.INV",BESSELI:"BESSELI",BESSELJ:"BESSELJ",BESSELK:"BESSELK",BESSELY:"BESSELY","CHISQ.DIST":"CHISQ.DIST","CHISQ.DIST.RT":"CHISQ.DIST.RT","CHISQ.INV":"CHISQ.INV","CHISQ.INV.RT":"CHISQ.INV.RT",CHIDIST:"CHIDIST",CHIINV:"CHIINV","F.DIST":"F.DIST","F.DIST.RT":"F.DIST.RT","F.INV":"F.INV","F.INV.RT":"F.INV.RT",FDIST:"FDIST",FINV:"FINV",WEIBULL:"WEIBULL","WEIBULL.DIST":"WEIBULL.DIST",POISSON:"POISSON","POISSON.DIST":"POISSON.DIST","HYPGEOM.DIST":"HYPGEOM.DIST",HYPGEOMDIST:"HYPGEOMDIST","T.DIST":"T.DIST","T.DIST.2T":"T.DIST.2T","T.DIST.RT":"T.DIST.RT","T.INV":"T.INV","T.INV.2T":"T.INV.2T",TDIST:"TDIST",TINV:"TINV",LOGINV:"LOGINV","LOGNORM.DIST":"LOGNORM.DIST","LOGNORM.INV":"LOGNORM.INV",LOGNORMDIST:"LOGNORMDIST","NORM.DIST":"NORM.DIST","NORM.INV":"NORM.INV","NORM.S.DIST":"NORM.S.DIST","NORM.S.INV":"NORM.S.INV",NORMDIST:"NORMDIST",NORMINV:"NORMINV",NORMSDIST:"NORMSDIST",NORMSINV:"NORMSINV",PHI:"PHI","NEGBINOM.DIST":"NEGBINOM.DIST",NEGBINOMDIST:"NEGBINOMDIST",COMPLEX:"COMPLEX",IMABS:"IMABS",IMAGINARY:"IMAGINARY",IMARGUMENT:"IMARGUMENT",IMCONJUGATE:"IMCONJUGATE",IMCOS:"IMCOS",IMCOSH:"IMCOSH",IMCOT:"IMCOT",IMCSC:"IMCSC",IMCSCH:"IMCSCH",IMDIV:"IMDIV",IMEXP:"IMEXP",IMLN:"IMLN",IMLOG10:"IMLOG10",IMLOG2:"IMLOG2",IMPOWER:"IMPOWER",IMPRODUCT:"IMPRODUCT",IMREAL:"IMREAL",IMSEC:"IMSEC",IMSECH:"IMSECH",IMSIN:"IMSIN",IMSINH:"IMSINH",IMSQRT:"IMSQRT",IMSUB:"IMSUB",IMSUM:"IMSUM",IMTAN:"IMTAN",LARGE:"LARGE",SMALL:"SMALL",AVEDEV:"AVEDEV",CONFIDENCE:"CONFIDENCE","CONFIDENCE.NORM":"CONFIDENCE.NORM","CONFIDENCE.T":"CONFIDENCE.T",DEVSQ:"DEVSQ",GEOMEAN:"GEOMEAN",HARMEAN:"HARMEAN",CRITBINOM:"CRITBINOM","COVARIANCE.P":"COVARIANCE.P","COVARIANCE.S":"COVARIANCE.S",COVAR:"COVAR",PEARSON:"PEARSON",RSQ:"RSQ",STANDARDIZE:"STANDARDIZE","Z.TEST":"Z.TEST",ZTEST:"ZTEST","F.TEST":"F.TEST",FTEST:"FTEST",STEYX:"STEYX",SLOPE:"SLOPE","CHISQ.TEST":"CHISQ.TEST",CHITEST:"CHITEST","T.TEST":"T.TEST",TTEST:"TTEST",SKEW:"SKEW","SKEW.P":"SKEW.P",WEIBULLDIST:"WEIBULLDIST",VARS:"VARS",TINV2T:"TINV2T",TDISTRT:"TDISTRT",TDIST2T:"TDIST2T",STDEVS:"STDEVS",FINVRT:"FINVRT",FDISTRT:"FDISTRT",CHIDISTRT:"CHIDISTRT",CHIINVRT:"CHIINVRT",COVARIANCEP:"COVARIANCEP",COVARIANCES:"COVARIANCES",LOGNORMINV:"LOGNORMINV",POISSONDIST:"POISSONDIST",SKEWP:"SKEWP","CEILING.MATH":"CEILING.MATH",FLOOR:"FLOOR","FLOOR.MATH":"FLOOR.MATH","CEILING.PRECISE":"CEILING.PRECISE","FLOOR.PRECISE":"FLOOR.PRECISE","ISO.CEILING":"ISO.CEILING"},langCode:"enGB",ui:{NEW_SHEET_PREFIX:"Sheet"}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Jt;(function(s){s[s.FullyAbsolute=1]="FullyAbsolute",s[s.RowAbsoluteColRelative=2]="RowAbsoluteColRelative",s[s.RowRelativeColAbsolute=3]="RowRelativeColAbsolute",s[s.FullyRelative=4]="FullyRelative"})(Jt||(Jt={}));class Ml extends P{verifyAddressArguments(e,t,r,n){if(n){if(e<1||t<1)return new p(m.VALUE,T.LessThanOne)}else if(Jt.FullyAbsolute==r){if(e<1||t<1)return new p(m.VALUE,T.LessThanOne)}else if(Jt.RowAbsoluteColRelative==r){if(e<1)return new p(m.VALUE,T.LessThanOne)}else if(Jt.RowRelativeColAbsolute==r&&t<1)return new p(m.VALUE,T.LessThanOne)}address(e,t){return this.runFunction(e.args,t,this.metadata("ADDRESS"),(r,n,i,a,o)=>{const u=this.verifyAddressArguments(r,n,i,a);if(u!==void 0)return u;const l=Xs(n-1);let c="";o!=null&&(c=`${o}!`);const d=n==0?"C":`C[${n}]`,f=r==0?"R":`R[${r}]`;return Jt.FullyRelative==i?a?`${c}${l}${r}`:`${c}${f}${d}`:Jt.RowRelativeColAbsolute==i?a?`${c}$${l}${r}`:`${c}${f}C${n}`:Jt.RowAbsoluteColRelative==i?a?`${c}${l}$${r}`:`${c}R${r}${d}`:a?`${c}$${l}$${r}`:`${c}R${r}C${n}`})}}Ml.implementedFunctions={ADDRESS:{method:"address",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,defaultValue:1,minValue:1,maxValue:4},{argumentType:h.BOOLEAN,optionalArg:!0,defaultValue:!0},{argumentType:h.STRING,optionalArg:!0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class wl extends P{arrayformula(e,t){return this.runFunction(e.args,t,this.metadata("ARRAYFORMULA"),r=>r)}arrayformulaArraySize(e,t){if(e.args.length!==1)return V.error();const r=this.metadata("ARRAYFORMULA");return e.args.map(i=>{var a;return this.arraySizeForAst(i,new bt(t.formulaAddress,t.arraysFlag||((a=r?.enableArrayArithmeticForArguments)!==null&&a!==void 0?a:!1)))})[0]}arrayconstrain(e,t){return this.runFunction(e.args,t,this.metadata("ARRAY_CONSTRAIN"),(r,n,i)=>{n=Math.min(n,r.height()),i=Math.min(i,r.width());const a=r.data,o=[];for(let u=0;u<n;u++)o.push(a[u].slice(0,i));return w.onlyValues(o)})}arrayconstrainArraySize(e,t){if(e.args.length!==3)return V.error();const r=this.metadata("ARRAY_CONSTRAIN"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new bt(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))});let{height:i,width:a}=n[0];return e.args[1].type===g.NUMBER&&(i=Math.min(i,e.args[1].value)),e.args[2].type===g.NUMBER&&(a=Math.min(a,e.args[2].value)),i<1||a<1||!Number.isInteger(i)||!Number.isInteger(a)?V.error():new V(a,i)}filter(e,t){return this.runFunction(e.args,t,this.metadata("FILTER"),(r,...n)=>{for(const o of n)if(r.width()!==o.width()||r.height()!==o.height())return new p(m.NA,T.EqualLength);if(r.width()>1&&r.height()>1)return new p(m.NA,T.WrongDimension);const i=r.data,a=[];for(let o=0;o<r.height();o++){const u=[];for(let l=0;l<r.width();l++){let c=!0;for(const d of n)if(ol(d.data[o][l])!==!0){c=!1;break}c&&u.push(i[o][l])}u.length>0&&a.push(u)}return a.length>0?w.onlyValues(a):new p(m.NA,T.EmptyRange)})}filterArraySize(e,t){if(e.args.length<=1)return V.error();const r=this.metadata("FILTER"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new bt(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))}),i=Math.max(...n.map(o=>o.width)),a=Math.max(...n.map(o=>o.height));return new V(i,a)}}wl.implementedFunctions={ARRAYFORMULA:{method:"arrayformula",sizeOfResultArrayMethod:"arrayformulaArraySize",enableArrayArithmeticForArguments:!0,parameters:[{argumentType:h.ANY}]},ARRAY_CONSTRAIN:{method:"arrayconstrain",sizeOfResultArrayMethod:"arrayconstrainArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:1}],vectorizationForbidden:!0},FILTER:{method:"filter",sizeOfResultArrayMethod:"filterArraySize",enableArrayArithmeticForArguments:!0,parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class _l extends P{abs(e,t){return this.runFunction(e.args,t,this.metadata("ABS"),Math.abs)}}_l.implementedFunctions={ABS:{method:"abs",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const dT=0xffffffffffff,tu=-53,ru=53;class Ll extends P{bitlshift(e,t){return this.runFunction(e.args,t,this.metadata("BITLSHIFT"),Fl)}bitrshift(e,t){return this.runFunction(e.args,t,this.metadata("BITRSHIFT"),Ul)}}Ll.implementedFunctions={BITLSHIFT:{method:"bitlshift",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:tu,maxValue:ru}]},BITRSHIFT:{method:"bitrshift",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:tu,maxValue:ru}]}};function Fl(s,e){return e<0?Ul(s,-e):bl(s*Math.pow(2,e))}function Ul(s,e){return e<0?Fl(s,-e):bl(Math.floor(s/Math.pow(2,e)))}function bl(s){return s>dT?new p(m.NUM,T.BitshiftLong):s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class xl extends P{bitand(e,t){return this.runFunction(e.args,t,this.metadata("BITAND"),(r,n)=>r&n)}bitor(e,t){return this.runFunction(e.args,t,this.metadata("BITOR"),(r,n)=>r|n)}bitxor(e,t){return this.runFunction(e.args,t,this.metadata("BITXOR"),(r,n)=>r^n)}}xl.implementedFunctions={BITAND:{method:"bitand",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0}]},BITOR:{method:"bitor",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0}]},BITXOR:{method:"bitxor",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Pl extends P{literalTrue(e,t){return this.runFunction(e.args,t,this.metadata("TRUE"),()=>!0)}literalFalse(e,t){return this.runFunction(e.args,t,this.metadata("FALSE"),()=>!1)}conditionalIf(e,t){return this.runFunction(e.args,t,this.metadata("IF"),(r,n,i)=>r?n:i)}ifs(e,t){return this.runFunction(e.args,t,this.metadata("IFS"),(...r)=>{for(let n=0;n<r.length;n+=2)if(r[n])return r[n+1];return new p(m.NA,T.NoConditionMet)})}and(e,t){return this.runFunction(e.args,t,this.metadata("AND"),(...r)=>r.filter(n=>n!==void 0).every(n=>!!n))}or(e,t){return this.runFunction(e.args,t,this.metadata("OR"),(...r)=>r.filter(n=>n!==void 0).some(n=>n))}not(e,t){return this.runFunction(e.args,t,this.metadata("NOT"),r=>!r)}xor(e,t){return this.runFunction(e.args,t,this.metadata("XOR"),(...r)=>{let n=0;return r.filter(i=>i!==void 0).forEach(i=>{i&&n++}),n%2===1})}switch(e,t){return this.runFunction(e.args,t,this.metadata("SWITCH"),(r,...n)=>{const i=n.length;let a=0;for(;a+1<i;a+=2)if(!(n[a]instanceof p)&&this.arithmeticHelper.eq(r,n[a]))return n[a+1];return a<i?n[a]:new p(m.NA,T.NoDefault)})}iferror(e,t){return this.runFunction(e.args,t,this.metadata("IFERROR"),(r,n)=>r instanceof p?n:r)}ifna(e,t){return this.runFunction(e.args,t,this.metadata("IFNA"),(r,n)=>r instanceof p&&r.type===m.NA?n:r)}choose(e,t){return this.runFunction(e.args,t,this.metadata("CHOOSE"),(r,...n)=>r>n.length?new p(m.NUM,T.Selector):n[r-1])}}Pl.implementedFunctions={TRUE:{method:"literalTrue",parameters:[]},FALSE:{method:"literalFalse",parameters:[]},IF:{method:"conditionalIf",parameters:[{argumentType:h.BOOLEAN},{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,defaultValue:!1,passSubtype:!0}]},IFS:{method:"ifs",parameters:[{argumentType:h.BOOLEAN},{argumentType:h.SCALAR,passSubtype:!0}],repeatLastArgs:2},AND:{method:"and",parameters:[{argumentType:h.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},OR:{method:"or",parameters:[{argumentType:h.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},XOR:{method:"xor",parameters:[{argumentType:h.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},NOT:{method:"not",parameters:[{argumentType:h.BOOLEAN}]},SWITCH:{method:"switch",parameters:[{argumentType:h.NOERROR},{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,passSubtype:!0}],repeatLastArgs:1},IFERROR:{method:"iferror",parameters:[{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,passSubtype:!0}]},IFNA:{method:"ifna",parameters:[{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,passSubtype:!0}]},CHOOSE:{method:"choose",parameters:[{argumentType:h.INTEGER,minValue:1},{argumentType:h.SCALAR,passSubtype:!0}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Vl extends P{char(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),r=>r<1||r>=256?new p(m.VALUE,T.CharacterCodeBounds):String.fromCharCode(Math.trunc(r)))}unichar(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),r=>r<1||r>=1114112?new p(m.VALUE,T.CharacterCodeBounds):String.fromCodePoint(Math.trunc(r)))}}Vl.implementedFunctions={CHAR:{method:"char",parameters:[{argumentType:h.NUMBER}]},UNICHAR:{method:"unichar",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Dl extends P{code(e,t){return this.runFunction(e.args,t,this.metadata("CODE"),r=>r.length===0?new p(m.VALUE,T.EmptyString):r.charCodeAt(0))}unicode(e,t){return this.runFunction(e.args,t,this.metadata("UNICODE"),r=>{var n;return(n=r.codePointAt(0))!==null&&n!==void 0?n:new p(m.VALUE,T.EmptyString)})}}Dl.implementedFunctions={CODE:{method:"code",parameters:[{argumentType:h.STRING}]},UNICODE:{method:"unicode",parameters:[{argumentType:h.STRING}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Bl extends P{countblank(e,t){return this.runFunction(e.args,t,this.metadata("COUNTBLANK"),(...r)=>{let n=0;return r.forEach(i=>{i===B&&n++}),n})}}Bl.implementedFunctions={COUNTBLANK:{method:"countblank",parameters:[{argumentType:h.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class kl extends P{countunique(e,t){return this.runFunction(e.args,t,this.metadata("COUNTUNIQUE"),(...r)=>{const n=new Set,i=new Set;for(const a of r)a instanceof p?i.add(a.type):a!==""&&n.add(a);return n.size+i.size})}}kl.implementedFunctions={COUNTUNIQUE:{method:"countunique",parameters:[{argumentType:h.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Gl extends P{constructor(){super(...arguments),this.isoweeknumCore=e=>{const t=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),r=this.dateTimeHelper.numberToSimpleDate(e),n=this.dateTimeHelper.dateToNumber({year:r.year,month:1,day:1}),i=this.dateTimeHelper.relativeNumberToAbsoluteNumber(n),a=i+((4-i)%7+7)%7,o=Math.floor((t-1)/7)-Math.floor((a-1)/7)+1;return o===0?this.isoweeknumCore(e-7)+1:o},this.days360Core=(e,t,r)=>{const n=this.dateTimeHelper.numberToSimpleDate(e),i=this.dateTimeHelper.numberToSimpleDate(t);let a,o;return r?(a=Wo(n),o=Wo(i)):[a,o]=this.dateTimeHelper.toBasisUS(n,i),360*(o.year-a.year)+30*(o.month-a.month)+o.day-a.day}}date(e,t){return this.runFunction(e.args,t,this.metadata("DATE"),(r,n,i)=>{const a=Math.trunc(i);let o=Math.trunc(n),u=Math.trunc(r);u<this.dateTimeHelper.getEpochYearZero()&&(u+=this.dateTimeHelper.getEpochYearZero());const l=Math.floor((o-1)/12);u+=l,o-=l*12;const c={year:u,month:o,day:1};if(this.dateTimeHelper.isValidDate(c)){let d=this.dateTimeHelper.dateToNumber(c)+(a-1);return d=this.dateTimeHelper.getWithinBounds(d),d===void 0?new p(m.NUM,T.DateBounds):d}return new p(m.VALUE,T.InvalidDate)})}time(e,t){return this.runFunction(e.args,t,this.metadata("TIME"),(r,n,i)=>{const a=Kr({hours:Math.trunc(r),minutes:Math.trunc(n),seconds:Math.trunc(i)});return a<0?new p(m.NUM,T.NegativeTime):a%1})}eomonth(e,t){return this.runFunction(e.args,t,this.metadata("EOMONTH"),(r,n)=>{const i=this.dateTimeHelper.numberToSimpleDate(r);let a=this.dateTimeHelper.dateToNumber(this.dateTimeHelper.endOfMonth(Ho(i,n)));return a=this.dateTimeHelper.getWithinBounds(a),a===void 0?new p(m.NUM,T.DateBounds):a})}day(e,t){return this.runFunction(e.args,t,this.metadata("DAY"),r=>this.dateTimeHelper.numberToSimpleDate(r).day)}days(e,t){return this.runFunction(e.args,t,this.metadata("DAYS"),(r,n)=>Math.trunc(r)-Math.trunc(n))}month(e,t){return this.runFunction(e.args,t,this.metadata("MONTH"),r=>this.dateTimeHelper.numberToSimpleDate(r).month)}year(e,t){return this.runFunction(e.args,t,this.metadata("YEAR"),r=>this.dateTimeHelper.numberToSimpleDate(r).year)}hour(e,t){return this.runFunction(e.args,t,this.metadata("HOUR"),r=>$r(yi(r)%1).hours)}minute(e,t){return this.runFunction(e.args,t,this.metadata("MINUTE"),r=>$r(yi(r)%1).minutes)}second(e,t){return this.runFunction(e.args,t,this.metadata("SECOND"),r=>$r(yi(r)%1).seconds)}text(e,t){return this.runFunction(e.args,t,this.metadata("TEXT"),(r,n)=>ZE(r,n,this.config,this.dateTimeHelper))}weekday(e,t){return this.runFunction(e.args,t,this.metadata("WEEKDAY"),(r,n)=>{const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(r));if(n===3)return(i-1)%7;const a=iu.get(n);return a===void 0?new p(m.NUM,T.BadMode):(i-a)%7+1})}weeknum(e,t){return this.runFunction(e.args,t,this.metadata("WEEKNUM"),(r,n)=>{const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(r)),a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.dateToNumber({year:a.year,month:1,day:1}),u=this.dateTimeHelper.relativeNumberToAbsoluteNumber(o);if(n===21)return this.isoweeknumCore(r);const l=iu.get(n);return l===void 0?new p(m.NUM,T.BadMode):Math.floor((i-l)/7)-Math.floor((u-l)/7)+1})}isoweeknum(e,t){return this.runFunction(e.args,t,this.metadata("ISOWEEKNUM"),this.isoweeknumCore)}datevalue(e,t){return this.runFunction(e.args,t,this.metadata("DATEVALUE"),r=>{const{dateTime:n}=this.dateTimeHelper.parseDateTimeFromConfigFormats(r);return n===void 0?new p(m.VALUE,T.IncorrectDateTime):Rn(n)?(fl(n)?Math.trunc(Kr(n)):0)+this.dateTimeHelper.dateToNumber(n):0})}timevalue(e,t){return this.runFunction(e.args,t,this.metadata("TIMEVALUE"),r=>{const n=this.dateTimeHelper.dateStringToDateNumber(r);return n===void 0?new p(m.VALUE,T.IncorrectDateTime):I(n)%1})}now(e,t){return this.runFunction(e.args,t,this.metadata("NOW"),()=>{const r=new Date(Date.now());return Kr({hours:r.getHours(),minutes:r.getMinutes(),seconds:r.getSeconds()})+this.dateTimeHelper.dateToNumber({year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()})})}today(e,t){return this.runFunction(e.args,t,this.metadata("TODAY"),()=>{const r=new Date(Date.now());return this.dateTimeHelper.dateToNumber({year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()})})}edate(e,t){return this.runFunction(e.args,t,this.metadata("EDATE"),(r,n)=>{const i=this.dateTimeHelper.numberToSimpleDate(r),a=XE(Ho(i,n));let o=this.dateTimeHelper.dateToNumber(a);return o=this.dateTimeHelper.getWithinBounds(o),o===void 0?new p(m.NUM,T.DateBounds):o})}datedif(e,t){return this.runFunction(e.args,t,this.metadata("DATEDIF"),(r,n,i)=>{if(r>n)return new p(m.NUM,T.StartEndDate);if(i==="D")return Math.floor(n)-Math.floor(r);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);switch(i){case"M":return(o.year-a.year)*12+(o.month-a.month)-(o.day<a.day?1:0);case"YM":return(12+(o.month-a.month)-(o.day<a.day?1:0))%12;case"Y":return o.month>a.month||o.month===a.month&&o.day>=a.day?o.year-a.year:o.year-a.year-1;case"MD":if(o.day>=a.day)return o.day-a.day;{const u=o.month===1?12:o.month-1,l=o.month===1?o.year-1:o.year;return this.dateTimeHelper.daysInMonth(l,u)+o.day-a.day}case"YD":return o.month>a.month||o.month===a.month&&o.day>=a.day?Math.floor(n)-this.dateTimeHelper.dateToNumber({year:o.year,month:a.month,day:a.day}):Math.floor(n)-Math.floor(r)-365*(o.year-a.year-1)-this.dateTimeHelper.leapYearsCount(o.year-1)+this.dateTimeHelper.leapYearsCount(a.year);default:return new p(m.NUM,T.BadMode)}})}days360(e,t){return this.runFunction(e.args,t,this.metadata("DAYS360"),this.days360Core)}yearfrac(e,t){return this.runFunction(e.args,t,this.metadata("YEARFRAC"),(r,n,i)=>{switch(r=Math.trunc(r),n=Math.trunc(n),r>n&&([r,n]=[n,r]),i){case 0:return this.days360Core(r,n,!1)/360;case 1:return(n-r)/this.dateTimeHelper.yearLengthForBasis(this.dateTimeHelper.numberToSimpleDate(r),this.dateTimeHelper.numberToSimpleDate(n));case 2:return(n-r)/360;case 3:return(n-r)/365;case 4:return this.days360Core(r,n,!0)/360}throw new Error("Should not be reachable.")})}interval(e,t){return this.runFunction(e.args,t,this.metadata("INTERVAL"),r=>{r=Math.trunc(r);const n=r%60;r=Math.trunc(r/60);const i=r%60;r=Math.trunc(r/60);const a=r%24;r=Math.trunc(r/24);const o=r%30;r=Math.trunc(r/30);const u=r%12,l=Math.trunc(r/12);return"P"+(l>0?`${l}Y`:"")+(u>0?`${u}M`:"")+(o>0?`${o}D`:"")+"T"+(a>0?`${a}H`:"")+(i>0?`${i}M`:"")+(n>0?`${n}S`:"")})}networkdays(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS"),(r,n,i)=>this.networkdayscore(r,n,1,i))}networkdaysintl(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS.INTL"),(r,n,i,a)=>this.networkdayscore(r,n,i,a))}workday(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY"),(r,n,i)=>this.workdaycore(r,n,1,i))}workdayintl(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY.INTL"),(r,n,i,a)=>this.workdaycore(r,n,i,a))}networkdayscore(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t);let i=1;e>t&&([e,t]=[t,e],i=-1);const a=su(r);if(a instanceof p)return a;const o=this.simpleRangeToFilteredHolidays(a,n);return o instanceof p?o:i*this.countWorkdays(e,t,a,o)}workdaycore(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t);const i=su(r);if(i instanceof p)return i;const a=this.simpleRangeToFilteredHolidays(i,n);if(a instanceof p)return a;if(t>0){let o=1;for(;this.countWorkdays(e+1,e+o,i,a)<t;)o*=2;let u=1;for(;u+1<o;){const l=Math.trunc((u+o)/2);this.countWorkdays(e+1,e+l,i,a)<t?u=l:o=l}return e+o}else if(t<0){t*=-1;let o=1;for(;this.countWorkdays(e-o,e-1,i,a)<t;)o*=2;let u=1;for(;u+1<o;){const l=Math.trunc((u+o)/2);this.countWorkdays(e-l,e-1,i,a)<t?u=l:o=l}return e-o}else return e}countWorkdays(e,t,r,n){const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(t)),a=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e));let o=0;for(let u=0;u<7;u++)r.charAt(u)==="0"&&(o+=Math.floor((i+6-u)/7),o-=Math.floor((a-1+6-u)/7));return o-=nu(t+1,n)-nu(e,n),o}simpleRangeToFilteredHolidays(e,t){var r;const n=(r=t?.valuesFromTopLeftCorner())!==null&&r!==void 0?r:[];for(const a of n)if(a instanceof p)return a;const i=[];for(const a of n)if(a!==B)if(z(a))i.push(Math.trunc(I(a)));else return new p(m.VALUE,T.WrongType);return[...new Set(i)].sort((a,o)=>a-o).filter(a=>{const u=(this.dateTimeHelper.relativeNumberToAbsoluteNumber(a)-1)%7;return e.charAt(u)==="0"})}}Gl.implementedFunctions={DATE:{method:"date",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_DATE},TIME:{method:"time",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_TIME},MONTH:{method:"month",parameters:[{argumentType:h.NUMBER,minValue:0}]},YEAR:{method:"year",parameters:[{argumentType:h.NUMBER,minValue:0}]},HOUR:{method:"hour",parameters:[{argumentType:h.NUMBER,minValue:0}]},MINUTE:{method:"minute",parameters:[{argumentType:h.NUMBER,minValue:0}]},SECOND:{method:"second",parameters:[{argumentType:h.NUMBER,minValue:0}]},TEXT:{method:"text",parameters:[{argumentType:h.NUMBER},{argumentType:h.STRING}]},EOMONTH:{method:"eomonth",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_DATE},DAY:{method:"day",parameters:[{argumentType:h.NUMBER,minValue:0}]},DAYS:{method:"days",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0}]},WEEKDAY:{method:"weekday",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,defaultValue:1}]},WEEKNUM:{method:"weeknum",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,defaultValue:1}]},ISOWEEKNUM:{method:"isoweeknum",parameters:[{argumentType:h.NUMBER,minValue:0}]},DATEVALUE:{method:"datevalue",parameters:[{argumentType:h.STRING}],returnNumberType:L.NUMBER_DATE},TIMEVALUE:{method:"timevalue",parameters:[{argumentType:h.STRING}],returnNumberType:L.NUMBER_TIME},NOW:{method:"now",parameters:[],isVolatile:!0,returnNumberType:L.NUMBER_DATETIME},TODAY:{method:"today",parameters:[],isVolatile:!0,returnNumberType:L.NUMBER_DATE},EDATE:{method:"edate",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_DATE},DAYS360:{method:"days360",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.BOOLEAN,defaultValue:!1}]},DATEDIF:{method:"datedif",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.STRING}]},YEARFRAC:{method:"yearfrac",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.INTEGER,defaultValue:0,minValue:0,maxValue:4}]},INTERVAL:{method:"interval",parameters:[{argumentType:h.NUMBER,minValue:0}]},NETWORKDAYS:{method:"networkdays",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.RANGE,optionalArg:!0}]},"NETWORKDAYS.INTL":{method:"networkdaysintl",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NOERROR,defaultValue:1},{argumentType:h.RANGE,optionalArg:!0}]},WORKDAY:{method:"workday",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER},{argumentType:h.RANGE,optionalArg:!0}]},"WORKDAY.INTL":{method:"workdayintl",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER},{argumentType:h.NOERROR,defaultValue:1},{argumentType:h.RANGE,optionalArg:!0}]}};function nu(s,e){if(e.length===0||s<=e[0])return 0;if(e[e.length-1]<s)return e.length;let t=0,r=e.length-1;for(;t+1<r;){const n=Math.floor((r+t)/2);e[n]>=s?r=n:t=n}return r}function su(s){var e;return typeof s!="number"&&typeof s!="string"?new p(m.VALUE,T.WrongType):typeof s=="string"?s.length!==7||!/^(0|1)*$/.test(s)||s==="1111111"?new p(m.NUM,T.WeekendString):s:(e=pT.get(s))!==null&&e!==void 0?e:new p(m.NUM,T.BadMode)}const iu=new Map([[1,0],[2,1],[11,1],[12,2],[13,3],[14,4],[15,5],[16,6],[17,0]]),pT=new Map([[1,"0000011"],[2,"1000001"],[3,"1100000"],[4,"0110000"],[5,"0011000"],[6,"0001100"],[7,"0000110"],[11,"0000001"],[12,"1000000"],[13,"0100000"],[14,"0010000"],[15,"0001000"],[16,"0000100"],[17,"0000010"]]);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Hl extends P{degrees(e,t){return this.runFunction(e.args,t,this.metadata("DEGREES"),r=>r*(180/Math.PI))}}Hl.implementedFunctions={DEGREES:{method:"degrees",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Wl extends P{delta(e,t){return this.runFunction(e.args,t,this.metadata("DELTA"),(r,n)=>r===n?1:0)}}Wl.implementedFunctions={DELTA:{method:"delta",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Yl extends P{exp(e,t){return this.runFunction(e.args,t,this.metadata("EXP"),Math.exp)}}Yl.implementedFunctions={EXP:{method:"exp",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class zl extends P{pmt(e,t){return this.runFunction(e.args,t,this.metadata("PMT"),Ba)}ipmt(e,t){return this.runFunction(e.args,t,this.metadata("IPMT"),sa)}ppmt(e,t){return this.runFunction(e.args,t,this.metadata("PPMT"),au)}fv(e,t){return this.runFunction(e.args,t,this.metadata("FV"),ia)}cumipmt(e,t){return this.runFunction(e.args,t,this.metadata("CUMIPMT"),(r,n,i,a,o,u)=>{if(a>o)return new p(m.NUM,T.EndStartPeriod);let l=0;for(let c=a;c<=o;c++)l+=sa(r,c,n,i,0,u);return l})}cumprinc(e,t){return this.runFunction(e.args,t,this.metadata("CUMPRINC"),(r,n,i,a,o,u)=>{if(a>o)return new p(m.NUM,T.EndStartPeriod);let l=0;for(let c=a;c<=o;c++)l+=au(r,c,n,i,0,u);return l})}db(e,t){return this.runFunction(e.args,t,this.metadata("DB"),(r,n,i,a,o)=>{if(o===12&&a>i||a>i+1)return new p(m.NUM,T.PeriodLong);if(n>=r)return 0;const u=Math.round((1-Math.pow(n/r,1/i))*1e3)/1e3,l=r*u*o/12;if(a===1)return l;let c=l;for(let d=0;d<a-2;d++)c+=(r-c)*u;return a===i+1?(r-c)*u*(12-o)/12:(r-c)*u})}ddb(e,t){return this.runFunction(e.args,t,this.metadata("DDB"),(r,n,i,a,o)=>{if(a>i)return new p(m.NUM);let u=o/i,l;u>=1?(u=1,a===1?l=r:l=0):l=r*Math.pow(1-u,a-1);const c=r*Math.pow(1-u,a);return Math.max(l-Math.max(n,c),0)})}dollarde(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARDE"),(r,n)=>{if(n<1)return new p(m.DIV_BY_ZERO);for(n=Math.trunc(n);n>10;)n/=10;return Math.trunc(r)+(r-Math.trunc(r))*10/n})}dollarfr(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARFR"),(r,n)=>{if(n<1)return new p(m.DIV_BY_ZERO);for(n=Math.trunc(n);n>10;)n/=10;return Math.trunc(r)+(r-Math.trunc(r))*n/10})}effect(e,t){return this.runFunction(e.args,t,this.metadata("EFFECT"),(r,n)=>(n=Math.trunc(n),Math.pow(1+r/n,n)-1))}ispmt(e,t){return this.runFunction(e.args,t,this.metadata("ISPMT"),(r,n,i,a)=>i===0?new p(m.DIV_BY_ZERO):a*r*(n/i-1))}nominal(e,t){return this.runFunction(e.args,t,this.metadata("NOMINAL"),(r,n)=>(n=Math.trunc(n),(Math.pow(r+1,1/n)-1)*n))}nper(e,t){return this.runFunction(e.args,t,this.metadata("NPER"),(r,n,i,a,o)=>r===0?n===0?new p(m.DIV_BY_ZERO):(-i-a)/n:(o&&(n*=1+r),Math.log((n-a*r)/(i*r+n))/Math.log(1+r)))}rate(e,t){return this.runFunction(e.args,t,this.metadata("RATE"),(r,n,i,a,o,u)=>{if(u<=-1)return new p(m.VALUE);const l=1e-7,c=50;let d=u;o=o?1:0;for(let f=0;f<c;f++){if(d<=-1)return new p(m.NUM);let E;if(Math.abs(d)<l)E=i*(1+r*d)+n*(1+d*o)*r+a;else{const R=Math.pow(1+d,r);E=i*R+n*(1/d+o)*(R-1)+a}if(Math.abs(E)<l)return d;let N;if(Math.abs(d)<l)N=i*r+n*o*r;else{const R=Math.pow(1+d,r),A=r*Math.pow(1+d,r-1);N=i*A+n*(1/d+o)*A+n*(-1/(d*d))*(R-1)}d-=E/N}return new p(m.NUM)})}pv(e,t){return this.runFunction(e.args,t,this.metadata("PV"),(r,n,i,a,o)=>(o=o?1:0,r===-1?n===0?new p(m.NUM):new p(m.DIV_BY_ZERO):r===0?-i*n-a:((1-Math.pow(1+r,n))*i*(1+r*o)/r-a)/Math.pow(1+r,n)))}rri(e,t){return this.runFunction(e.args,t,this.metadata("RRI"),(r,n,i)=>n===0||i<0&&n>0||i>0&&n<0?new p(m.NUM):Math.pow(i/n,1/r)-1)}sln(e,t){return this.runFunction(e.args,t,this.metadata("SLN"),(r,n,i)=>i===0?new p(m.DIV_BY_ZERO):(r-n)/i)}syd(e,t){return this.runFunction(e.args,t,this.metadata("SYD"),(r,n,i,a)=>a>i?new p(m.NUM):(r-n)*(i-a+1)*2/(i*(i+1)))}tbilleq(e,t){return this.runFunction(e.args,t,this.metadata("TBILLEQ"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new p(m.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);if(o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day))return new p(m.NUM);const u=360-i*(n-r);return u===0?0:u<0?new p(m.NUM):365*i/u})}tbillprice(e,t){return this.runFunction(e.args,t,this.metadata("TBILLPRICE"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new p(m.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);if(o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day))return new p(m.NUM);const u=360-i*(n-r);return u===0?0:u<0?new p(m.NUM):100*(1-i*(n-r)/360)})}tbillyield(e,t){return this.runFunction(e.args,t,this.metadata("TBILLYIELD"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new p(m.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);return o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day)?new p(m.NUM):(100-i)*360/(i*(n-r))})}fvschedule(e,t){return this.runFunction(e.args,t,this.metadata("FVSCHEDULE"),(r,n)=>{const i=n.valuesFromTopLeftCorner();for(const a of i)if(a instanceof p)return a;for(const a of i)if(z(a))r*=1+I(a);else if(a!==B)return new p(m.VALUE,T.NumberExpected);return r})}npv(e,t){return this.runFunction(e.args,t,this.metadata("NPV"),(r,...n)=>{const i=this.arithmeticHelper.coerceNumbersExactRanges(n);return i instanceof p?i:Ii(r,i)})}mirr(e,t){return this.runFunction(e.args,t,this.metadata("MIRR"),(r,n,i)=>{const a=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());if(a instanceof p)return a;let o=!1,u=!1;const l=[],c=[];for(const N of a)N>0?(o=!0,l.push(N),c.push(0)):N<0?(u=!0,c.push(N),l.push(0)):(c.push(0),l.push(0));if(!o||!u)return new p(m.DIV_BY_ZERO);const d=a.length,f=Ii(i,l);if(f instanceof p)return f;const E=Ii(n,c);return E instanceof p?E:Math.pow(-f*Math.pow(1+i,d)/E/(1+n),1/(d-1))-1})}pduration(e,t){return this.runFunction(e.args,t,this.metadata("PDURATION"),(r,n,i)=>(Math.log(i)-Math.log(n))/Math.log(1+r))}xnpv(e,t){return this.runFunction(e.args,t,this.metadata("XNPV"),(r,n,i)=>{const a=n.valuesFromTopLeftCorner();for(const f of a)if(typeof f!="number")return new p(m.VALUE,T.NumberExpected);const o=a,u=i.valuesFromTopLeftCorner();for(const f of u)if(typeof f!="number")return new p(m.VALUE,T.NumberExpected);const l=u;if(l.length!==o.length)return new p(m.NUM,T.EqualLength);const c=l.length;let d=0;if(l[0]<0)return new p(m.NUM,T.ValueSmall);for(let f=0;f<c;f++){if(l[f]=Math.floor(l[f]),l[f]<l[0])return new p(m.NUM,T.ValueSmall);d+=o[f]/Math.pow(1+r,(l[f]-l[0])/365)}return d})}}zl.implementedFunctions={PMT:{method:"pmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:L.NUMBER_CURRENCY},IPMT:{method:"ipmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:L.NUMBER_CURRENCY},PPMT:{method:"ppmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:L.NUMBER_CURRENCY},FV:{method:"fv",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:L.NUMBER_CURRENCY},CUMIPMT:{method:"cumipmt",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:0,maxValue:1}],returnNumberType:L.NUMBER_CURRENCY},CUMPRINC:{method:"cumprinc",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:0,maxValue:1}],returnNumberType:L.NUMBER_CURRENCY},DB:{method:"db",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:1,maxValue:12,defaultValue:12}],returnNumberType:L.NUMBER_CURRENCY},DDB:{method:"ddb",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.INTEGER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0,defaultValue:2}],returnNumberType:L.NUMBER_CURRENCY},DOLLARDE:{method:"dollarde",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},DOLLARFR:{method:"dollarfr",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},EFFECT:{method:"effect",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1}],returnNumberType:L.NUMBER_PERCENT},ISPMT:{method:"ispmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},NOMINAL:{method:"nominal",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1}],returnNumberType:L.NUMBER_PERCENT},NPER:{method:"nper",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}]},PV:{method:"pv",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:L.NUMBER_CURRENCY},RATE:{method:"rate",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:.1}],returnNumberType:L.NUMBER_PERCENT},RRI:{method:"rri",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_PERCENT},SLN:{method:"sln",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_CURRENCY},SYD:{method:"syd",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:L.NUMBER_CURRENCY},TBILLEQ:{method:"tbilleq",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:L.NUMBER_PERCENT},TBILLPRICE:{method:"tbillprice",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:L.NUMBER_CURRENCY},TBILLYIELD:{method:"tbillyield",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:L.NUMBER_PERCENT},FVSCHEDULE:{method:"fvschedule",parameters:[{argumentType:h.NUMBER},{argumentType:h.RANGE}],returnNumberType:L.NUMBER_CURRENCY},NPV:{method:"npv",parameters:[{argumentType:h.NUMBER},{argumentType:h.ANY}],repeatLastArgs:1,returnNumberType:L.NUMBER_CURRENCY},MIRR:{method:"mirr",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_PERCENT},PDURATION:{method:"pduration",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0}]},XNPV:{method:"xnpv",parameters:[{argumentType:h.NUMBER,greaterThan:-1},{argumentType:h.RANGE},{argumentType:h.RANGE}]}};function Ba(s,e,t,r,n){if(s===0)return(-t-r)/e;{const i=Math.pow(1+s,e);return(r*s+t*s*i)*(n?1/(1+s):1)/(1-i)}}function sa(s,e,t,r,n,i){const a=Ba(s,t,r,n,i);return e===1?s*(i?0:-r):s*(i?ia(s,e-2,a,r,i)-a:ia(s,e-1,a,r,i))}function ia(s,e,t,r,n){if(s===0)return-r-t*e;{const i=Math.pow(1+s,e);return t*(n?1+s:1)*(1-i)/s-r*i}}function au(s,e,t,r,n,i){return Ba(s,t,r,n,i)-sa(s,e,t,r,n,i)}function Ii(s,e){let t=0;for(let r=e.length-1;r>=0;r--){if(t+=e[r],s===-1){if(t===0)continue;return new p(m.DIV_BY_ZERO)}t/=1+s}return t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Xl extends P{formulatext(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("FORMULATEXT"),()=>new p(m.NA,T.WrongArgNumber),r=>{var n;return(n=this.serialization.getCellFormula(r))!==null&&n!==void 0?n:new p(m.NA,T.Formula)})}}Xl.implementedFunctions={FORMULATEXT:{method:"formulatext",parameters:[{argumentType:h.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,isDependentOnSheetStructureChange:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class $l extends P{hyperlink(e,t){return this.runFunction(e.args,t,this.metadata("HYPERLINK"),(r,n)=>(e.hyperlink=r,n??r))}}$l.implementedFunctions={HYPERLINK:{method:"hyperlink",parameters:[{argumentType:h.STRING},{argumentType:h.STRING,optionalArg:!0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Kl extends P{isbinary(e,t){return this.runFunction(e.args,t,this.metadata("ISBINARY"),r=>/^[01]{1,10}$/.test(r))}iserr(e,t){return this.runFunction(e.args,t,this.metadata("ISERR"),r=>r instanceof p&&r.type!==m.NA)}iserror(e,t){return this.runFunction(e.args,t,this.metadata("ISERROR"),r=>r instanceof p)}isformula(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ISFORMULA"),()=>new p(m.NA,T.WrongArgNumber),r=>this.dependencyGraph.addressMapping.getCell(r)instanceof tt)}isblank(e,t){return this.runFunction(e.args,t,this.metadata("ISBLANK"),r=>r===B)}isna(e,t){return this.runFunction(e.args,t,this.metadata("ISNA"),r=>r instanceof p&&r.type==m.NA)}isnumber(e,t){return this.runFunction(e.args,t,this.metadata("ISNUMBER"),z)}islogical(e,t){return this.runFunction(e.args,t,this.metadata("ISLOGICAL"),r=>typeof r=="boolean")}isref(e,t){return this.runFunction(e.args,t,this.metadata("ISREF"),r=>r instanceof p&&(r.type==m.REF||r.type==m.CYCLE))}istext(e,t){return this.runFunction(e.args,t,this.metadata("ISTEXT"),r=>typeof r=="string")}isnontext(e,t){return this.runFunction(e.args,t,this.metadata("ISNONTEXT"),r=>typeof r!="string")}column(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("COLUMN"),()=>t.formulaAddress.col+1,r=>r.col+1)}columns(e,t){if(e.args.length!==1)return new p(m.NA,T.WrongArgNumber);if(e.args.some(n=>n.type===g.EMPTY))return new p(m.NUM,T.EmptyArg);let r=e.args[0];for(;r.type===g.PARENTHESIS;)r=r.expression;if(r.type===g.CELL_RANGE||r.type===g.COLUMN_RANGE)return r.end.col-r.start.col+1;if(r.type===g.CELL_REFERENCE)return 1;if(r.type===g.ROW_RANGE)return this.config.maxColumns;{const n=this.evaluateAst(r,t);return n instanceof w?n.width():n instanceof p?n:1}}row(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ROW"),()=>t.formulaAddress.row+1,r=>r.row+1)}rows(e,t){if(e.args.length!==1)return new p(m.NA,T.WrongArgNumber);if(e.args.some(n=>n.type===g.EMPTY))return new p(m.NUM,T.EmptyArg);let r=e.args[0];for(;r.type===g.PARENTHESIS;)r=r.expression;if(r.type===g.CELL_RANGE||r.type===g.ROW_RANGE)return r.end.row-r.start.row+1;if(r.type===g.CELL_REFERENCE)return 1;if(r.type===g.COLUMN_RANGE)return this.config.maxRows;{const n=this.evaluateAst(r,t);return n instanceof w?n.height():n instanceof p?n:1}}index(e,t){return this.runFunction(e.args,t,this.metadata("INDEX"),(r,n,i)=>{var a,o,u,l,c,d;return i<1||n<1?new p(m.VALUE,T.LessThanOne):i>r.width()||n>r.height()?new p(m.NUM,T.ValueLarge):(d=(u=(o=(a=r?.data)===null||a===void 0?void 0:a[n-1])===null||o===void 0?void 0:o[i-1])!==null&&u!==void 0?u:(c=(l=r?.data)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c[0])!==null&&d!==void 0?d:new p(m.VALUE,T.CellRangeExpected)})}na(e,t){return new p(m.NA)}sheet(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEET"),()=>t.formulaAddress.sheet+1,r=>r.sheet+1,r=>{const n=this.dependencyGraph.sheetMapping.get(r);return n!==void 0?n+1:new p(m.NA,T.SheetRef)})}sheets(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEETS"),()=>this.dependencyGraph.sheetMapping.numberOfSheets(),()=>1,()=>new p(m.VALUE,T.CellRefExpected))}}Kl.implementedFunctions={COLUMN:{method:"column",parameters:[{argumentType:h.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},COLUMNS:{method:"columns",parameters:[{argumentType:h.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISBINARY:{method:"isbinary",parameters:[{argumentType:h.STRING}]},ISERR:{method:"iserr",parameters:[{argumentType:h.SCALAR}]},ISFORMULA:{method:"isformula",parameters:[{argumentType:h.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISNA:{method:"isna",parameters:[{argumentType:h.SCALAR}]},ISREF:{method:"isref",parameters:[{argumentType:h.SCALAR}],vectorizationForbidden:!0},ISERROR:{method:"iserror",parameters:[{argumentType:h.SCALAR}]},ISBLANK:{method:"isblank",parameters:[{argumentType:h.SCALAR}]},ISNUMBER:{method:"isnumber",parameters:[{argumentType:h.SCALAR}]},ISLOGICAL:{method:"islogical",parameters:[{argumentType:h.SCALAR}]},ISTEXT:{method:"istext",parameters:[{argumentType:h.SCALAR}]},ISNONTEXT:{method:"isnontext",parameters:[{argumentType:h.SCALAR}]},INDEX:{method:"index",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1}]},NA:{method:"na",parameters:[]},ROW:{method:"row",parameters:[{argumentType:h.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ROWS:{method:"rows",parameters:[{argumentType:h.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEET:{method:"sheet",parameters:[{argumentType:h.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEETS:{method:"sheets",parameters:[{argumentType:h.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class jl extends P{iseven(e,t){return this.runFunction(e.args,t,this.metadata("ISEVEN"),r=>r%2===0)}}jl.implementedFunctions={ISEVEN:{method:"iseven",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ql extends P{isodd(e,t){return this.runFunction(e.args,t,this.metadata("ISODD"),r=>r%2===1)}}ql.implementedFunctions={ISODD:{method:"isodd",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ql extends P{log10(e,t){return this.runFunction(e.args,t,this.metadata("LOG10"),Math.log10)}log(e,t){return this.runFunction(e.args,t,this.metadata("LOG"),(r,n)=>Math.log(r)/Math.log(n))}ln(e,t){return this.runFunction(e.args,t,this.metadata("LN"),Math.log)}}Ql.implementedFunctions={LOG10:{method:"log10",parameters:[{argumentType:h.NUMBER}]},LOG:{method:"log",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,defaultValue:10,greaterThan:0}]},LN:{method:"ln",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const aa=parseFloat(Math.PI.toFixed(14));class Zl extends P{pi(e,t){return this.runFunction(e.args,t,this.metadata("PI"),()=>aa)}sqrtpi(e,t){return this.runFunction(e.args,t,this.metadata("SQRTPI"),r=>Math.sqrt(aa*r))}}Zl.implementedFunctions={PI:{method:"pi",parameters:[]},SQRTPI:{method:"sqrtpi",parameters:[{argumentType:h.NUMBER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function ou(s,e){return new V(e.width,s.height)}function Oi(s,e,t){return new V(1+(s.width-e)/t,1+(s.height-e)/t)}class Jl extends P{mmult(e,t){return this.runFunction(e.args,t,this.metadata("MMULT"),(r,n)=>{if(!r.hasOnlyNumbers()||!n.hasOnlyNumbers())return new p(m.VALUE,T.NumberRange);if(n.height()!==r.width())return new p(m.VALUE,T.ArrayDimensions);const i=ou(r.size,n.size),a=this.createKernel(function(o,u,l){let c=0;for(let d=0;d<l;++d)c+=o[this.thread.y][d]*u[d][this.thread.x];return c},i)(r.rawNumbers(),n.rawNumbers(),r.width());return w.onlyNumbers(a)})}mmultArraySize(e,t){if(e.args.length!==2)return V.error();const r=this.metadata("MMULT"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new bt(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))}),[i,a]=n;return ou(i,a)}maxpool(e,t){return this.runFunction(e.args,t,this.metadata("MAXPOOL"),(r,n,i=n)=>{if(!r.hasOnlyNumbers())return new p(m.VALUE,T.NumberRange);const a=Oi(r.size,n,i),o=this.createKernel(function(u,l,c){const d=this.thread.x*c,f=this.thread.y*c;let E=u[f][d];for(let N=0;N<l;N++)for(let R=0;R<l;R++)E=Math.max(E,u[f+N][d+R]);return E},a)(r.rawNumbers(),n,i);return w.onlyNumbers(o)})}medianpool(e,t){return this.runFunction(e.args,t,this.metadata("MEDIANPOOL"),(r,n,i=n)=>{if(!r.hasOnlyNumbers())return new p(m.VALUE,T.NumberRange);const a=Oi(r.size,n,i),o=this.createKernel(function(u,l,c){const d=this.thread.x*c,f=this.thread.y*c;let E=u[f][d];for(let C=0;C<l;C++)for(let O=0;O<l;O++)E=Math.max(E,u[f+C][d+O]);let N=u[f][d];for(let C=0;C<l;C++)for(let O=0;O<l;O++)N=Math.min(N,u[f+C][d+O]);const R=l*l;let A=N,S=E,y=42;for(let C=0;C<32;C++){const O=(A+S)/2;let te=0;for(let j=0;j<l;j++)for(let q=0;q<l;q++)u[f+j][d+q]>O&&te++;if(l%2===0)if(te===R/2){y=O;break}else te>R/2?A=O:S=O;else if(te===(R-1)/2){y=O;break}else te>(R-1)/2?A=O:S=O}return y},a)(r.rawNumbers(),n,i);return w.onlyNumbers(o)})}maxpoolArraySize(e,t){if(e.args.length<2||e.args.length>3)return V.error();const r=this.metadata("MAXPOOL"),i=e.args.map(l=>{var c;return this.arraySizeForAst(l,new bt(t.formulaAddress,t.arraysFlag||((c=r?.enableArrayArithmeticForArguments)!==null&&c!==void 0?c:!1)))})[0],a=e.args[1];let o;a.type===g.NUMBER?o=a.value:o=1;let u=o;if(e.args.length===3){const l=e.args[2];l.type===g.NUMBER?u=l.value:u=1}return o>i.width||o>i.height||u>o||(i.width-o)%u!==0||(i.height-o)%u!==0?V.error():Oi(i,o,u)}medianpoolArraySize(e,t){return this.maxpoolArraySize(e,t)}transpose(e,t){return this.runFunction(e.args,t,this.metadata("TRANSPOSE"),r=>{const n=r.rawData(),i=r.size,a=[];for(let o=0;o<i.width;++o){a[o]=[];for(let u=0;u<i.height;++u)a[o][u]=n[u][o]}return w.onlyValues(a)})}transposeArraySize(e,t){if(e.args.length!==1)return V.error();const r=this.metadata("TRANSPOSE"),n=e.args.map(a=>{var o;return this.arraySizeForAst(a,new bt(t.formulaAddress,t.arraysFlag||((o=r?.enableArrayArithmeticForArguments)!==null&&o!==void 0?o:!1)))}),[i]=n;return new V(i.height,i.width)}createKernel(e,t){return function(...r){const n=[];for(let i=0;i<t.height;++i){n.push([]);for(let a=0;a<t.width;++a)n[i][a]=e.apply({thread:{x:a,y:i}},r)}return n}}}Jl.implementedFunctions={MMULT:{method:"mmult",sizeOfResultArrayMethod:"mmultArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}],vectorizationForbidden:!0},TRANSPOSE:{method:"transpose",sizeOfResultArrayMethod:"transposeArraySize",parameters:[{argumentType:h.RANGE}],vectorizationForbidden:!0},MAXPOOL:{method:"maxpool",sizeOfResultArrayMethod:"maxpoolArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}],vectorizationForbidden:!0},MEDIANPOOL:{method:"medianpool",sizeOfResultArrayMethod:"medianpoolArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}],vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ec extends P{median(e,t){return this.runFunction(e.args,t,this.metadata("MEDIAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);return n instanceof p?n:n.length===0?new p(m.NUM,T.OneValue):(n.sort((i,a)=>i-a),n.length%2===0?(n[n.length/2-1]+n[n.length/2])/2:n[Math.floor(n.length/2)])})}large(e,t){return this.runFunction(e.args,t,this.metadata("LARGE"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());return i instanceof p?i:(i.sort((a,o)=>a-o),n=Math.trunc(n),n>i.length?new p(m.NUM,T.ValueLarge):i[i.length-n])})}small(e,t){return this.runFunction(e.args,t,this.metadata("SMALL"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());return i instanceof p?i:(i.sort((a,o)=>a-o),n=Math.trunc(n),n>i.length?new p(m.NUM,T.ValueLarge):i[n-1])})}}ec.implementedFunctions={MEDIAN:{method:"median",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},LARGE:{method:"large",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER,minValue:1}]},SMALL:{method:"small",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER,minValue:1}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class tc extends P{mod(e,t){return this.runFunction(e.args,t,this.metadata("MOD"),(r,n)=>n===0?new p(m.DIV_BY_ZERO):r%n)}}tc.implementedFunctions={MOD:{method:"mod",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function es(s){return z(s)&&!Number.isFinite(I(s))?0:s}class Nt{constructor(e,t,r){this.sumsq=e,this.sum=t,this.count=r}static single(e){return new Nt(e*e,e,1)}compose(e){return new Nt(this.sumsq+e.sumsq,this.sum+e.sum,this.count+e.count)}averageValue(){if(this.count>0)return this.sum/this.count}varSValue(){if(this.count>1)return(this.sumsq-this.sum*this.sum/this.count)/(this.count-1)}varPValue(){if(this.count>0)return(this.sumsq-this.sum*this.sum/this.count)/this.count}}Nt.empty=new Nt(0,0,0);class ka extends P{constructor(){super(...arguments),this.addWithEpsilonRaw=(e,t)=>this.arithmeticHelper.addWithEpsilonRaw(e,t)}sum(e,t){return this.doSum(e.args,t)}sumsq(e,t){return this.reduce(e.args,t,0,"SUMSQ",this.addWithEpsilonRaw,r=>Math.pow(I(r),2),Ur)}max(e,t){return this.doMax(e.args,t)}maxa(e,t){const r=this.reduce(e.args,t,Number.NEGATIVE_INFINITY,"MAXA",(n,i)=>Math.max(n,i),I,ts);return es(r)}min(e,t){return this.doMin(e.args,t)}mina(e,t){const r=this.reduce(e.args,t,Number.POSITIVE_INFINITY,"MINA",(n,i)=>Math.min(n,i),I,ts);return es(r)}count(e,t){return this.doCount(e.args,t)}counta(e,t){return this.doCounta(e.args,t)}average(e,t){return this.doAverage(e.args,t)}averagea(e,t){var r;const n=this.reduce(e.args,t,Nt.empty,"_AGGREGATE_A",(i,a)=>i.compose(a),i=>Nt.single(I(i)),ts);return n instanceof p?n:(r=n.averageValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}vars(e,t){return this.doVarS(e.args,t)}varp(e,t){return this.doVarP(e.args,t)}vara(e,t){var r;const n=this.reduceAggregateA(e.args,t);return n instanceof p?n:(r=n.varSValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}varpa(e,t){var r;const n=this.reduceAggregateA(e.args,t);return n instanceof p?n:(r=n.varPValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}stdevs(e,t){return this.doStdevS(e.args,t)}stdevp(e,t){return this.doStdevP(e.args,t)}stdeva(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof p)return r;{const n=r.varSValue();return n===void 0?new p(m.DIV_BY_ZERO):Math.sqrt(n)}}stdevpa(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof p)return r;{const n=r.varPValue();return n===void 0?new p(m.DIV_BY_ZERO):Math.sqrt(n)}}product(e,t){return this.doProduct(e.args,t)}subtotal(e,t){if(e.args.length<2)return new p(m.NA,T.WrongArgNumber);const r=this.coerceToType(this.evaluateAst(e.args[0],t),{argumentType:h.NUMBER},t),n=e.args.slice(1);switch(r){case 1:case 101:return this.doAverage(n,t);case 2:case 102:return this.doCount(n,t);case 3:case 103:return this.doCounta(n,t);case 4:case 104:return this.doMax(n,t);case 5:case 105:return this.doMin(n,t);case 6:case 106:return this.doProduct(n,t);case 7:case 107:return this.doStdevS(n,t);case 8:case 108:return this.doStdevP(n,t);case 9:case 109:return this.doSum(n,t);case 10:case 110:return this.doVarS(n,t);case 11:case 111:return this.doVarP(n,t);default:return new p(m.VALUE,T.BadMode)}}reduceAggregate(e,t){return this.reduce(e,t,Nt.empty,"_AGGREGATE",(r,n)=>r.compose(n),r=>Nt.single(I(r)),Ur)}reduceAggregateA(e,t){return this.reduce(e,t,Nt.empty,"_AGGREGATE_A",(r,n)=>r.compose(n),r=>Nt.single(I(r)),ts)}doAverage(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof p?n:(r=n.averageValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}doVarS(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof p?n:(r=n.varSValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}doVarP(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof p?n:(r=n.varPValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}doStdevS(e,t){const r=this.reduceAggregate(e,t);if(r instanceof p)return r;{const n=r.varSValue();return n===void 0?new p(m.DIV_BY_ZERO):Math.sqrt(n)}}doStdevP(e,t){const r=this.reduceAggregate(e,t);if(r instanceof p)return r;{const n=r.varPValue();return n===void 0?new p(m.DIV_BY_ZERO):Math.sqrt(n)}}doCount(e,t){return this.reduce(e,t,0,"COUNT",(r,n)=>r+n,I,r=>z(r)?1:0)}doCounta(e,t){return this.reduce(e,t,0,"COUNTA",(r,n)=>r+n,I,r=>r===B?0:1)}doMax(e,t){const r=this.reduce(e,t,Number.NEGATIVE_INFINITY,"MAX",(n,i)=>Math.max(n,i),I,Ur);return es(r)}doMin(e,t){const r=this.reduce(e,t,Number.POSITIVE_INFINITY,"MIN",(n,i)=>Math.min(n,i),I,Ur);return es(r)}doSum(e,t){return this.reduce(e,t,0,"SUM",this.addWithEpsilonRaw,I,Ur)}doProduct(e,t){return this.reduce(e,t,1,"PRODUCT",(r,n)=>r*n,I,Ur)}reduce(e,t,r,n,i,a,o){return e.length<1?new p(m.NA,T.WrongArgNumber):e.reduce((u,l)=>{if(u instanceof p)return u;if(l.type===g.CELL_RANGE||l.type===g.COLUMN_RANGE||l.type===g.ROW_RANGE){const d=this.evaluateRange(l,t,r,n,i,a,o);return d instanceof p?d:i(d,u)}let c;if(c=this.evaluateAst(l,t),c instanceof w)return Array.from(c.valuesFromTopLeftCorner()).map(o).filter(f=>f!==void 0).map(f=>f instanceof p?f:a(f)).reduce((f,E)=>f instanceof p?f:E instanceof p?E:i(f,E),u);if(l.type===g.CELL_REFERENCE){if(c=o(c),c===void 0)return u}else if(c=this.coerceScalarToNumberOrError(c),c=o(c),c===void 0)return u;return c instanceof p?c:i(u,a(c))},r)}evaluateRange(e,t,r,n,i,a,o){let u;try{u=F.fromAst(e,t.formulaAddress)}catch(d){if(d instanceof vn)return new p(m.REF,T.RangeManySheets);throw d}const l=this.dependencyGraph.getRange(u.start,u.end);if(l===void 0)throw new Error("Range does not exists in graph");let c=l.getFunctionValue(n);return c===void 0&&(c=this.getRangeValues(n,u,l,a,o).reduce((f,E)=>f instanceof p?f:E instanceof p?E:i(f,E),r),l.setFunctionValue(n,c)),c}getRangeValues(e,t,r,n,i){const a=[],{smallerRangeVertex:o,restRange:u}=this.dependencyGraph.rangeMapping.findSmallerRange(t);let l;if(o!==void 0&&this.dependencyGraph.existsEdge(o,r)){const c=o.getFunctionValue(e);if(c!==void 0)a.push(c);else for(const d of o.range.addresses(this.dependencyGraph)){const f=i(this.dependencyGraph.getScalarValue(d));f instanceof p?a.push(f):f!==void 0&&a.push(n(f))}l=u}else l=t;for(const c of l.addresses(this.dependencyGraph)){const d=i(this.dependencyGraph.getScalarValue(c));d instanceof p?a.push(d):d!==void 0&&a.push(n(d))}return a}}ka.implementedFunctions={SUM:{method:"sum",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},SUMSQ:{method:"sumsq",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MAX:{method:"max",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MIN:{method:"min",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MAXA:{method:"maxa",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MINA:{method:"mina",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},COUNT:{method:"count",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},COUNTA:{method:"counta",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},AVERAGE:{method:"average",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},AVERAGEA:{method:"averagea",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},PRODUCT:{method:"product",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"VAR.S":{method:"vars",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"VAR.P":{method:"varp",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},VARA:{method:"vara",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},VARPA:{method:"varpa",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"STDEV.S":{method:"stdevs",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"STDEV.P":{method:"stdevp",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},STDEVA:{method:"stdeva",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},STDEVPA:{method:"stdevpa",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},SUBTOTAL:{method:"subtotal",parameters:[{argumentType:h.NUMBER},{argumentType:h.ANY}],repeatLastArgs:1}};ka.aliases={VAR:"VAR.S",VARP:"VAR.P",STDEV:"STDEV.S",STDEVP:"STDEV.P",VARS:"VAR.S",STDEVS:"STDEV.S"};function Ur(s){if(z(s)||s instanceof p)return s}function ts(s){return typeof s=="boolean"?Ki(s):z(s)||s instanceof p?s:typeof s=="string"?0:void 0}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class rc extends P{power(e,t){return this.runFunction(e.args,t,this.metadata("POWER"),Math.pow)}}rc.implementedFunctions={POWER:{method:"power",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class nc extends P{radians(e,t){return this.runFunction(e.args,t,this.metadata("RADIANS"),r=>r*(Math.PI/180))}}nc.implementedFunctions={RADIANS:{method:"radians",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const ye=10,sc=255,uu=2,hu=36,fT="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";class ic extends P{dec2bin(e,t){return this.runFunction(e.args,t,this.metadata("DEC2BIN"),(r,n)=>Bt(r,2,n))}dec2oct(e,t){return this.runFunction(e.args,t,this.metadata("DEC2OCT"),(r,n)=>Bt(r,8,n))}dec2hex(e,t){return this.runFunction(e.args,t,this.metadata("DEC2HEX"),(r,n)=>Bt(r,16,n))}bin2dec(e,t){return this.runFunction(e.args,t,this.metadata("BIN2DEC"),r=>{const n=It(r,2,ye);return n===void 0?new p(m.NUM,T.NotBinary):kt(n,2)})}bin2oct(e,t){return this.runFunction(e.args,t,this.metadata("BIN2OCT"),(r,n)=>{const i=It(r,2,ye);return i===void 0?new p(m.NUM,T.NotBinary):Bt(kt(i,2),8,n)})}bin2hex(e,t){return this.runFunction(e.args,t,this.metadata("BIN2HEX"),(r,n)=>{const i=It(r,2,ye);return i===void 0?new p(m.NUM,T.NotBinary):Bt(kt(i,2),16,n)})}oct2dec(e,t){return this.runFunction(e.args,t,this.metadata("OCT2DEC"),r=>{const n=It(r,8,ye);return n===void 0?new p(m.NUM,T.NotOctal):kt(n,8)})}oct2bin(e,t){return this.runFunction(e.args,t,this.metadata("OCT2BIN"),(r,n)=>{const i=It(r,8,ye);return i===void 0?new p(m.NUM,T.NotOctal):Bt(kt(i,8),2,n)})}oct2hex(e,t){return this.runFunction(e.args,t,this.metadata("OCT2HEX"),(r,n)=>{const i=It(r,8,ye);return i===void 0?new p(m.NUM,T.NotOctal):Bt(kt(i,8),16,n)})}hex2dec(e,t){return this.runFunction(e.args,t,this.metadata("HEX2DEC"),r=>{const n=It(r,16,ye);return n===void 0?new p(m.NUM,T.NotHex):kt(n,16)})}hex2bin(e,t){return this.runFunction(e.args,t,this.metadata("HEX2BIN"),(r,n)=>{const i=It(r,16,ye);return i===void 0?new p(m.NUM,T.NotHex):Bt(kt(i,16),2,n)})}hex2oct(e,t){return this.runFunction(e.args,t,this.metadata("HEX2OCT"),(r,n)=>{const i=It(r,16,ye);return i===void 0?new p(m.NUM,T.NotHex):Bt(kt(i,16),8,n)})}base(e,t){return this.runFunction(e.args,t,this.metadata("BASE"),gT)}decimal(e,t){return this.runFunction(e.args,t,this.metadata("DECIMAL"),(r,n)=>{const i=It(r,n,sc);return i===void 0?new p(m.NUM,T.NotHex):parseInt(i,n)})}}ic.implementedFunctions={DEC2BIN:{method:"dec2bin",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2OCT:{method:"dec2oct",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2HEX:{method:"dec2hex",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},BIN2DEC:{method:"bin2dec",parameters:[{argumentType:h.STRING}]},BIN2OCT:{method:"bin2oct",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:ye}]},BIN2HEX:{method:"bin2hex",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:ye}]},OCT2DEC:{method:"oct2dec",parameters:[{argumentType:h.STRING}]},OCT2BIN:{method:"oct2bin",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:ye}]},OCT2HEX:{method:"oct2hex",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:ye}]},HEX2DEC:{method:"hex2dec",parameters:[{argumentType:h.STRING}]},HEX2BIN:{method:"hex2bin",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:ye}]},HEX2OCT:{method:"hex2oct",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:ye}]},DECIMAL:{method:"decimal",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,minValue:uu,maxValue:hu}]},BASE:{method:"base",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:uu,maxValue:hu},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:sc}]}};function It(s,e,t){const r=fT.substr(0,e),n=new RegExp(`^[${r}]+$`);if(!(s.length>t||!n.test(s)))return s}function Bt(s,e,t){if(s>mT(e))return new p(m.NUM,T.ValueBaseLarge);if(s<ac(e))return new p(m.NUM,T.ValueBaseSmall);const r=oc(s,e);return t===void 0||s<0?r:r.length>t?new p(m.NUM,T.ValueBaseLong):We(r,t)}function ac(s){return-Math.pow(s,ye)/2}function mT(s){return-ac(s)-1}function gT(s,e,t){const r=oc(s,e);return t!==void 0&&t>r.length?We(r,t):r}function oc(s,e){const t=s<0?Math.pow(e,ye):0;return(s+t).toString(e).toUpperCase()}function kt(s,e){const t=parseInt(s,e),r=Math.pow(e,ye);return t>=r/2?t-r:t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class uc extends P{rand(e,t){return this.runFunction(e.args,t,this.metadata("RAND"),Math.random)}randbetween(e,t){return this.runFunction(e.args,t,this.metadata("RANDBETWEEN"),(r,n)=>n<r?new p(m.NUM,T.WrongOrder):(r=Math.ceil(r),n=Math.floor(n)+1,r===n&&(n+=1),r+Math.floor(Math.random()*(n-r))))}}uc.implementedFunctions={RAND:{method:"rand",parameters:[],isVolatile:!0},RANDBETWEEN:{method:"randbetween",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}],isVolatile:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function lu(s){const e=Math.ceil(s);return e%2===1?e:e+1}function cu(s){const e=Math.ceil(s);return e%2===0?e:e+1}class Ga extends P{roundup(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.ceil(-r*i)/i:Math.ceil(r*i)/i})}rounddown(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.floor(-r*i)/i:Math.floor(r*i)/i})}round(e,t){return this.runFunction(e.args,t,this.metadata("ROUND"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.round(-r*i)/i:Math.round(r*i)/i})}intFunc(e,t){return this.runFunction(e.args,t,this.metadata("INT"),r=>r<0?-Math.floor(-r):Math.floor(r))}even(e,t){return this.runFunction(e.args,t,this.metadata("EVEN"),r=>r<0?-cu(-r):cu(r))}odd(e,t){return this.runFunction(e.args,t,this.metadata("ODD"),r=>r<0?-lu(-r):lu(r))}ceilingmath(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.MATH"),(r,n,i)=>n===0||r===0?0:(n=Math.abs(n),i===1&&r<0&&(n=-n),Math.ceil(r/n)*n))}ceiling(e,t){return this.runFunction(e.args,t,this.metadata("CEILING"),(r,n)=>r===0?0:n===0?new p(m.DIV_BY_ZERO):r>0&&n<0?new p(m.NUM,T.DistinctSigns):Math.ceil(r/n)*n)}ceilingprecise(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.PRECISE"),(r,n)=>n===0||r===0?0:(n=Math.abs(n),Math.ceil(r/n)*n))}floormath(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.MATH"),(r,n,i)=>n===0||r===0?0:(n=Math.abs(n),i===1&&r<0&&(n*=-1),Math.floor(r/n)*n))}floor(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR"),(r,n)=>r===0?0:n===0?new p(m.DIV_BY_ZERO):r>0&&n<0?new p(m.NUM,T.DistinctSigns):Math.floor(r/n)*n)}floorprecise(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.PRECISE"),(r,n)=>n===0||r===0?0:(n=Math.abs(n),Math.floor(r/n)*n))}}Ga.implementedFunctions={ROUNDUP:{method:"roundup",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]},ROUNDDOWN:{method:"rounddown",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]},ROUND:{method:"round",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]},INT:{method:"intFunc",parameters:[{argumentType:h.NUMBER}]},EVEN:{method:"even",parameters:[{argumentType:h.NUMBER}]},ODD:{method:"odd",parameters:[{argumentType:h.NUMBER}]},"CEILING.MATH":{method:"ceilingmath",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1},{argumentType:h.NUMBER,defaultValue:0}]},CEILING:{method:"ceiling",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},"CEILING.PRECISE":{method:"ceilingprecise",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1}]},"FLOOR.MATH":{method:"floormath",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1},{argumentType:h.NUMBER,defaultValue:0}]},FLOOR:{method:"floor",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},"FLOOR.PRECISE":{method:"floorprecise",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1}]}};Ga.aliases={"ISO.CEILING":"CEILING.PRECISE",TRUNC:"ROUNDDOWN"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class hc extends P{sqrt(e,t){return this.runFunction(e.args,t,this.metadata("SQRT"),Math.sqrt)}}hc.implementedFunctions={SQRT:{method:"sqrt",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function*ET(){}function RT(s){const e=s[Symbol.iterator](),{done:t,value:r}=e.next();return t?{rest:ET()}:{value:r,rest:e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const TT=(s,e,t)=>{if(t.end.row>t.start.row){const r=M(t.end.sheet,t.end.col,t.end.row-1),n=s.getRange(t.start,r);if(n!==void 0)return{smallerRangeVertex:n,restValuesRange:t.withStart(M(t.start.sheet,t.start.col,t.end.row)),restConditionRanges:e.map(i=>i.withStart(M(i.start.sheet,i.start.col,i.end.row)))}}return{restValuesRange:t,restConditionRanges:e}};class NT{constructor(e,t,r,n,i){this.interpreter=e,this.cacheKey=t,this.reduceInitialValue=r,this.composeFunction=n,this.mapFunction=i,this.dependencyGraph=this.interpreter.dependencyGraph}compute(e,t){for(const i of t)if(!i.conditionRange.sameDimensionsAs(e))return new p(m.VALUE,T.EqualLength);const r=this.tryToGetRangeVertexForRangeValue(e),n=t.map(i=>this.tryToGetRangeVertexForRangeValue(i.conditionRange));if(r&&n.every(i=>i!==void 0)){const i=t.map(u=>u.criterionPackage.raw).join(","),a=this.findAlreadyComputedValueInCache(r,this.cacheKey(t),i);if(a!==void 0)return this.interpreter.stats.incrementCriterionFunctionFullCacheUsed(),a;const o=this.buildNewCriterionCache(this.cacheKey(t),t.map(u=>u.conditionRange.range),e.range);return o.has(i)||o.set(i,[this.evaluateRangeValue(e,t),t.map(u=>u.criterionPackage.lambda)]),r.setCriterionFunctionValues(this.cacheKey(t),o),n.forEach(u=>{u!==void 0&&u.addDependentCacheRange(r)}),o.get(i)[0]}else return this.evaluateRangeValue(e,t)}tryToGetRangeVertexForRangeValue(e){const t=e.range;if(t!==void 0)return this.dependencyGraph.getRange(t.start,t.end)}reduceFunction(e){let t=this.reduceInitialValue;for(const r of e)t=this.composeFunction(t,r);return t}findAlreadyComputedValueInCache(e,t,r){return e.getCriterionFunctionValue(t,r)}evaluateRangeValue(e,t){const r=t.map(o=>o.criterionPackage.lambda),n=Array.from(e.valuesFromTopLeftCorner()).map(this.mapFunction)[Symbol.iterator](),i=t.map(o=>o.conditionRange.iterateValuesFromTopLeftCorner()),a=pu(r,i,n);return this.reduceFunction(a)}buildNewCriterionCache(e,t,r){const n=this.dependencyGraph.getRange(r.start,r.end),{smallerRangeVertex:i,restConditionRanges:a,restValuesRange:o}=TT(this.dependencyGraph,t,r);let u;i!==void 0&&this.dependencyGraph.existsEdge(i,n)?u=i.getCriterionFunctionValues(e):u=new Map;const l=new Map;return u.forEach(([c,d],f)=>{const E=pu(d,a.map(R=>du(this.dependencyGraph,R)),Array.from(du(this.dependencyGraph,o)).map(this.mapFunction)[Symbol.iterator]()),N=this.composeFunction(c,this.reduceFunction(E));this.interpreter.stats.incrementCriterionFunctionPartialCacheUsed(),l.set(f,[N,d])}),l}}class ST{constructor(e,t){this.conditionRange=e,this.criterionPackage=t}}function*du(s,e){for(const t of e.addresses(s))yield I(s.getScalarValue(t))}function*pu(s,e,t){for(const r of t){const n=e.map(a=>RT(a));if(!n.every(a=>Object.prototype.hasOwnProperty.call(a,"value")))return;const i=n.map(a=>I(a.value));AT(i,s).every(([a,o])=>o(a))&&(yield r),e=n.map(a=>a.rest)}}function AT(s,e){const t=[];for(let r=0;r<Math.min(s.length,e.length);r++)t.push([s[r],e[r]]);return t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ir{constructor(e,t){this.sum=e,this.count=t}static single(e){return new ir(e,1)}compose(e){return new ir(this.sum+e.sum,this.count+e.count)}averageValue(){if(this.count>0)return this.sum/this.count}}ir.empty=new ir(0,0);function yT(s){return e=>{const t=e.map(r=>`${r.conditionRange.range.sheet},${r.conditionRange.range.start.col},${r.conditionRange.range.start.row}`);return[s,...t].join(",")}}function fu(s){return z(s)&&!Number.isFinite(I(s))?0:s}function rs(s){if(s instanceof p)return s;if(z(s))return I(s)}class lc extends P{sumif(e,t){const r="SUMIF",n=(i,a,o)=>this.computeConditionalAggregationFunction(o??i,[i,a],r,0,(u,l)=>this.arithmeticHelper.nonstrictadd(u,l),rs);return this.runFunction(e.args,t,this.metadata(r),n)}sumifs(e,t){const r="SUMIFS",n=(i,...a)=>this.computeConditionalAggregationFunction(i,a,r,0,(o,u)=>this.arithmeticHelper.nonstrictadd(o,u),rs);return this.runFunction(e.args,t,this.metadata(r),n)}averageif(e,t){const r="AVERAGEIF",n=(i,a,o)=>{const u=this.computeConditionalAggregationFunction(o??i,[i,a],r,ir.empty,(l,c)=>l.compose(c),l=>z(l)?ir.single(I(l)):ir.empty);return u instanceof p?u:u.averageValue()||new p(m.DIV_BY_ZERO)};return this.runFunction(e.args,t,this.metadata(r),n)}countif(e,t){const r="COUNTIF",n=(i,a)=>this.computeConditionalAggregationFunction(i,[i,a],r,0,(o,u)=>o+u,()=>1);return this.runFunction(e.args,t,this.metadata(r),n)}countifs(e,t){const r="COUNTIFS",n=(...i)=>this.computeConditionalAggregationFunction(i[0],i,r,0,(a,o)=>a+o,()=>1);return this.runFunction(e.args,t,this.metadata(r),n)}minifs(e,t){const r="MINIFS",n=(a,o)=>o===void 0||a===void 0?o===void 0?a:o:Math.min(a,o),i=(a,...o)=>{const u=this.computeConditionalAggregationFunction(a,o,r,Number.POSITIVE_INFINITY,n,rs);return fu(u)};return this.runFunction(e.args,t,this.metadata(r),i)}maxifs(e,t){const r="MAXIFS",n=(a,o)=>o===void 0||a===void 0?o===void 0?a:o:Math.max(a,o),i=(a,...o)=>{const u=this.computeConditionalAggregationFunction(a,o,r,Number.NEGATIVE_INFINITY,n,rs);return fu(u)};return this.runFunction(e.args,t,this.metadata(r),i)}computeConditionalAggregationFunction(e,t,r,n,i,a){const o=[];for(let u=0;u<t.length;u+=2){const l=t[u],c=this.interpreter.criterionBuilder.fromCellValue(t[u+1],this.arithmeticHelper);if(c===void 0)return new p(m.VALUE,T.BadCriterion);o.push(new ST(l,c))}return new NT(this.interpreter,yT(r),n,i,a).compute(e,o)}}lc.implementedFunctions={SUMIF:{method:"sumif",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR},{argumentType:h.RANGE,optionalArg:!0}]},COUNTIF:{method:"countif",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR}]},AVERAGEIF:{method:"averageif",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR},{argumentType:h.RANGE,optionalArg:!0}]},SUMIFS:{method:"sumifs",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2},COUNTIFS:{method:"countifs",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2},MINIFS:{method:"minifs",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2},MAXIFS:{method:"maxifs",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class cc extends P{sumproduct(e,t){return this.runFunction(e.args,t,this.metadata("SUMPRODUCT"),(...r)=>{const n=r[0].width(),i=r[0].height();for(const u of r)if(u.width()!==n||u.height()!==i)return new p(m.VALUE,T.EqualLength);let a=0;const o=r.map(u=>u.iterateValuesFromTopLeftCorner());for(let u=0;u<n*i;u++){let l=1;for(const c of o){const d=c.next().value;if(d instanceof p)return d;const f=this.coerceScalarToNumberOrError(d);z(f)?l*=I(f):l=0}a+=l}return a})}}cc.implementedFunctions={SUMPRODUCT:{method:"sumproduct",parameters:[{argumentType:h.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class dc extends P{concatenate(e,t){return this.runFunction(e.args,t,this.metadata("CONCATENATE"),(...r)=>"".concat(...r))}split(e,t){return this.runFunction(e.args,t,this.metadata("SPLIT"),(r,n)=>{const i=r.split(" ");return n>=i.length||n<0?new p(m.VALUE,T.IndexBounds):i[n]})}len(e,t){return this.runFunction(e.args,t,this.metadata("LEN"),r=>r.length)}lower(e,t){return this.runFunction(e.args,t,this.metadata("LOWER"),r=>r.toLowerCase())}trim(e,t){return this.runFunction(e.args,t,this.metadata("TRIM"),r=>r.replace(/^ +/g,"").replace(/ +$/g,"").replace(/ +/g," "))}proper(e,t){return this.runFunction(e.args,t,this.metadata("PROPER"),r=>r.replace(new RegExp("\\p{L}+","gu"),n=>n.charAt(0).toUpperCase()+n.substring(1).toLowerCase()))}clean(e,t){return this.runFunction(e.args,t,this.metadata("CLEAN"),r=>r.replace(/[\u0000-\u001F]/g,""))}exact(e,t){return this.runFunction(e.args,t,this.metadata("EXACT"),(r,n)=>r===n)}rept(e,t){return this.runFunction(e.args,t,this.metadata("REPT"),(r,n)=>n<0?new p(m.VALUE,T.NegativeCount):r.repeat(n))}right(e,t){return this.runFunction(e.args,t,this.metadata("RIGHT"),(r,n)=>n<0?new p(m.VALUE,T.NegativeLength):n===0?"":r.slice(-n))}left(e,t){return this.runFunction(e.args,t,this.metadata("LEFT"),(r,n)=>n<0?new p(m.VALUE,T.NegativeLength):r.slice(0,n))}mid(e,t){return this.runFunction(e.args,t,this.metadata("MID"),(r,n,i)=>n<1?new p(m.VALUE,T.LessThanOne):i<0?new p(m.VALUE,T.NegativeLength):r.substring(n-1,n+i-1))}replace(e,t){return this.runFunction(e.args,t,this.metadata("REPLACE"),(r,n,i,a)=>n<1?new p(m.VALUE,T.LessThanOne):i<0?new p(m.VALUE,T.NegativeLength):r.substring(0,n-1)+a+r.substring(n+i-1))}search(e,t){return this.runFunction(e.args,t,this.metadata("SEARCH"),(r,n,i)=>{if(i<1||i>n.length)return new p(m.VALUE,T.LengthBounds);const a=r.toLowerCase(),o=n.substring(i-1).toLowerCase(),u=this.arithmeticHelper.requiresRegex(a)?this.arithmeticHelper.searchString(a,o):o.indexOf(a);return u>-1?u+i:new p(m.VALUE,T.PatternNotFound)})}substitute(e,t){return this.runFunction(e.args,t,this.metadata("SUBSTITUTE"),(r,n,i,a)=>{const o=this.escapeRegExpSpecialCharacters(n),u=new RegExp(o,"g");if(a===void 0)return r.replace(u,i);if(a<1)return new p(m.VALUE,T.LessThanOne);let l,c=0;for(;(l=u.exec(r))!==null;)if(a===++c)return r.substring(0,l.index)+i+r.substring(u.lastIndex);return r})}find(e,t){return this.runFunction(e.args,t,this.metadata("FIND"),(r,n,i)=>{if(i<1||i>n.length)return new p(m.VALUE,T.IndexBounds);const o=n.substring(i-1).indexOf(r)+i;return o>0?o:new p(m.VALUE,T.PatternNotFound)})}t(e,t){return this.runFunction(e.args,t,this.metadata("T"),r=>r instanceof p||typeof r=="string"?r:"")}upper(e,t){return this.runFunction(e.args,t,this.metadata("UPPER"),r=>r.toUpperCase())}escapeRegExpSpecialCharacters(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}dc.implementedFunctions={CONCATENATE:{method:"concatenate",parameters:[{argumentType:h.STRING}],repeatLastArgs:1,expandRanges:!0},EXACT:{method:"exact",parameters:[{argumentType:h.STRING},{argumentType:h.STRING}]},SPLIT:{method:"split",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER}]},LEN:{method:"len",parameters:[{argumentType:h.STRING}]},LOWER:{method:"lower",parameters:[{argumentType:h.STRING}]},MID:{method:"mid",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},TRIM:{method:"trim",parameters:[{argumentType:h.STRING}]},T:{method:"t",parameters:[{argumentType:h.SCALAR}]},PROPER:{method:"proper",parameters:[{argumentType:h.STRING}]},CLEAN:{method:"clean",parameters:[{argumentType:h.STRING}]},REPT:{method:"rept",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER}]},RIGHT:{method:"right",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},LEFT:{method:"left",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},REPLACE:{method:"replace",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.STRING}]},SEARCH:{method:"search",parameters:[{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},SUBSTITUTE:{method:"substitute",parameters:[{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0}]},FIND:{method:"find",parameters:[{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},UPPER:{method:"upper",parameters:[{argumentType:h.STRING}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pc extends P{acos(e,t){return this.runFunction(e.args,t,this.metadata("ACOS"),Math.acos)}asin(e,t){return this.runFunction(e.args,t,this.metadata("ASIN"),Math.asin)}cos(e,t){return this.runFunction(e.args,t,this.metadata("COS"),Math.cos)}sin(e,t){return this.runFunction(e.args,t,this.metadata("SIN"),Math.sin)}tan(e,t){return this.runFunction(e.args,t,this.metadata("TAN"),Math.tan)}atan(e,t){return this.runFunction(e.args,t,this.metadata("ATAN"),Math.atan)}atan2(e,t){return this.runFunction(e.args,t,this.metadata("ATAN2"),(r,n)=>r===0&&n===0?new p(m.DIV_BY_ZERO):Math.atan2(n,r))}cot(e,t){return this.runFunction(e.args,t,this.metadata("COT"),r=>r===0?new p(m.DIV_BY_ZERO):1/Math.tan(r))}acot(e,t){return this.runFunction(e.args,t,this.metadata("ACOT"),r=>r===0?aa/2:Math.atan(1/r))}sec(e,t){return this.runFunction(e.args,t,this.metadata("SEC"),r=>1/Math.cos(r))}csc(e,t){return this.runFunction(e.args,t,this.metadata("CSC"),r=>r===0?new p(m.DIV_BY_ZERO):1/Math.sin(r))}sinh(e,t){return this.runFunction(e.args,t,this.metadata("SINH"),Math.sinh)}asinh(e,t){return this.runFunction(e.args,t,this.metadata("ASINH"),Math.asinh)}cosh(e,t){return this.runFunction(e.args,t,this.metadata("COSH"),Math.cosh)}acosh(e,t){return this.runFunction(e.args,t,this.metadata("ACOSH"),Math.acosh)}tanh(e,t){return this.runFunction(e.args,t,this.metadata("TANH"),Math.tanh)}atanh(e,t){return this.runFunction(e.args,t,this.metadata("ATANH"),Math.atanh)}coth(e,t){return this.runFunction(e.args,t,this.metadata("COTH"),r=>r===0?new p(m.DIV_BY_ZERO):1/Math.tanh(r))}acoth(e,t){return this.runFunction(e.args,t,this.metadata("ACOTH"),r=>r===0?new p(m.NUM,T.NonZero):Math.atanh(1/r))}sech(e,t){return this.runFunction(e.args,t,this.metadata("SECH"),r=>1/Math.cosh(r))}csch(e,t){return this.runFunction(e.args,t,this.metadata("CSCH"),r=>r===0?new p(m.DIV_BY_ZERO):1/Math.sinh(r))}}pc.implementedFunctions={ACOS:{method:"acos",parameters:[{argumentType:h.NUMBER}]},ASIN:{method:"asin",parameters:[{argumentType:h.NUMBER}]},COS:{method:"cos",parameters:[{argumentType:h.NUMBER}]},SIN:{method:"sin",parameters:[{argumentType:h.NUMBER}]},TAN:{method:"tan",parameters:[{argumentType:h.NUMBER}]},ATAN:{method:"atan",parameters:[{argumentType:h.NUMBER}]},ATAN2:{method:"atan2",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},COT:{method:"cot",parameters:[{argumentType:h.NUMBER}]},SEC:{method:"sec",parameters:[{argumentType:h.NUMBER}]},CSC:{method:"csc",parameters:[{argumentType:h.NUMBER}]},SINH:{method:"sinh",parameters:[{argumentType:h.NUMBER}]},COSH:{method:"cosh",parameters:[{argumentType:h.NUMBER}]},TANH:{method:"tanh",parameters:[{argumentType:h.NUMBER}]},COTH:{method:"coth",parameters:[{argumentType:h.NUMBER}]},SECH:{method:"sech",parameters:[{argumentType:h.NUMBER}]},CSCH:{method:"csch",parameters:[{argumentType:h.NUMBER}]},ACOT:{method:"acot",parameters:[{argumentType:h.NUMBER}]},ASINH:{method:"asinh",parameters:[{argumentType:h.NUMBER}]},ACOSH:{method:"acosh",parameters:[{argumentType:h.NUMBER}]},ATANH:{method:"atanh",parameters:[{argumentType:h.NUMBER}]},ACOTH:{method:"acoth",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class CT extends vl{constructor(e){super(e),this.dependencyGraph=e}find(e,t,r){return this.basicFind(e,t,"col",r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class fc extends P{constructor(){super(...arguments),this.rowSearch=new CT(this.dependencyGraph)}vlookup(e,t){return this.runFunction(e.args,t,this.metadata("VLOOKUP"),(r,n,i,a)=>{const o=n.range;if(o===void 0)return new p(m.VALUE,T.WrongType);if(i<1)return new p(m.VALUE,T.LessThanOne);if(i>o.width())return new p(m.REF,T.IndexLarge);const u={ordering:a?"asc":"none",ifNoMatch:a?"returnLowerBound":"returnNotFound"};return this.doVlookup(zn(r),n,i-1,u)})}hlookup(e,t){return this.runFunction(e.args,t,this.metadata("HLOOKUP"),(r,n,i,a)=>{const o=n.range;if(o===void 0)return new p(m.VALUE,T.WrongType);if(i<1)return new p(m.VALUE,T.LessThanOne);if(i>o.height())return new p(m.REF,T.IndexLarge);const u={ordering:a?"asc":"none",ifNoMatch:a?"returnLowerBound":"returnNotFound"};return this.doHlookup(zn(r),n,i-1,u)})}xlookup(e,t){return this.runFunction(e.args,t,this.metadata("XLOOKUP"),(r,n,i,a,o,u)=>{if(![0,-1,1,2].includes(o))return new p(m.VALUE,T.BadMode);if(![1,-1,2,-2].includes(u))return new p(m.VALUE,T.BadMode);const l=n instanceof w?n:w.fromScalar(n),c=i instanceof w?i:w.fromScalar(i),d=o===2,f={ordering:u===2?"asc":u===-2?"desc":"none",returnOccurrence:u===-1?"last":"first",ifNoMatch:o===-1?"returnLowerBound":o===1?"returnUpperBound":"returnNotFound"};return this.doXlookup(zn(r),l,c,a,d,f)})}xlookupArraySize(e){var t,r;const n=(t=e?.args)===null||t===void 0?void 0:t[1],i=(r=e?.args)===null||r===void 0?void 0:r[2];if(n?.start==null||n?.end==null||i?.start==null||i?.end==null)return V.error();const a=n.end.row-n.start.row+1,o=n.end.col-n.start.col+1,u=i.end.row-i.start.row+1,l=i.end.col-i.start.col+1,c=o===1&&u===a;return!c&&!(a===1&&l===o)?V.error():c?new V(l,1):new V(1,u)}match(e,t){return this.runFunction(e.args,t,this.metadata("MATCH"),(r,n,i)=>this.doMatch(zn(r),n,i))}searchInRange(e,t,r,n,i){return r&&typeof e=="string"&&this.arithmeticHelper.requiresRegex(e)?i.advancedFind(this.arithmeticHelper.eqMatcherFunction(e),t,{returnOccurrence:n.returnOccurrence}):i.find(e,t,n)}doVlookup(e,t,r,n){this.dependencyGraph.stats.start(x.VLOOKUP);const i=t.range;let a;i===void 0?a=w.onlyValues(t.data.map(l=>[l[0]])):a=w.onlyRange(F.spanFrom(i.start,1,i.height()),this.dependencyGraph);const o=this.searchInRange(e,a,n.ordering==="none",n,this.columnSearch);if(this.dependencyGraph.stats.end(x.VLOOKUP),o===-1)return new p(m.NA,T.ValueNotFound);let u;if(i===void 0)u=t.data[o][r];else{const l=M(i.sheet,i.start.col+r,i.start.row+o);u=this.dependencyGraph.getCellValue(l)}return u instanceof w?new p(m.VALUE,T.WrongType):u}doHlookup(e,t,r,n){const i=t.range;let a;i===void 0?a=w.onlyValues([t.data[0]]):a=w.onlyRange(F.spanFrom(i.start,i.width(),1),this.dependencyGraph);const o=this.searchInRange(e,a,n.ordering==="none",n,this.rowSearch);if(o===-1)return new p(m.NA,T.ValueNotFound);let u;if(i===void 0)u=t.data[r][o];else{const l=M(i.sheet,i.start.col+o,i.start.row+r);u=this.dependencyGraph.getCellValue(l)}return u instanceof w?new p(m.VALUE,T.WrongType):u}doXlookup(e,t,r,n,i,a){const o=t.width()===1&&r.height()===t.height(),u=t.height()===1&&r.width()===t.width();if(!o&&!u)return new p(m.VALUE,T.WrongDimension);const l=o?this.columnSearch:this.rowSearch,c=this.searchInRange(e,t,i,a,l);if(c===-1)return n==m.NA?new p(m.NA,T.ValueNotFound):n;const d=o?[r.data[c]]:r.data.map(f=>[f[c]]);return w.onlyValues(d)}doMatch(e,t,r){if(![-1,0,1].includes(r))return new p(m.VALUE,T.BadMode);if(t.width()>1&&t.height()>1)return new p(m.NA);const n=t.width()===1?this.columnSearch:this.rowSearch,i=r===0?{ordering:"none",ifNoMatch:"returnNotFound"}:{ordering:r===-1?"desc":"asc",ifNoMatch:r===-1?"returnUpperBound":"returnLowerBound"},a=n.find(e,t,i);return a===-1?new p(m.NA,T.ValueNotFound):a+1}}fc.implementedFunctions={VLOOKUP:{method:"vlookup",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.BOOLEAN,defaultValue:!0}]},HLOOKUP:{method:"hlookup",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.BOOLEAN,defaultValue:!0}]},XLOOKUP:{method:"xlookup",sizeOfResultArrayMethod:"xlookupArraySize",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.SCALAR,optionalArg:!0,defaultValue:m.NA},{argumentType:h.NUMBER,optionalArg:!0,defaultValue:0},{argumentType:h.NUMBER,optionalArg:!0,defaultValue:1}]},MATCH:{method:"match",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.NUMBER,defaultValue:1}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mc extends P{roman(e,t){return this.runFunction(e.args,t,this.metadata("ROMAN"),(r,n)=>(r=Math.trunc(r),n===!1?n=4:n===!0&&(n=0),n=I(this.coerceScalarToNumberOrError(n)),n instanceof p?n:(n=Math.trunc(n),n<0?new p(m.VALUE,T.ValueSmall):n>4?new p(m.VALUE,T.ValueLarge):vT(r,n))))}arabic(e,t){return this.runFunction(e.args,t,this.metadata("ARABIC"),r=>{r=r.trim().toUpperCase();let n=!1;if(r.startsWith("-")&&(r=r.slice(1),n=!0,r===""))return new p(m.VALUE,T.InvalidRoman);const i={input:r,acc:0};return Ot(i,{token:"MMM",val:3e3},{token:"MM",val:2e3},{token:"M",val:1e3}),Ot(i,{token:"IM",val:999},{token:"VM",val:995},{token:"XM",val:990},{token:"LM",val:950},{token:"CM",val:900}),Ot(i,{token:"D",val:500},{token:"ID",val:499},{token:"VD",val:495},{token:"XD",val:490},{token:"LD",val:450},{token:"CD",val:400}),Ot(i,{token:"CCC",val:300},{token:"CC",val:200},{token:"C",val:100}),Ot(i,{token:"IC",val:99},{token:"VC",val:95},{token:"XC",val:90}),Ot(i,{token:"L",val:50},{token:"IL",val:49},{token:"VL",val:45},{token:"XL",val:40}),Ot(i,{token:"XXX",val:30},{token:"XX",val:20},{token:"X",val:10}),Ot(i,{token:"IX",val:9}),Ot(i,{token:"V",val:5},{token:"IV",val:4}),Ot(i,{token:"III",val:3},{token:"II",val:2},{token:"I",val:1}),i.input!==""?new p(m.VALUE,T.InvalidRoman):n?-i.acc:i.acc})}}mc.implementedFunctions={ROMAN:{method:"roman",parameters:[{argumentType:h.NUMBER,minValue:1,lessThan:4e3},{argumentType:h.NOERROR,optionalArg:!0,defaultValue:0}]},ARABIC:{method:"arabic",parameters:[{argumentType:h.STRING}]}};function Ot(s,...e){for(const t of e)if(s.input.startsWith(t.token)){s.input=s.input.slice(t.token.length),s.acc+=t.val;break}}function vT(s,e){const t={val:s%1e3,acc:"M".repeat(Math.floor(s/1e3))};return e===4&&(pe(t,"IM",999,1e3),pe(t,"ID",499,500)),e>=3&&(pe(t,"VM",995,1e3),pe(t,"VD",495,500)),e>=2&&(pe(t,"XM",990,1e3),pe(t,"XD",490,500)),e>=1&&(pe(t,"LM",950,1e3),pe(t,"LD",450,500)),pe(t,"CM",900,1e3),pe(t,"CD",400,500),pe(t,"D",500,900),t.acc+="C".repeat(Math.floor(t.val/100)),t.val%=100,e>=2&&(pe(t,"IC",99,100),pe(t,"IL",49,50)),e>=1&&(pe(t,"VC",95,100),pe(t,"VL",45,50)),pe(t,"XC",90,100),pe(t,"XL",40,50),pe(t,"L",50,90),t.acc+="X".repeat(Math.floor(t.val/10)),t.val%=10,pe(t,"IX",9,10),pe(t,"IV",4,5),pe(t,"V",5,9),t.acc+="I".repeat(t.val),t.acc}function pe(s,e,t,r){s.val>=t&&s.val<r&&(s.val-=t,s.acc+=e)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class gc extends P{add(e,t){return this.runFunction(e.args,t,this.metadata("HF.ADD"),this.arithmeticHelper.addWithEpsilon)}concat(e,t){return this.runFunction(e.args,t,this.metadata("HF.CONCAT"),this.arithmeticHelper.concat)}divide(e,t){return this.runFunction(e.args,t,this.metadata("HF.DIVIDE"),this.arithmeticHelper.divide)}eq(e,t){return this.runFunction(e.args,t,this.metadata("HF.EQ"),this.arithmeticHelper.eq)}gt(e,t){return this.runFunction(e.args,t,this.metadata("HF.GT"),this.arithmeticHelper.gt)}gte(e,t){return this.runFunction(e.args,t,this.metadata("HF.GTE"),this.arithmeticHelper.geq)}lt(e,t){return this.runFunction(e.args,t,this.metadata("HF.LT"),this.arithmeticHelper.lt)}lte(e,t){return this.runFunction(e.args,t,this.metadata("HF.LTE"),this.arithmeticHelper.leq)}minus(e,t){return this.runFunction(e.args,t,this.metadata("HF.MINUS"),this.arithmeticHelper.subtract)}multiply(e,t){return this.runFunction(e.args,t,this.metadata("HF.MULTIPLY"),this.arithmeticHelper.multiply)}ne(e,t){return this.runFunction(e.args,t,this.metadata("HF.NE"),this.arithmeticHelper.neq)}pow(e,t){return this.runFunction(e.args,t,this.metadata("HF.POW"),this.arithmeticHelper.pow)}uminus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UMINUS"),this.arithmeticHelper.unaryMinus)}upercent(e,t){return this.runFunction(e.args,t,this.metadata("HF.UNARY_PERCENT"),this.arithmeticHelper.unaryPercent)}uplus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UPLUS"),this.arithmeticHelper.unaryPlus)}}gc.implementedFunctions={"HF.ADD":{method:"add",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.CONCAT":{method:"concat",parameters:[{argumentType:h.STRING,passSubtype:!0},{argumentType:h.STRING,passSubtype:!0}]},"HF.DIVIDE":{method:"divide",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.EQ":{method:"eq",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.GT":{method:"gt",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.GTE":{method:"gte",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.LT":{method:"lt",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.LTE":{method:"lte",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.MINUS":{method:"minus",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.MULTIPLY":{method:"multiply",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.NE":{method:"ne",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.POW":{method:"pow",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.UMINUS":{method:"uminus",parameters:[{argumentType:h.NUMBER,passSubtype:!0}]},"HF.UNARY_PERCENT":{method:"upercent",parameters:[{argumentType:h.NUMBER,passSubtype:!0}]},"HF.UPLUS":{method:"uplus",parameters:[{argumentType:h.NUMBER,passSubtype:!0}]}};/**
 * @license
 bessel.js (C) 2013-present SheetJS -- http://sheetjs.com

 Apache License
 Version 2.0, January 2004
 http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

 "License" shall mean the terms and conditions for use, reproduction,
 and distribution as defined by Sections 1 through 9 of this document.

 "Licensor" shall mean the copyright owner or entity authorized by
 the copyright owner that is granting the License.

 "Legal Entity" shall mean the union of the acting entity and all
 other entities that control, are controlled by, or are under common
 control with that entity. For the purposes of this definition,
 "control" means (i) the power, direct or indirect, to cause the
 direction or management of such entity, whether by contract or
 otherwise, or (ii) ownership of fifty percent (50%) or more of the
 outstanding shares, or (iii) beneficial ownership of such entity.

 "You" (or "Your") shall mean an individual or Legal Entity
 exercising permissions granted by this License.

 "Source" form shall mean the preferred form for making modifications,
 including but not limited to software source code, documentation
 source, and configuration files.

 "Object" form shall mean any form resulting from mechanical
 transformation or translation of a Source form, including but
 not limited to compiled object code, generated documentation,
 and conversions to other media types.

 "Work" shall mean the work of authorship, whether in Source or
 Object form, made available under the License, as indicated by a
 copyright notice that is included in or attached to the work
 (an example is provided in the Appendix below).

 "Derivative Works" shall mean any work, whether in Source or Object
 form, that is based on (or derived from) the Work and for which the
 editorial revisions, annotations, elaborations, or other modifications
 represent, as a whole, an original work of authorship. For the purposes
 of this License, Derivative Works shall not include works that remain
 separable from, or merely link (or bind by name) to the interfaces of,
 the Work and Derivative Works thereof.

 "Contribution" shall mean any work of authorship, including
 the original version of the Work and any modifications or additions
 to that Work or Derivative Works thereof, that is intentionally
 submitted to Licensor for inclusion in the Work by the copyright owner
 or by an individual or Legal Entity authorized to submit on behalf of
 the copyright owner. For the purposes of this definition, "submitted"
 means any form of electronic, verbal, or written communication sent
 to the Licensor or its representatives, including but not limited to
 communication on electronic mailing lists, source code control systems,
 and issue tracking systems that are managed by, or on behalf of, the
 Licensor for the purpose of discussing and improving the Work, but
 excluding communication that is conspicuously marked or otherwise
 designated in writing by the copyright owner as "Not a Contribution."

 "Contributor" shall mean Licensor and any individual or Legal Entity
 on behalf of whom a Contribution has been received by Licensor and
 subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 copyright license to reproduce, prepare Derivative Works of,
 publicly display, publicly perform, sublicense, and distribute the
 Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 (except as stated in this section) patent license to make, have made,
 use, offer to sell, sell, import, and otherwise transfer the Work,
 where such license applies only to those patent claims licensable
 by such Contributor that are necessarily infringed by their
 Contribution(s) alone or by combination of their Contribution(s)
 with the Work to which such Contribution(s) was submitted. If You
 institute patent litigation against any entity (including a
 cross-claim or counterclaim in a lawsuit) alleging that the Work
 or a Contribution incorporated within the Work constitutes direct
 or contributory patent infringement, then any patent licenses
 granted to You under this License for that Work shall terminate
 as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
 Work or Derivative Works thereof in any medium, with or without
 modifications, and in Source or Object form, provided that You
 meet the following conditions:

 (a) You must give any other recipients of the Work or
 Derivative Works a copy of this License; and

 (b) You must cause any modified files to carry prominent notices
 stating that You changed the files; and

 (c) You must retain, in the Source form of any Derivative Works
 that You distribute, all copyright, patent, trademark, and
 attribution notices from the Source form of the Work,
 excluding those notices that do not pertain to any part of
 the Derivative Works; and

 (d) If the Work includes a "NOTICE" text file as part of its
 distribution, then any Derivative Works that You distribute must
 include a readable copy of the attribution notices contained
 within such NOTICE file, excluding those notices that do not
 pertain to any part of the Derivative Works, in at least one
 of the following places: within a NOTICE text file distributed
 as part of the Derivative Works; within the Source form or
 documentation, if provided along with the Derivative Works; or,
 within a display generated by the Derivative Works, if and
 wherever such third-party notices normally appear. The contents
 of the NOTICE file are for informational purposes only and
 do not modify the License. You may add Your own attribution
 notices within Derivative Works that You distribute, alongside
 or as an addendum to the NOTICE text from the Work, provided
 that such additional attribution notices cannot be construed
 as modifying the License.

 You may add Your own copyright statement to Your modifications and
 may provide additional or different license terms and conditions
 for use, reproduction, or distribution of Your modifications, or
 for any such Derivative Works as a whole, provided Your use,
 reproduction, and distribution of the Work otherwise complies with
 the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
 any Contribution intentionally submitted for inclusion in the Work
 by You to the Licensor shall be under the terms and conditions of
 this License, without any additional terms or conditions.
 Notwithstanding the above, nothing herein shall supersede or modify
 the terms of any separate license agreement you may have executed
 with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
 names, trademarks, service marks, or product names of the Licensor,
 except as required for reasonable and customary use in describing the
 origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
 agreed to in writing, Licensor provides the Work (and each
 Contributor provides its Contributions) on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 implied, including, without limitation, any warranties or conditions
 of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
 PARTICULAR PURPOSE. You are solely responsible for determining the
 appropriateness of using or redistributing the Work and assume any
 risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
 whether in tort (including negligence), contract, or otherwise,
 unless required by applicable law (such as deliberate and grossly
 negligent acts) or agreed to in writing, shall any Contributor be
 liable to You for damages, including any direct, indirect, special,
 incidental, or consequential damages of any character arising as a
 result of this License or out of the use or inability to use the
 Work (including but not limited to damages for loss of goodwill,
 work stoppage, computer failure or malfunction, or any and all
 other commercial damages or losses), even if such Contributor
 has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
 the Work or Derivative Works thereof, You may choose to offer,
 and charge a fee for, acceptance of support, warranty, indemnity,
 or other liability obligations and/or rights consistent with this
 License. However, in accepting such obligations, You may act only
 on Your own behalf and on Your sole responsibility, not on behalf
 of any other Contributor, and only if You agree to indemnify,
 defend, and hold each Contributor harmless for any liability
 incurred by, or claims asserted against, such Contributor by reason
 of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

 To apply the Apache License to your work, attach the following
 boilerplate notice, with the fields enclosed by brackets "{}"
 replaced with your own identifying information. (Don't include
 the brackets!)  The text should be enclosed in the appropriate
 comment syntax for the file format. We also recommend that a
 file or class name and description of purpose be included on the
 same "printed page" as the copyright notice for easier
 identification within third-party archives.

 Copyright (C) 2013-present   SheetJS LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 */var D=Math;function ie(s,e){for(var t=0,r=0;t<s.length;++t)r=e*r+s[t];return r}function Ec(s,e,t,r,n){if(e===0)return t;if(e===1)return r;for(var i=2/s,a=r,o=1;o<e;++o)a=r*o*i+n*t,t=r,r=a;return a}function Rc(s,e,t,r,n){return function(a,o){if(r){if(a===0)return r==1?-1/0:1/0;if(a<0)return NaN}if(o===0)return s(a);if(o===1)return e(a);if(o<0)return NaN;o|=0;var u=s(a),l=e(a);return Ec(a,o,u,l,n)}}var oa=function(){var s=.636619772,e=[57568490574,-13362590354,6516196407e-1,-1121442418e-2,77392.33017,-184.9052456].reverse(),t=[57568490411,1029532985,9494680718e-3,59272.64853,267.8532712,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),n=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934935152e-16].reverse();function i(d){var f=0,E=0,N=0,R=d*d;if(d<8)E=ie(e,R),N=ie(t,R),f=E/N;else{var A=d-.785398164;R=64/R,E=ie(r,R),N=ie(n,R),f=D.sqrt(s/d)*(D.cos(A)*E-D.sin(A)*N*8/d)}return f}var a=[72362614232,-7895059235,2423968531e-1,-2972611439e-3,15704.4826,-30.16036606].reverse(),o=[144725228442,2300535178,1858330474e-2,99447.43394,376.9991397,1].reverse(),u=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function c(d){var f=0,E=0,N=0,R=d*d,A=D.abs(d)-2.356194491;return Math.abs(d)<8?(E=d*ie(a,R),N=ie(o,R),f=E/N):(R=64/R,E=ie(u,R),N=ie(l,R),f=D.sqrt(s/D.abs(d))*(D.cos(A)*E-D.sin(A)*N*8/D.abs(d)),d<0&&(f=-f)),f}return function d(f,E){if(E=Math.round(E),!isFinite(f))return isNaN(f)?f:0;if(E<0)return(E%2?-1:1)*d(f,-E);if(f<0)return(E%2?-1:1)*d(-f,E);if(E===0)return i(f);if(E===1)return c(f);if(f===0)return 0;var N=0;if(f>E)N=Ec(f,E,i(f),c(f),-1);else{for(var R=2*D.floor((E+D.floor(D.sqrt(40*E)))/2),A=!1,S=0,y=0,C=1,O=0,te=2/f,j=R;j>0;j--)O=j*te*C-S,S=C,C=O,D.abs(C)>1e10&&(C*=1e-10,S*=1e-10,N*=1e-10,y*=1e-10),A&&(y+=C),A=!A,j==E&&(N=S);y=2*y-C,N/=y}return N}}(),IT=function(){var s=.636619772,e=[-2957821389,7062834065,-5123598036e-1,1087988129e-2,-86327.92757,228.4622733].reverse(),t=[40076544269,7452499648e-1,7189466438e-3,47447.2647,226.1030244,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),n=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934945152e-16].reverse();function i(d){var f=0,E=0,N=0,R=d*d,A=d-.785398164;return d<8?(E=ie(e,R),N=ie(t,R),f=E/N+s*oa(d,0)*D.log(d)):(R=64/R,E=ie(r,R),N=ie(n,R),f=D.sqrt(s/d)*(D.sin(A)*E+D.cos(A)*N*8/d)),f}var a=[-4900604943e3,127527439e4,-51534381390,7349264551e-1,-4237922726e-3,8511.937935].reverse(),o=[249958057e5,424441966400,3733650367,2245904002e-2,102042.605,354.9632885,1].reverse(),u=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function c(d){var f=0,E=0,N=0,R=d*d,A=d-2.356194491;return d<8?(E=d*ie(a,R),N=ie(o,R),f=E/N+s*(oa(d,1)*D.log(d)-1/d)):(R=64/R,E=ie(u,R),N=ie(l,R),f=D.sqrt(s/d)*(D.sin(A)*E+D.cos(A)*N*8/d)),f}return Rc(i,c,"BESSELY",1,-1)}(),ua=function(){var s=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),e=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse();function t(a){return a<=3.75?ie(s,a*a/(3.75*3.75)):D.exp(D.abs(a))/D.sqrt(D.abs(a))*ie(e,3.75/D.abs(a))}var r=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),n=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse();function i(a){return a<3.75?a*ie(r,a*a/(3.75*3.75)):(a<0?-1:1)*D.exp(D.abs(a))/D.sqrt(D.abs(a))*ie(n,3.75/D.abs(a))}return function a(o,u){if(u=Math.round(u),u===0)return t(o);if(u===1)return i(o);if(u<0)return NaN;if(D.abs(o)===0)return 0;if(o==1/0)return 1/0;var l=0,c,d=2/D.abs(o),f=0,E=1,N=0,R=2*D.round((u+D.round(D.sqrt(40*u)))/2);for(c=R;c>0;c--)N=c*d*E+f,f=E,E=N,D.abs(E)>1e10&&(E*=1e-10,f*=1e-10,l*=1e-10),c==u&&(l=f);return l*=a(o,0)/E,o<0&&u%2?-l:l}}(),OT=function(){var s=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),e=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();function t(a){return a<=2?-D.log(a/2)*ua(a,0)+ie(s,a*a/4):D.exp(-a)/D.sqrt(a)*ie(e,2/a)}var r=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),n=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();function i(a){return a<=2?D.log(a/2)*ua(a,1)+1/a*ie(r,a*a/4):D.exp(-a)/D.sqrt(a)*ie(n,2/a)}return Rc(t,i,"BESSELK",2,1)}();/**
 * @license
 Copyright (c) 2013 jStat

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 */function jr(s){const e=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let t=e.length-1,r=!1,n=0,i=0,a,o,u,l;if(s===0)return 0;for(s<0&&(s=-s,r=!0),a=2/(2+s),o=4*a-2;t>0;t--)u=n,n=o*n-i+e[t],i=u;return l=a*Math.exp(-s*s+.5*(e[0]+o*n)-i),r?l-1:1-l}function Tc(s){return 1-jr(s)}function Nc(s){let e=0,t,r,n,i;if(s>=2)return-100;if(s<=0)return 100;for(i=s<1?s:2-s,n=Math.sqrt(-2*Math.log(i/2)),t=-.70711*((2.30753+n*.27061)/(1+n*(.99229+n*.04481))-n);e<2;e++)r=Tc(t)-i,t+=r/(1.1283791670955126*Math.exp(-t*t)-t*r);return s<1?t:-t}const mu={pdf:(s,e)=>s<0?0:e*Math.exp(-e*s),cdf:(s,e)=>s<0?0:1-Math.exp(-e*s)};function Nn(s){const e=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],t=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let r=!1,n=0,i=0,a=0,o=s,u,l,c,d;if(s>171.6243769536076)return 1/0;if(o<=0)if(d=o%1,d)r=(o&1?-1:1)*Math.PI/Math.sin(Math.PI*d),o=1-o;else return 1/0;for(c=o,o<1?l=o++:l=(o-=n=(o|0)-1)-1,u=0;u<8;++u)a=(a+e[u])*l,i=i*l+t[u];if(d=a/i+1,c<o)d/=c;else if(c>o)for(u=0;u<n;++u)d*=o,o++;return r&&(d=r/d),d}const Mi={pdf:function(e,t,r){return e<0?0:e===0&&t===1?1/r:Math.exp((t-1)*Math.log(e)-e/r-ve(t)-t*Math.log(r))},cdf:function(e,t,r){return e<0?0:Ha(t,e/r)},inv:function(s,e,t){return Sc(s,e)*t}};function ve(s){let e=0;const t=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let r=1.000000000190015,n,i,a;for(a=(i=n=s)+5.5,a-=(n+.5)*Math.log(a);e<6;e++)r+=t[e]/++i;return Math.log(2.5066282746310007*r/n)-a}function Ha(s,e){const t=ve(s);let r=s,n=1/s,i=n,a=e+1-s,o=1/1e-30,u=1/a,l=u,c=1;const d=-~(Math.log(s>=1?s:1/s)*8.5+s*.4+17);let f;if(e<0||s<=0)return NaN;if(e<s+1){for(;c<=d;c++)n+=i*=e/++r;return n*Math.exp(-e+s*Math.log(e)-t)}for(;c<=d;c++)f=-c*(c-s),a+=2,u=f*u+a,o=a+f/o,u=1/u,l*=u*o;return 1-l*Math.exp(-e+s*Math.log(e)-t)}function Sc(s,e){let t=0;const r=e-1,n=1e-8,i=ve(e);let a,o,u,l,c,d,f;if(s>=1)return Math.max(100,e+100*Math.sqrt(e));if(s<=0)return 0;for(e>1?(d=Math.log(r),f=Math.exp(r*(d-1)-i),c=s<.5?s:1-s,u=Math.sqrt(-2*Math.log(c)),a=(2.30753+u*.27061)/(1+u*(.99229+u*.04481))-u,s<.5&&(a=-a),a=Math.max(.001,e*Math.pow(1-1/(9*e)-a/(3*Math.sqrt(e)),3))):(u=1-e*(.253+e*.12),s<u?a=Math.pow(s/u,1/e):a=1-Math.log(1-(s-u)/(1-u)));t<12;t++){if(a<=0)return 0;if(o=Ha(e,a)-s,e>1?u=f*Math.exp(-(a-r)+r*(Math.log(a)-d)):u=Math.exp(-a+r*Math.log(a)-i),l=o/u,a-=u=l/(1-.5*Math.min(1,l*((e-1)/a-1))),a<=0&&(a=.5*(a+u)),Math.abs(u)<n*a)break}return a}const Rt={pdf:function(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(e-t,2)/(2*r*r))},cdf:function(e,t,r){return .5*(1+jr((e-t)/Math.sqrt(2*r*r)))},inv:function(s,e,t){return-1.4142135623730951*t*Nc(2*s)+e}},wi={pdf:function(e,t,r){return e>1||e<0?0:t==1&&r==1?1:t<512&&r<512?Math.pow(e,t-1)*Math.pow(1-e,r-1)/Wa(t,r):Math.exp((t-1)*Math.log(e)+(r-1)*Math.log(1-e)-Ac(t,r))},cdf:function(e,t,r){return e>1||e<0?+(e>1):si(e,t,r)},inv:function(e,t,r){return Ya(e,t,r)}};function Wa(s,e){if(!(s<=0||e<=0))return s+e>170?Math.exp(Ac(s,e)):Nn(s)*Nn(e)/Nn(s+e)}function Ac(s,e){return ve(s)+ve(e)-ve(s+e)}function Ya(s,e,t){var r=1e-8,n=e-1,i=t-1,a=0,o,u,l,c,d,f,E,N,R,A,S;if(s<=0)return 0;if(s>=1)return 1;for(e>=1&&t>=1?(l=s<.5?s:1-s,c=Math.sqrt(-2*Math.log(l)),E=(2.30753+c*.27061)/(1+c*(.99229+c*.04481))-c,s<.5&&(E=-E),N=(E*E-3)/6,R=2/(1/(2*e-1)+1/(2*t-1)),A=E*Math.sqrt(N+R)/R-(1/(2*t-1)-1/(2*e-1))*(N+5/6-2/(3*R)),E=e/(e+t*Math.exp(2*A))):(o=Math.log(e/(e+t)),u=Math.log(t/(e+t)),c=Math.exp(e*o)/e,d=Math.exp(t*u)/t,A=c+d,s<c/A?E=Math.pow(e*A*s,1/e):E=1-Math.pow(t*A*(1-s),1/t)),S=-ve(e)-ve(t)+ve(e+t);a<10;a++){if(E===0||E===1)return E;if(f=si(E,e,t)-s,c=Math.exp(n*Math.log(E)+i*Math.log(1-E)+S),d=f/c,E-=c=d/(1-.5*Math.min(1,d*(n/E-i/(1-E)))),E<=0&&(E=.5*(E+c)),E>=1&&(E=.5*(E+c+1)),Math.abs(c)<r*E&&a>0)break}return E}function si(s,e,t){var r=s===0||s===1?0:Math.exp(ve(e+t)-ve(e)-ve(t)+e*Math.log(s)+t*Math.log(1-s));return s<0||s>1?!1:s<(e+1)/(e+t+2)?r*gu(s,e,t)/e:1-r*gu(1-s,t,e)/t}function gu(s,e,t){var r=1e-30,n=1,i=e+t,a=e+1,o=e-1,u=1,l=1-i*s/a,c,d,f,E;for(Math.abs(l)<r&&(l=r),l=1/l,E=l;n<=100&&(c=2*n,d=n*(t-n)*s/((o+c)*(e+c)),l=1+d*l,Math.abs(l)<r&&(l=r),u=1+d/u,Math.abs(u)<r&&(u=r),l=1/l,E*=l*u,d=-(e+n)*(i+n)*s/((e+c)*(a+c)),l=1+d*l,Math.abs(l)<r&&(l=r),u=1+d/u,Math.abs(u)<r&&(u=r),l=1/l,f=l*u,E*=f,!(Math.abs(f-1)<3e-7));n++);return E}const ms={pdf:function(s,e,t){return t===0||t===1?e*t===s?1:0:yc(e,s)*Math.pow(t,s)*Math.pow(1-t,e-s)},cdf:function(s,e,t){var r,n=1e-10;if(s<0)return 0;if(s>=e)return 1;if(t<0||t>1||e<=0)return NaN;s=Math.floor(s);var i=t,a=s+1,o=e-s,u=a+o,l=Math.exp(ve(u)-ve(o)-ve(a)+a*Math.log(i)+o*Math.log(1-i));return i<(a+1)/(u+2)?r=l*Eu(i,a,o,n):r=1-l*Eu(1-i,o,a,n),Math.round((1-r)*(1/n))/(1/n)}};function Eu(s,e,t,r){for(var n=0,i=1,a=1,o=1,u=0,l=0,c;Math.abs((a-l)/a)>r;)l=a,c=-(e+u)*(e+t+u)*s/(e+2*u)/(e+2*u+1),n=a+c*n,i=o+c*i,u=u+1,c=u*(t-u)*s/(e+2*u-1)/(e+2*u),a=n+c*a,o=i+c*o,n=n/o,i=i/o,a=a/o,o=1;return a/e}function yc(s,e){return s>170||e>170?Math.exp(MT(s,e)):gs(s)/gs(e)/gs(s-e)}function MT(s,e){return _i(s)-_i(e)-_i(s-e)}function _i(s){return s<0?NaN:ve(s+1)}function gs(s){return s<0?NaN:Nn(s+1)}const Dr={pdf:function(e,t){return e<0?0:e===0&&t===2?.5:Math.exp((t/2-1)*Math.log(e)-e/2-t/2*Math.log(2)-ve(t/2))},cdf:function(e,t){return e<0?0:Ha(t/2,e/2)},inv:function(s,e){return 2*Sc(s,.5*e)}},Br={pdf:function(e,t,r){var n,i,a;return e<0?0:t<=2?e===0&&t<2?1/0:e===0&&t===2?1:1/Wa(t/2,r/2)*Math.pow(t/r,t/2)*Math.pow(e,t/2-1)*Math.pow(1+t/r*e,-(t+r)/2):(n=t*e/(r+e*t),i=r/(r+e*t),a=t*i/2,a*ms.pdf((t-2)/2,(t+r-2)/2,n))},cdf:function(e,t,r){return e<0?0:si(t*e/(t*e+r),t/2,r/2)},inv:function(e,t,r){return r/(t*(1/Ya(e,t/2,r/2)-1))}},Ru={pdf:function(e,t,r){return e<0||t<0||r<0?0:r/t*Math.pow(e/t,r-1)*Math.exp(-Math.pow(e/t,r))},cdf:function(e,t,r){return e<0?0:1-Math.exp(-Math.pow(e/t,r))}},ha={pdf:function(e,t){return t<0||e%1!==0||e<0?0:Math.pow(t,e)*Math.exp(-t)/gs(e)},cdf:function(e,t){var r=0;if(e<0)return 0;for(var n=0;r<=e;r++)n+=ha.pdf(r,t);return n}},Ht={pdf:function(e,t,r,n){if(e<0||e<r-(t-n))return 0;if(e>n||e>r)return 0;if(r*2>t)return n*2>t?Ht.pdf(t-r-n+e,t,t-r,t-n):Ht.pdf(n-e,t,t-r,n);if(n*2>t)return Ht.pdf(r-e,t,r,t-n);if(r<n)return Ht.pdf(e,t,n,r);for(var i=1,a=0,o=0;o<e;o++){for(;i>1&&a<n;)i*=1-r/(t-a),a++;i*=(n-o)*(r-o)/((o+1)*(t-r-n+o+1))}for(;a<n;a++)i*=1-r/(t-a);return Math.min(1,Math.max(0,i))},cdf:function s(e,t,r,n){if(e<0||e<r-(t-n))return 0;if(e>=n||e>=r)return 1;if(r*2>t)return n*2>t?s(t-r-n+e,t,t-r,t-n):1-Ht.cdf(n-e-1,t,t-r,n);if(n*2>t)return 1-Ht.cdf(r-e-1,t,r,t-n);if(r<n)return Ht.cdf(e,t,n,r);for(var i=1,a=1,o=0,u=0;u<e;u++){for(;i>1&&o<n;){var l=1-r/(t-o);a*=l,i*=l,o++}a*=(n-u)*(r-u)/((u+1)*(t-r-n+u+1)),i+=a}for(;o<n;o++)i*=1-r/(t-o);return Math.min(1,Math.max(0,i))}},lt={pdf:function(e,t){return t=t>1e100?1e100:t,1/(Math.sqrt(t)*Wa(.5,t/2))*Math.pow(1+e*e/t,-((t+1)/2))},cdf:function(e,t){var r=t/2;return si((e+Math.sqrt(e*e+t))/(2*Math.sqrt(e*e+t)),r,r)},inv:function(s,e){var t=Ya(2*Math.min(s,1-s),.5*e,.5);return t=Math.sqrt(e*(1-t)/t),s>.5?t:-t}},Li={pdf:function(e,t,r){return e<=0?0:Math.exp(-Math.log(e)-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(Math.log(e)-t,2)/(2*r*r))},cdf:function(e,t,r){return e<0?0:.5+.5*jr((Math.log(e)-t)/Math.sqrt(2*r*r))},inv:function(s,e,t){return Math.exp(-1.4142135623730951*t*Nc(2*s)+e)}},la={pdf:function(e,t,r){return e!==e>>>0?!1:e<0?0:yc(e+t-1,t-1)*Math.pow(1-r,e)*Math.pow(r,t)},cdf:function(e,t,r){var n=0,i=0;if(e<0)return 0;for(;i<=e;i++)n+=la.pdf(i,t,r);return n}};function Cc(s){for(var e=0,t=s.length;--t>=0;)e+=s[t];return e}function ht(s){return Cc(s)/s.length}function gr(s){for(var e=ht(s),t=0,r=s.length,n;--r>=0;)n=s[r]-e,t+=n*n;return t}function hn(s,e){return gr(s)/(s.length-(e?1:0))}function rr(s,e){return Math.sqrt(hn(s,e))}function wT(){var s=[].slice.call(arguments),e=new Array(2),t;return s.length===4?t=Math.abs(Rt.inv(s[1]/2,0,1)*s[2]/Math.sqrt(s[3])):t=Math.abs(Rt.inv(s[1]/2,0,1)*rr(s[2])/Math.sqrt(s[2].length)),e[0]=s[0]-t,e[1]=s[0]+t,e}function _T(){var s=[].slice.call(arguments),e=new Array(2),t;return s.length===4?t=Math.abs(lt.inv(s[1]/2,s[3]-1)*s[2]/Math.sqrt(s[3])):t=Math.abs(lt.inv(s[1]/2,s[2].length-1)*rr(s[2],!0)/Math.sqrt(s[2].length)),e[0]=s[0]-t,e[1]=s[0]+t,e}function LT(s){for(var e=1,t=s.length;--t>=0;)e*=s[t];return e}function FT(s){return Math.pow(LT(s),1/s.length)}function ln(s,e){var t=ht(s),r=ht(e),n=s.length,i=new Array(n),a;for(a=0;a<n;a++)i[a]=(s[a]-t)*(e[a]-r);return Cc(i)/(n-1)}function Tu(s,e){return ln(s,e)/rr(s,1)/rr(e,1)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class za extends P{erf(e,t){return this.runFunction(e.args,t,this.metadata("ERF"),(r,n)=>n===void 0?jr(r):jr(n)-jr(r))}erfc(e,t){return this.runFunction(e.args,t,this.metadata("ERFC"),Tc)}expondist(e,t){return this.runFunction(e.args,t,this.metadata("EXPON.DIST"),(r,n,i)=>i?mu.cdf(r,n):mu.pdf(r,n))}fisher(e,t){return this.runFunction(e.args,t,this.metadata("FISHER"),r=>Math.log((1+r)/(1-r))/2)}fisherinv(e,t){return this.runFunction(e.args,t,this.metadata("FISHERINV"),r=>1-2/(Math.exp(2*r)+1))}gamma(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA"),Nn)}gammadist(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.DIST"),(r,n,i,a)=>a?Mi.cdf(r,n,i):Mi.pdf(r,n,i))}gammaln(e,t){return this.runFunction(e.args,t,this.metadata("GAMMALN"),ve)}gammainv(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.INV"),Mi.inv)}gauss(e,t){return this.runFunction(e.args,t,this.metadata("GAUSS"),r=>Rt.cdf(r,0,1)-.5)}betadist(e,t){return this.runFunction(e.args,t,this.metadata("BETA.DIST"),(r,n,i,a,o,u)=>r<=o?new p(m.NUM,T.ValueSmall):r>=u?new p(m.NUM,T.ValueLarge):(r=(r-o)/(u-o),a?wi.cdf(r,n,i):wi.pdf(r,n,i)))}betainv(e,t){return this.runFunction(e.args,t,this.metadata("BETA.INV"),(r,n,i,a,o)=>a>=o?new p(m.NUM,T.WrongOrder):wi.inv(r,n,i)*(o-a)+a)}binomialdist(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.DIST"),(r,n,i,a)=>r>n?new p(m.NUM,T.WrongOrder):(r=Math.trunc(r),n=Math.trunc(n),a?ms.cdf(r,n,i):ms.pdf(r,n,i)))}binomialinv(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.INV"),(r,n,i)=>{r=Math.trunc(r);let a=-1,o=r;for(;o>a+1;){const u=Math.trunc((a+o)/2);ms.cdf(u,r,n)>=i?o=u:a=u}return o})}besselifn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELI"),(r,n)=>ua(r,Math.trunc(n)))}besseljfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELJ"),(r,n)=>oa(r,Math.trunc(n)))}besselkfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELK"),(r,n)=>OT(r,Math.trunc(n)))}besselyfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELY"),(r,n)=>IT(r,Math.trunc(n)))}chisqdist(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST"),(r,n,i)=>(n=Math.trunc(n),i?Dr.cdf(r,n):Dr.pdf(r,n)))}chisqdistrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST.RT"),(r,n)=>1-Dr.cdf(r,Math.trunc(n)))}chisqinv(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV"),(r,n)=>Dr.inv(r,Math.trunc(n)))}chisqinvrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV.RT"),(r,n)=>Dr.inv(1-r,Math.trunc(n)))}fdist(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST"),(r,n,i,a)=>(n=Math.trunc(n),i=Math.trunc(i),a?Br.cdf(r,n,i):Br.pdf(r,n,i)))}fdistrt(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST.RT"),(r,n,i)=>1-Br.cdf(r,Math.trunc(n),Math.trunc(i)))}finv(e,t){return this.runFunction(e.args,t,this.metadata("F.INV"),(r,n,i)=>Br.inv(r,Math.trunc(n),Math.trunc(i)))}finvrt(e,t){return this.runFunction(e.args,t,this.metadata("F.INV.RT"),(r,n,i)=>Br.inv(1-r,Math.trunc(n),Math.trunc(i)))}weibulldist(e,t){return this.runFunction(e.args,t,this.metadata("WEIBULL.DIST"),(r,n,i,a)=>a?Ru.cdf(r,i,n):Ru.pdf(r,i,n))}poissondist(e,t){return this.runFunction(e.args,t,this.metadata("POISSON.DIST"),(r,n,i)=>(r=Math.trunc(r),i?ha.cdf(r,n):ha.pdf(r,n)))}hypgeomdist(e,t){return this.runFunction(e.args,t,this.metadata("HYPGEOM.DIST"),(r,n,i,a,o)=>r>n||r>i||n>a||i>a?new p(m.NUM,T.ValueLarge):r+a<i+n?new p(m.NUM,T.ValueLarge):(r=Math.trunc(r),n=Math.trunc(n),i=Math.trunc(i),a=Math.trunc(a),o?Ht.cdf(r,a,i,n):Ht.pdf(r,a,i,n)))}tdist(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST"),(r,n,i)=>(n=Math.trunc(n),i?lt.cdf(r,n):lt.pdf(r,n)))}tdist2t(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.2T"),(r,n)=>(1-lt.cdf(r,Math.trunc(n)))*2)}tdistrt(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.RT"),(r,n)=>1-lt.cdf(r,Math.trunc(n)))}tdistold(e,t){return this.runFunction(e.args,t,this.metadata("TDIST"),(r,n,i)=>i*(1-lt.cdf(r,Math.trunc(n))))}tinv(e,t){return this.runFunction(e.args,t,this.metadata("T.INV"),(r,n)=>lt.inv(r,Math.trunc(n)))}tinv2t(e,t){return this.runFunction(e.args,t,this.metadata("T.INV.2T"),(r,n)=>lt.inv(1-r/2,Math.trunc(n)))}lognormdist(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.DIST"),(r,n,i,a)=>a?Li.cdf(r,n,i):Li.pdf(r,n,i))}lognorminv(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.INV"),(r,n,i)=>Li.inv(r,n,i))}normdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.DIST"),(r,n,i,a)=>a?Rt.cdf(r,n,i):Rt.pdf(r,n,i))}norminv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.INV"),(r,n,i)=>Rt.inv(r,n,i))}normsdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.DIST"),(r,n)=>n?Rt.cdf(r,0,1):Rt.pdf(r,0,1))}normsinv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.INV"),r=>Rt.inv(r,0,1))}phi(e,t){return this.runFunction(e.args,t,this.metadata("PHI"),r=>Rt.pdf(r,0,1))}negbinomdist(e,t){return this.runFunction(e.args,t,this.metadata("NEGBINOM.DIST"),(r,n,i,a)=>(r=Math.trunc(r),n=Math.trunc(n),a?la.cdf(r,n,i):la.pdf(r,n,i)))}confidencenorm(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.NORM"),(r,n,i)=>wT(1,r,n,Math.trunc(i))[1]-1)}confidencet(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.T"),(r,n,i)=>(i=Math.trunc(i),i===1?new p(m.DIV_BY_ZERO):_T(1,r,n,i)[1]-1))}standardize(e,t){return this.runFunction(e.args,t,this.metadata("STANDARDIZE"),(r,n,i)=>(r-n)/i)}}za.implementedFunctions={ERF:{method:"erf",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}]},ERFC:{method:"erfc",parameters:[{argumentType:h.NUMBER}]},"EXPON.DIST":{method:"expondist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},FISHER:{method:"fisher",parameters:[{argumentType:h.NUMBER,greaterThan:-1,lessThan:1}]},FISHERINV:{method:"fisherinv",parameters:[{argumentType:h.NUMBER}]},GAMMA:{method:"gamma",parameters:[{argumentType:h.NUMBER}]},"GAMMA.DIST":{method:"gammadist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},GAMMALN:{method:"gammaln",parameters:[{argumentType:h.NUMBER,greaterThan:0}]},"GAMMA.INV":{method:"gammainv",parameters:[{argumentType:h.NUMBER,minValue:0,lessThan:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0}]},GAUSS:{method:"gauss",parameters:[{argumentType:h.NUMBER}]},"BETA.DIST":{method:"betadist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:1}]},"BETA.INV":{method:"betainv",parameters:[{argumentType:h.NUMBER,greaterThan:0,maxValue:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:1}]},"BINOM.DIST":{method:"binomialdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.BOOLEAN}]},"BINOM.INV":{method:"binomialinv",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,greaterThan:0,lessThan:1}]},BESSELI:{method:"besselifn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},BESSELJ:{method:"besseljfn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},BESSELK:{method:"besselkfn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},BESSELY:{method:"besselyfn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},"CHISQ.DIST":{method:"chisqdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1,maxValue:1e10},{argumentType:h.BOOLEAN}]},"CHISQ.DIST.RT":{method:"chisqdistrt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV":{method:"chisqinv",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV.RT":{method:"chisqinvrt",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1}]},"F.DIST":{method:"fdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1},{argumentType:h.BOOLEAN}]},"F.DIST.RT":{method:"fdistrt",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1}]},"F.INV":{method:"finv",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1}]},"F.INV.RT":{method:"finvrt",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1}]},"WEIBULL.DIST":{method:"weibulldist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"POISSON.DIST":{method:"poissondist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.BOOLEAN}]},"HYPGEOM.DIST":{method:"hypgeomdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"T.DIST":{method:"tdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1},{argumentType:h.BOOLEAN}]},"T.DIST.2T":{method:"tdist2t",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1}]},"T.DIST.RT":{method:"tdistrt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1}]},TDIST:{method:"tdistold",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.INTEGER,minValue:1,maxValue:2}]},"T.INV":{method:"tinv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER,minValue:1}]},"T.INV.2T":{method:"tinv2t",parameters:[{argumentType:h.NUMBER,greaterThan:0,maxValue:1},{argumentType:h.NUMBER,minValue:1}]},"LOGNORM.DIST":{method:"lognormdist",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"LOGNORM.INV":{method:"lognorminv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0}]},"NORM.DIST":{method:"normdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"NORM.INV":{method:"norminv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0}]},"NORM.S.DIST":{method:"normsdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.BOOLEAN}]},"NORM.S.INV":{method:"normsinv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1}]},PHI:{method:"phi",parameters:[{argumentType:h.NUMBER}]},"NEGBINOM.DIST":{method:"negbinomdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.BOOLEAN}]},"CONFIDENCE.NORM":{method:"confidencenorm",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,minValue:1}]},"CONFIDENCE.T":{method:"confidencet",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,minValue:1}]},STANDARDIZE:{method:"standardize",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0}]}};za.aliases={NEGBINOMDIST:"NEGBINOM.DIST",EXPONDIST:"EXPON.DIST",BETADIST:"BETA.DIST",NORMDIST:"NORM.DIST",NORMINV:"NORM.INV",NORMSDIST:"NORM.S.DIST",NORMSINV:"NORM.S.INV",LOGNORMDIST:"LOGNORM.DIST",LOGINV:"LOGNORM.INV",TINV:"T.INV.2T",HYPGEOMDIST:"HYPGEOM.DIST",POISSON:"POISSON.DIST",WEIBULL:"WEIBULL.DIST",FINV:"F.INV.RT",FDIST:"F.DIST.RT",CHIDIST:"CHISQ.DIST.RT",CHIINV:"CHISQ.INV.RT",GAMMADIST:"GAMMA.DIST","GAMMALN.PRECISE":"GAMMALN",GAMMAINV:"GAMMA.INV",BETAINV:"BETA.INV",BINOMDIST:"BINOM.DIST",CONFIDENCE:"CONFIDENCE.NORM",CRITBINOM:"BINOM.INV",WEIBULLDIST:"WEIBULL.DIST",TINV2T:"T.INV.2T",TDISTRT:"T.DIST.RT",TDIST2T:"T.DIST.2T",FINVRT:"F.INV.RT",FDISTRT:"F.DIST.RT",CHIDISTRT:"CHISQ.DIST.RT",CHIINVRT:"CHISQ.INV.RT",LOGNORMINV:"LOGNORM.INV",POISSONDIST:"POISSON.DIST"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class vc extends P{fact(e,t){return this.runFunction(e.args,t,this.metadata("FACT"),r=>{r=Math.trunc(r);let n=1;for(let i=1;i<=r;i++)n*=i;return n})}factdouble(e,t){return this.runFunction(e.args,t,this.metadata("FACTDOUBLE"),r=>{r=Math.trunc(r);let n=1;for(let i=r;i>=1;i-=2)n*=i;return n})}combin(e,t){return this.runFunction(e.args,t,this.metadata("COMBIN"),(r,n)=>n>r?new p(m.NUM,T.WrongOrder):(r=Math.trunc(r),n=Math.trunc(n),Nu(r,n)))}combina(e,t){return this.runFunction(e.args,t,this.metadata("COMBINA"),(r,n)=>(r=Math.trunc(r),n=Math.trunc(n),r+n-1>=1030?new p(m.NUM,T.ValueLarge):r===0&&n===0?1:Nu(r+n-1,n)))}gcd(e,t){return this.runFunction(e.args,t,this.metadata("GCD"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(r);if(n instanceof p)return n;let i=0;for(const a of n){if(a<0)return new p(m.NUM,T.ValueSmall);i=Ic(i,Math.trunc(a))}return i>Number.MAX_SAFE_INTEGER?new p(m.NUM,T.ValueLarge):i})}lcm(e,t){return this.runFunction(e.args,t,this.metadata("LCM"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(r);if(n instanceof p)return n;let i=1;for(const a of n){if(a<0)return new p(m.NUM,T.ValueSmall);i=UT(i,Math.trunc(a))}return i>Number.MAX_SAFE_INTEGER?new p(m.NUM,T.ValueLarge):i})}mround(e,t){return this.runFunction(e.args,t,this.metadata("MROUND"),(r,n)=>n===0?0:r>0&&n<0||r<0&&n>0?new p(m.NUM,T.DistinctSigns):Math.round(r/n)*n)}multinomial(e,t){return this.runFunction(e.args,t,this.metadata("MULTINOMIAL"),(...r)=>{let n=0,i=1;for(let a of r){if(a<0)return new p(m.NUM,T.ValueSmall);a=Math.trunc(a);for(let o=1;o<=a;o++)i*=(n+o)/o;n+=a}return Math.round(i)})}quotient(e,t){return this.runFunction(e.args,t,this.metadata("QUOTIENT"),(r,n)=>n===0?new p(m.DIV_BY_ZERO):Math.trunc(r/n))}seriessum(e,t){return this.runFunction(e.args,t,this.metadata("SERIESSUM"),(r,n,i,a)=>{const o=this.arithmeticHelper.manyToOnlyNumbersDropNulls(a.valuesFromTopLeftCorner());if(o instanceof p)return o;let u=0;o.reverse();for(const l of o)u*=Math.pow(r,i),u+=l;return u*Math.pow(r,n)})}sign(e,t){return this.runFunction(e.args,t,this.metadata("SIGN"),r=>r>0?1:r<0?-1:0)}sumx2my2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2MY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new p(m.NA,T.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const c=i[l],d=a[l];if(c instanceof p)return c;if(d instanceof p)return d;typeof c=="number"&&typeof d=="number"&&(u+=Math.pow(c,2)-Math.pow(d,2))}return u})}sumx2py2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2PY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new p(m.NA,T.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const c=i[l],d=a[l];if(c instanceof p)return c;if(d instanceof p)return d;typeof c=="number"&&typeof d=="number"&&(u+=Math.pow(c,2)+Math.pow(d,2))}return u})}sumxmy2(e,t){return this.runFunction(e.args,t,this.metadata("SUMXMY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new p(m.NA,T.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const c=i[l],d=a[l];if(c instanceof p)return c;if(d instanceof p)return d;typeof c=="number"&&typeof d=="number"&&(u+=Math.pow(c-d,2))}return u})}}vc.implementedFunctions={FACT:{method:"fact",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:170}]},FACTDOUBLE:{method:"factdouble",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:288}]},COMBIN:{method:"combin",parameters:[{argumentType:h.NUMBER,minValue:0,lessThan:1030},{argumentType:h.NUMBER,minValue:0}]},COMBINA:{method:"combina",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0}]},GCD:{method:"gcd",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},LCM:{method:"lcm",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MROUND:{method:"mround",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},MULTINOMIAL:{method:"multinomial",parameters:[{argumentType:h.NUMBER}],repeatLastArgs:1,expandRanges:!0},QUOTIENT:{method:"quotient",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},SERIESSUM:{method:"seriessum",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.RANGE}]},SIGN:{method:"sign",parameters:[{argumentType:h.NUMBER}]},SUMX2MY2:{method:"sumx2my2",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},SUMX2PY2:{method:"sumx2py2",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},SUMXMY2:{method:"sumxmy2",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]}};function Nu(s,e){2*e>s&&(e=s-e);let t=1;for(let r=1;r<=e;r++)t*=(s-e+r)/r;return Math.round(t)}function Ic(s,e){for(s<e&&([s,e]=[e,s]);e>0;)[s,e]=[e,s%e];return s}function UT(s,e){return s===0||e===0?0:s*(e/Ic(s,e))}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Oc extends P{complex(e,t){return this.runFunction(e.args,t,this.metadata("COMPLEX"),(r,n,i)=>i!=="i"&&i!=="j"?new p(m.VALUE,T.ShouldBeIorJ):ue([r,n],i))}imabs(e,t){return this.runFunction(e.args,t,this.metadata("IMABS"),_c)}imaginary(e,t){return this.runFunction(e.args,t,this.metadata("IMAGINARY"),([r,n])=>n)}imreal(e,t){return this.runFunction(e.args,t,this.metadata("IMREAL"),([r,n])=>r)}imargument(e,t){return this.runFunction(e.args,t,this.metadata("IMARGUMENT"),([r,n])=>r===0&&n===0?new p(m.DIV_BY_ZERO):Math.atan2(n,r))}imconjugate(e,t){return this.runFunction(e.args,t,this.metadata("IMCONJUGATE"),([r,n])=>ue([r,-n]))}imcos(e,t){return this.runFunction(e.args,t,this.metadata("IMCOS"),r=>ue(ns(r)))}imcosh(e,t){return this.runFunction(e.args,t,this.metadata("IMCOSH"),r=>ue(Su(r)))}imcot(e,t){return this.runFunction(e.args,t,this.metadata("IMCOT"),r=>ue(fr(ns(r),ss(r))))}imcsc(e,t){return this.runFunction(e.args,t,this.metadata("IMCSC"),r=>ue(fr([1,0],ss(r))))}imcsch(e,t){return this.runFunction(e.args,t,this.metadata("IMCSCH"),r=>ue(fr([1,0],Au(r))))}imsec(e,t){return this.runFunction(e.args,t,this.metadata("IMSEC"),r=>ue(fr([1,0],ns(r))))}imsech(e,t){return this.runFunction(e.args,t,this.metadata("IMSECH"),r=>ue(fr([1,0],Su(r))))}imsin(e,t){return this.runFunction(e.args,t,this.metadata("IMSIN"),r=>ue(ss(r)))}imsinh(e,t){return this.runFunction(e.args,t,this.metadata("IMSINH"),r=>ue(Au(r)))}imtan(e,t){return this.runFunction(e.args,t,this.metadata("IMTAN"),r=>ue(fr(ss(r),ns(r))))}imdiv(e,t){return this.runFunction(e.args,t,this.metadata("IMDIV"),(r,n)=>ue(fr(r,n)))}improduct(e,t){return this.runFunction(e.args,t,this.metadata("IMPRODUCT"),(...r)=>{const n=this.arithmeticHelper.coerceComplexExactRanges(r);if(n instanceof p)return n;let i=[1,0];for(const a of n)i=Mc(i,a);return ue(i)})}imsum(e,t){return this.runFunction(e.args,t,this.metadata("IMSUM"),(...r)=>{const n=this.arithmeticHelper.coerceComplexExactRanges(r);if(n instanceof p)return n;let i=[0,0];for(const a of n)i=bT(i,a);return ue(i)})}imsub(e,t){return this.runFunction(e.args,t,this.metadata("IMSUB"),(r,n)=>ue(xT(r,n)))}imexp(e,t){return this.runFunction(e.args,t,this.metadata("IMEXP"),r=>ue(wc(r)))}imln(e,t){return this.runFunction(e.args,t,this.metadata("IMLN"),r=>ue(Es(r)))}imlog10(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG10"),r=>{const[n,i]=Es(r),a=Math.log(10);return ue([n/a,i/a])})}imlog2(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG2"),r=>{const[n,i]=Es(r),a=Math.log(2);return ue([n/a,i/a])})}impower(e,t){return this.runFunction(e.args,t,this.metadata("IMPOWER"),(r,n)=>ue(yu(r,n)))}imsqrt(e,t){return this.runFunction(e.args,t,this.metadata("IMSQRT"),r=>ue(yu(r,.5)))}}Oc.implementedFunctions={COMPLEX:{method:"complex",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.STRING,defaultValue:"i"}]},IMABS:{method:"imabs",parameters:[{argumentType:h.COMPLEX}]},IMAGINARY:{method:"imaginary",parameters:[{argumentType:h.COMPLEX}]},IMREAL:{method:"imreal",parameters:[{argumentType:h.COMPLEX}]},IMARGUMENT:{method:"imargument",parameters:[{argumentType:h.COMPLEX}]},IMCONJUGATE:{method:"imconjugate",parameters:[{argumentType:h.COMPLEX}]},IMCOS:{method:"imcos",parameters:[{argumentType:h.COMPLEX}]},IMCOSH:{method:"imcosh",parameters:[{argumentType:h.COMPLEX}]},IMCOT:{method:"imcot",parameters:[{argumentType:h.COMPLEX}]},IMCSC:{method:"imcsc",parameters:[{argumentType:h.COMPLEX}]},IMCSCH:{method:"imcsch",parameters:[{argumentType:h.COMPLEX}]},IMSEC:{method:"imsec",parameters:[{argumentType:h.COMPLEX}]},IMSECH:{method:"imsech",parameters:[{argumentType:h.COMPLEX}]},IMSIN:{method:"imsin",parameters:[{argumentType:h.COMPLEX}]},IMSINH:{method:"imsinh",parameters:[{argumentType:h.COMPLEX}]},IMTAN:{method:"imtan",parameters:[{argumentType:h.COMPLEX}]},IMDIV:{method:"imdiv",parameters:[{argumentType:h.COMPLEX},{argumentType:h.COMPLEX}]},IMPRODUCT:{method:"improduct",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},IMSUM:{method:"imsum",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},IMSUB:{method:"imsub",parameters:[{argumentType:h.COMPLEX},{argumentType:h.COMPLEX}]},IMEXP:{method:"imexp",parameters:[{argumentType:h.COMPLEX}]},IMLN:{method:"imln",parameters:[{argumentType:h.COMPLEX}]},IMLOG10:{method:"imlog10",parameters:[{argumentType:h.COMPLEX}]},IMLOG2:{method:"imlog2",parameters:[{argumentType:h.COMPLEX}]},IMPOWER:{method:"impower",parameters:[{argumentType:h.COMPLEX},{argumentType:h.NUMBER}]},IMSQRT:{method:"imsqrt",parameters:[{argumentType:h.COMPLEX}]}};function bT([s,e],[t,r]){return[s+t,e+r]}function xT([s,e],[t,r]){return[s-t,e-r]}function Mc([s,e],[t,r]){return[s*t-e*r,s*r+t*e]}function fr([s,e],[t,r]){const n=Math.pow(t,2)+Math.pow(r,2),[i,a]=Mc([s,e],[t,-r]);return[i/n,a/n]}function ns([s,e]){return[Math.cos(s)*Math.cosh(e),-Math.sin(s)*Math.sinh(e)]}function Su([s,e]){return[Math.cosh(s)*Math.cos(e),Math.sinh(s)*Math.sin(e)]}function ss([s,e]){return[Math.sin(s)*Math.cosh(e),Math.cos(s)*Math.sinh(e)]}function Au([s,e]){return[Math.sinh(s)*Math.cos(e),Math.cosh(s)*Math.sin(e)]}function wc([s,e]){return[Math.exp(s)*Math.cos(e),Math.exp(s)*Math.sin(e)]}function _c([s,e]){return Math.sqrt(s*s+e*e)}function Es([s,e]){return[Math.log(_c([s,e])),Math.atan2(e,s)]}function yu(s,e){const[t,r]=Es(s);return wc([e*t,e*r])}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Xa extends P{avedev(e,t){return this.runFunction(e.args,t,this.metadata("AVEDEV"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof p)return n;if(n.length===0)return new p(m.DIV_BY_ZERO);const i=ht(n);return n.reduce((a,o)=>a+Math.abs(o-i),0)/n.length})}devsq(e,t){return this.runFunction(e.args,t,this.metadata("DEVSQ"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);return n instanceof p?n:n.length===0?0:gr(n)})}geomean(e,t){return this.runFunction(e.args,t,this.metadata("GEOMEAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof p)return n;if(n.length===0)return new p(m.NUM,T.OneValue);for(const i of n)if(i<=0)return new p(m.NUM,T.ValueSmall);return FT(n)})}harmean(e,t){return this.runFunction(e.args,t,this.metadata("HARMEAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof p)return n;if(n.length===0)return new p(m.NUM,T.OneValue);for(const i of n)if(i<=0)return new p(m.NUM,T.ValueSmall);return n.length/n.reduce((i,a)=>i+1/a,0)})}correl(e,t){return this.runFunction(e.args,t,this.metadata("CORREL"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=mr(r,n);return i instanceof p?i:i[0].length<=1?new p(m.DIV_BY_ZERO,T.TwoValues):Tu(i[0],i[1])})}rsq(e,t){return this.runFunction(e.args,t,this.metadata("RSQ"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=mr(r,n);return i instanceof p?i:i[0].length<=1?new p(m.DIV_BY_ZERO,T.TwoValues):Math.pow(Tu(i[0],i[1]),2)})}covariancep(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.P"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=mr(r,n);if(i instanceof p)return i;const a=i[0].length;return a<1?new p(m.DIV_BY_ZERO,T.OneValue):a===1?0:ln(i[0],i[1])*(a-1)/a})}covariances(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.S"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=mr(r,n);return i instanceof p?i:i[0].length<=1?new p(m.DIV_BY_ZERO,T.TwoValues):ln(i[0],i[1])})}ztest(e,t){return this.runFunction(e.args,t,this.metadata("Z.TEST"),(r,n,i)=>{const a=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());if(a instanceof p)return a;const o=a.length;if(i===void 0){if(o<2)return new p(m.DIV_BY_ZERO,T.TwoValues);i=rr(a,!0)}return o<1?new p(m.NA,T.OneValue):i===0?new p(m.DIV_BY_ZERO):1-Rt.cdf((ht(a)-n)/(i/Math.sqrt(o)),0,1)})}ftest(e,t){return this.runFunction(e.args,t,this.metadata("F.TEST"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner()),a=this.arithmeticHelper.manyToExactNumbers(n.valuesFromTopLeftCorner());if(i instanceof p)return i;if(a instanceof p)return a;if(i.length<=1||a.length<=1)return new p(m.DIV_BY_ZERO);const o=hn(i,!0),u=hn(a,!0);if(o===0||u===0)return new p(m.DIV_BY_ZERO);const l=o/u,c=Br.cdf(l,i.length-1,a.length-1);return 2*Math.min(c,1-c)})}steyx(e,t){return this.runFunction(e.args,t,this.metadata("STEYX"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=mr(r,n);if(i instanceof p)return i;const a=i[0].length;return a<=2?new p(m.DIV_BY_ZERO,T.ThreeValues):Math.sqrt((gr(i[0])-Math.pow(ln(i[0],i[1])*(a-1),2)/gr(i[1]))/(a-2))})}slope(e,t){return this.runFunction(e.args,t,this.metadata("SLOPE"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=mr(r,n);if(i instanceof p)return i;const a=i[0].length;return a<=1?new p(m.DIV_BY_ZERO,T.TwoValues):ln(i[0],i[1])*(a-1)/gr(i[1])})}chisqtest(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.TEST"),(r,n)=>{const i=r.height(),a=r.width();if(n.height()!==i||n.width()!==a)return new p(m.NA,T.EqualLength);const o=mr(r,n);if(o instanceof p)return o;if(o[0].length<=1)return new p(m.DIV_BY_ZERO,T.TwoValues);let u=0;for(let l=0;l<o[0].length;l++){if(o[1][l]===0)return new p(m.DIV_BY_ZERO);u+=Math.pow(o[0][l]-o[1][l],2)/o[1][l]}return u<0?new p(m.NUM,T.NaN):1-Dr.cdf(u,i>1&&a>1?(i-1)*(a-1):i*a-1)})}ttest(e,t){return this.runFunction(e.args,t,this.metadata("T.TEST"),(r,n,i,a)=>{const o=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner()),u=this.arithmeticHelper.manyToExactNumbers(n.valuesFromTopLeftCorner());if(o instanceof p)return o;if(u instanceof p)return u;const l=o.length,c=u.length;if(a===1){if(c!==l)return new p(m.NA,T.EqualLength);if(l<=1)return new p(m.DIV_BY_ZERO,T.TwoValues);const d=Array(l);for(let N=0;N<l;N++)d[N]=o[N]-u[N];const f=rr(d,!0);if(f===0)return new p(m.DIV_BY_ZERO);const E=Math.abs(Math.sqrt(l)*ht(d)/f);return i*(1-lt.cdf(E,l-1))}else if(a===2){if(l<=1||c<=1)return new p(m.DIV_BY_ZERO,T.TwoValues);const d=(gr(o)+gr(u))/(l+c-2);if(d===0)return new p(m.DIV_BY_ZERO);const f=Math.abs((ht(o)-ht(u))/Math.sqrt(d*(1/l+1/c)));return i*(1-lt.cdf(f,l+c-2))}else{if(l<=1||c<=1)return new p(m.DIV_BY_ZERO,T.TwoValues);const d=hn(o,!0),f=hn(u,!0);if(d===0&&f===0)return new p(m.DIV_BY_ZERO);const E=Math.abs((ht(o)-ht(u))/Math.sqrt(d/l+f/c)),N=Math.pow(d/l+f/c,2)/(Math.pow(d/l,2)/(l-1)+Math.pow(f/c,2)/(c-1));return i*(1-lt.cdf(E,N))}})}skew(e,t){return this.runFunction(e.args,t,this.metadata("SKEW"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof p)return n;const i=n.length;if(i<3)return new p(m.DIV_BY_ZERO,T.ThreeValues);const a=ht(n),o=rr(n,!0);return o===0?new p(m.DIV_BY_ZERO):n.reduce((u,l)=>u+Math.pow((l-a)/o,3),0)*i/(i-1)/(i-2)})}skewp(e,t){return this.runFunction(e.args,t,this.metadata("SKEW.P"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof p)return n;const i=n.length;if(i<3)return new p(m.DIV_BY_ZERO,T.ThreeValues);const a=ht(n),o=rr(n,!1);return o===0?new p(m.DIV_BY_ZERO):n.reduce((u,l)=>u+Math.pow((l-a)/o,3),0)/i})}}Xa.implementedFunctions={AVEDEV:{method:"avedev",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},DEVSQ:{method:"devsq",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},GEOMEAN:{method:"geomean",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},HARMEAN:{method:"harmean",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},CORREL:{method:"correl",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},RSQ:{method:"rsq",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"COVARIANCE.P":{method:"covariancep",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"COVARIANCE.S":{method:"covariances",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"Z.TEST":{method:"ztest",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}]},"F.TEST":{method:"ftest",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},STEYX:{method:"steyx",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},SLOPE:{method:"slope",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"CHISQ.TEST":{method:"chisqtest",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"T.TEST":{method:"ttest",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.INTEGER,minValue:1,maxValue:2},{argumentType:h.INTEGER,minValue:1,maxValue:3}]},SKEW:{method:"skew",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"SKEW.P":{method:"skewp",parameters:[{argumentType:h.ANY}],repeatLastArgs:1}};Xa.aliases={COVAR:"COVARIANCE.P",FTEST:"F.TEST",PEARSON:"CORREL",ZTEST:"Z.TEST",CHITEST:"CHISQ.TEST",TTEST:"T.TEST",COVARIANCEP:"COVARIANCE.P",COVARIANCES:"COVARIANCE.S",SKEWP:"SKEW.P"};function mr(s,e){const t=s.iterateValuesFromTopLeftCorner(),r=e.iterateValuesFromTopLeftCorner();let n,i;const a=[],o=[];for(;n=t.next(),i=r.next(),!n.done&&!i.done;){const u=n.value,l=i.value;if(u instanceof p)return u;if(l instanceof p)return l;z(u)&&z(l)&&(a.push(I(u)),o.push(I(l)))}return[a,o]}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Cu=Object.freeze(Object.defineProperty({__proto__:null,AbsPlugin:_l,AddressPlugin:Ml,ArrayPlugin:wl,BitShiftPlugin:Ll,BitwiseLogicOperationsPlugin:xl,BooleanPlugin:Pl,CharPlugin:Vl,CodePlugin:Dl,ComplexPlugin:Oc,ConditionalAggregationPlugin:lc,CountBlankPlugin:Bl,CountUniquePlugin:kl,DateTimePlugin:Gl,DegreesPlugin:Hl,DeltaPlugin:Wl,ExpPlugin:Yl,FinancialPlugin:zl,FormulaTextPlugin:Xl,HyperlinkPlugin:$l,InformationPlugin:Kl,IsEvenPlugin:jl,IsOddPlugin:ql,LogarithmPlugin:Ql,LookupPlugin:fc,MathConstantsPlugin:Zl,MathPlugin:vc,MatrixPlugin:Jl,MedianPlugin:ec,ModuloPlugin:tc,NumericAggregationPlugin:ka,PowerPlugin:rc,RadiansPlugin:nc,RadixConversionPlugin:ic,RandomPlugin:uc,RomanPlugin:mc,RoundingPlugin:Ga,SimpleArithmerticPlugin:gc,SqrtPlugin:hc,StatisticalAggregationPlugin:Xa,StatisticalPlugin:za,SumprodPlugin:cc,TextPlugin:dc,TrigonometryPlugin:pc},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class G extends Oe{}G.HyperFormula=Oe;G.ErrorType=m;G.CellError=p;G.CellType=He;G.CellValueType=St;G.CellValueDetailedType=gE;G.DetailedCellError=cl;G.ExportedCellChange=ra;G.ExportedNamedExpressionChange=yl;G.ConfigValueTooBigError=Jh;G.ConfigValueTooSmallError=Zh;G.EvaluationSuspendedError=tl;G.ExpectedOneOfValuesError=el;G.ExpectedValueOfTypeError=Y;G.ArraySize=V;G.SimpleRangeValue=w;G.EmptyValue=B;G.FunctionPlugin=P;G.FunctionArgumentType=h;G.FunctionPluginValidationError=Qr;G.InvalidAddressError=zh;G.InvalidArgumentsError=Re;G.LanguageNotRegisteredError=zi;G.LanguageAlreadyRegisteredError=nl;G.MissingTranslationError=Pr;G.NamedExpressionDoesNotExistError=In;G.NamedExpressionNameIsAlreadyTakenError=Xh;G.NamedExpressionNameIsInvalidError=$h;G.NoOperationToRedoError=jh;G.NoOperationToUndoError=Kh;G.NoRelativeAddressesAllowedError=xa;G.NoSheetWithIdError=ae;G.NoSheetWithNameError=Yh;G.NotAFormulaError=ds;G.NothingToPasteError=qh;G.ProtectedFunctionTranslationError=rl;G.SheetNameAlreadyTakenError=Cn;G.SheetSizeLimitExceededError=Nr;G.SourceLocationHasArrayError=Hr;G.TargetLocationHasArrayError=Us;G.UnableToParseError=Qh;const PT=rt.defaultConfig.language;Oe.registerLanguage(PT,na);Oe.languages[na.langCode]=na;for(const s of Object.getOwnPropertyNames(Cu))s.startsWith("_")||Oe.registerFunctionPlugin(Cu[s]);Ip(Dp);vu();const VT=({hotRef:s,search:e,columns:t,rowData:r,colorData:n,colorTextData:i,afterSelection:a,handleAfterColumnResize:o})=>{const{theme:u}=Lu();Ge.useEffect(()=>{const E=s.current?.hotInstance;if(!E||!r)return;let N=!1;n&&n.forEach((R,A)=>{R&&R.forEach((S,y)=>{const C=E.getCellMeta(A,y).backgroundColor,O=S||void 0;C!==O&&(E.setCellMeta(A,y,"backgroundColor",O),N=!0)})}),i&&i.forEach((R,A)=>{R&&R.forEach((S,y)=>{const C=E.getCellMeta(A,y).color,O=S||void 0;C!==O&&(E.setCellMeta(A,y,"color",O),N=!0)})}),N&&E.render()},[r,n,i,s]);const l=[],c=Ge.useMemo(()=>{if(!t)return;const E=[];return t.forEach((N,R)=>{N.select&&l.push({value:R,text:N.title,label:N.title}),E.push({...N,title:N.title})}),E},[t]),d=Ge.useMemo(()=>c&&c.map((E,N)=>{const{readOnly:R,...A}=E;let S={...A,theme:u,isFirstColumn:c.indexOf(E)===0,data:N,colorData:n,colorTextData:i};return E.type==="numeric"?S={...S,type:"numeric",numericFormat:{pattern:"0,0"},originalRenderer:k.renderers.NumericRenderer}:E.type==="date"?S={...S,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:BT},originalRenderer:k.renderers.DateRenderer}:E.type==="checkbox"?S={...S,type:"checkbox",className:"htCenter",originalRenderer:k.renderers.CheckboxRenderer}:S.originalRenderer=k.renderers.TextRenderer,{...S,renderer:DT}}),[c,r,u]),f=u==="dark"?"ht-theme-main-dark-auto":"ht-theme-main";return he.jsx("div",{className:"w-full",children:he.jsx(vp,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:s,data:r,themeName:f,rowHeaders:!0,language:"ko-KR",colHeaders:t&&t.map(E=>E.title),autoWrapRow:!0,height:"auto",contextMenu:!0,search:e,observeChanges:!0,columnSorting:!0,afterSelection:a,formulas:{engine:Oe.buildEmpty({licenseKey:"gpl-v3"})},columns:d,manualColumnResize:!0,afterColumnResize:o,colWidths:t.map(E=>E.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})})},DT=(s,e,t,r,n,i,a)=>{a.originalRenderer?a.originalRenderer.apply(void 0,[s,e,t,r,n,i,a]):k.renderers.TextRenderer.apply(void 0,[s,e,t,r,n,i,a]);const o=s.getSettings().search,u=a.theme,l=s.getCellMeta(t,r),c=a.backgroundColor||l.backgroundColor,d=a.color||l.color,f=a.colorData,E=a.colorTextData;e.style.backgroundColor="",e.style.color="",o&&i&&String(i).toLowerCase().includes(o.toLowerCase())?(e.style.backgroundColor=u==="dark"?"#facc15":"yellow",e.style.color="black"):(e.style.backgroundColor=c,c||(t%2===0?e.style.backgroundColor=u==="dark"?"#101010":"#ffffff":e.style.backgroundColor=u==="dark"?"#000000":"#f8f8f8")),d&&(e.style.color=d),f?.[t]?.[r]&&(e.style.backgroundColor=f[t]?.[r]),E?.[t]?.[r]&&(e.style.color=E[t]?.[r])},BT={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(s,e){const t=s.getDate(),r=s.getMonth()+1;return`${s.getFullYear()}-${r.toString().padStart(2,"0")}-${t.toString().padStart(2,"0")}`},parse(s,e){const t=s.split("-");return new Date(t[0],t[1]-1,t[2])}},HT=({rootDb:s,detailData:e})=>{console.log("MemoDetailGrid.detailData=",s,e);const{user:t}=Op(),{ui:r}=Lu(),{t:n}=Mp(),{sheetId:i}=wp(),[a,o]=Ge.useState([]),u=Ge.useRef(null);Ge.useRef(null);const[l,c]=Ge.useState([]),[d,f]=Ge.useState(void 0),[E,N]=Ge.useState(void 0),[R,A]=Ge.useState(""),[S,y]=Ge.useState({show:!1,message:""}),[C,O]=Ge.useState(""),[te,j]=Ge.useState(!0);if(Ge.useEffect(()=>{if(e){j(!0);const{columns:Ee,data:re,color:ne,textColor:X,memo:at}=e;o(Ee||[{title:"title",data:"title",type:"text"}]),O(at||"");const xe=re?Object.values(re).map(Pe=>typeof Pe=="string"?JSON.parse(Pe):Pe):[],ot=ne?Object.values(ne).map(Pe=>JSON.parse(Pe)):[],ke=X?Object.values(X).map(Pe=>JSON.parse(Pe)):[];c(xe),f(ot),N(ke),j(!1)}},[e]),t===void 0)return he.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:he.jsx(_p,{children:n("login_required")})});const q=()=>he.jsxs("div",{className:"pt-5",children:[he.jsx("div",{className:"mb-4 h-14 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),he.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 pb-2 items-end",children:he.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-900 rounded-md animate-shimmer relative overflow-hidden"})}),he.jsxs("div",{className:"mt-2 space-y-1",children:[he.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-900 rounded-t-md animate-shimmer relative overflow-hidden"}),[...Array(5)].map((Ee,re)=>he.jsx("div",{className:"h-8 bg-gray-300 dark:bg-zinc-800 rounded animate-shimmer relative overflow-hidden"},re))]})]});return te?he.jsx(q,{}):l===void 0||d===void 0||E===void 0?he.jsx(q,{}):he.jsxs("div",{className:"relative",children:[he.jsx(Lp,{children:S.show&&he.jsx(Fp.div,{initial:{y:"-100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"-100%",opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"fixed top-50 left-1/2 -translate-x-1/2 z-[2000] p-3 rounded-lg shadow-lg bg-green-500 text-white font-semibold",children:S.message})}),he.jsx("div",{className:"mb-4",children:he.jsx("div",{className:`${Up.card} p-4 min-h-[4rem] prose dark:prose-invert max-w-none`,children:C?he.jsx(bp,{children:C}):he.jsx("p",{className:"text-gray-400",children:n("double_click_to_edit_memo")})})}),he.jsx("div",{className:"group",children:he.jsx(VT,{hotRef:u,search:R,columns:a,rowData:l,colorData:d,colorTextData:E})})]})};export{HT as M,VT as T};
