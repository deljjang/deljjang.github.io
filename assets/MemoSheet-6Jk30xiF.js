import{r as g,j as e,x as h,k as J,h as W,Q as G,db as Z,ck as ee,bh as F,K,a4 as M,q as te,o as se,n as re,u as ae,z as ne,s as ie,i as oe,cM as T,br as le,bs as de,A as B,E as V,I as L,J as ce,bU as ue,bq as me}from"./index-DiQdSQsX.js";import{C as he}from"./ComponentCard-Du--9S37.js";const A=g.forwardRef(({size:_="md",color:k="default",name:a,placeholder:l,value:b,onChange:n,className:y="",allClassName:c="",min:u,max:m,step:x,disabled:N=!1,control:p,rules:C=null,defaultValue:i="",onKeyDownCapture:o,error:w,helperText:r,...f},E)=>{const z=p?._formState?.errors?.[a]?"error":k,I=P=>{n&&n(P)},R={sm:`h-9 px-3 py-2 ${h.textSm}`,md:`h-11 px-4 py-2.5 ${h.textSm}`,lg:"h-12 px-4 py-3 text-base"},q={default:"bg-transparent text-gray-800 border-gray-300 focus:border-brand-300 focus:ring-brand-500/20 dark:border-gray-700 dark:text-white/90 dark:focus:border-brand-800",success:"border-green-500 focus:border-green-300 focus:ring-green-500/20 dark:text-green-400 dark:border-green-500 dark:focus:border-green-800",error:"border-red-500 focus:border-red-300 focus:ring-red-500/20 dark:text-red-400 dark:border-red-500 dark:focus:border-red-800"},Q="text-gray-500 border-gray-300 bg-gray-100 cursor-not-allowed opacity-60 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700",D=`w-full ${h.roundedLg} border appearance-none shadow-theme-xs placeholder:text-gray-400 focus:outline-none focus:ring-3 dark:bg-zinc-950 dark:placeholder:text-white/30`;return e.jsxs("div",{className:`relative ${c}`,children:[e.jsx("input",{type:"text",name:a,placeholder:l,ref:E,onChange:I,min:u,max:m,step:x,disabled:N,onKeyDownCapture:o,className:`
          ${D}
          ${R[_]}
          ${N?Q:q[z]}
          ${y}
        `,...f}),r&&e.jsx("p",{className:`mt-1 ${h.textSm} text-red-600 dark:text-red-400`,children:r})]})});A.displayName="TwInputRef";const X=J.forwardRef(({title:_,children:k,className:a="",desc:l="",icon:b=null,isDraggable:n=!1},y)=>{const c=g.useRef(null),[u,m]=g.useState({x:0,y:0,isInitialized:!1}),[x,N]=g.useState(!1),p=g.useRef({x:0,y:0});g.useEffect(()=>{if(n&&c.current&&!u.isInitialized){const r=c.current.getBoundingClientRect(),f=window.innerWidth/2-672/2<=0?0:window.innerWidth/2-672/2;m({x:f,y:window.innerHeight/2-r.height/2,isInitialized:!0})}},[n,u.isInitialized]);const C=r=>{if(!n||!c.current)return;N(!0);const f=c.current.getBoundingClientRect();p.current={x:r.clientX-f.left,y:r.clientY-f.top},r.preventDefault()},i=r=>{if(!x)return;const f=r.clientX-p.current.x<=0?0:r.clientX-p.current.x,E=r.clientY-p.current.y<=120?120:r.clientY-p.current.y;m({...u,x:f,y:E})},o=()=>{N(!1)};g.useEffect(()=>(x?(window.addEventListener("mousemove",i),window.addEventListener("mouseup",o)):(window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",o)),()=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",o)}),[x]);const w=n?{position:"absolute",top:u.y,left:u.x,cursor:x?"grabbing":"default"}:{};return e.jsxs("div",{ref:r=>{c.current=r,y&&(y.current=r)},className:`MoveCard ${h.card} ${a}`,style:{...w},children:[e.jsxs("div",{className:`flex px-6 py-5 items-center ${n?"cursor-grab":""}`,onMouseDown:C,children:[b!==null?b:"",e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:`${h.textBase} ${h.fontMedium} text-gray-800 dark:text-white/90`,children:_}),l&&e.jsx("p",{className:`mt-1 ${h.textSm} text-gray-500 dark:text-gray-400`,children:l})]})]}),e.jsx("div",{className:`border-t border-gray-100 dark:border-gray-800 
        p-4 sm:p-6 overflow-x-auto`,children:e.jsx("div",{className:"space-y-6 whitespace-normal",children:k})})]})});X.displayName="MoveCard";const Y=g.forwardRef(({name:_,options:k,rules:a,control:l,placeholder:b="Select Option",className:n="",allClassName:y="",...c},u)=>e.jsxs("div",{className:`relative ${y}`,children:[e.jsxs("select",{className:`h-11 w-full appearance-none ${h.roundedLg} border border-gray-300 
          bg-transparent px-4 py-2.5 pr-11 text-sm shadow-theme-xs placeholder:text-gray-400 
          focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 
          dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:placeholder:text-white/30 
          dark:focus:border-brand-800 dark:bg-dark-900
          ${n}`,ref:u,...c,children:[e.jsx("option",{value:"",disabled:!0,className:"text-gray-700 dark:bg-zinc-950 dark:text-gray-400",children:b}),k.map(m=>e.jsx("option",{value:m.value,className:"text-gray-700 dark:bg-zinc-950 dark:text-gray-400",children:m.label},m.value))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 h-11",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}));Y.displayName="TwSelectRef";const xe=({isOpen:_,onClose:k,onCreate:a})=>{const l={visible:{opacity:1},hidden:{opacity:0}},b={hidden:{y:"-50px",opacity:0,scale:.95},visible:{y:"0",opacity:1,scale:1,transition:{duration:.2,ease:"easeOut"}},exit:{y:"50px",opacity:0,scale:.95,transition:{duration:.15,ease:"easeIn"}}},{t:n}=W(),{register:y,control:c,handleSubmit:u,formState:{errors:m}}=G({defaultValues:{title:"",columns:[{title:"col_0",type:"text",width:100,data:"col_0"},{title:"col_1",type:"text",width:100,data:"col_1"},{title:"col_2",type:"text",width:100,data:"col_2"}]}}),{fields:x,append:N,remove:p}=Z({control:c,name:"columns"}),C=[{value:"text",label:n("column_type_text")},{value:"numeric",label:n("column_type_numeric")},{value:"date",label:n("column_type_date")},{value:"checkbox",label:n("column_type_checkbox")}],i=o=>{if(!o.title||o.title.trim()===""){alert(n("sheet_title_required"));return}const w={...o,columns:o.columns.map((r,f)=>r.data&&(r.data==="id"||r.data==="title"||r.data==="description")?r:{...r,data:(r.title||"").toLowerCase().replace(/\s+/g,"_")||`col_${f}`})};a(w)};return e.jsx(ee,{children:_&&e.jsx(F.div,{className:"fixed inset-0 bg-black/70 bg-opacity-50 z-180 flex justify-center items-center",variants:l,initial:"hidden",animate:"visible",exit:"hidden",children:e.jsx(F.div,{variants:b,initial:"hidden",animate:"visible",exit:"exit",onClick:o=>o.stopPropagation(),children:e.jsx(X,{isDraggable:!0,className:"w-full max-w-sm sm:max-w-xl max-h-[61vh] overflow-y-auto",title:n("create_new_sheet"),children:e.jsxs("form",{onSubmit:u(i),children:[e.jsx("div",{className:"mb-4",children:e.jsx(A,{...y("title",{required:n("sheet_title_required")}),label:n("sheet_title"),placeholder:n("sheet_title_placeholder"),error:!!m.title,helperText:m.title?.message})}),e.jsx("h3",{className:"text-md font-semibold mb-2",children:n("columns")}),e.jsx("div",{className:"space-y-3",children:x.map((o,w)=>e.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-5 gap-2 items-center p-2 ${h.border} rounded-md`,children:[e.jsx("div",{className:"sm:col-span-2",children:e.jsx(K,{name:`columns.${w}.title`,control:c,defaultValue:o.title,render:({field:r})=>e.jsx(A,{...r,placeholder:n("column_title")})})}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(K,{name:`columns.${w}.type`,control:c,defaultValue:o.type,render:({field:r})=>e.jsx(Y,{...r,options:C,className:"dark:bg-gray-700"})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(M,{type:"button",size:"sm",color:"warning",onClick:()=>p(w),disabled:x.length<=1,children:n("delete")})})]},o.id))}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(M,{type:"button",onClick:()=>N({title:"",type:"text",data:""}),children:n("add_column")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{type:"button",variant:"outlined",onClick:k,children:n("cancel")}),e.jsx(M,{type:"submit",children:n("create")})]})]})]})})})})})};function ye({onDeleteTab:_}){const k=t=>{if(!t)return"";const s=new Date(t),d=s.getFullYear(),S=String(s.getMonth()+1).padStart(2,"0"),v=String(s.getDate()).padStart(2,"0"),$=String(s.getHours()).padStart(2,"0"),j=String(s.getMinutes()).padStart(2,"0");return`${d}-${S}-${v} ${$}:${j}`},{user:a}=te(),{t:l}=W(),b=se();re().sheetId;const[n,y]=g.useState(!1),[c,u]=g.useState(null),[m,x]=g.useState(""),[N,p]=g.useState({isOpen:!1}),{isExpanded:C}=ae(),i=ne();g.useEffect(()=>{ie({title:l("appSheet"),description:l("appSheet")})},[]);const o=(t=!0)=>a?new Promise(s=>{const d=B(V,`memo_sheet/${a.uid}`);me(d,S=>{const v=S.val(),$=v?Object.keys(v).map(j=>({id:j,...v[j]})):[];$.sort((j,U)=>(U.createdAt||0)-(j.createdAt||0)),s($)},{onlyOnce:!0})}):Promise.resolve([]),{data:w,isLoading:r}=oe({queryKey:["sheets",a?.uid],queryFn:()=>o(),enabled:!!a}),f=T({mutationFn:async t=>{const s=`memo_sheet/${a.uid}`,d=le(de(B(V),s)).key,S={title:t.title,columns:t.columns,createdAt:Date.now()};await L(`${s}/${d}`,S);const v=`memo_sheet_data/${a.uid}/${d}/data`,$={id:0,createdAt:Date.now()};return t.columns.forEach(j=>{j.data!=="id"&&j.data!=="createdAt"&&($[j.data]="")}),await L(`${v}/0`,$),$.id=1,await L(`${v}/1`,$),d},onSuccess:t=>{i.invalidateQueries({queryKey:["sheets",a?.uid]}),y(!1),b(`/m/sheet/${t}`)}}),E=T({mutationFn:t=>{const s=L(`memo_sheet/${a.uid}/${t}`,null),d=L(`memo_sheet_data/${a.uid}/${t}`,null);return Promise.all([s,d]).then(()=>t)},onMutate:async t=>{await i.cancelQueries({queryKey:["sheets",a?.uid]});const s=i.getQueryData(["sheets",a?.uid]);return i.setQueryData(["sheets",a?.uid],d=>d?.filter(S=>S.id!==t)),{previousSheets:s}},onError:(t,s,d)=>{i.setQueryData(["sheets",a?.uid],d.previousSheets)},onSettled:t=>{i.invalidateQueries({queryKey:["sheets",a?.uid]}),i.invalidateQueries({queryKey:["sheetData",t]})}}),O=T({mutationFn:({sheetId:t,title:s})=>L(`memo_sheet/${a.uid}/${t}/title`,s),onMutate:async({sheetId:t,title:s})=>{await i.cancelQueries({queryKey:["sheets",a?.uid]});const d=i.getQueryData(["sheets",a?.uid]);return i.setQueryData(["sheets",a?.uid],S=>S?.map(v=>v.id===t?{...v,title:s}:v)),u(null),x(""),{previousSheets:d}},onError:(t,s,d)=>{i.setQueryData(["sheets",a?.uid],d.previousSheets)},onSettled:()=>{i.invalidateQueries({queryKey:["sheets",a?.uid]})}}),z=t=>{b(`/m/sheet/${t}`)},I=async(t,s)=>{s.stopPropagation(),p({isOpen:!0,title:l("delete_confirm_title"),message:l("delete_confirm_message"),color:"warning",onConfirm:()=>{E.mutate(t),p({isOpen:!1})},onClose:()=>p({isOpen:!1})})},R=(t,s)=>{s.stopPropagation(),u(t.id),x(t.title)},q=t=>{t.stopPropagation(),u(null),x("")},Q=async(t,s)=>{if(s.stopPropagation(),!m.trim()){alert(l("sheet_title_required"));return}O.mutate({sheetId:t,title:m})},D=C?"grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3":"grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5",P=()=>e.jsx("div",{className:`grid ${D} gap-4`,children:Array.from({length:C?6:8}).map((t,s)=>e.jsxs("div",{className:`relative p-4 ${h.border} ${h.roundedSm}`,children:[e.jsx("div",{className:"flex h-8",children:e.jsx("div",{className:"h-6 w-3/4 bg-gray-200 dark:bg-zinc-800 rounded animate-shimmer relative overflow-hidden"})}),e.jsxs("div",{className:"flex justify-between items-baseline mt-2",children:[e.jsx("div",{className:"h-4 w-1/2 bg-gray-200 dark:bg-zinc-800 rounded animate-shimmer relative overflow-hidden"}),e.jsx("div",{className:"h-4 w-1/4 bg-gray-200 dark:bg-zinc-800 rounded animate-shimmer relative overflow-hidden"})]})]},s))});if(r||a===void 0)return e.jsx(P,{});const H=e.jsxs("div",{className:`${h.between}`,children:[e.jsx(ce,{className:"text-md",children:l("memo_sheet_list")}),e.jsx(M,{variant:"ghost",color:"sky",onClick:()=>y(!0),children:l("create_new_sheet")})]});return e.jsxs(he,{title:H,className:"my-5",children:[e.jsx(ue,{...N}),e.jsx(xe,{isOpen:n,onClose:()=>y(!1),onCreate:t=>f.mutate(t)}),e.jsx("div",{className:`grid ${D} gap-4`,children:w?.map(t=>e.jsx("div",{onClick:()=>c!==t.id&&z(t.id),className:`relative p-4 ${h.border} ${h.roundedSm} cursor-pointer hover:bg-gray-100 dark:hover:border-sky-500 dark:hover:bg-indigo-900/50 group`,children:c===t.id?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:s=>x(s.target.value),onClick:s=>s.stopPropagation(),className:"border p-2 rounded-md dark:bg-gray-700",autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(M,{size:"sm",variant:"outlined",onClick:q,children:l("cancel")}),e.jsx(M,{size:"sm",onClick:s=>Q(t.id,s),children:l("save")})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex h-8",children:[" ",e.jsx("h6",{className:" font-semibold pr-16 transition-transform duration-200 ease-in-out group-hover:scale-105 transform-origin-left dark:group-hover:text-lg",children:t.title})]}),e.jsxs("div",{className:"flex justify-between items-baseline mt-2 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"text-xs ",children:k(t.createdAt)}),e.jsxs("p",{className:"text-sm ",children:["(",t.count,")"]})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:s=>R(t,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})}),e.jsx("button",{onClick:s=>I(t.id,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},t.id))})]})}export{ye as default};
