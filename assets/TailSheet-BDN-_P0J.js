import{j as s,g as u,ac as ne,cN as oe,cO as re,cG as le,y as ae,F as ie,z as _,G as ce,P as ue,Q as de,D as z,H as fe,ap as me}from"./index-CzXCIlHy.js";import{I as he,T as H}from"./InputField-DW31gAMS.js";import{H as ge,r as xe}from"./registry-BXzRY6zr.js";import{D as ye}from"./datetime-BDx6lZXm.js";import{a as pe}from"./index.esm-8zpwlOwE.js";import{S as ve}from"./Select-DlIOkyp8.js";import{n as we}from"./handson-CS9Rir92.js";import{T as w}from"./TailButton-B_dISJpn.js";const Ce=i=>s.jsxs("div",{className:"my-2 flex justify-end items-center",sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[s.jsx(w,{size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:i.onInsert,children:"추가"}),s.jsx(w,{type:"button",size:"sm",variant:"outlined",color:"error",className:"mr-2",onClick:i.onDelete,children:"삭제"}),s.jsx(w,{type:"button",size:"sm",variant:"outlined",color:"success",className:"mr-2",onClick:i.onReload,children:"리로드"}),s.jsx(w,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:i.onCsvSave,children:"csv저장"})]});xe();const De=({csvFileName:i="exported_sheet",baseUrl:f="sheet",columns:h,selectDefault:C="1",keyId:O,userId:g})=>{const c=u.useRef(null),p=u.useRef(null),[j,B]=u.useState(),[G,F]=u.useState(0),{height:b,width:I}=ne(),R=u.useRef(!1),[S,V]=oe(re),{theme:K,settings:M,colWidths:A,setColWidths:D}=le();ye.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:L,reset:je,control:N,setValue:k,getValues:v,formState:{errors:U}}=pe({mode:"submit "}),q=K==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",Q=async e=>{const t=`${f}/${g}/`;if(e.id===void 0||e.id===null||e.id===""){const n=ue(de(_(z),t)).key;e.id=n}return setFireData(t+e.id+"/dv",e.dv),setFireData(t+e.id+"/title",e.title),setFireData(t+e.id+"/t1",e.t1),setFireData(t+e.id+"/t2",e.t2),setFireData(t+e.id+"/ing","1"),e},Z=async()=>{const e=`${f}/${g}/`,t=ae(_(z,e),ie("dv"));ce(t,n=>{if(!n.exists())return;const r=n.val(),l=[];for(let a in r){const o=r[a];o.id=a,o.sort=`${o.dv}_${o.title}`,l.push(o)}l.sort((a,o)=>a.sort>o.sort?1:-1),B(l),F(l.length)})};u.useEffect(()=>{L("filterField1"),k("columns1",C),console.log("SheetGrid.text=",S)},[]),u.useEffect(()=>{g!==void 0&&Z()},[g]),u.useEffect(()=>{I<500&&R.current===!1&&(R.current=!0,D([100,100,100,100,100,100]))},[I]),u.useEffect(()=>{c.current.hotInstance.addHook("afterColumnResize",function(t,n){const r=A;try{r[n]=t,D(r)}catch{D([130,300,100,100,100,100])}})},[c.current]);const J=async()=>{$()},X=async()=>{c.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:i,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},E=[],P={indicators:!0},T=[];h.map((e,t)=>{e.select&&E.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&T.push(t)}),P.columns=T;const $=()=>{try{const e=c.current?.hotInstance,t=e?.getPlugin("filters");if(t){const n=v("columns1");console.log("onKeyUp.columns1=",n,"text=",v("filterField1")),V(v("filterField1")),h.forEach((a,o)=>{t?.removeConditions(o)}),t?.addCondition(Number(n),"contains",[v("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",c.current);const l=e.getData().length;F(l)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function Y(){c.current.hotInstance.alter("insert_row_above",0,1)}const ee=async(e,t)=>{if(e===null)return;const n=c.current?.hotInstance,r=n?.getPlugin("filters");if(r==null)return;const l=n.getData(),a={};e.forEach(async(d,x)=>{a[d[0]]=d[0]}),console.log("afterChange.lines=",a);const o=[];Object.keys(a).map(d=>{const x=a[d];console.log("afterChange.lines.key=",d,", lines=",x);const y={};h.forEach(async(m,se)=>{y[m.data]=l[x][se]}),o.push(y)}),console.log("afterChange.saveData=",o),o.forEach(async(d,x)=>{const y=await Q(d);console.log("afterChange.result=",x,", result=",y),j.map(m=>{(m.id===void 0||m.id===null)&&(m.id=y?.id,console.log("afterChange.rowData2=",m))})}),n.render()},te=async()=>{const e=c.current.hotInstance;if(e&&p.current!==null){if(e?.getPlugin("filters")){const r=e.getData()[p.current][O];window.confirm("삭제하시겠습니까?")&&setFireData(`${f}/${g}/${r}`,null)}e.alter("remove_row",p.current,1)}},W=e=>{const t=e.target.value;k(e.target.name,t)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[s.jsx(ve,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:N,className:"dark:bg-dark-900",defaultValue:C||"1",options:E,error:!!U.columns1,onChange:W}),s.jsx(he,{name:"filterField1",control:N,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",onKeyUp:$,onChange:W,value:S})]}),s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[s.jsx(H,{textAlign:"left",children:"건수 : "+we(G)}),s.jsx(Ce,{onInsert:Y,onDelete:te,onReload:J,onCsvSave:X})]}),s.jsx("div",{className:"grid grid-cols-1",style:{maxHeight:`${b} - 210`,overflow:"auto"},children:s.jsx(ge,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:c,data:j,themeName:q,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:b-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:ee,afterSelection:e=>{p.current=e},columns:h,cells:(e,t)=>h[t].readOnly===!0?{readOnly:!0}:{},colWidths:M.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:P,licenseKey:"non-commercial-and-evaluation"})})]})};function Pe(){const{user:i}=fe(),f=[{title:"구분",data:"dv",readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"설명1",type:"text",data:"t1",select:!0},{title:"설명2",type:"text",data:"t2",select:!0},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];return i===void 0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:s.jsx(H,{children:"로그인을 해야 이용 가능합니다."})}):s.jsxs(s.Fragment,{children:[s.jsx(De,{csvFileName:"exported_sheet",baseUrl:"sheet",columns:f,selectDefault:"1",keyId:f.length-1,userId:i?.uid}),s.jsx(me,{})]})}export{Pe as default};
