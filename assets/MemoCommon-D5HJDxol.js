const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MemoMain-tPP3y2C9.js","assets/index-D1g6WeXe.js","assets/index-CWE2aPkw.css","assets/TailButton-BZr8PMJj.js"])))=>i.map(i=>d[i]);
import{z as be,D as $e,E as we,F as Ie,r as m,j as e,i as v,s as ke,J as q,M as Me,K as le,A as X,p as Te,N as Se,O as Ce,v as Q,w as Re,P as Le,q as U,Q as Be,t as De,R as Ne,U as Ee,m as Z,T as ce,V as _e,C as Fe,W as Pe,X as de,H as He,S as We,Y as Oe,Z as qe,y as Ke,$ as Ye,a0 as ee,a1 as te,a2 as Ge,a3 as Ae,a4 as ue,a5 as E,a6 as _,a7 as Ve,a8 as ze,a9 as me,aa as Qe,n as oe,ab as Ue,ac as Je,ad as Xe,ae as Ze,af as et,ag as tt,ah as W,o as ne,x as ot,ai as nt,aj as st,ak as se,al as at,am as it,an as rt,ao as lt,ap as ct,aq as dt,ar as ut,as as ae,at as mt}from"./index-D1g6WeXe.js";import{T as xt,C as ft,E as ht,a as gt,t as O}from"./TreeView-CG2QbxYx.js";import{F as pt}from"./Favorite-2bCUDcnQ.js";import{u as jt}from"./useSuspenseQuery-BIc7l24c.js";import{T as ie}from"./TailButton-BZr8PMJj.js";import{T as vt}from"./TailLayout-zHg42Omg.js";var N={},re;function yt(){if(re)return N;re=1;var t=be();Object.defineProperty(N,"__esModule",{value:!0}),N.default=void 0;var o=t($e()),n=we();return N.default=(0,o.default)((0,n.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder"),N}var bt=yt();const $t=Ie(bt),wt=ke(gt)(({theme:t})=>({color:t.palette.text.secondary,[`& .${O.content}`]:{color:t.palette.text.secondary,borderTopRightRadius:t.spacing(2),borderBottomRightRadius:t.spacing(2),paddingRight:t.spacing(1),fontWeight:t.typography.fontWeightMedium,"&.MuiTreeItem-content":{paddingLeft:"3px",paddingRight:"3px"},".MuiTreeItem-label":{paddingLeft:"0px"},".MuiTreeItem-iconContainer":{marginRight:"0px"},"&.Mui-expanded":{fontWeight:t.typography.fontWeightRegular},"&:hover":{backgroundColor:t.palette.action.hover},"&.Mui-selected":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},[`& .${O.label}`]:{fontWeight:"inherit",color:"inherit"}},[`& .${O.group}`]:{marginLeft:0,[`& .${O.content}`]:{paddingLeft:t.spacing(1)}}})),It=m.forwardRef(function(o,n){const{labelIcon:s,labelInfo:i,labelText:r,pl:l,...u}=o;return e.jsx(wt,{label:e.jsxs(v,{sx:{display:"flex",alignItems:"center",p:.5,pr:2,pl:{pl:l}},children:[e.jsx(v,{component:s,color:"inherit",sx:{mr:1,pl:{pl:l}}}),e.jsx(q,{sx:{fontWeight:"inherit",flexGrow:1},component:"div",children:r}),e.jsx(q,{variant:"caption",color:"inherit",children:i})]}),...u,ref:n})}),xe=t=>{const{id:o,fullIndex:n,title:s,sub:i}=t.item;if(o===void 0)return console.log("SubTreeItem.item.undefined=",t.item),e.jsx(e.Fragment,{});const r=i&&Object.values(i).length>0?Object.values(i).length+"":"";return e.jsx(It,{onClick:()=>t.onDetail(o,n),nodeId:o,labelText:s,labelInfo:r,pl:t.pl,children:i!=null?Object.values(i).sort((l,u)=>l.title>u.title?1:-1).map((l,u)=>e.jsx("div",{style:{paddingLeft:t.pl+5},children:e.jsx(xe,{onDetail:t.onDetail,item:l,pl:t.pl+5})},u+"")):""})};function fe(t){const[o,n]=m.useState([]),s=(r,l)=>{t.onDetail(r,l)},i=(r,l)=>{n(l)};return e.jsx(v,{sx:{minHeight:180,flexGrow:1,display:"flex",flexDirection:"column",height:t.maxHeight,overflow:"hidden",width:"100%"},children:e.jsx(xt,{"aria-label":"icon expansion",defaultCollapseIcon:e.jsx(ht,{}),defaultExpandIcon:e.jsx(ft,{}),expanded:o,onNodeToggle:i,sx:{flexGrow:1,overflow:"hidden",overflowY:"auto"},children:t.data&&t.data.map((r,l)=>e.jsx(xe,{onDetail:s,item:r,parentIndex:l+1,pl:5},l+1))})})}const kt={position:"absolute",top:"50%",left:"50%",display:"flex",flexDirection:"column",alignItems:"center",transform:"translate(-50%, -50%)",width:250,maxHeight:"400px",bgcolor:"background.paper",border:"1px solid #000",boxShadow:24,boxSizing:"border-box",p:4},Mt=t=>e.jsxs(v,{sx:{my:2,mt:3,display:"flex"},children:[e.jsx(X,{type:"submit",variant:"outlined",color:"success",onClick:t.onPost,children:"확인"}),e.jsx(X,{type:"button",variant:"outlined",onClick:t.onClose,children:"취소"})]}),Tt=t=>{const[o,n]=m.useState(t.open),[s,i]=m.useState(),r=()=>{n(!1),i(void 0),t.onClose()};m.useEffect(()=>{n(t.open)},[t.open]);const l=h=>{i(h)},u=()=>{if(s===void 0){alert("이동할 메모장을 선택해 주세요");return}t.onPost(s)};return e.jsx("div",{children:e.jsx(Me,{open:o,onClose:r,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(v,{sx:kt,children:[e.jsx(q,{id:"modal-modal-title",variant:"h6",component:"h2",children:"이동할 메모장 선택"}),e.jsx(le,{}),e.jsx(v,{sx:{width:"100%",minHeight:110,maxHeight:200,flexGrow:1,minWidth:100,overflow:"hidden"},children:e.jsx(fe,{data:t.data,onDetail:l,maxHeight:200})}),e.jsx(Mt,{onPost:u,onClose:r})]})})})},St=t=>{const{rootDb:o}=t,{title:n,gbn:s,date:i,text:r,image:l,setFireId:u,bookmark:h,setBookmark:c,isLoading:a,onReload:w}=Te(),{scrollYProgress:C}=Se(),F=Ce(C,{stiffness:100,damping:30,restDelta:.001}),[I,p]=m.useState(!1),[K,k]=m.useState(!1),P=Q(),M=m.useRef(),g=m.useRef();g.current=t.searchWord;const{memoId:x}=Re(),y=Le()?.state?.fullIndex,{user:d}=U(),{settings:Y,saveSettings:G}=Be(),R=()=>{M.current=!1,a===!1&&p(!0)},L=()=>{M.current=!0,a===!1&&p(!0)},B=async()=>{const f=o==="memo"?`${o}_txt/${d.uid}/${x}`:`${o}_txt/${x}`,j=o==="memo"?`${o}/${d.uid}`:o;if(await ze(f,j)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}const b=o==="/memo"?o:`/${o}mng`;P(b)},A=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&B()},D=()=>{p(!1)},V=()=>{k(!0)},H=()=>{const f=h==="Y"?"N":"Y";c(f),Ye(d.uid,x,f)},ge=async f=>{try{const j=o==="memo"?`${o}_txt/${d.uid}/${x}`:`${o}_txt/${x}`,S=o==="memo"?`memo/${d.uid}`:o,b=await Ve(j,S,x,f)}catch(j){console.log("catch",j)}finally{k(!1)}},pe=async(f,j)=>{const S=o==="memo"?`${o}_txt/${d.uid}/`:`${o}_txt/`,b=o==="memo"?`${o}/${d.uid}/`:`${o}/`,$=await ee(void 0,S,b,y,f);if(await te(`${o}_txt`,o,$,j),$!==void 0){const z=o==="memo"?`/${o}/${$}`:`/${o}mng/${$}`;P(z)}M.current=!1,p(!1),w()},je=async(f,j,S)=>{const b=o==="memo"?`${o}_txt/${d.uid}`:`${o}_txt`,$=o==="memo"?`${o}/${d.uid}`:o,z=await Ge(b,$,x,j);console.log("onPostSubmit.imageDelete",z),await ee(x,`${b}/`,`${$}/`,y,f),console.log("onPostSubmit.files=",S);const ye=await te(`${b}/`,`${$}/`,x,S);if(console.log("onNewSubmit.imageResult",ye),console.log("onPostSubmit.fullIndex",y),o==="memo"&&y===void 0){const J=await Ae(d.uid,`${x}/fullIndex`);J!==void 0&&ue(E(_,`memo/${d.uid}/${J}/title`),f.edTitle)}M.current=!1,p(!1),w()};m.useEffect(()=>{if(n.current!==void 0){const f=document.querySelector("title");f.innerHTML=`${De.templateName} :: ${n.current}`}},[n.current]),m.useEffect(()=>{d!=null&&x!==void 0&&(console.log("useEffect.user=",d?.uid),G({...Y,nodeId:x}),o==="memo"&&y!==void 0&&Ne(d.uid,x,y),u(o,d.uid,x,g.current)),p(!1)},[x,d]);function ve(){document.querySelectorAll("pre").forEach(f=>{f.innerHTML=Ke(f.innerHTML)})}return m.useEffect(()=>{r!==null&&ve()},[r]),x===""||d===void 0?e.jsx(e.Fragment,{}):e.jsxs(Ee.Fragment,{children:[e.jsx(Z.div,{className:"progress-bar",style:{scaleX:F}}),e.jsxs(ce,{style:{display:"flex",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"space-between"},children:[e.jsx("div",{}),e.jsx("div",{children:n.current}),e.jsx(Z.div,{whileHover:{scale:1.1},whileTap:{scale:.8},initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:.5,ease:[0,.71,.2,1.01],scale:{type:"spring",damping:2,stiffness:100,restDelta:.001}},children:e.jsx(_e,{"aria-label":"bookmark",onClick:H,children:h==="Y"?e.jsx(pt,{sx:{color:"red"}}):e.jsx($t,{})})})]}),e.jsxs(Fe,{className:"container",sx:{p:0,width:"100%"},children:[!I&&e.jsx(Pe,{onEdit:R,onNewMemo:L,onMove:V,onDelete:A,onBookmark:H,bookmark:h}),I&&e.jsx(de,{newMode:M.current,onPostSubmit:je,onNewSubmit:pe,onCancel:D,title:n.current,gbn:s.current,date:i.current,content:r,imageList:l}),e.jsxs(v,{sx:{my:2},children:[e.jsx(He,{show:!I,text:r}),!I&&e.jsx(We,{imageList:l,show:!I}),a&&e.jsx(v,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx(Oe,{sx:{mt:5}})})]}),e.jsx(Tt,{userId:d?.uid,open:K,data:t.data,onClose:()=>k(!1),onPost:ge})]}),e.jsx(qe,{})]})};async function Ct(t,o,n=""){if(o==null||o==="")return"";let s=n===""?`${t}/${o}`:`${t}_txt/${o}`;t==="home"&&(s="home_txt");const i=me(E(_,s)),r=await Qe(i);if(!r.exists()){console.log("getTreeData.null");return}if(!r.exists()){console.log("getTreeData.exists");return}const l=r.val(),u=[],h={};t==="home"&&(oe.map(c=>{u.push({title:c.label,id:c.id,sub:[]})}),oe.map(c=>{h[c.id]=[]}));for(const c in l){const a=l[c];a.up===void 0?(a.id=c,a.fullIndex=c):(a.id=a.up,a.fullIndex=a.up),t==="home"?a.gbn!==void 0&&h[a.gbn].push(a):n===""||n===void 0?(a.sub!==null&&(a.children=he(a,a.up)),u.push(a)):(a.id=c,(a.memo+"").toLowerCase().indexOf(n.toLowerCase())>-1&&u.push(a))}return t==="home"?Object.values(h).map((c,a)=>{c.sort((w,C)=>w.title>C.title?1:-1),u[a].sub=c}):u.sort((c,a)=>c.title>a.title?1:-1),u}function he(t,o){const n=[];if(t===void 0||t.sub===void 0)return n;for(let s in t.sub){let i=t.sub[s];i.id=s,i.key=s}return Object.values(t.sub).sort((s,i)=>i.title-s.title).map(s=>{s.id=s.key,s.fullIndex=o+"/sub/"+s.key,s.sub!==null&&(s.children=he(s,s.fullIndex)),n.push(s)}),n}const Rt=t=>{const[o,n]=m.useState([]),s=()=>{const i=me(E(_,`memo_txt/${t}`),Je("bookmark"),Ue("Y"));Xe(i,r=>{if(!r.exists())return;const l=r.val(),u=[];for(let h in l){const c=l[h];c.key=h,u.push(c)}u.sort((h,c)=>h.title>c.title?1:-1),n(u)})};return m.useEffect(()=>{s()},[t]),o};function Lt(t){const{user:o}=U(),n=Q(),s=Rt(o?.uid);return o===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center",sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"100%"},children:[e.jsx(le,{}),e.jsx(ce,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((i,r)=>e.jsx("div",{children:e.jsx(Ze,{component:"button",variant:"body",onClick:()=>{t.onSelected(i.key),n(`/memo/${i.key}`)},children:e.jsx(q,{variant:"body1",children:i.title})})},r))})]})}const Bt=t=>{const o=m.useRef(null);function n(){t.onSearchDataBtn(o.current.value)}function s(){return t.onNewMemoBtn(),!1}function i(r){r.which===13&&n()}return e.jsxs(e.Fragment,{children:[e.jsx(et,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:o,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:i}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(ie,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:s,children:"새글"}),e.jsx(ie,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:n,children:"조회"})]})]})},Dt=({className:t="",children:o})=>e.jsx("h4",{className:`mb-2 text-lg font-semibold text-center text-gray-800 dark:text-white/90 
      ${t}}
      `,children:o}),Nt=220,Et=m.lazy(async()=>await at(()=>import("./MemoMain-tPP3y2C9.js"),__vite__mapDeps([0,1,2,3]))),qt=({rootDb:t})=>{const o=Q(),{user:n}=U(),[s,i]=m.useState(!1),r=m.useRef(),[l,u]=m.useState(""),h=m.useRef(),c=m.useRef(!1),a=jt({queryKey:["treeMemo",n?.uid,r.current],queryFn:()=>Ct(t,n?.uid,r.current)});a.data!==void 0&&a.data!==""&&!c.current&&(c.current=!0),m.useEffect(()=>{n!==void 0&&n!=null&&a.refetch()},[n]);const w=g=>{c.current=!1,r.current=g,a.refetch()},C=(g,x)=>{h.current=x,u(g);const T=t==="memo"?`/${t}/${g}`:`/home/${g}`;o(T,{state:{fullIndex:x}})},F=()=>{if(n==null){alert("로그인 후 이용 가능합니다.");return}i(!0)},I=()=>{i(!1)},p=async(g,x)=>{const T=t==="memo"?`${t}_txt/${n.uid}/`:`${t}_txt/`,y=t==="memo"?`${t}/${n.uid}/`:`${t}/`;for(let R=0;R<x.length;R++){const L=x[R].object,B=it(L.name),A={ext:B,name:L.name,use:"Y"},D=rt(lt(E(_),T+"image")).key;ue(E(_,T+`image/${D}`),A);const V=t==="memo"?`memo/${n.uid}/${l}/${D}.${B}`:`home/${homeId}/${D}.${B}`,H=ct(mt,V);await dt(H,L)}const d=ut(T),Y={title:g.edTitle,date:g.edDate,gbn:g.edGbn,memo:g.content,fullIndex:d,up:d,bookmark:"N"};ae(`${T}${d}`,Y);const G={gbn:"",property:"m",title:g.edTitle,up:d};ae(`${y}${d}`,G),i(!1)},K=g=>{u(g)},{height:k,width:P}=tt(),M=e.jsxs("div",{className:"",children:[e.jsx(Dt,{className:"mt-3 ",children:t==="memo"?"메모장":"홈페이지관리"}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[e.jsx(W,{to:"/",children:"홈"}),t==="memo"?"":e.jsx(W,{to:"/memo",children:"메모"}),e.jsx(W,{to:"/todo",children:"TODO"}),e.jsx(W,{to:"/tail",children:"Sheet"})]}),e.jsx(Bt,{onNewMemoBtn:F,onSearchDataBtn:w}),e.jsx(v,{sx:{flexGrow:1,minWidth:100,minHeight:110,maxHeight:k-220,height:k-220},children:c.current&&a.isFetched?e.jsx(fe,{data:a.data,onDetail:C,maxHeight:k-150}):e.jsx(ne,{})})]});return n&&n.uid===ot&&nt,e.jsxs(vt,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",drawerWidth:Nt,width:P,sideContents:M,children:[!s&&e.jsx(m.Suspense,{fallback:e.jsx(ne,{}),children:e.jsxs(st,{children:[e.jsx(se,{path:"/:memoId",element:e.jsx(St,{rootDb:t,searchWord:r.current,data:a.data})}),e.jsx(se,{path:"*",element:e.jsx(Et,{searchWord:r.current,data:a.data,onNewMemoBtn:F,title:t==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),s&&e.jsx(de,{show:s,newMode:s.current,onPostSubmit:p,onNewSubmit:p,onCancel:I,title:"",content:"",imageList:[]}),t==="memo"?e.jsx(Lt,{onSelected:K}):""]})};export{qt as M};
