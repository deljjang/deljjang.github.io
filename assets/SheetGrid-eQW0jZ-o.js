import{h as M,j as s,bF as C,p as de,bW as O,r as d,bX as me,bh as fe,bY as he,aL as ge,N as xe,H as V,bC as pe,bB as ye,q as ve,O as be,bZ as we,b_ as je,z as K,A as L,b$ as Ce,G as x,c0 as Ne,c1 as Ie,Q as ke}from"./index-D_7jOBRN.js";import{A as N}from"./AniButton-By21d0ee.js";const De=({ui:I,onInsert:f,onDelete:h,onReload:y,onCsvSave:m})=>{const{t:i}=M();return I==="tailwind"?s.jsxs("div",{className:"my-2 flex justify-end items-center",children:[s.jsx(C,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:f,children:i("input")}),s.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:h,children:i("delete")}),s.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:y,children:i("reload")}),s.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:m,children:i("csv_save")})]}):s.jsxs("div",{className:"my-2 flex justify-end items-center gap-1",children:[s.jsx(N,{type:"button",size:"small",variant:"outlined",color:"warning",className:"mr-2",onClick:f,children:i("input")}),s.jsx(N,{type:"button",size:"small",variant:"outlined",color:"error",className:"mr-2",onClick:h,children:i("delete")}),s.jsx(N,{type:"button",size:"small",variant:"outlined",color:"success",className:"mr-2",onClick:y,children:i("reload")}),s.jsx(N,{type:"button",size:"small",variant:"outlined",color:"success",onClick:m,children:i("csv_save")})]})},p=[{title:"division",data:"dv",readOnly:!1,select:!0},{title:"title",type:"text",data:"title",select:!0},{title:"description1",type:"text",data:"t1",select:!0},{title:"description2",type:"text",data:"t2",select:!0},{title:"sort",type:"text",data:"sort",select:!1,hidden:!0},{title:"id",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];ke();const Ee=({csvFileName:I="exported_sheet",baseUrl:f="sheet",selectDefault:h="1"})=>{const{user:y}=de(),m=y?.uid,{ui:i}=O(),{t:c}=M(),q=p.length-1,a=d.useRef(null),b=d.useRef(null),[R,G]=d.useState(),[Z,_]=d.useState(0),{height:F,width:E}=me(),S=d.useRef(!1),[Q,U]=fe(he),{theme:X,settings:Y,colWidths:J,setColWidths:k}=O();ge.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:ee,reset:Re,control:z,setValue:$,getValues:w,formState:{errors:te}}=xe({mode:"submit "}),se=X==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",ne=async e=>{const t=`${f}/${m}/`;if(e.id===void 0||e.id===null||e.id===""){const n=Ne(Ie(K(L),t)).key;e.id=n}return x(t+e.id+"/dv",e.dv),x(t+e.id+"/title",e.title),x(t+e.id+"/t1",e.t1),x(t+e.id+"/t2",e.t2),x(t+e.id+"/ing","1"),e},oe=async()=>{const e=`${f}/${m}/`,t=we(K(L,e),je("dv"));Ce(t,n=>{if(!n.exists())return;const r=n.val(),l=[];for(let u in r){const o=r[u];o.id=u,o.sort=`${o.dv}_${o.title}`,l.push(o)}l.sort((u,o)=>u.sort>o.sort?1:-1),G(l),_(l.length)})};d.useEffect(()=>{ee("filterField1"),$("columns1",h)},[]),d.useEffect(()=>{m!==void 0&&oe()},[m]),d.useEffect(()=>{E<500&&S.current===!1&&(S.current=!0,k([100,100,100,100,100,100]))},[E]),d.useEffect(()=>{a.current.hotInstance.addHook("afterColumnResize",function(t,n){const r=J;try{r[n]=t,k(r)}catch{k([130,300,100,100,100,100])}})},[a.current]);const re=async()=>{A()},le=async()=>{a.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:I,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},P=[],T={indicators:!0},W=[],B=[];p.map((e,t)=>{e.select&&P.push({value:t,text:c(e.title),label:c(e.title)}),B.push({...e,title:c(e.title)}),e.hidden===!0&&W.push(t)}),T.columns=W;const A=()=>{try{const e=a.current?.hotInstance,t=e?.getPlugin("filters");if(t){const n=w("columns1");console.log("onKeyUp.columns1=",n,"text=",w("filterField1")),U(w("filterField1")),p.forEach((u,o)=>{t?.removeConditions(o)}),t?.addCondition(Number(n),"contains",[w("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",a.current);const l=e.getData().length;_(l)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function ie(){a.current.hotInstance.alter("insert_row_above",0,1)}const ce=async(e,t)=>{if(e===null)return;const n=a.current?.hotInstance,r=n?.getPlugin("filters");if(r==null)return;const l=n.getData(),u={};e.forEach(async(g,D)=>{u[g[0]]=g[0]});const o=[];Object.keys(u).map(g=>{const D=u[g],j={};p.forEach(async(v,ue)=>{j[v.data]=l[D][ue]}),o.push(j)}),o.forEach(async(g,D)=>{const j=await ne(g);R.map(v=>{(v.id===void 0||v.id===null)&&(v.id=j?.id)})}),n.render()},ae=async()=>{const e=a.current.hotInstance;if(e&&b.current!==null){if(e?.getPlugin("filters")){const r=e.getData()[b.current][q],l=c("delete_confirm_message");window.confirm(l)&&x(`${f}/${m}/${r}`,null)}e.alter("remove_row",b.current,1)}},H=e=>{const t=e.target.value;$(e.target.name,t)};return y===void 0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:s.jsx(V,{children:c("login_required")})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[s.jsx(pe,{id:"columns1",name:"columns1",placeholder:c("search_column"),control:z,className:"dark:bg-dark-900",defaultValue:h||"1",options:P,error:!!te.columns1,onChange:H}),s.jsx(ye,{name:"filterField1",control:z,label:c("search"),placeholder:c("search_placeholder"),variant:"filled",margin:"none",onKeyUp:A,onChange:H,value:Q})]}),s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[s.jsx(V,{textAlign:"left",children:c("count")+" : "+ve(Z)}),s.jsx(De,{ui:i,onInsert:ie,onDelete:ae,onReload:re,onCsvSave:le})]}),s.jsx("div",{className:"w-full",style:{maxHeight:`${F} - 210`,overflow:"auto"},children:s.jsx(be,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:a,data:R,themeName:se,rowHeaders:!0,colHeaders:p.map(e=>c(e.title)),autoWrapRow:!0,height:F-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:ce,afterSelection:e=>{b.current=e},columns:B,cells:(e,t)=>p[t].readOnly===!0?{readOnly:!0}:{},colWidths:Y.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:T,licenseKey:"non-commercial-and-evaluation"})})]})};export{Ee as S};
