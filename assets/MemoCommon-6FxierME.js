const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MemoMain-D3oa1cMG.js","assets/index-DSTFP3D0.js","assets/index-tNAb4i4P.css","assets/TailButton-ti9wy14p.js"])))=>i.map(i=>d[i]);
import{f as $,c as ye,r as ze,p as Fe,v as _e,i as Ae,d as qe,a as Ve,b as je,n as Ye,s as Ge,u as be,e as we,g as f,w as Ke,m as W,M as ke,h as oe,k as Ue,l as Xe,o as Je,q as Qe,t as Ze,j as i,B as I,x as et,T as U,y as Se,z as Ie,A as tt,C as ie,D as Te,E as nt,F as st,G as ot,H as X,I as J,J as Me,K as it,L as rt,N as lt,O as at,P as L,Q as Ee,R as te,S as $e,U as O,V as re,W as ct,X as ut,Y as dt,Z as ft,_ as mt,$ as Le,a0 as ht,a1 as xt,a2 as gt,a3 as pt,a4 as vt,a5 as yt,a6 as le,a7 as ae,a8 as jt,a9 as bt,aa as wt,ab as kt,ac as St,ad as q,ae as It,af as Tt,ag as Mt,ah as V,ai as Et,aj as $t,ak as Lt,al as Ct,am as Dt}from"./index-DSTFP3D0.js";import{T as Bt,C as Nt,E as Rt,a as Wt,t as Y}from"./TreeView-Dle0RYFk.js";import{T as ce}from"./TailButton-ti9wy14p.js";import{T as Ht}from"./TailLayout-CKDxGMbQ.js";import{F as Ot}from"./Favorite-FFtrnyGr.js";function Ce(e,n){let s;const t=()=>{const{currentTime:o}=n,c=(o===null?0:o.value)/100;s!==c&&e(c),s=c};return $.update(t,!0),()=>ye(t)}const G=new WeakMap;let M;function Pt(e,n){if(n){const{inlineSize:s,blockSize:t}=n[0];return{width:s,height:t}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function zt({target:e,contentRect:n,borderBoxSize:s}){var t;(t=G.get(e))===null||t===void 0||t.forEach(o=>{o({target:e,contentSize:n,get size(){return Pt(e,s)}})})}function Ft(e){e.forEach(zt)}function _t(){typeof ResizeObserver>"u"||(M=new ResizeObserver(Ft))}function At(e,n){M||_t();const s=ze(e);return s.forEach(t=>{let o=G.get(t);o||(o=new Set,G.set(t,o)),o.add(n),M?.observe(t)}),()=>{s.forEach(t=>{const o=G.get(t);o?.delete(n),o?.size||M?.unobserve(t)})}}const K=new Set;let H;function qt(){H=()=>{const e={width:window.innerWidth,height:window.innerHeight},n={target:window,size:e,contentSize:e};K.forEach(s=>s(n))},window.addEventListener("resize",H)}function Vt(e){return K.add(e),H||qt(),()=>{K.delete(e),!K.size&&H&&(H=void 0)}}function Yt(e,n){return typeof e=="function"?Vt(e):At(e,n)}const Gt=50,ue=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Kt=()=>({time:0,x:ue(),y:ue()}),Ut={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function de(e,n,s,t){const o=s[n],{length:r,position:c}=Ut[n],u=o.current,a=s.time;o.current=e[`scroll${c}`],o.scrollLength=e[`scroll${r}`]-e[`client${r}`],o.offset.length=0,o.offset[0]=0,o.offset[1]=o.scrollLength,o.progress=Fe(0,o.scrollLength,o.current);const l=t-a;o.velocity=l>Gt?0:_e(o.current-u,l)}function Xt(e,n,s){de(e,"x",n,s),de(e,"y",n,s),n.time=s}function Jt(e,n){const s={x:0,y:0};let t=e;for(;t&&t!==n;)if(t instanceof HTMLElement)s.x+=t.offsetLeft,s.y+=t.offsetTop,t=t.offsetParent;else if(t.tagName==="svg"){const o=t.getBoundingClientRect();t=t.parentElement;const r=t.getBoundingClientRect();s.x+=o.left-r.left,s.y+=o.top-r.top}else if(t instanceof SVGGraphicsElement){const{x:o,y:r}=t.getBBox();s.x+=o,s.y+=r;let c=null,u=t.parentNode;for(;!c;)u.tagName==="svg"&&(c=u),u=t.parentNode;t=c}else break;return s}const ee={start:0,center:.5,end:1};function fe(e,n,s=0){let t=0;if(e in ee&&(e=ee[e]),typeof e=="string"){const o=parseFloat(e);e.endsWith("px")?t=o:e.endsWith("%")?e=o/100:e.endsWith("vw")?t=o/100*document.documentElement.clientWidth:e.endsWith("vh")?t=o/100*document.documentElement.clientHeight:e=o}return typeof e=="number"&&(t=n*e),s+t}const Qt=[0,0];function Zt(e,n,s,t){let o=Array.isArray(e)?e:Qt,r=0,c=0;return typeof e=="number"?o=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?o=e.split(" "):o=[e,ee[e]?e:"0"]),r=fe(o[0],s,t),c=fe(o[1],n),r-c}const en={All:[[0,0],[1,1]]},tn={x:0,y:0};function nn(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function sn(e,n,s){const{offset:t=en.All}=s,{target:o=e,axis:r="y"}=s,c=r==="y"?"height":"width",u=o!==e?Jt(o,e):tn,a=o===e?{width:e.scrollWidth,height:e.scrollHeight}:nn(o),l={width:e.clientWidth,height:e.clientHeight};n[r].offset.length=0;let d=!n[r].interpolate;const m=t.length;for(let x=0;x<m;x++){const T=Zt(t[x],l[c],a[c],u[r]);!d&&T!==n[r].interpolatorOffsets[x]&&(d=!0),n[r].offset[x]=T}d&&(n[r].interpolate=Ae(n[r].offset,qe(t),{clamp:!1}),n[r].interpolatorOffsets=[...n[r].offset]),n[r].progress=Ve(0,1,n[r].interpolate(n[r].current))}function on(e,n=e,s){if(s.x.targetOffset=0,s.y.targetOffset=0,n!==e){let t=n;for(;t&&t!==e;)s.x.targetOffset+=t.offsetLeft,s.y.targetOffset+=t.offsetTop,t=t.offsetParent}s.x.targetLength=n===e?n.scrollWidth:n.clientWidth,s.y.targetLength=n===e?n.scrollHeight:n.clientHeight,s.x.containerLength=e.clientWidth,s.y.containerLength=e.clientHeight}function rn(e,n,s,t={}){return{measure:()=>on(e,t.target,s),update:o=>{Xt(e,s,o),(t.offset||t.target)&&sn(e,s,t)},notify:()=>n(s)}}const N=new WeakMap,me=new WeakMap,Q=new WeakMap,he=e=>e===document.documentElement?window:e;function ne(e,{container:n=document.documentElement,...s}={}){let t=Q.get(n);t||(t=new Set,Q.set(n,t));const o=Kt(),r=rn(n,e,o,s);if(t.add(r),!N.has(n)){const u=()=>{for(const x of t)x.measure()},a=()=>{for(const x of t)x.update(je.timestamp)},l=()=>{for(const x of t)x.notify()},d=()=>{$.read(u,!1,!0),$.read(a,!1,!0),$.update(l,!1,!0)};N.set(n,d);const m=he(n);window.addEventListener("resize",d,{passive:!0}),n!==document.documentElement&&me.set(n,Yt(n,d)),m.addEventListener("scroll",d,{passive:!0})}const c=N.get(n);return $.read(c,!1,!0),()=>{var u;ye(c);const a=Q.get(n);if(!a||(a.delete(r),a.size))return;const l=N.get(n);N.delete(n),l&&(he(n).removeEventListener("scroll",l),(u=me.get(n))===null||u===void 0||u(),window.removeEventListener("resize",l))}}function ln({source:e,container:n,axis:s="y"}){e&&(n=e);const t={value:0},o=ne(r=>{t.value=r[s].progress*100},{container:n,axis:s});return{currentTime:t,cancel:o}}const Z=new Map;function De({source:e,container:n=document.documentElement,axis:s="y"}={}){e&&(n=e),Z.has(n)||Z.set(n,{});const t=Z.get(n);return t[s]||(t[s]=Ge()?new ScrollTimeline({source:n,axis:s}):ln({source:n,axis:s})),t[s]}function an(e){return e.length===2}function Be(e){return e&&(e.target||e.offset)}function cn(e,n){return an(e)||Be(n)?ne(s=>{e(s[n.axis].progress,s)},n):Ce(e,De(n))}function un(e,n){if(e.flatten(),Be(n))return e.pause(),ne(s=>{e.time=e.duration*s[n.axis].progress},n);{const s=De(n);return e.attachTimeline?e.attachTimeline(s,t=>(t.pause(),Ce(o=>{t.time=t.duration*o},s))):Ye}}function dn(e,{axis:n="y",...s}={}){const t={axis:n,...s};return typeof e=="function"?cn(e,t):un(e,t)}function xe(e,n){Ke(!!(!n||n.current))}const fn=()=>({scrollX:W(0),scrollY:W(0),scrollXProgress:W(0),scrollYProgress:W(0)});function Ne({container:e,target:n,layoutEffect:s=!0,...t}={}){const o=be(fn);return(s?we:f.useEffect)(()=>(xe("target",n),xe("container",e),dn((c,{x:u,y:a})=>{o.scrollX.set(u.current),o.scrollXProgress.set(u.progress),o.scrollY.set(a.current),o.scrollYProgress.set(a.progress)},{...t,container:e?.current||void 0,target:n?.current||void 0})),[e,n,JSON.stringify(t.offset)]),o}function mn(e){const n=be(()=>W(e)),{isStatic:s}=f.useContext(ke);if(s){const[,t]=f.useState(e);f.useEffect(()=>n.on("change",t),[])}return n}function ge(e){return typeof e=="number"?e:parseFloat(e)}function Re(e,n={}){const{isStatic:s}=f.useContext(ke),t=f.useRef(null),o=mn(oe(e)?ge(e.get()):e),r=f.useRef(o.get()),c=f.useRef(()=>{}),u=()=>{const l=t.current;l&&l.time===0&&l.sample(je.delta),a(),t.current=Ue({keyframes:[o.get(),r.current],velocity:o.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...n,onUpdate:c.current})},a=()=>{t.current&&t.current.stop()};return f.useInsertionEffect(()=>o.attach((l,d)=>s?d(l):(r.current=l,c.current=d,$.update(u),o.get()),a),[JSON.stringify(n)]),we(()=>{if(oe(e))return e.on("change",l=>o.set(ge(l)))},[o]),o}var R={},pe;function hn(){if(pe)return R;pe=1;var e=Xe();Object.defineProperty(R,"__esModule",{value:!0}),R.default=void 0;var n=e(Je()),s=Qe();return R.default=(0,n.default)((0,s.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder"),R}var xn=hn();const gn=Ze(xn),pn=et(Wt)(({theme:e})=>({color:e.palette.text.secondary,[`& .${Y.content}`]:{color:e.palette.text.secondary,borderTopRightRadius:e.spacing(2),borderBottomRightRadius:e.spacing(2),paddingRight:e.spacing(1),fontWeight:e.typography.fontWeightMedium,"&.MuiTreeItem-content":{paddingLeft:"3px",paddingRight:"3px"},".MuiTreeItem-label":{paddingLeft:"0px"},".MuiTreeItem-iconContainer":{marginRight:"0px"},"&.Mui-expanded":{fontWeight:e.typography.fontWeightRegular},"&:hover":{backgroundColor:e.palette.action.hover},"&.Mui-selected":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},[`& .${Y.label}`]:{fontWeight:"inherit",color:"inherit"}},[`& .${Y.group}`]:{marginLeft:0,[`& .${Y.content}`]:{paddingLeft:e.spacing(1)}}})),vn=f.forwardRef(function(n,s){const{labelIcon:t,labelInfo:o,labelText:r,pl:c,...u}=n;return i.jsx(pn,{label:i.jsxs(I,{sx:{display:"flex",alignItems:"center",p:.5,pr:2,pl:{pl:c}},children:[i.jsx(I,{component:t,color:"inherit",sx:{mr:1,pl:{pl:c}}}),i.jsx(U,{sx:{fontWeight:"inherit",flexGrow:1},component:"div",children:r}),i.jsx(U,{variant:"caption",color:"inherit",children:o})]}),...u,ref:s})}),We=e=>{const{id:n,fullIndex:s,title:t,sub:o}=e.item;if(n===void 0)return console.log("SubTreeItem.item.undefined=",e.item),i.jsx(i.Fragment,{});const r=o&&Object.values(o).length>0?Object.values(o).length+"":"";return i.jsx(vn,{onClick:()=>e.onDetail(n,s),nodeId:n,labelText:t,labelInfo:r,pl:e.pl,children:o!=null?Object.values(o).sort((c,u)=>c.title>u.title?1:-1).map((c,u)=>i.jsx("div",{style:{paddingLeft:e.pl+5},children:i.jsx(We,{onDetail:e.onDetail,item:c,pl:e.pl+5})},u+"")):""})};function He(e){const[n,s]=f.useState([]),[t,o]=f.useState([]),r=(a,l)=>{e.onDetail(a,l)};f.useEffect(()=>{if(e.expandIndex!==void 0){let a=e.expandIndex.split("/");a=a.filter(l=>l!=="sub"),e.expandIndex.indexOf("undefined")<0&&(s(a),o(a[a.length-1]))}},[e.expandIndex]);const c=(a,l)=>{},u=(a,l)=>{s(l)};return i.jsx(I,{sx:{minHeight:180,flexGrow:1,display:"flex",flexDirection:"column",height:e.maxHeight,overflow:"hidden",overflowY:"auto",width:"100%"},children:i.jsx(Bt,{"aria-label":"icon expansion",defaultCollapseIcon:i.jsx(Rt,{}),defaultExpandIcon:i.jsx(Nt,{}),expanded:n,onNodeSelect:c,selected:t,onNodeToggle:u,sx:{flexGrow:1,overflow:"hidden",overflowY:"auto"},children:e.data&&e.data.map((a,l)=>i.jsx(We,{onDetail:r,item:a,parentIndex:l+1,pl:5},l+1))})})}async function yn(e,n,s=""){if(n==null||n==="")return"";let t=s===""?`${e}/${n}`:`${e}_txt/${n}`;e==="home"&&(t="home_txt");const o=Se(Ie(Te,t)),r=await tt(o);if(!r.exists())return console.log("getTreeData.null"),null;if(!r.exists())return console.log("getTreeData.exists"),null;const c=r.val(),u=[],a={};e==="home"&&(ie.map(l=>{u.push({title:l.label,id:l.id,sub:[]})}),ie.map(l=>{a[l.id]=[]}));for(const l in c){const d=c[l];d.up===void 0?(d.id=l,d.fullIndex=l):(d.id=d.up,d.fullIndex=d.up),e==="home"?d.gbn!==void 0&&a[d.gbn].push(d):s===""||s===void 0?(d.sub!==null&&(d.children=Oe(d,d.up)),u.push(d)):(d.id=l,(d.memo+"").toLowerCase().indexOf(s.toLowerCase())>-1&&u.push(d))}return e==="home"?Object.values(a).map((l,d)=>{l.sort((m,x)=>m.title>x.title?1:-1),u[d].sub=l}):u.sort((l,d)=>l.title>d.title?1:-1),u}function Oe(e,n){const s=[];if(e===void 0||e.sub===void 0)return s;for(let t in e.sub){let o=e.sub[t];o.id=t,o.key=t}return Object.values(e.sub).sort((t,o)=>o.title-t.title).map(t=>{t.id=t.key,t.fullIndex=n+"/sub/"+t.key,t.sub!==null&&(t.children=Oe(t,t.fullIndex)),s.push(t)}),s}const jn=e=>{const[n,s]=f.useState([]),t=()=>{const o=Se(Ie(Te,`memo_txt/${e}`),st("bookmark"),nt("Y"));ot(o,r=>{if(!r.exists())return;const c=r.val(),u=[];for(let a in c){const l=c[a];l.key=a,u.push(l)}u.sort((a,l)=>a.title>l.title?1:-1),s(u)})};return f.useEffect(()=>{t()},[e]),n};function bn(e){const{user:n}=X(),s=J(),t=jn(n?.uid);return n===void 0?i.jsx(i.Fragment,{}):i.jsxs("div",{className:"tail-bookmark justify-items-center",sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"100%"},children:[i.jsx(Me,{}),i.jsx(it,{children:"BookMark"}),i.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:t&&t.map((o,r)=>i.jsx("div",{children:i.jsx(rt,{component:"button",variant:"body",onClick:()=>{e.onSelected(o.key),s(`/memo/${o.key}`)},children:i.jsx(U,{variant:"body1",children:o.title})})},r))})]})}const wn=e=>{const n=f.useRef(null);function s(){e.onSearchDataBtn(n.current.value)}function t(){return e.onNewMemoBtn(),!1}function o(r){r.which===13&&s()}return i.jsxs(i.Fragment,{children:[i.jsx(lt,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:n,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:o}),i.jsxs("div",{className:"flex justify-center",children:[i.jsx(ce,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:t,children:"새글"}),i.jsx(ce,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:s,children:"조회"})]})]})},kn=({className:e="",children:n})=>i.jsx("h4",{className:`mb-2 text-lg font-semibold text-center text-gray-800 dark:text-white/90 
      ${e}}
      `,children:n}),Sn={position:"absolute",top:"50%",left:"50%",display:"flex",flexDirection:"column",alignItems:"center",transform:"translate(-50%, -50%)",width:250,maxHeight:"400px",bgcolor:"background.paper",border:"1px solid #000",boxShadow:24,boxSizing:"border-box",p:4},In=e=>i.jsxs(I,{sx:{my:2,mt:3,display:"flex"},children:[i.jsx(L,{type:"submit",variant:"outlined",color:"success",onClick:e.onPost,children:"확인"}),i.jsx(L,{type:"button",variant:"outlined",onClick:e.onClose,children:"취소"})]}),Tn=e=>{const[n,s]=f.useState(e.open),[t,o]=f.useState(),r=()=>{s(!1),o(void 0),e.onClose()};f.useEffect(()=>{s(e.open)},[e.open]);const c=a=>{o(a)},u=()=>{if(t===void 0){alert("이동할 메모장을 선택해 주세요");return}e.onPost(t)};return i.jsx("div",{children:i.jsx(at,{open:n,onClose:r,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:i.jsxs(I,{sx:Sn,children:[i.jsx(U,{id:"modal-modal-title",variant:"h6",component:"h2",children:"이동할 메모장 선택"}),i.jsx(Me,{}),i.jsx(I,{sx:{width:"100%",minHeight:110,maxHeight:200,flexGrow:1,minWidth:100,overflow:"hidden"},children:i.jsx(He,{data:e.data,onDetail:c,maxHeight:200})}),i.jsx(In,{onPost:u,onClose:r})]})})})},Mn=e=>i.jsxs(I,{sx:{flexGrow:1,my:2,width:"100%",display:"grid",gridTemplateColumns:"64px 64px  64px  64px ",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:[i.jsx(L,{type:"button",size:"small",variant:"outlined",color:"success",onClick:e.onEdit,children:"수정"}),i.jsx(L,{type:"button",size:"small",variant:"outlined",onClick:e.onNewMemo,children:"새글"}),e.rootDb==="memo"?i.jsx(L,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:e.onMove,children:"이동"}):"",i.jsx(L,{type:"button",size:"small",variant:"outlined",color:"error",onClick:e.onDelete,children:"삭제"})]}),En=e=>{const{rootDb:n,isLoading:s,memoDetailData:t,bookmark:o}=e,{scrollYProgress:r}=Ne(),c=Re(r,{stiffness:100,damping:30,restDelta:.001}),[u,a]=f.useState(!1),l=J(),d=f.useRef();d.current=e.searchWord;const{memoId:m}=Ee(),T=te()?.state?.fullIndex,{user:j}=X(),k=()=>{const g=`/${n}/edit/${m}`;l(g,{state:{fullIndex:T}})},C=()=>{const g=`/${n}/insert/${m}`;l(g,{state:{fullIndex:T}})},p=async()=>{const g=n==="memo"?`${n}_txt/${j.uid}/${m}`:`${n}_txt/${m}`,v=n==="memo"?`${n}/${j.uid}`:n;if(await gt(g,v)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}e.onTreeUpdate(),l(`/${n}`)},y=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&p()},b=()=>{a(!0)},h=()=>{e.onBookmark()},w=async g=>{try{const v=n==="memo"?`${n}_txt/${j.uid}`:`${n}_txt`,E=n==="memo"?`memo/${j.uid}`:n,P=await xt(v,E,m,g);e.onTreeUpdate()}catch(v){console.log("catch",v)}finally{a(!1)}};return f.useEffect(()=>{if(t&&t.title!==void 0){const v=document.querySelector("title");v.innerHTML=`${$e.appTitle} :: ${t.title}`}function g(){t&&t.html!=="N"&&document.querySelectorAll("pre").forEach(v=>{v.innerHTML=ht(v.innerHTML)})}t&&t.memo!==null&&g()},[t]),s?i.jsx(O,{}):m===""||j===void 0?i.jsx(i.Fragment,{}):i.jsxs("div",{children:[i.jsx(re.div,{className:"progress-bar",style:{scaleX:c}}),i.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[i.jsx("div",{}),i.jsx("div",{className:"flex justify-center",children:t&&t.title}),i.jsxs("div",{className:"text-right justify-end mr-3.5",children:[i.jsx(re.div,{whileHover:{scale:1.1},whileTap:{scale:.8},initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:.5,ease:[0,.71,.2,1.01],scale:{type:"spring",damping:2,stiffness:100,restDelta:.001}},children:i.jsx(ct,{"aria-label":"bookmark",onClick:h,children:o==="Y"?i.jsx(Ot,{sx:{color:"red"}}):i.jsx(gn,{})})}),i.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:e.pathNm})]})]}),i.jsxs("div",{className:"w-full p-0 m-0",children:[i.jsx(Mn,{rootDb:n,onEdit:k,onNewMemo:C,onMove:b,onDelete:y,onBookmark:h,bookmark:o}),i.jsxs(I,{sx:{my:2},children:[t&&t.html==="N"?i.jsx(ut,{postData:t&&t.memo}):t&&t.html!=="N"&&t.memo&&i.jsx(dt,{text:t.memo}),i.jsx(ft,{imageList:t&&t.image}),!t&&i.jsx(I,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:i.jsx(mt,{sx:{mt:5}})})]}),i.jsx(Tn,{userId:j?.uid,open:u,data:e.data,onClose:()=>a(!1),onPost:w})]}),i.jsx(Le,{})]})},ve=e=>{const{rootDb:n,isLoading:s,memoDetailData:t}=e;if(console.log("MemoDetailEdit.isLoading=",s),s)return i.jsx(O,{});const{scrollYProgress:o}=Ne();Re(o,{stiffness:100,damping:30,restDelta:.001});const r=J(),c=f.useRef(),u=f.useRef();u.current=e.searchWord;const{memoId:a}=Ee(),l=te(),d=t?.fullIndex,{user:m}=X();c.current=l.pathname.split("/")[2]==="insert",console.log("MemoDetailEdit.newMode=",c.current);const{settings:x,saveSettings:T}=pt(),j=()=>{const p=`/${n}/${a==="insert"?"":a}`;r(p,{state:{fullIndex:d}})},k=async(p,y)=>{console.log("onNewSubmit.values",p),console.log("onNewSubmit.fullIndex",d);const b=n==="memo"?`${n}_txt/${m.uid}/`:`${n}_txt/`,h=n==="memo"?`${n}/${m.uid}/`:`${n}/`;console.log("onNewSubmit.txtLocate",b),console.log("onNewSubmit.locate",h);const w=await le(void 0,b,h,d,p);if(await ae(`${n}_txt`,n,w,y),w!==void 0){const g=`/${n}/${w}`;r(g,{state:{reflash:!0}})}},C=async(p,y,b)=>{const h=n==="memo"?`${n}_txt/${m.uid}`:`${n}_txt`,w=n==="memo"?`${n}/${m.uid}`:n,g=await jt(h,w,a,y);console.log("onPostSubmit.imageDelete",g),console.log("onPostSubmit.memoId",a),console.log("onPostSubmit.values",p);const v=await le(c.current?void 0:a,`${h}/`,`${w}/`,d,p);console.log("onPostSubmit.newKey=",v),console.log("onPostSubmit.files=",b);const E=await ae(`${h}/`,`${w}/`,a,b);if(console.log("onNewSubmit.imageResult",E),console.log("onPostSubmit.fullIndex",d),n==="memo"&&d===void 0){const D=await bt(m.uid,`${a}/fullIndex`);console.log("onPostSubmit.fullPath",D),D!==void 0&&wt(`memo/${m.uid}/${D}/title`,p.edTitle)}c.current=!1;const P=`/${n}/${a}`;r(P,{state:{fullIndex:d,reflash:!0}})};return f.useEffect(()=>{if(t&&t.title!==void 0){const y=document.querySelector("title");y.innerHTML=`${$e.appTitle} :: ${t.title}`}function p(){document.querySelectorAll("pre").forEach((y,b)=>{})}t&&t.memo!==null&&p()},[t]),a===""||m===void 0?i.jsx(i.Fragment,{}):i.jsxs(i.Fragment,{children:[i.jsx(vt,{className:"container",sx:{p:0,width:"100%"},children:c.current===!1&&t&&(t.title===void 0||t.title===""||t.title===null)?i.jsx(O,{}):i.jsx(yt,{newMode:c.current,onPostSubmit:C,onNewSubmit:k,onCancel:j,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html:"Y",content:t?.memo,imageList:t?.image})}),i.jsx(Le,{})]})},$n=f.lazy(async()=>await Dt(()=>import("./MemoMain-D3oa1cMG.js"),__vite__mapDeps([0,1,2,3]))),Rn=({rootDb:e})=>{const n=J(),{user:s}=X(),t=f.useRef(),o=f.useRef(),[r,c]=f.useState(!1),[u,a]=f.useState(),[l,d]=f.useState(),[m,x]=f.useState(),[T,j]=f.useState(),k=f.useRef(!1),{isMoble:C,height:p}=kt(),y=te(),b=f.useRef(!1);b.current=y?.state?.reflash===!0;const h=St({queryKey:["treeMemo",s?.uid,t.current],queryFn:()=>yn(e,s?.uid,t.current)});h.data!==void 0&&h.data!==""&&!k.current&&(k.current=!0);const w=()=>{m&&(m.bookmark=m.bookmark==="Y"?"N":"Y"),console.log("onBookmark.memoDetailData.bookmark="+m.bookmark),j(m.bookmark),Ct(s.uid,l,m.bookmark)};f.useEffect(()=>{s!==void 0&&s!=null&&h.refetch()},[s]),f.useEffect(()=>{console.log("useEffect.loadOK=",k.current)},[k.current]),f.useEffect(()=>{const S=async _=>{if(_!==""&&s){const B=await $t(e,s?.uid,_,t.current);{const se=Pe(h.data,{id:"",nm:""},_),A=se.id;o.current=se.nm,B.fullIndex=A,A!==u&&(a(A),Lt(s.uid,_,A))}B.bookmark===void 0&&(B.bookmark="N"),j(B.bookmark),x(B),c(!1)}},z=y.pathname.split("/"),F=z.length>2?z[z.length-1]:"";S(F),d(F)},[y.pathname,s]),f.useEffect(()=>{s!==void 0&&s!=null&&h.refetch()},[b.current]);const g=S=>{k.current=!1,S!==void 0&&(t.current=S),h.refetch()},v=(S,z)=>{c(!0);const F=`/${e}/${S}`;n(F,{state:{fullIndex:u}})},E=()=>{if(s==null){alert("로그인 후 이용 가능합니다.");return}const S=`/${e}/insert/insert`;n(S)},P=S=>{},D=i.jsxs("div",{className:"",children:[i.jsx(kn,{className:"mt-3 ",children:e==="memo"?"메모장":"홈페이지관리"}),i.jsxs("div",{className:"flex gap-7 justify-center",children:[i.jsx(q,{to:"/",children:"홈"}),e==="memo"?"":i.jsx(q,{to:"/memo",children:"메모"}),i.jsx(q,{to:"/todo",children:"TODO"}),i.jsx(q,{to:"/tail",children:"Sheet"})]}),i.jsx(wn,{onNewMemoBtn:E,onSearchDataBtn:g}),i.jsx("div",{className:`grow-1 h-[${p-220}px]`,children:k.current&&h.isFetched?i.jsx(He,{expandIndex:u,data:h.data,onDetail:v,maxHeight:p-220-(C?56:0)}):i.jsx(O,{})})]});return s&&s.uid===It&&Tt,i.jsxs(Ht,{sideType:"memo",title:e==="memo"?"메모장":"홈페이지관리",sideContents:D,children:[i.jsx(f.Suspense,{fallback:i.jsx(O,{}),children:i.jsxs(Mt,{children:[i.jsx(V,{path:"/edit/:memoId",element:i.jsx(ve,{rootDb:e,isLoading:r,searchWord:t.current,memoDetailData:m})}),i.jsx(V,{path:"/insert/:memoId",element:i.jsx(ve,{rootDb:e,isLoading:r,searchWord:t.current,memoDetailData:m})}),i.jsx(V,{path:"/:memoId",element:i.jsx(En,{rootDb:e,isLoading:r,searchWord:t.current,memoDetailData:m,bookmark:T,onTreeUpdate:g,pathNm:o.current,onBookmark:w,data:h.data})}),i.jsx(V,{path:"*",element:i.jsx($n,{searchWord:t.current,data:h.data,onNewMemoBtn:E,title:e==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),e==="memo"?i.jsx(bn,{onSelected:P}):"",i.jsx(Et,{})]})},Pe=(e,n,s)=>{let t={};if(e)for(let o=0;o<e.length;o++){const r=e[o];if(r.id===s)return t.id=n.id+r.id,t.nm=n.nm+r.title,t;if(r.sub!==null&&r.sub!==void 0){if(t.id=n.id+r.id+"/sub/",t.nm=n.nm+r.title+" > ",t=Pe(Object.values(r.sub),t,s),t.id&&t.id.endsWith(s))return t;t={}}}return t};export{Rn as M};
