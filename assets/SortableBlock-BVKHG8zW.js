import{c4 as Ar,c5 as Cr,c6 as Ea,G as ki,c7 as Ap,c8 as $o,c9 as Dc,ca as Vc,cb as Bc,cc as Cp,cd as J,S as kc,ce as Ip,cf as wp,cg as Mp,ch as Op,ci as kr,cj as bp,ck as xp,cl as _p,cm as Lp,cn as Fp,co as Up,cp as Pp,cq as Dp,cr as Vp,cs as Bp,ct as kp,cu as Gp,cv as Hp,cw as Wp,cx as Gc,cy as zp,cz as Yp,cA as Hc,cB as Ra,cC as jp,cD as $p,cE as Wc,cF as Xp,cG as Kp,cH as zc,cI as qp,cJ as Qp,cK as Yc,cL as Zp,cM as Hu,cN as Jp,cO as em,cP as tm,cQ as rm,cR as nm,cS as sm,cT as im,cU as am,cV as om,cW as um,cX as lm,cY as cm,cZ as hm,c_ as dm,c$ as fm,d0 as pm,d1 as mm,d2 as gm,d3 as Em,d4 as Rm,d5 as Nm,d6 as ym,d7 as Tm,d8 as vm,d9 as Sm,da as Am,db as Cm,dc as Im,dd as wm,de as Mm,df as Om,dg as bm,dh as xm,di as _m,dj as Lm,dk as Fm,dl as Um,dm as Pm,dn as Dm,dp as Vm,dq as Bm,dr as km,ds as Gm,dt as Hm,du as Wm,dv as zm,dw as Ym,dx as jm,dy as $m,dz as Xm,dA as Km,dB as qm,dC as Qm,dD as Zm,dE as Jm,dF as eg,dG as tg,dH as rg,dI as ng,dJ as sg,dK as ig,dL as ag,dM as og,dN as ug,dO as lg,dP as cg,dQ as hg,dR as dg,dS as fg,dT as pg,dU as mg,dV as gg,dW as Eg,a0 as Rg,r as I,j as T,Q as Ng,dX as yg,k as Tt,aK as ys,bJ as on,dY as Tg,b$ as jc,h as vg,bf as $c,bR as Sg}from"./index-CjFOdZ7J.js";import{a as Ag}from"./HtmlCode-454GHr9J.js";function Xc(s){var e=s.length,t=s.lastIndexOf("."),r=s.substring(t+1,e).toLowerCase();return r}function Cg(s){var e=s.indexOf("."),t=s.substring(0,e);return t}const FA=async(s,e,t)=>{const r={};r.ext=Xc(t),r.name=t,r.key=Cg(t);try{const n=`memo/${s}`,i=Ar(Cr,`${n}/${t}`),a=await Ea(i);r.url=a,ki(`memo_txt/${s}/${e}/image/${r.key}`,r)}catch{}return r},Ig=async(s,e,t,r)=>{const n="memo/I3cTgdCxwjhBBno4mtZYvnODPJu1";let i=new Array;for(let a in t){const o=t[a];try{if(o.key=a,o.url===void 0||o.url===""){const u=Ar(Cr,`${n}/${a}.${o.ext}`),l=await Ea(u);o.url=l,ki(`${s}/image/${a}/url`,l)}}catch{}i.push(o)}return i},UA=async(s,e,t,r)=>{Xc(r.name);let n=Ar(Cr,`${s}/${r.name}`);try{const a=await $o(n);n=Ar(Cr,`${s}/${t}${r.name}`)}catch(a){if(a.code!=="storage/object-not-found")throw console.error("setFileUpload: 파일 확인 중 오류:",a),a}return await Dc(n,r)},PA=async(s,e,t,r)=>{const n={success:!0,key:t,message:"파일명이 성공적으로 변경되었습니다."};try{const i=Ar(Cr,s+e+"."+r);let a=Ar(Cr,s+t+"."+r);const o=await Ap(i);let u=0;for(;;)try{const h=await $o(a);u++;const d=t+u;n.key=d,a=Ar(Cr,s+d+"."+r)}catch{break}await Dc(a,o),await Vc(i);const l=await Ea(a);return n.url=l,n}catch(i){return console.error("renameFile: 파일명 변경 중 오류:",i),{success:!1,message:"파일명 변경 실패"}}},DA=async(s,e,t)=>{try{const r=Ar(Cr,`${s}/${t.key}.${t.ext}`);Vc(r).then(()=>{}).catch(n=>{})}catch{}},VA=async(s="")=>{try{const e=Ar(Cr,s),t=await Bc(e),r=[];for(let n=0;n<t.items.length&&n<10;n++){const i=t.items[n];try{r.push(i._location.path_.replace("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1/",""))}catch(a){console.error("파일 정보 조회 실패:",itemRef.name,a)}}return console.error("getStorageFileList10.fileList=",r),r}catch(e){return console.error("Storage 파일 목록 조회 실패:",e),{files:[],folders:[],success:!1,error:e.message}}},BA=async(s="")=>{try{const e=Ar(Cr,s),t=await Bc(e),r=[];for(const i of t.items)try{const a=await $o(i),o=await Ea(i);r.push({name:i.name,fullPath:i.fullPath,size:a.size,contentType:a.contentType,timeCreated:a.timeCreated,updated:a.updated,downloadURL:o})}catch(a){console.error("파일 정보 조회 실패:",i.name,a)}const n=t.prefixes.map(i=>({name:i.name,fullPath:i.fullPath,type:"folder"}));return{files:r,folders:n,success:!0}}catch(e){return console.error("Storage 파일 목록 조회 실패:",e),{files:[],folders:[],success:!1,error:e.message}}},kA=async(s,e,t,r)=>{let n="",i="",a={};((l,h,d)=>{if(l==="sheet")return;i=l==="memo"?`${l}/${h}/${d}`:`${l}/${d}`,n=l==="memo"?`${l}_txt/${h}/${d}`:`${l}_txt/${d}`})(s,e,t);async function u(){if(n===void 0)return"";if(a=await Cp(n),a===void 0){a={code:"404",msg:"No data available"};return}if(a?.fullIndex,a.image!==void 0&&a.image!==null){const l=await Ig(n,i,a.image);a.image=l,(a.imageOK===void 0||a.imageOK==="N")&&(l&&l.map(h=>{h.ext==="jpg"&&(a.memo=a.memo+`<img src='${h.url}'>`)}),ki(`${n}/imageOK`,"Y"),ki(`${n}/memo`,a.memo))}if(a.html!=="N"&&r!==void 0&&r!==""){const l=new RegExp(r,"gi"),h=a.memo.replace(l,`<span class='lightext'>${r}</span>`);a.memo=h}}return await u(),a};function wg(s){const e=typeof window>"u"?!1:window.jQuery;e&&(e.fn.handsontable=function(t){const r=this.first();let n=r.data("handsontable");if(typeof t!="string"){const l=t||{};return n?n.updateSettings(l):(n=new s.Core(r[0],l),r.data("handsontable",n),n.init()),r}let i;if(n)if(typeof n[t]<"u"){for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];i=n[t].call(n,...o),t==="destroy"&&r.removeData()}else throw new Error(`Handsontable do not provide action: ${t}`);return i})}var Va,Ba,ka,Ga,Ha;kc();wg(J);J.__GhostTable=Ip;J._getListenersCounter=wp;J._getRegisteredMapsCounter=Mp;J.EventManager=Op;const Mg=[bp,xp,_p,Lp,Fp,Up,Pp,Dp,Vp,Bp,kp,Gp],Og=[Hp,Wp];J.helper={};J.dom={};kr(Mg,s=>{kr(Object.getOwnPropertyNames(s),e=>{e.charAt(0)!=="_"&&(J.helper[e]=s[e])})});kr(Og,s=>{kr(Object.getOwnPropertyNames(s),e=>{e.charAt(0)!=="_"&&(J.dom[e]=s[e])})});J.cellTypes=(Va=J.cellTypes)!==null&&Va!==void 0?Va:{};kr(zp(),s=>{J.cellTypes[s]=Gc(s)});J.cellTypes.registerCellType=Yp;J.cellTypes.getCellType=Gc;J.editors=(Ba=J.editors)!==null&&Ba!==void 0?Ba:{};kr(jp(),s=>{J.editors[`${Ra(s)}Editor`]=Hc(s)});J.editors.registerEditor=$p;J.editors.getEditor=Hc;J.renderers=(ka=J.renderers)!==null&&ka!==void 0?ka:{};kr(Xp(),s=>{const e=Wc(s);s==="base"&&(J.renderers.cellDecorator=e),J.renderers[`${Ra(s)}Renderer`]=e});J.renderers.registerRenderer=Kp;J.renderers.getRenderer=Wc;J.validators=(Ga=J.validators)!==null&&Ga!==void 0?Ga:{};kr(qp(),s=>{J.validators[`${Ra(s)}Validator`]=zc(s)});J.validators.registerValidator=Qp;J.validators.getValidator=zc;J.plugins=(Ha=J.plugins)!==null&&Ha!==void 0?Ha:{};kr(Zp(),s=>{J.plugins[s]=Yc(s)});J.plugins[`${Ra(Hu.PLUGIN_KEY)}Plugin`]=Hu;J.plugins.registerPlugin=Jp;J.plugins.getPlugin=Yc;/**
 * @preserve
 * Authors: Hwang, Gun-gu
 * Last updated: Aug 20, 2018
 *
 * Description: Definition file for Korean - Korea language-country.
 */const bg={languageCode:"ko-KR",[Eg]:"위쪽에 행 삽입",[gg]:"아래쪽에 행 삽입",[mg]:"왼쪽에 열 삽입",[pg]:"오른쪽에 열 삽입",[fg]:["행 삭제","여러 행 삭제"],[dg]:["열 삭제","여러 열 삭제"],[hg]:"되돌리기",[cg]:"다시하기",[lg]:"읽기 전용",[ug]:"열 지우기",[og]:"정렬",[ag]:"왼쪽",[ig]:"중앙",[sg]:"오른쪽",[ng]:"자동",[rg]:"위쪽",[tg]:"가운데",[eg]:"아래쪽",[Jm]:"열 고정",[Zm]:"열 고정 해제",[Qm]:"테두리",[qm]:"위쪽",[Km]:"오른쪽",[Xm]:"아래쪽",[$m]:"왼쪽",[jm]:"테두리 지우기",[Ym]:"댓글 달기",[zm]:"댓글 편집",[Wm]:"댓글 삭제",[Hm]:"읽기 전용 댓글",[Gm]:"셀 병합",[km]:"셀 병합 해제",[Bm]:"복사",[Vm]:"잘라내기",[Dm]:"자녀 행 추가",[Pm]:"부모행에서 제거",[Um]:["열 숨기기","여러 열 숨기기"],[Fm]:["열 숨기기 해제","여러 열 숨기기 해제"],[Lm]:["행 숨기기","여러 행 숨기기"],[_m]:["행 숨기기 해제","여러 행 숨기기 해제"],[xm]:"조건없음",[bm]:"비어있음",[Om]:"비어있지 않음",[Mm]:"같",[wm]:"같지 않음",[Im]:"시작 문자",[Cm]:"끝 문자",[Am]:"포함",[Sm]:"포함하지 않음",[vm]:"보다 큼",[Tm]:"크거나 같음",[ym]:"보다 작",[Nm]:"작거나 같음",[Rm]:"사이",[Em]:"사이 제외",[gm]:"다음",[mm]:"전",[pm]:"오늘",[fm]:"내일",[dm]:"어제",[hm]:"공란",[cm]:"조건부 필터",[lm]:"값 필터",[um]:"그리고",[om]:"또는",[am]:"전체선택",[im]:"지우기",[sm]:"확인",[nm]:"취소",[rm]:"찾기",[tm]:"값",[em]:"두번째 값"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Fe;(function(s){s.RELATIVE="RELATIVE",s.ABSOLUTE="ABSOLUTE"})(Fe||(Fe={}));class Rt{constructor(e,t,r){this.type=e,this.col=t,this.sheet=r}static absolute(e,t){return new Rt(Fe.ABSOLUTE,e,t)}static relative(e,t){return new Rt(Fe.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleColumnAddress(e).col-r.toSimpleColumnAddress(e).col}isColumnAbsolute(){return this.type===Fe.ABSOLUTE}isColumnRelative(){return this.type===Fe.RELATIVE}isAbsolute(){return this.type===Fe.ABSOLUTE&&this.sheet!==void 0}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new Rt(this.type,this.col+t,n)}shiftedByColumns(e){return new Rt(this.type,this.col+e,this.sheet)}toSimpleColumnAddress(e){const t=cr(this,e);let r=this.col;return this.isColumnRelative()&&(r=e.col+this.col),vd(t,r)}shiftRelativeDimensions(e,t){const r=this.isColumnRelative()?this.col+e:this.col;return new Rt(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnAbsolute()?this.col+e:this.col;return new Rt(this.type,r,this.sheet)}withSheet(e){return new Rt(this.type,this.col,e)}isInvalid(e){return this.toSimpleColumnAddress(e).col<0}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case Fe.RELATIVE:return`${t}#COLR${this.col}`;case Fe.ABSOLUTE:return`${t}#COLA${this.col}`}}unparse(e){const t=this.toSimpleColumnAddress(e);if(hy(t))return;const r=ya(t.col);return`${this.type===Fe.ABSOLUTE?"$":""}${r}`}exceedsSheetSizeLimits(e){return this.col>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mt{constructor(e,t,r){this.type=e,this.row=t,this.sheet=r}static absolute(e,t){return new mt(Fe.ABSOLUTE,e,t)}static relative(e,t){return new mt(Fe.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleRowAddress(e).row-r.toSimpleRowAddress(e).row}isRowAbsolute(){return this.type===Fe.ABSOLUTE}isRowRelative(){return this.type===Fe.RELATIVE}isAbsolute(){return this.type===Fe.ABSOLUTE&&this.sheet!==void 0}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new mt(this.type,this.row+r,n)}shiftedByRows(e){return new mt(this.type,this.row+e,this.sheet)}toSimpleRowAddress(e){const t=cr(this,e);let r=this.row;return this.isRowRelative()&&(r=e.row+this.row),Td(t,r)}shiftRelativeDimensions(e,t){const r=this.isRowRelative()?this.row+t:this.row;return new mt(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isRowAbsolute()?this.row+t:this.row;return new mt(this.type,r,this.sheet)}withSheet(e){return new mt(this.type,this.row,e)}isInvalid(e){return this.toSimpleRowAddress(e).row<0}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case Fe.RELATIVE:return`${t}#ROWR${this.row}`;case Fe.ABSOLUTE:return`${t}#ROWA${this.row}`}}unparse(e){const t=this.toSimpleRowAddress(e);return cy(t)?void 0:`${this.type===Fe.ABSOLUTE?"$":""}${t.row+1}`}exceedsSheetSizeLimits(e){return this.row>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var fe;(function(s){s.CELL_REFERENCE_RELATIVE="CELL_REFERENCE",s.CELL_REFERENCE_ABSOLUTE="CELL_REFERENCE_ABSOLUTE",s.CELL_REFERENCE_ABSOLUTE_COL="CELL_REFERENCE_ABSOLUTE_COL",s.CELL_REFERENCE_ABSOLUTE_ROW="CELL_REFERENCE_ABSOLUTE_ROW"})(fe||(fe={}));class Ne{constructor(e,t,r,n){this.col=e,this.row=t,this.type=r,this.sheet=n}static fromColAndRow(e,t,r){return(e.isColumnAbsolute()&&t.isRowAbsolute()?Ne.absolute.bind(this):e.isColumnAbsolute()?Ne.absoluteCol.bind(this):t.isRowAbsolute()?Ne.absoluteRow.bind(this):Ne.relative.bind(this))(e.col,t.row,r)}static relative(e,t,r){return new Ne(e,t,fe.CELL_REFERENCE_RELATIVE,r)}static absolute(e,t,r){return new Ne(e,t,fe.CELL_REFERENCE_ABSOLUTE,r)}static absoluteCol(e,t,r){return new Ne(e,t,fe.CELL_REFERENCE_ABSOLUTE_COL,r)}static absoluteRow(e,t,r){return new Ne(e,t,fe.CELL_REFERENCE_ABSOLUTE_ROW,r)}toSimpleCellAddress(e){const t=cr(this,e);return this.type===fe.CELL_REFERENCE_ABSOLUTE?x(t,this.col,this.row):this.type===fe.CELL_REFERENCE_ABSOLUTE_ROW?x(t,e.col+this.col,this.row):this.type===fe.CELL_REFERENCE_ABSOLUTE_COL?x(t,this.col,e.row+this.row):x(t,e.col+this.col,e.row+this.row)}toColumnAddress(){const e=this.isColumnRelative()?Fe.RELATIVE:Fe.ABSOLUTE;return new Rt(e,this.col,this.sheet)}toRowAddress(){const e=this.isRowRelative()?Fe.RELATIVE:Fe.ABSOLUTE;return new mt(e,this.row,this.sheet)}toSimpleColumnAddress(e){const t=cr(this,e);let r=this.col;return this.isColumnRelative()&&(r+=e.col),vd(t,r)}toSimpleRowAddress(e){const t=cr(this,e);let r=this.row;return this.isRowRelative()&&(r+=e.row),Td(t,r)}isRowAbsolute(){return this.type===fe.CELL_REFERENCE_ABSOLUTE||this.type===fe.CELL_REFERENCE_ABSOLUTE_ROW}isColumnAbsolute(){return this.type===fe.CELL_REFERENCE_ABSOLUTE||this.type===fe.CELL_REFERENCE_ABSOLUTE_COL}isColumnRelative(){return this.type===fe.CELL_REFERENCE_RELATIVE||this.type===fe.CELL_REFERENCE_ABSOLUTE_ROW}isRowRelative(){return this.type===fe.CELL_REFERENCE_RELATIVE||this.type===fe.CELL_REFERENCE_ABSOLUTE_COL}isAbsolute(){return this.type===fe.CELL_REFERENCE_ABSOLUTE&&this.sheet!==void 0}shiftedByRows(e){return new Ne(this.col,this.row+e,this.type,this.sheet)}shiftedByColumns(e){return new Ne(this.col+e,this.row,this.type,this.sheet)}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new Ne(this.col+t,this.row+r,this.type,n)}withSheet(e){return new Ne(this.col,this.row,this.type,e)}isInvalid(e){return Ct(this.toSimpleCellAddress(e))}shiftRelativeDimensions(e,t){const r=this.isColumnAbsolute()?this.col:this.col+e,n=this.isRowAbsolute()?this.row:this.row+t;return new Ne(r,n,this.type,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnRelative()?this.col:this.col+e,n=this.isRowRelative()?this.row:this.row+t;return new Ne(r,n,this.type,this.sheet)}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case fe.CELL_REFERENCE_RELATIVE:return`${t}#${this.row}R${this.col}`;case fe.CELL_REFERENCE_ABSOLUTE:return`${t}#${this.row}A${this.col}`;case fe.CELL_REFERENCE_ABSOLUTE_COL:return`${t}#${this.row}AC${this.col}`;case fe.CELL_REFERENCE_ABSOLUTE_ROW:return`${t}#${this.row}AR${this.col}`}}unparse(e){const t=this.toSimpleCellAddress(e);if(Ct(t))return;const r=ya(t.col),n=this.type===fe.CELL_REFERENCE_ABSOLUTE||this.type===fe.CELL_REFERENCE_ABSOLUTE_ROW?"$":"";return`${this.type===fe.CELL_REFERENCE_ABSOLUTE||this.type===fe.CELL_REFERENCE_ABSOLUTE_COL?"$":""}${r}${n}${t.row+1}`}exceedsSheetSizeLimits(e,t){return this.row>=t||this.col>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Qs=":",Nt="$",xg="\\s+",_g="[ \\t\\n\\r]+",Na="A-Za-zÀ-ʯ",Xo=`${Na}0-9_.`,Kc=`[${Na}0-9_]+`,Lg="'(((?!').|'')*)'",ns=`(${Kc}|${Lg})!`,qc=`(${ns})?\\${Nt}?[A-Za-z]+\\${Nt}?[0-9]+`,Wu=`(${ns})?\\${Nt}?[A-Za-z]+`,zu=`(${ns})?\\${Nt}?[0-9]+`,Qc="[rR][0-9]*[cC][0-9]*",Fg=`(${qc})[^${Xo}]`,Zc=`[${Na}_][${Xo}]*`,Ug=["0","1","2","3","4","5","6","7","8","9"],Jc=[...Array.from(Array(26)).map((s,e)=>e+65),...Array.from(Array(26)).map((s,e)=>e+97),...Array.from(Array(496)).map((s,e)=>e+192)].map(s=>String.fromCharCode(s));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const eh=new RegExp(`^(${ns})?(\\${Nt}?)([A-Za-z]+)(\\${Nt}?)([0-9]+)$`),Pg=new RegExp(`^(${ns})?(\\${Nt}?)([A-Za-z]+)$`),Dg=new RegExp(`^(${ns})?(\\${Nt}?)([0-9]+)$`),Vg=new RegExp(`^${Kc}$`),Pn=(s,e,t)=>{const r=eh.exec(e),n=Ko(r[6]);let i=Ta(r,s);if(i===void 0)return;i===null&&(i=void 0);const a=Number(r[8])-1;return r[5]===Nt&&r[7]===Nt?Ne.absolute(n,a,i):r[5]===Nt?Ne.absoluteCol(n,a-t.row,i):r[7]===Nt?Ne.absoluteRow(n-t.col,a,i):Ne.relative(n-t.col,a-t.row,i)},Gi=(s,e,t)=>{const r=Pg.exec(e);let n=Ta(r,s);if(n===void 0)return;n===null&&(n=void 0);const i=Ko(r[6]);return r[5]===Nt?Rt.absolute(i,n):Rt.relative(i-t.col,n)},Hi=(s,e,t)=>{const r=Dg.exec(e);let n=Ta(r,s);if(n===void 0)return;n===null&&(n=void 0);const i=Number(r[6])-1;return r[5]===Nt?mt.absolute(i,n):mt.relative(i-t.row,n)},uo=(s,e,t)=>{const r=eh.exec(e);if(!r)return;const n=Ko(r[6]);let i=Ta(r,s);if(i===void 0)return;i===null&&(i=t);const a=Number(r[8])-1;return x(i,n,a)},Bg=(s,e,t)=>{const r=e.split(Qs);if(r.length!==2)return;const[n,i]=r,a=uo(s,n,t);if(a===void 0)return;const o=uo(s,i,a.sheet);if(o!==void 0&&a.sheet===o.sheet)return Ao(a,o)},Wi=(s,e,t)=>{const r=ya(e.col),n=th(e.sheet,s);if(n!==void 0)return t!==e.sheet?`${n}!${r}${e.row+1}`:`${r}${e.row+1}`},kg=(s,e,t)=>{const r=Wi(s,e.start,t),n=Wi(s,e.end,e.start.sheet);if(!(r===void 0||n===void 0))return`${r}${Qs}${n}`};function Ko(s){return s.length===1?s.toUpperCase().charCodeAt(0)-65:s.split("").reduce((e,t)=>e*26+(t.toUpperCase().charCodeAt(0)-64),0)-1}function ya(s){let e="";for(;s>=0;)e=String.fromCharCode(s%26+97)+e,s=Math.floor(s/26)-1;return e.toUpperCase()}function th(s,e){let t=e(s);if(t!==void 0)return Vg.test(t)?t:(t=t.replace(/'/g,"''"),`'${t}'`)}function Ta(s,e){var t;let r=(t=s[3])!==null&&t!==void 0?t:s[2];return r?(r=r.replace(/''/g,"'"),e(r)):null}function ye(s){return s&&s.length===0}function Hr(s){return s==null?[]:Object.keys(s)}function gt(s){for(var e=[],t=Object.keys(s),r=0;r<t.length;r++)e.push(s[t[r]]);return e}function Gg(s,e){for(var t=[],r=Hr(s),n=0;n<r.length;n++){var i=r[n];t.push(e.call(null,s[i],i))}return t}function P(s,e){for(var t=[],r=0;r<s.length;r++)t.push(e.call(null,s[r],r));return t}function Mt(s){for(var e=[],t=0;t<s.length;t++){var r=s[t];Array.isArray(r)?e=e.concat(Mt(r)):e.push(r)}return e}function Jt(s){return ye(s)?void 0:s[0]}function rh(s){var e=s&&s.length;return e?s[e-1]:void 0}function W(s,e){if(Array.isArray(s))for(var t=0;t<s.length;t++)e.call(null,s[t],t);else if(Qo(s))for(var r=Hr(s),t=0;t<r.length;t++){var n=r[t],i=s[n];e.call(null,i,n)}else throw Error("non exhaustive match")}function wr(s){return typeof s=="string"}function er(s){return s===void 0}function un(s){return s instanceof Function}function ct(s,e){return e===void 0&&(e=1),s.slice(e,s.length)}function Bs(s,e){return e===void 0&&(e=1),s.slice(0,s.length-e)}function dr(s,e){var t=[];if(Array.isArray(s))for(var r=0;r<s.length;r++){var n=s[r];e.call(null,n)&&t.push(n)}return t}function An(s,e){return dr(s,function(t){return!e(t)})}function nr(s,e){for(var t=Object.keys(s),r={},n=0;n<t.length;n++){var i=t[n],a=s[i];e(a)&&(r[i]=a)}return r}function H(s,e){return Qo(s)?s.hasOwnProperty(e):!1}function Xe(s,e){return Jn(s,function(t){return t===e})!==void 0}function Ot(s){for(var e=[],t=0;t<s.length;t++)e.push(s[t]);return e}function Zs(s){var e={};for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t]);return e}function Jn(s,e){for(var t=0;t<s.length;t++){var r=s[t];if(e.call(null,r))return r}}function Hg(s,e){for(var t=[],r=0;r<s.length;r++){var n=s[r];e.call(null,n)&&t.push(n)}return t}function dt(s,e,t){for(var r=Array.isArray(s),n=r?s:gt(s),i=r?[]:Hr(s),a=t,o=0;o<n.length;o++)a=e.call(null,a,n[o],r?o:i[o]);return a}function Js(s){return An(s,function(e){return e==null})}function qo(s,e){e===void 0&&(e=function(r){return r});var t=[];return dt(s,function(r,n){var i=e(n);return Xe(t,i)?r:(t.push(i),r.concat(n))},[])}function lr(s){return Array.isArray(s)}function Gr(s){return s instanceof RegExp}function Qo(s){return s instanceof Object}function Zt(s,e){for(var t=0;t<s.length;t++)if(!e(s[t],t))return!1;return!0}function va(s,e){return An(s,function(t){return Xe(e,t)})}function nh(s,e){for(var t=0;t<s.length;t++)if(e(s[t]))return!0;return!1}function Wg(s,e){for(var t=0;t<s.length;t++)if(s[t]===e)return t;return-1}function fr(s){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r++)for(var n=e[r],i=Hr(n),a=0;a<i.length;a++){var o=i[a];s[o]=n[o]}return s}function zg(s){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r++){var n=e[r];if(!er(n))for(var i=Hr(n),a=0;a<i.length;a++){var o=i[a];H(s,o)||(s[o]=n[o])}}return s}function Sa(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return zg.apply(null,[{}].concat(s))}function sh(s,e){var t={};return W(s,function(r){var n=e(r),i=t[n];i?i.push(r):t[n]=[r]}),t}function Yu(s,e){for(var t=Zs(s),r=Hr(e),n=0;n<r.length;n++){var i=r[n],a=e[i];t[i]=a}return t}function qe(){}function ju(s){return s}function Yg(s){for(var e=[],t=0;t<s.length;t++){var r=s[t];e.push(r!==void 0?r:void 0)}return e}function lo(s){console&&console.error&&console.error("Error: "+s)}function Zo(s){console&&console.warn&&console.warn("Warning: "+s)}function $u(){return typeof Map=="function"}function jg(s,e){e.forEach(function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach(function(n){if(n!=="constructor"){var i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(s.prototype,n,i):s.prototype[n]=t.prototype[n]}})})}function ih(s){function e(){}e.prototype=s;var t=new e;function r(){return typeof t.bar}return r(),r(),s}function zi(s){return s[s.length-1]}function ah(s){var e=new Date().getTime(),t=s(),r=new Date().getTime(),n=r-e;return{time:n,value:t}}var Ii={exports:{}},$g=Ii.exports,Xu;function Xg(){return Xu||(Xu=1,function(s){(function(e,t){s.exports?s.exports=t():e.regexpToAst=t()})(typeof self<"u"?self:$g,function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(g){this.idx=g.idx,this.input=g.input,this.groupIdx=g.groupIdx},e.prototype.pattern=function(g){this.idx=0,this.input=g,this.groupIdx=0,this.consumeChar("/");var S=this.disjunction();this.consumeChar("/");for(var v={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":o(v,"global");break;case"i":o(v,"ignoreCase");break;case"m":o(v,"multiLine");break;case"u":o(v,"unicode");break;case"y":o(v,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:v,value:S}},e.prototype.disjunction=function(){var g=[];for(g.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),g.push(this.alternative());return{type:"Disjunction",value:g}},e.prototype.alternative=function(){for(var g=[];this.isTerm();)g.push(this.term());return{type:"Alternative",value:g}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var g;switch(this.popChar()){case"=":g="Lookahead";break;case"!":g="NegativeLookahead";break}u(g);var S=this.disjunction();return this.consumeChar(")"),{type:g,value:S}}l()},e.prototype.quantifier=function(g){var S;switch(this.popChar()){case"*":S={atLeast:0,atMost:1/0};break;case"+":S={atLeast:1,atMost:1/0};break;case"?":S={atLeast:0,atMost:1};break;case"{":var v=this.integerIncludingZero();switch(this.popChar()){case"}":S={atLeast:v,atMost:v};break;case",":var A;this.isDigit()?(A=this.integerIncludingZero(),S={atLeast:v,atMost:A}):S={atLeast:v,atMost:1/0},this.consumeChar("}");break}if(g===!0&&S===void 0)return;u(S);break}if(!(g===!0&&S===void 0))return u(S),this.peekChar(0)==="?"?(this.consumeChar("?"),S.greedy=!1):S.greedy=!0,S.type="Quantifier",S},e.prototype.atom=function(){var g;switch(this.peekChar()){case".":g=this.dotAll();break;case"\\":g=this.atomEscape();break;case"[":g=this.characterClass();break;case"(":g=this.group();break}return g===void 0&&this.isPatternCharacter()&&(g=this.patternCharacter()),u(g),this.isQuantifier()&&(g.quantifier=this.quantifier()),g},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[i(`
`),i("\r"),i("\u2028"),i("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var g=this.positiveInteger();return{type:"GroupBackReference",value:g}},e.prototype.characterClassEscape=function(){var g,S=!1;switch(this.popChar()){case"d":g=d;break;case"D":g=d,S=!0;break;case"s":g=p;break;case"S":g=p,S=!0;break;case"w":g=f;break;case"W":g=f,S=!0;break}return u(g),{type:"Set",value:g,complement:S}},e.prototype.controlEscapeAtom=function(){var g;switch(this.popChar()){case"f":g=i("\f");break;case"n":g=i(`
`);break;case"r":g=i("\r");break;case"t":g=i("	");break;case"v":g=i("\v");break}return u(g),{type:"Character",value:g}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var g=this.popChar();if(/[a-zA-Z]/.test(g)===!1)throw Error("Invalid ");var S=g.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:S}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:i("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var g=this.popChar();return{type:"Character",value:i(g)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var g=this.popChar();return{type:"Character",value:i(g)}}},e.prototype.characterClass=function(){var g=[],S=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),S=!0);this.isClassAtom();){var v=this.classAtom(),A=v.type==="Character";if(A&&this.isRangeDash()){this.consumeChar("-");var C=this.classAtom(),w=C.type==="Character";if(w){if(C.value<v.value)throw Error("Range out of order in character class");g.push({from:v.value,to:C.value})}else a(v.value,g),g.push(i("-")),a(C.value,g)}else a(v.value,g)}return this.consumeChar("]"),{type:"Set",complement:S,value:g}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:i("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var g=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),g=!1;break;default:this.groupIdx++;break}var S=this.disjunction();this.consumeChar(")");var v={type:"Group",capturing:g,value:S};return g&&(v.idx=this.groupIdx),v},e.prototype.positiveInteger=function(){var g=this.popChar();if(n.test(g)===!1)throw Error("Expecting a positive integer");for(;r.test(this.peekChar(0));)g+=this.popChar();return parseInt(g,10)},e.prototype.integerIncludingZero=function(){var g=this.popChar();if(r.test(g)===!1)throw Error("Expecting an integer");for(;r.test(this.peekChar(0));)g+=this.popChar();return parseInt(g,10)},e.prototype.patternCharacter=function(){var g=this.popChar();switch(g){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:i(g)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},e.prototype.isDigit=function(){return r.test(this.peekChar(0))},e.prototype.isClassAtom=function(g){switch(g===void 0&&(g=0),this.peekChar(g)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}},e.prototype.isQuantifier=function(){var g=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(g)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(g){for(var S="",v=0;v<g;v++){var A=this.popChar();if(t.test(A)===!1)throw Error("Expecting a HexDecimal digits");S+=A}var C=parseInt(S,16);return{type:"Character",value:C}},e.prototype.peekChar=function(g){return g===void 0&&(g=0),this.input[this.idx+g]},e.prototype.popChar=function(){var g=this.peekChar(0);return this.consumeChar(),g},e.prototype.consumeChar=function(g){if(g!==void 0&&this.input[this.idx]!==g)throw Error("Expected: '"+g+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t=/[0-9a-fA-F]/,r=/[0-9]/,n=/[1-9]/;function i(g){return g.charCodeAt(0)}function a(g,S){g.length!==void 0?g.forEach(function(v){S.push(v)}):S.push(g)}function o(g,S){if(g[S]===!0)throw"duplicate flag "+S;g[S]=!0}function u(g){if(g===void 0)throw Error("Internal Error - Should never get here!")}function l(){throw Error("Internal Error - Should never get here!")}var h,d=[];for(h=i("0");h<=i("9");h++)d.push(h);var f=[i("_")].concat(d);for(h=i("a");h<=i("z");h++)f.push(h);for(h=i("A");h<=i("Z");h++)f.push(h);var p=[i(" "),i("\f"),i(`
`),i("\r"),i("	"),i("\v"),i("	"),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i("\u2028"),i("\u2029"),i(" "),i(" "),i("　"),i("\uFEFF")];function N(){}return N.prototype.visitChildren=function(g){for(var S in g){var v=g[S];g.hasOwnProperty(S)&&(v.type!==void 0?this.visit(v):Array.isArray(v)&&v.forEach(function(A){this.visit(A)},this))}},N.prototype.visit=function(g){switch(g.type){case"Pattern":this.visitPattern(g);break;case"Flags":this.visitFlags(g);break;case"Disjunction":this.visitDisjunction(g);break;case"Alternative":this.visitAlternative(g);break;case"StartAnchor":this.visitStartAnchor(g);break;case"EndAnchor":this.visitEndAnchor(g);break;case"WordBoundary":this.visitWordBoundary(g);break;case"NonWordBoundary":this.visitNonWordBoundary(g);break;case"Lookahead":this.visitLookahead(g);break;case"NegativeLookahead":this.visitNegativeLookahead(g);break;case"Character":this.visitCharacter(g);break;case"Set":this.visitSet(g);break;case"Group":this.visitGroup(g);break;case"GroupBackReference":this.visitGroupBackReference(g);break;case"Quantifier":this.visitQuantifier(g);break}this.visitChildren(g)},N.prototype.visitPattern=function(g){},N.prototype.visitFlags=function(g){},N.prototype.visitDisjunction=function(g){},N.prototype.visitAlternative=function(g){},N.prototype.visitStartAnchor=function(g){},N.prototype.visitEndAnchor=function(g){},N.prototype.visitWordBoundary=function(g){},N.prototype.visitNonWordBoundary=function(g){},N.prototype.visitLookahead=function(g){},N.prototype.visitNegativeLookahead=function(g){},N.prototype.visitCharacter=function(g){},N.prototype.visitSet=function(g){},N.prototype.visitGroup=function(g){},N.prototype.visitGroupBackReference=function(g){},N.prototype.visitQuantifier=function(g){},{RegExpParser:e,BaseRegExpVisitor:N,VERSION:"0.4.0"}})}(Ii)),Ii.exports}var ei=Xg(),wi={},Kg=new ei.RegExpParser;function Aa(s){var e=s.toString();if(wi.hasOwnProperty(e))return wi[e];var t=Kg.pattern(e);return wi[e]=t,t}function qg(){wi={}}var Qg=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),oh="Complement Sets are not supported for first char optimization",Yi=`Unable to use "first char" lexer optimizations:
`;function Zg(s,e){e===void 0&&(e=!1);try{var t=Aa(s),r=co(t.value,{},t.flags.ignoreCase);return r}catch(i){if(i.message===oh)e&&Zo(""+Yi+("	Unable to optimize: < "+s.toString()+` >
`)+`	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{var n="";e&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),lo(Yi+`
`+("	Failed parsing: < "+s.toString()+` >
`)+("	Using the regexp-to-ast library version: "+ei.VERSION+`
`)+"	Please open an issue at: https://github.com/bd82/regexp-to-ast/issues"+n)}}return[]}function co(s,e,t){switch(s.type){case"Disjunction":for(var r=0;r<s.value.length;r++)co(s.value[r],e,t);break;case"Alternative":for(var n=s.value,r=0;r<n.length;r++){var i=n[r];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var a=i;switch(a.type){case"Character":ai(a.value,e,t);break;case"Set":if(a.complement===!0)throw Error(oh);W(a.value,function(l){if(typeof l=="number")ai(l,e,t);else{var h=l;if(t===!0)for(var d=h.from;d<=h.to;d++)ai(d,e,t);else{for(var d=h.from;d<=h.to&&d<Ts;d++)ai(d,e,t);if(h.to>=Ts)for(var f=h.from>=Ts?h.from:Ts,p=h.to,N=an(f),g=an(p),S=N;S<=g;S++)e[S]=S}}});break;case"Group":co(a.value,e,t);break;default:throw Error("Non Exhaustive Match")}var o=a.quantifier!==void 0&&a.quantifier.atLeast===0;if(a.type==="Group"&&ho(a)===!1||a.type!=="Group"&&o===!1)break}break;default:throw Error("non exhaustive match!")}return gt(e)}function ai(s,e,t){var r=an(s);e[r]=r,t===!0&&Jg(s,e)}function Jg(s,e){var t=String.fromCharCode(s),r=t.toUpperCase();if(r!==t){var n=an(r.charCodeAt(0));e[n]=n}else{var i=t.toLowerCase();if(i!==t){var n=an(i.charCodeAt(0));e[n]=n}}}function Ku(s,e){return Jn(s.value,function(t){if(typeof t=="number")return Xe(e,t);var r=t;return Jn(e,function(n){return r.from<=n&&n<=r.to})!==void 0})}function ho(s){return s.quantifier&&s.quantifier.atLeast===0?!0:s.value?lr(s.value)?Zt(s.value,ho):ho(s.value):!1}var eE=function(s){Qg(e,s);function e(t){var r=s.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return e.prototype.visitChildren=function(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}s.prototype.visitChildren.call(this,t)}},e.prototype.visitCharacter=function(t){Xe(this.targetCharCodes,t.value)&&(this.found=!0)},e.prototype.visitSet=function(t){t.complement?Ku(t,this.targetCharCodes)===void 0&&(this.found=!0):Ku(t,this.targetCharCodes)!==void 0&&(this.found=!0)},e}(ei.BaseRegExpVisitor);function Jo(s,e){if(e instanceof RegExp){var t=Aa(e),r=new eE(s);return r.visit(t),r.found}else return Jn(e,function(n){return Xe(s,n.charCodeAt(0))})!==void 0}var uh=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Mr="PATTERN",Tn="defaultMode",oi="modes",lh=typeof new RegExp("(?:)").sticky=="boolean";function tE(s,e){e=Sa(e,{useSticky:lh,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:function(A,C){return C()}});var t=e.tracer;t("initCharCodeToOptimizedIndexMap",function(){AE()});var r;t("Reject Lexer.NA",function(){r=An(s,function(A){return A[Mr]===wt.NA})});var n=!1,i;t("Transform Patterns",function(){n=!1,i=P(r,function(A){var C=A[Mr];if(Gr(C)){var w=C.source;return w.length===1&&w!=="^"&&w!=="$"&&w!=="."?w:w.length===2&&w[0]==="\\"&&!Xe(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],w[1])?w[1]:e.useSticky?Qu(C):qu(C)}else{if(un(C))return n=!0,{exec:C};if(H(C,"exec"))return n=!0,C;if(typeof C=="string"){if(C.length===1)return C;var M=C.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),L=new RegExp(M);return e.useSticky?Qu(L):qu(L)}else throw Error("non exhaustive match")}})});var a,o,u,l,h;t("misc mapping",function(){a=P(r,function(A){return A.tokenTypeIdx}),o=P(r,function(A){var C=A.GROUP;if(C!==wt.SKIPPED){if(wr(C))return C;if(er(C))return!1;throw Error("non exhaustive match")}}),u=P(r,function(A){var C=A.LONGER_ALT;if(C){var w=Wg(r,C);return w}}),l=P(r,function(A){return A.PUSH_MODE}),h=P(r,function(A){return H(A,"POP_MODE")})});var d;t("Line Terminator Handling",function(){var A=dh(e.lineTerminatorCharacters);d=P(r,function(C){return!1}),e.positionTracking!=="onlyOffset"&&(d=P(r,function(C){if(H(C,"LINE_BREAKS"))return C.LINE_BREAKS;if(hh(C,A)===!1)return Jo(A,C.PATTERN)}))});var f,p,N,g;t("Misc Mapping #2",function(){f=P(r,ch),p=P(i,TE),N=dt(r,function(A,C){var w=C.GROUP;return wr(w)&&w!==wt.SKIPPED&&(A[w]=[]),A},{}),g=P(i,function(A,C){return{pattern:i[C],longerAlt:u[C],canLineTerminator:d[C],isCustom:f[C],short:p[C],group:o[C],push:l[C],pop:h[C],tokenTypeIdx:a[C],tokenType:r[C]}})});var S=!0,v=[];return e.safeMode||t("First Char Optimization",function(){v=dt(r,function(A,C,w){if(typeof C.PATTERN=="string"){var M=C.PATTERN.charCodeAt(0),L=an(M);Wa(A,L,g[w])}else if(lr(C.START_CHARS_HINT)){var _;W(C.START_CHARS_HINT,function(k){var G=typeof k=="string"?k.charCodeAt(0):k,U=an(G);_!==U&&(_=U,Wa(A,U,g[w]))})}else if(Gr(C.PATTERN))if(C.PATTERN.unicode)S=!1,e.ensureOptimizations&&lo(""+Yi+("	Unable to analyze < "+C.PATTERN.toString()+` > pattern.
`)+`	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{var V=Zg(C.PATTERN,e.ensureOptimizations);ye(V)&&(S=!1),W(V,function(k){Wa(A,k,g[w])})}else e.ensureOptimizations&&lo(""+Yi+("	TokenType: <"+C.name+`> is using a custom token pattern without providing <start_chars_hint> parameter.
`)+`	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),S=!1;return A},[])}),t("ArrayPacking",function(){v=Yg(v)}),{emptyGroups:N,patternIdxToConfig:g,charCodeToPatternIdxToConfig:v,hasCustom:n,canBeOptimized:S}}function rE(s,e){var t=[],r=sE(s);t=t.concat(r.errors);var n=iE(r.valid),i=n.valid;return t=t.concat(n.errors),t=t.concat(nE(i)),t=t.concat(fE(i)),t=t.concat(pE(i,e)),t=t.concat(mE(i)),t}function nE(s){var e=[],t=dr(s,function(r){return Gr(r[Mr])});return e=e.concat(oE(t)),e=e.concat(cE(t)),e=e.concat(hE(t)),e=e.concat(dE(t)),e=e.concat(uE(t)),e}function sE(s){var e=dr(s,function(n){return!H(n,Mr)}),t=P(e,function(n){return{message:"Token Type: ->"+n.name+"<- missing static 'PATTERN' property",type:He.MISSING_PATTERN,tokenTypes:[n]}}),r=va(s,e);return{errors:t,valid:r}}function iE(s){var e=dr(s,function(n){var i=n[Mr];return!Gr(i)&&!un(i)&&!H(i,"exec")&&!wr(i)}),t=P(e,function(n){return{message:"Token Type: ->"+n.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:He.INVALID_PATTERN,tokenTypes:[n]}}),r=va(s,e);return{errors:t,valid:r}}var aE=/[^\\][\$]/;function oE(s){var e=function(n){uh(i,n);function i(){var a=n!==null&&n.apply(this,arguments)||this;return a.found=!1,a}return i.prototype.visitEndAnchor=function(a){this.found=!0},i}(ei.BaseRegExpVisitor),t=dr(s,function(n){var i=n[Mr];try{var a=Aa(i),o=new e;return o.visit(a),o.found}catch{return aE.test(i.source)}}),r=P(t,function(n){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+n.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:He.EOI_ANCHOR_FOUND,tokenTypes:[n]}});return r}function uE(s){var e=dr(s,function(r){var n=r[Mr];return n.test("")}),t=P(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:He.EMPTY_MATCH_PATTERN,tokenTypes:[r]}});return t}var lE=/[^\\[][\^]|^\^/;function cE(s){var e=function(n){uh(i,n);function i(){var a=n!==null&&n.apply(this,arguments)||this;return a.found=!1,a}return i.prototype.visitStartAnchor=function(a){this.found=!0},i}(ei.BaseRegExpVisitor),t=dr(s,function(n){var i=n[Mr];try{var a=Aa(i),o=new e;return o.visit(a),o.found}catch{return lE.test(i.source)}}),r=P(t,function(n){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+n.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:He.SOI_ANCHOR_FOUND,tokenTypes:[n]}});return r}function hE(s){var e=dr(s,function(r){var n=r[Mr];return n instanceof RegExp&&(n.multiline||n.global)}),t=P(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:He.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}});return t}function dE(s){var e=[],t=P(s,function(i){return dt(s,function(a,o){return i.PATTERN.source===o.PATTERN.source&&!Xe(e,o)&&o.PATTERN!==wt.NA&&(e.push(o),a.push(o)),a},[])});t=Js(t);var r=dr(t,function(i){return i.length>1}),n=P(r,function(i){var a=P(i,function(u){return u.name}),o=Jt(i).PATTERN;return{message:"The same RegExp pattern ->"+o+"<-"+("has been used in all of the following Token Types: "+a.join(", ")+" <-"),type:He.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}});return n}function fE(s){var e=dr(s,function(r){if(!H(r,"GROUP"))return!1;var n=r.GROUP;return n!==wt.SKIPPED&&n!==wt.NA&&!wr(n)}),t=P(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:He.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}});return t}function pE(s,e){var t=dr(s,function(n){return n.PUSH_MODE!==void 0&&!Xe(e,n.PUSH_MODE)}),r=P(t,function(n){var i="Token Type: ->"+n.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+n.PUSH_MODE+"<-which does not exist";return{message:i,type:He.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[n]}});return r}function mE(s){var e=[],t=dt(s,function(r,n,i){var a=n.PATTERN;return a===wt.NA||(wr(a)?r.push({str:a,idx:i,tokenType:n}):Gr(a)&&EE(a)&&r.push({str:a.source,idx:i,tokenType:n})),r},[]);return W(s,function(r,n){W(t,function(i){var a=i.str,o=i.idx,u=i.tokenType;if(n<o&&gE(a,r.PATTERN)){var l="Token: ->"+u.name+`<- can never be matched.
`+("Because it appears AFTER the Token Type ->"+r.name+"<-")+`in the lexer's definition.
See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:l,type:He.UNREACHABLE_PATTERN,tokenTypes:[r,u]})}})}),e}function gE(s,e){if(Gr(e)){var t=e.exec(s);return t!==null&&t.index===0}else{if(un(e))return e(s,0,[],{});if(H(e,"exec"))return e.exec(s,0,[],{});if(typeof e=="string")return e===s;throw Error("non exhaustive match")}}function EE(s){var e=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return Jn(e,function(t){return s.source.indexOf(t)!==-1})===void 0}function qu(s){var e=s.ignoreCase?"i":"";return new RegExp("^(?:"+s.source+")",e)}function Qu(s){var e=s.ignoreCase?"iy":"y";return new RegExp(""+s.source,e)}function RE(s,e,t){var r=[];return H(s,Tn)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Tn+`> property in its definition
`,type:He.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),H(s,oi)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+oi+`> property in its definition
`,type:He.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),H(s,oi)&&H(s,Tn)&&!H(s.modes,s.defaultMode)&&r.push({message:"A MultiMode Lexer cannot be initialized with a "+Tn+": <"+s.defaultMode+`>which does not exist
`,type:He.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),H(s,oi)&&W(s.modes,function(n,i){W(n,function(a,o){er(a)&&r.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+("<"+i+"> at index: <"+o+`>
`),type:He.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),r}function NE(s,e,t){var r=[],n=!1,i=Js(Mt(Gg(s.modes,function(u){return u}))),a=An(i,function(u){return u[Mr]===wt.NA}),o=dh(t);return e&&W(a,function(u){var l=hh(u,o);if(l!==!1){var h=SE(u,l),d={message:h,type:l.issue,tokenType:u};r.push(d)}else H(u,"LINE_BREAKS")?u.LINE_BREAKS===!0&&(n=!0):Jo(o,u.PATTERN)&&(n=!0)}),e&&!n&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:He.NO_LINE_BREAKS_FLAGS}),r}function yE(s){var e={},t=Hr(s);return W(t,function(r){var n=s[r];if(lr(n))e[r]=[];else throw Error("non exhaustive match")}),e}function ch(s){var e=s.PATTERN;if(Gr(e))return!1;if(un(e))return!0;if(H(e,"exec"))return!0;if(wr(e))return!1;throw Error("non exhaustive match")}function TE(s){return wr(s)&&s.length===1?s.charCodeAt(0):!1}var vE={test:function(s){for(var e=s.length,t=this.lastIndex;t<e;t++){var r=s.charCodeAt(t);if(r===10)return this.lastIndex=t+1,!0;if(r===13)return s.charCodeAt(t+1)===10?this.lastIndex=t+2:this.lastIndex=t+1,!0}return!1},lastIndex:0};function hh(s,e){if(H(s,"LINE_BREAKS"))return!1;if(Gr(s.PATTERN)){try{Jo(e,s.PATTERN)}catch(t){return{issue:He.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}else{if(wr(s.PATTERN))return!1;if(ch(s))return{issue:He.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function SE(s,e){if(e.issue===He.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
`+("	The problem is in the <"+s.name+`> Token Type
`)+("	 Root cause: "+e.errMsg+`.
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(e.issue===He.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
`+("	The problem is in the <"+s.name+`> Token Type
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function dh(s){var e=P(s,function(t){return wr(t)&&t.length>0?t.charCodeAt(0):t});return e}function Wa(s,e,t){s[e]===void 0?s[e]=[t]:s[e].push(t)}var Ts=256;function an(s){return s<Ts?s:Mi[s]}var Mi=[];function AE(){if(ye(Mi)){Mi=new Array(65536);for(var s=0;s<65536;s++)Mi[s]=s>255?255+~~(s/255):s}}function Ca(s,e){var t=s.tokenTypeIdx;return t===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[t]===!0}function ji(s,e){return s.tokenTypeIdx===e.tokenTypeIdx}var Zu=1,fh={};function ti(s){var e=CE(s);IE(e),ME(e),wE(e),W(e,function(t){t.isParent=t.categoryMatches.length>0})}function CE(s){for(var e=Ot(s),t=s,r=!0;r;){t=Js(Mt(P(t,function(i){return i.CATEGORIES})));var n=va(t,e);e=e.concat(n),ye(n)?r=!1:t=n}return e}function IE(s){W(s,function(e){mh(e)||(fh[Zu]=e,e.tokenTypeIdx=Zu++),Ju(e)&&!lr(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Ju(e)||(e.CATEGORIES=[]),OE(e)||(e.categoryMatches=[]),bE(e)||(e.categoryMatchesMap={})})}function wE(s){W(s,function(e){e.categoryMatches=[],W(e.categoryMatchesMap,function(t,r){e.categoryMatches.push(fh[r].tokenTypeIdx)})})}function ME(s){W(s,function(e){ph([],e)})}function ph(s,e){W(s,function(t){e.categoryMatchesMap[t.tokenTypeIdx]=!0}),W(e.CATEGORIES,function(t){var r=s.concat(e);Xe(r,t)||ph(r,t)})}function mh(s){return H(s,"tokenTypeIdx")}function Ju(s){return H(s,"CATEGORIES")}function OE(s){return H(s,"categoryMatches")}function bE(s){return H(s,"categoryMatchesMap")}function xE(s){return H(s,"tokenTypeIdx")}var _E={buildUnableToPopLexerModeMessage:function(s){return"Unable to pop Lexer Mode after encountering Token ->"+s.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(s,e,t,r,n){return"unexpected character: ->"+s.charAt(e)+"<- at offset: "+e+","+(" skipped "+t+" characters.")}},He;(function(s){s[s.MISSING_PATTERN=0]="MISSING_PATTERN",s[s.INVALID_PATTERN=1]="INVALID_PATTERN",s[s.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",s[s.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",s[s.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",s[s.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",s[s.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",s[s.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",s[s.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",s[s.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",s[s.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",s[s.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",s[s.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",s[s.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",s[s.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",s[s.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",s[s.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"})(He||(He={}));var vs={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:_E,traceInitPerf:!1,skipValidations:!1};Object.freeze(vs);var wt=function(){function s(e,t){var r=this;if(t===void 0&&(t=vs),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},typeof t=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Yu(vs,t);var n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var i,a=!0;r.TRACE_INIT("Lexer Config handling",function(){if(r.config.lineTerminatorsPattern===vs.lineTerminatorsPattern)r.config.lineTerminatorsPattern=vE;else if(r.config.lineTerminatorCharacters===vs.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');r.trackStartLines=/full|onlyStart/i.test(r.config.positionTracking),r.trackEndLines=/full/i.test(r.config.positionTracking),lr(e)?(i={modes:{}},i.modes[Tn]=Ot(e),i[Tn]=Tn):(a=!1,i=Zs(e))}),r.config.skipValidations===!1&&(r.TRACE_INIT("performRuntimeChecks",function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(RE(i,r.trackStartLines,r.config.lineTerminatorCharacters))}),r.TRACE_INIT("performWarningRuntimeChecks",function(){r.lexerDefinitionWarning=r.lexerDefinitionWarning.concat(NE(i,r.trackStartLines,r.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},W(i.modes,function(h,d){i.modes[d]=An(h,function(f){return er(f)})});var o=Hr(i.modes);if(W(i.modes,function(h,d){r.TRACE_INIT("Mode: <"+d+"> processing",function(){if(r.modes.push(d),r.config.skipValidations===!1&&r.TRACE_INIT("validatePatterns",function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(rE(h,o))}),ye(r.lexerDefinitionErrors)){ti(h);var f;r.TRACE_INIT("analyzeTokenTypes",function(){f=tE(h,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:r.TRACE_INIT.bind(r)})}),r.patternIdxToConfig[d]=f.patternIdxToConfig,r.charCodeToPatternIdxToConfig[d]=f.charCodeToPatternIdxToConfig,r.emptyGroups=Yu(r.emptyGroups,f.emptyGroups),r.hasCustom=f.hasCustom||r.hasCustom,r.canModeBeOptimized[d]=f.canBeOptimized}})}),r.defaultMode=i.defaultMode,!ye(r.lexerDefinitionErrors)&&!r.config.deferDefinitionErrorsHandling){var u=P(r.lexerDefinitionErrors,function(h){return h.message}),l=u.join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+l)}W(r.lexerDefinitionWarning,function(h){Zo(h.message)}),r.TRACE_INIT("Choosing sub-methods implementations",function(){if(lh?(r.chopInput=ju,r.match=r.matchWithTest):(r.updateLastIndex=qe,r.match=r.matchWithExec),a&&(r.handleModes=qe),r.trackStartLines===!1&&(r.computeNewColumn=ju),r.trackEndLines===!1&&(r.updateTokenEndLineColumnLocation=qe),/full/i.test(r.config.positionTracking))r.createTokenInstance=r.createFullToken;else if(/onlyStart/i.test(r.config.positionTracking))r.createTokenInstance=r.createStartOnlyToken;else if(/onlyOffset/i.test(r.config.positionTracking))r.createTokenInstance=r.createOffsetOnlyToken;else throw Error('Invalid <positionTracking> config option: "'+r.config.positionTracking+'"');r.hasCustom?(r.addToken=r.addTokenUsingPush,r.handlePayload=r.handlePayloadWithCustom):(r.addToken=r.addTokenUsingMemberAccess,r.handlePayload=r.handlePayloadNoCustom)}),r.TRACE_INIT("Failed Optimization Warnings",function(){var h=dt(r.canModeBeOptimized,function(d,f,p){return f===!1&&d.push(p),d},[]);if(t.ensureOptimizations&&!ye(h))throw Error("Lexer Modes: < "+h.join(", ")+` > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),r.TRACE_INIT("clearRegExpParserCache",function(){qg()}),r.TRACE_INIT("toFastProperties",function(){ih(r)})})}return s.prototype.tokenize=function(e,t){if(t===void 0&&(t=this.defaultMode),!ye(this.lexerDefinitionErrors)){var r=P(this.lexerDefinitionErrors,function(a){return a.message}),n=r.join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+n)}var i=this.tokenizeInternal(e,t);return i},s.prototype.tokenizeInternal=function(e,t){var r=this,n,i,a,o,u,l,h,d,f,p,N,g,S,v,A=e,C=A.length,w=0,M=0,L=this.hasCustom?0:Math.floor(e.length/10),_=new Array(L),V=[],k=this.trackStartLines?1:void 0,G=this.trackStartLines?1:void 0,U=yE(this.emptyGroups),K=this.trackStartLines,z=this.config.lineTerminatorsPattern,te=0,le=[],Te=[],Ee=[],Ue=[];Object.freeze(Ue);var re=void 0;function Re(){return le}function ve(me){var Ve=an(me),Q=Te[Ve];return Q===void 0?Ue:Q}var ne=function(me){if(Ee.length===1&&me.tokenType.PUSH_MODE===void 0){var Ve=r.config.errorMessageProvider.buildUnableToPopLexerModeMessage(me);V.push({offset:me.startOffset,line:me.startLine!==void 0?me.startLine:void 0,column:me.startColumn!==void 0?me.startColumn:void 0,length:me.image.length,message:Ve})}else{Ee.pop();var Q=rh(Ee);le=r.patternIdxToConfig[Q],Te=r.charCodeToPatternIdxToConfig[Q],te=le.length;var Ce=r.canModeBeOptimized[Q]&&r.config.safeMode===!1;Te&&Ce?re=ve:re=Re}};function Ae(me){Ee.push(me),Te=this.charCodeToPatternIdxToConfig[me],le=this.patternIdxToConfig[me],te=le.length,te=le.length;var Ve=this.canModeBeOptimized[me]&&this.config.safeMode===!1;Te&&Ve?re=ve:re=Re}Ae.call(this,t);for(var ce;w<C;){u=null;var nt=A.charCodeAt(w),ie=re(nt),zt=ie.length;for(n=0;n<zt;n++){ce=ie[n];var pe=ce.pattern;l=null;var Pe=ce.short;if(Pe!==!1?nt===Pe&&(u=pe):ce.isCustom===!0?(v=pe.exec(A,w,_,U),v!==null?(u=v[0],v.payload!==void 0&&(l=v.payload)):u=null):(this.updateLastIndex(pe,w),u=this.match(pe,e,w)),u!==null){if(o=ce.longerAlt,o!==void 0){var j=le[o],st=j.pattern;h=null,j.isCustom===!0?(v=st.exec(A,w,_,U),v!==null?(a=v[0],v.payload!==void 0&&(h=v.payload)):a=null):(this.updateLastIndex(st,w),a=this.match(st,e,w)),a&&a.length>u.length&&(u=a,l=h,ce=j)}break}}if(u!==null){if(d=u.length,f=ce.group,f!==void 0&&(p=ce.tokenTypeIdx,N=this.createTokenInstance(u,w,p,ce.tokenType,k,G,d),this.handlePayload(N,l),f===!1?M=this.addToken(_,M,N):U[f].push(N)),e=this.chopInput(e,d),w=w+d,G=this.computeNewColumn(G,d),K===!0&&ce.canLineTerminator===!0){var Ye=0,it=void 0,De=void 0;z.lastIndex=0;do it=z.test(u),it===!0&&(De=z.lastIndex-1,Ye++);while(it===!0);Ye!==0&&(k=k+Ye,G=d-De,this.updateTokenEndLineColumnLocation(N,f,De,Ye,k,G,d))}this.handleModes(ce,ne,Ae,N)}else{for(var Me=w,yt=k,_t=G,Et=!1;!Et&&w<C;)for(A.charCodeAt(w),e=this.chopInput(e,1),w++,i=0;i<te;i++){var Yt=le[i],pe=Yt.pattern,Pe=Yt.short;if(Pe!==!1?A.charCodeAt(w)===Pe&&(Et=!0):Yt.isCustom===!0?Et=pe.exec(A,w,_,U)!==null:(this.updateLastIndex(pe,w),Et=pe.exec(e)!==null),Et===!0)break}g=w-Me,S=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(A,Me,g,yt,_t),V.push({offset:Me,line:yt,column:_t,length:g,message:S})}}return this.hasCustom||(_.length=M),{tokens:_,groups:U,errors:V}},s.prototype.handleModes=function(e,t,r,n){if(e.pop===!0){var i=e.push;t(n),i!==void 0&&r.call(this,i)}else e.push!==void 0&&r.call(this,e.push)},s.prototype.chopInput=function(e,t){return e.substring(t)},s.prototype.updateLastIndex=function(e,t){e.lastIndex=t},s.prototype.updateTokenEndLineColumnLocation=function(e,t,r,n,i,a,o){var u,l;t!==void 0&&(u=r===o-1,l=u?-1:0,n===1&&u===!0||(e.endLine=i+l,e.endColumn=a-1+-l))},s.prototype.computeNewColumn=function(e,t){return e+t},s.prototype.createTokenInstance=function(){return null},s.prototype.createOffsetOnlyToken=function(e,t,r,n){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:n}},s.prototype.createStartOnlyToken=function(e,t,r,n,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:r,tokenType:n}},s.prototype.createFullToken=function(e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:n}},s.prototype.addToken=function(e,t,r){return 666},s.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},s.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,t++,t},s.prototype.handlePayload=function(e,t){},s.prototype.handlePayloadNoCustom=function(e,t){},s.prototype.handlePayloadWithCustom=function(e,t){t!==null&&(e.payload=t)},s.prototype.match=function(e,t,r){return null},s.prototype.matchWithTest=function(e,t,r){var n=e.test(t);return n===!0?t.substring(r,e.lastIndex):null},s.prototype.matchWithExec=function(e,t){var r=e.exec(t);return r!==null?r[0]:r},s.prototype.TRACE_INIT=function(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--> <"+e+">");var n=ah(t),i=n.time,a=n.value,o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(r+"<-- <"+e+"> time: "+i+"ms"),this.traceInitIndent--,a}else return t()},s.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",s.NA=/NOT_APPLICABLE/,s}();function jn(s){return gh(s)?s.LABEL:s.name}function gh(s){return wr(s.LABEL)&&s.LABEL!==""}var LE="parent",el="categories",tl="label",rl="group",nl="push_mode",sl="pop_mode",il="longer_alt",al="line_breaks",ol="start_chars_hint";function se(s){return FE(s)}function FE(s){var e=s.pattern,t={};if(t.name=s.name,er(e)||(t.PATTERN=e),H(s,LE))throw`The parent property is no longer supported.
See: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.`;return H(s,el)&&(t.CATEGORIES=s[el]),ti([t]),H(s,tl)&&(t.LABEL=s[tl]),H(s,rl)&&(t.GROUP=s[rl]),H(s,sl)&&(t.POP_MODE=s[sl]),H(s,nl)&&(t.PUSH_MODE=s[nl]),H(s,il)&&(t.LONGER_ALT=s[il]),H(s,al)&&(t.LINE_BREAKS=s[al]),H(s,ol)&&(t.START_CHARS_HINT=s[ol]),t}var Cn=se({name:"EOF",pattern:wt.NA});ti([Cn]);function eu(s,e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:r,startLine:n,endLine:i,startColumn:a,endColumn:o,tokenTypeIdx:s.tokenTypeIdx,tokenType:s}}function ge(s,e){return Ca(s,e)}var Wr=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),br=function(){function s(e){this.definition=e}return s.prototype.accept=function(e){e.visit(this),W(this.definition,function(t){t.accept(e)})},s}(),Gt=function(s){Wr(e,s);function e(t){var r=s.call(this,[])||this;return r.idx=1,fr(r,nr(t,function(n){return n!==void 0})),r}return Object.defineProperty(e.prototype,"definition",{get:function(){return this.referencedRule!==void 0?this.referencedRule.definition:[]},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.accept=function(t){t.visit(this)},e}(br),ss=function(s){Wr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.orgText="",fr(r,nr(t,function(n){return n!==void 0})),r}return e}(br),bt=function(s){Wr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.ignoreAmbiguities=!1,fr(r,nr(t,function(n){return n!==void 0})),r}return e}(br),ht=function(s){Wr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,fr(r,nr(t,function(n){return n!==void 0})),r}return e}(br),tr=function(s){Wr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,fr(r,nr(t,function(n){return n!==void 0})),r}return e}(br),rr=function(s){Wr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,fr(r,nr(t,function(n){return n!==void 0})),r}return e}(br),Ge=function(s){Wr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,fr(r,nr(t,function(n){return n!==void 0})),r}return e}(br),Ht=function(s){Wr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,fr(r,nr(t,function(n){return n!==void 0})),r}return e}(br),Wt=function(s){Wr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,r.ignoreAmbiguities=!1,r.hasPredicates=!1,fr(r,nr(t,function(n){return n!==void 0})),r}return e}(br),be=function(){function s(e){this.idx=1,fr(this,nr(e,function(t){return t!==void 0}))}return s.prototype.accept=function(e){e.visit(this)},s}();function UE(s){return P(s,Oi)}function Oi(s){function e(n){return P(n,Oi)}if(s instanceof Gt)return{type:"NonTerminal",name:s.nonTerminalName,idx:s.idx};if(s instanceof bt)return{type:"Flat",definition:e(s.definition)};if(s instanceof ht)return{type:"Option",idx:s.idx,definition:e(s.definition)};if(s instanceof tr)return{type:"RepetitionMandatory",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof rr)return{type:"RepetitionMandatoryWithSeparator",name:s.name,idx:s.idx,separator:Oi(new be({terminalType:s.separator})),definition:e(s.definition)};if(s instanceof Ht)return{type:"RepetitionWithSeparator",name:s.name,idx:s.idx,separator:Oi(new be({terminalType:s.separator})),definition:e(s.definition)};if(s instanceof Ge)return{type:"Repetition",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof Wt)return{type:"Alternation",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof be){var t={type:"Terminal",name:s.terminalType.name,label:jn(s.terminalType),idx:s.idx},r=s.terminalType.PATTERN;return s.terminalType.PATTERN&&(t.pattern=Gr(r)?r.source:r),t}else{if(s instanceof ss)return{type:"Rule",name:s.name,orgText:s.orgText,definition:e(s.definition)};throw Error("non exhaustive match")}}var Ia=function(){function s(){}return s.prototype.walk=function(e,t){var r=this;t===void 0&&(t=[]),W(e.definition,function(n,i){var a=ct(e.definition,i+1);if(n instanceof Gt)r.walkProdRef(n,a,t);else if(n instanceof be)r.walkTerminal(n,a,t);else if(n instanceof bt)r.walkFlat(n,a,t);else if(n instanceof ht)r.walkOption(n,a,t);else if(n instanceof tr)r.walkAtLeastOne(n,a,t);else if(n instanceof rr)r.walkAtLeastOneSep(n,a,t);else if(n instanceof Ht)r.walkManySep(n,a,t);else if(n instanceof Ge)r.walkMany(n,a,t);else if(n instanceof Wt)r.walkOr(n,a,t);else throw Error("non exhaustive match")})},s.prototype.walkTerminal=function(e,t,r){},s.prototype.walkProdRef=function(e,t,r){},s.prototype.walkFlat=function(e,t,r){var n=t.concat(r);this.walk(e,n)},s.prototype.walkOption=function(e,t,r){var n=t.concat(r);this.walk(e,n)},s.prototype.walkAtLeastOne=function(e,t,r){var n=[new ht({definition:e.definition})].concat(t,r);this.walk(e,n)},s.prototype.walkAtLeastOneSep=function(e,t,r){var n=ul(e,t,r);this.walk(e,n)},s.prototype.walkMany=function(e,t,r){var n=[new ht({definition:e.definition})].concat(t,r);this.walk(e,n)},s.prototype.walkManySep=function(e,t,r){var n=ul(e,t,r);this.walk(e,n)},s.prototype.walkOr=function(e,t,r){var n=this,i=t.concat(r);W(e.definition,function(a){var o=new bt({definition:[a]});n.walk(o,i)})},s}();function ul(s,e,t){var r=[new ht({definition:[new be({terminalType:s.separator})].concat(s.definition)})],n=r.concat(e,t);return n}var Mn=function(){function s(){}return s.prototype.visit=function(e){var t=e;switch(t.constructor){case Gt:return this.visitNonTerminal(t);case bt:return this.visitFlat(t);case ht:return this.visitOption(t);case tr:return this.visitRepetitionMandatory(t);case rr:return this.visitRepetitionMandatoryWithSeparator(t);case Ht:return this.visitRepetitionWithSeparator(t);case Ge:return this.visitRepetition(t);case Wt:return this.visitAlternation(t);case be:return this.visitTerminal(t);case ss:return this.visitRule(t);default:throw Error("non exhaustive match")}},s.prototype.visitNonTerminal=function(e){},s.prototype.visitFlat=function(e){},s.prototype.visitOption=function(e){},s.prototype.visitRepetition=function(e){},s.prototype.visitRepetitionMandatory=function(e){},s.prototype.visitRepetitionMandatoryWithSeparator=function(e){},s.prototype.visitRepetitionWithSeparator=function(e){},s.prototype.visitAlternation=function(e){},s.prototype.visitTerminal=function(e){},s.prototype.visitRule=function(e){},s}(),PE=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function DE(s){return s instanceof bt||s instanceof ht||s instanceof Ge||s instanceof tr||s instanceof rr||s instanceof Ht||s instanceof be||s instanceof ss}function $i(s,e){e===void 0&&(e=[]);var t=s instanceof ht||s instanceof Ge||s instanceof Ht;return t?!0:s instanceof Wt?nh(s.definition,function(r){return $i(r,e)}):s instanceof Gt&&Xe(e,s)?!1:s instanceof br?(s instanceof Gt&&e.push(s),Zt(s.definition,function(r){return $i(r,e)})):!1}function VE(s){return s instanceof Wt}function ar(s){if(s instanceof Gt)return"SUBRULE";if(s instanceof ht)return"OPTION";if(s instanceof Wt)return"OR";if(s instanceof tr)return"AT_LEAST_ONE";if(s instanceof rr)return"AT_LEAST_ONE_SEP";if(s instanceof Ht)return"MANY_SEP";if(s instanceof Ge)return"MANY";if(s instanceof be)return"CONSUME";throw Error("non exhaustive match")}var BE=function(s){PE(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return e.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},e.prototype.visitTerminal=function(t){var r=t.terminalType.name+this.separator+"Terminal";H(this.dslMethods,r)||(this.dslMethods[r]=[]),this.dslMethods[r].push(t)},e.prototype.visitNonTerminal=function(t){var r=t.nonTerminalName+this.separator+"Terminal";H(this.dslMethods,r)||(this.dslMethods[r]=[]),this.dslMethods[r].push(t)},e.prototype.visitOption=function(t){this.dslMethods.option.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.dslMethods.repetitionWithSeparator.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.dslMethods.repetitionMandatory.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)},e.prototype.visitRepetition=function(t){this.dslMethods.repetition.push(t)},e.prototype.visitAlternation=function(t){this.dslMethods.alternation.push(t)},e}(Mn),ui=new BE;function kE(s){ui.reset(),s.accept(ui);var e=ui.dslMethods;return ui.reset(),e}function ri(s){if(s instanceof Gt)return ri(s.referencedRule);if(s instanceof be)return WE(s);if(DE(s))return GE(s);if(VE(s))return HE(s);throw Error("non exhaustive match")}function GE(s){for(var e=[],t=s.definition,r=0,n=t.length>r,i,a=!0;n&&a;)i=t[r],a=$i(i),e=e.concat(ri(i)),r=r+1,n=t.length>r;return qo(e)}function HE(s){var e=P(s.definition,function(t){return ri(t)});return qo(Mt(e))}function WE(s){return[s.terminalType]}var Eh="_~IN~_",zE=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),YE=function(s){zE(e,s);function e(t){var r=s.call(this)||this;return r.topProd=t,r.follows={},r}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},e.prototype.walkTerminal=function(t,r,n){},e.prototype.walkProdRef=function(t,r,n){var i=$E(t.referencedRule,t.idx)+this.topProd.name,a=r.concat(n),o=new bt({definition:a}),u=ri(o);this.follows[i]=u},e}(Ia);function jE(s){var e={};return W(s,function(t){var r=new YE(t).startWalking();fr(e,r)}),e}function $E(s,e){return s.name+e+Eh}var XE=4,ln=8,KE=8,$n=1<<ln,Xi=2<<ln,Is=3<<ln,ws=4<<ln,Ms=5<<ln,Hn=6<<ln;function Os(s,e,t){return t|e|s}var qE=32-KE;function Rh(s,e,t,r){var n=r+1<<qE;return Os(s,e,t)|n}var QE=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function ll(s,e){isNaN(s.startOffset)===!0?(s.startOffset=e.startOffset,s.endOffset=e.endOffset):s.endOffset<e.endOffset&&(s.endOffset=e.endOffset)}function cl(s,e){isNaN(s.startOffset)===!0?(s.startOffset=e.startOffset,s.startColumn=e.startColumn,s.startLine=e.startLine,s.endOffset=e.endOffset,s.endColumn=e.endColumn,s.endLine=e.endLine):s.endOffset<e.endOffset&&(s.endOffset=e.endOffset,s.endColumn=e.endColumn,s.endLine=e.endLine)}function ZE(s,e,t){s.children[t]===void 0?s.children[t]=[e]:s.children[t].push(e)}function hl(s,e,t){s.children[e]===void 0?s.children[e]=[t]:s.children[e].push(t)}var tu=function(s){QE(e,s);function e(t){var r=s.call(this)||this;return r.result=[],r.ruleIdx=t,r}return e.prototype.collectNamedDSLMethod=function(t,r,n){if(!er(t.name)){var i=void 0;if(t instanceof ht||t instanceof Ge||t instanceof tr||t instanceof Wt)i=new r({definition:t.definition,idx:t.idx});else if(t instanceof rr||t instanceof Ht)i=new r({definition:t.definition,idx:t.idx,separator:t.separator});else throw Error("non exhaustive match");var a=[i],o=Os(this.ruleIdx,n,t.idx);this.result.push({def:a,key:o,name:t.name,orgProd:t})}},e.prototype.visitOption=function(t){this.collectNamedDSLMethod(t,ht,Xi)},e.prototype.visitRepetition=function(t){this.collectNamedDSLMethod(t,Ge,Is)},e.prototype.visitRepetitionMandatory=function(t){this.collectNamedDSLMethod(t,tr,ws)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.collectNamedDSLMethod(t,rr,Hn)},e.prototype.visitRepetitionWithSeparator=function(t){this.collectNamedDSLMethod(t,Ht,Ms)},e.prototype.visitAlternation=function(t){var r=this;this.collectNamedDSLMethod(t,Wt,$n);var n=t.definition.length>1;W(t.definition,function(i,a){if(!er(i.name)){var o=i.definition;n?o=[new ht({definition:i.definition})]:o=i.definition;var u=Rh(r.ruleIdx,$n,t.idx,a);r.result.push({def:o,key:u,name:i.name,orgProd:i})}})},e}(Mn);function JE(s,e){var t={allRuleNames:[]};return W(s,function(r){var n=e[r.name];t.allRuleNames.push(r.name);var i=new tu(n);r.accept(i),W(i.result,function(a){a.def,a.key;var o=a.name;t.allRuleNames.push(r.name+o)})}),t}var On=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),eR=function(s){On(e,s);function e(t,r){var n=s.call(this)||this;return n.topProd=t,n.path=r,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}return e.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ot(this.path.ruleStack).reverse(),this.occurrenceStack=Ot(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},e.prototype.walk=function(t,r){r===void 0&&(r=[]),this.found||s.prototype.walk.call(this,t,r)},e.prototype.walkProdRef=function(t,r,n){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){var i=r.concat(n);this.updateExpectedNext(),this.walk(t.referencedRule,i)}},e.prototype.updateExpectedNext=function(){ye(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},e}(Ia),tR=function(s){On(e,s);function e(t,r){var n=s.call(this,t,r)||this;return n.path=r,n.nextTerminalName="",n.nextTerminalOccurrence=0,n.nextTerminalName=n.path.lastTok.name,n.nextTerminalOccurrence=n.path.lastTokOccurrence,n}return e.prototype.walkTerminal=function(t,r,n){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){var i=r.concat(n),a=new bt({definition:i});this.possibleTokTypes=ri(a),this.found=!0}},e}(eR),wa=function(s){On(e,s);function e(t,r){var n=s.call(this)||this;return n.topRule=t,n.occurrence=r,n.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},n}return e.prototype.startWalking=function(){return this.walk(this.topRule),this.result},e}(Ia),rR=function(s){On(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkMany=function(t,r,n){if(t.idx===this.occurrence){var i=Jt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof be&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkMany.call(this,t,r,n)},e}(wa),dl=function(s){On(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkManySep=function(t,r,n){if(t.idx===this.occurrence){var i=Jt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof be&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkManySep.call(this,t,r,n)},e}(wa),nR=function(s){On(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkAtLeastOne=function(t,r,n){if(t.idx===this.occurrence){var i=Jt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof be&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkAtLeastOne.call(this,t,r,n)},e}(wa),fl=function(s){On(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkAtLeastOneSep=function(t,r,n){if(t.idx===this.occurrence){var i=Jt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof be&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkAtLeastOneSep.call(this,t,r,n)},e}(wa);function fo(s,e,t){t===void 0&&(t=[]),t=Ot(t);var r=[],n=0;function i(l){return l.concat(ct(s,n+1))}function a(l){var h=fo(i(l),e,t);return r.concat(h)}for(;t.length<e&&n<s.length;){var o=s[n];if(o instanceof bt)return a(o.definition);if(o instanceof Gt)return a(o.definition);if(o instanceof ht)r=a(o.definition);else if(o instanceof tr){var u=o.definition.concat([new Ge({definition:o.definition})]);return a(u)}else if(o instanceof rr){var u=[new bt({definition:o.definition}),new Ge({definition:[new be({terminalType:o.separator})].concat(o.definition)})];return a(u)}else if(o instanceof Ht){var u=o.definition.concat([new Ge({definition:[new be({terminalType:o.separator})].concat(o.definition)})]);r=a(u)}else if(o instanceof Ge){var u=o.definition.concat([new Ge({definition:o.definition})]);r=a(u)}else{if(o instanceof Wt)return W(o.definition,function(l){r=a(l.definition)}),r;if(o instanceof be)t.push(o.terminalType);else throw Error("non exhaustive match")}n++}return r.push({partialPath:t,suffixDef:ct(s,n)}),r}function Nh(s,e,t,r){var n="EXIT_NONE_TERMINAL",i=[n],a="EXIT_ALTERNATIVE",o=!1,u=e.length,l=u-r-1,h=[],d=[];for(d.push({idx:-1,def:s,ruleStack:[],occurrenceStack:[]});!ye(d);){var f=d.pop();if(f===a){o&&rh(d).idx<=l&&d.pop();continue}var p=f.def,N=f.idx,g=f.ruleStack,S=f.occurrenceStack;if(!ye(p)){var v=p[0];if(v===n){var A={idx:N,def:ct(p),ruleStack:Bs(g),occurrenceStack:Bs(S)};d.push(A)}else if(v instanceof be)if(N<u-1){var C=N+1,w=e[C];if(t(w,v.terminalType)){var A={idx:C,def:ct(p),ruleStack:g,occurrenceStack:S};d.push(A)}}else if(N===u-1)h.push({nextTokenType:v.terminalType,nextTokenOccurrence:v.idx,ruleStack:g,occurrenceStack:S}),o=!0;else throw Error("non exhaustive match");else if(v instanceof Gt){var M=Ot(g);M.push(v.nonTerminalName);var L=Ot(S);L.push(v.idx);var A={idx:N,def:v.definition.concat(i,ct(p)),ruleStack:M,occurrenceStack:L};d.push(A)}else if(v instanceof ht){var _={idx:N,def:ct(p),ruleStack:g,occurrenceStack:S};d.push(_),d.push(a);var V={idx:N,def:v.definition.concat(ct(p)),ruleStack:g,occurrenceStack:S};d.push(V)}else if(v instanceof tr){var k=new Ge({definition:v.definition,idx:v.idx}),G=v.definition.concat([k],ct(p)),A={idx:N,def:G,ruleStack:g,occurrenceStack:S};d.push(A)}else if(v instanceof rr){var U=new be({terminalType:v.separator}),k=new Ge({definition:[U].concat(v.definition),idx:v.idx}),G=v.definition.concat([k],ct(p)),A={idx:N,def:G,ruleStack:g,occurrenceStack:S};d.push(A)}else if(v instanceof Ht){var _={idx:N,def:ct(p),ruleStack:g,occurrenceStack:S};d.push(_),d.push(a);var U=new be({terminalType:v.separator}),K=new Ge({definition:[U].concat(v.definition),idx:v.idx}),G=v.definition.concat([K],ct(p)),V={idx:N,def:G,ruleStack:g,occurrenceStack:S};d.push(V)}else if(v instanceof Ge){var _={idx:N,def:ct(p),ruleStack:g,occurrenceStack:S};d.push(_),d.push(a);var K=new Ge({definition:v.definition,idx:v.idx}),G=v.definition.concat([K],ct(p)),V={idx:N,def:G,ruleStack:g,occurrenceStack:S};d.push(V)}else if(v instanceof Wt)for(var z=v.definition.length-1;z>=0;z--){var te=v.definition[z],le={idx:N,def:te.definition.concat(ct(p)),ruleStack:g,occurrenceStack:S};d.push(le),d.push(a)}else if(v instanceof bt)d.push({idx:N,def:v.definition.concat(ct(p)),ruleStack:g,occurrenceStack:S});else if(v instanceof ss)d.push(sR(v,N,g,S));else throw Error("non exhaustive match")}}return h}function sR(s,e,t,r){var n=Ot(t);n.push(s.name);var i=Ot(r);return i.push(1),{idx:e,def:s.definition,ruleStack:n,occurrenceStack:i}}var yh=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Se;(function(s){s[s.OPTION=0]="OPTION",s[s.REPETITION=1]="REPETITION",s[s.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",s[s.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",s[s.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",s[s.ALTERNATION=5]="ALTERNATION"})(Se||(Se={}));function iR(s){if(s instanceof ht)return Se.OPTION;if(s instanceof Ge)return Se.REPETITION;if(s instanceof tr)return Se.REPETITION_MANDATORY;if(s instanceof rr)return Se.REPETITION_MANDATORY_WITH_SEPARATOR;if(s instanceof Ht)return Se.REPETITION_WITH_SEPARATOR;if(s instanceof Wt)return Se.ALTERNATION;throw Error("non exhaustive match")}function aR(s,e,t,r,n,i){var a=ru(s,e,t),o=Sh(a)?ji:Ca;return i(a,r,o,n)}function oR(s,e,t,r,n,i){var a=nu(s,e,n,t),o=Sh(a)?ji:Ca;return i(a[0],o,r)}function uR(s,e,t,r){var n=s.length,i=Zt(s,function(u){return Zt(u,function(l){return l.length===1})});if(e)return function(u){for(var l=P(u,function(C){return C.GATE}),h=0;h<n;h++){var d=s[h],f=d.length,p=l[h];if(!(p!==void 0&&p.call(this)===!1))e:for(var N=0;N<f;N++){for(var g=d[N],S=g.length,v=0;v<S;v++){var A=this.LA(v+1);if(t(A,g[v])===!1)continue e}return h}}};if(i&&!r){var a=P(s,function(u){return Mt(u)}),o=dt(a,function(u,l,h){return W(l,function(d){H(u,d.tokenTypeIdx)||(u[d.tokenTypeIdx]=h),W(d.categoryMatches,function(f){H(u,f)||(u[f]=h)})}),u},[]);return function(){var u=this.LA(1);return o[u.tokenTypeIdx]}}else return function(){for(var u=0;u<n;u++){var l=s[u],h=l.length;e:for(var d=0;d<h;d++){for(var f=l[d],p=f.length,N=0;N<p;N++){var g=this.LA(N+1);if(t(g,f[N])===!1)continue e}return u}}}}function lR(s,e,t){var r=Zt(s,function(l){return l.length===1}),n=s.length;if(r&&!t){var i=Mt(s);if(i.length===1&&ye(i[0].categoryMatches)){var a=i[0],o=a.tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===o}}else{var u=dt(i,function(l,h,d){return l[h.tokenTypeIdx]=!0,W(h.categoryMatches,function(f){l[f]=!0}),l},[]);return function(){var l=this.LA(1);return u[l.tokenTypeIdx]===!0}}}else return function(){e:for(var l=0;l<n;l++){for(var h=s[l],d=h.length,f=0;f<d;f++){var p=this.LA(f+1);if(e(p,h[f])===!1)continue e}return!0}return!1}}var cR=function(s){yh(e,s);function e(t,r,n){var i=s.call(this)||this;return i.topProd=t,i.targetOccurrence=r,i.targetProdType=n,i}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},e.prototype.checkIsTarget=function(t,r,n,i){return t.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1},e.prototype.walkOption=function(t,r,n){this.checkIsTarget(t,Se.OPTION,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkAtLeastOne=function(t,r,n){this.checkIsTarget(t,Se.REPETITION_MANDATORY,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkAtLeastOneSep=function(t,r,n){this.checkIsTarget(t,Se.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkMany=function(t,r,n){this.checkIsTarget(t,Se.REPETITION,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkManySep=function(t,r,n){this.checkIsTarget(t,Se.REPETITION_WITH_SEPARATOR,r,n)||s.prototype.walkOption.call(this,t,r,n)},e}(Ia),Th=function(s){yh(e,s);function e(t,r,n){var i=s.call(this)||this;return i.targetOccurrence=t,i.targetProdType=r,i.targetRef=n,i.result=[],i}return e.prototype.checkIsTarget=function(t,r){t.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)},e.prototype.visitOption=function(t){this.checkIsTarget(t,Se.OPTION)},e.prototype.visitRepetition=function(t){this.checkIsTarget(t,Se.REPETITION)},e.prototype.visitRepetitionMandatory=function(t){this.checkIsTarget(t,Se.REPETITION_MANDATORY)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.checkIsTarget(t,Se.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.visitRepetitionWithSeparator=function(t){this.checkIsTarget(t,Se.REPETITION_WITH_SEPARATOR)},e.prototype.visitAlternation=function(t){this.checkIsTarget(t,Se.ALTERNATION)},e}(Mn);function pl(s){for(var e=new Array(s),t=0;t<s;t++)e[t]=[];return e}function za(s){for(var e=[""],t=0;t<s.length;t++){for(var r=s[t],n=[],i=0;i<e.length;i++){var a=e[i];n.push(a+"_"+r.tokenTypeIdx);for(var o=0;o<r.categoryMatches.length;o++){var u="_"+r.categoryMatches[o];n.push(a+u)}}e=n}return e}function hR(s,e,t){for(var r=0;r<s.length;r++)if(r!==t)for(var n=s[r],i=0;i<e.length;i++){var a=e[i];if(n[a]===!0)return!1}return!0}function vh(s,e){for(var t=P(s,function(h){return fo([h],1)}),r=pl(t.length),n=P(t,function(h){var d={};return W(h,function(f){var p=za(f.partialPath);W(p,function(N){d[N]=!0})}),d}),i=t,a=1;a<=e;a++){var o=i;i=pl(o.length);for(var u=function(h){for(var d=o[h],f=0;f<d.length;f++){var p=d[f].partialPath,N=d[f].suffixDef,g=za(p),S=hR(n,g,h);if(S||ye(N)||p.length===e){var v=r[h];if(po(v,p)===!1){v.push(p);for(var A=0;A<g.length;A++){var C=g[A];n[h][C]=!0}}}else{var w=fo(N,a+1,p);i[h]=i[h].concat(w),W(w,function(M){var L=za(M.partialPath);W(L,function(_){n[h][_]=!0})})}}},l=0;l<o.length;l++)u(l)}return r}function ru(s,e,t,r){var n=new Th(s,Se.ALTERNATION,r);return e.accept(n),vh(n.result,t)}function nu(s,e,t,r){var n=new Th(s,t);e.accept(n);var i=n.result,a=new cR(e,s,t),o=a.startWalking(),u=new bt({definition:i}),l=new bt({definition:o});return vh([u,l],r)}function po(s,e){e:for(var t=0;t<s.length;t++){var r=s[t];if(r.length===e.length){for(var n=0;n<r.length;n++){var i=e[n],a=r[n],o=i===a||a.categoryMatchesMap[i.tokenTypeIdx]!==void 0;if(o===!1)continue e}return!0}}return!1}function dR(s,e){return s.length<e.length&&Zt(s,function(t,r){var n=e[r];return t===n||n.categoryMatchesMap[t.tokenTypeIdx]})}function Sh(s){return Zt(s,function(e){return Zt(e,function(t){return Zt(t,function(r){return ye(r.categoryMatches)})})})}var su=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function fR(s,e,t,r,n,i){var a=P(s,function(A){return mR(A,n)}),o=P(s,function(A){return Ih(A,A,n)}),u=[],l=[],h=[];Zt(o,ye)&&(u=P(s,function(A){return SR(A,n)}),l=P(s,function(A){return AR(A,e,r,n)}),h=wR(s,e,n));var d=bR(s,t,n),f=P(t,function(A){return yR(A,n)}),p=pR(s,n),N=xR(s,n),g=P(s,function(A){return IR(A,n)}),S=P(s,function(A){return RR(A,n)}),v=P(s,function(A){return TR(A,s,i,n)});return Mt(a.concat(f,p,N,h,o,u,l,d,g,S,v))}function pR(s,e){var t=[];return W(s,function(r){var n=new tu("");r.accept(n);var i=P(n.result,function(a){return a.orgProd});t.push(P(i,function(a){return NR(r,a,e)}))}),Mt(t)}function mR(s,e){var t=new ER;s.accept(t);var r=t.allProductions,n=sh(r,gR),i=nr(n,function(o){return o.length>1}),a=P(gt(i),function(o){var u=Jt(o),l=e.buildDuplicateFoundError(s,o),h=ar(u),d={message:l,type:tt.DUPLICATE_PRODUCTIONS,ruleName:s.name,dslName:h,occurrence:u.idx},f=Ah(u);return f&&(d.parameter=f),d});return a}function gR(s){return ar(s)+"_#_"+s.idx+"_#_"+Ah(s)}function Ah(s){return s instanceof be?s.terminalType.name:s instanceof Gt?s.nonTerminalName:""}var ER=function(s){su(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.allProductions=[],t}return e.prototype.visitNonTerminal=function(t){this.allProductions.push(t)},e.prototype.visitOption=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e.prototype.visitAlternation=function(t){this.allProductions.push(t)},e.prototype.visitTerminal=function(t){this.allProductions.push(t)},e}(Mn),In=/^[a-zA-Z_]\w*$/,Ch=new RegExp(In.source.replace("^","^\\$"));function RR(s,e){var t=[],r=s.name;return r.match(In)||t.push({message:e.buildInvalidRuleNameError({topLevelRule:s,expectedPattern:In}),type:tt.INVALID_RULE_NAME,ruleName:r}),t}function NR(s,e,t){var r=[],n;return e.name.match(Ch)||(n=t.buildInvalidNestedRuleNameError(s,e),r.push({message:n,type:tt.INVALID_NESTED_RULE_NAME,ruleName:s.name})),r}function yR(s,e){var t=[],r=s.name;return r.match(In)||t.push({message:e.buildTokenNameError({tokenType:s,expectedPattern:In}),type:tt.INVALID_TOKEN_NAME}),t}function TR(s,e,t,r){var n=[],i=dt(e,function(o,u){return u.name===s.name?o+1:o},0);if(i>1){var a=r.buildDuplicateRuleNameError({topLevelRule:s,grammarName:t});n.push({message:a,type:tt.DUPLICATE_RULE_NAME,ruleName:s.name})}return n}function vR(s,e,t){var r=[],n;return Xe(e,s)||(n="Invalid rule override, rule: ->"+s+"<- cannot be overridden in the grammar: ->"+t+"<-as it is not defined in any of the super grammars ",r.push({message:n,type:tt.INVALID_RULE_OVERRIDE,ruleName:s})),r}function Ih(s,e,t,r){r===void 0&&(r=[]);var n=[],i=bi(e.definition);if(ye(i))return[];var a=s.name,o=Xe(i,s);o&&n.push({message:t.buildLeftRecursionError({topLevelRule:s,leftRecursionPath:r}),type:tt.LEFT_RECURSION,ruleName:a});var u=va(i,r.concat([s])),l=P(u,function(h){var d=Ot(r);return d.push(h),Ih(s,h,t,d)});return n.concat(Mt(l))}function bi(s){var e=[];if(ye(s))return e;var t=Jt(s);if(t instanceof Gt)e.push(t.referencedRule);else if(t instanceof bt||t instanceof ht||t instanceof tr||t instanceof rr||t instanceof Ht||t instanceof Ge)e=e.concat(bi(t.definition));else if(t instanceof Wt)e=Mt(P(t.definition,function(a){return bi(a.definition)}));else if(!(t instanceof be))throw Error("non exhaustive match");var r=$i(t),n=s.length>1;if(r&&n){var i=ct(s);return e.concat(bi(i))}else return e}var iu=function(s){su(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.alternations=[],t}return e.prototype.visitAlternation=function(t){this.alternations.push(t)},e}(Mn);function SR(s,e){var t=new iu;s.accept(t);var r=t.alternations,n=dt(r,function(i,a){var o=Bs(a.definition),u=P(o,function(l,h){var d=Nh([l],[],null,1);return ye(d)?{message:e.buildEmptyAlternationError({topLevelRule:s,alternation:a,emptyChoiceIdx:h}),type:tt.NONE_LAST_EMPTY_ALT,ruleName:s.name,occurrence:a.idx,alternative:h+1}:null});return i.concat(Js(u))},[]);return n}function AR(s,e,t,r){var n=new iu;s.accept(n);var i=n.alternations,a=t[s.name];a&&(i=An(i,function(u){return a[ar(u)+(u.idx===0?"":u.idx)]})),i=An(i,function(u){return u.ignoreAmbiguities===!0});var o=dt(i,function(u,l){var h=l.idx,d=l.maxLookahead||e,f=ru(h,s,d,l),p=MR(f,l,s,r),N=OR(f,l,s,r);return u.concat(p,N)},[]);return o}var CR=function(s){su(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.allProductions=[],t}return e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e}(Mn);function IR(s,e){var t=new iu;s.accept(t);var r=t.alternations,n=dt(r,function(i,a){return a.definition.length>255&&i.push({message:e.buildTooManyAlternativesError({topLevelRule:s,alternation:a}),type:tt.TOO_MANY_ALTS,ruleName:s.name,occurrence:a.idx}),i},[]);return n}function wR(s,e,t){var r=[];return W(s,function(n){var i=new CR;n.accept(i);var a=i.allProductions;W(a,function(o){var u=iR(o),l=o.maxLookahead||e,h=o.idx,d=nu(h,n,u,l),f=d[0];if(ye(Mt(f))){var p=t.buildEmptyRepetitionError({topLevelRule:n,repetition:o});r.push({message:p,type:tt.NO_NON_EMPTY_LOOKAHEAD,ruleName:n.name})}})}),r}function MR(s,e,t,r){var n=[],i=dt(s,function(o,u,l){return e.definition[l].ignoreAmbiguities===!0||W(u,function(h){var d=[l];W(s,function(f,p){l!==p&&po(f,h)&&e.definition[p].ignoreAmbiguities!==!0&&d.push(p)}),d.length>1&&!po(n,h)&&(n.push(h),o.push({alts:d,path:h}))}),o},[]),a=P(i,function(o){var u=P(o.alts,function(h){return h+1}),l=r.buildAlternationAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:u,prefixPath:o.path});return{message:l,type:tt.AMBIGUOUS_ALTS,ruleName:t.name,occurrence:e.idx,alternatives:[o.alts]}});return a}function OR(s,e,t,r){var n=[],i=dt(s,function(a,o,u){var l=P(o,function(h){return{idx:u,path:h}});return a.concat(l)},[]);return W(i,function(a){var o=e.definition[a.idx];if(o.ignoreAmbiguities!==!0){var u=a.idx,l=a.path,h=Hg(i,function(f){return e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<u&&dR(f.path,l)}),d=P(h,function(f){var p=[f.idx+1,u+1],N=e.idx===0?"":e.idx,g=r.buildAlternationPrefixAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:p,prefixPath:f.path});return{message:g,type:tt.AMBIGUOUS_PREFIX_ALTS,ruleName:t.name,occurrence:N,alternatives:p}});n=n.concat(d)}}),n}function bR(s,e,t){var r=[],n=P(e,function(i){return i.name});return W(s,function(i){var a=i.name;if(Xe(n,a)){var o=t.buildNamespaceConflictError(i);r.push({message:o,type:tt.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:a})}}),r}function xR(s,e){var t=[];return W(s,function(r){var n=new tu("");r.accept(n);var i=sh(n.result,function(o){return o.name}),a=nr(i,function(o){return o.length>1});W(gt(a),function(o){var u=P(o,function(h){return h.orgProd}),l=e.buildDuplicateNestedRuleNameError(r,u);t.push({message:l,type:tt.DUPLICATE_NESTED_NAME,ruleName:r.name})})}),t}var wh={buildMismatchTokenMessage:function(s){var e=s.expected,t=s.actual;s.previous,s.ruleName;var r=gh(e),n=r?"--> "+jn(e)+" <--":"token of type --> "+e.name+" <--",i="Expecting "+n+" but found --> '"+t.image+"' <--";return i},buildNotAllInputParsedMessage:function(s){var e=s.firstRedundant;return s.ruleName,"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage:function(s){var e=s.expectedPathsPerAlt,t=s.actual;s.previous;var r=s.customUserDescription;s.ruleName;var n="Expecting: ",i=Jt(t).image,a=`
but found: '`+i+"'";if(r)return n+r+a;var o=dt(e,function(d,f){return d.concat(f)},[]),u=P(o,function(d){return"["+P(d,function(f){return jn(f)}).join(", ")+"]"}),l=P(u,function(d,f){return"  "+(f+1)+". "+d}),h=`one of these possible Token sequences:
`+l.join(`
`);return n+h+a},buildEarlyExitMessage:function(s){var e=s.expectedIterationPaths,t=s.actual,r=s.customUserDescription;s.ruleName;var n="Expecting: ",i=Jt(t).image,a=`
but found: '`+i+"'";if(r)return n+r+a;var o=P(e,function(l){return"["+P(l,function(h){return jn(h)}).join(",")+"]"}),u=`expecting at least one iteration which starts with one of these possible Token sequences::
  `+("<"+o.join(" ,")+">");return n+u+a}};Object.freeze(wh);var _R={buildRuleNotFoundError:function(s,e){var t="Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+s.name+"<-";return t}},au={buildDuplicateFoundError:function(s,e){function t(h){return h instanceof be?h.terminalType.name:h instanceof Gt?h.nonTerminalName:""}var r=s.name,n=Jt(e),i=n.idx,a=ar(n),o=t(n),u=i>0,l="->"+a+(u?i:"")+"<- "+(o?"with argument: ->"+o+"<-":"")+`
                  appears more than once (`+e.length+" times) in the top level rule: ->"+r+`<-.                  
                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildInvalidNestedRuleNameError:function(s,e){var t="Invalid nested rule name: ->"+e.name+"<- inside rule: ->"+s.name+`<-
`+("it must match the pattern: ->"+Ch.toString()+`<-.
`)+"Note that this means a nested rule name must start with the '$'(dollar) sign.";return t},buildDuplicateNestedRuleNameError:function(s,e){var t=Jt(e).name,r="Duplicate nested rule name: ->"+t+"<- inside rule: ->"+s.name+`<-
A nested name must be unique in the scope of a top level grammar rule.`;return r},buildNamespaceConflictError:function(s){var e=`Namespace conflict found in grammar.
`+("The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+s.name+`>.
`)+`To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`;return e},buildAlternationPrefixAmbiguityError:function(s){var e=P(s.prefixPath,function(n){return jn(n)}).join(", "),t=s.alternation.idx===0?"":s.alternation.idx,r="Ambiguous alternatives: <"+s.ambiguityIndices.join(" ,")+`> due to common lookahead prefix
`+("in <OR"+t+"> inside <"+s.topLevelRule.name+`> Rule,
`)+("<"+e+`> may appears as a prefix path in all these alternatives.
`)+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`;return r},buildAlternationAmbiguityError:function(s){var e=P(s.prefixPath,function(n){return jn(n)}).join(", "),t=s.alternation.idx===0?"":s.alternation.idx,r="Ambiguous Alternatives Detected: <"+s.ambiguityIndices.join(" ,")+"> in <OR"+t+">"+(" inside <"+s.topLevelRule.name+`> Rule,
`)+("<"+e+`> may appears as a prefix path in all these alternatives.
`);return r=r+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError:function(s){var e=ar(s.repetition);s.repetition.idx!==0&&(e+=s.repetition.idx);var t="The repetition <"+e+"> within Rule <"+s.topLevelRule.name+`> can never consume any tokens.
This could lead to an infinite loop.`;return t},buildTokenNameError:function(s){var e=s.tokenType.name,t="Invalid Grammar Token name: ->"+e+"<- it must match the pattern: ->"+s.expectedPattern.toString()+"<-";return t},buildEmptyAlternationError:function(s){var e="Ambiguous empty alternative: <"+(s.emptyChoiceIdx+1)+">"+(" in <OR"+s.alternation.idx+"> inside <"+s.topLevelRule.name+`> Rule.
`)+"Only the last alternative may be an empty alternative.";return e},buildTooManyAlternativesError:function(s){var e=`An Alternation cannot have more than 256 alternatives:
`+("<OR"+s.alternation.idx+"> inside <"+s.topLevelRule.name+`> Rule.
 has `+(s.alternation.definition.length+1)+" alternatives.");return e},buildLeftRecursionError:function(s){var e=s.topLevelRule.name,t=P(s.leftRecursionPath,function(i){return i.name}),r=e+" --> "+t.concat([e]).join(" --> "),n=`Left Recursion found in grammar.
`+("rule: <"+e+`> can be invoked from itself (directly or indirectly)
`)+(`without consuming any Tokens. The grammar path that causes this is: 
 `+r+`
`)+` To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring.`;return n},buildInvalidRuleNameError:function(s){var e=s.topLevelRule.name,t=s.expectedPattern.toString(),r="Invalid grammar rule name: ->"+e+"<- it must match the pattern: ->"+t+"<-";return r},buildDuplicateRuleNameError:function(s){var e;s.topLevelRule instanceof ss?e=s.topLevelRule.name:e=s.topLevelRule;var t="Duplicate definition, rule: ->"+e+"<- is already defined in the grammar: ->"+s.grammarName+"<-";return t}},LR=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function FR(s,e){var t=new UR(s,e);return t.resolveRefs(),t.errors}var UR=function(s){LR(e,s);function e(t,r){var n=s.call(this)||this;return n.nameToTopRule=t,n.errMsgProvider=r,n.errors=[],n}return e.prototype.resolveRefs=function(){var t=this;W(gt(this.nameToTopRule),function(r){t.currTopLevel=r,r.accept(t)})},e.prototype.visitNonTerminal=function(t){var r=this.nameToTopRule[t.nonTerminalName];if(r)t.referencedRule=r;else{var n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:n,type:tt.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}},e}(Mn);function PR(s){s=Sa(s,{errMsgProvider:_R});var e={};return W(s.rules,function(t){e[t.name]=t}),FR(e,s.errMsgProvider)}function DR(s){return s=Sa(s,{errMsgProvider:au,ignoredIssues:{}}),fR(s.rules,s.maxLookahead,s.tokenTypes,s.ignoredIssues,s.errMsgProvider,s.grammarName)}var Mh="MismatchedTokenException",Oh="NoViableAltException",bh="EarlyExitException",xh="NotAllInputParsedException",_h=[Mh,Oh,bh,xh];Object.freeze(_h);function Ki(s){return Xe(_h,s.name)}function ou(s,e,t){this.name=Mh,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}ou.prototype=Error.prototype;function Lh(s,e,t){this.name=Oh,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}Lh.prototype=Error.prototype;function Fh(s,e){this.name=xh,this.message=s,this.token=e,this.resyncedTokens=[]}Fh.prototype=Error.prototype;function Uh(s,e,t){this.name=bh,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}Uh.prototype=Error.prototype;var Ya={},Ph="InRuleRecoveryException";function Dh(s){this.name=Ph,this.message=s}Dh.prototype=Error.prototype;var VR=function(){function s(){}return s.prototype.initRecoverable=function(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=H(e,"recoveryEnabled")?e.recoveryEnabled:At.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=BR)},s.prototype.getTokenToInsert=function(e){var t=eu(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},s.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},s.prototype.tryInRepetitionRecovery=function(e,t,r,n){for(var i=this,a=this.findReSyncTokenType(),o=this.exportLexerState(),u=[],l=!1,h=this.LA(1),d=this.LA(1),f=function(){var p=i.LA(0),N=i.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:h,previous:p,ruleName:i.getCurrRuleFullName()}),g=new ou(N,h,i.LA(0));g.resyncedTokens=Bs(u),i.SAVE_ERROR(g)};!l;)if(this.tokenMatcher(d,n)){f();return}else if(r.call(this)){f(),e.apply(this,t);return}else this.tokenMatcher(d,a)?l=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,u));this.importLexerState(o)},s.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,r){return!(r===!1||e===void 0||t===void 0||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))},s.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t),n=this.getNextPossibleTokenTypes(r);return n},s.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t)){var r=this.getTokenToInsert(e);return r}if(this.canRecoverWithSingleTokenDeletion(e)){var n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new Dh("sad sad panda")},s.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},s.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e)||ye(t))return!1;var n=this.LA(1),i=Jn(t,function(a){return r.tokenMatcher(n,a)})!==void 0;return i},s.prototype.canRecoverWithSingleTokenDeletion=function(e){var t=this.tokenMatcher(this.LA(2),e);return t},s.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return Xe(r,e)},s.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var n=t.tokenType;if(Xe(e,n))return n;t=this.LA(r),r++}},s.prototype.getCurrFollowKey=function(){if(this.RULE_STACK.length===1)return Ya;var e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(r)}},s.prototype.buildFullFollowKeyStack=function(){var e=this,t=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return ye(this.LAST_EXPLICIT_RULE_STACK)||(t=P(this.LAST_EXPLICIT_RULE_STACK,function(n){return e.RULE_STACK[n]}),r=P(this.LAST_EXPLICIT_RULE_STACK,function(n){return e.RULE_OCCURRENCE_STACK[n]})),P(t,function(n,i){return i===0?Ya:{ruleName:e.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:e.shortRuleNameToFullName(t[i-1])}})},s.prototype.flattenFollowSet=function(){var e=this,t=P(this.buildFullFollowKeyStack(),function(r){return e.getFollowSetFromFollowKey(r)});return Mt(t)},s.prototype.getFollowSetFromFollowKey=function(e){if(e===Ya)return[Cn];var t=e.ruleName+e.idxInCallingRule+Eh+e.inRule;return this.resyncFollows[t]},s.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,Cn)||t.push(e),t},s.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return Bs(t)},s.prototype.attemptInRepetitionRecovery=function(e,t,r,n,i,a,o){},s.prototype.getCurrentGrammarPath=function(e,t){var r=this.getHumanReadableRuleStack(),n=Ot(this.RULE_OCCURRENCE_STACK),i={ruleStack:r,occurrenceStack:n,lastTok:e,lastTokOccurrence:t};return i},s.prototype.getHumanReadableRuleStack=function(){var e=this;return ye(this.LAST_EXPLICIT_RULE_STACK)?P(this.RULE_STACK,function(t){return e.shortRuleNameToFullName(t)}):P(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])})},s}();function BR(s,e,t,r,n,i,a){var o=this.getKeyForAutomaticLookahead(r,n),u=this.firstAfterRepMap[o];if(u===void 0){var l=this.getCurrRuleFullName(),h=this.getGAstProductions()[l],d=new i(h,n);u=d.startWalking(),this.firstAfterRepMap[o]=u}var f=u.token,p=u.occurrence,N=u.isEndOfRule;this.RULE_STACK.length===1&&N&&f===void 0&&(f=Cn,p=1),this.shouldInRepetitionRecoveryBeTried(f,p,a)&&this.tryInRepetitionRecovery(s,e,t,f)}var kR=function(){function s(){}return s.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=H(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:At.dynamicTokensEnabled,this.maxLookahead=H(e,"maxLookahead")?e.maxLookahead:At.maxLookahead,this.lookAheadFuncsCache=$u()?new Map:[],$u()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},s.prototype.preComputeLookaheadFunctions=function(e){var t=this;W(e,function(r){t.TRACE_INIT(r.name+" Rule Lookahead",function(){var n=kE(r),i=n.alternation,a=n.repetition,o=n.option,u=n.repetitionMandatory,l=n.repetitionMandatoryWithSeparator,h=n.repetitionWithSeparator;W(i,function(d){var f=d.idx===0?"":d.idx;t.TRACE_INIT(""+ar(d)+f,function(){var p=aR(d.idx,r,d.maxLookahead||t.maxLookahead,d.hasPredicates,t.dynamicTokensEnabled,t.lookAheadBuilderForAlternatives),N=Os(t.fullRuleNameToShort[r.name],$n,d.idx);t.setLaFuncCache(N,p)})}),W(a,function(d){t.computeLookaheadFunc(r,d.idx,Is,Se.REPETITION,d.maxLookahead,ar(d))}),W(o,function(d){t.computeLookaheadFunc(r,d.idx,Xi,Se.OPTION,d.maxLookahead,ar(d))}),W(u,function(d){t.computeLookaheadFunc(r,d.idx,ws,Se.REPETITION_MANDATORY,d.maxLookahead,ar(d))}),W(l,function(d){t.computeLookaheadFunc(r,d.idx,Hn,Se.REPETITION_MANDATORY_WITH_SEPARATOR,d.maxLookahead,ar(d))}),W(h,function(d){t.computeLookaheadFunc(r,d.idx,Ms,Se.REPETITION_WITH_SEPARATOR,d.maxLookahead,ar(d))})})})},s.prototype.computeLookaheadFunc=function(e,t,r,n,i,a){var o=this;this.TRACE_INIT(""+a+(t===0?"":t),function(){var u=oR(t,e,i||o.maxLookahead,o.dynamicTokensEnabled,n,o.lookAheadBuilderForOptional),l=Os(o.fullRuleNameToShort[e.name],r,t);o.setLaFuncCache(l,u)})},s.prototype.lookAheadBuilderForOptional=function(e,t,r){return lR(e,t,r)},s.prototype.lookAheadBuilderForAlternatives=function(e,t,r,n){return uR(e,t,r,n)},s.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return Os(r,e,t)},s.prototype.getLaFuncFromCache=function(e){},s.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},s.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},s.prototype.setLaFuncCache=function(e,t){},s.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},s.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},s}();function GR(s){return Ma(s.constructor)}var HR=/^\s*function\s*(\S*)\s*\(/,ml="name";function Ma(s){var e=s.name;if(e)return e;var t=s.toString().match(HR)[1];return t}function Vh(s,e){var t=Object.getOwnPropertyDescriptor(s,ml);return er(t)||t.configurable?(Object.defineProperty(s,ml,{enumerable:!1,configurable:!0,writable:!1,value:e}),!0):!1}function WR(s,e){for(var t=Hr(s),r=t.length,n=0;n<r;n++)for(var i=t[n],a=s[i],o=a.length,u=0;u<o;u++){var l=a[u];l.tokenTypeIdx===void 0&&(l.fullName!==void 0?this[l.fullName](l.children,e):this[l.name](l.children,e))}}function zR(s,e){var t=function(){};Vh(t,s+"BaseSemantics");var r={visit:function(n,i){if(lr(n)&&(n=n[0]),!er(n))return n.fullName!==void 0?this[n.fullName](n.children,i):this[n.name](n.children,i)},validateVisitor:function(){var n=jR(this,e);if(!ye(n)){var i=P(n,function(a){return a.msg});throw Error("Errors Detected in CST Visitor <"+Ma(this.constructor)+`>:
	`+(""+i.join(`

`).replace(/\n/g,`
	`)))}}};return t.prototype=r,t.prototype.constructor=t,t._RULE_NAMES=e,t}function YR(s,e,t){var r=function(){};Vh(r,s+"BaseSemanticsWithDefaults");var n=Object.create(t.prototype);return W(e,function(i){n[i]=WR}),r.prototype=n,r.prototype.constructor=r,r}var qi;(function(s){s[s.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",s[s.MISSING_METHOD=1]="MISSING_METHOD"})(qi||(qi={}));function jR(s,e){var t=$R(s,e),r=KR(s,e);return t.concat(r)}function $R(s,e){var t=P(e,function(r){if(!un(s[r]))return{msg:"Missing visitor method: <"+r+"> on "+Ma(s.constructor)+" CST Visitor.",type:qi.MISSING_METHOD,methodName:r}});return Js(t)}var XR=["constructor","visit","validateVisitor"];function KR(s,e){var t=[];for(var r in s)In.test(r)&&un(s[r])&&!Xe(XR,r)&&!Xe(e,r)&&t.push({msg:"Redundant visitor method: <"+r+"> on "+Ma(s.constructor)+` CST Visitor
There is no Grammar Rule corresponding to this method's name.
`+("For utility methods on visitor classes use methods names that do not match /"+In.source+"/."),type:qi.REDUNDANT_METHOD,methodName:r});return t}var qR=function(){function s(){}return s.prototype.initTreeBuilder=function(e){if(this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=H(e,"outputCst")?e.outputCst:At.outputCst,this.nodeLocationTracking=H(e,"nodeLocationTracking")?e.nodeLocationTracking:At.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=qe,this.cstFinallyStateUpdate=qe,this.cstPostTerminal=qe,this.cstPostNonTerminal=qe,this.cstPostRule=qe,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=cl,this.setNodeLocationFromNode=cl,this.cstPostRule=qe,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=ll,this.setNodeLocationFromNode=ll,this.cstPostRule=qe,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=qe,this.setNodeLocationFromNode=qe,this.cstPostRule=qe,this.setInitialNodeLocation=qe;else throw Error('Invalid <nodeLocationTracking> config option: "'+e.nodeLocationTracking+'"')},s.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},s.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},s.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},s.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},s.prototype.cstNestedInvocationStateUpdate=function(e,t){var r={name:e,fullName:this.shortRuleNameToFull[this.getLastExplicitRuleShortName()]+e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},s.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1);var r={name:e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},s.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},s.prototype.cstNestedFinallyStateUpdate=function(){var e=this.CST_STACK.pop();this.cstPostRule(e)},s.prototype.cstPostRuleFull=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?(r.endOffset=t.endOffset,r.endLine=t.endLine,r.endColumn=t.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)},s.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?r.endOffset=t.endOffset:r.startOffset=NaN},s.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];ZE(r,t,e),this.setNodeLocationFromToken(r.location,t)},s.prototype.cstPostNonTerminal=function(e,t){if(this.isBackTracking()!==!0){var r=this.CST_STACK[this.CST_STACK.length-1];hl(r,t,e),this.setNodeLocationFromNode(r.location,e.location)}},s.prototype.getBaseCstVisitorConstructor=function(){if(er(this.baseCstVisitorConstructor)){var e=zR(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},s.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(er(this.baseCstVisitorWithDefaultsConstructor)){var e=YR(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},s.prototype.nestedRuleBeforeClause=function(e,t){var r;if(e.NAME!==void 0)return r=e.NAME,this.nestedRuleInvocationStateUpdate(r,t),r},s.prototype.nestedAltBeforeClause=function(e,t,r,n){var i=this.getLastExplicitRuleShortName(),a=Rh(i,r,t,n),o;if(e.NAME!==void 0)return o=e.NAME,this.nestedRuleInvocationStateUpdate(o,a),{shortName:a,nestedName:o}},s.prototype.nestedRuleFinallyClause=function(e,t){var r=this.CST_STACK,n=r[r.length-1];this.nestedRuleFinallyStateUpdate();var i=r[r.length-1];hl(i,t,n),this.setNodeLocationFromNode(i.location,n.location)},s.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},s.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},s.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},s.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},s.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},s.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},s.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},s.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},s}(),QR=function(){function s(){}return s.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(s.prototype,"input",{get:function(){return this.tokVector},set:function(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),s.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Zi},s.prototype.LA=function(e){var t=this.currIdx+e;return t<0||this.tokVectorLength<=t?Zi:this.tokVector[t]},s.prototype.consumeToken=function(){this.currIdx++},s.prototype.exportLexerState=function(){return this.currIdx},s.prototype.importLexerState=function(e){this.currIdx=e},s.prototype.resetLexerState=function(){this.currIdx=-1},s.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},s.prototype.getLexerPosition=function(){return this.exportLexerState()},s}(),ZR=function(){function s(){}return s.prototype.ACTION=function(e){return e.call(this)},s.prototype.consume=function(e,t,r){return this.consumeInternal(t,e,r)},s.prototype.subrule=function(e,t,r){return this.subruleInternal(t,e,r)},s.prototype.option=function(e,t){return this.optionInternal(t,e)},s.prototype.or=function(e,t){return this.orInternal(t,e)},s.prototype.many=function(e,t){return this.manyInternal(e,t)},s.prototype.atLeastOne=function(e,t){return this.atLeastOneInternal(e,t)},s.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},s.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},s.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},s.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},s.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},s.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},s.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},s.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},s.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},s.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},s.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},s.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},s.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},s.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},s.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},s.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},s.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},s.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},s.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},s.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},s.prototype.OPTION=function(e){return this.optionInternal(e,0)},s.prototype.OPTION1=function(e){return this.optionInternal(e,1)},s.prototype.OPTION2=function(e){return this.optionInternal(e,2)},s.prototype.OPTION3=function(e){return this.optionInternal(e,3)},s.prototype.OPTION4=function(e){return this.optionInternal(e,4)},s.prototype.OPTION5=function(e){return this.optionInternal(e,5)},s.prototype.OPTION6=function(e){return this.optionInternal(e,6)},s.prototype.OPTION7=function(e){return this.optionInternal(e,7)},s.prototype.OPTION8=function(e){return this.optionInternal(e,8)},s.prototype.OPTION9=function(e){return this.optionInternal(e,9)},s.prototype.OR=function(e){return this.orInternal(e,0)},s.prototype.OR1=function(e){return this.orInternal(e,1)},s.prototype.OR2=function(e){return this.orInternal(e,2)},s.prototype.OR3=function(e){return this.orInternal(e,3)},s.prototype.OR4=function(e){return this.orInternal(e,4)},s.prototype.OR5=function(e){return this.orInternal(e,5)},s.prototype.OR6=function(e){return this.orInternal(e,6)},s.prototype.OR7=function(e){return this.orInternal(e,7)},s.prototype.OR8=function(e){return this.orInternal(e,8)},s.prototype.OR9=function(e){return this.orInternal(e,9)},s.prototype.MANY=function(e){this.manyInternal(0,e)},s.prototype.MANY1=function(e){this.manyInternal(1,e)},s.prototype.MANY2=function(e){this.manyInternal(2,e)},s.prototype.MANY3=function(e){this.manyInternal(3,e)},s.prototype.MANY4=function(e){this.manyInternal(4,e)},s.prototype.MANY5=function(e){this.manyInternal(5,e)},s.prototype.MANY6=function(e){this.manyInternal(6,e)},s.prototype.MANY7=function(e){this.manyInternal(7,e)},s.prototype.MANY8=function(e){this.manyInternal(8,e)},s.prototype.MANY9=function(e){this.manyInternal(9,e)},s.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},s.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},s.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},s.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},s.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},s.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},s.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},s.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},s.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},s.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},s.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},s.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},s.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},s.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},s.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},s.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},s.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},s.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},s.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},s.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},s.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},s.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},s.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},s.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},s.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},s.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},s.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},s.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},s.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},s.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},s.prototype.RULE=function(e,t,r){if(r===void 0&&(r=Ji),Xe(this.definedRulesNames,e)){var n=au.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),i={message:n,type:tt.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}this.definedRulesNames.push(e);var a=this.defineRule(e,t,r);return this[e]=a,a},s.prototype.OVERRIDE_RULE=function(e,t,r){r===void 0&&(r=Ji);var n=[];n=n.concat(vR(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,n);var i=this.defineRule(e,t,r);return this[e]=i,i},s.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(n){if(Ki(n))return!1;throw n}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},s.prototype.getGAstProductions=function(){return this.gastProductionsCache},s.prototype.getSerializedGastProductions=function(){return UE(gt(this.gastProductionsCache))},s}(),JR=function(){function s(){}return s.prototype.initRecognizerEngine=function(e,t){if(this.className=GR(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ji,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},H(t,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(lr(e)){if(ye(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(lr(e))this.tokensMap=dt(e,function(a,o){return a[o.name]=o,a},{});else if(H(e,"modes")&&Zt(Mt(gt(e.modes)),xE)){var r=Mt(gt(e.modes)),n=qo(r);this.tokensMap=dt(n,function(a,o){return a[o.name]=o,a},{})}else if(Qo(e))this.tokensMap=Zs(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Cn;var i=Zt(gt(e),function(a){return ye(a.categoryMatches)});this.tokenMatcher=i?ji:Ca,ti(gt(this.tokensMap))},s.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+`> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);var n=H(r,"resyncEnabled")?r.resyncEnabled:Ji.resyncEnabled,i=H(r,"recoveryValueFunc")?r.recoveryValueFunc:Ji.recoveryValueFunc,a=this.ruleShortNameIdx<<XE+ln;this.ruleShortNameIdx++,this.shortRuleNameToFull[a]=e,this.fullRuleNameToShort[e]=a;function o(h){try{if(this.outputCst===!0){t.apply(this,h);var d=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(d),d}else return t.apply(this,h)}catch(f){return this.invokeRuleCatch(f,n,i)}finally{this.ruleFinallyStateUpdate()}}var u;u=function(h,d){return h===void 0&&(h=0),this.ruleInvocationStateUpdate(a,e,h),o.call(this,d)};var l="ruleName";return u[l]=e,u.originalGrammarAction=t,u},s.prototype.invokeRuleCatch=function(e,t,r){var n=this.RULE_STACK.length===1,i=t&&!this.isBackTracking()&&this.recoveryEnabled;if(Ki(e)){var a=e;if(i){var o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))if(a.resyncedTokens=this.reSyncTo(o),this.outputCst){var u=this.CST_STACK[this.CST_STACK.length-1];return u.recoveredNode=!0,u}else return r();else{if(this.outputCst){var u=this.CST_STACK[this.CST_STACK.length-1];u.recoveredNode=!0,a.partialCstResult=u}throw a}}else{if(n)return this.moveToTerminatedState(),r();throw a}}else throw e},s.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Xi,t),n=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Xi,t);return this.optionInternalLogic(e,t,r)},s.prototype.optionInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(e.DEF!==void 0){if(a=e.DEF,o=e.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=e;if(i.call(this)===!0)return a.call(this)},s.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(ws,e),n=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(ws,e);this.atLeastOneInternalLogic(e,t,r)},s.prototype.atLeastOneInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(t.DEF!==void 0){if(a=t.DEF,o=t.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=t;if(i.call(this)===!0)for(var l=this.doSingleRepetition(a);i.call(this)===!0&&l===!0;)l=this.doSingleRepetition(a);else throw this.raiseEarlyExitException(e,Se.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],i,ws,e,nR)},s.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Hn,e),n=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Hn,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},s.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var n=this,i=t.DEF,a=t.SEP,o=this.getLaFuncFromCache(r);if(o.call(this)===!0){i.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),a)};this.tokenMatcher(this.LA(1),a)===!0;)this.CONSUME(a),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,a,u,i,fl],u,Hn,e,fl)}else throw this.raiseEarlyExitException(e,Se.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)},s.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Is,e),n=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Is,e);return this.manyInternalLogic(e,t,r)},s.prototype.manyInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(t.DEF!==void 0){if(a=t.DEF,o=t.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=t;for(var l=!0;i.call(this)===!0&&l===!0;)l=this.doSingleRepetition(a);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],i,Is,e,rR,l)},s.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Ms,e),n=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Ms,e);this.manySepFirstInternalLogic(e,t,r)},s.prototype.manySepFirstInternalLogic=function(e,t,r){var n=this,i=t.DEF,a=t.SEP,o=this.getLaFuncFromCache(r);if(o.call(this)===!0){i.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),a)};this.tokenMatcher(this.LA(1),a)===!0;)this.CONSUME(a),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,a,u,i,dl],u,Ms,e,dl)}},s.prototype.repetitionSepSecondInternal=function(e,t,r,n,i){for(;r();)this.CONSUME(t),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,n,i],r,Hn,e,i)},s.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();e.call(this);var r=this.getLexerPosition();return r>t},s.prototype.orInternalNoCst=function(e,t){var r=lr(e)?e:e.DEF,n=this.getKeyForAutomaticLookahead($n,t),i=this.getLaFuncFromCache(n),a=i.call(this,r);if(a!==void 0){var o=r[a];return o.ALT.call(this)}this.raiseNoAltException(t,e.ERR_MSG)},s.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead($n,t),n=this.nestedRuleBeforeClause(e,r);try{var i=lr(e)?e:e.DEF,a=this.getLaFuncFromCache(r),o=a.call(this,i);if(o!==void 0){var u=i[o],l=this.nestedAltBeforeClause(u,t,$n,o);try{return u.ALT.call(this)}finally{l!==void 0&&this.nestedRuleFinallyClause(l.shortName,l.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Fh(t,e))}},s.prototype.subruleInternal=function(e,t,r){var n;try{var i=r!==void 0?r.ARGS:void 0;return n=e.call(this,t,i),this.cstPostNonTerminal(n,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),n}catch(a){this.subruleInternalError(a,r,e.ruleName)}},s.prototype.subruleInternalError=function(e,t,r){throw Ki(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,t!==void 0&&t.LABEL!==void 0?t.LABEL:r),delete e.partialCstResult),e},s.prototype.consumeInternal=function(e,t,r){var n;try{var i=this.LA(1);this.tokenMatcher(i,e)===!0?(this.consumeToken(),n=i):this.consumeInternalError(e,i,r)}catch(a){n=this.consumeInternalRecovery(e,t,a)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,n),n},s.prototype.consumeInternalError=function(e,t,r){var n,i=this.LA(0);throw r!==void 0&&r.ERR_MSG?n=r.ERR_MSG:n=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new ou(n,t,i))},s.prototype.consumeInternalRecovery=function(e,t,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){var n=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,n)}catch(i){throw i.name===Ph?r:i}}else throw r},s.prototype.saveRecogState=function(){var e=this.errors,t=Ot(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},s.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},s.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},s.prototype.isBackTracking=function(){return this.isBackTrackingStack.length!==0},s.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]},s.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull[e]},s.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),Cn)},s.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},s}(),eN=function(){function s(){}return s.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=Sa(e.errorMessageProvider,At.errorMessageProvider)},s.prototype.SAVE_ERROR=function(e){if(Ki(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ot(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(s.prototype,"errors",{get:function(){return Ot(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),s.prototype.raiseEarlyExitException=function(e,t,r){for(var n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],a=nu(e,i,t,this.maxLookahead),o=a[0],u=[],l=1;l<=this.maxLookahead;l++)u.push(this.LA(l));var h=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:o,actual:u,previous:this.LA(0),customUserDescription:r,ruleName:n});throw this.SAVE_ERROR(new Uh(h,this.LA(1),this.LA(0)))},s.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),n=this.getGAstProductions()[r],i=ru(e,n,this.maxLookahead),a=[],o=1;o<=this.maxLookahead;o++)a.push(this.LA(o));var u=this.LA(0),l=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:a,previous:u,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Lh(l,this.LA(1),u))},s}(),tN=function(){function s(){}return s.prototype.initContentAssist=function(){},s.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache[e];if(er(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return Nh([r],t,this.tokenMatcher,this.maxLookahead)},s.prototype.getNextPossibleTokenTypes=function(e){var t=Jt(e.ruleStack),r=this.getGAstProductions(),n=r[t],i=new tR(n,e).startWalking();return i},s}(),Oa={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Oa);var gl=!0,El=Math.pow(2,ln)-1,Bh=se({name:"RECORDING_PHASE_TOKEN",pattern:wt.NA});ti([Bh]);var kh=eu(Bh,`This IToken indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(kh);var rN={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,children:{}},nN=function(){function s(){}return s.prototype.initGastRecorder=function(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1},s.prototype.enableRecording=function(){var e=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var t=function(n){var i=n>0?n:"";e["CONSUME"+i]=function(a,o){return this.consumeInternalRecord(a,n,o)},e["SUBRULE"+i]=function(a,o){return this.subruleInternalRecord(a,n,o)},e["OPTION"+i]=function(a){return this.optionInternalRecord(a,n)},e["OR"+i]=function(a){return this.orInternalRecord(a,n)},e["MANY"+i]=function(a){this.manyInternalRecord(n,a)},e["MANY_SEP"+i]=function(a){this.manySepFirstInternalRecord(n,a)},e["AT_LEAST_ONE"+i]=function(a){this.atLeastOneInternalRecord(n,a)},e["AT_LEAST_ONE_SEP"+i]=function(a){this.atLeastOneSepFirstInternalRecord(n,a)}},r=0;r<10;r++)t(r);e.consume=function(n,i,a){return this.consumeInternalRecord(i,n,a)},e.subrule=function(n,i,a){return this.subruleInternalRecord(i,n,a)},e.option=function(n,i){return this.optionInternalRecord(i,n)},e.or=function(n,i){return this.orInternalRecord(i,n)},e.many=function(n,i){this.manyInternalRecord(n,i)},e.atLeastOne=function(n,i){this.atLeastOneInternalRecord(n,i)},e.ACTION=e.ACTION_RECORD,e.BACKTRACK=e.BACKTRACK_RECORD,e.LA=e.LA_RECORD})},s.prototype.disableRecording=function(){var e=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var t=0;t<10;t++){var r=t>0?t:"";delete e["CONSUME"+r],delete e["SUBRULE"+r],delete e["OPTION"+r],delete e["OR"+r],delete e["MANY"+r],delete e["MANY_SEP"+r],delete e["AT_LEAST_ONE"+r],delete e["AT_LEAST_ONE_SEP"+r]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})},s.prototype.ACTION_RECORD=function(e){},s.prototype.BACKTRACK_RECORD=function(e,t){return function(){return!0}},s.prototype.LA_RECORD=function(e){return Zi},s.prototype.topLevelRuleRecord=function(e,t){try{var r=new ss({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}},s.prototype.optionInternalRecord=function(e,t){return ds.call(this,ht,e,t)},s.prototype.atLeastOneInternalRecord=function(e,t){ds.call(this,tr,t,e)},s.prototype.atLeastOneSepFirstInternalRecord=function(e,t){ds.call(this,rr,t,e,gl)},s.prototype.manyInternalRecord=function(e,t){ds.call(this,Ge,t,e)},s.prototype.manySepFirstInternalRecord=function(e,t){ds.call(this,Ht,t,e,gl)},s.prototype.orInternalRecord=function(e,t){return sN.call(this,e,t)},s.prototype.subruleInternalRecord=function(e,t,r){if(Qi(t),!e||H(e,"ruleName")===!1){var n=new Error("<SUBRULE"+Rl(t)+"> argument is invalid"+(" expecting a Parser method reference but got: <"+JSON.stringify(e)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw n.KNOWN_RECORDER_ERROR=!0,n}var i=zi(this.recordingProdStack),a=e.ruleName,o=new Gt({idx:t,nonTerminalName:a,referencedRule:void 0});return i.definition.push(o),this.outputCst?rN:Oa},s.prototype.consumeInternalRecord=function(e,t,r){if(Qi(t),!mh(e)){var n=new Error("<CONSUME"+Rl(t)+"> argument is invalid"+(" expecting a TokenType reference but got: <"+JSON.stringify(e)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw n.KNOWN_RECORDER_ERROR=!0,n}var i=zi(this.recordingProdStack),a=new be({idx:t,terminalType:e});return i.definition.push(a),kh},s}();function ds(s,e,t,r){r===void 0&&(r=!1),Qi(t);var n=zi(this.recordingProdStack),i=un(e)?e:e.DEF,a=new s({definition:[],idx:t});return H(e,"NAME")&&(a.name=e.NAME),r&&(a.separator=e.SEP),H(e,"MAX_LOOKAHEAD")&&(a.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(a),i.call(this),n.definition.push(a),this.recordingProdStack.pop(),Oa}function sN(s,e){var t=this;Qi(e);var r=zi(this.recordingProdStack),n=lr(s)===!1,i=n===!1?s:s.DEF,a=new Wt({definition:[],idx:e,ignoreAmbiguities:n&&s.IGNORE_AMBIGUITIES===!0});H(s,"NAME")&&(a.name=s.NAME),H(s,"MAX_LOOKAHEAD")&&(a.maxLookahead=s.MAX_LOOKAHEAD);var o=nh(i,function(u){return un(u.GATE)});return a.hasPredicates=o,r.definition.push(a),W(i,function(u){var l=new bt({definition:[]});a.definition.push(l),H(u,"NAME")&&(l.name=u.NAME),H(u,"IGNORE_AMBIGUITIES")?l.ignoreAmbiguities=u.IGNORE_AMBIGUITIES:H(u,"GATE")&&(l.ignoreAmbiguities=!0),t.recordingProdStack.push(l),u.ALT.call(t),t.recordingProdStack.pop()}),Oa}function Rl(s){return s===0?"":""+s}function Qi(s){if(s<0||s>El){var e=new Error("Invalid DSL Method idx value: <"+s+`>
	`+("Idx value must be a none negative value smaller than "+(El+1)));throw e.KNOWN_RECORDER_ERROR=!0,e}}var iN=function(){function s(){}return s.prototype.initPerformanceTracer=function(e){if(H(e,"traceInitPerf")){var t=e.traceInitPerf,r=typeof t=="number";this.traceInitMaxIdent=r?t:1/0,this.traceInitPerf=r?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=At.traceInitPerf;this.traceInitIndent=-1},s.prototype.TRACE_INIT=function(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--> <"+e+">");var n=ah(t),i=n.time,a=n.value,o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(r+"<-- <"+e+"> time: "+i+"ms"),this.traceInitIndent--,a}else return t()},s}(),Gh=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Zi=eu(Cn,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Zi);var At=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:wh,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Ji=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),tt;(function(s){s[s.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",s[s.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",s[s.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",s[s.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",s[s.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",s[s.LEFT_RECURSION=5]="LEFT_RECURSION",s[s.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",s[s.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",s[s.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",s[s.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",s[s.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",s[s.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",s[s.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",s[s.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",s[s.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"})(tt||(tt={}));function aN(s){return s===void 0&&(s=void 0),function(){return s}}var uu=function(){function s(e,t){t===void 0&&(t=At),this.ignoredIssues=At.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1;var r=this;r.initErrorHandler(t),r.initLexerAdapter(),r.initLooksAhead(t),r.initRecognizerEngine(e,t),r.initRecoverable(t),r.initTreeBuilder(t),r.initContentAssist(),r.initGastRecorder(t),r.initPerformanceTracer(t),H(t,"ignoredIssues")&&t.ignoredIssues!==At.ignoredIssues&&Zo(`The <ignoredIssues> IParserConfig property is soft-deprecated and will be removed in future versions.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.`),this.ignoredIssues=H(t,"ignoredIssues")?t.ignoredIssues:At.ignoredIssues,this.skipValidations=H(t,"skipValidations")?t.skipValidations:At.skipValidations}return s.performSelfAnalysis=function(e){e.performSelfAnalysis()},s.prototype.performSelfAnalysis=function(){var e=this;this.TRACE_INIT("performSelfAnalysis",function(){var t;e.selfAnalysisDone=!0;var r=e.className;e.TRACE_INIT("toFastProps",function(){ih(e)}),e.TRACE_INIT("Grammar Recording",function(){try{e.enableRecording(),W(e.definedRulesNames,function(i){var a=e[i],o=a.originalGrammarAction,u=void 0;e.TRACE_INIT(i+" Rule",function(){u=e.topLevelRuleRecord(i,o)}),e.gastProductionsCache[i]=u})}finally{e.disableRecording()}});var n=[];if(e.TRACE_INIT("Grammar Resolving",function(){n=PR({rules:gt(e.gastProductionsCache)}),e.definitionErrors.push.apply(e.definitionErrors,n)}),e.TRACE_INIT("Grammar Validations",function(){if(ye(n)&&e.skipValidations===!1){var i=DR({rules:gt(e.gastProductionsCache),maxLookahead:e.maxLookahead,tokenTypes:gt(e.tokensMap),ignoredIssues:e.ignoredIssues,errMsgProvider:au,grammarName:r});e.definitionErrors.push.apply(e.definitionErrors,i)}}),ye(e.definitionErrors)&&(e.recoveryEnabled&&e.TRACE_INIT("computeAllProdsFollows",function(){var i=jE(gt(e.gastProductionsCache));e.resyncFollows=i}),e.TRACE_INIT("ComputeLookaheadFunctions",function(){e.preComputeLookaheadFunctions(gt(e.gastProductionsCache))})),e.TRACE_INIT("expandAllNestedRuleNames",function(){var i=JE(gt(e.gastProductionsCache),e.fullRuleNameToShort);e.allRuleNames=i.allRuleNames}),!s.DEFER_DEFINITION_ERRORS_HANDLING&&!ye(e.definitionErrors))throw t=P(e.definitionErrors,function(i){return i.message}),new Error(`Parser Definition Errors detected:
 `+t.join(`
-------------------------------
`))})},s.DEFER_DEFINITION_ERRORS_HANDLING=!1,s}();jg(uu,[VR,kR,qR,QR,JR,ZR,eN,tN,nN,iN]);(function(s){Gh(e,s);function e(t,r){r===void 0&&(r=At);var n=this,i=Zs(r);return i.outputCst=!0,n=s.call(this,t,i)||this,n}return e})(uu);var oN=function(s){Gh(e,s);function e(t,r){r===void 0&&(r=At);var n=this,i=Zs(r);return i.outputCst=!1,n=s.call(this,t,i)||this,n}return e}(uu);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Nl=(s,e)=>({type:s,message:e});var Le;(function(s){s.LexingError="LexingError",s.ParserError="ParsingError",s.StaticOffsetError="StaticOffsetError",s.StaticOffsetOutOfRangeError="StaticOffsetOutOfRangeError",s.RangeOffsetNotAllowed="RangeOffsetNotAllowed",s.InvalidRangeSize="InvalidRangeSize"})(Le||(Le={}));var R;(function(s){s.EMPTY="EMPTY",s.NUMBER="NUMBER",s.STRING="STRING",s.MINUS_UNARY_OP="MINUS_UNARY_OP",s.PLUS_UNARY_OP="PLUS_UNARY_OP",s.PERCENT_OP="PERCENT_OP",s.CONCATENATE_OP="CONCATENATE_OP",s.EQUALS_OP="EQUALS_OP",s.NOT_EQUAL_OP="NOT_EQUAL_OP",s.GREATER_THAN_OP="GREATER_THAN_OP",s.LESS_THAN_OP="LESS_THAN_OP",s.GREATER_THAN_OR_EQUAL_OP="GREATER_THAN_OR_EQUAL_OP",s.LESS_THAN_OR_EQUAL_OP="LESS_THAN_OR_EQUAL_OP",s.PLUS_OP="PLUS_OP",s.MINUS_OP="MINUS_OP",s.TIMES_OP="TIMES_OP",s.DIV_OP="DIV_OP",s.POWER_OP="POWER_OP",s.FUNCTION_CALL="FUNCTION_CALL",s.NAMED_EXPRESSION="NAMED_EXPRESSION",s.PARENTHESIS="PARENTHESES",s.CELL_REFERENCE="CELL_REFERENCE",s.CELL_RANGE="CELL_RANGE",s.COLUMN_RANGE="COLUMN_RANGE",s.ROW_RANGE="ROW_RANGE",s.ERROR="ERROR",s.ERROR_WITH_RAW_INPUT="ERROR_WITH_RAW_INPUT",s.ARRAY="ARRAY"})(R||(R={}));var Dt;(function(s){s[s.RELATIVE=0]="RELATIVE",s[s.START_ABSOLUTE=1]="START_ABSOLUTE",s[s.BOTH_ABSOLUTE=2]="BOTH_ABSOLUTE"})(Dt||(Dt={}));const uN=s=>({type:R.EMPTY,leadingWhitespace:s?.image}),lN=(s,e)=>({type:R.NUMBER,value:s,leadingWhitespace:e?.image}),cN=s=>{var e;return{type:R.STRING,value:s.image.slice(1,-1),leadingWhitespace:(e=s.leadingWhitespace)===null||e===void 0?void 0:e.image}},yl=(s,e)=>({type:R.CELL_REFERENCE,reference:s,leadingWhitespace:e?.image}),Tl=(s,e,t,r)=>(lu(s,e,t),{type:R.CELL_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r}),hN=(s,e,t,r)=>(lu(s,e,t),{type:R.COLUMN_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r?.image}),dN=(s,e,t,r)=>(lu(s,e,t),{type:R.ROW_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r?.image}),fN=(s,e,t)=>({type:R.CONCATENATE_OP,left:s,right:e,leadingWhitespace:t?.image}),pN=(s,e,t)=>({type:R.EQUALS_OP,left:s,right:e,leadingWhitespace:t?.image}),mN=(s,e,t)=>({type:R.NOT_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),gN=(s,e,t)=>({type:R.GREATER_THAN_OP,left:s,right:e,leadingWhitespace:t?.image}),EN=(s,e,t)=>({type:R.LESS_THAN_OP,left:s,right:e,leadingWhitespace:t?.image}),RN=(s,e,t)=>({type:R.GREATER_THAN_OR_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),NN=(s,e,t)=>({type:R.LESS_THAN_OR_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),yN=(s,e,t)=>({type:R.PLUS_OP,left:s,right:e,leadingWhitespace:t?.image}),TN=(s,e,t)=>({type:R.MINUS_OP,left:s,right:e,leadingWhitespace:t?.image}),vN=(s,e,t)=>({type:R.TIMES_OP,left:s,right:e,leadingWhitespace:t?.image}),SN=(s,e,t)=>({type:R.DIV_OP,left:s,right:e,leadingWhitespace:t?.image}),AN=(s,e,t)=>({type:R.POWER_OP,left:s,right:e,leadingWhitespace:t?.image}),CN=(s,e)=>({type:R.MINUS_UNARY_OP,value:s,leadingWhitespace:e?.image}),IN=(s,e)=>({type:R.PLUS_UNARY_OP,value:s,leadingWhitespace:e?.image}),wN=(s,e)=>({type:R.PERCENT_OP,value:s,leadingWhitespace:e?.image}),MN=(s,e,t,r,n)=>({type:R.FUNCTION_CALL,procedureName:s,args:e,leadingWhitespace:t?.image,internalWhitespace:r?.image,hyperlink:n}),vl=(s,e,t)=>({type:R.ARRAY,args:s,leadingWhitespace:e?.image,internalWhitespace:t?.image}),ON=(s,e)=>({type:R.NAMED_EXPRESSION,expressionName:s,leadingWhitespace:e?.image}),bN=(s,e,t)=>({type:R.PARENTHESIS,expression:s,leadingWhitespace:e?.image,internalWhitespace:t?.image}),yr=(s,e)=>({type:R.ERROR,error:s,leadingWhitespace:e?.image}),_n=(s,e,t)=>({type:R.ERROR_WITH_RAW_INPUT,error:e,rawInput:s,leadingWhitespace:t?.image}),mo=()=>({type:R.ERROR,error:m.parsingError()});function lu(s,e,t){if(s.sheet!==void 0&&e.sheet===void 0||s.sheet===void 0&&e.sheet!==void 0)throw new Error("Start address inconsistent with end address");if(s.sheet===void 0&&t!==Dt.RELATIVE||s.sheet!==void 0&&t===Dt.RELATIVE)throw new Error("Sheet address inconsistent with sheet reference type")}function ae(s,e){return(e??"")+s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Hh={[R.PLUS_OP]:"+",[R.MINUS_OP]:"-",[R.TIMES_OP]:"*",[R.DIV_OP]:"/",[R.CONCATENATE_OP]:"&",[R.POWER_OP]:"^",[R.EQUALS_OP]:"=",[R.NOT_EQUAL_OP]:"<>",[R.GREATER_THAN_OP]:">",[R.GREATER_THAN_OR_EQUAL_OP]:">=",[R.LESS_THAN_OP]:"<",[R.LESS_THAN_OR_EQUAL_OP]:"<="};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const xN=(s,e,t,r)=>({ast:s,relativeDependencies:e,hasVolatileFunction:t,hasStructuralChangeFunction:r});class _N{constructor(e){this.functionRegistry=e,this.cache=new Map}set(e,t){const r=xa(t,this.functionRegistry),n=xN(t,r,Kr(t,this.functionRegistry.isFunctionVolatile),Kr(t,this.functionRegistry.isFunctionDependentOnSheetStructureChange));return this.cache.set(e,n),n}get(e){return this.cache.get(e)}maybeSetAndThenGet(e,t){const r=this.cache.get(e);return r!==void 0?r.ast:(this.set(e,t),t)}}const Kr=(s,e)=>{switch(s.type){case R.EMPTY:case R.NUMBER:case R.STRING:case R.ERROR:case R.ERROR_WITH_RAW_INPUT:case R.CELL_REFERENCE:case R.CELL_RANGE:case R.COLUMN_RANGE:case R.ROW_RANGE:case R.NAMED_EXPRESSION:return!1;case R.PERCENT_OP:case R.PLUS_UNARY_OP:case R.MINUS_UNARY_OP:return Kr(s.value,e);case R.CONCATENATE_OP:case R.EQUALS_OP:case R.NOT_EQUAL_OP:case R.LESS_THAN_OP:case R.GREATER_THAN_OP:case R.LESS_THAN_OR_EQUAL_OP:case R.GREATER_THAN_OR_EQUAL_OP:case R.MINUS_OP:case R.PLUS_OP:case R.TIMES_OP:case R.DIV_OP:case R.POWER_OP:return Kr(s.left,e)||Kr(s.right,e);case R.PARENTHESIS:return Kr(s.expression,e);case R.FUNCTION_CALL:return e(s.procedureName)?!0:s.args.some(t=>Kr(t,e));case R.ARRAY:return s.args.some(t=>t.some(r=>Kr(r,e)))}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class y{}y.DistinctSigns="Distinct signs.";y.WrongArgNumber="Wrong number of arguments.";y.EmptyArg="Empty function argument.";y.EmptyArray="Empty array not allowed.";y.ArrayDimensions="Array dimensions are not compatible.";y.NoSpaceForArrayResult="No space for array result.";y.ValueSmall="Value too small.";y.ValueLarge="Value too large.";y.BadCriterion="Incorrect criterion.";y.RangeManySheets="Range spans more than one sheet.";y.CellRangeExpected="Cell range expected.";y.WrongDimension="Wrong range dimension.";y.ScalarExpected="Cell range not allowed.";y.NumberCoercion="Value cannot be coerced to number.";y.NumberExpected="Number argument expected.";y.IntegerExpected="Value needs to be an integer.";y.BadMode="Mode not recognized.";y.DateBounds="Date outside of bounds.";y.OutOfSheet="Resulting reference is out of the sheet.";y.WrongType="Wrong type of argument.";y.NaN="NaN or infinite value encountered.";y.EqualLength="Ranges need to be of equal length.";y.Negative="Value cannot be negative.";y.NotBinary="String does not represent a binary number.";y.NotOctal="String does not represent an octal number.";y.NotHex="String does not represent a hexadecimal number.";y.EndStartPeriod="End period needs to be at least start period.";y.CellRefExpected="Cell reference expected.";y.EmptyRange="Empty range not allowed.";y.BadRef="Address is not correct.";y.NumberRange="Number-only range expected.";y.ValueNotFound="Value not found.";y.ValueBaseLarge="Value in base too large.";y.ValueBaseSmall="Value in base too small.";y.ValueBaseLong="Value in base too long.";y.NegativeLength="Length cannot be negative.";y.PatternNotFound="Pattern not found.";y.OneValue="Needs at least one value.";y.TwoValues="Range needs to contain at least two elements.";y.ThreeValues="Range needs to contain at least three elements.";y.IndexBounds="Index out of bounds.";y.IndexLarge="Index too large.";y.Formula="Expected formula.";y.NegativeCount="Count cannot be negative.";y.ParseError="Parsing error.";y.SheetRef="Sheet does not exist.";y.PeriodLong="Period number cannot exceed life length.";y.InvalidDate="Invalid date.";y.BitshiftLong="Result of bitshift is too long.";y.EmptyString="Empty-string argument not allowed.";y.LengthBounds="Length out of bounds.";y.NegativeTime="Time cannot be negative.";y.NoDefault="No default option.";y.NoConditionMet="None of the conditions were met.";y.Selector="Selector cannot exceed the number of arguments.";y.StartEndDate="Start date needs to be earlier than end date.";y.IncorrectDateTime="String does not represent correct DateTime.";y.CharacterCodeBounds="Character code out of bounds.";y.NonZero="Argument cannot be 0.";y.LessThanOne="Argument cannot be less than 1.";y.WeekendString="Incorrect weekend bitmask string.";y.InvalidRoman="Invalid roman numeral.";y.WrongOrder="Wrong order of values.";y.ComplexNumberExpected="Complex number expected.";y.ShouldBeIorJ="Should be 'i' or 'j'.";y.SizeMismatch="Array dimensions mismatched.";y.FunctionName=s=>`Function name ${s} not recognized.`;y.NamedExpressionName=s=>`Named expression ${s} not recognized.`;y.LicenseKey=s=>`License key is ${s}.`;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class LN{constructor(){this.POSSIBLE_START_CHARACTERS=[...Jc,...Ug,Nt,"'","_"],this.cellReferenceRegexp=new RegExp(Fg,"y")}match(e,t){this.cellReferenceRegexp.lastIndex=t;const r=this.cellReferenceRegexp.exec(e+"@");return r==null||r[1]==null?null:(r[0]=r[1],r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class FN{constructor(){this.POSSIBLE_START_CHARACTERS=[...Jc,"_"],this.namedExpressionRegexp=new RegExp(Zc,"y"),this.r1c1CellRefRegexp=new RegExp(`^${Qc}$`)}match(e,t){this.namedExpressionRegexp.lastIndex=t;const r=this.namedExpressionRegexp.exec(e);return r==null||r[0]==null||this.r1c1CellRefRegexp.test(r[0])?null:r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const ks=se({name:"AdditionOp",pattern:wt.NA}),go=se({name:"PlusOp",pattern:/\+/,categories:ks}),Eo=se({name:"MinusOp",pattern:/-/,categories:ks}),ba=se({name:"MultiplicationOp",pattern:wt.NA}),Wh=se({name:"TimesOp",pattern:/\*/,categories:ba}),zh=se({name:"DivOp",pattern:/\//,categories:ba}),Ro=se({name:"PowerOp",pattern:/\^/}),Yh=se({name:"PercentOp",pattern:/%/}),cn=se({name:"BooleanOp",pattern:wt.NA}),No=se({name:"EqualsOp",pattern:/=/,categories:cn}),jh=se({name:"NotEqualOp",pattern:/<>/,categories:cn}),$h=se({name:"GreaterThanOp",pattern:/>/,categories:cn}),Xh=se({name:"LessThanOp",pattern:/</,categories:cn}),Kh=se({name:"GreaterThanOrEqualOp",pattern:/>=/,categories:cn}),qh=se({name:"LessThanOrEqualOp",pattern:/<=/,categories:cn}),Qh=se({name:"ConcatenateOp",pattern:/&/}),yo=se({name:"LParen",pattern:/\(/}),xi=se({name:"RParen",pattern:/\)/}),Zh=se({name:"ArrayLParen",pattern:/{/}),Jh=se({name:"ArrayRParen",pattern:/}/}),ed=se({name:"StringLiteral",pattern:/"([^"\\]*(\\.[^"\\]*)*)"/}),td=se({name:"ErrorLiteral",pattern:/#[A-Za-z0-9\/]+[?!]?/}),Gs=se({name:"RangeSeparator",pattern:new RegExp(Qs)}),cu=se({name:"ColumnRange",pattern:new RegExp(`${Wu}${Qs}${Wu}`)}),hu=se({name:"RowRange",pattern:new RegExp(`${zu}${Qs}${zu}`)}),du=se({name:"ProcedureName",pattern:new RegExp(`([${Na}][${Xo}]*)\\(`)}),ja=new LN,en=se({name:"CellReference",pattern:ja.match.bind(ja),start_chars_hint:ja.POSSIBLE_START_CHARACTERS,line_breaks:!1}),$a=new FN,rd=se({name:"NamedExpression",pattern:$a.match.bind($a),start_chars_hint:$a.POSSIBLE_START_CHARACTERS,line_breaks:!1}),fu=s=>{const e=s.translationPackage.getFunctionTranslation("OFFSET"),t=s.errorMapping,r=s.translationPackage.buildFunctionMapping(),n=new RegExp(s.ignoreWhiteSpace==="standard"?_g:xg),i=se({name:"WhiteSpace",pattern:n}),a=se({name:"ArrayRowSep",pattern:s.arrayRowSeparator}),o=se({name:"ArrayColSep",pattern:s.arrayColumnSeparator}),u=se({name:"NumberLiteral",pattern:new RegExp(`(([${s.decimalSeparator}]\\d+)|(\\d+([${s.decimalSeparator}]\\d*)?))(e[+-]?\\d+)?`)}),l=se({name:"OffsetProcedureName",pattern:new RegExp(e,"i")});let h,d;s.functionArgSeparator===s.arrayColumnSeparator?(h=o,d=[]):s.functionArgSeparator===s.arrayRowSeparator?(h=a,d=[]):(h=se({name:"ArgSeparator",pattern:s.functionArgSeparator}),d=[h]);const f=[i,go,Eo,Wh,zh,Ro,No,jh,Yh,Kh,qh,$h,Xh,yo,xi,Zh,Jh,l,du,Gs,...d,cu,hu,u,ed,td,Qh,cn,ks,ba,en,rd,a,o];return{ArgSeparator:h,NumberLiteral:u,OffsetProcedureName:l,ArrayRowSeparator:a,ArrayColSeparator:o,WhiteSpace:i,allTokens:f,errorMapping:t,functionMapping:r,decimalSeparator:s.decimalSeparator,maxColumns:s.maxColumns,maxRows:s.maxRows}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Wn extends oN{constructor(e,t){super(e.allTokens,{outputCst:!1,maxLookahead:7}),this.booleanExpressionOrEmpty=this.RULE("booleanExpressionOrEmpty",()=>this.OR([{ALT:()=>this.SUBRULE(this.booleanExpression)},{ALT:aN(uN())}])),this.procedureExpression=this.RULE("procedureExpression",()=>{var r;const n=this.CONSUME(du),i=n.image.toUpperCase().slice(0,-1),a=(r=this.lexerConfig.functionMapping[i])!==null&&r!==void 0?r:i,o=[];let u=this.SUBRULE(this.booleanExpressionOrEmpty);this.MANY(()=>{var h;const d=this.CONSUME(this.lexerConfig.ArgSeparator);u.type===R.EMPTY&&(u.leadingWhitespace=(h=d.leadingWhitespace)===null||h===void 0?void 0:h.image),o.push(u),u=this.SUBRULE2(this.booleanExpressionOrEmpty)}),o.push(u),o.length===1&&o[0].type===R.EMPTY&&(o.length=0);const l=this.CONSUME(xi);return MN(a,o,n.leadingWhitespace,l.leadingWhitespace)}),this.namedExpressionExpression=this.RULE("namedExpressionExpression",()=>{const r=this.CONSUME(rd);return ON(r.image,r.leadingWhitespace)}),this.offsetProcedureExpression=this.RULE("offsetProcedureExpression",()=>{const r=[];return this.CONSUME(this.lexerConfig.OffsetProcedureName),this.CONSUME(yo),this.MANY_SEP({SEP:this.lexerConfig.ArgSeparator,DEF:()=>{r.push(this.SUBRULE(this.booleanExpression))}}),this.CONSUME(xi),this.handleOffsetHeuristic(r)}),this.columnRangeExpression=this.RULE("columnRangeExpression",()=>{const r=this.CONSUME(cu),[n,i]=r.image.split(":"),a=this.ACTION(()=>Gi(this.sheetMapping,n,this.formulaAddress)),o=this.ACTION(()=>Gi(this.sheetMapping,i,this.formulaAddress));if(a===void 0||o===void 0)return yr(new m(E.REF));if(a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns)||o.exceedsSheetSizeLimits(this.lexerConfig.maxColumns))return _n(r.image,new m(E.NAME),r.leadingWhitespace);if(a.sheet===void 0&&o.sheet!==void 0)return this.parsingError(Le.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:l,sheetRefType:h}=Wn.fixSheetIdsForRangeEnds(a,o);return hN(u,l,h,r.leadingWhitespace)}),this.rowRangeExpression=this.RULE("rowRangeExpression",()=>{const r=this.CONSUME(hu),[n,i]=r.image.split(":"),a=this.ACTION(()=>Hi(this.sheetMapping,n,this.formulaAddress)),o=this.ACTION(()=>Hi(this.sheetMapping,i,this.formulaAddress));if(a===void 0||o===void 0)return yr(new m(E.REF));if(a.exceedsSheetSizeLimits(this.lexerConfig.maxRows)||o.exceedsSheetSizeLimits(this.lexerConfig.maxRows))return _n(r.image,new m(E.NAME),r.leadingWhitespace);if(a.sheet===void 0&&o.sheet!==void 0)return this.parsingError(Le.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:l,sheetRefType:h}=Wn.fixSheetIdsForRangeEnds(a,o);return dN(u,l,h,r.leadingWhitespace)}),this.cellReference=this.RULE("cellReference",()=>{const r=this.CONSUME(en),n=this.ACTION(()=>Pn(this.sheetMapping,r.image,this.formulaAddress));return n===void 0?_n(r.image,new m(E.REF),r.leadingWhitespace):n.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?_n(r.image,new m(E.NAME),r.leadingWhitespace):yl(n,r.leadingWhitespace)}),this.endRangeReference=this.RULE("endRangeReference",r=>{var n;const i=this.CONSUME(en),a=this.ACTION(()=>Pn(this.sheetMapping,r.image,this.formulaAddress)),o=this.ACTION(()=>Pn(this.sheetMapping,i.image,this.formulaAddress));return a===void 0||o===void 0?this.ACTION(()=>_n(`${r.image}:${i.image}`,new m(E.REF),r.leadingWhitespace)):a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)||o.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?this.ACTION(()=>_n(`${r.image}:${i.image}`,new m(E.NAME),r.leadingWhitespace)):this.buildCellRange(a,o,(n=r.leadingWhitespace)===null||n===void 0?void 0:n.image)}),this.endOfRangeExpression=this.RULE("endOfRangeExpression",r=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeReference,{ARGS:[r]})},{ALT:()=>{var n;const i=this.SUBRULE(this.offsetProcedureExpression),a=this.ACTION(()=>Pn(this.sheetMapping,r.image,this.formulaAddress));return a===void 0?yr(new m(E.REF)):i.type===R.CELL_REFERENCE?this.buildCellRange(a,i.reference,(n=r.leadingWhitespace)===null||n===void 0?void 0:n.image):this.parsingError(Le.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.cellRangeExpression=this.RULE("cellRangeExpression",()=>{const r=this.CONSUME(en);return this.CONSUME2(Gs),this.SUBRULE(this.endOfRangeExpression,{ARGS:[r]})}),this.endRangeWithOffsetStartReference=this.RULE("endRangeWithOffsetStartReference",r=>{const n=this.CONSUME(en),i=this.ACTION(()=>Pn(this.sheetMapping,n.image,this.formulaAddress));return i===void 0?this.ACTION(()=>yr(new m(E.REF))):this.buildCellRange(r.reference,i,r.leadingWhitespace)}),this.endOfRangeWithOffsetStartExpression=this.RULE("endOfRangeWithOffsetStartExpression",r=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeWithOffsetStartReference,{ARGS:[r]})},{ALT:()=>{const n=this.SUBRULE(this.offsetProcedureExpression);return n.type===R.CELL_REFERENCE?this.buildCellRange(r.reference,n.reference,r.leadingWhitespace):this.parsingError(Le.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.offsetExpression=this.RULE("offsetExpression",()=>{const r=this.SUBRULE(this.offsetProcedureExpression);let n;return this.OPTION(()=>{this.CONSUME(Gs),r.type===R.CELL_RANGE?n=this.parsingError(Le.RangeOffsetNotAllowed,"Range offset not allowed here"):n=this.SUBRULE(this.endOfRangeWithOffsetStartExpression,{ARGS:[r]})}),n!==void 0?n:r}),this.insideArrayExpression=this.RULE("insideArrayExpression",()=>{const r=[[]];return r[r.length-1].push(this.SUBRULE(this.booleanExpression)),this.MANY(()=>{this.OR([{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayColSeparator),r[r.length-1].push(this.SUBRULE2(this.booleanExpression))}},{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayRowSeparator),r.push([]),r[r.length-1].push(this.SUBRULE3(this.booleanExpression))}}])}),vl(r)}),this.parenthesisExpression=this.RULE("parenthesisExpression",()=>{const r=this.CONSUME(yo),n=this.SUBRULE(this.booleanExpression),i=this.CONSUME(xi);return bN(n,r.leadingWhitespace,i.leadingWhitespace)}),this.arrayExpression=this.RULE("arrayExpression",()=>this.OR([{ALT:()=>{const r=this.CONSUME(Zh),n=this.SUBRULE(this.insideArrayExpression),i=this.CONSUME(Jh);return vl(n.args,r.leadingWhitespace,i.leadingWhitespace)}},{ALT:()=>this.SUBRULE(this.parenthesisExpression)}])),this.numericStringToNumber=r=>{const n=r.replace(this.lexerConfig.decimalSeparator,".");return Number(n)},this.positiveAtomicExpression=this.RULE("positiveAtomicExpression",()=>{var r;return this.OR((r=this.atomicExpCache)!==null&&r!==void 0?r:this.atomicExpCache=[{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.SUBRULE(this.cellRangeExpression)},{ALT:()=>this.SUBRULE(this.columnRangeExpression)},{ALT:()=>this.SUBRULE(this.rowRangeExpression)},{ALT:()=>this.SUBRULE(this.offsetExpression)},{ALT:()=>this.SUBRULE(this.cellReference)},{ALT:()=>this.SUBRULE(this.procedureExpression)},{ALT:()=>this.SUBRULE(this.namedExpressionExpression)},{ALT:()=>{const n=this.CONSUME(this.lexerConfig.NumberLiteral);return lN(this.numericStringToNumber(n.image),n.leadingWhitespace)}},{ALT:()=>{const n=this.CONSUME(ed);return cN(n)}},{ALT:()=>{const n=this.CONSUME(td),i=n.image.toUpperCase(),a=this.lexerConfig.errorMapping[i];return a?yr(new m(a),n.leadingWhitespace):this.parsingError(Le.ParserError,"Unknown error literal")}}])}),this.rightUnaryOpAtomicExpression=this.RULE("rightUnaryOpAtomicExpression",()=>{const r=this.SUBRULE(this.positiveAtomicExpression),n=this.OPTION(()=>this.CONSUME(Yh));return n?wN(r,n.leadingWhitespace):r}),this.atomicExpression=this.RULE("atomicExpression",()=>this.OR([{ALT:()=>{const r=this.CONSUME(ks),n=this.SUBRULE(this.atomicExpression);return ge(r,go)?IN(n,r.leadingWhitespace):ge(r,Eo)?CN(n,r.leadingWhitespace):(this.customParsingError=Nl(Le.ParserError,"Mismatched token type"),this.customParsingError)}},{ALT:()=>this.SUBRULE2(this.rightUnaryOpAtomicExpression)}])),this.powerExpression=this.RULE("powerExpression",()=>{let r=this.SUBRULE(this.atomicExpression);return this.MANY(()=>{const n=this.CONSUME(Ro),i=this.SUBRULE2(this.atomicExpression);ge(n,Ro)?r=AN(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{let r=this.SUBRULE(this.powerExpression);return this.MANY(()=>{const n=this.CONSUME(ba),i=this.SUBRULE2(this.powerExpression);ge(n,Wh)?r=vN(r,i,n.leadingWhitespace):ge(n,zh)?r=SN(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.additionExpression=this.RULE("additionExpression",()=>{let r=this.SUBRULE(this.multiplicationExpression);return this.MANY(()=>{const n=this.CONSUME(ks),i=this.SUBRULE2(this.multiplicationExpression);ge(n,go)?r=yN(r,i,n.leadingWhitespace):ge(n,Eo)?r=TN(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.concatenateExpression=this.RULE("concatenateExpression",()=>{let r=this.SUBRULE(this.additionExpression);return this.MANY(()=>{const n=this.CONSUME(Qh),i=this.SUBRULE2(this.additionExpression);r=fN(r,i,n.leadingWhitespace)}),r}),this.booleanExpression=this.RULE("booleanExpression",()=>{let r=this.SUBRULE(this.concatenateExpression);return this.MANY(()=>{const n=this.CONSUME(cn),i=this.SUBRULE2(this.concatenateExpression);ge(n,No)?r=pN(r,i,n.leadingWhitespace):ge(n,jh)?r=mN(r,i,n.leadingWhitespace):ge(n,$h)?r=gN(r,i,n.leadingWhitespace):ge(n,Xh)?r=EN(r,i,n.leadingWhitespace):ge(n,Kh)?r=RN(r,i,n.leadingWhitespace):ge(n,qh)?r=NN(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.formula=this.RULE("formula",()=>(this.CONSUME(No),this.SUBRULE(this.booleanExpression))),this.lexerConfig=e,this.sheetMapping=t,this.formulaAddress=x(0,0,0),this.performSelfAnalysis()}parseFromTokens(e,t){this.input=e;let r=this.formulaWithContext(t),n=[];return this.customParsingError&&n.push(this.customParsingError),n=n.concat(this.errors.map(i=>({type:Le.ParserError,message:i.message}))),n.length>0&&(r=mo()),{ast:r,errors:n}}reset(){super.reset(),this.customParsingError=void 0}formulaWithContext(e){return this.formulaAddress=e,this.formula()}buildCellRange(e,t,r){if(e.sheet===void 0&&t.sheet!==void 0)return this.parsingError(Le.ParserError,"Malformed range expression");const{firstEnd:n,secondEnd:i,sheetRefType:a}=Wn.fixSheetIdsForRangeEnds(e,t);return Tl(n,i,a,r)}static fixSheetIdsForRangeEnds(e,t){const r=Wn.rangeSheetReferenceType(e.sheet,t.sheet),n=e.sheet!==void 0&&t.sheet===void 0?t.withSheet(e.sheet):t;return{firstEnd:e,secondEnd:n,sheetRefType:r}}handleOffsetHeuristic(e){var t;const r=e[0];if(r.type!==R.CELL_REFERENCE)return this.parsingError(Le.StaticOffsetError,"First argument to OFFSET is not a reference");const n=e[1];let i;if(n.type===R.NUMBER&&Number.isInteger(n.value))i=n.value;else if(n.type===R.PLUS_UNARY_OP&&n.value.type===R.NUMBER&&Number.isInteger(n.value.value))i=n.value.value;else if(n.type===R.MINUS_UNARY_OP&&n.value.type===R.NUMBER&&Number.isInteger(n.value.value))i=-n.value.value;else return this.parsingError(Le.StaticOffsetError,"Second argument to OFFSET is not a static number");const a=e[2];let o;if(a.type===R.NUMBER&&Number.isInteger(a.value))o=a.value;else if(a.type===R.PLUS_UNARY_OP&&a.value.type===R.NUMBER&&Number.isInteger(a.value.value))o=a.value.value;else if(a.type===R.MINUS_UNARY_OP&&a.value.type===R.NUMBER&&Number.isInteger(a.value.value))o=-a.value.value;else return this.parsingError(Le.StaticOffsetError,"Third argument to OFFSET is not a static number");const u=e[3];let l;if(u===void 0)l=1;else if(u.type===R.NUMBER){if(l=u.value,l<1)return this.parsingError(Le.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(l))return this.parsingError(Le.StaticOffsetError,"Fourth argument to OFFSET is not integer")}else return this.parsingError(Le.StaticOffsetError,"Fourth argument to OFFSET is not a static number");const h=e[4];let d;if(h===void 0)d=1;else if(h.type===R.NUMBER){if(d=h.value,d<1)return this.parsingError(Le.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(d))return this.parsingError(Le.StaticOffsetError,"Fifth argument to OFFSET is not integer")}else return this.parsingError(Le.StaticOffsetError,"Fifth argument to OFFSET is not a static number");const f=new Ne(r.reference.col+o,r.reference.row+i,r.reference.type,(t=r.reference.sheet)!==null&&t!==void 0?t:void 0);let p=f.col,N=f.row;if((r.reference.type===fe.CELL_REFERENCE_RELATIVE||r.reference.type===fe.CELL_REFERENCE_ABSOLUTE_COL)&&(N=N+this.formulaAddress.row),(r.reference.type===fe.CELL_REFERENCE_RELATIVE||r.reference.type===fe.CELL_REFERENCE_ABSOLUTE_ROW)&&(p=p+this.formulaAddress.col),p<0||N<0)return yr(new m(E.REF,y.OutOfSheet));if(d===1&&l===1)return yl(f);{const g=new Ne(f.col+d-1,f.row+l-1,f.type,f.sheet),S=r.reference.sheet==null?Dt.RELATIVE:Dt.BOTH_ABSOLUTE;return Tl(f,g,S)}}parsingError(e,t){return this.customParsingError=Nl(e,t),mo()}static rangeSheetReferenceType(e,t){return e===void 0?Dt.RELATIVE:t===void 0?Dt.START_ABSOLUTE:Dt.BOTH_ABSOLUTE}}class ea{constructor(e){this.lexerConfig=e,this.lexer=new wt(e.allTokens,{ensureOptimizations:!0})}tokenizeFormula(e){const t=this.lexer.tokenize(e);let r=t.tokens;return r=this.trimTrailingWhitespaces(r),r=this.skipWhitespacesInsideRanges(r),r=this.skipWhitespacesBeforeArgSeparators(r),t.tokens=r,t}skipWhitespacesInsideRanges(e){return ea.filterTokensByNeighbors(e,(t,r,n)=>(ge(t,en)||ge(t,Gs))&&ge(r,this.lexerConfig.WhiteSpace)&&(ge(n,en)||ge(n,Gs)))}skipWhitespacesBeforeArgSeparators(e){return ea.filterTokensByNeighbors(e,(t,r,n)=>!ge(t,this.lexerConfig.ArgSeparator)&&ge(r,this.lexerConfig.WhiteSpace)&&ge(n,this.lexerConfig.ArgSeparator))}static filterTokensByNeighbors(e,t){if(e.length<3)return e;let r=0;const n=[e[r++]];for(;r<e.length-1;)t(e[r-1],e[r],e[r+1])||n.push(e[r]),++r;return n.push(e[r]),n}trimTrailingWhitespaces(e){return e.length>0&&ge(e[e.length-1],this.lexerConfig.WhiteSpace)&&e.pop(),e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class nd{constructor(e,t,r,n){this.config=e,this.lexerConfig=t,this.sheetMappingFn=r,this.namedExpressions=n}unparse(e,t){return"="+this.unparseAst(e,t)}unparseAst(e,t){var r,n;switch(e.type){case R.EMPTY:return ae("",e.leadingWhitespace);case R.NUMBER:return ae(sd(e.value,this.config.decimalSeparator),e.leadingWhitespace);case R.STRING:return ae('"'+e.value+'"',e.leadingWhitespace);case R.FUNCTION_CALL:{const i=e.args.map(u=>u!==void 0?this.unparseAst(u,t):"").join(this.config.functionArgSeparator),o=(this.config.translationPackage.isFunctionTranslated(e.procedureName)?this.config.translationPackage.getFunctionTranslation(e.procedureName):e.procedureName)+"("+i+ae(")",e.internalWhitespace);return ae(o,e.leadingWhitespace)}case R.NAMED_EXPRESSION:{const i=(r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.sheet))===null||r===void 0?void 0:r.displayName;return ae(i||e.expressionName,e.leadingWhitespace)}case R.CELL_REFERENCE:{let i;return e.reference.sheet!==void 0?i=this.unparseSheetName(e.reference.sheet)+"!":i="",i+=(n=e.reference.unparse(t))!==null&&n!==void 0?n:this.config.translationPackage.getErrorTranslation(E.REF),ae(i,e.leadingWhitespace)}case R.COLUMN_RANGE:case R.ROW_RANGE:case R.CELL_RANGE:return ae(this.formatRange(e,t),e.leadingWhitespace);case R.PLUS_UNARY_OP:{const i=this.unparseAst(e.value,t);return ae("+",e.leadingWhitespace)+i}case R.MINUS_UNARY_OP:{const i=this.unparseAst(e.value,t);return ae("-",e.leadingWhitespace)+i}case R.PERCENT_OP:return this.unparseAst(e.value,t)+ae("%",e.leadingWhitespace);case R.ERROR:{const i=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:E.ERROR);return ae(i,e.leadingWhitespace)}case R.ERROR_WITH_RAW_INPUT:return ae(e.rawInput,e.leadingWhitespace);case R.PARENTHESIS:{const a="("+this.unparseAst(e.expression,t)+ae(")",e.internalWhitespace);return ae(a,e.leadingWhitespace)}case R.ARRAY:{const i="{"+e.args.map(a=>a.map(o=>this.unparseAst(o,t)).join(this.config.arrayColumnSeparator)).join(this.config.arrayRowSeparator)+ae("}",e.internalWhitespace);return ae(i,e.leadingWhitespace)}default:{const i=this.unparseAst(e.left,t),a=this.unparseAst(e.right,t);return i+ae(Hh[e.type],e.leadingWhitespace)+a}}}unparseSheetName(e){const t=th(e,this.sheetMappingFn);if(t===void 0)throw new Oe(e);return t}formatRange(e,t){let r="",n="";e.start.sheet!==void 0&&e.sheetReferenceType!==Dt.RELATIVE&&(r=this.unparseSheetName(e.start.sheet)+"!"),e.end.sheet!==void 0&&e.sheetReferenceType===Dt.BOTH_ABSOLUTE&&(n=this.unparseSheetName(e.end.sheet)+"!");const i=e.start.unparse(t),a=e.end.unparse(t);return i===void 0||a===void 0?this.config.translationPackage.getErrorTranslation(E.REF):`${r}${i}:${n}${a}`}}function sd(s,e){return s.toString().replace(".",e)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class bs{constructor(e,t,r){this.config=e,this.functionRegistry=t,this.sheetMapping=r,this.statsCacheUsed=0,this.lexerConfig=fu(e),this.lexer=new ea(this.lexerConfig),this.formulaParser=new Wn(this.lexerConfig,this.sheetMapping),this.cache=new _N(this.functionRegistry)}parse(e,t){this.formulaAddress=t;const r=this.tokenizeFormula(e);if(r.errors.length>0){const d=r.errors.map(f=>({type:Le.LexingError,message:f.message}));return{ast:mo(),errors:d,hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]}}const n=this.computeHashFromTokens(r.tokens,t);let i=this.cache.get(n);if(i!==void 0)++this.statsCacheUsed;else{const d=this.bindWhitespacesToTokens(r.tokens),f=this.formulaParser.parseFromTokens(d,t);if(f.errors.length>0)return Object.assign(Object.assign({},f),{hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]});i=this.cache.set(n,f.ast)}const{ast:a,hasVolatileFunction:o,hasStructuralChangeFunction:u}=i,l=this.convertReversedRangesToRegularRanges(a),h=xa(l,this.functionRegistry);return{ast:l,errors:[],hasVolatileFunction:o,hasStructuralChangeFunction:u,dependencies:h}}convertReversedRangesToRegularRanges(e){switch(e.type){case R.EMPTY:case R.NUMBER:case R.STRING:case R.ERROR:case R.ERROR_WITH_RAW_INPUT:case R.CELL_REFERENCE:case R.NAMED_EXPRESSION:return e;case R.CELL_RANGE:{const{start:t,end:r}=e,n=this.orderCellRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case R.COLUMN_RANGE:{const{start:t,end:r}=e,n=this.orderColumnRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case R.ROW_RANGE:{const{start:t,end:r}=e,n=this.orderRowRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case R.PERCENT_OP:case R.PLUS_UNARY_OP:case R.MINUS_UNARY_OP:{const t=this.convertReversedRangesToRegularRanges(e.value);return Object.assign(Object.assign({},e),{value:t})}case R.CONCATENATE_OP:case R.EQUALS_OP:case R.NOT_EQUAL_OP:case R.LESS_THAN_OP:case R.GREATER_THAN_OP:case R.LESS_THAN_OR_EQUAL_OP:case R.GREATER_THAN_OR_EQUAL_OP:case R.MINUS_OP:case R.PLUS_OP:case R.TIMES_OP:case R.DIV_OP:case R.POWER_OP:{const t=this.convertReversedRangesToRegularRanges(e.left),r=this.convertReversedRangesToRegularRanges(e.right);return Object.assign(Object.assign({},e),{left:t,right:r})}case R.PARENTHESIS:{const t=this.convertReversedRangesToRegularRanges(e.expression);return Object.assign(Object.assign({},e),{expression:t})}case R.FUNCTION_CALL:{const t=e.args.map(r=>this.convertReversedRangesToRegularRanges(r));return Object.assign(Object.assign({},e),{args:t})}case R.ARRAY:{const t=e.args.map(r=>r.map(n=>this.convertReversedRangesToRegularRanges(n)));return Object.assign(Object.assign({},e),{args:t})}}}orderCellRangeEnds(e,t){const r=[e,t],[n,i]=r.map(h=>h.toColumnAddress()).sort(Rt.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(h=>h.toRowAddress()).sort(mt.compareByAbsoluteAddress(this.formulaAddress)),[u,l]=r.map(h=>h.sheet).sort(bs.compareSheetIds.bind(this));return{start:Ne.fromColAndRow(n,a,u),end:Ne.fromColAndRow(i,o,l)}}orderColumnRangeEnds(e,t){const r=[e,t],[n,i]=r.sort(Rt.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(u=>u.sheet).sort(bs.compareSheetIds.bind(this));return{start:new Rt(n.type,n.col,a),end:new Rt(i.type,i.col,o)}}orderRowRangeEnds(e,t){const r=[e,t],[n,i]=r.sort(mt.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(u=>u.sheet).sort(bs.compareSheetIds.bind(this));return{start:new mt(n.type,n.row,a),end:new mt(i.type,i.row,o)}}static compareSheetIds(e,t){return e=e??1/0,t=t??1/0,e-t}fetchCachedResultForAst(e){const t=this.computeHashFromAst(e);return this.fetchCachedResult(t)}fetchCachedResult(e){const t=this.cache.get(e);if(t===void 0)throw new Error("There is no AST with such key in the cache");{const{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,relativeDependencies:a}=t;return{ast:r,errors:[],hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}}}computeHashFromTokens(e,t){var r;let n="",i=0;for(;i<e.length;){const a=e[i];if(ge(a,en)){const o=Pn(this.sheetMapping,a.image,t);o===void 0?n=n.concat(a.image):n=n.concat(o.hash(!0))}else if(ge(a,du)){const o=a.image.toUpperCase().slice(0,-1),u=(r=this.lexerConfig.functionMapping[o])!==null&&r!==void 0?r:o;n=n.concat(u,"(")}else if(ge(a,cu)){const[o,u]=a.image.split(":"),l=Gi(this.sheetMapping,o,t),h=Gi(this.sheetMapping,u,t);l===void 0||h===void 0?n=n.concat("!REF"):n=n.concat(l.hash(!0),":",h.hash(!0))}else if(ge(a,hu)){const[o,u]=a.image.split(":"),l=Hi(this.sheetMapping,o,t),h=Hi(this.sheetMapping,u,t);l===void 0||h===void 0?n=n.concat("!REF"):n=n.concat(l.hash(!0),":",h.hash(!0))}else n=n.concat(a.image);i++}return n}rememberNewAst(e){const t=this.computeHashFromAst(e);return this.cache.maybeSetAndThenGet(t,e)}computeHashFromAst(e){return"="+this.computeHashOfAstNode(e)}computeHashOfAstNode(e){switch(e.type){case R.EMPTY:return e.leadingWhitespace||"";case R.NUMBER:return ae(sd(e.value,this.config.decimalSeparator),e.leadingWhitespace);case R.STRING:return ae('"'+e.value+'"',e.leadingWhitespace);case R.NAMED_EXPRESSION:return ae(e.expressionName,e.leadingWhitespace);case R.FUNCTION_CALL:{const t=e.args.map(n=>this.computeHashOfAstNode(n)).join(this.config.functionArgSeparator),r=e.procedureName+"("+t+ae(")",e.internalWhitespace);return ae(r,e.leadingWhitespace)}case R.CELL_REFERENCE:return ae(e.reference.hash(!0),e.leadingWhitespace);case R.COLUMN_RANGE:case R.ROW_RANGE:case R.CELL_RANGE:{const t=e.start.hash(e.sheetReferenceType!==Dt.RELATIVE),r=e.end.hash(e.sheetReferenceType===Dt.BOTH_ABSOLUTE);return ae(t+":"+r,e.leadingWhitespace)}case R.MINUS_UNARY_OP:return ae("-"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case R.PLUS_UNARY_OP:return ae("+"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case R.PERCENT_OP:return this.computeHashOfAstNode(e.value)+ae("%",e.leadingWhitespace);case R.ERROR:{const t=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:E.ERROR);return ae(t,e.leadingWhitespace)}case R.ERROR_WITH_RAW_INPUT:return ae(e.rawInput,e.leadingWhitespace);case R.ARRAY:{const t=e.args.map(r=>r.map(n=>this.computeHashOfAstNode(n)).join(",")).join(";");return ae("{"+t+ae("}",e.internalWhitespace),e.leadingWhitespace)}case R.PARENTHESIS:{const r="("+this.computeHashOfAstNode(e.expression)+ae(")",e.internalWhitespace);return ae(r,e.leadingWhitespace)}default:return this.computeHashOfAstNode(e.left)+ae(Hh[e.type],e.leadingWhitespace)+this.computeHashOfAstNode(e.right)}}bindWhitespacesToTokens(e){const t=[],r=e[0];ge(r,this.lexerConfig.WhiteSpace)||t.push(r);for(let n=1;n<e.length;++n){const i=e[n];if(ge(i,this.lexerConfig.WhiteSpace))continue;const a=e[n-1];ge(a,this.lexerConfig.WhiteSpace)&&(i.leadingWhitespace=a),t.push(i)}return t}tokenizeFormula(e){return this.lexer.tokenizeFormula(e)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Dn=(s,e,t,r)=>{switch(s.type){case R.EMPTY:case R.NUMBER:case R.STRING:case R.ERROR:return;case R.NAMED_EXPRESSION:{r&&t.push(new Dr(s.expressionName));return}case R.CELL_REFERENCE:{r&&t.push(new id(s.reference));return}case R.CELL_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new UN(s.start,s.end));return}case R.COLUMN_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new PN(s.start,s.end));return}case R.ROW_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new DN(s.start,s.end));return}case R.PERCENT_OP:case R.PLUS_UNARY_OP:case R.MINUS_UNARY_OP:{Dn(s.value,e,t,!0);return}case R.CONCATENATE_OP:case R.EQUALS_OP:case R.NOT_EQUAL_OP:case R.LESS_THAN_OP:case R.GREATER_THAN_OP:case R.LESS_THAN_OR_EQUAL_OP:case R.GREATER_THAN_OR_EQUAL_OP:case R.MINUS_OP:case R.PLUS_OP:case R.TIMES_OP:case R.DIV_OP:case R.POWER_OP:Dn(s.left,e,t,!0),Dn(s.right,e,t,!0);return;case R.PARENTHESIS:Dn(s.expression,e,t,r);return;case R.FUNCTION_CALL:{const n=!e.doesFunctionNeedArgumentToBeComputed(s.procedureName);s.args.forEach(i=>Dn(i,e,t,n));return}}},xa=(s,e)=>{const t=new Array;return Dn(s,e,t,!0),t};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class id{constructor(e){this.dependency=e}absolutize(e){return this.dependency.toSimpleCellAddress(e)}}class UN{constructor(e,t){this.start=e,this.end=t}absolutize(e){return new B(this.start.toSimpleCellAddress(e),this.end.toSimpleCellAddress(e))}}class PN{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleColumnAddress(e),r=this.end.toSimpleColumnAddress(e);return new Vr(t.sheet,t.col,r.col)}}class DN{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleRowAddress(e),r=this.end.toSimpleRowAddress(e);return new Br(t.sheet,t.row,r.row)}}class Dr{constructor(e){this.name=e}absolutize(e){return this}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Tr=(s,e)=>s.map(t=>t.absolutize(e)),VN=s=>s.filter(e=>e instanceof Dr?!0:e instanceof B?!(Ct(e.start)||Ct(e.end)):!Ct(e));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Z=Symbol("Empty value");function b(s){return s instanceof xr?s.val:s}class xr{constructor(e,t){this.val=e,this.format=t}fromNumber(e){return new this.constructor(e)}}function pu(s,e){if(typeof s=="number")return e;{const t=s.fromNumber(e);return t.format=s.format,t}}class mu extends xr{getDetailedType(){return D.NUMBER_DATE}}class To extends xr{getDetailedType(){return D.NUMBER_CURRENCY}}class gu extends xr{getDetailedType(){return D.NUMBER_TIME}}class Eu extends xr{getDetailedType(){return D.NUMBER_DATETIME}}class _i extends xr{getDetailedType(){return D.NUMBER_PERCENT}}function ue(s){return typeof s=="number"||s instanceof xr}var D;(function(s){s.NUMBER_RAW="NUMBER_RAW",s.NUMBER_DATE="NUMBER_DATE",s.NUMBER_TIME="NUMBER_TIME",s.NUMBER_DATETIME="NUMBER_DATETIME",s.NUMBER_CURRENCY="NUMBER_CURRENCY",s.NUMBER_PERCENT="NUMBER_PERCENT"})(D||(D={}));function BN(s){return s instanceof xr?s.getDetailedType():D.NUMBER_RAW}function kN(s){if(s instanceof xr)return s.format}function ta(s){return s instanceof xr?{type:s.getDetailedType(),format:s.format}:{type:D.NUMBER_RAW}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class F{constructor(e,t,r,n){this._data=e,this.range=t,this.dependencyGraph=r,this._hasOnlyNumbers=n,this.size=e===void 0?new X(t.effectiveWidth(r),t.effectiveHeight(r)):new X(e[0].length,e.length)}get data(){return this.ensureThatComputed(),this._data}static fromRange(e,t,r){return new F(e,t,r,!0)}static onlyNumbers(e){return new F(e,void 0,void 0,!0)}static onlyValues(e){return new F(e,void 0,void 0,void 0)}static onlyRange(e,t){return new F(void 0,e,t,void 0)}static fromScalar(e){return new F([[e]],void 0,void 0,void 0)}isAdHoc(){return this.range===void 0}width(){return this.size.width}height(){return this.size.height}valuesFromTopLeftCorner(){this.ensureThatComputed();const e=[];for(let t=0;t<this._data.length;t++)for(let r=0;r<this._data[0].length;r++)e.push(this._data[t][r]);return e}*effectiveAddressesFromData(e){for(let t=0;t<this.data.length;++t){const r=this.data[t];for(let n=0;n<r.length;++n)yield x(e.sheet,e.col+n,e.row+t)}}*entriesFromTopLeftCorner(e){this.ensureThatComputed();for(let t=0;t<this.size.height;++t)for(let r=0;r<this.size.width;++r)yield[this._data[t][r],x(e.sheet,e.col+r,e.row+t)]}*iterateValuesFromTopLeftCorner(){yield*this.valuesFromTopLeftCorner()}numberOfElements(){return this.size.width*this.size.height}hasOnlyNumbers(){if(this._hasOnlyNumbers===void 0){this._hasOnlyNumbers=!0;for(const e of this.data)for(const t of e)if(typeof t!="number")return this._hasOnlyNumbers=!1,!1}return this._hasOnlyNumbers}rawNumbers(){return this._data}rawData(){var e;return this.ensureThatComputed(),(e=this._data)!==null&&e!==void 0?e:[]}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}ensureThatComputed(){this._data===void 0&&(this._hasOnlyNumbers=!0,this._data=this.range.addressesArrayMap(this.dependencyGraph,e=>{const t=this.dependencyGraph.getCellValue(e);return t instanceof F?(this._hasOnlyNumbers=!1,new m(E.VALUE,y.ScalarExpected)):(ue(t)||(this._hasOnlyNumbers=!1),t)}))}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class rn{constructor(){this.changes=new Map}static empty(){return new rn}addAll(e){for(const t of e.changes.values())this.add(t.address,t);return this}addChange(e,t,r){this.addInterpreterValue(e,t,r)}exportChanges(e){let t=[];return this.changes.forEach(r=>{const n=e.exportChange(r);Array.isArray(n)?t=t.concat(n):t.push(n)}),t}getChanges(){return Array.from(this.changes.values())}isEmpty(){return this.changes.size===0}add(e,t){const r=t.value;if(r instanceof F)for(const n of r.effectiveAddressesFromData(e))this.changes.delete(xs(n));this.changes.set(xs(e),t)}addInterpreterValue(e,t,r){this.add(t,{address:t,value:e,oldValue:r})}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class It{constructor(e,t,r){if(this.sheet=e,this.rowStart=t,this.rowEnd=r,t<0)throw Error("Starting row cant be less than 0");if(r<t)throw Error("Row span cant end before start")}get numberOfRows(){return this.rowEnd-this.rowStart+1}get start(){return this.rowStart}get end(){return this.rowEnd}static fromNumberOfRows(e,t,r){return new It(e,t,t+r-1)}static fromRowStartAndEnd(e,t,r){return new It(e,t,r)}*rows(){for(let e=this.rowStart;e<=this.rowEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.rowStart,e.rowStart),r=Math.min(this.rowEnd,e.rowEnd);return t>r?null:new It(this.sheet,t,r)}firstRow(){return new It(this.sheet,this.rowStart,this.rowStart)}}class Vt{constructor(e,t,r){if(this.sheet=e,this.columnStart=t,this.columnEnd=r,t<0)throw Error("Starting column cant be less than 0");if(r<t)throw Error("Column span cant end before start")}get numberOfColumns(){return this.columnEnd-this.columnStart+1}get start(){return this.columnStart}get end(){return this.columnEnd}static fromNumberOfColumns(e,t,r){return new Vt(e,t,t+r-1)}static fromColumnStartAndEnd(e,t,r){return new Vt(e,t,r)}*columns(){for(let e=this.columnStart;e<=this.columnEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.columnStart,e.columnStart),r=Math.min(this.columnEnd,e.columnEnd);return t>r?null:new Vt(this.sheet,t,r)}firstColumn(){return new Vt(this.sheet,this.columnStart,this.columnStart)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Y;(function(s){s.BUILD_ENGINE_TOTAL="BUILD_ENGINE_TOTAL",s.PARSER="PARSER",s.GRAPH_BUILD="GRAPH_BUILD",s.COLLECT_DEPENDENCIES="COLLECT_DEPENDENCIES",s.PROCESS_DEPENDENCIES="PROCESS_DEPENDENCIES",s.TOP_SORT="TOP_SORT",s.BUILD_COLUMN_INDEX="BUILD_COLUMN_INDEX",s.EVALUATION="EVALUATION",s.VLOOKUP="VLOOKUP",s.TRANSFORM_ASTS="TRANSFORM_ASTS",s.TRANSFORM_ASTS_POSTPONED="TRANSFORM_ASTS_POSTPONED",s.ADJUSTING_ADDRESS_MAPPING="ADJUSTING_ADDRESS_MAPPING",s.ADJUSTING_ARRAY_MAPPING="ADJUSTING_ARRAY_MAPPING",s.ADJUSTING_RANGES="ADJUSTING_RANGES",s.ADJUSTING_GRAPH="ADJUSTING_GRAPH",s.CRITERION_FUNCTION_FULL_CACHE_USED="CRITERION_FUNCTION_FULL_CACHE_USED",s.CRITERION_FUNCTION_PARTIAL_CACHE_USED="CRITERION_FUNCTION_PARTIAL_CACHE_USED"})(Y||(Y={}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ad{constructor(){this.stats=new Map([[Y.CRITERION_FUNCTION_FULL_CACHE_USED,0],[Y.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0]]),this.startTimes=new Map}incrementCriterionFunctionFullCacheUsed(){var e;const t=((e=this.stats.get(Y.CRITERION_FUNCTION_FULL_CACHE_USED))!==null&&e!==void 0?e:0)+1;this.stats.set(Y.CRITERION_FUNCTION_FULL_CACHE_USED,t)}incrementCriterionFunctionPartialCacheUsed(){var e;const t=((e=this.stats.get(Y.CRITERION_FUNCTION_PARTIAL_CACHE_USED))!==null&&e!==void 0?e:0)+1;this.stats.set(Y.CRITERION_FUNCTION_PARTIAL_CACHE_USED,t)}reset(){this.stats.clear(),this.startTimes.clear(),this.stats.set(Y.CRITERION_FUNCTION_FULL_CACHE_USED,0),this.stats.set(Y.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0)}start(e){if(this.startTimes.get(e))throw Error(`Statistics ${e} already started`);this.startTimes.set(e,Date.now())}end(e){var t;const r=Date.now(),n=this.startTimes.get(e);if(n){let i=(t=this.stats.get(e))!==null&&t!==void 0?t:0;i+=r-n,this.stats.set(e,i),this.startTimes.delete(e)}else throw Error(`Statistics ${e} not started`)}measure(e,t){this.start(e);const r=t();return this.end(e),r}snapshot(){return new Map(this.stats)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class GN extends ad{incrementCriterionFunctionFullCacheUsed(){}incrementCriterionFunctionPartialCacheUsed(){}start(e){}end(e){}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Oe extends Error{constructor(e){super(`There's no sheet with id = ${e}`)}}class od extends Error{constructor(e){super(`There's no sheet with name '${e}'`)}}class Hs extends Error{constructor(e){super(`Sheet with name ${e} already exists`)}}class vn extends Error{constructor(){super("Sheet size limit exceeded")}}class Li extends Error{constructor(){super("This is not a formula")}}class ud extends Error{constructor(e){super(`Address (row = ${e.row}, col = ${e.col}) is invalid`)}}class We extends Error{constructor(e){super(`Invalid arguments, expected ${e}`)}}class Ws extends Error{constructor(e,t){super(`Sheets ${e} and ${t} are not equal.`)}}class ld extends Error{constructor(e){super(`Name of Named Expression '${e}' is already present`)}}class cd extends Error{constructor(e){super(`Name of Named Expression '${e}' is invalid`)}}class zs extends Error{constructor(e){super(`Named Expression '${e}' does not exist`)}}class hd extends Error{constructor(){super("There is no operation to undo")}}class dd extends Error{constructor(){super("There is no operation to redo")}}class fd extends Error{constructor(){super("There is nothing to paste")}}function HN(s,e){switch(typeof e){case"function":case"symbol":return e.toString();case"bigint":return"BigInt("+e.toString()+")";default:return e instanceof RegExp?"RegExp("+e.toString()+")":e}}class pd extends Error{constructor(e){super(`Unable to parse value: ${JSON.stringify(e,HN,4)}`)}}class oe extends Error{constructor(e,t){super(`Expected value of type: ${e} for config parameter: ${t}`)}}class WN extends Error{constructor(e){super(`Config parameter ${e} cannot be empty.`)}}class md extends Error{constructor(e,t){super(`Config parameter ${e} should be at least ${t}`)}}class gd extends Error{constructor(e,t){super(`Config parameter ${e} should be at most ${t}`)}}class Ed extends Error{constructor(e,t){super(`Expected one of ${e} for config parameter: ${t}`)}}class Rd extends Error{constructor(){super("Computations are suspended")}}class Vn extends Error{constructor(e){super(`Translation for ${e} is missing in the translation package you're using.`)}}class Nd extends Error{constructor(e){super(`Cannot register translation for function with id: ${e}`)}}class vo extends Error{constructor(){super("Language not registered.")}}class yd extends Error{constructor(){super("Language already registered.")}}class es extends Error{static functionNotDeclaredInPlugin(e,t){return new es(`Function with id ${e} not declared in plugin ${t}`)}static functionMethodNotFound(e,t){return new es(`Function method ${e} not found in plugin ${t}`)}}class Sn extends Error{static cannotRegisterFunctionWithId(e){return new Sn(`Cannot register function with id ${e}`)}static cannotUnregisterFunctionWithId(e){return new Sn(`Cannot unregister function with id ${e}`)}static cannotUnregisterProtectedPlugin(){return new Sn("Cannot unregister protected plugin")}}class zn extends Error{constructor(){super("Cannot perform this operation, source location has an array inside.")}}class ra extends Error{constructor(){super("Cannot perform this operation, target location has an array inside.")}}class Ru extends Error{constructor(){super("Relative addresses not allowed in named expressions.")}}class zN extends Error{constructor(e,t){super(`Alias id ${e} in plugin ${t} already defined as a function or alias.`)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class YN{constructor(e){this.policy=e,this.mapping=new Map}getCell(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new Oe(e.sheet);return t.getCell(e)}fetchCell(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new Oe(e.sheet);const r=t.getCell(e);if(!r)throw Error("Vertex for address missing in AddressMapping");return r}strategyFor(e){const t=this.mapping.get(e);if(t===void 0)throw new Oe(e);return t}addSheet(e,t){if(this.mapping.has(e))throw Error("Sheet already added");this.mapping.set(e,t)}autoAddSheet(e,t){const{height:r,width:n,fill:i}=t,a=this.policy.call(i);this.addSheet(e,new a(n,r))}getCellValue(e){const t=this.getCell(e);return t===void 0?Z:t instanceof ke?t.getArrayCellValue(e):t.getCellValue()}getRawValue(e){const t=this.getCell(e);return t instanceof nn?t.getValues().rawValue:t instanceof ke?t.getArrayCellRawValue(e):null}setCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized");r.setCell(e,t)}moveCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized.");if(e.sheet!==t.sheet)throw Error("Cannot move cells between sheets.");if(r.has(t))throw new Error("Cannot move cell. Destination already occupied.");const n=r.getCell(e);if(n===void 0)throw new Error("Cannot move cell. No cell with such address.");this.setCell(t,n),this.removeCell(e)}removeCell(e){const t=this.mapping.get(e.sheet);if(!t)throw Error("Sheet not initialized");t.removeCell(e)}has(e){const t=this.mapping.get(e.sheet);return t===void 0?!1:t.has(e)}getHeight(e){const t=this.mapping.get(e);if(t===void 0)throw new Oe(e);return t.getHeight()}getWidth(e){const t=this.mapping.get(e);if(!t)throw new Oe(e);return t.getWidth()}addRows(e,t,r){const n=this.mapping.get(e);if(n===void 0)throw new Oe(e);n.addRows(t,r)}removeRows(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new Oe(e.sheet);t.removeRows(e)}removeSheet(e){this.mapping.delete(e)}addColumns(e,t,r){const n=this.mapping.get(e);if(n===void 0)throw new Oe(e);n.addColumns(t,r)}removeColumns(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new Oe(e.sheet);t.removeColumns(e)}*verticesFromRowsSpan(e){yield*this.mapping.get(e.sheet).verticesFromRowsSpan(e)}*verticesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).verticesFromColumnsSpan(e)}*entriesFromRowsSpan(e){yield*this.mapping.get(e.sheet).entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).entriesFromColumnsSpan(e)}*entries(){for(const[e,t]of this.mapping.entries())yield*t.getEntries(e)}*sheetEntries(e){const t=this.mapping.get(e);if(t!==void 0)yield*t.getEntries(e);else throw new Oe(e)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class jN{constructor(){this.arrayMapping=new Map}getArray(e){const t=this.getArrayByCorner(e.start);if(t?.getRange().sameAs(e))return t}getArrayByCorner(e){return this.arrayMapping.get(xs(e))}setArray(e,t){this.arrayMapping.set(xs(e.start),t)}removeArray(e){typeof e=="string"?this.arrayMapping.delete(e):this.arrayMapping.delete(xs(e.start))}count(){return this.arrayMapping.size}*arraysInRows(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetRows(e.sheet,e.rowStart,e.rowEnd)&&(yield[t,r])}*arraysInCols(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetColumn(e.sheet,e.columnStart,e.columnEnd)&&(yield[t,r])}isFormulaArrayInRow(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetRows(e,t))return!0;return!1}isFormulaArrayInAllRows(e){let t=!0;for(const r of e.rows())this.isFormulaArrayInRow(e.sheet,r)||(t=!1);return t}isFormulaArrayInColumn(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetColumn(e,t))return!0;return!1}isFormulaArrayInAllColumns(e){let t=!0;for(const r of e.columns())this.isFormulaArrayInColumn(e.sheet,r)||(t=!1);return t}isFormulaArrayInRange(e){for(const t of this.arrayMapping.values())if(t.getRange().doesOverlap(e))return!0;return!1}isFormulaArrayAtAddress(e){for(const t of this.arrayMapping.values())if(t.getRange().addressInRange(e))return!0;return!1}moveArrayVerticesAfterRowByRows(e,t,r){this.updateArrayVerticesInSheet(e,(n,i)=>{const a=i.getRange();return t<=a.start.row?[a.shifted(0,r),i]:void 0})}moveArrayVerticesAfterColumnByColumns(e,t,r){this.updateArrayVerticesInSheet(e,(n,i)=>{const a=i.getRange();return t<=a.start.col?[a.shifted(r,0),i]:void 0})}updateArrayVerticesInSheet(e,t){const r=Array();for(const[n,i]of this.arrayMapping.entries()){if(i.sheet!==e)continue;const a=t(n,i);a!==void 0&&(this.removeArray(n),r.push(a))}r.forEach(([n,i])=>{this.setArray(n,i)})}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ss{constructor(e){this.size=e}width(){return this.size.width}height(){return this.size.height}get(e,t){throw Error("Array not computed yet.")}simpleRangeValue(){throw Error("Array not computed yet.")}}class ts{constructor(e){if(this.size=new X(e.length>0?e[0].length:0,e.length),this.array=e,this.size.width<=0||this.size.height<=0)throw Error("Incorrect array size")}static fromInterpreterValue(e){return e instanceof F?new ts(e.data):new ts([[e]])}simpleRangeValue(){return F.onlyValues(this.array)}addRows(e,t){this.array.splice(e,0,...this.nullArrays(t,this.width())),this.size.height+=t}addColumns(e,t){for(let r=0;r<this.height();r++)this.array[r].splice(e,0,...new Array(t).fill(Z));this.size.width+=t}removeRows(e,t){if(this.outOfBound(0,e)||this.outOfBound(0,t))throw Error("Array index out of bound");const r=t-e+1;this.array.splice(e,r),this.size.height-=r}removeColumns(e,t){if(this.outOfBound(e,0)||this.outOfBound(t,0))throw Error("Array index out of bound");const r=t-e+1;for(const n of this.array)n.splice(e,r);this.size.width-=r}nullArrays(e,t){const r=[];for(let n=0;n<e;++n)r.push(new Array(t).fill(Z));return r}get(e,t){if(this.outOfBound(e,t))throw Error("Array index out of bound");return this.array[t][e]}set(e,t,r){if(this.outOfBound(e,t))throw Error("Array index out of bound");this.array[t][e]=r}width(){return this.size.width}height(){return this.size.height}raw(){return this.array}resize(e){if(this.height()<e.height&&isFinite(e.height)&&this.addRows(this.height(),e.height-this.height()),this.height()>e.height||(this.width()<e.width&&isFinite(e.width)&&this.addColumns(this.width(),e.width-this.width()),this.width()>e.width))throw Error("Resizing to smaller array")}outOfBound(e,t){return e<0||t<0||t>this.size.height-1||e>this.size.width-1}}class Xa{constructor(e,t){this.error=e,this.size=t}get(e,t){return this.error}width(){return this.size.width}height(){return this.size.height}simpleRangeValue(){return this.error}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Bt{constructor(e,t,r){this.formula=e,this.cellAddress=t,this.version=r}get width(){return 1}get height(){return 1}static fromAst(e,t,r,n){return r.isScalar()?new vr(e,t,n):new ke(e,t,r,n)}getFormula(e){return this.ensureRecentData(e),this.formula}ensureRecentData(e){if(this.version!=e.version()){const[t,r,n]=e.applyTransformations(this.formula,this.cellAddress,this.version);this.formula=t,this.cellAddress=r,this.version=n}}getAddress(e){return this.ensureRecentData(e),this.cellAddress}}class ke extends Bt{constructor(e,t,r,n=0){super(e,t,n),r.isRef?this.array=new Xa(new m(E.REF,y.NoSpaceForArrayResult),X.error()):this.array=new Ss(r)}get width(){return this.array.width()}get height(){return this.array.height()}get sheet(){return this.cellAddress.sheet}get leftCorner(){return this.cellAddress}setCellValue(e){if(e instanceof m)return this.setErrorValue(e),e;const t=ts.fromInterpreterValue(e);return t.resize(this.array.size),this.array=t,e}getCellValue(){if(this.array instanceof Ss)throw Error("Array not computed yet.");return this.array.simpleRangeValue()}valueOrUndef(){if(!(this.array instanceof Ss))return this.array.simpleRangeValue()}getArrayCellValue(e){const t=e.col-this.cellAddress.col,r=e.row-this.cellAddress.row;try{return this.array.get(t,r)}catch{return new m(E.REF)}}getArrayCellRawValue(e){const t=this.getArrayCellValue(e);if(!(t instanceof m||t===Z))return b(t)}setArrayCellValue(e,t){const r=e.col-this.cellAddress.col,n=e.row-this.cellAddress.row;this.array instanceof ts&&this.array.set(r,n,t)}setNoSpace(){return this.array=new Xa(new m(E.SPILL,y.NoSpaceForArrayResult),X.error()),this.getCellValue()}getRange(){return B.spanFrom(this.cellAddress,this.width,this.height)}getRangeOrUndef(){return B.spanFromOrUndef(this.cellAddress,this.width,this.height)}setAddress(e){this.cellAddress=e}setFormula(e){this.formula=e}spansThroughSheetRows(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.row<=r&&t<this.cellAddress.row+this.height}spansThroughSheetColumn(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.col<=r&&t<this.cellAddress.col+this.width}isComputed(){return!(this.array instanceof Ss)}columnsFromArray(){return Vt.fromNumberOfColumns(this.cellAddress.sheet,this.cellAddress.col,this.width)}rowsFromArray(){return It.fromNumberOfRows(this.cellAddress.sheet,this.cellAddress.row,this.height)}ensureRecentData(e){}isLeftCorner(e){return js(this.cellAddress,e)}setErrorValue(e){this.array=new Xa(e,this.array.size)}}class vr extends Bt{constructor(e,t,r){super(e,t,r)}valueOrUndef(){return this.cachedCellValue}setCellValue(e){return this.cachedCellValue=e,this.cachedCellValue}getCellValue(){if(this.cachedCellValue!==void 0)return this.cachedCellValue;throw Error("Value of the formula cell is not computed.")}isComputed(){return this.cachedCellValue!==void 0}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pt{constructor(e){this.range=e,this.functionCache=new Map,this.criterionFunctionCache=new Map,this.dependentCacheRanges=new Set,this.bruteForce=!1}get start(){return this.range.start}get end(){return this.range.end}get sheet(){return this.range.start.sheet}getFunctionValue(e){return this.functionCache.get(e)}setFunctionValue(e,t){this.functionCache.set(e,t)}getCriterionFunctionValue(e,t){var r;return(r=this.getCriterionFunctionValues(e).get(t))===null||r===void 0?void 0:r[0]}getCriterionFunctionValues(e){var t;return(t=this.criterionFunctionCache.get(e))!==null&&t!==void 0?t:new Map}setCriterionFunctionValues(e,t){this.criterionFunctionCache.set(e,t)}addDependentCacheRange(e){e!==this&&this.dependentCacheRanges.add(e)}clearCache(){this.functionCache.clear(),this.criterionFunctionCache.clear(),this.dependentCacheRanges.forEach(e=>e.criterionFunctionCache.clear()),this.dependentCacheRanges.clear()}getStart(){return this.start}getEnd(){return this.end}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const $N=(s,e,t,r,n)=>{if(e instanceof pt){const o=e.range.intersectionWith(t);return o!==void 0?Array.from(o.addresses(n)):[]}let i,a;if(e instanceof Bt)i=e.getFormula(r),a=e.getAddress(r);else return[];return xa(i,s).filter(o=>o instanceof id).map(o=>o.dependency.toSimpleCellAddress(a)).filter(o=>t.addressInRange(o))};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Ur;(function(s){s[s.ON_STACK=0]="ON_STACK",s[s.PROCESSED=1]="PROCESSED",s[s.POPPED=2]="POPPED"})(Ur||(Ur={}));class XN{constructor(e=[],t=[]){this.nodesSparseArray=e,this.edgesSparseArray=t,this.entranceTime=[],this.low=[],this.parent=[],this.inSCC=[],this.nodeStatus=[],this.order=[],this.sccNonSingletons=[],this.timeCounter=0}getTopSortedWithSccSubgraphFrom(e,t,r){const n=e.reverse();return n.forEach(i=>this.runDFS(i)),this.postprocess(n,r,t)}getAdjacentNodeIds(e){return this.edgesSparseArray[e].filter(t=>t!==void 0&&this.nodesSparseArray[t])}runDFS(e){if(this.nodeStatus[e]!==void 0)return;this.nodeStatus[e]=Ur.ON_STACK;const t=[e],r=[];for(;t.length>0;){const n=t[t.length-1];switch(this.nodeStatus[n]){case Ur.ON_STACK:{this.handleOnStack(n,r,t);break}case Ur.PROCESSED:{this.handleProcessed(n,r,t);break}case Ur.POPPED:{t.pop();break}}}}handleOnStack(e,t,r){this.entranceTime[e]=this.timeCounter,this.low[e]=this.timeCounter,this.timeCounter++,t.push(e),this.getAdjacentNodeIds(e).forEach(n=>{this.entranceTime[n]===void 0&&(r.push(n),this.parent[n]=e,this.nodeStatus[n]=Ur.ON_STACK)}),this.nodeStatus[e]=Ur.PROCESSED}handleProcessed(e,t,r){let n=this.entranceTime[e];if(this.getAdjacentNodeIds(e).forEach(i=>{this.inSCC[i]||(n=this.parent[i]===e?Math.min(n,this.low[i]):Math.min(n,this.entranceTime[i]))}),this.low[e]=n,n===this.entranceTime[e]){const i=[];do i.push(t[t.length-1]),t.pop();while(i[i.length-1]!==e);i.forEach(a=>{this.inSCC[a]=!0}),this.order.push(...i),i.length>1&&i.forEach(a=>{this.sccNonSingletons[a]=!0})}r.pop(),this.nodeStatus[e]=Ur.POPPED}postprocess(e,t,r){const n=[];e.forEach(o=>{n[o]=!0});const i=[],a=[];return this.order.reverse(),this.order.forEach(o=>{const u=this.getAdjacentNodeIds(o);this.sccNonSingletons[o]||u.includes(o)?(a.push(this.nodesSparseArray[o]),t(this.nodesSparseArray[o]),u.forEach(l=>n[l]=!0)):(i.push(this.nodesSparseArray[o]),n[o]&&r(this.nodesSparseArray[o])&&u.forEach(l=>n[l]=!0))}),{sorted:i,cycled:a}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class KN{constructor(e,t){this.rawValue=e,this.processFn=t,this.processedValue=null}getProcessedValue(){return this.processedValue===null&&(this.processedValue=this.processFn(this.rawValue)),this.processedValue}markAsModified(){this.processedValue=null}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class qN{constructor(e){this.dependencyQuery=e,this.nodesSparseArray=[],this.edgesSparseArray=[],this.nodesIds=new Map,this.dirtyAndVolatileNodeIds=new KN({dirty:[],volatile:[]},t=>this.processDirtyAndVolatileNodeIds(t)),this.infiniteRangeIds=new Set,this.changingWithStructureNodeIds=[],this.nextId=0}getNodes(){return this.nodesSparseArray.filter(e=>e!==void 0)}hasNode(e){return this.nodesIds.has(e)}existsEdge(e,t){const r=this.getNodeId(e),n=this.getNodeId(t);return r===void 0||n===void 0?!1:this.edgesSparseArray[r].includes(n)}adjacentNodes(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);return new Set(this.edgesSparseArray[t].filter(r=>r!==void 0).map(r=>this.nodesSparseArray[r]))}adjacentNodesCount(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);return this.fixEdgesArrayForNode(t).length}addNodeAndReturnId(e){const t=this.nodesIds.get(e);if(t!==void 0)return t;const r=this.nextId;return this.nextId++,this.nodesSparseArray[r]=e,this.edgesSparseArray[r]=[],this.nodesIds.set(e,r),r}addEdge(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0)throw this.missingNodeError(e);if(n===void 0)throw this.missingNodeError(t);this.edgesSparseArray[r].includes(n)||this.edgesSparseArray[r].push(n)}removeNode(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);this.edgesSparseArray[t].length>0&&(this.edgesSparseArray[t].forEach(n=>this.dirtyAndVolatileNodeIds.rawValue.dirty.push(n)),this.dirtyAndVolatileNodeIds.markAsModified());const r=this.removeDependencies(e);return delete this.nodesSparseArray[t],delete this.edgesSparseArray[t],this.infiniteRangeIds.delete(t),this.nodesIds.delete(e),r}removeEdge(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0)throw this.missingNodeError(e);if(n===void 0)throw this.missingNodeError(t);const i=this.edgesSparseArray[r].indexOf(n);if(i===-1)throw new Error("Edge does not exist");delete this.edgesSparseArray[r][i]}removeEdgeIfExists(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0||n===void 0)return;const i=this.edgesSparseArray[r].indexOf(n);i!==-1&&delete this.edgesSparseArray[r][i]}topSortWithScc(){return this.getTopSortedWithSccSubgraphFrom(this.getNodes(),()=>!0,()=>{})}getTopSortedWithSccSubgraphFrom(e,t,r){const n=new XN(this.nodesSparseArray,this.edgesSparseArray),i=e.map(a=>this.getNodeId(a)).filter(a=>a!==void 0);return n.getTopSortedWithSccSubgraphFrom(i,t,r)}markNodeAsVolatile(e){const t=this.getNodeId(e);t!==void 0&&(this.dirtyAndVolatileNodeIds.rawValue.volatile.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsDirty(e){const t=this.getNodeId(e);t!==void 0&&(this.dirtyAndVolatileNodeIds.rawValue.dirty.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}getDirtyAndVolatileNodes(){return this.dirtyAndVolatileNodeIds.getProcessedValue()}clearDirtyNodes(){this.dirtyAndVolatileNodeIds.rawValue.dirty=[],this.dirtyAndVolatileNodeIds.markAsModified()}markNodeAsChangingWithStructure(e){const t=this.getNodeId(e);t!==void 0&&this.changingWithStructureNodeIds.push(t)}markChangingWithStructureNodesAsDirty(){this.changingWithStructureNodeIds.length<=0||(this.dirtyAndVolatileNodeIds.rawValue.dirty=[...this.dirtyAndVolatileNodeIds.rawValue.dirty,...this.changingWithStructureNodeIds],this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsInfiniteRange(e){const t=this.getNodeIdIfNotNumber(e);t!==void 0&&this.infiniteRangeIds.add(t)}getInfiniteRanges(){return[...this.infiniteRangeIds].map(e=>({node:this.nodesSparseArray[e],id:e}))}getNodeId(e){return this.nodesIds.get(e)}getNodeIdIfNotNumber(e){return typeof e=="number"?e:this.nodesIds.get(e)}fixEdgesArrayForNode(e){const t=this.edgesSparseArray[e];return this.edgesSparseArray[e]=t.filter(r=>r!==void 0&&this.nodesSparseArray[r]),this.edgesSparseArray[e]}removeDependencies(e){const t=this.dependencyQuery(e);return t.forEach(([r,n])=>{this.removeEdgeIfExists(n,e)}),t}processDirtyAndVolatileNodeIds({dirty:e,volatile:t}){return[...new Set([...e,...t])].map(r=>this.nodesSparseArray[r]).filter(r=>r!==void 0)}missingNodeError(e){return new Error(`Unknown node ${e}`)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class QN{constructor(){this.rangeMapping=new Map}getMappingSize(e){var t,r;return(r=(t=this.rangeMapping.get(e))===null||t===void 0?void 0:t.size)!==null&&r!==void 0?r:0}setRange(e){let t=this.rangeMapping.get(e.getStart().sheet);t===void 0&&(t=new Map,this.rangeMapping.set(e.getStart().sheet,t));const r=Fi(e.getStart(),e.getEnd());t.set(r,e)}removeRange(e){const t=e.getStart().sheet,r=this.rangeMapping.get(t);if(r===void 0)return;const n=Fi(e.getStart(),e.getEnd());r.delete(n),r.size===0&&this.rangeMapping.delete(t)}getRange(e,t){const r=this.rangeMapping.get(e.sheet),n=Fi(e,t);return r?.get(n)}fetchRange(e,t){const r=this.getRange(e,t);if(!r)throw Error("Range does not exist");return r}truncateRanges(e,t){const r=Array(),n=Array(),i=Array(),a=e.sheet;for(const[u,l]of this.entriesFromSheet(e.sheet)){const h=l.range;e.start<=t(l.range.end)&&(h.removeSpan(e),h.shouldBeRemoved()?(this.removeByKey(a,u),r.push(l)):n.push([u,l]),i.push(l))}const o=[];n.sort((u,l)=>JN(u[1],l[1],t));for(const[u,l]of n){const h=ZN(l.range);if(h===u)continue;const d=this.getByKey(a,h);this.removeByKey(a,u),d!==void 0&&l!=d?o.push([d,l]):this.setRange(l)}return{verticesToRemove:r,verticesToMerge:o,verticesWithChangedSize:i}}moveAllRangesInSheetAfterRowByRows(e,t,r){return this.updateVerticesFromSheet(e,(n,i)=>t<=i.start.row?(i.range.shiftByRows(r),{changedSize:!1,vertex:i}):t>i.start.row&&t<=i.end.row?(i.range.expandByRows(r),{changedSize:!0,vertex:i}):void 0)}moveAllRangesInSheetAfterColumnByColumns(e,t,r){return this.updateVerticesFromSheet(e,(n,i)=>t<=i.start.col?(i.range.shiftByColumns(r),{changedSize:!1,vertex:i}):t>i.start.col&&t<=i.end.col?(i.range.expandByColumns(r),{changedSize:!0,vertex:i}):void 0)}moveRangesInsideSourceRange(e,t,r,n){this.updateVerticesFromSheet(e.sheet,(i,a)=>{if(e.containsRange(a.range))return a.range.shiftByColumns(t),a.range.shiftByRows(r),a.range.moveToSheet(n),{changedSize:!1,vertex:a}})}removeRangesInSheet(e){if(this.rangeMapping.has(e)){const t=this.rangeMapping.get(e).values();return this.rangeMapping.delete(e),t}return[][Symbol.iterator]()}*rangesInSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.values())}*rangeVerticesContainedInRange(e){for(const t of this.rangesInSheet(e.sheet))e.containsRange(t.range)&&(yield t)}findSmallerRange(e){if(e.height()>1&&Number.isFinite(e.height())){const t=x(e.end.sheet,e.end.col,e.end.row-1),r=this.getRange(e.start,t);if(r!==void 0){const n=B.fromSimpleCellAddresses(x(e.start.sheet,e.start.col,e.end.row),e.end);return{smallerRangeVertex:r,restRange:n}}}return{restRange:e}}*entriesFromSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.entries())}removeByKey(e,t){this.rangeMapping.get(e).delete(t)}getByKey(e,t){var r;return(r=this.rangeMapping.get(e))===null||r===void 0?void 0:r.get(t)}updateVerticesFromSheet(e,t){const r=Array();for(const[n,i]of this.entriesFromSheet(e)){const a=t(n,i);a!==void 0&&(this.removeByKey(e,n),r.push(a))}return r.forEach(n=>{this.setRange(n.vertex)}),{verticesWithChangedSize:r.filter(n=>n.changedSize).map(n=>n.vertex)}}}function Fi(s,e){return`${s.col},${s.row},${e.col},${e.row}`}function ZN(s){return Fi(s.start,s.end)}const JN=(s,e,t)=>{const r=t(s.range.start),n=t(s.range.start);if(r===n){const i=t(s.range.end),a=t(e.range.end);return i-a}else return r-n};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ey{constructor(e,t,r){this.functions=e,this.errors=t,this.ui=r,this._protectedTranslations={VERSION:"VERSION"},this.checkUI(),this.checkErrors(),this.checkFunctionTranslations(this.functions),Object.assign(this.functions,this._protectedTranslations)}extendFunctions(e){this.checkFunctionTranslations(e),Object.assign(this.functions,e)}buildFunctionMapping(){return Object.keys(this.functions).reduce((e,t)=>(e[this.functions[t]]=t,e),{})}buildErrorMapping(){return Object.keys(this.errors).reduce((e,t)=>(e[this.errors[t]]=t,e),{})}isFunctionTranslated(e){return this.functions[e]!==void 0}getFunctionTranslations(e){const t=[];for(const r of e)this.isFunctionTranslated(r)&&t.push(this.functions[r]);return t}getFunctionTranslation(e){const t=this.functions[e];if(t===void 0)throw new Vn(`functions.${e}`);return t}getMaybeFunctionTranslation(e){return this.functions[e]}getErrorTranslation(e){if(e===E.LIC)return`#${E.LIC}!`;const t=this.errors[e];if(t===void 0)throw new Vn(`errors.${e}`);return t}getUITranslation(e){const t=this.ui[e];if(t===void 0)throw new Vn(`ui.${e}`);return t}checkUI(){for(const e of Object.values(Ys))if(!(e in this.ui))throw new Vn(`ui.${e}`)}checkErrors(){for(const e of Object.values(E))if(!(e in this.errors)&&e!==E.LIC)throw new Vn(`errors.${e}`)}checkFunctionTranslations(e){const t=new Set(Object.getOwnPropertyNames(e));for(const r of Object.getOwnPropertyNames(this._protectedTranslations))if(t.has(r))throw new Nd(r)}}function ty(s){return new ey(Object.assign({},s.functions),Object.assign({},s.errors),Object.assign({},s.ui))}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Ys;(function(s){s.NEW_SHEET_PREFIX="NEW_SHEET_PREFIX"})(Ys||(Ys={}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Bn(s){return s.toLowerCase()}class ry{constructor(e,t){this.id=e,this.displayName=t}get canonicalName(){return Bn(this.displayName)}}class ny{constructor(e){this.languages=e,this.mappingFromCanonicalName=new Map,this.mappingFromId=new Map,this.lastSheetId=-1,this.fetch=t=>{const r=this.mappingFromCanonicalName.get(Bn(t));if(r===void 0)throw new od(t);return r.id},this.get=t=>{var r;return(r=this.mappingFromCanonicalName.get(Bn(t)))===null||r===void 0?void 0:r.id},this.fetchDisplayName=t=>this.fetchSheetById(t).displayName,this.sheetNamePrefix=e.getUITranslation(Ys.NEW_SHEET_PREFIX)}addSheet(e=`${this.sheetNamePrefix}${this.lastSheetId+2}`){const t=Bn(e);if(this.mappingFromCanonicalName.has(t))throw new Hs(e);this.lastSheetId++;const r=new ry(this.lastSheetId,e);return this.store(r),r.id}removeSheet(e){const t=this.fetchSheetById(e);e==this.lastSheetId&&--this.lastSheetId,this.mappingFromCanonicalName.delete(t.canonicalName),this.mappingFromId.delete(t.id)}getDisplayName(e){var t;return(t=this.mappingFromId.get(e))===null||t===void 0?void 0:t.displayName}*displayNames(){for(const e of this.mappingFromCanonicalName.values())yield e.displayName}numberOfSheets(){return this.mappingFromCanonicalName.size}hasSheetWithId(e){return this.mappingFromId.has(e)}hasSheetWithName(e){return this.mappingFromCanonicalName.has(Bn(e))}renameSheet(e,t){const r=this.fetchSheetById(e),n=r.displayName;if(n===t)return;const i=this.mappingFromCanonicalName.get(Bn(t));if(i!==void 0&&i.id!==r.id)throw new Hs(t);const a=r.canonicalName;return this.mappingFromCanonicalName.delete(a),r.displayName=t,this.store(r),n}sheetNames(){return Array.from(this.mappingFromId.values()).map(e=>e.displayName)}store(e){this.mappingFromId.set(e.id,e),this.mappingFromCanonicalName.set(e.canonicalName,e)}fetchSheetById(e){const t=this.mappingFromId.get(e);if(t===void 0)throw new Oe(e);return t}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Nu{constructor(e,t,r,n,i,a,o,u){this.addressMapping=e,this.rangeMapping=t,this.sheetMapping=r,this.arrayMapping=n,this.stats=i,this.lazilyTransformingAstService=a,this.functionRegistry=o,this.namedExpressions=u,this.changes=rn.empty(),this.dependencyQueryAddresses=l=>{if(l instanceof pt)return this.rangeDependencyQuery(l).map(([h,d])=>h);{const h=this.formulaDependencyQuery(l);if(h!==void 0){const[d,f]=h;return f.map(p=>p instanceof Dr?this.namedExpressions.namedExpressionOrPlaceholder(p.name,d.sheet).address:_e(p)?p:Ao(p.start,p.end))}else return[]}},this.dependencyQueryVertices=l=>{if(l instanceof pt)return this.rangeDependencyQuery(l);{const h=this.formulaDependencyQuery(l);if(h!==void 0){const[d,f]=h;return f.map(p=>{if(p instanceof B)return[p.start,this.rangeMapping.fetchRange(p.start,p.end)];if(p instanceof Dr){const N=this.namedExpressions.namedExpressionOrPlaceholder(p.name,d.sheet);return[N.address,this.addressMapping.fetchCell(N.address)]}else return[p,this.addressMapping.fetchCell(p)]})}else return[]}},this.rangeDependencyQuery=l=>{const h=[],{smallerRangeVertex:d,restRange:f}=this.rangeMapping.findSmallerRange(l.range);let p;d!==void 0&&this.graph.adjacentNodes(d).has(l)?(p=f,h.push([new B(d.start,d.end),d])):p=l.range;for(const N of p.addresses(this)){const g=this.addressMapping.getCell(N);g!==void 0&&h.push([N,g])}return h},this.formulaDependencyQuery=l=>{let h,d;if(l instanceof Bt)d=l.getAddress(this.lazilyTransformingAstService),h=l.getFormula(this.lazilyTransformingAstService);else return;const f=xa(h,this.functionRegistry);return[d,Tr(f,d)]},this.graph=new qN(this.dependencyQueryVertices)}static buildEmpty(e,t,r,n,i){return new Nu(new YN(t.chooseAddressMappingPolicy),new QN,new ny(t.translationPackage),new jN,i,e,r,n)}setFormulaToCell(e,t,r,n,i,a){const o=Bt.fromAst(t,e,n,this.lazilyTransformingAstService.version());return this.exchangeOrAddFormulaVertex(o),this.processCellDependencies(r,o),this.graph.markNodeAsDirty(o),i&&this.markAsVolatile(o),a&&this.markAsDependentOnStructureChange(o),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setParsingErrorToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);return this.exchangeOrAddGraphNode(r,t),this.addressMapping.setCell(e,t),this.graph.markNodeAsDirty(t),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setValueToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);if(r instanceof ke&&this.arrayMapping.removeArray(r.getRange()),r instanceof nn)r.getValues().rawValue!==t.rawValue&&(r.setValues(t),this.graph.markNodeAsDirty(r));else{const n=new nn(t.parsedValue,t.rawValue);this.exchangeOrAddGraphNode(r,n),this.addressMapping.setCell(e,n),this.graph.markNodeAsDirty(n)}return this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setCellEmpty(e){const t=this.shrinkPossibleArrayAndGetCell(e);if(t===void 0)return rn.empty();if(this.graph.adjacentNodes(t).size>0){const r=new Jr;this.exchangeGraphNode(t,r),this.graph.adjacentNodesCount(r)===0?(this.removeVertex(r),this.addressMapping.removeCell(e)):(this.graph.markNodeAsDirty(r),this.addressMapping.setCell(e,r))}else this.removeVertex(t),this.addressMapping.removeCell(e);return this.getAndClearContentChanges()}clearDirtyVertices(){this.graph.clearDirtyNodes()}verticesToRecompute(){return this.graph.getDirtyAndVolatileNodes()}processCellDependencies(e,t){const r=this.graph.getNodeId(t);e.forEach(n=>{if(n instanceof B){const i=n;let a=this.getRange(i.start,i.end);a===void 0&&(a=new pt(i),this.rangeMapping.setRange(a)),this.graph.addNodeAndReturnId(a);const o=this.graph.getNodeId(a);i.isFinite()||this.graph.markNodeAsInfiniteRange(o);const{smallerRangeVertex:u,restRange:l}=this.rangeMapping.findSmallerRange(i);if(u!==void 0){if(this.graph.addEdge(u,o),a.bruteForce){a.bruteForce=!1;for(const d of i.addresses(this))this.graph.removeEdge(this.fetchCell(d),o)}}else a.bruteForce=!0;const h=this.arrayMapping.getArray(l);if(h!==void 0)this.graph.addEdge(h,o);else for(const d of l.addresses(this)){const{vertex:f,id:p}=this.fetchCellOrCreateEmpty(d);this.graph.addEdge(p??f,o)}this.graph.addEdge(o,r),i.isFinite()&&this.correctInfiniteRangesDependenciesByRangeVertex(a)}else if(n instanceof Dr){const i=t.getAddress(this.lazilyTransformingAstService).sheet,{vertex:a,id:o}=this.fetchNamedExpressionVertex(n.name,i);this.graph.addEdge(o??a,r)}else{const{vertex:i,id:a}=this.fetchCellOrCreateEmpty(n);this.graph.addEdge(a??i,r)}})}fetchNamedExpressionVertex(e,t){const r=this.namedExpressions.namedExpressionOrPlaceholder(e,t);return this.fetchCellOrCreateEmpty(r.address)}exchangeNode(e,t){const r=this.fetchCellOrCreateEmpty(e).vertex,n=this.fetchCellOrCreateEmpty(t).vertex;this.addressMapping.removeCell(e),this.exchangeGraphNode(r,n)}fetchCellOrCreateEmpty(e){const t=this.addressMapping.getCell(e);if(t!==void 0)return{vertex:t,id:void 0};const r=new Jr,n=this.graph.addNodeAndReturnId(r);return this.addressMapping.setCell(e,r),{vertex:r,id:n}}removeRows(e){this.stats.measure(Y.ADJUSTING_GRAPH,()=>{for(const[r,n]of this.addressMapping.entriesFromRowsSpan(e)){for(const i of this.graph.adjacentNodes(n))this.graph.markNodeAsDirty(i);if(n instanceof ke)if(n.isLeftCorner(r))this.shrinkArrayToCorner(n),this.arrayMapping.removeArray(n.getRange());else continue;this.removeVertex(n)}}),this.stats.measure(Y.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeRows(e)});const t=this.stats.measure(Y.ADJUSTING_RANGES,()=>{const r=this.truncateRanges(e,n=>n.row);return this.getArrayVerticesRelatedToRanges(r)});return this.stats.measure(Y.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterRemovingRows(e.sheet,e.rowStart,e.numberOfRows)}),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}removeSheet(e){this.clearSheet(e);for(const[t,r]of this.addressMapping.sheetEntries(e)){for(const n of this.graph.adjacentNodes(r))this.graph.markNodeAsDirty(n);this.removeVertex(r),this.addressMapping.removeCell(t)}this.stats.measure(Y.ADJUSTING_RANGES,()=>{const t=this.rangeMapping.removeRangesInSheet(e);for(const r of t)this.removeVertex(r);this.stats.measure(Y.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeSheet(e)})})}clearSheet(e){const t=new Set;for(const[r,n]of this.addressMapping.sheetEntries(e))n instanceof ke?t.add(n):this.setCellEmpty(r);for(const r of t.values())this.setArrayEmpty(r);this.addStructuralNodesToChangeSet()}removeColumns(e){this.stats.measure(Y.ADJUSTING_GRAPH,()=>{for(const[r,n]of this.addressMapping.entriesFromColumnsSpan(e)){for(const i of this.graph.adjacentNodes(n))this.graph.markNodeAsDirty(i);if(n instanceof ke)if(n.isLeftCorner(r))this.shrinkArrayToCorner(n),this.arrayMapping.removeArray(n.getRange());else continue;this.removeVertex(n)}}),this.stats.measure(Y.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeColumns(e)});const t=this.stats.measure(Y.ADJUSTING_RANGES,()=>{const r=this.truncateRanges(e,n=>n.col);return this.getArrayVerticesRelatedToRanges(r)});return this.stats.measure(Y.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterRemovingColumns(e.sheet,e.columnStart,e.numberOfColumns)),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}addRows(e){this.stats.measure(Y.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addRows(e.sheet,e.rowStart,e.numberOfRows)});const t=this.stats.measure(Y.ADJUSTING_RANGES,()=>{const r=this.rangeMapping.moveAllRangesInSheetAfterRowByRows(e.sheet,e.rowStart,e.numberOfRows);return this.fixRangesWhenAddingRows(e.sheet,e.rowStart,e.numberOfRows),this.getArrayVerticesRelatedToRanges(r.verticesWithChangedSize)});this.stats.measure(Y.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterAddingRow(e.sheet,e.rowStart,e.numberOfRows)});for(const r of this.addressMapping.verticesFromRowsSpan(e))this.graph.markNodeAsDirty(r);return this.addStructuralNodesToChangeSet(),{affectedArrays:t}}addColumns(e){this.stats.measure(Y.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addColumns(e.sheet,e.columnStart,e.numberOfColumns)});const t=this.stats.measure(Y.ADJUSTING_RANGES,()=>{const r=this.rangeMapping.moveAllRangesInSheetAfterColumnByColumns(e.sheet,e.columnStart,e.numberOfColumns);return this.fixRangesWhenAddingColumns(e.sheet,e.columnStart,e.numberOfColumns),this.getArrayVerticesRelatedToRanges(r.verticesWithChangedSize)});this.stats.measure(Y.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterAddingColumn(e.sheet,e.columnStart,e.numberOfColumns));for(const r of this.addressMapping.verticesFromColumnsSpan(e))this.graph.markNodeAsDirty(r);return this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}isThereSpaceForArray(e){const t=e.getRangeOrUndef();if(t===void 0)return!1;for(const r of t.addresses(this)){const n=this.addressMapping.getCell(r);if(n!==void 0&&!(n instanceof Jr)&&n!==e)return!1}return!0}moveCells(e,t,r,n){for(const i of e.addressesWithDirection(t,r,this)){const a=x(n,i.col+t,i.row+r);let o=this.addressMapping.getCell(i);const u=this.addressMapping.getCell(a);if(this.addressMapping.removeCell(i),o!==void 0){this.graph.markNodeAsDirty(o),this.addressMapping.setCell(a,o);let l;for(const h of this.graph.adjacentNodes(o))h instanceof pt&&!e.containsRange(h.range)&&(l=l??this.fetchCellOrCreateEmpty(i).vertex,this.graph.addEdge(l,h),this.graph.removeEdge(o,h));l&&(this.graph.markNodeAsDirty(l),this.addressMapping.setCell(i,l))}if(u!==void 0){o===void 0&&this.addressMapping.removeCell(a);for(const l of this.graph.adjacentNodes(u))o=o??this.fetchCellOrCreateEmpty(a).vertex,this.graph.addEdge(o,l),this.graph.markNodeAsDirty(o);this.removeVertex(u)}}for(const i of this.rangeMapping.rangeVerticesContainedInRange(e))for(const a of this.graph.adjacentNodes(i))if(a instanceof pt&&!e.containsRange(a.range)){this.graph.removeEdge(i,a);for(const o of i.range.addresses(this)){const{vertex:u,id:l}=this.fetchCellOrCreateEmpty(o);this.graph.addEdge(l??u,a),this.addressMapping.setCell(o,u),this.graph.markNodeAsDirty(u)}}this.rangeMapping.moveRangesInsideSourceRange(e,t,r,n)}setArrayEmpty(e){const t=B.spanFrom(e.getAddress(this.lazilyTransformingAstService),e.width,e.height),r=this.graph.adjacentNodes(e);for(const n of t.addresses(this))this.addressMapping.removeCell(n);for(const n of r.values()){const i=$N(this.functionRegistry,n,e.getRange(),this.lazilyTransformingAstService,this);for(const a of i){const{vertex:o,id:u}=this.fetchCellOrCreateEmpty(a);this.graph.addEdge(u??o,n)}i.length>0&&this.graph.markNodeAsDirty(n)}this.removeVertex(e),this.arrayMapping.removeArray(e.getRange())}addVertex(e,t){this.graph.addNodeAndReturnId(t),this.addressMapping.setCell(e,t)}addArrayVertex(e,t){this.graph.addNodeAndReturnId(t),this.setAddressMappingForArrayVertex(t,e)}*arrayFormulaNodes(){for(const e of this.graph.getNodes())e instanceof ke&&(yield e)}*entriesFromRowsSpan(e){yield*this.addressMapping.entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.addressMapping.entriesFromColumnsSpan(e)}fetchCell(e){return this.addressMapping.fetchCell(e)}getCell(e){return this.addressMapping.getCell(e)}getCellValue(e){return this.addressMapping.getCellValue(e)}getRawValue(e){return this.addressMapping.getRawValue(e)}getScalarValue(e){const t=this.addressMapping.getCellValue(e);return t instanceof F?new m(E.VALUE,y.ScalarExpected):t}existsEdge(e,t){return this.graph.existsEdge(e,t)}getSheetId(e){return this.sheetMapping.fetch(e)}getSheetHeight(e){return this.addressMapping.getHeight(e)}getSheetWidth(e){return this.addressMapping.getWidth(e)}getArray(e){return this.arrayMapping.getArray(e)}getRange(e,t){return this.rangeMapping.getRange(e,t)}topSortWithScc(){return this.graph.topSortWithScc()}markAsVolatile(e){this.graph.markNodeAsVolatile(e)}markAsDependentOnStructureChange(e){this.graph.markNodeAsChangingWithStructure(e)}forceApplyPostponedTransformations(){for(const e of this.graph.getNodes())e instanceof vr&&e.ensureRecentData(this.lazilyTransformingAstService)}*rawValuesFromRange(e){for(const t of e.addresses(this)){const r=this.getScalarValue(t);r!==Z&&(yield[b(r),t])}}computeListOfValuesInRange(e){const t=[];for(const r of e.addresses(this)){const n=this.getScalarValue(r);t.push(n)}return t}shrinkArrayToCorner(e){this.cleanAddressMappingUnderArray(e);for(const t of this.adjacentArrayVertices(e)){let r;t instanceof Bt?r=this.formulaDirectDependenciesToArray(t,e):r=this.rangeDirectDependenciesToArray(t,e);let n=!1;for(const[i,a]of r)e.isLeftCorner(i)&&(n=!0),this.graph.addEdge(a,t),this.graph.markNodeAsDirty(a);n||this.graph.removeEdge(e,t)}this.graph.markNodeAsDirty(e)}isArrayInternalCell(e){const t=this.getCell(e);return t instanceof ke&&!t.isLeftCorner(e)}getAndClearContentChanges(){const e=this.changes;return this.changes=rn.empty(),e}getAdjacentNodesAddresses(e){const t=this.graph.adjacentNodes(e),r=[];return t.forEach(n=>{const i=n;i instanceof pt?r.push(Ao(i.start,i.end)):r.push(i.getAddress(this.lazilyTransformingAstService))}),r}exchangeGraphNode(e,t){this.graph.addNodeAndReturnId(t);const r=this.graph.adjacentNodes(e);this.removeVertex(e),r.forEach(n=>{this.graph.hasNode(n)&&this.graph.addEdge(t,n)})}setArray(e,t){this.arrayMapping.setArray(e,t)}correctInfiniteRangesDependency(e){const t=this.graph.getInfiniteRanges().filter(({node:a})=>a.range.addressInRange(e));if(t.length<=0)return;const{vertex:r,id:n}=this.fetchCellOrCreateEmpty(e),i=n??this.graph.getNodeId(r);t.forEach(({id:a})=>{this.graph.addEdge(i,a)})}exchangeOrAddGraphNode(e,t){e?this.exchangeGraphNode(e,t):this.graph.addNodeAndReturnId(t)}getArrayVerticesRelatedToRanges(e){const t=new Set;return e.forEach(r=>{this.graph.hasNode(r)&&this.graph.adjacentNodes(r).forEach(n=>{n instanceof ke&&t.add(n)})}),t}correctInfiniteRangesDependenciesByRangeVertex(e){this.graph.getInfiniteRanges().forEach(({id:t,node:r})=>{const n=e.range.intersectionWith(r.range);n!==void 0&&n.addresses(this).forEach(i=>{const{vertex:a,id:o}=this.fetchCellOrCreateEmpty(i);this.graph.addEdge(o??a,t)})})}cleanAddressMappingUnderArray(e){const t=e.getRange();for(const r of t.addresses(this)){const n=e.getArrayCellValue(r);this.getCell(r)===e?e.isLeftCorner(r)?this.changes.addChange(new m(E.REF),r,n):(this.addressMapping.removeCell(r),this.changes.addChange(Z,r,n)):this.changes.addChange(Z,r,n)}}*formulaDirectDependenciesToArray(e,t){var r;const[,n]=(r=this.formulaDependencyQuery(e))!==null&&r!==void 0?r:[];if(n!==void 0){for(const i of n)if(!(i instanceof Dr||i instanceof B)&&t.getRange().addressInRange(i)){const a=this.fetchCellOrCreateEmpty(i).vertex;yield[i,a]}}}*rangeDirectDependenciesToArray(e,t){const{restRange:r}=this.rangeMapping.findSmallerRange(e.range);for(const n of r.addresses(this))if(t.getRange().addressInRange(n)){const i=this.fetchCellOrCreateEmpty(n).vertex;yield[n,i]}}*adjacentArrayVertices(e){const t=this.graph.adjacentNodes(e);for(const r of t)(r instanceof Bt||r instanceof pt)&&(yield r)}addStructuralNodesToChangeSet(){this.graph.markChangingWithStructureNodesAsDirty()}fixRangesWhenAddingRows(e,t,r){const n=Array.from(this.rangeMapping.rangesInSheet(e));for(const i of n)if(i.range.includesRow(t+r))if(i.bruteForce){const a=i.range.rangeWithSameWidth(t,r);for(const o of a.addresses(this)){const{vertex:u,id:l}=this.fetchCellOrCreateEmpty(o);this.graph.addEdge(l??u,i)}}else{let a=i,o=this.rangeMapping.findSmallerRange(a.range);if(o.smallerRangeVertex!==void 0)continue;for(;o.smallerRangeVertex===void 0;){const u=new pt(B.spanFrom(a.range.start,a.range.width(),a.range.height()-1));this.rangeMapping.setRange(u),this.graph.addNodeAndReturnId(u);const l=new B(x(a.range.start.sheet,a.range.start.col,a.range.end.row),a.range.end);this.addAllFromRange(l,a),this.graph.addEdge(u,a),a=u,o=this.rangeMapping.findSmallerRange(a.range)}this.graph.addEdge(o.smallerRangeVertex,a),this.addAllFromRange(o.restRange,a),this.graph.removeEdge(o.smallerRangeVertex,i)}}addAllFromRange(e,t){for(const r of e.addresses(this)){const{vertex:n,id:i}=this.fetchCellOrCreateEmpty(r);this.graph.addEdge(i??n,t)}}fixRangesWhenAddingColumns(e,t,r){for(const n of this.rangeMapping.rangesInSheet(e))if(n.range.includesColumn(t+r)){let i;n.bruteForce?i=n.range.rangeWithSameHeight(t,r):i=B.spanFrom(x(e,t,n.range.end.row),r,1);for(const a of i.addresses(this)){const{vertex:o,id:u}=this.fetchCellOrCreateEmpty(a);this.graph.addEdge(u??o,n)}}}exchangeOrAddFormulaVertex(e){const t=e.getAddress(this.lazilyTransformingAstService),r=B.spanFrom(t,e.width,e.height),n=this.shrinkPossibleArrayAndGetCell(t);if(e instanceof ke&&this.setArray(r,e),this.exchangeOrAddGraphNode(n,e),this.addressMapping.setCell(t,e),e instanceof ke){if(!this.isThereSpaceForArray(e))return;for(const i of r.addresses(this)){if(e.isLeftCorner(i))continue;const a=this.getCell(i);this.exchangeOrAddGraphNode(a,e)}}for(const i of r.addresses(this))this.addressMapping.setCell(i,e)}setAddressMappingForArrayVertex(e,t){if(this.addressMapping.setCell(t,e),!(e instanceof ke))return;const r=B.spanFromOrUndef(t,e.width,e.height);if(r!==void 0&&(this.setArray(r,e),!!this.isThereSpaceForArray(e)))for(const n of r.addresses(this))this.addressMapping.setCell(n,e)}truncateRanges(e,t){const{verticesToRemove:r,verticesToMerge:n,verticesWithChangedSize:i}=this.rangeMapping.truncateRanges(e,t);for(const[a,o]of n)this.mergeRangeVertices(a,o);for(const a of r)this.removeVertexAndCleanupDependencies(a);return i}fixArraysAfterAddingRow(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInRows(It.fromRowStartAndEnd(e,t-1,t-1))){const i=n.getRange();for(let a=i.start.col;a<=i.end.col;++a)for(let o=t;o<=i.end.row;++o){const u=x(e,a,o),l=x(e,a,o+r),h=n.getArrayCellValue(u);this.addressMapping.moveCell(l,u),this.changes.addChange(Z,l,h)}}}fixArraysAfterRemovingRows(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,-r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInRows(It.fromRowStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(n))for(const i of n.getRange().addresses(this))this.addressMapping.setCell(i,n);else this.setNoSpaceIfArray(n)}fixArraysAfterAddingColumn(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInCols(Vt.fromColumnStartAndEnd(e,t-1,t-1))){const i=n.getRange();for(let a=i.start.row;a<=i.end.row;++a)for(let o=t;o<=i.end.col;++o){const u=x(e,o,a),l=x(e,o+r,a),h=n.getArrayCellValue(u);this.addressMapping.moveCell(l,u),this.changes.addChange(Z,l,h)}}}fixArraysAfterRemovingColumns(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,-r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInCols(Vt.fromColumnStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(n))for(const i of n.getRange().addresses(this))this.addressMapping.setCell(i,n);else this.setNoSpaceIfArray(n)}shrinkPossibleArrayAndGetCell(e){const t=this.getCell(e);return t instanceof ke?(this.setNoSpaceIfArray(t),this.getCell(e)):t}setNoSpaceIfArray(e){e instanceof ke&&(this.shrinkArrayToCorner(e),e.setNoSpace())}removeVertex(e){this.removeVertexAndCleanupDependencies(e),e instanceof pt&&this.rangeMapping.removeRange(e)}mergeRangeVertices(e,t){const r=this.graph.adjacentNodes(t);this.removeVertexAndCleanupDependencies(t),this.graph.removeEdgeIfExists(e,t),r.forEach(n=>{this.graph.hasNode(n)&&this.graph.addEdge(e,n)})}removeVertexAndCleanupDependencies(e){const t=new Set(this.graph.removeNode(e));for(;t.size>0;){const r=t.values().next().value;t.delete(r);const[n,i]=r;this.graph.hasNode(i)&&this.graph.adjacentNodesCount(i)===0&&((i instanceof pt||i instanceof Jr)&&this.graph.removeNode(i).forEach(a=>t.add(a)),i instanceof pt?this.rangeMapping.removeRange(i):i instanceof Jr&&this.addressMapping.removeCell(n))}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Jr{constructor(){}getCellValue(){return Z}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class nn{constructor(e,t){this.parsedValue=e,this.rawValue=t}getValues(){return{parsedValue:this.parsedValue,rawValue:this.rawValue}}setValues(e){this.parsedValue=e.parsedValue,this.rawValue=e.rawValue}getCellValue(){return this.parsedValue}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Xn{constructor(e,t){this.errors=e,this.rawInput=t}getCellValue(){const e=this.errors.map(t=>t.message).find(t=>t);return m.parsingError(e)}getFormula(){return this.rawInput}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class sy{constructor(e,t){this.width=e,this.height=t,this.mapping=new Map}getCell(e){var t;return(t=this.mapping.get(e.col))===null||t===void 0?void 0:t.get(e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1);let r=this.mapping.get(e.col);r||(r=new Map,this.mapping.set(e.col,r)),r.set(e.row,t)}has(e){var t;return!!(!((t=this.mapping.get(e.col))===null||t===void 0)&&t.get(e.row))}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){var t;(t=this.mapping.get(e.col))===null||t===void 0||t.delete(e.row)}addRows(e,t){this.mapping.forEach(r=>{const n=new Map;r.forEach((i,a)=>{a>=e&&(n.set(a+t,i),r.delete(a))}),n.forEach((i,a)=>{r.set(a,i)})}),this.height+=t}addColumns(e,t){const r=new Map;this.mapping.forEach((n,i)=>{i>=e&&(r.set(i+t,n),this.mapping.delete(i))}),r.forEach((n,i)=>{this.mapping.set(i,n)}),this.width+=t}removeRows(e){this.mapping.forEach(n=>{const i=new Map;n.forEach((a,o)=>{o>=e.rowStart&&(n.delete(o),o>e.rowEnd&&i.set(o-e.numberOfRows,a))}),i.forEach((a,o)=>{n.set(o,a)})});const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){const t=new Map;this.mapping.forEach((i,a)=>{a>=e.columnStart&&(this.mapping.delete(a),a>e.columnEnd&&t.set(a-e.numberOfColumns,i))}),t.forEach((i,a)=>{this.mapping.set(a,i)});const r=Math.min(this.width-1,e.columnEnd),n=Math.max(0,r-e.columnStart+1);this.width=Math.max(0,this.width-n)}*getEntries(e){for(const[t,r]of this.mapping)for(const[n,i]of r)yield[x(e,t,n),i]}*verticesFromColumn(e){const t=this.mapping.get(e);if(t!==void 0)for(const[r,n]of t)yield n}*verticesFromRow(e){for(const t of this.mapping.values()){const r=t.get(e);r!==void 0&&(yield r)}}*verticesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(r!==void 0)for(const[n,i]of r)yield i}}*verticesFromRowsSpan(e){for(const t of this.mapping.values())for(const r of e.rows()){const n=t.get(r);n!==void 0&&(yield n)}}*entriesFromRowsSpan(e){for(const[t,r]of this.mapping.entries())for(const n of e.rows()){const i=r.get(n);i!==void 0&&(yield[x(e.sheet,t,n),i])}}*entriesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(r!==void 0)for(const[n,i]of r.entries())yield[x(e.sheet,t,n),i]}}*vertices(){for(const[e,t]of this.mapping)for(const[r,n]of t)n!==void 0&&(yield n)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class iy{constructor(e,t){this.width=e,this.height=t,this.mapping=new Array(t);for(let r=0;r<t;r++)this.mapping[r]=new Array(e)}getCell(e){return this.getCellVertex(e.col,e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1),this.mapping[e.row]||(this.mapping[e.row]=new Array(this.width)),this.mapping[e.row][e.col]=t}has(e){const t=this.mapping[e.row];return t?!!t[e.col]:!1}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){this.mapping[e.row]!==void 0&&delete this.mapping[e.row][e.col]}addRows(e,t){const r=[];for(let n=0;n<t;n++)r.push(new Array(this.width));this.mapping.splice(e,0,...r),this.height+=t}addColumns(e,t){for(let r=0;r<this.height;r++)this.mapping[r]!==void 0&&this.mapping[r].splice(e,0,...new Array(t));this.width+=t}removeRows(e){this.mapping.splice(e.rowStart,e.numberOfRows);const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){for(let n=0;n<this.height;n++)this.mapping[n]!==void 0&&this.mapping[n].splice(e.columnStart,e.numberOfColumns);const t=Math.min(this.width-1,e.columnEnd),r=Math.max(0,t-e.columnStart+1);this.width=Math.max(0,this.width-r)}*getEntries(e){for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r){const n=this.getCellVertex(r,t);n&&(yield[x(e,r,t),n])}}*verticesFromColumn(e){for(let t=0;t<this.height;++t){const r=this.getCellVertex(e,t);r&&(yield r)}}*verticesFromRow(e){for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}*verticesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const n=this.getCellVertex(t,r);n&&(yield n)}}*verticesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const n=this.getCellVertex(t,r);n&&(yield n)}}*entriesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const n=this.getCellVertex(t,r);n&&(yield[x(e.sheet,t,r),n])}}*entriesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const n=this.getCellVertex(t,r);n&&(yield[x(e.sheet,t,r),n])}}*vertices(){for(let e=0;e<this.height;++e)for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}getCellVertex(e,t){var r;return(r=this.mapping[t])===null||r===void 0?void 0:r[e]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var E;(function(s){s.DIV_BY_ZERO="DIV_BY_ZERO",s.NAME="NAME",s.VALUE="VALUE",s.NUM="NUM",s.NA="NA",s.CYCLE="CYCLE",s.REF="REF",s.SPILL="SPILL",s.LIC="LIC",s.ERROR="ERROR"})(E||(E={}));var vt;(function(s){s.FORMULA="FORMULA",s.VALUE="VALUE",s.ARRAY="ARRAY",s.EMPTY="EMPTY",s.ARRAYFORMULA="ARRAYFORMULA"})(vt||(vt={}));const ay=(s,e)=>s instanceof ke?s.isLeftCorner(e)?vt.ARRAYFORMULA:vt.ARRAY:s instanceof vr||s instanceof Xn?vt.FORMULA:s instanceof nn?vt.VALUE:vt.EMPTY;var na;(function(s){s.EMPTY="EMPTY",s.NUMBER="NUMBER",s.STRING="STRING",s.BOOLEAN="BOOLEAN",s.ERROR="ERROR"})(na||(na={}));var So;(function(s){s.NUMBER="NUMBER"})(So||(So={}));const ur=Object.assign(Object.assign({},na),So),oy=Object.assign(Object.assign({},na),D),Sl=s=>{switch(s){case ur.EMPTY:return 0;case ur.NUMBER:return 1;case ur.STRING:return 2;case ur.BOOLEAN:return 3;case ur.ERROR:return 4}throw new Error("Cell value not computed")},sa=s=>{if(s===Z)return ur.EMPTY;if(s instanceof m||s instanceof F)return ur.ERROR;if(typeof s=="string")return ur.STRING;if(ue(s))return ur.NUMBER;if(typeof s=="boolean")return ur.BOOLEAN;throw new Error("Cell value not computed")},uy=s=>ue(s)?BN(s):sa(s),ly=s=>{if(ue(s))return kN(s)};class m{constructor(e,t,r){this.type=e,this.message=t,this.root=r}static parsingError(e){return new m(E.ERROR,`${y.ParseError}${e?" "+e:""}`)}attachRootVertex(e){return this.root===void 0?new m(this.type,this.message,e):this}}const Td=(s,e)=>({sheet:s,row:e}),cy=s=>s.row<0,vd=(s,e)=>({sheet:s,col:e}),hy=s=>s.col<0,x=(s,e,t)=>({sheet:s,col:e,row:t}),Ct=s=>s.col<0||s.row<0,dy=(s,e,t,r)=>x(e,s.col+t,s.row+r),xs=s=>`${s.sheet},${s.row},${s.col}`;function _e(s){var e,t,r;return s&&(typeof s=="object"||typeof s=="function")&&typeof((e=s)===null||e===void 0?void 0:e.sheet)=="number"&&typeof((t=s)===null||t===void 0?void 0:t.col)=="number"&&typeof((r=s)===null||r===void 0?void 0:r.row)=="number"}const cr=(s,e)=>{var t;return(t=s.sheet)!==null&&t!==void 0?t:e.sheet},js=(s,e)=>s.sheet===e.sheet&&s.col===e.col&&s.row===e.row;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const fy="AbsoluteCellRange: Wrong range size";function Pt(s){if(s&&(typeof s=="object"||typeof s=="function")){const e=s;return"start"in e&&_e(e.start)&&"end"in e&&_e(e.end)}else return!1}const Ao=(s,e)=>({start:s,end:e});class B{constructor(e,t){if(e.sheet!==t.sheet)throw new Ws(e.sheet,t.sheet);this.start=x(e.sheet,e.col,e.row),this.end=x(t.sheet,t.col,t.row)}get sheet(){return this.start.sheet}static fromSimpleCellAddresses(e,t){if(e.sheet!==t.sheet)throw new Ws(e.sheet,t.sheet);const r=t.col-e.col,n=t.row-e.row;return Number.isFinite(n)&&Number.isFinite(r)?new B(e,t):Number.isFinite(n)?new Br(e.sheet,e.row,t.row):new Vr(e.sheet,e.col,t.col)}static fromAst(e,t){return e.type===R.CELL_RANGE?B.fromCellRange(e,t):e.type===R.COLUMN_RANGE?Vr.fromColumnRange(e,t):Br.fromRowRangeAst(e,t)}static fromAstOrUndef(e,t){try{return B.fromAst(e,t)}catch{return}}static fromCellRange(e,t){return new B(e.start.toSimpleCellAddress(t),e.end.toSimpleCellAddress(t))}static spanFrom(e,t,r){const n=B.spanFromOrUndef(e,t,r);if(n===void 0)throw new Error(fy);return n}static spanFromOrUndef(e,t,r){if(!Number.isFinite(t)&&Number.isFinite(r))return e.col!==0?void 0:new Br(e.sheet,e.row,e.row+r-1);if(!Number.isFinite(r)&&Number.isFinite(t))return e.row!==0?void 0:new Vr(e.sheet,e.col,e.col+t-1);if(Number.isFinite(r)&&Number.isFinite(t))return new B(e,x(e.sheet,e.col+t-1,e.row+r-1))}static fromCoordinates(e,t,r,n,i){return new B(x(e,t,r),x(e,n,i))}isFinite(){return Number.isFinite(this.size())}doesOverlap(e){return!(this.start.sheet!=e.start.sheet||this.end.row<e.start.row||this.start.row>e.end.row||this.end.col<e.start.col||this.start.col>e.end.col)}addressInRange(e){return this.sheet!==e.sheet?!1:this.start.row<=e.row&&this.end.row>=e.row&&this.start.col<=e.col&&this.end.col>=e.col}columnInRange(e){return this.sheet!==e.sheet?!1:this.start.col<=e.col&&this.end.col>=e.col}rowInRange(e){return this.sheet!==e.sheet?!1:this.start.row<=e.row&&this.end.row>=e.row}containsRange(e){return this.addressInRange(e.start)&&this.addressInRange(e.end)}intersectionWith(e){if(this.sheet!==e.start.sheet)return;const t=Math.max(this.start.row,e.start.row),r=Math.min(this.end.row,e.end.row),n=Math.max(this.start.col,e.start.col),i=Math.min(this.end.col,e.end.col);if(!(t>r||n>i))return new B(x(this.sheet,n,t),x(this.sheet,i,r))}includesRow(e){return this.start.row<e&&this.end.row>=e}includesColumn(e){return this.start.col<e&&this.end.col>=e}shiftByRows(e){this.start.row+=e,this.end.row+=e}expandByRows(e){this.end.row+=e}shiftByColumns(e){this.start.col+=e,this.end.col+=e}shifted(e,t){return B.spanFrom(x(this.sheet,this.start.col+e,this.start.row+t),this.width(),this.height())}expandByColumns(e){this.end.col+=e}moveToSheet(e){this.start.sheet=e,this.end.sheet=e}removeSpan(e){e instanceof It?this.removeRows(e.start,e.end):this.removeColumns(e.start,e.end)}shouldBeRemoved(){return this.width()<=0||this.height()<=0}rangeWithSameWidth(e,t){return B.spanFrom(x(this.sheet,this.start.col,e),this.width(),t)}rangeWithSameHeight(e,t){return B.spanFrom(x(this.sheet,e,this.start.row),t,this.height())}toString(){return`${this.start.sheet},${this.start.col},${this.start.row},${this.end.col},${this.end.row}`}width(){return this.end.col-this.start.col+1}height(){return this.end.row-this.start.row+1}size(){return this.height()*this.width()}arrayOfAddressesInRange(){const e=[];for(let t=0;t<this.height();++t){e[t]=[];for(let r=0;r<this.width();++r){const n=x(this.sheet,this.start.col+r,this.start.row+t);e[t].push(n)}}return e}withStart(e){return new B(e,this.end)}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}sameAs(e){return js(this.start,e.start)&&js(this.end,e.end)}addressesArrayMap(e,t){const r=[];let n=this.start.row;for(;n<=this.effectiveEndRow(e);){let i=this.start.col;const a=[];for(;i<=this.effectiveEndColumn(e);)a.push(t(x(this.start.sheet,i,n))),i++;r.push(a),n++}return r}addresses(e){const t=[];let r=this.start.row;const n=this.effectiveEndRow(e),i=this.effectiveEndColumn(e);for(;r<=n;){let a=this.start.col;for(;a<=i;)t.push(x(this.start.sheet,a,r)),a++;r++}return t}*addressesWithDirection(e,t,r){if(e>0)if(t>0){let n=this.effectiveEndRow(r);for(;n>=this.start.row;){let i=this.effectiveEndColumn(r);for(;i>=this.start.col;)yield x(this.start.sheet,i,n),i-=1;n-=1}}else{let n=this.start.row;for(;n<=this.effectiveEndRow(r);){let i=this.effectiveEndColumn(r);for(;i>=this.start.col;)yield x(this.start.sheet,i,n),i-=1;n+=1}}else if(t>0){let n=this.effectiveEndRow(r);for(;n>=this.start.row;){let i=this.start.col;for(;i<=this.effectiveEndColumn(r);)yield x(this.start.sheet,i,n),i+=1;n-=1}}else{let n=this.start.row;for(;n<=this.effectiveEndRow(r);){let i=this.start.col;for(;i<=this.effectiveEndColumn(r);)yield x(this.start.sheet,i,n),i+=1;n+=1}}}getAddress(e,t){if(e<0||t<0||t>this.height()-1||e>this.width()-1)throw Error("Index out of bound");return x(this.start.sheet,this.start.col+e,this.start.row+t)}exceedsSheetSizeLimits(e,t){return this.end.col>=e||this.end.row>=t}effectiveEndColumn(e){return this.end.col}effectiveEndRow(e){return this.end.row}effectiveWidth(e){return this.width()}effectiveHeight(e){return this.height()}removeRows(e,t){if(!(e>this.end.row)){if(t<this.start.row){const r=t-e+1;return this.shiftByRows(-r)}e<=this.start.row&&(this.start.row=e),this.end.row-=Math.min(t,this.end.row)-e+1}}removeColumns(e,t){if(!(e>this.end.col)){if(t<this.start.col){const r=t-e+1;return this.shiftByColumns(-r)}e<=this.start.col&&(this.start.col=e),this.end.col-=Math.min(t,this.end.col)-e+1}}}class Vr extends B{constructor(e,t,r){super(x(e,t,0),x(e,r,Number.POSITIVE_INFINITY))}static fromColumnRange(e,t){const r=e.start.toSimpleColumnAddress(t),n=e.end.toSimpleColumnAddress(t);if(r.sheet!==n.sheet)throw new Ws(r.sheet,n.sheet);return new Vr(r.sheet,r.col,n.col)}shouldBeRemoved(){return this.width()<=0}shiftByRows(e){}expandByRows(e){}shifted(e,t){return new Vr(this.sheet,this.start.col+e,this.end.col+e)}rangeWithSameHeight(e,t){return new Vr(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.col>=e}effectiveEndRow(e){return this.effectiveHeight(e)-1}effectiveHeight(e){return e.getSheetHeight(this.sheet)}removeRows(e,t){}}class Br extends B{constructor(e,t,r){super(x(e,0,t),x(e,Number.POSITIVE_INFINITY,r))}static fromRowRangeAst(e,t){const r=e.start.toSimpleRowAddress(t),n=e.end.toSimpleRowAddress(t);if(r.sheet!==n.sheet)throw new Ws(r.sheet,n.sheet);return new Br(r.sheet,r.row,n.row)}shouldBeRemoved(){return this.height()<=0}shiftByColumns(e){}expandByColumns(e){}shifted(e,t){return new Br(this.sheet,this.start.row+t,this.end.row+t)}rangeWithSameWidth(e,t){return new Br(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.row>=t}effectiveEndColumn(e){return this.effectiveWidth(e)-1}effectiveWidth(e){return e.getSheetWidth(this.sheet)}removeColumns(e,t){}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ir{constructor(e,t,r){this.formulaAddress=e,this.arraysFlag=t,this.formulaVertex=r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function py(s){const e=s.caseSensitive?s.accentSensitive?"variant":"case":s.accentSensitive?"accent":"base",t=s.caseFirst,r=s.ignorePunctuation;return new Intl.Collator(s.localeLang,{sensitivity:e,caseFirst:t,ignorePunctuation:r})}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const my="i",gy=/^\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij]))\s*(([+-])\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij])))?$/;class Ey{constructor(e,t,r){this.config=e,this.dateTimeHelper=t,this.numberLiteralsHelper=r,this.lt=(n,i)=>this.compare(n,i)<0,this.leq=(n,i)=>this.compare(n,i)<=0,this.gt=(n,i)=>this.compare(n,i)>0,this.geq=(n,i)=>this.compare(n,i)>=0,this.eq=(n,i)=>this.compare(n,i)===0,this.neq=(n,i)=>this.compare(n,i)!==0,this.pow=(n,i)=>Math.pow(b(n),b(i)),this.addWithEpsilonRaw=(n,i)=>{const a=n+i;return Math.abs(a)<this.actualEps*Math.abs(n)?0:a},this.addWithEpsilon=(n,i)=>{const a=Il(n,i);return this.ExtendedNumberFactory(this.addWithEpsilonRaw(b(n),b(i)),a)},this.unaryMinus=n=>pu(n,-b(n)),this.unaryPlus=n=>n,this.unaryPercent=n=>new _i(b(n)/100),this.concat=(n,i)=>n.concat(i),this.nonstrictadd=(n,i)=>n instanceof m?n:i instanceof m?i:typeof n=="number"?typeof i=="number"?this.addWithEpsilonRaw(n,i):n:typeof i=="number"?i:0,this.subtract=(n,i)=>{const a=Il(n,i),o=b(n),u=b(i);let l=o-u;return Math.abs(l)<this.actualEps*Math.abs(o)&&(l=0),this.ExtendedNumberFactory(l,a)},this.divide=(n,i)=>{const a=b(n),o=b(i);if(o===0)return new m(E.DIV_BY_ZERO);{const u=wl(n,i);return this.ExtendedNumberFactory(a/o,u)}},this.multiply=(n,i)=>{const a=wl(n,i);return this.ExtendedNumberFactory(b(n)*b(i),a)},this.manyToExactComplex=n=>{const i=[];for(const a of n){if(a instanceof m)return a;if(ue(a)||typeof a=="string"){const o=this.coerceScalarToComplex(a);o instanceof m||i.push(o)}}return i},this.coerceNumbersExactRanges=n=>this.manyToNumbers(n,this.manyToExactNumbers),this.coerceNumbersCoerceRangesDropNulls=n=>this.manyToNumbers(n,this.manyToCoercedNumbersDropNulls),this.manyToExactNumbers=n=>{const i=[];for(const a of n){if(a instanceof m)return a;ue(a)&&i.push(b(a))}return i},this.manyToOnlyNumbersDropNulls=n=>{const i=[];for(const a of n){if(a instanceof m)return a;if(ue(a))i.push(b(a));else if(a!==Z)return new m(E.VALUE,y.NumberExpected)}return i},this.manyToCoercedNumbersDropNulls=n=>{const i=[];for(const a of n){if(a instanceof m)return a;if(a===Z)continue;const o=this.coerceScalarToNumberOrError(a);ue(o)&&i.push(b(o))}return i},this.collator=py(e),this.actualEps=e.smartRounding?e.precisionEpsilon:0}eqMatcherFunction(e){const t=this.buildRegex(e);return r=>typeof r=="string"&&t.test(this.normalizeString(r))}neqMatcherFunction(e){const t=this.buildRegex(e);return r=>typeof r!="string"||!t.test(this.normalizeString(r))}searchString(e,t){var r;const i=this.buildRegex(e,!1).exec(t);return(r=i?.index)!==null&&r!==void 0?r:-1}requiresRegex(e){if(!this.config.useRegularExpressions&&!this.config.useWildcards)return!this.config.matchWholeCell;for(let t=0;t<e.length;t++){const r=e.charAt(t);if($s(r)||this.config.useRegularExpressions&&Xs(r))return!0}return!1}floatCmp(e,t){const r=b(e),n=b(t),i=1+this.actualEps;return n>=0&&r*i>=n&&r<=n*i||n<=0&&r*i<=n&&r>=n*i?0:r>n?1:-1}coerceScalarToNumberOrError(e){var t;return e instanceof m?e:(t=this.coerceToMaybeNumber(e))!==null&&t!==void 0?t:new m(E.VALUE,y.NumberCoercion)}coerceToMaybeNumber(e){var t;return(t=this.coerceNonDateScalarToMaybeNumber(e))!==null&&t!==void 0?t:typeof e=="string"?this.dateTimeHelper.dateStringToDateNumber(e):void 0}coerceNonDateScalarToMaybeNumber(e){if(e===Z)return 0;if(typeof e=="string"){if(e==="")return 0;const t=this.coerceStringToMaybePercentNumber(e);if(t!==void 0)return t;const r=this.coerceStringToMaybeCurrencyNumber(e);return r!==void 0?r:this.numberLiteralsHelper.numericStringToMaybeNumber(e.trim())}else return ue(e)?e:typeof e=="boolean"?Number(e):void 0}coerceStringToMaybePercentNumber(e){const t=e.trim();if(t.endsWith("%")){const r=t.slice(0,t.length-1).trim(),n=this.numberLiteralsHelper.numericStringToMaybeNumber(r);if(n!==void 0)return new _i(n/100)}}coerceStringToMaybeCurrencyNumber(e){const t=this.currencyMatcher(e.trim());if(t!==void 0){const[r,n]=t,i=this.numberLiteralsHelper.numericStringToMaybeNumber(n);if(i!==void 0)return new To(i,r)}}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length).trim()];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length).trim()]}}coerceComplexExactRanges(e){const t=[];for(const n of e)if(n instanceof F)t.push(n);else if(n!==Z){const i=this.coerceScalarToComplex(n);if(i instanceof m)return i;t.push(i)}const r=[];for(const n of t)if(n instanceof F){const i=this.manyToExactComplex(n.valuesFromTopLeftCorner());if(i instanceof m)return i;r.push(...i)}else r.push(n);return r}coerceScalarToComplex(e){return e instanceof m?e:e===Z?[0,0]:ue(e)?[b(e),0]:typeof e=="string"?this.coerceStringToComplex(e):new m(E.NUM,y.ComplexNumberExpected)}ExtendedNumberFactory(e,t){const{type:r,format:n}=t;switch(r){case D.NUMBER_RAW:return e;case D.NUMBER_CURRENCY:return new To(e,n??this.config.currencySymbol[0]);case D.NUMBER_DATE:return new mu(e,n);case D.NUMBER_DATETIME:return new Eu(e,n);case D.NUMBER_TIME:return new gu(e,n);case D.NUMBER_PERCENT:return new _i(e,n)}}buildRegex(e,t=!0){e=this.normalizeString(e);let r,n=this.config.useWildcards,i=this.config.useRegularExpressions;if(i)try{RegExp(e)}catch{i=!1,n=!1}return i?r=Ty(e,this.config.caseSensitive):n?r=Ny(e,this.config.caseSensitive):r=yy(e,this.config.caseSensitive),this.config.matchWholeCell&&t?RegExp("^("+r+")$"):RegExp(r)}normalizeString(e){return this.config.caseSensitive||(e=e.toLowerCase()),this.config.accentSensitive||(e=wd(e,"nfd").replace(/[\u0300-\u036f]/g,"")),e}compare(e,t){if(typeof e=="string"||typeof t=="string"){const r=typeof e=="string"?this.dateTimeHelper.dateStringToDateNumber(e):e,n=typeof t=="string"?this.dateTimeHelper.dateStringToDateNumber(t):t;if(ue(r)&&ue(n))return this.floatCmp(r,n)}return e===Z?e=Al(t):t===Z&&(t=Al(e)),typeof e=="string"&&typeof t=="string"?this.stringCmp(e,t):typeof e=="boolean"&&typeof t=="boolean"?Cl(Co(e),Co(t)):ue(e)&&ue(t)?this.floatCmp(e,t):e===Z&&t===Z?0:Cl(Sl(sa(e)),Sl(sa(t)))}stringCmp(e,t){return this.collator.compare(e,t)}manyToNumbers(e,t){const r=[];for(const i of e)if(i instanceof F)r.push(i);else{const a=b(this.coerceScalarToNumberOrError(i));if(a instanceof m)return a;r.push(a)}const n=[];for(const i of r)if(i instanceof F){const a=t(i.valuesFromTopLeftCorner());if(a instanceof m)return a;n.push(...a)}else n.push(i);return n}coerceStringToComplex(e){const t=gy.exec(e);if(t===null)return new m(E.NUM,y.ComplexNumberExpected);let r;if(t[6]!==void 0?r=t[1]==="-"?[0,-1]:[0,1]:r=this.parseComplexToken(t[1]+t[3],t[5]),r instanceof m||t[8]===void 0)return r;let n;return t[14]!==void 0?n=t[9]==="-"?[0,-1]:[0,1]:n=this.parseComplexToken(t[9]+t[11],t[13]),n instanceof m?n:t[5]!==""||t[13]===""?new m(E.NUM,y.ComplexNumberExpected):t[8]==="+"?[r[0]+n[0],r[1]+n[1]]:[r[0]-n[0],r[1]-n[1]]}parseComplexToken(e,t){const r=b(this.coerceNonDateScalarToMaybeNumber(e));return r===void 0?new m(E.NUM,y.ComplexNumberExpected):t===""?[r,0]:[0,r]}}function xe([s,e],t){if(!isFinite(s)||!isFinite(e))return new m(E.NUM,y.NaN);if(t=t??my,e===0)return`${s}`;const r=`${e===-1||e===1?"":Math.abs(e)}${t}`;return s===0?`${e<0?"-":""}${r}`:`${s}${e<0?"-":"+"}${r}`}function Sd(s){return s instanceof F?s:F.fromScalar(s)}function Co(s){return Number(s)}function Al(s){return typeof s=="string"?"":ue(s)?0:typeof s=="boolean"?!1:Z}function Ad(s){if(s instanceof m||typeof s=="boolean")return s;if(s===Z)return!1;if(ue(s))return b(s)!==0;{const e=s.toUpperCase();return e==="TRUE"?!0:e==="FALSE"||e===""?!1:void 0}}function Io(s){return s instanceof m||typeof s=="string"?s:s===Z?"":ue(s)?b(s).toString():s?"TRUE":"FALSE"}function li(s){return s===Z?0:s}function Cl(s,e){const t=b(s),r=b(e);return t>r?1:t<r?-1:0}function Cd(s){return isNaN(s)||s===1/0||s===-1/0}function Id(s){return s===0?0:s}function $s(s){return["*","?"].includes(s)}const Ry=["{","}","[","]","(",")","<",">","=",".","+","-",",","\\","$","^","!"];function Xs(s){return Ry.includes(s)}function Ny(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);if(n==="~"){if(r==s.length-1){t+="~";continue}const i=s.charAt(r+1);$s(i)||Xs(i)?(t+="\\"+i,r++):(t+=i,r++)}else $s(n)?t+="."+n:Xs(n)?t+="\\"+n:e?t+=n:t+=n.toLowerCase()}return t}function yy(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);$s(n)||Xs(n)?t+="\\"+n:e?t+=n:t+=n.toLowerCase()}return t}function Ty(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);$s(n)||Xs(n)||e?t+=n:t+=n.toLowerCase()}return t}function Il(s,e){const{type:t,format:r}=ta(s),{type:n,format:i}=ta(e);if(t===D.NUMBER_RAW)return{type:n,format:i};if(n===D.NUMBER_RAW)return{type:t,format:r};if((t===D.NUMBER_DATETIME||t===D.NUMBER_DATE)&&(n===D.NUMBER_DATETIME||n===D.NUMBER_DATE))return{type:D.NUMBER_RAW};if(t===D.NUMBER_TIME){if(n===D.NUMBER_DATE)return{type:D.NUMBER_DATETIME,format:`${i} ${r}`};if(n===D.NUMBER_DATETIME)return{type:D.NUMBER_DATETIME,format:i}}if(n===D.NUMBER_TIME){if(t===D.NUMBER_DATE)return{type:D.NUMBER_DATETIME,format:`${r} ${i}`};if(t===D.NUMBER_DATETIME)return{type:D.NUMBER_DATETIME,format:r}}return{type:t,format:r}}function wl(s,e){let{type:t,format:r}=ta(s),{type:n,format:i}=ta(e);return t===D.NUMBER_PERCENT&&(t=D.NUMBER_RAW,r=void 0),n===D.NUMBER_PERCENT&&(n=D.NUMBER_RAW,i=void 0),t===D.NUMBER_RAW?{type:n,format:i}:n===D.NUMBER_RAW?{type:t,format:r}:{type:D.NUMBER_RAW}}function _s(s){return wd(s.toLowerCase(),"nfd").replace(/[\u0300-\u036f]/g,"")}function Ui(s,e){var t;if(s.isAdHoc())return(t=s.data[0])===null||t===void 0?void 0:t[0];const r=s.range;if(e.formulaAddress.sheet===r.sheet){if(r.width()===1){const n=e.formulaAddress.row-r.start.row;if(n>=0&&n<r.height())return s.data[n][0]}else if(r.height()===1){const n=e.formulaAddress.col-r.start.col;if(n>=0&&n<r.width())return s.data[0][n]}}}function wd(s,e){return s.normalize(e.toUpperCase())}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var c;(function(s){s.STRING="STRING",s.NUMBER="NUMBER",s.BOOLEAN="BOOLEAN",s.SCALAR="SCALAR",s.NOERROR="NOERROR",s.RANGE="RANGE",s.INTEGER="INTEGER",s.COMPLEX="COMPLEX",s.ANY="ANY"})(c||(c={}));class ${constructor(e){this.coerceScalarToNumberOrError=t=>this.arithmeticHelper.coerceScalarToNumberOrError(t),this.runFunction=(t,r,n,i)=>{const a=this.evaluateArguments(t,r,n),o=a.map(([N,g])=>N),u=a.map(([N,g])=>g),l=this.buildMetadataForEachArgumentValue(o.length,n),h=r.arraysFlag&&!n.vectorizationForbidden;if(!this.isNumberOfArgumentValuesValid(l,o.length))return new m(E.NA,y.WrongArgNumber);const[d,f]=h?this.calculateSizeOfVectorizedResultArray(o,l):[1,1];if(d===1&&f===1){const N=this.vectorizeAndBroadcastArgumentsIfNecessary(h,o,l,0,0);return this.calculateSingleCellOfResultArray(r,N,l,u,i,n.returnNumberType)}const p=[...Array(d).keys()].map(N=>[...Array(f).keys()].map(g=>{const S=this.vectorizeAndBroadcastArgumentsIfNecessary(h,o,l,N,g),v=this.calculateSingleCellOfResultArray(r,S,l,u,i,n.returnNumberType);if(v instanceof F)throw new Error("Function returning array cannot be vectorized.");return v}));return F.onlyValues(p)},this.runFunctionWithReferenceArgument=(t,r,n,i,a,o=()=>new m(E.NA,y.CellRefExpected))=>{if(t.length===0)return this.returnNumberWrapper(i(),n.returnNumberType);if(t.length>1)return new m(E.NA,y.WrongArgNumber);let u=t[0];for(;u.type===R.PARENTHESIS;)u=u.expression;let l;if(u.type===R.CELL_REFERENCE)l=u.reference.toSimpleCellAddress(r.formulaAddress);else if(u.type===R.CELL_RANGE||u.type===R.COLUMN_RANGE||u.type===R.ROW_RANGE)try{l=B.fromAst(u,r.formulaAddress).start}catch{return new m(E.REF,y.CellRefExpected)}return l!==void 0?this.returnNumberWrapper(a(l),n.returnNumberType):this.runFunction(t,r,n,o)},this.interpreter=e,this.dependencyGraph=e.dependencyGraph,this.columnSearch=e.columnSearch,this.config=e.config,this.serialization=e.serialization,this.arraySizePredictor=e.arraySizePredictor,this.dateTimeHelper=e.dateTimeHelper,this.arithmeticHelper=e.arithmeticHelper}evaluateAst(e,t){return this.interpreter.evaluateAst(e,t)}arraySizeForAst(e,t){return this.arraySizePredictor.checkArraySizeForAst(e,t)}listOfScalarValues(e,t){const r=[];for(const n of e){const i=this.evaluateAst(n,t);if(i instanceof F)for(const a of i.valuesFromTopLeftCorner())r.push([a,!0]);else r.push([i,!1])}return r}coerceToType(e,t,r){let n;if(e instanceof F)switch(t.argumentType){case c.RANGE:case c.ANY:n=e;break;default:{const i=Ui(e,r);if(i===void 0)return;e=i}}if(!(e instanceof F))switch(t.argumentType){case c.INTEGER:case c.NUMBER:const i=this.coerceScalarToNumberOrError(e);if(!ue(i)){n=i;break}const a=b(i);if(t.maxValue!==void 0&&a>t.maxValue)return new m(E.NUM,y.ValueLarge);if(t.minValue!==void 0&&a<t.minValue)return new m(E.NUM,y.ValueSmall);if(t.lessThan!==void 0&&a>=t.lessThan)return new m(E.NUM,y.ValueLarge);if(t.greaterThan!==void 0&&a<=t.greaterThan)return new m(E.NUM,y.ValueSmall);if(t.argumentType===c.INTEGER&&!Number.isInteger(a))return new m(E.NUM,y.IntegerExpected);n=i;break;case c.STRING:n=Io(e);break;case c.BOOLEAN:n=Ad(e);break;case c.SCALAR:case c.NOERROR:case c.ANY:n=e;break;case c.RANGE:if(e instanceof m)return e;n=Sd(e);break;case c.COMPLEX:return this.arithmeticHelper.coerceScalarToComplex(b(e))}return t.passSubtype||n===void 0?n:b(n)}calculateSingleCellOfResultArray(e,t,r,n,i,a){const o=this.coerceArgumentsToRequiredTypes(e,t,r,n);if(o instanceof m)return o;const u=i(...o);return this.returnNumberWrapper(u,a)}coerceArgumentsToRequiredTypes(e,t,r,n){const i=[];for(let a=0;a<r.length;a++){const o=r[a],u=t[a]!==void 0?t[a]:o?.defaultValue;if(u===void 0){i.push(void 0);continue}const l=this.coerceToType(u,o,e);if(l===void 0&&!n[a])return new m(E.VALUE,y.WrongType);if(l instanceof m&&o.argumentType!==c.SCALAR)return l;i.push(l)}return i}vectorizeAndBroadcastArgumentsIfNecessary(e,t,r,n,i){return t.map((a,o)=>e&&this.isRangePassedAsAScalarArgument(a,r[o])?this.vectorizeAndBroadcastRangeArgument(a,n,i):a)}vectorizeAndBroadcastRangeArgument(e,t,r){var n;const i=e.height()===1?0:t,a=e.width()===1?0:r;return(n=e.data[i])===null||n===void 0?void 0:n[a]}evaluateArguments(e,t,r){return r.expandRanges?this.listOfScalarValues(e,t):e.map(n=>[this.evaluateAst(n,t),!1])}buildMetadataForEachArgumentValue(e,t){const r=t.parameters?[...t.parameters]:[];if(t.repeatLastArgs!==void 0&&Number.isInteger(t.repeatLastArgs)&&t.repeatLastArgs>0)for(;e>r.length;)r.push(...r.slice(r.length-t.repeatLastArgs));return r}isNumberOfArgumentValuesValid(e,t){return t>e.length?!1:t<e.length?e.slice(t).every(i=>i?.optionalArg||i?.defaultValue!==void 0):!0}calculateSizeOfVectorizedResultArray(e,t){const r=e.filter((a,o)=>this.isRangePassedAsAScalarArgument(a,t[o])),n=Math.max(1,...r.map(a=>a.height())),i=Math.max(1,...r.map(a=>a.width()));return[n,i]}isRangePassedAsAScalarArgument(e,t){return e==null||t==null?!1:e instanceof F&&![c.RANGE,c.ANY].includes(t.argumentType)}metadata(e){const t=this.constructor.implementedFunctions[e];if(t!==void 0)return t;throw new Error(`No metadata for function ${e}.`)}returnNumberWrapper(e,t,r){return t!==void 0&&ue(e)?this.arithmeticHelper.ExtendedNumberFactory(b(e),{type:t,format:r}):e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class X{constructor(e,t,r=!1){this.width=e,this.height=t,this.isRef=r}static error(){return new X(1,1,!0)}static scalar(){return new X(1,1,!1)}isScalar(){return this.width===1&&this.height===1||this.isRef}}function vy(s,e){return new X(Math.max(s.width,e.width),Math.max(s.height,e.height))}function Sy(s){return new X(s.width,s.height)}class Ay{constructor(e,t){this.config=e,this.functionRegistry=t}checkArraySize(e,t){return this.checkArraySizeForAst(e,{formulaAddress:t,arraysFlag:this.config.useArrayArithmetic})}checkArraySizeForAst(e,t){switch(e.type){case R.FUNCTION_CALL:return this.checkArraySizeForFunction(e,t);case R.COLUMN_RANGE:case R.ROW_RANGE:case R.CELL_RANGE:{const r=B.fromAstOrUndef(e,t.formulaAddress);return r===void 0?X.error():new X(r.width(),r.height(),!0)}case R.ARRAY:{const r=[],n=[];for(const o of e.args){const u=o.map(d=>this.checkArraySizeForAst(d,t)),l=Math.min(...u.map(d=>d.height)),h=u.reduce((d,f)=>d+f.width,0);r.push(l),n.push(h)}const i=r.reduce((o,u)=>o+u,0),a=Math.min(...n);return new X(a,i)}case R.STRING:case R.NUMBER:return X.scalar();case R.CELL_REFERENCE:return new X(1,1,!0);case R.DIV_OP:case R.CONCATENATE_OP:case R.EQUALS_OP:case R.GREATER_THAN_OP:case R.GREATER_THAN_OR_EQUAL_OP:case R.LESS_THAN_OP:case R.LESS_THAN_OR_EQUAL_OP:case R.MINUS_OP:case R.NOT_EQUAL_OP:case R.PLUS_OP:case R.POWER_OP:case R.TIMES_OP:{const r=this.checkArraySizeForAst(e.left,t),n=this.checkArraySizeForAst(e.right,t);return!t.arraysFlag&&(r.height>1||r.width>1||n.height>1||n.width>1)?X.error():vy(r,n)}case R.MINUS_UNARY_OP:case R.PLUS_UNARY_OP:case R.PERCENT_OP:{const r=this.checkArraySizeForAst(e.value,t);return!t.arraysFlag&&(r.height>1||r.width>1)?X.error():Sy(r)}case R.PARENTHESIS:return this.checkArraySizeForAst(e.expression,t);case R.EMPTY:return X.error();default:return X.error()}}checkArraySizeForFunction(e,t){const r=this.functionRegistry.getArraySizeFunction(e.procedureName);if(r!==void 0)return r(e,t);const n=this.functionRegistry.getMetadata(e.procedureName);if(n===void 0||n.expandRanges||!t.arraysFlag||n.vectorizationForbidden||n.parameters===void 0)return new X(1,1);const i=e.args.map(l=>{var h;return this.checkArraySizeForAst(l,new Ir(t.formulaAddress,t.arraysFlag||((h=n?.enableArrayArithmeticForArguments)!==null&&h!==void 0?h:!1)))}),a=[...n.parameters];if(n.repeatLastArgs!==void 0&&a.length<i.length&&(i.length-a.length)%n.repeatLastArgs!==0)return X.error();for(;a.length<i.length;){if(n.repeatLastArgs===void 0)return X.error();a.push(...a.slice(a.length-n.repeatLastArgs))}let o=1,u=1;for(let l=0;l<i.length;l++)a[l].argumentType!==c.RANGE&&a[l].argumentType!==c.ANY&&(u=Math.max(u,i[l].height),o=Math.max(o,i[l].width));return new X(o,u)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Md{constructor(e,t,r){var n;this.value=t,this.address=r,this.type=e.type,this.message=(n=e.message)!==null&&n!==void 0?n:""}toString(){return this.value}valueOf(){return this.value}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function he(s,e,t){if(typeof s>"u")return kt.defaultConfig[t];if(typeof e=="string"){if(typeof s===e)return s;throw new oe(e,t)}else{if(e.includes(s))return s;throw new Ed(e.map(r=>`'${r}'`).join(" "),t)}}function Ln(s,e,t){if(s<t)throw new md(e,t)}function Cy(s,e,t){if(s>t)throw new gd(e,t)}function ci(s,e,t,r){if(e(s))return s;if(typeof s>"u")return kt.defaultConfig[r];throw new oe(t,r)}function Ml(...s){const e=new Map;s.forEach(r=>{const n=e.get(r.value)||[];n.push(r.name),e.set(r.value,n)});const t=[];for(const r of e.values())r.length>1&&t.push(r);if(t.length>0){t.forEach(n=>n.sort());const r=t.map(n=>`[${n}]`).join("; ");throw new Error(`Config initialization failed. Parameters in conflict: ${r}`)}}function O(s,e,t){if(typeof s!==e)throw new oe(e,t)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const yu=new RegExp("^ss(\\.(s+|0+))?$"),Iy=new RegExp("^[0-9/.\\-: ]+[ap]?m?$"),wy=new RegExp("\\s+"),Od=new RegExp("[ /.-]"),wo=":",Ol=1e3,My=bd(xy),Oy=bd(_y);function by(s,e,t){if(e===void 0&&t===void 0)return;let r=s.replace(wy," ").trim().toLowerCase();if(!Ly(r))return;let n=r.substring(r.length-2);n==="am"||n==="pm"?r=r.substring(0,r.length-2).trim():(n=r.substring(r.length-1),n==="a"||n==="p"?r=r.substring(0,r.length-1).trim():n=void 0);const i=r.split(Od);i.length>=2&&i[i.length-2].includes(wo)&&(i[i.length-2]=i[i.length-2]+"."+i[i.length-1],i.pop());const a=i[i.length-1].split(wo);if(n!==void 0&&a.push(n),i.length===1)return bl(a,t);if(a.length===1)return xl(i,e);const o=xl(i.slice(0,i.length-1),e),u=bl(a,t);if(o!==void 0)return u===void 0?void 0:Object.assign(Object.assign({},o),u)}function bl(s,e){var t,r,n;if(e===void 0)return;const{itemsCount:i,hourItem:a,minuteItem:o,secondItem:u}=My(e);let l;if(s[s.length-1]==="am"||s[s.length-1]==="a"?(l=!1,s.pop()):(s[s.length-1]==="pm"||s[s.length-1]==="p")&&(l=!0,s.pop()),s.length!==i)return;const h=Number((t=s[u])!==null&&t!==void 0?t:"0");if(!Number.isFinite(h))return;const d=Math.round(h*Ol)/Ol,f=Number((r=s[o])!==null&&r!==void 0?r:"0");if(!(Number.isFinite(f)&&Number.isInteger(f)))return;const p=Number((n=s[a])!==null&&n!==void 0?n:"0");return!(Number.isFinite(p)&&Number.isInteger(p))||l!==void 0&&(p<0||p>12)?void 0:{hours:l!==void 0?p%12+(l?12:0):p,minutes:f,seconds:d}}function xl(s,e){var t;if(e===void 0)return;const{itemsCount:r,dayItem:n,monthItem:i,shortYearItem:a,longYearItem:o}=Oy(e);if(s.length!==r)return;const u=Number(s[n]);if(!(Number.isFinite(u)&&Number.isInteger(u)))return;const l=Number(s[i]);if(!(Number.isFinite(l)&&Number.isInteger(l))||s[o]&&s[a])return;const h=Number((t=s[o])!==null&&t!==void 0?t:s[a]);if(Number.isFinite(h)&&Number.isInteger(h)&&!(s[o]&&(h<1e3||h>9999))&&!(s[a]&&(h<0||h>99)))return{year:h,month:l,day:u}}function xy(s){const e=s.toLowerCase().trim(),r=(e.endsWith("am/pm")?e.substring(0,e.length-5):e.endsWith("a/p")?e.substring(0,s.length-3):e).trim().split(wo);return{itemsCount:r.length,hourItem:r.indexOf("hh"),minuteItem:r.indexOf("mm"),secondItem:r.findIndex(n=>yu.test(n))}}function _y(s){const e=s.toLowerCase().trim().split(Od);return{itemsCount:e.length,dayItem:e.indexOf("dd"),monthItem:e.indexOf("mm"),shortYearItem:e.indexOf("yy"),longYearItem:e.indexOf("yyyy")}}function Ly(s){return Iy.test(s)}function bd(s){const e={};return t=>{const r=e[t];if(r!==void 0)return r;const n=s(t);return e[t]=n,n}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Mo=[31,28,31,30,31,30,31,31,30,31,30,31],Yn=[0,31,59,90,120,151,181,212,243,273,304,334],hi=60,di=60,Oo=24;function Ls(s){return s&&(typeof s=="object"||typeof s=="function")?"year"in s&&typeof s.year=="number"&&"month"in s&&typeof s.month=="number"&&"day"in s&&typeof s.day=="number":!1}function xd(s){return s&&(typeof s=="object"||typeof s=="function")?"hours"in s&&typeof s.hours=="number"&&"minutes"in s&&typeof s.minutes=="number"&&"seconds"in s&&typeof s.seconds=="number":!1}const Fy={year:9999,month:12,day:31};class Uy{constructor(e){this.config=e,this.minDateAbsoluteValue=this.dateToNumberFromZero(e.nullDate),this.maxDateValue=this.dateToNumber(Fy),this.leapYear1900=e.leapYear1900,!this.leapYear1900&&0<=this.dateToNumber({year:1900,month:2,day:28})?this.epochYearZero=this.numberToSimpleDate(2).year:this.epochYearZero=this.numberToSimpleDate(1).year,this.parseDateTime=e.parseDateTime}getWithinBounds(e){return e<=this.maxDateValue&&e>=0?e:void 0}dateStringToDateNumber(e){const{dateTime:t,dateFormat:r="",timeFormat:n=""}=this.parseDateTimeFromConfigFormats(e);if(t!==void 0)return xd(t)?Ls(t)?new Eu(qn(t)+this.dateToNumber(t),r+" "+n):new gu(qn(t),n):Ls(t)?new mu(this.dateToNumber(t),r):0}parseDateTimeFromConfigFormats(e){return this.parseDateTimeFromFormats(e,this.config.dateFormats,this.config.timeFormats)}getNullYear(){return this.config.nullYear}getEpochYearZero(){return this.epochYearZero}isValidDate(e){return isNaN(e.year)||isNaN(e.month)||isNaN(e.day)||e.day!==Math.round(e.day)||e.month!==Math.round(e.month)||e.year!==Math.round(e.year)||e.year<1582||e.month<1||e.month>12||e.day<1?!1:this.isLeapYear(e.year)&&e.month===2?e.day<=29:e.day<=Mo[e.month-1]}dateToNumber(e){return this.dateToNumberFromZero(e)-this.minDateAbsoluteValue}relativeNumberToAbsoluteNumber(e){return e+this.minDateAbsoluteValue-(this.leapYear1900?1:0)}numberToSimpleDate(e){const t=Math.floor(e)+this.minDateAbsoluteValue;let r=Math.floor(t/365.2425);this.dateToNumberFromZero({year:r+1,month:1,day:1})<=t?r++:this.dateToNumberFromZero({year:r-1,month:1,day:1})>t&&r--;const n=t-this.dateToNumberFromZero({year:r,month:1,day:1}),i=Py(n-(this.isLeapYear(r)&&n>=59?1:0)),a=n-Yn[i]-(this.isLeapYear(r)&&i>1?1:0);return{year:r,month:i+1,day:a+1}}numberToSimpleDateTime(e){const t=Kn(e%1),r=Math.floor(t.hours/Oo);t.hours=t.hours%Oo;const n=this.numberToSimpleDate(Math.floor(e)+r);return Object.assign(Object.assign({},n),t)}leapYearsCount(e){return Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400)+(this.config.leapYear1900&&e>=1900?1:0)}daysInMonth(e,t){return this.isLeapYear(e)&&t===2?29:Mo[t-1]}endOfMonth(e){return{year:e.year,month:e.month,day:this.daysInMonth(e.year,e.month)}}toBasisUS(e,t){return e.day===31&&(e.day=30),e.day===30&&t.day===31&&(t.day=30),e.month===2&&e.day===this.daysInMonth(e.year,e.month)&&(e.day=30,t.month===2&&t.day===this.daysInMonth(t.year,t.month)&&(t.day=30)),[e,t]}yearLengthForBasis(e,t){return e.year!==t.year?e.year+1!==t.year||e.month<t.month||e.month===t.month&&e.day<t.day?(this.leapYearsCount(t.year)-this.leapYearsCount(e.year-1))/(t.year-e.year+1)+365:this.countLeapDays(t)!==this.countLeapDays({year:e.year,month:e.month,day:e.day-1})?366:365:this.isLeapYear(e.year)?366:365}parseSingleFormat(e,t,r){const n=this.parseDateTime(e,t,r);if(!(Ls(n)&&(n.year>=0&&n.year<100&&(n.year<this.getNullYear()?n.year+=2e3:n.year+=1900),!this.isValidDate(n))))return n}parseDateTimeFromFormats(e,t,r){const n=t.length===0?[void 0]:t,i=r.length===0?[void 0]:r;for(const a of n)for(const o of i){const u=this.parseSingleFormat(e,a,o);if(u!==void 0)return{dateTime:u,timeFormat:o,dateFormat:a}}return{}}countLeapDays(e){return e.month>2||e.month===2&&e.day>=29?this.leapYearsCount(e.year):this.leapYearsCount(e.year-1)}dateToNumberFromZero(e){return 365*e.year+Yn[e.month-1]+e.day-1+(e.month<=2?this.leapYearsCount(e.year-1):this.leapYearsCount(e.year))}isLeapYear(e){return e%4?!1:e%100?!0:e%400?e===1900&&this.config.leapYear1900:!0}}function Py(s){let e=0;return Yn[e+6]<=s&&(e+=6),Yn[e+3]<=s&&(e+=3),Yn[e+2]<=s?e+=2:Yn[e+1]<=s&&(e+=1),e}function _l(s,e){const t=12*s.year+s.month-1+e;return{year:Math.floor(t/12),month:t%12+1,day:s.day}}function Dy(s){return{year:s.year,month:s.month,day:Math.min(s.day,Mo[s.month-1])}}function Ka(s){return Math.round(s*3600*24)/(3600*24)}function Vy(s,e=1){return Math.round(s*e)/e}function Kn(s){const e=s*Oo*di*hi,t=Vy(e%hi,1e5)%hi,r=(e-t)/hi,n=Math.round(r%di)%di,i=(r-n)/di;return{hours:Math.round(i),minutes:n,seconds:t}}function qn(s){return((s.seconds/60+s.minutes)/60+s.hours)/24}function Ll(s){return{year:s.year,month:s.month,day:Math.min(30,s.day)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class By{call(){return iy}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Fl=/(\\.|dd|DD|d|D|mm|MM|m|M|YYYY|YY|yyyy|yy|HH|hh|H|h|ss(\.(0+|s+))?|s|AM\/PM|am\/pm|A\/P|a\/p|\[mm]|\[MM]|\[hh]|\[HH])/g,Ul=/(\\.|[#0]+(\.[#0]*)?)/g;var Sr;(function(s){s.FORMAT="FORMAT",s.FREE_TEXT="FREE_TEXT"})(Sr||(Sr={}));function fi(s,e){return{type:s,value:e}}var ia;(function(s){s.DATE="DATE",s.NUMBER="NUMBER",s.STRING="STRING"})(ia||(ia={}));function ky(s){Fl.lastIndex=0;const e=[];let t;do t=Fl.exec(s),t!==null&&e.push(t);while(t);return e}function Gy(s){Ul.lastIndex=0;const e=Ul.exec(s);return e!==null?[e]:[]}function _d(s,e){const t=[];let r=0;for(let i=0;i<s.length;++i){const a=s[i];if(a.index!==r){const o=e.substr(r,a.index-r);t.push(fi(Sr.FREE_TEXT,o))}a[0].startsWith("\\")?t.push(fi(Sr.FREE_TEXT,a[0])):t.push(fi(Sr.FORMAT,a[0])),r=a.index+a[0].length}const n=s[s.length-1];if(n.index+n[0].length<e.length){const i=e.substr(n.index+n[0].length,e.length);t.push(fi(Sr.FREE_TEXT,i))}return t}function Ld(s){const e=ky(s);if(!e.every(t=>Fd(t)))return{type:ia.DATE,tokens:_d(e,s)}}function Hy(s){const e=Gy(s);if(!e.every(t=>Fd(t)))return{type:ia.NUMBER,tokens:_d(e,s)}}function Fd(s){return s[0].startsWith("\\")}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Wy(s,e,t,r){const n=t.stringifyDateTime(r.numberToSimpleDateTime(s),e);if(n!==void 0)return n;const i=t.stringifyDuration(Kn(s),e);if(i!==void 0)return i;const a=Hy(e);return a!==void 0?Yy(a.tokens,s):e}function St(s,e){let t=`${s}`;for(;t.length<e;)t="0"+t;return t}function zy(s,e){let t=`${s}`;for(;t.length<e;)t=t+"0";return t}function Pl(s,e){return s.split(e).length-1}function Yy(s,e){let t="";for(let r=0;r<s.length;++r){const n=s[r];if(n.type===Sr.FREE_TEXT){t+=n.value;continue}const i=n.value.split("."),a=i[0],o=i[1]||"",u=i[1]?".":"",l=Number(e.toFixed(o.length)).toString().split(".");let h=l[0]||"",d=l[1]||"";if(a.length>h.length){const p=Pl(a.substr(0,a.length-h.length),"0");h=St(h,p+h.length)}const f=Pl(o.substr(d.length,o.length-d.length),"0");d=zy(d,f+d.length),t+=h+u+d}return t}function jy(s,e){const t=Ld(e);if(t===void 0)return;const r=t.tokens;let n="";for(const i of r){if(i.type===Sr.FREE_TEXT){n+=i.value;continue}switch(i.value.toLowerCase()){case"h":case"hh":{n+=St(s.hours,i.value.length),s.hours=0;break}case"[hh]":{n+=St(s.hours,i.value.length-2),s.hours=0;break}case"m":case"mm":{n+=St(s.minutes,i.value.length),s.minutes=0;break}case"[mm]":{n+=St(s.minutes+60*s.hours,i.value.length-2),s.minutes=0,s.hours=0;break}case"s":case"ss":{n+=St(Math.floor(s.seconds),i.value.length);break}default:{if(yu.test(i.value)){const a=Math.max(i.value.length-3,0);n+=`${s.seconds<10?"0":""}${Math.floor(s.seconds*Math.pow(10,a))/Math.pow(10,a)}`;continue}return}}}return n}function $y(s,e){const t=Ld(e);if(t===void 0)return;const r=t.tokens;let n="",i=!1;const a=r.some(o=>o.type===Sr.FORMAT&&(o.value==="a/p"||o.value==="A/P"||o.value==="am/pm"||o.value==="AM/PM"));for(let o=0;o<r.length;o++){const u=r[o];if(u.type===Sr.FREE_TEXT){n+=u.value;continue}switch(u.value.toLowerCase()){case"h":case"hh":{i=!0,n+=St(a?(s.hours+11)%12+1:s.hours,u.value.length);break}case"d":case"dd":{n+=St(s.day,u.value.length);break}case"s":case"ss":{n+=St(Math.floor(s.seconds),u.value.length);break}case"m":case"mm":{o+1<r.length&&r[o+1].value.startsWith(":")&&(i=!0),i?n+=St(s.minutes,u.value.length):n+=St(s.month,u.value.length),i=!0;break}case"yy":{n+=St(s.year%100,u.value.length);break}case"yyyy":{n+=s.year;break}case"am/pm":case"a/p":{const[l,h]=u.value.split("/");n+=s.hours<12?l:h;break}default:{if(yu.test(u.value)){const l=u.value.length-3;n+=`${s.seconds<10?"0":""}${Math.floor(s.seconds*Math.pow(10,l))/Math.pow(10,l)}`;continue}return}}}return n}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const bo="length",Fs=s=>parseInt(s,16),Dl=s=>parseInt(s,10),qa=s=>(s+"").replace(/\-/g,""),aa=(s,e,t)=>s.substr(e,t),sr=s=>s.codePointAt(0)-65;function Xy(s){return qa(s)[bo]===25?Fs(aa(qa(s),Fs("12"),sr("F")))/(Fs(aa(qa(s),sr("C"),sr("Y")>>4))||(~~![][bo]<<3)+1):0}function Ky(s){if(s=(s+"").replace(/\-/g,""),s[bo]!==sr("Z"))return!1;let e=0;return[[0,sr("G")+1],[sr("H"),sr("H")-1],[sr("G")+sr("H"),sr("G")]].reduce((t,[r,n],i)=>(t|=(Dl(`${Dl(Fs(aa(s,e+r-(i===0?0:2),n+(i?2:0)))+(Fs(aa(s,e+r+n,2))+[]).padStart(2,"0"))}`)%97||2)>>1,e+=2,t),sr("A"))==="1">>1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const qy={invalid:()=>"The license key for HyperFormula is invalid.",expired:({keyValidityDate:s})=>`The license key for HyperFormula expired on ${s}, and is not valid for the installed version.`,missing:()=>"The license key for HyperFormula is missing."};let Vl=!1;function Qy(s){const e={template:"missing",vars:{}};if(s==="gpl-v3"||s==="internal-use-in-handsontable")e.template="valid";else if(typeof s=="string"&&Ky(s)){const[t,r,n]="14/10/2025".split("/"),i=Math.floor(new Date(`${r}/${t}/${n}`).getTime()/864e5),a=Xy(s);e.vars.keyValidityDate=Zy(new Date((a+1)*864e5)),i>a?e.template="expired":e.template="valid"}else s!==""&&(e.template="invalid");return!Vl&&e.template!=="valid"&&(console.warn(qy[e.template](e.vars)),Vl=!0),e.template}function Zy(s){const t=["January","February","March","April","May","June","July","August","September","October","November","December"][s.getMonth()],r=s.getDate(),n=s.getFullYear();return`${t} ${r}, ${n}`}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Ie;(function(s){class e{constructor(u){this.value=u,this.value=pu(this.value,Id(b(this.value)))}}s.Number=e;class t{constructor(u){this.value=u}}s.String=t;class r{constructor(u){this.value=u}}s.Boolean=r;class n{static getSingletonInstance(){return n.instance||(n.instance=new n),n.instance}}s.Empty=n;class i{constructor(u){this.formula=u}}s.Formula=i;class a{constructor(u,l){this.value=new m(u,l)}}s.Error=a})(Ie||(Ie={}));function Jy(s){return s.startsWith("=")}function eT(s){const e=s.toLowerCase();return e==="true"||e==="false"}function tT(s,e){const t=s.toUpperCase();return/#[A-Za-z0-9\/]+[?!]?/.test(t)&&Object.prototype.hasOwnProperty.call(e,t)}class rT{constructor(e,t,r){this.config=e,this.dateHelper=t,this.numberLiteralsHelper=r}parse(e){if(e==null)return Ie.Empty.getSingletonInstance();if(typeof e=="number")return Cd(e)?new Ie.Error(E.NUM,y.ValueLarge):new Ie.Number(e);if(typeof e=="boolean")return new Ie.Boolean(e);if(e instanceof Date){const t=this.dateHelper.dateToNumber({day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()}),r=qn({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()+e.getMilliseconds()/1e3}),n=t+r;return n<0?new Ie.Error(E.NUM,y.DateBounds):n%1===0?new Ie.Number(new mu(n,"Date()")):n<1?new Ie.Number(new gu(n,"Date()")):new Ie.Number(new Eu(n,"Date()"))}else if(typeof e=="string"){if(eT(e))return new Ie.Boolean(e.toLowerCase()==="true");if(Jy(e))return new Ie.Formula(e);if(tT(e,this.config.errorMapping))return new Ie.Error(this.config.errorMapping[e.toUpperCase()]);{let t=e.trim(),r=0,n;if(t.endsWith("%"))r=1,t=t.slice(0,t.length-1);else{const o=this.currencyMatcher(t);o!==void 0&&(r=2,[n,t]=o)}const i=this.numberLiteralsHelper.numericStringToMaybeNumber(t);if(i!==void 0){let o;return r===1?o=new _i(i/100):r===2?o=new To(i,n):o=i,new Ie.Number(o)}const a=this.dateHelper.dateStringToDateNumber(t);return a!==void 0?new Ie.Number(a):new Ie.String(e.startsWith("'")?e.slice(1):e)}}else throw new pd(e)}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length)];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length)]}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Nn;(function(s){s[s.COPY=0]="COPY",s[s.CUT=1]="CUT"})(Nn||(Nn={}));var lt;(function(s){s[s.VALUE=0]="VALUE",s[s.EMPTY=1]="EMPTY",s[s.FORMULA=2]="FORMULA",s[s.PARSING_ERROR=3]="PARSING_ERROR"})(lt||(lt={}));class Bl{constructor(e,t,r,n,i){this.sourceLeftCorner=e,this.width=t,this.height=r,this.type=n,this.content=i}*getContent(e){if(this.content!==void 0)for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r)yield[x(e.sheet,e.col+r,e.row+t),this.content[t][r]]}}class nT{constructor(e,t,r){this.dependencyGraph=t,this.operations=r,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}cut(e,t,r){this.clipboard=new Bl(e,t,r,Nn.CUT)}copy(e,t,r){const n=[];for(let i=0;i<r;++i){n[i]=[];for(let a=0;a<t;++a){const o=this.operations.getClipboardCell(x(e.sheet,e.col+a,e.row+i));n[i].push(o)}}this.clipboard=new Bl(e,t,r,Nn.COPY,n)}abortCut(){this.clipboard&&this.clipboard.type===Nn.CUT&&this.clear()}clear(){this.clipboard=void 0}ensureItIsPossibleToCopyPaste(e){if(this.clipboard===void 0)return;if(Ct(e)||!this.dependencyGraph.sheetMapping.hasSheetWithId(e.sheet))throw new We("a valid target address.");const t=B.spanFrom(e,this.clipboard.width,this.clipboard.height);if(t.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new vn;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new Error("It is not possible to paste onto an array")}isCutClipboard(){return this.clipboard!==void 0&&this.clipboard.type===Nn.CUT}isCopyClipboard(){return this.clipboard!==void 0&&this.clipboard.type===Nn.COPY}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class oa{constructor(e,t,r,n){this.displayName=e,this.address=t,this.added=r,this.options=n}normalizeExpressionName(){return this.displayName.toLowerCase()}copy(){return new oa(this.displayName,this.address,this.added,this.options)}}class sT{constructor(){this.mapping=new Map}has(e){return this.mapping.has(this.normalizeExpressionName(e))}isNameAvailable(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);return!(r&&r.added)}add(e){this.mapping.set(e.normalizeExpressionName(),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}getExisting(e){const t=this.mapping.get(this.normalizeExpressionName(e));if(t&&t.added)return t}remove(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);r&&(r.added=!1)}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}normalizeExpressionName(e){return e.toLowerCase()}}class kl{constructor(){this.mapping=new Map}add(e){this.mapping.set(this.normalizeExpressionName(e.displayName),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}has(e){return this.mapping.has(this.normalizeExpressionName(e))}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}isNameAvailable(e){const t=this.normalizeExpressionName(e);return!this.mapping.has(t)}remove(e){const t=this.normalizeExpressionName(e);this.mapping.get(t)&&this.mapping.delete(t)}normalizeExpressionName(e){return e.toLowerCase()}}class wn{constructor(){this.nextNamedExpressionRow=0,this.workbookStore=new sT,this.worksheetStores=new Map,this.addressCache=new Map}isNameAvailable(e,t){var r,n;return t===void 0?this.workbookStore.isNameAvailable(e):(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.isNameAvailable(e))!==null&&n!==void 0?n:!0}namedExpressionInAddress(e){const t=this.addressCache.get(e);if(t&&t.added)return t}namedExpressionForScope(e,t){var r;return t===void 0?this.workbookStore.getExisting(e):(r=this.worksheetStore(t))===null||r===void 0?void 0:r.get(e)}nearestNamedExpression(e,t){var r,n;return(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.get(e))!==null&&n!==void 0?n:this.workbookStore.getExisting(e)}isExpressionInScope(e,t){var r,n;return(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.has(e))!==null&&n!==void 0?n:!1}isNameValid(e){const t=new RegExp(`^${qc}$`),r=new RegExp(`^${Qc}$`),n=new RegExp(`^${Zc}$`);return t.test(e)||r.test(e)?!1:n.test(e)}addNamedExpression(e,t,r){const n=t===void 0?this.workbookStore:this.worksheetStoreOrCreate(t);let i=n.get(e);return i!==void 0?(i.added=!0,i.displayName=e,i.options=r):(i=new oa(e,this.nextAddress(),!0,r),n.add(i)),this.addressCache.set(i.address.row,i),i}restoreNamedExpression(e,t){const r=t===void 0?this.workbookStore:this.worksheetStoreOrCreate(t);return e.added=!0,r.add(e),this.addressCache.set(e.address.row,e),e}namedExpressionOrPlaceholder(e,t){var r;return(r=this.worksheetStoreOrCreate(t).get(e))!==null&&r!==void 0?r:this.workbookNamedExpressionOrPlaceholder(e)}workbookNamedExpressionOrPlaceholder(e){let t=this.workbookStore.get(e);return t===void 0&&(t=new oa(e,this.nextAddress(),!1),this.workbookStore.add(t)),t}remove(e,t){let r;t===void 0?r=this.workbookStore:r=this.worksheetStore(t);const n=r?.get(e);if(r===void 0||n===void 0||!n.added)throw Error("Named expression does not exist");r.remove(e),r instanceof kl&&r.mapping.size===0&&this.worksheetStores.delete(t),this.addressCache.delete(n.address.row)}getAllNamedExpressionsNamesInScope(e){return this.getAllNamedExpressions().filter(({scope:t})=>t===e).map(t=>t.expression.displayName)}getAllNamedExpressionsNames(){return this.getAllNamedExpressions().map(e=>e.expression.displayName)}getAllNamedExpressions(){const e=[];return this.workbookStore.getAllNamedExpressions().forEach(t=>{e.push({expression:t,scope:void 0})}),this.worksheetStores.forEach((t,r)=>{t.getAllNamedExpressions().forEach(n=>{e.push({expression:n,scope:r})})}),e}getAllNamedExpressionsForScope(e){var t,r;return e===void 0?this.workbookStore.getAllNamedExpressions():(r=(t=this.worksheetStores.get(e))===null||t===void 0?void 0:t.getAllNamedExpressions())!==null&&r!==void 0?r:[]}worksheetStoreOrCreate(e){let t=this.worksheetStores.get(e);return t||(t=new kl,this.worksheetStores.set(e,t)),t}worksheetStore(e){return this.worksheetStores.get(e)}nextAddress(){return x(wn.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}}wn.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;const qr=s=>{switch(s.type){case R.EMPTY:case R.NUMBER:case R.STRING:case R.ERROR:case R.ERROR_WITH_RAW_INPUT:return!1;case R.CELL_REFERENCE:return!s.reference.isAbsolute();case R.CELL_RANGE:case R.COLUMN_RANGE:case R.ROW_RANGE:return!s.start.isAbsolute();case R.NAMED_EXPRESSION:return!1;case R.PERCENT_OP:case R.PLUS_UNARY_OP:case R.MINUS_UNARY_OP:return qr(s.value);case R.CONCATENATE_OP:case R.EQUALS_OP:case R.NOT_EQUAL_OP:case R.LESS_THAN_OP:case R.GREATER_THAN_OP:case R.LESS_THAN_OR_EQUAL_OP:case R.GREATER_THAN_OR_EQUAL_OP:case R.MINUS_OP:case R.PLUS_OP:case R.TIMES_OP:case R.DIV_OP:case R.POWER_OP:return qr(s.left)||qr(s.right);case R.PARENTHESIS:return qr(s.expression);case R.FUNCTION_CALL:return s.args.some(e=>qr(e));case R.ARRAY:return s.args.some(e=>e.some(t=>qr(t)))}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class hn{performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[n,i]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService)),a=t.rememberNewAst(n);r.setFormula(a),r.setAddress(i)}}transformSingleAst(e,t){const r=this.transformAst(e,t),n=this.fixNodeAddress(t);return[r,n]}transformAst(e,t){switch(e.type){case R.CELL_REFERENCE:return this.transformCellReferenceAst(e,t);case R.CELL_RANGE:return this.transformCellRangeAst(e,t);case R.COLUMN_RANGE:return this.transformColumnRangeAst(e,t);case R.ROW_RANGE:return this.transformRowRangeAst(e,t);case R.EMPTY:case R.ERROR:case R.NUMBER:case R.NAMED_EXPRESSION:case R.ERROR_WITH_RAW_INPUT:case R.STRING:return e;case R.PERCENT_OP:case R.MINUS_UNARY_OP:case R.PLUS_UNARY_OP:return Object.assign(Object.assign({},e),{value:this.transformAst(e.value,t)});case R.FUNCTION_CALL:return Object.assign(Object.assign({},e),{procedureName:e.procedureName,args:e.args.map(r=>this.transformAst(r,t))});case R.PARENTHESIS:return Object.assign(Object.assign({},e),{expression:this.transformAst(e.expression,t)});case R.ARRAY:return Object.assign(Object.assign({},e),{args:e.args.map(r=>r.map(n=>this.transformAst(n,t)))});default:return Object.assign(Object.assign({},e),{left:this.transformAst(e.left,t),right:this.transformAst(e.right,t)})}}transformCellReferenceAst(e,t){const r=this.transformCellAddress(e.reference,t);return r instanceof Ne?Object.assign(Object.assign({},e),{reference:r}):r===E.REF?yr(new m(E.REF)):e}transformCellRangeAst(e,t){const r=this.transformCellRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===E.REF?yr(new m(E.REF)):e}transformColumnRangeAst(e,t){const r=this.transformColumnRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===E.REF?yr(new m(E.REF)):e}transformRowRangeAst(e,t){const r=this.transformRowRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===E.REF?yr(new m(E.REF)):e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class iT extends hn{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!1}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=cr(e,t);if(r!==this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet)return!1;const n=e.toSimpleColumnAddress(t);return r===this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet?this.columnsSpan.columnStart<=n.col?e.shiftedByColumns(this.columnsSpan.numberOfColumns):!1:t.sheet===this.columnsSpan.sheet&&r!==this.columnsSpan.sheet?e.isColumnAbsolute()||t.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(-this.columnsSpan.numberOfColumns):e.isColumnAbsolute()?e.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(this.columnsSpan.numberOfColumns):e.toSimpleColumnAddress(t).col<this.columnsSpan.columnStart?t.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(-this.columnsSpan.numberOfColumns):t.col<this.columnsSpan.columnStart?e.shiftedByColumns(this.columnsSpan.numberOfColumns):!1}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col+this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n===E.REF||i===E.REF?E.REF:n||i?[n||e,i||t]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class xo extends hn{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!1}transformColumnRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}transformCellAddress(e,t){const r=cr(e,t);if(r!==this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet)return!1;const n=e.toSimpleRowAddress(t);return r===this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet?this.rowsSpan.rowStart<=n.row?e.shiftedByRows(this.rowsSpan.numberOfRows):!1:t.sheet===this.rowsSpan.sheet&&r!==this.rowsSpan.sheet?e.isRowAbsolute()||t.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(-this.rowsSpan.numberOfRows):e.isRowAbsolute()?e.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(this.rowsSpan.numberOfRows):n.row<this.rowsSpan.rowStart?t.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(-this.rowsSpan.numberOfRows):t.row<this.rowsSpan.rowStart?e.shiftedByRows(this.rowsSpan.numberOfRows):!1}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row+this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n===E.REF||i===E.REF?E.REF:n||i?[n||e,i||t]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class aT extends hn{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return e.isInvalid(t)?E.REF:!1}transformCellRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?E.REF:!1}transformColumnRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?E.REF:!1}transformRowRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?E.REF:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class oT extends hn{constructor(e,t,r,n){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=n,this.dependentFormulaTransformer=new uT(e,t,r,n)}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}transformSingleAst(e,t){return this.sourceRange.addressInRange(t)?[this.transformAst(e,t),this.fixNodeAddress(t)]:this.dependentFormulaTransformer.transformSingleAst(e,t)}fixNodeAddress(e){return x(this.toSheet,e.col+this.toRight,e.row+this.toBottom)}transformCellAddress(e,t){return this.transformAddress(e,t)}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformAddress(e,t){const r=this.sourceRange;if(e instanceof Ne){const n=e.toSimpleCellAddress(t);if(r.addressInRange(n))return e.shiftAbsoluteDimensions(this.toRight,this.toBottom)}return e.shiftRelativeDimensions(-this.toRight,-this.toBottom)}transformRange(e,t,r){const n=this.sourceRange;if(e instanceof Ne&&t instanceof Ne){const i=e.toSimpleCellAddress(r),a=t.toSimpleCellAddress(r);if(n.addressInRange(i)&&n.addressInRange(a))return[e.shiftAbsoluteDimensions(this.toRight,this.toBottom),t.shiftAbsoluteDimensions(this.toRight,this.toBottom)]}return[e.shiftRelativeDimensions(-this.toRight,-this.toBottom),t.shiftRelativeDimensions(-this.toRight,-this.toBottom)]}}class uT extends hn{constructor(e,t,r,n){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=n}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.shouldMove(e,t)?e.moved(this.toSheet,this.toRight,this.toBottom):!1}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}shouldMove(e,t){return e instanceof Ne?this.sourceRange.addressInRange(e.toSimpleCellAddress(t)):e instanceof mt?this.sourceRange.rowInRange(e.toSimpleRowAddress(t))&&!this.sourceRange.isFinite():this.sourceRange.columnInRange(e.toSimpleColumnAddress(t))&&!this.sourceRange.isFinite()}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n&&i?[n,i]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class lT extends hn{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!0}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=cr(e,t);if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet!==r)return!1;if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet===r){const n=e.toSimpleColumnAddress(t);if(n.col<this.columnsSpan.columnStart)return!1;if(n.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet!==r){if(e.isColumnAbsolute())return!1;if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet===r)if(e.isColumnAbsolute()){if(e.col<this.columnsSpan.columnStart)return!1;if(e.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}else{const n=e.toSimpleColumnAddress(t);if(n.col<this.columnsSpan.columnStart){if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}else if(n.col>this.columnsSpan.columnEnd){if(t.col<this.columnsSpan.columnStart)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns);if(t.col>this.columnsSpan.columnEnd)return!1}}return E.REF}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col-this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const n=cr(e,r);let i=e,a=t;if(this.columnsSpan.sheet===n){const l=e.toSimpleColumnAddress(r),h=t.toSimpleColumnAddress(r);if(this.columnsSpan.columnStart<=l.col&&this.columnsSpan.columnEnd>=h.col)return E.REF;l.col>=this.columnsSpan.columnStart&&l.col<=this.columnsSpan.columnEnd&&(i=e.shiftedByColumns(this.columnsSpan.columnEnd-l.col+1)),h.col>=this.columnsSpan.columnStart&&h.col<=this.columnsSpan.columnEnd&&(a=t.shiftedByColumns(-(h.col-this.columnsSpan.columnStart+1)))}const o=this.transformCellAddress(i,r),u=this.transformCellAddress(a,r);if(o===!1&&u===!1)return[i,a];if(o===E.REF||u===E.REF)throw Error("Cannot happen");return[o||i,u||a]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class _o extends hn{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!0}transformColumnRangeAst(e,t){return e}transformCellAddress(e,t){const r=cr(e,t);if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet!==r)return!1;if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet===r){const n=e.toSimpleRowAddress(t);if(n.row<this.rowsSpan.rowStart)return!1;if(n.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet!==r){if(e.isRowAbsolute())return!1;if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet===r)if(e.isRowAbsolute()){if(e.row<this.rowsSpan.rowStart)return!1;if(e.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}else{const n=e.toSimpleRowAddress(t);if(n.row<this.rowsSpan.rowStart){if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}else if(n.row>this.rowsSpan.rowEnd){if(t.row<this.rowsSpan.rowStart)return e.shiftedByRows(-this.rowsSpan.numberOfRows);if(t.row>this.rowsSpan.rowEnd)return!1}}return E.REF}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row-this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const n=cr(e,r);let i=e,a=t;if(this.rowsSpan.sheet===n){const l=e.toSimpleRowAddress(r),h=t.toSimpleRowAddress(r);if(this.rowsSpan.rowStart<=l.row&&this.rowsSpan.rowEnd>=h.row)return E.REF;l.row>=this.rowsSpan.rowStart&&l.row<=this.rowsSpan.rowEnd&&(i=e.shiftedByRows(this.rowsSpan.rowEnd-l.row+1)),h.row>=this.rowsSpan.rowStart&&h.row<=this.rowsSpan.rowEnd&&(a=t.shiftedByRows(-(h.row-this.rowsSpan.rowStart+1)))}const o=this.transformCellAddress(i,r),u=this.transformCellAddress(a,r);return o===!1&&u===!1?[i,a]:o===E.REF||u===E.REF?E.REF:[o||i,u||a]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class cT extends hn{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[n]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService));r.setFormula(n)}}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.transformAddress(e)}transformCellRange(e,t,r){return this.transformAddress(e)}transformColumnRange(e,t,r){return this.transformAddress(e)}transformRowRange(e,t,r){return this.transformAddress(e)}transformAddress(e){return e.sheet===this.sheet?E.REF:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Ud(s){if(!Array.isArray(s))throw new We("an array of arrays.");for(let e=0;e<s.length;e++)if(!Array.isArray(s[e]))throw new We("an array of arrays.")}function ua(s){let e=0,t=0,r=0;for(let i=0;i<s.length;i++){let a=0;for(let o=0;o<s[i].length;o++){const u=s[i][o];u!=null&&(a=o+1,++r)}e=Math.max(e,a),a>0&&(t=i+1)}const n=e*t;return{height:t,width:e,fill:n===0?0:r/n}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Pd{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return la(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>It.fromNumberOfRows(this.sheet,e[0],e[1]))}}class Dd{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return ca(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>It.fromNumberOfRows(this.sheet,e[0],e[1]))}}class Vd{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return ca(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>Vt.fromNumberOfColumns(this.sheet,e[0],e[1]))}}class Bd{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return la(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>Vt.fromNumberOfColumns(this.sheet,e[0],e[1]))}}class hT{constructor(e,t,r,n,i,a,o,u,l){this.dependencyGraph=t,this.columnSearch=r,this.cellContentParser=n,this.parser=i,this.stats=a,this.lazilyTransformingAstService=o,this.namedExpressions=u,this.arraySizePredictor=l,this.changes=rn.empty(),this.allocateNamedExpressionAddressSpace(),this.maxColumns=e.maxColumns,this.maxRows=e.maxRows}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}removeRows(e){const t=[];for(const r of e.rowsSpans()){const n=this.doRemoveRows(r);n&&t.push(n)}return t}addRows(e){for(const t of e.rowsSpans())this.doAddRows(t)}addColumns(e){for(const t of e.columnsSpans())this.doAddColumns(t)}removeColumns(e){const t=[];for(const r of e.columnsSpans()){const n=this.doRemoveColumns(r);n&&t.push(n)}return t}removeSheet(e){this.dependencyGraph.removeSheet(e);let t=0;this.stats.measure(Y.TRANSFORM_ASTS,()=>{const n=new cT(e);n.performEagerTransformations(this.dependencyGraph,this.parser),t=this.lazilyTransformingAstService.addTransformation(n)}),this.sheetMapping.removeSheet(e),this.columnSearch.removeSheet(e);const r=this.namedExpressions.getAllNamedExpressionsForScope(e).map(n=>this.removeNamedExpression(n.normalizeExpressionName(),e));return{version:t,scopedNamedExpressions:r}}removeSheetByName(e){const t=this.sheetMapping.fetch(e);return this.removeSheet(t)}clearSheet(e){this.dependencyGraph.clearSheet(e),this.columnSearch.removeSheet(e)}addSheet(e){const t=this.sheetMapping.addSheet(e),r=[];return this.dependencyGraph.addressMapping.autoAddSheet(t,ua(r)),this.sheetMapping.fetchDisplayName(t)}renameSheet(e,t){return this.sheetMapping.renameSheet(e,t)}moveRows(e,t,r,n){const i=It.fromNumberOfRows(e,n,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddRows(i),n<t&&(t+=r);const a=x(e,0,t),o=x(e,0,n);this.moveCells(a,Number.POSITIVE_INFINITY,r,o);const u=It.fromNumberOfRows(e,t,r);return this.doRemoveRows(u),this.lazilyTransformingAstService.commitCombinedMode()}moveColumns(e,t,r,n){const i=Vt.fromNumberOfColumns(e,n,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddColumns(i),n<t&&(t+=r);const a=x(e,t,0),o=x(e,n,0);this.moveCells(a,r,Number.POSITIVE_INFINITY,o);const u=Vt.fromNumberOfColumns(e,t,r);return this.doRemoveColumns(u),this.lazilyTransformingAstService.commitCombinedMode()}moveCells(e,t,r,n){this.ensureItIsPossibleToMoveCells(e,t,r,n);const i=B.spanFrom(e,t,r),a=B.spanFrom(n,t,r),o=n.col-e.col,u=n.row-e.row,l=n.sheet,h=this.getRangeClipboardCells(a),d=this.dependencyGraph.rawValuesFromRange(a);this.columnSearch.removeValues(d);const f=this.dependencyGraph.rawValuesFromRange(i);this.columnSearch.moveValues(f,o,u,l);let p=0;this.stats.measure(Y.TRANSFORM_ASTS,()=>{const g=new oT(i,o,u,l);g.performEagerTransformations(this.dependencyGraph,this.parser),p=this.lazilyTransformingAstService.addTransformation(g)}),this.dependencyGraph.moveCells(i,o,u,l);const N=this.updateNamedExpressionsForMovedCells(e,t,r,n);return{version:p,overwrittenCellsData:h,addedGlobalNamedExpressions:N}}setRowOrder(e,t){const r=[];let n=[];for(const[i,a]of t)if(i!==a){const o=B.spanFrom({sheet:e,col:0,row:i},1/0,1),u=this.getRangeClipboardCells(o);n=n.concat(u),r.push(u.map(([{sheet:l,col:h},d])=>[{sheet:l,col:h,row:a},d]))}return r.forEach(i=>this.restoreClipboardCells(e,i.values())),n}setColumnOrder(e,t){const r=[];let n=[];for(const[i,a]of t)if(i!==a){const o=B.spanFrom({sheet:e,col:i,row:0},1,1/0),u=this.getRangeClipboardCells(o);n=n.concat(u),r.push(u.map(([{sheet:l,col:h,row:d},f])=>[{sheet:l,col:a,row:d},f]))}return r.forEach(i=>this.restoreClipboardCells(e,i.values())),n}addNamedExpression(e,t,r,n){const i=this.namedExpressions.addNamedExpression(e,r,n);this.storeNamedExpressionInCell(i.address,t),this.adjustNamedExpressionEdges(i,e,r)}restoreNamedExpression(e,t,r){const n=e.displayName;this.restoreCell(e.address,t);const i=this.namedExpressions.restoreNamedExpression(e,r);this.adjustNamedExpressionEdges(i,n,r)}changeNamedExpressionExpression(e,t,r,n){const i=this.namedExpressions.namedExpressionForScope(e,r);if(!i)throw new zs(e);const a=i.copy();i.options=n;const o=this.getClipboardCell(i.address);return this.storeNamedExpressionInCell(i.address,t),[a,o]}removeNamedExpression(e,t){const r=this.namedExpressions.namedExpressionForScope(e,t);if(!r)throw new zs(e);this.namedExpressions.remove(r.displayName,t);const n=this.getClipboardCell(r.address);if(t!==void 0){const i=this.namedExpressions.workbookNamedExpressionOrPlaceholder(e);this.dependencyGraph.exchangeNode(r.address,i.address)}else this.dependencyGraph.setCellEmpty(r.address);return[r,n]}ensureItIsPossibleToMoveCells(e,t,r,n){if(Ct(e)||!(ha(t)&&ha(r)||dT(e,t,r))||Ct(n)||!this.sheetMapping.hasSheetWithId(e.sheet)||!this.sheetMapping.hasSheetWithId(n.sheet))throw new We("a valid range of cells to move.");const i=B.spanFrom(e,t,r),a=B.spanFrom(n,t,r);if(a.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new vn;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new zn;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(a))throw new ra}restoreClipboardCells(e,t){const r=[];for(const[n,i]of t)if(this.restoreCell(n,i),i.type===lt.FORMULA){const{dependencies:a}=this.parser.fetchCachedResult(i.hash);r.push(...this.updateNamedExpressionsForTargetAddress(e,n,a))}return r}restoreCell(e,t){switch(t.type){case lt.VALUE:{this.setValueToCell(t,e);break}case lt.FORMULA:{this.setFormulaToCellFromCache(t.hash,e);break}case lt.EMPTY:{this.setCellEmpty(e);break}case lt.PARSING_ERROR:{this.setParsingErrorToCell(t.rawInput,t.errors,e);break}}}getOldContent(e){const t=this.dependencyGraph.getCell(e);if(t===void 0||t instanceof Jr)return[e,{type:lt.EMPTY}];if(t instanceof nn)return[e,Object.assign({type:lt.VALUE},t.getValues())];if(t instanceof Bt)return[t.getAddress(this.lazilyTransformingAstService),{type:lt.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))}];if(t instanceof Xn)return[e,{type:lt.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}];throw Error("Trying to copy unsupported type")}getClipboardCell(e){const t=this.dependencyGraph.getCell(e);if(t===void 0||t instanceof Jr)return{type:lt.EMPTY};if(t instanceof nn)return Object.assign({type:lt.VALUE},t.getValues());if(t instanceof ke){const r=t.getArrayCellValue(e);return r===Z?{type:lt.EMPTY}:{type:lt.VALUE,parsedValue:r,rawValue:t.getArrayCellRawValue(e)}}else{if(t instanceof vr)return{type:lt.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))};if(t instanceof Xn)return{type:lt.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}}throw Error("Trying to copy unsupported type")}getSheetClipboardCells(e){const t=this.dependencyGraph.getSheetHeight(e),r=this.dependencyGraph.getSheetWidth(e),n=new Array(t);for(let i=0;i<t;i++){n[i]=new Array(r);for(let a=0;a<r;a++){const o=x(e,a,i);n[i][a]=this.getClipboardCell(o)}}return n}getRangeClipboardCells(e){const t=[];for(const r of e.addresses(this.dependencyGraph))t.push([r,this.getClipboardCell(r)]);return t}setCellContent(e,t){const r=this.cellContentParser.parse(t),n=this.getOldContent(e);if(r instanceof Ie.Formula){const i=this.parser.parse(r.formula,e),{ast:a,errors:o}=i;if(o.length>0)this.setParsingErrorToCell(r.formula,o,e);else try{const u=this.arraySizePredictor.checkArraySize(a,e);if(u.width<=0||u.height<=0)throw Error("Incorrect array size");this.setFormulaToCell(e,u,i)}catch(u){if(!u.message)throw u;const l={type:Le.InvalidRangeSize,message:"Invalid range size."};this.setParsingErrorToCell(r.formula,[l],e)}}else r instanceof Ie.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e);return n}setSheetContent(e,t){this.clearSheet(e);for(let r=0;r<t.length;r++)for(let n=0;n<t[r].length;n++){const i=x(e,n,r);this.setCellContent(i,t[r][n])}}setParsingErrorToCell(e,t,r){const n=this.dependencyGraph.getCellValue(r),i=new Xn(t,e),a=this.dependencyGraph.setParsingErrorToCell(r,i);this.columnSearch.remove(b(n),r),this.columnSearch.applyChanges(a.getChanges()),this.changes.addAll(a),this.changes.addChange(i.getCellValue(),r)}setFormulaToCell(e,t,{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}){const o=this.dependencyGraph.getCellValue(e),u=this.dependencyGraph.setFormulaToCell(e,r,Tr(a,e),t,n,i);this.columnSearch.remove(b(o),e),this.columnSearch.applyChanges(u.getChanges()),this.changes.addAll(u)}setValueToCell(e,t){const r=this.dependencyGraph.getCellValue(t),n=this.dependencyGraph.setValueToCell(t,e);this.columnSearch.change(b(r),b(e.parsedValue),t),this.columnSearch.applyChanges(n.getChanges().filter(i=>!js(i.address,t))),this.changes.addAll(n),this.changes.addChange(e.parsedValue,t)}setCellEmpty(e){if(this.dependencyGraph.isArrayInternalCell(e))return;const t=this.dependencyGraph.getCellValue(e),r=this.dependencyGraph.setCellEmpty(e);this.columnSearch.remove(b(t),e),this.columnSearch.applyChanges(r.getChanges()),this.changes.addAll(r),this.changes.addChange(Z,e)}setFormulaToCellFromCache(e,t){const{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}=this.parser.fetchCachedResult(e),o=Tr(a,t),[u]=new aT(t.sheet).transformSingleAst(r,t);this.parser.rememberNewAst(u);const l=VN(o),h=this.arraySizePredictor.checkArraySize(r,t);this.dependencyGraph.setFormulaToCell(t,u,l,h,n,i)}rowEffectivelyNotInSheet(e,t){const r=this.dependencyGraph.addressMapping.getHeight(t);return e>=r}getAndClearContentChanges(){const e=this.changes;return this.changes=rn.empty(),e}forceApplyPostponedTransformations(){this.dependencyGraph.forceApplyPostponedTransformations()}doRemoveRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const t=[];for(const[a]of this.dependencyGraph.entriesFromRowsSpan(e))t.push({address:a,cellType:this.getClipboardCell(a)});const{affectedArrays:r,contentChanges:n}=this.dependencyGraph.removeRows(e);this.columnSearch.applyChanges(n.getChanges());let i=0;return this.stats.measure(Y.TRANSFORM_ASTS,()=>{const a=new _o(e);a.performEagerTransformations(this.dependencyGraph,this.parser),i=this.lazilyTransformingAstService.addTransformation(a)}),this.rewriteAffectedArrays(r),{version:i,removedCells:t,rowFrom:e.rowStart,rowCount:e.numberOfRows}}doRemoveColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const t=[];for(const[a]of this.dependencyGraph.entriesFromColumnsSpan(e))t.push({address:a,cellType:this.getClipboardCell(a)});const{affectedArrays:r,contentChanges:n}=this.dependencyGraph.removeColumns(e);this.columnSearch.applyChanges(n.getChanges()),this.columnSearch.removeColumns(e);let i=0;return this.stats.measure(Y.TRANSFORM_ASTS,()=>{const a=new lT(e);a.performEagerTransformations(this.dependencyGraph,this.parser),i=this.lazilyTransformingAstService.addTransformation(a)}),this.rewriteAffectedArrays(r),{version:i,removedCells:t,columnFrom:e.columnStart,columnCount:e.numberOfColumns}}doAddRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const{affectedArrays:t}=this.dependencyGraph.addRows(e);this.stats.measure(Y.TRANSFORM_ASTS,()=>{const r=new xo(e);r.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(r)}),this.rewriteAffectedArrays(t)}rewriteAffectedArrays(e){for(const t of e.values()){if(t.array.size.isRef)continue;const r=t.getFormula(this.lazilyTransformingAstService),n=t.getAddress(this.lazilyTransformingAstService),i=this.parser.computeHashFromAst(r);this.setFormulaToCellFromCache(i,n)}}doAddColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const{affectedArrays:t,contentChanges:r}=this.dependencyGraph.addColumns(e);this.columnSearch.addColumns(e),this.columnSearch.applyChanges(r.getChanges()),this.stats.measure(Y.TRANSFORM_ASTS,()=>{const n=new iT(e);n.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(n)}),this.rewriteAffectedArrays(t)}columnEffectivelyNotInSheet(e,t){const r=this.dependencyGraph.addressMapping.getWidth(t);return e>=r}adjustNamedExpressionEdges(e,t,r){if(r===void 0)return;const{vertex:n,id:i}=this.dependencyGraph.fetchCellOrCreateEmpty(e.address),a=i??this.dependencyGraph.graph.getNodeId(n),o=this.namedExpressions.workbookNamedExpressionOrPlaceholder(t),{vertex:u,id:l}=this.dependencyGraph.fetchCellOrCreateEmpty(o.address),h=l??this.dependencyGraph.graph.getNodeId(u);for(const d of this.dependencyGraph.graph.adjacentNodes(u))if(d instanceof vr&&d.getAddress(this.lazilyTransformingAstService).sheet===r){const f=d.getFormula(this.lazilyTransformingAstService),p=d.getAddress(this.lazilyTransformingAstService),{dependencies:N}=this.parser.fetchCachedResultForAst(f);for(const g of Tr(N,p))g instanceof Dr&&g.name.toLowerCase()===e.displayName.toLowerCase()&&(this.dependencyGraph.graph.removeEdgeIfExists(h,d),this.dependencyGraph.graph.addEdge(a,d))}}storeNamedExpressionInCell(e,t){const r=this.cellContentParser.parse(t);if(r instanceof Ie.Formula){const n=this.parser.parse(r.formula,x(-1,0,0));if(qr(n.ast))throw new Ru;const{ast:i,hasVolatileFunction:a,hasStructuralChangeFunction:o,dependencies:u}=n;this.dependencyGraph.setFormulaToCell(e,i,Tr(u,e),X.scalar(),a,o)}else r instanceof Ie.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e)}updateNamedExpressionsForMovedCells(e,t,r,n){if(e.sheet===n.sheet)return[];const i=[],a=B.spanFrom(n,t,r);for(const o of a.addresses(this.dependencyGraph)){const u=this.addressMapping.fetchCell(o);if(u instanceof vr&&o.sheet!==e.sheet){const l=u.getFormula(this.lazilyTransformingAstService),{dependencies:h}=this.parser.fetchCachedResultForAst(l);i.push(...this.updateNamedExpressionsForTargetAddress(e.sheet,o,h))}}return i}updateNamedExpressionsForTargetAddress(e,t,r){if(e===t.sheet)return[];const n=[],i=this.addressMapping.fetchCell(t);for(const a of Tr(r,t)){if(!(a instanceof Dr))continue;const o=a.name,u=this.dependencyGraph.fetchNamedExpressionVertex(o,e).vertex,h=this.namedExpressions.isExpressionInScope(o,t.sheet)?this.dependencyGraph.fetchNamedExpressionVertex(o,t.sheet).vertex:this.copyOrFetchGlobalNamedExpressionVertex(o,u,n);h!==u&&(this.dependencyGraph.graph.removeEdgeIfExists(u,i),this.dependencyGraph.graph.addEdge(h,i))}return n}allocateNamedExpressionAddressSpace(){this.dependencyGraph.addressMapping.addSheet(wn.SHEET_FOR_WORKBOOK_EXPRESSIONS,new sy(0,0))}copyOrFetchGlobalNamedExpressionVertex(e,t,r){let n=this.namedExpressions.namedExpressionForScope(e);if(n===void 0)if(n=this.namedExpressions.addNamedExpression(e),r.push(n.normalizeExpressionName()),t instanceof vr){const i=this.parser.fetchCachedResultForAst(t.getFormula(this.lazilyTransformingAstService)),{ast:a,hasVolatileFunction:o,hasStructuralChangeFunction:u,dependencies:l}=i;this.dependencyGraph.setFormulaToCell(n.address,a,Tr(l,n.address),X.scalar(),o,u)}else t instanceof Jr?this.setCellEmpty(n.address):t instanceof nn&&this.setValueToCell(t.getValues(),n.address);return this.dependencyGraph.fetchCellOrCreateEmpty(n.address).vertex}}function la(s){if(s.length<=1)return s;const e=[...s].sort(([n],[i])=>n-i),t=e.reduce((n,[i,a])=>{const o=n[n.length-1],u=o[0]+o[1];return i<=u?o[1]+=Math.max(0,a-(u-i)):n.push([i,a]),n},[e[0]]);let r=0;for(let n=0;n<t.length;++n)t[n][0]-=r,r+=t[n][1];return t}function ca(s){if(s.length<=1)return s;const e=[...s].sort(([n],[i])=>n-i),t=e.reduce((n,[i,a])=>{const o=n[n.length-1];return i===o[0]?o[1]=Math.max(o[1],a):n.push([i,a]),n},[e[0]]);let r=0;for(let n=0;n<t.length;++n)t[n][0]+=r,r+=t[n][1];return t}function ha(s){return Number.isInteger(s)&&s>0}function dT(s,e,t){return s.row===0&&ha(e)&&t===Number.POSITIVE_INFINITY||s.col===0&&ha(t)&&e===Number.POSITIVE_INFINITY}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ze{}class fT extends ze{constructor(e,t){super(),this.command=e,this.rowsRemovals=t}doUndo(e){e.undoRemoveRows(this)}doRedo(e){e.redoRemoveRows(this)}}class pT extends ze{constructor(e,t,r,n,i,a,o){super(),this.sourceLeftCorner=e,this.width=t,this.height=r,this.destinationLeftCorner=n,this.overwrittenCellsData=i,this.addedGlobalNamedExpressions=a,this.version=o}doUndo(e){e.undoMoveCells(this)}doRedo(e){e.redoMoveCells(this)}}class mT extends ze{constructor(e){super(),this.command=e}doUndo(e){e.undoAddRows(this)}doRedo(e){e.redoAddRows(this)}}class gT extends ze{constructor(e,t,r){super(),this.sheetId=e,this.rowMapping=t,this.oldContent=r}doUndo(e){e.undoSetRowOrder(this)}doRedo(e){e.redoSetRowOrder(this)}}class ET extends ze{constructor(e,t,r){super(),this.sheetId=e,this.columnMapping=t,this.oldContent=r}doUndo(e){e.undoSetColumnOrder(this)}doRedo(e){e.redoSetColumnOrder(this)}}class RT extends ze{constructor(e,t,r){super(),this.sheetId=e,this.oldSheetContent=t,this.newSheetContent=r}doUndo(e){e.undoSetSheetContent(this)}doRedo(e){e.redoSetSheetContent(this)}}class NT extends ze{constructor(e,t,r,n,i){super(),this.sheet=e,this.startRow=t,this.numberOfRows=r,this.targetRow=n,this.version=i,this.undoStart=this.startRow<this.targetRow?this.targetRow-this.numberOfRows:this.targetRow,this.undoEnd=this.startRow>this.targetRow?this.startRow+this.numberOfRows:this.startRow}doUndo(e){e.undoMoveRows(this)}doRedo(e){e.redoMoveRows(this)}}class yT extends ze{constructor(e,t,r,n,i){super(),this.sheet=e,this.startColumn=t,this.numberOfColumns=r,this.targetColumn=n,this.version=i,this.undoStart=this.startColumn<this.targetColumn?this.targetColumn-this.numberOfColumns:this.targetColumn,this.undoEnd=this.startColumn>this.targetColumn?this.startColumn+this.numberOfColumns:this.startColumn}doUndo(e){e.undoMoveColumns(this)}doRedo(e){e.redoMoveColumns(this)}}class TT extends ze{constructor(e){super(),this.command=e}doUndo(e){e.undoAddColumns(this)}doRedo(e){e.redoAddColumns(this)}}class vT extends ze{constructor(e,t){super(),this.command=e,this.columnsRemovals=t}doUndo(e){e.undoRemoveColumns(this)}doRedo(e){e.redoRemoveColumns(this)}}class ST extends ze{constructor(e){super(),this.sheetName=e}doUndo(e){e.undoAddSheet(this)}doRedo(e){e.redoAddSheet(this)}}class AT extends ze{constructor(e,t,r,n,i){super(),this.sheetName=e,this.sheetId=t,this.oldSheetContent=r,this.scopedNamedExpressions=n,this.version=i}doUndo(e){e.undoRemoveSheet(this)}doRedo(e){e.redoRemoveSheet(this)}}class CT extends ze{constructor(e,t,r){super(),this.sheetId=e,this.oldName=t,this.newName=r}doUndo(e){e.undoRenameSheet(this)}doRedo(e){e.redoRenameSheet(this)}}class IT extends ze{constructor(e,t){super(),this.sheetId=e,this.oldSheetContent=t}doUndo(e){e.undoClearSheet(this)}doRedo(e){e.redoClearSheet(this)}}class wT extends ze{constructor(e){super(),this.cellContents=e}doUndo(e){e.undoSetCellContents(this)}doRedo(e){e.redoSetCellContents(this)}}class MT extends ze{constructor(e,t,r,n){super(),this.targetLeftCorner=e,this.oldContent=t,this.newContent=r,this.addedGlobalNamedExpressions=n}doUndo(e){e.undoPaste(this)}doRedo(e){e.redoPaste(this)}}class OT extends ze{constructor(e,t,r,n){super(),this.name=e,this.newContent=t,this.scope=r,this.options=n}doUndo(e){e.undoAddNamedExpression(this)}doRedo(e){e.redoAddNamedExpression(this)}}class bT extends ze{constructor(e,t,r){super(),this.namedExpression=e,this.content=t,this.scope=r}doUndo(e){e.undoRemoveNamedExpression(this)}doRedo(e){e.redoRemoveNamedExpression(this)}}class xT extends ze{constructor(e,t,r,n,i){super(),this.namedExpression=e,this.newContent=t,this.oldContent=r,this.scope=n,this.options=i}doUndo(e){e.undoChangeNamedExpression(this)}doRedo(e){e.redoChangeNamedExpression(this)}}class _T extends ze{constructor(){super(...arguments),this.operations=[]}add(e){this.operations.push(e)}*reversedOperations(){for(let e=this.operations.length-1;e>=0;e--)yield this.operations[e]}doUndo(e){e.undoBatch(this)}doRedo(e){e.redoBatch(this)}}class LT{constructor(e,t){this.operations=t,this.oldData=new Map,this.undoStack=[],this.redoStack=[],this.undoLimit=e.undoLimit}saveOperation(e){this.batchUndoEntry!==void 0?this.batchUndoEntry.add(e):this.addUndoEntry(e)}beginBatchMode(){this.batchUndoEntry=new _T}commitBatchMode(){if(this.batchUndoEntry===void 0)throw Error("Batch mode wasn't started");this.addUndoEntry(this.batchUndoEntry),this.batchUndoEntry=void 0}storeDataForVersion(e,t,r){this.oldData.has(e)||this.oldData.set(e,[]),this.oldData.get(e).push([t,r])}clearRedoStack(){this.redoStack=[]}clearUndoStack(){this.undoStack=[]}isUndoStackEmpty(){return this.undoStack.length===0}isRedoStackEmpty(){return this.redoStack.length===0}undo(){const e=this.undoStack.pop();if(!e)throw Error("Attempted to undo without operation on stack");this.undoEntry(e),this.redoStack.push(e)}undoBatch(e){for(const t of e.reversedOperations())this.undoEntry(t)}undoRemoveRows(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},rowsRemovals:r}=e;for(let n=r.length-1;n>=0;--n){const i=r[n];this.operations.addRows(new Dd(t,[[i.rowFrom,i.rowCount]]));for(const{address:a,cellType:o}of i.removedCells)this.operations.restoreCell(a,o);this.restoreOldDataFromVersion(i.version-1)}}undoRemoveColumns(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},columnsRemovals:r}=e;for(let n=r.length-1;n>=0;--n){const i=r[n];this.operations.addColumns(new Vd(t,[[i.columnFrom,i.columnCount]]));for(const{address:a,cellType:o}of i.removedCells)this.operations.restoreCell(a,o);this.restoreOldDataFromVersion(i.version-1)}}undoAddRows(e){const t=e.command.rowsSpans();for(let r=t.length-1;r>=0;--r){const n=t[r];this.operations.removeRows(new Pd(e.command.sheet,[[n.rowStart,n.numberOfRows]]))}}undoAddColumns(e){const t=e.command.columnsSpans();for(let r=t.length-1;r>=0;--r){const n=t[r];this.operations.removeColumns(new Bd(e.command.sheet,[[n.columnStart,n.numberOfColumns]]))}}undoSetCellContents(e){for(const t of e.cellContents){const r=t.address,[n,i]=t.oldContent;js(r,n)||this.operations.setCellEmpty(r),this.operations.restoreCell(n,i)}}undoPaste(e){this.restoreOperationOldContent(e.oldContent);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoMoveRows(e){const{sheet:t}=e;this.operations.moveRows(t,e.undoStart,e.numberOfRows,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveColumns(e){const{sheet:t}=e;this.operations.moveColumns(t,e.undoStart,e.numberOfColumns,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveCells(e){this.operations.forceApplyPostponedTransformations(),this.operations.moveCells(e.destinationLeftCorner,e.width,e.height,e.sourceLeftCorner),this.restoreOperationOldContent(e.overwrittenCellsData),this.restoreOldDataFromVersion(e.version-1);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoAddSheet(e){const{sheetName:t}=e;this.operations.removeSheetByName(t)}undoRemoveSheet(e){this.operations.forceApplyPostponedTransformations();const{oldSheetContent:t,sheetId:r}=e;this.operations.addSheet(e.sheetName);for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=x(r,a,n);this.operations.restoreCell(u,o)}}for(const[n,i]of e.scopedNamedExpressions)this.operations.restoreNamedExpression(n,i,r);this.restoreOldDataFromVersion(e.version-1)}undoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.oldName)}undoClearSheet(e){const{oldSheetContent:t,sheetId:r}=e;for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=x(r,a,n);this.operations.restoreCell(u,o)}}}undoSetSheetContent(e){const{oldSheetContent:t,sheetId:r}=e;this.operations.clearSheet(r);for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=x(r,a,n);this.operations.restoreCell(u,o)}}}undoAddNamedExpression(e){this.operations.removeNamedExpression(e.name,e.scope)}undoRemoveNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.content,e.scope)}undoChangeNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.oldContent,e.scope)}undoSetRowOrder(e){this.restoreOperationOldContent(e.oldContent)}undoSetColumnOrder(e){this.restoreOperationOldContent(e.oldContent)}redo(){const e=this.redoStack.pop();if(!e)throw Error("Attempted to redo without operation on stack");this.redoEntry(e),this.undoStack.push(e)}redoBatch(e){for(const t of e.operations)this.redoEntry(t)}redoRemoveRows(e){this.operations.removeRows(e.command)}redoMoveCells(e){this.operations.moveCells(e.sourceLeftCorner,e.width,e.height,e.destinationLeftCorner)}redoRemoveColumns(e){this.operations.removeColumns(e.command)}redoPaste(e){const{targetLeftCorner:t,newContent:r}=e,n=r.length,i=r[0].length;for(let a=0;a<n;++a)for(let o=0;o<i;++o){const u=x(t.sheet,t.col+o,t.row+a);this.operations.restoreCell(u,r[a][o])}}redoSetCellContents(e){for(const t of e.cellContents)this.operations.setCellContent(t.address,t.newContent)}redoAddRows(e){this.operations.addRows(e.command)}redoAddColumns(e){this.operations.addColumns(e.command)}redoRemoveSheet(e){this.operations.removeSheetByName(e.sheetName)}redoAddSheet(e){this.operations.addSheet(e.sheetName)}redoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.newName)}redoMoveRows(e){this.operations.moveRows(e.sheet,e.startRow,e.numberOfRows,e.targetRow)}redoMoveColumns(e){this.operations.moveColumns(e.sheet,e.startColumn,e.numberOfColumns,e.targetColumn)}redoClearSheet(e){this.operations.clearSheet(e.sheetId)}redoSetSheetContent(e){const{sheetId:t,newSheetContent:r}=e;this.operations.setSheetContent(t,r)}redoAddNamedExpression(e){this.operations.addNamedExpression(e.name,e.newContent,e.scope,e.options)}redoRemoveNamedExpression(e){this.operations.removeNamedExpression(e.namedExpression.displayName,e.scope)}redoChangeNamedExpression(e){this.operations.changeNamedExpressionExpression(e.namedExpression.displayName,e.newContent,e.scope,e.options)}redoSetRowOrder(e){this.operations.setRowOrder(e.sheetId,e.rowMapping)}redoSetColumnOrder(e){this.operations.setColumnOrder(e.sheetId,e.columnMapping)}addUndoEntry(e){this.undoStack.push(e),this.undoStack.splice(0,Math.max(0,this.undoStack.length-this.undoLimit))}undoEntry(e){e.doUndo(this)}restoreOperationOldContent(e){for(const[t,r]of e)this.operations.restoreCell(t,r)}redoEntry(e){e.doRedo(this)}restoreOldDataFromVersion(e){const t=this.oldData.get(e)||[];for(const r of t){const[n,i]=r;this.operations.setFormulaToCellFromCache(i,n)}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class FT{constructor(e,t,r,n,i,a,o,u,l,h){this.operations=t,this.undoRedo=r,this.clipboardOperations=n,this.dependencyGraph=i,this.columnSearch=a,this.parser=o,this.cellContentParser=u,this.lazilyTransformingAstService=l,this.namedExpressions=h,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}get sheetMapping(){return this.dependencyGraph.sheetMapping}addRows(e,...t){const r=new Dd(e,t);this.ensureItIsPossibleToAddRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(r),this.undoRedo.saveOperation(new mT(r))}removeRows(e,...t){const r=new Pd(e,t);this.ensureItIsPossibleToRemoveRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.removeRows(r);this.undoRedo.saveOperation(new fT(r,n))}addColumns(e,...t){const r=new Vd(e,t);this.ensureItIsPossibleToAddColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(r),this.undoRedo.saveOperation(new TT(r))}removeColumns(e,...t){const r=new Bd(e,t);this.ensureItIsPossibleToRemoveColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.removeColumns(r);this.undoRedo.saveOperation(new vT(r,n))}moveCells(e,t,r,n){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const{version:i,overwrittenCellsData:a,addedGlobalNamedExpressions:o}=this.operations.moveCells(e,t,r,n);this.undoRedo.saveOperation(new pT(e,t,r,n,a,o,i))}moveRows(e,t,r,n){this.ensureItIsPossibleToMoveRows(e,t,r,n),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const i=this.operations.moveRows(e,t,r,n);this.undoRedo.saveOperation(new NT(e,t,r,n,i))}moveColumns(e,t,r,n){this.ensureItIsPossibleToMoveColumns(e,t,r,n),this.undoRedo.clearRedoStack();const i=this.operations.moveColumns(e,t,r,n);this.undoRedo.saveOperation(new yT(e,t,r,n,i))}cut(e,t,r){this.clipboardOperations.cut(e,t,r)}ensureItIsPossibleToCopy(e,t,r){if(!Fn(t))throw new We("width to be positive integer.");if(!Fn(r))throw new We("height to be positive integer.")}copy(e,t,r){this.ensureItIsPossibleToCopy(e,t,r),this.clipboardOperations.copy(e,t,r)}paste(e){const t=this.clipboardOperations.clipboard;if(t===void 0)throw new fd;if(this.clipboardOperations.isCutClipboard())this.moveCells(t.sourceLeftCorner,t.width,t.height,e);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(e);const r=B.spanFrom(e,t.width,t.height),n=this.operations.getRangeClipboardCells(r);this.undoRedo.clearRedoStack();const i=this.operations.restoreClipboardCells(t.sourceLeftCorner.sheet,t.getContent(e));this.undoRedo.saveOperation(new MT(e,n,t.content,i))}}beginUndoRedoBatchMode(){this.undoRedo.beginBatchMode()}commitUndoRedoBatchMode(){this.undoRedo.commitBatchMode()}isClipboardEmpty(){return this.clipboardOperations.clipboard===void 0}clearClipboard(){this.clipboardOperations.clear()}addSheet(e){e!==void 0&&this.ensureItIsPossibleToAddSheet(e),this.undoRedo.clearRedoStack();const t=this.operations.addSheet(e);return this.undoRedo.saveOperation(new ST(t)),t}removeSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.sheetMapping.fetchDisplayName(e),r=this.operations.getSheetClipboardCells(e),{version:n,scopedNamedExpressions:i}=this.operations.removeSheet(e);this.undoRedo.saveOperation(new AT(t,e,r,i,n))}renameSheet(e,t){this.ensureItIsPossibleToRenameSheet(e,t);const r=this.operations.renameSheet(e,t);return r!==void 0&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new CT(e,r,t))),r}clearSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.operations.getSheetClipboardCells(e);this.operations.clearSheet(e),this.undoRedo.saveOperation(new IT(e,t))}setCellContents(e,t){if(!(t instanceof Array))t=[[t]];else for(let n=0;n<t.length;n++)if(!(t[n]instanceof Array))throw new We("an array of arrays or a raw cell value.");this.ensureItIsPossibleToChangeCellContents(e,t),this.undoRedo.clearRedoStack();const r=[];for(let n=0;n<t.length;n++)for(let i=0;i<t[n].length;i++){const a={sheet:e.sheet,row:e.row+n,col:e.col+i},o=t[n][i];this.clipboardOperations.abortCut();const u=this.operations.setCellContent(a,o);r.push({address:a,newContent:o,oldContent:u})}this.undoRedo.saveOperation(new wT(r))}setSheetContent(e,t){this.ensureScopeIdIsValid(e),this.ensureItIsPossibleToChangeSheetContents(e,t),Ud(t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.getSheetClipboardCells(e);this.operations.setSheetContent(e,t),this.undoRedo.saveOperation(new RT(e,r,t))}setRowOrder(e,t){this.validateSwapRowIndexes(e,t),this.testRowOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setRowOrder(e,t);this.undoRedo.saveOperation(new gT(e,t,r))}validateSwapRowIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new Oe(e);this.validateRowOrColumnMapping(e,t,"row")}testColumnOrderForArrays(e,t){for(const[r,n]of t)if(r!==n){const i=B.spanFrom({sheet:e,col:r,row:0},1,1/0);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new zn}}setColumnOrder(e,t){this.validateSwapColumnIndexes(e,t),this.testColumnOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setColumnOrder(e,t);this.undoRedo.saveOperation(new ET(e,t,r))}validateSwapColumnIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new Oe(e);this.validateRowOrColumnMapping(e,t,"column")}testRowOrderForArrays(e,t){for(const[r,n]of t)if(r!==n){const i=B.spanFrom({sheet:e,col:0,row:r},1/0,1);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new zn}}mappingFromOrder(e,t,r){if(!this.sheetMapping.hasSheetWithId(e))throw new Oe(e);const n=r==="row"?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e);if(t.length!==n)throw new We(`number of ${r}s provided to be sheet ${r==="row"?"height":"width"}.`);const i=[];for(let a=0;a<n;a++)t[a]!==a&&i.push([a,t[a]]);return i}undo(){if(this.undoRedo.isUndoStackEmpty())throw new hd;this.clipboardOperations.abortCut(),this.undoRedo.undo()}redo(){if(this.undoRedo.isRedoStackEmpty())throw new dd;this.clipboardOperations.abortCut(),this.undoRedo.redo()}addNamedExpression(e,t,r,n){this.ensureItIsPossibleToAddNamedExpression(e,t,r),this.operations.addNamedExpression(e,t,r,n),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new OT(e,t,r,n))}changeNamedExpressionExpression(e,t,r,n){this.ensureItIsPossibleToChangeNamedExpression(e,r,t);const[i,a]=this.operations.changeNamedExpressionExpression(e,r,t,n);this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new xT(i,r,a,t,n))}removeNamedExpression(e,t){this.ensureScopeIdIsValid(t);const[r,n]=this.operations.removeNamedExpression(e,t);return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new bT(r,n,t)),r}ensureItIsPossibleToAddNamedExpression(e,t,r){this.ensureScopeIdIsValid(r),this.ensureNamedExpressionNameIsValid(e,r),this.ensureNamedExpressionIsValid(t)}ensureItIsPossibleToChangeNamedExpression(e,t,r){if(this.ensureScopeIdIsValid(r),this.namedExpressions.namedExpressionForScope(e,r)===void 0)throw new zs(e);this.ensureNamedExpressionIsValid(t)}isItPossibleToRemoveNamedExpression(e,t){if(this.ensureScopeIdIsValid(t),this.namedExpressions.namedExpressionForScope(e,t)===void 0)throw new zs(e)}ensureItIsPossibleToAddRows(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new Oe(e);const r=this.dependencyGraph.getSheetHeight(e),n=t.map(i=>i[1]).reduce((i,a)=>i+a,0);if(r+n>this.maxRows)throw new vn;for(const[i,a]of t)if(!dn(i)||!Fn(a))throw new We("row number to be nonnegative and number of rows to add to be positive.")}ensureItIsPossibleToRemoveRows(e,...t){for(const[r,n]of t){const i=r+n-1;if(!dn(r)||!dn(i))throw new We("starting and ending row to be nonnegative.");if(i<r)throw new We("starting row to be smaller than the ending row.");if(!this.sheetMapping.hasSheetWithId(e))throw new Oe(e)}}ensureItIsPossibleToAddColumns(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new Oe(e);const r=this.dependencyGraph.getSheetWidth(e),n=t.map(i=>i[1]).reduce((i,a)=>i+a,0);if(r+n>this.maxColumns)throw new vn;for(const[i,a]of t)if(!dn(i)||!Fn(a))throw new We("column number to be nonnegative and number of columns to add to be positive.")}ensureItIsPossibleToRemoveColumns(e,...t){for(const[r,n]of t){const i=r+n-1;if(!dn(r)||!dn(i))throw new We("starting and ending column to be nonnegative.");if(i<r)throw new We("starting column to be smaller than the ending column.");if(!this.sheetMapping.hasSheetWithId(e))throw new Oe(e)}}ensureItIsPossibleToMoveRows(e,t,r,n){this.ensureItIsPossibleToAddRows(e,[n,r]);const i=x(e,0,t),a=x(e,0,n);if(!this.sheetMapping.hasSheetWithId(e)||Ct(i)||Ct(a)||!Fn(r)||n<=t+r&&n>=t)throw new We("a valid range of rows to move.");const o=this.dependencyGraph.getSheetWidth(e),u=B.spanFrom(i,o,r);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(u))throw new zn;if(n>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllRows(It.fromNumberOfRows(e,n-1,2)))throw new ra}ensureItIsPossibleToMoveColumns(e,t,r,n){this.ensureItIsPossibleToAddColumns(e,[n,r]);const i=x(e,t,0),a=x(e,n,0);if(!this.sheetMapping.hasSheetWithId(e)||Ct(i)||Ct(a)||!Fn(r)||n<=t+r&&n>=t)throw new We("a valid range of columns to move.");const o=this.dependencyGraph.getSheetHeight(e),u=B.spanFrom(i,r,o);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(u))throw new zn;if(n>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllColumns(Vt.fromNumberOfColumns(e,n-1,2)))throw new ra}ensureItIsPossibleToAddSheet(e){if(this.sheetMapping.hasSheetWithName(e))throw new Hs(e)}ensureItIsPossibleToRenameSheet(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new Oe(e);const r=this.sheetMapping.get(t);if(r!==void 0&&r!==e)throw new Hs(t)}ensureItIsPossibleToChangeContent(e){if(Ct(e))throw new ud(e);if(!this.sheetMapping.hasSheetWithId(e.sheet))throw new Oe(e.sheet)}ensureItIsPossibleToChangeCellContents(e,t){const r=ua(t),n=B.spanFrom(e,r.width,r.height);this.ensureRangeInSizeLimits(n);for(const i of n.addresses(this.dependencyGraph))this.ensureItIsPossibleToChangeContent(i)}ensureItIsPossibleToChangeSheetContents(e,t){const r=ua(t),n=B.spanFrom(x(e,0,0),r.width,r.height);this.ensureRangeInSizeLimits(n)}ensureRangeInSizeLimits(e){if(e.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new vn}isThereSomethingToUndo(){return!this.undoRedo.isUndoStackEmpty()}isThereSomethingToRedo(){return!this.undoRedo.isRedoStackEmpty()}getAndClearContentChanges(){return this.operations.getAndClearContentChanges()}ensureScopeIdIsValid(e){if(e!==void 0&&!this.sheetMapping.hasSheetWithId(e))throw new Oe(e)}validateRowOrColumnMapping(e,t,r){const n=r==="row"?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e),i=t.map(([o,u])=>o).sort((o,u)=>o-u),a=t.map(([o,u])=>u).sort((o,u)=>o-u);for(let o=0;o<i.length;o++){if(!dn(i[o])||i[o]>=n)throw new We(`${r} numbers to be nonnegative integers and less than sheet ${r==="row"?"height":"width"}.`);if(i[o]===i[o+1])throw new We(`source ${r} numbers to be unique.`);if(i[o]!==a[o])throw new We(`target ${r} numbers to be permutation of source ${r} numbers.`)}}ensureNamedExpressionNameIsValid(e,t){if(!this.namedExpressions.isNameValid(e))throw new cd(e);if(!this.namedExpressions.isNameAvailable(e,t))throw new ld(e)}ensureNamedExpressionIsValid(e){const t=this.cellContentParser.parse(e);if(t instanceof Ie.Formula){const r=this.parser.parse(t.formula,x(-1,0,0));if(qr(r.ast))throw new Ru}}}function Fn(s){return Number.isInteger(s)&&s>0}function dn(s){return Number.isInteger(s)&&s>=0}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class UT{constructor(e,t,r,n,i,a){this.config=e,this.stats=t,this.interpreter=r,this.lazilyTransformingAstService=n,this.dependencyGraph=i,this.columnSearch=a}run(){this.stats.start(Y.TOP_SORT);const{sorted:e,cycled:t}=this.dependencyGraph.topSortWithScc();this.stats.end(Y.TOP_SORT),this.stats.measure(Y.EVALUATION,()=>{this.recomputeFormulas(t,e)})}partialRun(e){const t=rn.empty();return this.stats.measure(Y.EVALUATION,()=>{this.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(e,r=>{if(r instanceof Bt){const n=r.isComputed()?r.getCellValue():void 0,i=this.recomputeFormulaVertexValue(r);if(i!==n){const a=r.getAddress(this.lazilyTransformingAstService);return t.addChange(i,a),this.columnSearch.change(b(n),b(i),a),!0}return!1}else return r instanceof pt&&r.clearCache(),!0},r=>{if(r instanceof pt)r.clearCache();else if(r instanceof Bt){const n=r.getAddress(this.lazilyTransformingAstService);this.columnSearch.remove(b(r.valueOrUndef()),n);const i=new m(E.CYCLE,void 0,r);r.setCellValue(i),t.addChange(i,n)}})}),t}runAndForget(e,t,r){const n=[];for(const a of Tr(r,t))if(a instanceof B){const o=a;if(this.dependencyGraph.getRange(o.start,o.end)===void 0){const u=new pt(o);this.dependencyGraph.rangeMapping.setRange(u),n.push(u)}}const i=this.evaluateAstToCellValue(e,new Ir(t,this.config.useArrayArithmetic));return n.forEach(a=>{this.dependencyGraph.rangeMapping.removeRange(a)}),i}recomputeFormulas(e,t){e.forEach(r=>{r instanceof Bt&&r.setCellValue(new m(E.CYCLE,void 0,r))}),t.forEach(r=>{if(r instanceof Bt){const n=this.recomputeFormulaVertexValue(r),i=r.getAddress(this.lazilyTransformingAstService);this.columnSearch.add(b(n),i)}else r instanceof pt&&r.clearCache()})}recomputeFormulaVertexValue(e){const t=e.getAddress(this.lazilyTransformingAstService);if(e instanceof ke&&(e.array.size.isRef||!this.dependencyGraph.isThereSpaceForArray(e)))return e.setNoSpace();{const r=e.getFormula(this.lazilyTransformingAstService),n=this.evaluateAstToCellValue(r,new Ir(t,this.config.useArrayArithmetic,e));return e.setCellValue(n)}}evaluateAstToCellValue(e,t){const r=this.interpreter.evaluateAst(e,t);return r instanceof F?r:r===Z&&this.config.evaluateNullToZero?0:r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Lo{constructor(e,t){this.address=e,this.newValue=t}get col(){return this.address.col}get row(){return this.address.row}get sheet(){return this.address.sheet}get value(){return this.newValue}}class kd{constructor(e,t){this.name=e,this.newValue=t}}class PT{constructor(e,t,r,n){this.config=e,this.namedExpressions=t,this.sheetIndexMapping=r,this.lazilyTransformingService=n}exportChange(e){const t=e.value,r=e.address;if(r.sheet===wn.SHEET_FOR_WORKBOOK_EXPRESSIONS){const n=this.namedExpressions.namedExpressionInAddress(r.row);if(!n)throw new Error("Missing named expression");return new kd(n.displayName,this.exportScalarOrRange(t))}else if(t instanceof F){const n=[];for(const[i,a]of t.entriesFromTopLeftCorner(r))n.push(new Lo(a,this.exportValue(i)));return n}else return new Lo(r,this.exportValue(t))}exportValue(e){return e instanceof F?this.detailedError(new m(E.VALUE,y.ScalarExpected)):this.config.smartRounding&&ue(e)?this.cellValueRounding(b(e)):e instanceof m?this.detailedError(e):e===Z?null:b(e)}exportScalarOrRange(e){return e instanceof F?e.rawData().map(t=>t.map(r=>this.exportValue(r))):this.exportValue(e)}detailedError(e){var t,r;let n;const i=(t=e.root)===null||t===void 0?void 0:t.getAddress(this.lazilyTransformingService);return i!==void 0&&(i.sheet===wn.SHEET_FOR_WORKBOOK_EXPRESSIONS?n=(r=this.namedExpressions.namedExpressionInAddress(i.row))===null||r===void 0?void 0:r.displayName:n=Wi(this.sheetIndexMapping,i,-1)),new Md(e,this.config.translationPackage.getErrorTranslation(e.type),n)}cellValueRounding(e){if(e===0)return e;const t=Math.floor(Math.log10(Math.abs(e))),r=Math.pow(10,this.config.precisionRounding-t);return e<0?-Math.round(-e*r)/r:Math.round(e*r)/r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class DT{constructor(e,t,r,n,i,a){this.dependencyGraph=e,this.columnSearch=t,this.parser=r,this.cellContentParser=n,this.stats=i,this.arraySizePredictor=a,this.buildStrategy=new VT(e,t,r,i,n,a)}buildGraph(e,t){const r=t.measure(Y.COLLECT_DEPENDENCIES,()=>this.buildStrategy.run(e));this.dependencyGraph.getAndClearContentChanges(),t.measure(Y.PROCESS_DEPENDENCIES,()=>this.processDependencies(r))}processDependencies(e){e.forEach((t,r)=>{this.dependencyGraph.processCellDependencies(t,r)})}}class VT{constructor(e,t,r,n,i,a){this.dependencyGraph=e,this.columnIndex=t,this.parser=r,this.stats=n,this.cellContentParser=i,this.arraySizePredictor=a}run(e){const t=new Map;for(const r in e){const n=this.dependencyGraph.getSheetId(r),i=e[r];for(let a=0;a<i.length;++a){const o=i[a];for(let u=0;u<o.length;++u){const l=o[u],h=x(n,u,a),d=this.cellContentParser.parse(l);if(d instanceof Ie.Formula){const f=this.stats.measure(Y.PARSER,()=>this.parser.parse(d.formula,h));if(f.errors.length>0){this.shrinkArrayIfNeeded(h);const p=new Xn(f.errors,d.formula);this.dependencyGraph.addVertex(h,p)}else{this.shrinkArrayIfNeeded(h);const p=this.arraySizePredictor.checkArraySize(f.ast,h);if(p.isScalar()){const N=new vr(f.ast,h,0);t.set(N,Tr(f.dependencies,h)),this.dependencyGraph.addVertex(h,N),f.hasVolatileFunction&&this.dependencyGraph.markAsVolatile(N),f.hasStructuralChangeFunction&&this.dependencyGraph.markAsDependentOnStructureChange(N)}else{const N=new ke(f.ast,h,new X(p.width,p.height));t.set(N,Tr(f.dependencies,h)),this.dependencyGraph.addArrayVertex(h,N)}}}else if(!(d instanceof Ie.Empty)){this.shrinkArrayIfNeeded(h);const f=new nn(d.value,l);this.columnIndex.add(b(d.value),h),this.dependencyGraph.addVertex(h,f)}}}}return t}shrinkArrayIfNeeded(e){const t=this.dependencyGraph.getCell(e);t instanceof ke&&this.dependencyGraph.shrinkArrayToCorner(t)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const pi=new Map([["gpl-v3",1],["missing",2],["invalid",3],["expired",4]]);class Gd extends ${version(e,t){return this.runFunction(e.args,t,this.metadata("VERSION"),()=>{const{licenseKeyValidityState:r,licenseKey:n}=this.config;let i;return pi.has(n)?i=pi.get(n):pi.has(r)?i=pi.get(r):r==="valid"&&(i=n.slice(-5)),`HyperFormula v${rt.version}, ${i}`})}}Gd.implementedFunctions={VERSION:{method:"version",parameters:[]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Qa(s,e){var t;let r=e.implementedFunctions[s];const n=(t=e.aliases)===null||t===void 0?void 0:t[s];if(n!==void 0){if(r!==void 0)throw new zN(s,e.name);r=e.implementedFunctions[n]}if(r===void 0)throw es.functionNotDeclaredInPlugin(s,e.name);return r}class je{constructor(e){if(this.config=e,this.functions=new Map,this.arraySizeFunctions=new Map,this.volatileFunctions=new Set,this.arrayFunctions=new Set,this.structuralChangeFunctions=new Set,this.functionsWhichDoesNotNeedArgumentsToBeComputed=new Set,this.functionsMetadata=new Map,this.doesFunctionNeedArgumentToBeComputed=t=>this.functionsWhichDoesNotNeedArgumentsToBeComputed.has(t),this.isFunctionVolatile=t=>this.volatileFunctions.has(t),this.isArrayFunction=t=>this.arrayFunctions.has(t),this.isFunctionDependentOnSheetStructureChange=t=>this.structuralChangeFunctions.has(t),e.functionPlugins.length>0){this.instancePlugins=new Map;for(const t of e.functionPlugins)je.loadPluginFunctions(t,this.instancePlugins)}else this.instancePlugins=new Map(je.plugins);for(const[t,r]of je.protectedFunctions())je.loadFunctionUnprotected(r,t,this.instancePlugins);for(const[t,r]of this.instancePlugins.entries())this.categorizeFunction(t,Qa(t,r))}static registerFunctionPlugin(e,t){this.loadPluginFunctions(e,this.plugins),t!==void 0&&this.loadTranslations(t)}static registerFunction(e,t,r){this.loadPluginFunction(t,e,this.plugins),r!==void 0&&this.loadTranslations(r)}static unregisterFunction(e){if(this.functionIsProtected(e))throw Sn.cannotUnregisterFunctionWithId(e);this.plugins.delete(e)}static unregisterFunctionPlugin(e){for(const t of this.protectedPlugins())if(t===e)throw Sn.cannotUnregisterProtectedPlugin();for(const[t,r]of this.plugins.entries())r===e&&this.plugins.delete(t)}static unregisterAll(){this.plugins.clear()}static getRegisteredFunctionIds(){return[...Array.from(this.plugins.keys()),...Array.from(this._protectedPlugins.keys())]}static getPlugins(){return Array.from(new Set(this.plugins.values()).values())}static getFunctionPlugin(e){if(!this.functionIsProtected(e))return this.plugins.get(e)}static functionIsProtected(e){return this._protectedPlugins.has(e)}static loadTranslations(e){const t=new Set(rt.getRegisteredLanguagesCodes());Object.keys(e).forEach(r=>{t.has(r)&&rt.getLanguage(r).extendFunctions(e[r])})}static loadPluginFunctions(e,t){Object.keys(e.implementedFunctions).forEach(r=>{this.loadPluginFunction(e,r,t)}),e.aliases!==void 0&&Object.keys(e.aliases).forEach(r=>{this.loadPluginFunction(e,r,t)})}static loadPluginFunction(e,t,r){if(this.functionIsProtected(t))throw Sn.cannotRegisterFunctionWithId(t);this.loadFunctionUnprotected(e,t,r)}static handleDeprecatedMetadata(e,t){t&&t.arrayFunction!==void 0&&(console.warn(`${e}: 'arrayFunction' parameter is deprecated since 3.1.0; Use 'enableArrayArithmeticForArguments' instead.`),t.enableArrayArithmeticForArguments=t.arrayFunction),t&&t.arraySizeMethod!==void 0&&(console.warn(`${e}: 'arraySizeMethod' parameter is deprecated since 3.1.0; Use 'sizeOfResultArrayMethod' instead.`),t.sizeOfResultArrayMethod=t.arraySizeMethod)}static loadFunctionUnprotected(e,t,r){const n=Qa(t,e),i=n.method;if(this.handleDeprecatedMetadata(t,n),Object.prototype.hasOwnProperty.call(e.prototype,i))r.set(t,e);else throw es.functionMethodNotFound(i,e.name)}static*protectedFunctions(){for(const[e,t]of this._protectedPlugins)t!==void 0&&(yield[e,t])}static*protectedPlugins(){for(const[,e]of this._protectedPlugins)e!==void 0&&(yield e)}initializePlugins(e){const t=[];for(const[r,n]of this.instancePlugins.entries()){let i=t.find(l=>l instanceof n);i===void 0&&(i=new n(e),t.push(i));const a=Qa(r,n),o=a.method;this.functions.set(r,[o,i]);const u=a.sizeOfResultArrayMethod;u!==void 0&&this.arraySizeFunctions.set(r,[u,i])}}getFunctionPlugin(e){if(!je.functionIsProtected(e))return this.instancePlugins.get(e)}getFunction(e){const t=this.functions.get(e);if(t!==void 0&&this.config.translationPackage.isFunctionTranslated(e)){const[r,n]=t;return(i,a)=>n[r](i,a)}else return}getArraySizeFunction(e){const t=this.arraySizeFunctions.get(e);if(t!==void 0&&this.config.translationPackage.isFunctionTranslated(e)){const[r,n]=t;return(i,a)=>n[r](i,a)}else return}getMetadata(e){return this.functionsMetadata.get(e)}getPlugins(){const e=new Set;for(const[t,r]of this.instancePlugins)je.functionIsProtected(t)||e.add(r);return Array.from(e)}getRegisteredFunctionIds(){return Array.from(this.functions.keys())}categorizeFunction(e,t){t.isVolatile&&this.volatileFunctions.add(e),t.enableArrayArithmeticForArguments&&this.arrayFunctions.add(e),t.doesNotNeedArgumentsToBeComputed&&this.functionsWhichDoesNotNeedArgumentsToBeComputed.add(e),t.isDependentOnSheetStructureChange&&this.structuralChangeFunctions.add(e),this.functionsMetadata.set(e,t)}}je.plugins=new Map;je._protectedPlugins=new Map([["VERSION",Gd],["OFFSET",void 0]]);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Je;(function(s){s.GREATER_THAN="GREATER_THAN",s.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",s.LESS_THAN="LESS_THAN",s.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",s.NOT_EQUAL="NOT_EQUAL",s.EQUAL="EQUAL"})(Je||(Je={}));const mi=(s,e)=>({operator:s,value:e});class BT{constructor(e){var t,r,n,i;this.trueString=(r=(t=e.translationPackage.getMaybeFunctionTranslation("TRUE"))===null||t===void 0?void 0:t.toLowerCase())!==null&&r!==void 0?r:"true",this.falseString=(i=(n=e.translationPackage.getMaybeFunctionTranslation("FALSE"))===null||n===void 0?void 0:n.toLowerCase())!==null&&i!==void 0?i:"false"}fromCellValue(e,t){if(typeof e!="string"&&typeof e!="boolean"&&typeof e!="number")return;const r=this.parseCriterion(e,t);if(r!==void 0)return{raw:e,lambda:HT(r,t)}}parseCriterion(e,t){if(typeof e=="number"||typeof e=="boolean")return mi(Je.EQUAL,e);if(typeof e=="string"){const r=kT.exec(e);let n,i;r?(i=GT(r[1]),n=r[2]):(i=Je.EQUAL,n=e);const a=t.coerceToMaybeNumber(n),o=n.toLowerCase()===this.trueString?!0:n.toLowerCase()===this.falseString?!1:void 0;if(i===void 0)return;if(n==="")return mi(i,null);if(a===void 0){if(i===Je.EQUAL||i===Je.NOT_EQUAL)return mi(i,o??n)}else return mi(i,b(a))}}}const kT=/([<>=]+)(.*)/;function GT(s){switch(s){case">":return Je.GREATER_THAN;case">=":return Je.GREATER_THAN_OR_EQUAL;case"<":return Je.LESS_THAN;case"<=":return Je.LESS_THAN_OR_EQUAL;case"<>":return Je.NOT_EQUAL;case"=":return Je.EQUAL;default:return}}const HT=(s,e)=>{switch(s.operator){case Je.GREATER_THAN:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)>0:t=>!1;case Je.GREATER_THAN_OR_EQUAL:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)>=0:t=>!1;case Je.LESS_THAN:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)<0:t=>!1;case Je.LESS_THAN_OR_EQUAL:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)<=0:t=>!1;case Je.EQUAL:return typeof s.value=="number"?t=>{if(typeof t=="number")return e.floatCmp(t,s.value)===0;if(typeof t=="string"){if(t==="")return!1;const r=e.coerceToMaybeNumber(t);return r===void 0?!1:e.floatCmp(r,s.value)===0}else return!1}:typeof s.value=="string"?e.eqMatcherFunction(s.value):typeof s.value=="boolean"?t=>typeof t=="boolean"&&t===s.value:t=>t===Z;case Je.NOT_EQUAL:return typeof s.value=="number"?t=>{if(typeof t=="number")return e.floatCmp(t,s.value)!==0;if(typeof t=="string"){if(t==="")return!0;const r=e.coerceToMaybeNumber(t);return r===void 0?!0:e.floatCmp(r,s.value)!==0}else return!0}:typeof s.value=="string"?e.neqMatcherFunction(s.value):typeof s.value=="boolean"?t=>typeof t!="boolean"||t!==s.value:t=>t!==Z}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class WT{constructor(e,t,r,n,i,a,o,u,l,h){this.config=e,this.dependencyGraph=t,this.columnSearch=r,this.stats=n,this.arithmeticHelper=i,this.functionRegistry=a,this.namedExpressions=o,this.serialization=u,this.arraySizePredictor=l,this.dateTimeHelper=h,this.equalOp=(d,f)=>Xt(this.arithmeticHelper.eq,d,f),this.notEqualOp=(d,f)=>Xt(this.arithmeticHelper.neq,d,f),this.greaterThanOp=(d,f)=>Xt(this.arithmeticHelper.gt,d,f),this.lessThanOp=(d,f)=>Xt(this.arithmeticHelper.lt,d,f),this.greaterThanOrEqualOp=(d,f)=>Xt(this.arithmeticHelper.geq,d,f),this.lessThanOrEqualOp=(d,f)=>Xt(this.arithmeticHelper.leq,d,f),this.concatOp=(d,f)=>Xt(this.arithmeticHelper.concat,Io(d),Io(f)),this.plusOp=(d,f)=>Xt(this.arithmeticHelper.addWithEpsilon,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.minusOp=(d,f)=>Xt(this.arithmeticHelper.subtract,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.timesOp=(d,f)=>Xt(this.arithmeticHelper.multiply,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.powerOp=(d,f)=>Xt(this.arithmeticHelper.pow,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.divOp=(d,f)=>Xt(this.arithmeticHelper.divide,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.unaryMinusOp=d=>Gl(this.arithmeticHelper.unaryMinus,this.arithmeticHelper.coerceScalarToNumberOrError(d)),this.percentOp=d=>Gl(this.arithmeticHelper.unaryPercent,this.arithmeticHelper.coerceScalarToNumberOrError(d)),this.unaryPlusOp=d=>this.arithmeticHelper.unaryPlus(d),this.functionRegistry.initializePlugins(this),this.criterionBuilder=new BT(e)}evaluateAst(e,t){let r=this.evaluateAstWithoutPostprocessing(e,t);if(ue(r)){if(Cd(b(r)))return new m(E.NUM,y.NaN);r=pu(r,Id(b(r)))}return r instanceof F&&r.height()===1&&r.width()===1&&([[r]]=r.data),zT(r,t.formulaVertex)}evaluateAstWithoutPostprocessing(e,t){switch(e.type){case R.EMPTY:return Z;case R.CELL_REFERENCE:{const r=e.reference.toSimpleCellAddress(t.formulaAddress);return Ct(r)?new m(E.REF,y.BadRef):this.dependencyGraph.getCellValue(r)}case R.NUMBER:case R.STRING:return e.value;case R.CONCATENATE_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.concatOp,r,n,t)}case R.EQUALS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.equalOp,r,n,t)}case R.NOT_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.notEqualOp,r,n,t)}case R.GREATER_THAN_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOp,r,n,t)}case R.LESS_THAN_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOp,r,n,t)}case R.GREATER_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOrEqualOp,r,n,t)}case R.LESS_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOrEqualOp,r,n,t)}case R.PLUS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.plusOp,r,n,t)}case R.MINUS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.minusOp,r,n,t)}case R.TIMES_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.timesOp,r,n,t)}case R.POWER_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.powerOp,r,n,t)}case R.DIV_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.divOp,r,n,t)}case R.PLUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryPlusOp,r,t)}case R.MINUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryMinusOp,r,t)}case R.PERCENT_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.percentOp,r,t)}case R.FUNCTION_CALL:{if(this.config.licenseKeyValidityState!=="valid"&&!je.functionIsProtected(e.procedureName))return new m(E.LIC,y.LicenseKey(this.config.licenseKeyValidityState));const r=this.functionRegistry.getFunction(e.procedureName);return r!==void 0?r(e,new Ir(t.formulaAddress,t.arraysFlag||this.functionRegistry.isArrayFunction(e.procedureName),t.formulaVertex)):new m(E.NAME,y.FunctionName(e.procedureName))}case R.NAMED_EXPRESSION:{const r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.formulaAddress.sheet);return r?this.dependencyGraph.getCellValue(r.address):new m(E.NAME,y.NamedExpressionName(e.expressionName))}case R.CELL_RANGE:{if(!this.rangeSpansOneSheet(e))return new m(E.REF,y.RangeManySheets);const r=B.fromCellRange(e,t.formulaAddress),n=this.dependencyGraph.getArray(r);if(n){const i=n.array;if(i instanceof Ss)throw new Error("Array should be already computed");if(i instanceof m)return i;if(i instanceof ts)return F.fromRange(i.raw(),r,this.dependencyGraph);throw new Error("Unknown array")}else return F.onlyRange(r,this.dependencyGraph)}case R.COLUMN_RANGE:{if(!this.rangeSpansOneSheet(e))return new m(E.REF,y.RangeManySheets);const r=Vr.fromColumnRange(e,t.formulaAddress);return F.onlyRange(r,this.dependencyGraph)}case R.ROW_RANGE:{if(!this.rangeSpansOneSheet(e))return new m(E.REF,y.RangeManySheets);const r=Br.fromRowRangeAst(e,t.formulaAddress);return F.onlyRange(r,this.dependencyGraph)}case R.PARENTHESIS:return this.evaluateAst(e.expression,t);case R.ARRAY:{let r;const n=[];for(const i of e.args){let a;const o=[];for(const l of i){const h=Sd(this.evaluateAst(l,t)),d=h.height();if(a===void 0)a=d,o.push(...h.data);else if(a===d)for(let f=0;f<d;f++)o[f].push(...h.data[f]);else return new m(E.REF,y.SizeMismatch)}const u=o[0].length;if(r===void 0)r=u,n.push(...o);else if(r===u)n.push(...o);else return new m(E.REF,y.SizeMismatch)}return F.onlyValues(n)}case R.ERROR_WITH_RAW_INPUT:case R.ERROR:return e.error}}rangeSpansOneSheet(e){return e.start.sheet===e.end.sheet}unaryRangeWrapper(e,t,r){var n;if(t instanceof F&&!r.arraysFlag&&(t=(n=Ui(t,r))!==null&&n!==void 0?n:new m(E.VALUE,y.ScalarExpected)),t instanceof m)return t;if(t instanceof F){const i=t.data.map(a=>a.map(e));return F.onlyValues(i)}return e(t)}binaryRangeWrapper(e,t,r,n){var i,a;if(t instanceof F&&!n.arraysFlag&&(t=(i=Ui(t,n))!==null&&i!==void 0?i:new m(E.VALUE,y.ScalarExpected)),t instanceof m)return t;if(r instanceof F&&!n.arraysFlag&&(r=(a=Ui(r,n))!==null&&a!==void 0?a:new m(E.VALUE,y.ScalarExpected)),r instanceof m)return r;if(t instanceof F||r instanceof F){if(!(t instanceof F))if(r.isAdHoc()){const h=r.data;for(let d=0;d<h.length;d++)for(let f=0;f<h[0].length;f++)h[d][f]=e(t,h[d][f]);return F.onlyValues(h)}else t=F.fromScalar(t);if(!(r instanceof F))if(t.isAdHoc()){const h=t.data;for(let d=0;d<h.length;d++)for(let f=0;f<h[0].length;f++)h[d][f]=e(h[d][f],r);return F.onlyValues(h)}else r=F.fromScalar(r);if(t.width()===r.width()&&t.height()===r.height()){if(t.isAdHoc()){const h=t.data,d=r.data;for(let f=0;f<h.length;f++)for(let p=0;p<h[0].length;p++)h[f][p]=e(h[f][p],d[f][p]);return F.onlyValues(h)}if(r.isAdHoc()){const h=t.data,d=r.data;for(let f=0;f<h.length;f++)for(let p=0;p<h[0].length;p++)d[f][p]=e(h[f][p],d[f][p]);return F.onlyValues(d)}}const o=Math.max(t.width(),r.width()),u=Math.max(t.height(),r.height()),l=Array(u);for(let h=0;h<u;h++)l[h]=Array(o);for(let h=0;h<u;h++){const d=t.height()!==1?h:0,f=r.height()!==1?h:0;for(let p=0;p<o;p++){const N=t.width()!==1?p:0,g=r.width()!==1?p:0;d<t.height()&&f<r.height()&&N<t.width()&&g<r.width()?l[h][p]=e(t.data[d][N],r.data[f][g]):l[h][p]=new m(E.NA)}}return F.onlyValues(l)}return e(t,r)}}function Gl(s,e){return e instanceof m?e:s(e)}function Xt(s,e,t){return e instanceof m?e:t instanceof m?t:s(e,t)}function zT(s,e){return s instanceof m&&e!==void 0?s.attachRootVertex(e):s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class YT{constructor(e){this.sheet=e,this.transformations=[]}add(e){this.transformations.push(e)}performEagerTransformations(e,t){this.transformations.forEach(r=>r.performEagerTransformations(e,t))}transformSingleAst(e,t){let[r,n]=[e,t];return this.transformations.forEach(i=>{[r,n]=i.transformSingleAst(r,n)}),[r,n]}isIrreversible(){return!0}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class jT{constructor(e){this.stats=e,this.transformations=[]}version(){return this.transformations.length}addTransformation(e){return this.combinedTransformer!==void 0?this.combinedTransformer.add(e):this.transformations.push(e),this.version()}beginCombinedMode(e){this.combinedTransformer=new YT(e)}commitCombinedMode(){if(this.combinedTransformer===void 0)throw Error("Combined mode wasn't started");return this.transformations.push(this.combinedTransformer),this.combinedTransformer=void 0,this.version()}applyTransformations(e,t,r){this.stats.start(Y.TRANSFORM_ASTS_POSTPONED);for(let i=r;i<this.transformations.length;i++){const a=this.transformations[i];a.isIrreversible()&&(this.undoRedo.storeDataForVersion(i,t,this.parser.computeHashFromAst(e)),this.parser.rememberNewAst(e));const[o,u]=a.transformSingleAst(e,t);e=o,t=u}const n=this.parser.rememberNewAst(e);return this.stats.end(Y.TRANSFORM_ASTS_POSTPONED),[n,t,this.transformations.length]}*getTransformationsFrom(e,t){for(let r=e;r<this.transformations.length;r++){const n=this.transformations[r];(!t||t(n))&&(yield n)}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Rr=-1;function $T(s,e,{searchCoordinate:t,orderingDirection:r,ifNoMatch:n},i){const a=e.start[t],o=t==="col"?e.effectiveEndColumn(i):e.effectiveEndRow(i),u=t==="col"?f=>b(i.getCellValue(x(e.sheet,f,e.start.row))):f=>b(i.getCellValue(x(e.sheet,e.start.col,f))),l=r==="asc"?(f,p)=>da(f,p):(f,p)=>-da(f,p),h=XT(f=>l(s,u(f))>=0,a,o),d=u(h);if(d===s)return h-a;if(n==="returnLowerBound"){if(h===Rr)return r==="asc"?Rr:0;if(typeof d!=typeof s)return Rr;if(r==="asc")return h-a;const f=h+1;return f<=o?f-a:Rr}if(n==="returnUpperBound"){if(h===Rr)return r==="asc"?0:Rr;if(typeof d!=typeof s)return Rr;if(r==="desc")return h-a;const f=h+1;return f<=o?f-a:Rr}return Rr}function XT(s,e,t){let r=e,n=t;for(;r<n;){const i=Math.ceil((r+n)/2);s(i)?r=i:n=i-1}return r===n&&s(r)?r:Rr}function da(s,e){return typeof s==typeof e?s===Z?0:s<e?-1:s>e?1:0:s===Z?-1:e===Z?1:e instanceof m||typeof s=="number"&&typeof e=="string"||typeof s=="number"&&typeof e=="boolean"?-1:typeof s=="string"&&typeof e=="number"?1:typeof s=="string"&&typeof e=="boolean"?-1:1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Hl=-1;class Hd{constructor(e){this.dependencyGraph=e}advancedFind(e,t,{returnOccurrence:r}={returnOccurrence:"first"}){const n=t.range,i=n===void 0?t.valuesFromTopLeftCorner():this.dependencyGraph.computeListOfValuesInRange(n),a=r==="first"?0:i.length-1,o=r==="first"?l=>l<i.length:l=>l>=0,u=r==="first"?l=>l+1:l=>l-1;for(let l=a;o(l);l=u(l))if(e(b(i[l])))return l;return Hl}basicFind(e,t,r,{ordering:n,ifNoMatch:i,returnOccurrence:a}){const o=typeof e=="string"?_s(e):e,u=t.range;return u===void 0?this.findNormalizedValue(o,t.valuesFromTopLeftCorner(),i,a):n==="none"?this.findNormalizedValue(o,this.dependencyGraph.computeListOfValuesInRange(u),i,a):$T(o,u,{searchCoordinate:r,orderingDirection:n,ifNoMatch:i},this.dependencyGraph)}findNormalizedValue(e,t,r="returnNotFound",n="first"){const i=t.map(b).map(f=>typeof f=="string"?_s(f):f);if(r==="returnNotFound")return n==="first"?i.indexOf(e):i.lastIndexOf(e);const a=r==="returnLowerBound"?(f,p)=>da(f,p):(f,p)=>-da(f,p);let o=r==="returnLowerBound"?-1/0:1/0,u=Hl;const l=n==="first"?0:i.length-1,h=n==="first"?f=>f<i.length:f=>f>=0,d=n==="first"?f=>f+1:f=>f-1;for(let f=l;h(f);f=d(f)){const p=i[f];if(p===e)return f;a(p,e)>0||a(o,p)<0&&(o=p,u=f)}return u}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Wd extends Hd{constructor(e){super(e),this.dependencyGraph=e}add(e,t){}remove(e,t){}change(e,t,r){}applyChanges(e){}addColumns(e){}removeColumns(e){}removeSheet(e){}moveValues(e,t,r,n){}removeValues(e){}find(e,t,r){return this.basicFind(e,t,"row",r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class yn{constructor(e,t,r){this.dependencyGraph=e,this.config=t,this.stats=r,this.index=new Map,this.transformingService=this.dependencyGraph.lazilyTransformingAstService,this.binarySearchStrategy=new Wd(e)}add(e,t){if(!(e===Z||e instanceof m))if(e instanceof F)for(const[r,n]of e.entriesFromTopLeftCorner(t))this.addSingleCellValue(b(r),n);else this.addSingleCellValue(e,t)}remove(e,t){if(e!==void 0)if(e instanceof F)for(const[r,n]of e.entriesFromTopLeftCorner(t))this.removeSingleValue(b(r),n);else this.removeSingleValue(e,t)}change(e,t,r){e!==t&&(this.remove(e,r),this.add(t,r))}applyChanges(e){for(const t of e)t.oldValue!==void 0&&this.change(b(t.oldValue),b(t.value),t.address)}moveValues(e,t,r,n){for(const[i,a]of e){const o=dy(a,n,t,r);this.remove(i,a),this.add(i,o)}}removeValues(e){for(const[t,r]of e)this.remove(t,r)}find(e,t,{ordering:r,ifNoMatch:n,returnOccurrence:i}){i==null&&(i=r==="none"?"first":"last");const a=this.findUsingColumnIndex(e,t,i);return a!==void 0?a:this.binarySearchStrategy.find(e,t,{ordering:r,ifNoMatch:n,returnOccurrence:i})}findUsingColumnIndex(e,t,r){const n=t.range;if(n===void 0)return;this.ensureRecentData(n.sheet,n.start.col,e);const i=this.getColumnMap(n.sheet,n.start.col);if(!i)return-1;const a=typeof e=="string"?_s(e):e,o=i.get(a);if(!o||!o.index||o.index.length===0)return;const u=yn.findRowBelongingToRange(o,n,r);return u!==void 0?u-n.start.row:void 0}static findRowBelongingToRange(e,t,r){const n=t.start.row,i=t.end.row,a=r==="first"?fn(n,e.index,"upperBound"):fn(i,e.index,"lowerBound");if(a===-1)return;const o=e.index[a];return o>=n&&o<=i?o:void 0}advancedFind(e,t,r={returnOccurrence:"first"}){return this.binarySearchStrategy.advancedFind(e,t,r)}addColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,0,...Array(e.numberOfColumns))}removeColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,e.numberOfColumns)}removeSheet(e){this.index.delete(e)}getColumnMap(e,t){this.index.has(e)||this.index.set(e,[]);const r=this.index.get(e);let n=r[t];return n||(n=new Map,r[t]=n),n}getValueIndex(e,t,r){const n=this.getColumnMap(e,t);let i=this.getColumnMap(e,t).get(r);return i||(i={version:this.transformingService.version(),index:[]},n.set(r,i)),i}ensureRecentData(e,t,r){const n=this.getValueIndex(e,t,r),i=this.transformingService.version();if(n.version===i)return;const a=this.transformingService.getTransformationsFrom(n.version,o=>o.sheet===e&&(o instanceof xo||o instanceof _o));for(const o of a)o instanceof xo?this.addRows(t,o.rowsSpan,r):o instanceof _o&&this.removeRows(t,o.rowsSpan,r);n.version=i}addSingleCellValue(e,t){this.stats.measure(Y.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e),typeof e=="string"&&(e=_s(e));const r=this.getValueIndex(t.sheet,t.col,e);yn.addValue(r,t.row)})}removeSingleValue(e,t){this.stats.measure(Y.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e);const r=this.getColumnMap(t.sheet,t.col);typeof e=="string"&&(e=_s(e));const n=r.get(e);if(!n)return;const i=fn(t.row,n.index);i>-1&&n.index.splice(i,1),n.index.length===0&&r.delete(e),r.size===0&&delete this.index.get(t.sheet)[t.col]})}addRows(e,t,r){const n=this.getValueIndex(t.sheet,e,r);yn.shiftRows(n,t.rowStart,t.numberOfRows)}removeRows(e,t,r){const n=this.getValueIndex(t.sheet,e,r);yn.removeRowsFromValues(n,t),yn.shiftRows(n,t.rowEnd+1,-t.numberOfRows)}static addValue(e,t){const r=fn(t,e.index,"lowerBound");e.index[r]===t||e.index.splice(r+1,0,t)}static removeRowsFromValues(e,t){const r=fn(t.rowStart,e.index,"upperBound"),n=fn(t.rowEnd,e.index,"lowerBound");r>-1&&n>-1&&r<=n&&e.index[r]<=t.rowEnd&&e.index.splice(r,n-r+1)}static shiftRows(e,t,r){const n=fn(t,e.index,"upperBound");if(n!==-1)for(let i=n;i<e.index.length;++i)e.index[i]+=r}}function fn(s,e,t="upperBound"){let r=0,n=e.length-1;for(;r<=n;){const o=Math.floor((r+n)/2);if(s>e[o])r=o+1;else if(s<e[o])n=o-1;else return o}const i=t==="lowerBound"?n:r;return i>=0&&i<=e.length?i:-1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function KT(s,e,t){return e.useColumnIndex?new yn(s,e,t):new Wd(s)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class qT{constructor(e){this.config=e;const t=this.config.thousandSeparator==="."?`\\${this.config.thousandSeparator}`:this.config.thousandSeparator,r=this.config.decimalSeparator==="."?`\\${this.config.decimalSeparator}`:this.config.decimalSeparator;this.numberPattern=new RegExp(`^([+-]?((${r}\\d+)|(\\d+(${t}\\d{3,})*(${r}\\d*)?)))(e[+-]?\\d+)?$`),this.allThousandSeparatorsRegex=new RegExp(`${t}`,"g")}numericStringToMaybeNumber(e){if(this.numberPattern.test(e)){const t=this.numericStringToNumber(e);return isNaN(t)?void 0:t}}numericStringToNumber(e){const t=e.replace(this.allThousandSeparatorsRegex,"").replace(this.config.decimalSeparator,".");return Number(t)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Tu{constructor(e,t,r){this.dependencyGraph=e,this.unparser=t,this.exporter=r}getCellHyperlink(e){const t=this.dependencyGraph.getCell(e);if(t instanceof vr){const r=t.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(r.procedureName==="HYPERLINK")return r.hyperlink}}getCellFormula(e,t){const r=this.dependencyGraph.getCell(e);if(r instanceof vr){const n=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);return t=t??e,this.unparser.unparse(n,t)}else if(r instanceof ke){const n=r.getAddress(this.dependencyGraph.lazilyTransformingAstService);if(n.row!==e.row||n.col!==e.col||n.sheet!==e.sheet)return;t=t??e;const i=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(i!==void 0)return this.unparser.unparse(i,t)}else if(r instanceof Xn)return r.getFormula()}getCellSerialized(e,t){var r;return(r=this.getCellFormula(e,t))!==null&&r!==void 0?r:this.getRawValue(e)}getCellValue(e){return this.exporter.exportValue(this.dependencyGraph.getScalarValue(e))}getRawValue(e){return this.dependencyGraph.getRawValue(e)}getSheetValues(e){return this.genericSheetGetter(e,t=>this.getCellValue(t))}getSheetFormulas(e){return this.genericSheetGetter(e,t=>this.getCellFormula(t))}genericSheetGetter(e,t){const r=this.dependencyGraph.getSheetHeight(e),n=this.dependencyGraph.getSheetWidth(e),i=new Array(r);for(let a=0;a<r;a++){i[a]=new Array(n);for(let o=0;o<n;o++){const u=x(e,o,a);i[a][o]=t(u)}for(let o=n-1;o>=0&&(i[a][o]===null||i[a][o]===void 0);o--)i[a].pop()}for(let a=r-1;a>=0&&i[a].length===0;a--)i.pop();return i}genericAllSheetsGetter(e){const t={};for(const r of this.dependencyGraph.sheetMapping.displayNames()){const n=this.dependencyGraph.sheetMapping.fetch(r);t[r]=e(n)}return t}getSheetSerialized(e){return this.genericSheetGetter(e,t=>this.getCellSerialized(t))}getAllSheetsValues(){return this.genericAllSheetsGetter(e=>this.getSheetValues(e))}getAllSheetsFormulas(){return this.genericAllSheetsGetter(e=>this.getSheetFormulas(e))}getAllSheetsSerialized(){return this.genericAllSheetsGetter(e=>this.getSheetSerialized(e))}getAllNamedExpressionsSerialized(){const e=[];let t=0;for(const r of this.dependencyGraph.sheetMapping.displayNames()){const n=this.dependencyGraph.sheetMapping.fetch(r);e[n]=t,t++}return this.dependencyGraph.namedExpressions.getAllNamedExpressions().map(r=>({name:r.expression.displayName,expression:this.getCellSerialized(r.expression.address),scope:r.scope!==void 0?e[r.scope]:void 0,options:r.expression.options}))}withNewConfig(e,t){const r=new nd(e,fu(e),this.dependencyGraph.sheetMapping.fetchDisplayName,t);return new Tu(this.dependencyGraph,r,this.exporter)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class gi{static buildFromSheets(e,t={},r=[]){const n=new kt(t);return this.buildEngine(n,e,r)}static buildFromSheet(e,t={},r=[]){const n=new kt(t),i=n.translationPackage.getUITranslation(Ys.NEW_SHEET_PREFIX)+"1";return this.buildEngine(n,{[i]:e},r)}static buildEmpty(e={},t=[]){return this.buildEngine(new kt(e),{},t)}static rebuildWithConfig(e,t,r,n){return this.buildEngine(e,t,r,n)}static buildEngine(e,t={},r=[],n=e.useStats?new ad:new GN){n.start(Y.BUILD_ENGINE_TOTAL);const i=new wn,a=new je(e),o=new jT(n),u=Nu.buildEmpty(o,e,a,i,n),l=KT(u,e,n),h=u.sheetMapping,d=u.addressMapping;for(const U in t)if(Object.prototype.hasOwnProperty.call(t,U)){const K=t[U];Ud(K);const z=ua(K);if(z.height>e.maxRows||z.width>e.maxColumns)throw new vn;const te=h.addSheet(U);d.autoAddSheet(te,z)}const f=new bs(e,a,h.get);o.parser=f;const p=new nd(e,fu(e),h.fetchDisplayName,i),N=new Uy(e),g=new qT(e),S=new Ey(e,N,g),v=new rT(e,N,g),A=new Ay(e,a),C=new hT(e,u,l,v,f,n,o,i,A),w=new LT(e,C);o.undoRedo=w;const M=new nT(e,u,C),L=new FT(e,C,w,M,u,l,f,v,o,i),_=new PT(e,i,h.fetchDisplayName,o),V=new Tu(u,p,_),k=new WT(e,u,l,n,S,a,i,V,A,N);n.measure(Y.GRAPH_BUILD,()=>{new DT(u,l,f,v,n,A).buildGraph(t,n)}),r.forEach(U=>{L.ensureItIsPossibleToAddNamedExpression(U.name,U.expression,U.scope),L.operations.addNamedExpression(U.name,U.expression,U.scope,U.options)});const G=new UT(e,n,k,o,u,l);return G.run(),n.end(Y.BUILD_ENGINE_TOTAL),{config:e,stats:n,dependencyGraph:u,columnSearch:l,parser:f,unparser:p,cellContentParser:v,evaluator:G,lazilyTransformingAstService:o,crudOperations:L,exporter:_,namedExpressions:i,serialization:V,functionRegistry:a}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function QT(s){for(const[e,t]of Object.entries(s))t instanceof Function?s[e]=ZT(t):delete s[e]}function ZT(s){return()=>{throw new Error(`The "${s}" method cannot be called because this HyperFormula instance has been destroyed`)}}var Ei={exports:{}},Wl;function JT(){if(Wl)return Ei.exports;Wl=1;function s(){}return s.prototype={on:function(e,t,r){var n=this.e||(this.e={});return(n[e]||(n[e]=[])).push({fn:t,ctx:r}),this},once:function(e,t,r){var n=this;function i(){n.off(e,i),t.apply(r,arguments)}return i._=t,this.on(e,i,r)},emit:function(e){var t=[].slice.call(arguments,1),r=((this.e||(this.e={}))[e]||[]).slice(),n=0,i=r.length;for(n;n<i;n++)r[n].fn.apply(r[n].ctx,t);return this},off:function(e,t){var r=this.e||(this.e={}),n=r[e],i=[];if(n&&t)for(var a=0,o=n.length;a<o;a++)n[a].fn!==t&&n[a].fn._!==t&&i.push(n[a]);return i.length?r[e]=i:delete r[e],this}},Ei.exports=s,Ei.exports.TinyEmitter=s,Ei.exports}var ev=JT();/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Nr;(function(s){s.SheetAdded="sheetAdded",s.SheetRemoved="sheetRemoved",s.SheetRenamed="sheetRenamed",s.NamedExpressionAdded="namedExpressionAdded",s.NamedExpressionRemoved="namedExpressionRemoved",s.ValuesUpdated="valuesUpdated",s.EvaluationSuspended="evaluationSuspended",s.EvaluationResumed="evaluationResumed"})(Nr||(Nr={}));class tv extends ev.TinyEmitter{emit(e,...t){return super.emit(e,...t),this}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class rt{constructor(e,t,r,n,i,a,o,u,l,h,d,f,p,N){this._config=e,this._stats=t,this._dependencyGraph=r,this._columnSearch=n,this._parser=i,this._unparser=a,this._cellContentParser=o,this._evaluator=u,this._lazilyTransformingAstService=l,this._crudOperations=h,this._exporter=d,this._namedExpressions=f,this._serialization=p,this._functionRegistry=N,this._emitter=new tv,this._evaluationSuspended=!1}static get defaultConfig(){return rv()}get graph(){return this.dependencyGraph.graph}get rangeMapping(){return this.dependencyGraph.rangeMapping}get arrayMapping(){return this.dependencyGraph.arrayMapping}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}get dependencyGraph(){return this._dependencyGraph}get evaluator(){return this._evaluator}get columnSearch(){return this._columnSearch}get lazilyTransformingAstService(){return this._lazilyTransformingAstService}get licenseKeyValidityState(){return this._config.licenseKeyValidityState}static buildFromArray(e,t={},r=[]){return this.buildFromEngineState(gi.buildFromSheet(e,t,r))}static buildFromSheets(e,t={},r=[]){return this.buildFromEngineState(gi.buildFromSheets(e,t,r))}static buildEmpty(e={},t=[]){return this.buildFromEngineState(gi.buildEmpty(e,t))}static getLanguage(e){O(e,"string","languageCode");const t=this.registeredLanguages.get(e);if(t===void 0)throw new vo;return t}static registerLanguage(e,t){if(O(e,"string","languageCode"),this.registeredLanguages.has(e))throw new yd;this.registeredLanguages.set(e,ty(t))}static unregisterLanguage(e){if(O(e,"string","languageCode"),this.registeredLanguages.has(e))this.registeredLanguages.delete(e);else throw new vo}static getRegisteredLanguagesCodes(){return Array.from(this.registeredLanguages.keys())}static registerFunctionPlugin(e,t){je.registerFunctionPlugin(e,t)}static unregisterFunctionPlugin(e){je.unregisterFunctionPlugin(e)}static registerFunction(e,t,r){O(e,"string","functionId"),je.registerFunction(e,t,r)}static unregisterFunction(e){O(e,"string","functionId"),je.unregisterFunction(e)}static unregisterAllFunctions(){je.unregisterAll()}static getRegisteredFunctionNames(e){O(e,"string","code");const t=je.getRegisteredFunctionIds();return this.getLanguage(e).getFunctionTranslations(t)}static getFunctionPlugin(e){return O(e,"string","functionId"),je.getFunctionPlugin(e)}static getAllFunctionPlugins(){return je.getPlugins()}static buildFromEngineState(e){return new rt(e.config,e.stats,e.dependencyGraph,e.columnSearch,e.parser,e.unparser,e.cellContentParser,e.evaluator,e.lazilyTransformingAstService,e.crudOperations,e.exporter,e.namedExpressions,e.serialization,e.functionRegistry)}getCellValue(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellValue(e)}getCellFormula(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");return this._serialization.getCellFormula(e)}getCellHyperlink(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellHyperlink(e)}getCellSerialized(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellSerialized(e)}getSheetValues(e){return O(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetValues(e)}getSheetFormulas(e){return O(e,"number","sheetId"),this._serialization.getSheetFormulas(e)}getSheetSerialized(e){return O(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetSerialized(e)}getAllSheetsDimensions(){return this._serialization.genericAllSheetsGetter(e=>this.getSheetDimensions(e))}getSheetDimensions(e){return O(e,"number","sheetId"),{width:this.dependencyGraph.getSheetWidth(e),height:this.dependencyGraph.getSheetHeight(e)}}getAllSheetsValues(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsValues()}getAllSheetsFormulas(){return this._serialization.getAllSheetsFormulas()}getAllSheetsSerialized(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsSerialized()}updateConfig(e){Object.entries(e).every(([r,n])=>this._config[r]===n)||this.rebuildWithConfig(e)}getConfig(){return this._config.getConfig()}rebuildAndRecalculate(){this.rebuildWithConfig({})}getStats(){return this._stats.snapshot()}undo(){return this._crudOperations.undo(),this.recomputeIfDependencyGraphNeedsIt()}redo(){return this._crudOperations.redo(),this.recomputeIfDependencyGraphNeedsIt()}isThereSomethingToUndo(){return this._crudOperations.isThereSomethingToUndo()}isThereSomethingToRedo(){return this._crudOperations.isThereSomethingToRedo()}isItPossibleToSetCellContents(e){let t;if(_e(e))t=new B(e,e);else if(Pt(e))t=new B(e.start,e.end);else throw new oe("SimpleCellAddress | SimpleCellRange","address");try{this._crudOperations.ensureRangeInSizeLimits(t);for(const r of t.addresses(this._dependencyGraph))this._crudOperations.ensureItIsPossibleToChangeContent(r)}catch{return!1}return!0}setCellContents(e,t){return this._crudOperations.setCellContents(e,t),this.recomputeIfDependencyGraphNeedsIt()}swapRowIndexes(e,t){return O(e,"number","sheetId"),this._crudOperations.setRowOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapRowIndexes(e,t){O(e,"number","sheetId");try{return this._crudOperations.validateSwapRowIndexes(e,t),this._crudOperations.testRowOrderForArrays(e,t),!0}catch{return!1}}setRowOrder(e,t){O(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"row");return this.swapRowIndexes(e,r)}isItPossibleToSetRowOrder(e,t){O(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"row");return this._crudOperations.validateSwapRowIndexes(e,r),this._crudOperations.testRowOrderForArrays(e,r),!0}catch{return!1}}swapColumnIndexes(e,t){return O(e,"number","sheetId"),this._crudOperations.setColumnOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapColumnIndexes(e,t){O(e,"number","sheetId");try{return this._crudOperations.validateSwapColumnIndexes(e,t),this._crudOperations.testColumnOrderForArrays(e,t),!0}catch{return!1}}setColumnOrder(e,t){O(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"column");return this.swapColumnIndexes(e,r)}isItPossibleToSetColumnOrder(e,t){O(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"column");return this._crudOperations.validateSwapColumnIndexes(e,r),this._crudOperations.testColumnOrderForArrays(e,r),!0}catch{return!1}}isItPossibleToAddRows(e,...t){O(e,"number","sheetId");const r=ca(t);try{return this._crudOperations.ensureItIsPossibleToAddRows(e,...r),!0}catch{return!1}}addRows(e,...t){return O(e,"number","sheetId"),this._crudOperations.addRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveRows(e,...t){O(e,"number","sheetId");const r=la(t);try{return this._crudOperations.ensureItIsPossibleToRemoveRows(e,...r),!0}catch{return!1}}removeRows(e,...t){return O(e,"number","sheetId"),this._crudOperations.removeRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToAddColumns(e,...t){O(e,"number","sheetId");const r=ca(t);try{return this._crudOperations.ensureItIsPossibleToAddColumns(e,...r),!0}catch{return!1}}addColumns(e,...t){return O(e,"number","sheetId"),this._crudOperations.addColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveColumns(e,...t){O(e,"number","sheetId");const r=la(t);try{return this._crudOperations.ensureItIsPossibleToRemoveColumns(e,...r),!0}catch{return!1}}removeColumns(e,...t){return O(e,"number","sheetId"),this._crudOperations.removeColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveCells(e,t){if(!_e(t))throw new oe("SimpleCellAddress","destinationLeftCorner");if(!Pt(e))throw new oe("SimpleCellRange","source");try{const r=new B(e.start,e.end);return this._crudOperations.operations.ensureItIsPossibleToMoveCells(r.start,r.width(),r.height(),t),!0}catch{return!1}}moveCells(e,t){if(!_e(t))throw new oe("SimpleCellAddress","destinationLeftCorner");if(!Pt(e))throw new oe("SimpleCellRange","source");const r=new B(e.start,e.end);return this._crudOperations.moveCells(r.start,r.width(),r.height(),t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveRows(e,t,r,n){O(e,"number","sheetId"),O(t,"number","startRow"),O(r,"number","numberOfRows"),O(n,"number","targetRow");try{return this._crudOperations.ensureItIsPossibleToMoveRows(e,t,r,n),!0}catch{return!1}}moveRows(e,t,r,n){return O(e,"number","sheetId"),O(t,"number","startRow"),O(r,"number","numberOfRows"),O(n,"number","targetRow"),this._crudOperations.moveRows(e,t,r,n),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveColumns(e,t,r,n){O(e,"number","sheetId"),O(t,"number","startColumn"),O(r,"number","numberOfColumns"),O(n,"number","targetColumn");try{return this._crudOperations.ensureItIsPossibleToMoveColumns(e,t,r,n),!0}catch{return!1}}moveColumns(e,t,r,n){return O(e,"number","sheetId"),O(t,"number","startColumn"),O(r,"number","numberOfColumns"),O(n,"number","targetColumn"),this._crudOperations.moveColumns(e,t,r,n),this.recomputeIfDependencyGraphNeedsIt()}copy(e){if(!Pt(e))throw new oe("SimpleCellRange","source");const t=new B(e.start,e.end);return this._crudOperations.copy(t.start,t.width(),t.height()),this.getRangeValues(e)}cut(e){if(!Pt(e))throw new oe("SimpleCellRange","source");const t=new B(e.start,e.end);return this._crudOperations.cut(t.start,t.width(),t.height()),this.getRangeValues(e)}paste(e){if(!_e(e))throw new oe("SimpleCellAddress","targetLeftCorner");return this.ensureEvaluationIsNotSuspended(),this._crudOperations.paste(e),this.recomputeIfDependencyGraphNeedsIt()}isClipboardEmpty(){return this._crudOperations.isClipboardEmpty()}clearClipboard(){this._crudOperations.clearClipboard()}clearRedoStack(){this._crudOperations.undoRedo.clearRedoStack()}clearUndoStack(){this._crudOperations.undoRedo.clearUndoStack()}getRangeValues(e){if(!Pt(e))throw new oe("SimpleCellRange","source");return new B(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellValue(n)))}getRangeFormulas(e){if(!Pt(e))throw new oe("SimpleCellRange","source");return new B(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellFormula(n)))}getRangeSerialized(e){if(!Pt(e))throw new oe("SimpleCellRange","source");return new B(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellSerialized(n)))}getFillRangeData(e,t,r=!1){if(!Pt(e))throw new oe("SimpleCellRange","source");if(!Pt(t))throw new oe("SimpleCellRange","target");const n=new B(e.start,e.end),i=new B(t.start,t.end);return this.ensureEvaluationIsNotSuspended(),i.arrayOfAddressesInRange().map(a=>a.map(o=>{const u=((o.row-(r?t:e).start.row)%n.height()+n.height())%n.height()+e.start.row,l=((o.col-(r?t:e).start.col)%n.width()+n.width())%n.width()+e.start.col;return this._serialization.getCellSerialized({row:u,col:l,sheet:n.sheet},o)}))}isItPossibleToAddSheet(e){O(e,"string","sheetName");try{return this._crudOperations.ensureItIsPossibleToAddSheet(e),!0}catch{return!1}}addSheet(e){e!==void 0&&O(e,"string","sheetName");const t=this._crudOperations.addSheet(e);return this._emitter.emit(Nr.SheetAdded,t),t}isItPossibleToRemoveSheet(e){O(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch{return!1}}removeSheet(e){O(e,"number","sheetId");const t=this.sheetMapping.getDisplayName(e);this._crudOperations.removeSheet(e);const r=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Nr.SheetRemoved,t,r),r}isItPossibleToClearSheet(e){O(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch{return!1}}clearSheet(e){return O(e,"number","sheetId"),this._crudOperations.clearSheet(e),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToReplaceSheetContent(e,t){O(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),this._crudOperations.ensureItIsPossibleToChangeSheetContents(e,t),!0}catch{return!1}}setSheetContent(e,t){return O(e,"number","sheetId"),this._crudOperations.setSheetContent(e,t),this.recomputeIfDependencyGraphNeedsIt()}simpleCellAddressFromString(e,t){return O(e,"string","cellAddress"),O(t,"number","sheetId"),uo(this.sheetMapping.get,e,t)}simpleCellRangeFromString(e,t){return O(e,"string","cellRange"),O(t,"number","sheetId"),Bg(this.sheetMapping.get,e,t)}simpleCellAddressToString(e,t={}){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");const r=typeof t=="number"?t:t.includeSheetName?e.sheet+1:e.sheet;return Wi(this.sheetMapping.fetchDisplayName,e,r)}simpleCellRangeToString(e,t={}){if(!Pt(e))throw new oe("SimpleCellRange","cellRange");const r=typeof t=="number"?t:t.includeSheetName?e.start.sheet+e.end.sheet+1:e.start.sheet;return kg(this.sheetMapping.fetchDisplayName,e,r)}getCellDependents(e){let t;if(_e(e))t=this._dependencyGraph.addressMapping.getCell(e);else if(Pt(e))t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end);else throw new oe("SimpleCellAddress | SimpleCellRange",e);return t===void 0?[]:this._dependencyGraph.getAdjacentNodesAddresses(t)}getCellPrecedents(e){let t;if(_e(e))t=this._dependencyGraph.addressMapping.getCell(e);else if(Pt(e))t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end);else throw new oe("SimpleCellAddress | SimpleCellRange",e);return t===void 0?[]:this._dependencyGraph.dependencyQueryAddresses(t)}getSheetName(e){return O(e,"number","sheetId"),this.sheetMapping.getDisplayName(e)}getSheetNames(){return this.sheetMapping.sheetNames()}getSheetId(e){return O(e,"string","sheetName"),this.sheetMapping.get(e)}doesSheetExist(e){return O(e,"string","sheetName"),this.sheetMapping.hasSheetWithName(e)}getCellType(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");const t=this.dependencyGraph.getCell(e);return ay(t,e)}doesCellHaveSimpleValue(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");return this.getCellType(e)===vt.VALUE}doesCellHaveFormula(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===vt.FORMULA||t===vt.ARRAYFORMULA}isCellEmpty(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");return this.getCellType(e)===vt.EMPTY}isCellPartOfArray(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===vt.ARRAY||t===vt.ARRAYFORMULA}getCellValueType(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return sa(t)}getCellValueDetailedType(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return uy(t)}getCellValueFormat(e){if(!_e(e))throw new oe("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return ly(t)}countSheets(){return this.sheetMapping.numberOfSheets()}isItPossibleToRenameSheet(e,t){O(e,"number","sheetId"),O(t,"string","newName");try{return this._crudOperations.ensureItIsPossibleToRenameSheet(e,t),!0}catch{return!1}}renameSheet(e,t){O(e,"number","sheetId"),O(t,"string","newName");const r=this._crudOperations.renameSheet(e,t);r!==void 0&&this._emitter.emit(Nr.SheetRenamed,r,t)}batch(e){this.suspendEvaluation(),this._crudOperations.beginUndoRedoBatchMode();try{e()}catch(t){throw this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation(),t}return this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation()}suspendEvaluation(){this._evaluationSuspended=!0,this._emitter.emit(Nr.EvaluationSuspended)}resumeEvaluation(){this._evaluationSuspended=!1;const e=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Nr.EvaluationResumed,e),e}isEvaluationSuspended(){return this._evaluationSuspended}isItPossibleToAddNamedExpression(e,t,r){O(e,"string","expressionName"),r!==void 0&&O(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToAddNamedExpression(e,t,r),!0}catch{return!1}}addNamedExpression(e,t,r,n){O(e,"string","expressionName"),r!==void 0&&O(r,"number","scope"),this._crudOperations.addNamedExpression(e,t,r,n);const i=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Nr.NamedExpressionAdded,e,i),i}getNamedExpressionValue(e,t){O(e,"string","expressionName"),t!==void 0&&O(t,"number","scope"),this.ensureEvaluationIsNotSuspended(),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);if(r)return this._serialization.getCellValue(r.address)}getNamedExpressionFormula(e,t){O(e,"string","expressionName"),t!==void 0&&O(t,"number","scope"),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);if(r!==void 0)return this._serialization.getCellFormula(r.address)}getNamedExpression(e,t){O(e,"string","expressionName"),t!==void 0&&O(t,"number","scope");const r=this._namedExpressions.namedExpressionForScope(e,t);if(r===void 0)return;const n=this._serialization.getCellFormula(r.address);return{name:e,scope:t,expression:n,options:r.options}}isItPossibleToChangeNamedExpression(e,t,r){O(e,"string","expressionName"),r!==void 0&&O(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToChangeNamedExpression(e,t,r),!0}catch{return!1}}changeNamedExpression(e,t,r,n){return O(e,"string","expressionName"),r!==void 0&&O(r,"number","scope"),this._crudOperations.changeNamedExpressionExpression(e,r,t,n),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveNamedExpression(e,t){O(e,"string","expressionName"),t!==void 0&&O(t,"number","scope");try{return this._crudOperations.isItPossibleToRemoveNamedExpression(e,t),!0}catch{return!1}}removeNamedExpression(e,t){O(e,"string","expressionName"),t!==void 0&&O(t,"number","scope");const r=this._crudOperations.removeNamedExpression(e,t);if(r){const n=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Nr.NamedExpressionRemoved,r.displayName,n),n}else return[]}listNamedExpressions(e){return e!==void 0&&O(e,"number","scope"),this._crudOperations.ensureScopeIdIsValid(e),this._namedExpressions.getAllNamedExpressionsNamesInScope(e)}getAllNamedExpressionsSerialized(){return this._serialization.getAllNamedExpressionsSerialized()}normalizeFormula(e){O(e,"string","formulaString");const{ast:t,address:r}=this.extractTemporaryFormula(e);if(t===void 0)throw new Li;return this._unparser.unparse(t,r)}calculateFormula(e,t){O(e,"string","formulaString"),O(t,"number","sheetId"),this._crudOperations.ensureScopeIdIsValid(t);const{ast:r,address:n,dependencies:i}=this.extractTemporaryFormula(e,t);if(r===void 0)throw new Li;const a=this.evaluator.runAndForget(r,n,i);return this._exporter.exportScalarOrRange(a)}getNamedExpressionsFromFormula(e){O(e,"string","formulaString");const{ast:t,dependencies:r}=this.extractTemporaryFormula(e);if(t===void 0)throw new Li;const n=r.filter(a=>a instanceof Dr).map(a=>a.name);return[...new Set(n)]}validateFormula(e){O(e,"string","formulaString");const{ast:t}=this.extractTemporaryFormula(e);return t!==void 0}getRegisteredFunctionNames(){return rt.getLanguage(this._config.language).getFunctionTranslations(this._functionRegistry.getRegisteredFunctionIds())}getFunctionPlugin(e){return O(e,"string","functionId"),this._functionRegistry.getFunctionPlugin(e)}getAllFunctionPlugins(){return this._functionRegistry.getPlugins()}numberToDateTime(e){return O(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDateTime(e)}numberToDate(e){return O(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDate(e)}numberToTime(e){return O(e,"number","val"),Kn(e)}on(e,t){this._emitter.on(e,t)}once(e,t){this._emitter.once(e,t)}off(e,t){this._emitter.off(e,t)}destroy(){QT(this)}ensureEvaluationIsNotSuspended(){if(this._evaluationSuspended)throw new Rd}extractTemporaryFormula(e,t=1){const r=this._cellContentParser.parse(e),n={sheet:t,col:0,row:0};if(!(r instanceof Ie.Formula))return{address:n,dependencies:[]};const{ast:i,errors:a,dependencies:o}=this._parser.parse(r.formula,n);return a.length>0?{address:n,dependencies:[]}:{ast:i,address:n,dependencies:o}}rebuildWithConfig(e){const t=this._config.mergeConfig(e),r=this._config.mergeConfig({language:e.language}),n=this._serialization.withNewConfig(r,this._namedExpressions).getAllSheetsSerialized(),i=this._serialization.getAllNamedExpressionsSerialized(),a=gi.rebuildWithConfig(t,n,i,this._stats);this._config=a.config,this._stats=a.stats,this._dependencyGraph=a.dependencyGraph,this._columnSearch=a.columnSearch,this._parser=a.parser,this._unparser=a.unparser,this._cellContentParser=a.cellContentParser,this._evaluator=a.evaluator,this._lazilyTransformingAstService=a.lazilyTransformingAstService,this._crudOperations=a.crudOperations,this._exporter=a.exporter,this._namedExpressions=a.namedExpressions,this._serialization=a.serialization,this._functionRegistry=a.functionRegistry}recomputeIfDependencyGraphNeedsIt(){if(this._evaluationSuspended)return[];{const e=this._crudOperations.getAndClearContentChanges(),t=this.dependencyGraph.verticesToRecompute();this.dependencyGraph.clearDirtyVertices(),t.length>0&&e.addAll(this.evaluator.partialRun(t));const r=e.exportChanges(this._exporter);return e.isEmpty()||this._emitter.emit(Nr.ValuesUpdated,r),r}}}rt.version="3.1.0";rt.buildDate="14/10/2025 09:41:56";rt.releaseDate="14/10/2025";rt.languages={};rt.registeredLanguages=new Map;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const zl=new WeakMap;class kt{constructor(e={},t=!0){const{accentSensitive:r,caseSensitive:n,caseFirst:i,chooseAddressMappingPolicy:a,context:o,currencySymbol:u,dateFormats:l,decimalSeparator:h,evaluateNullToZero:d,functionArgSeparator:f,functionPlugins:p,ignorePunctuation:N,leapYear1900:g,localeLang:S,language:v,ignoreWhiteSpace:A,licenseKey:C,matchWholeCell:w,arrayColumnSeparator:M,arrayRowSeparator:L,maxRows:_,maxColumns:V,nullYear:k,nullDate:G,parseDateTime:U,precisionEpsilon:K,precisionRounding:z,stringifyDateTime:te,stringifyDuration:le,smartRounding:Te,timeFormats:Ee,thousandSeparator:Ue,useArrayArithmetic:re,useStats:Re,undoLimit:ve,useColumnIndex:ne,useRegularExpressions:Ae,useWildcards:ce}=e;this.useArrayArithmetic=he(re,"boolean","useArrayArithmetic"),this.accentSensitive=he(r,"boolean","accentSensitive"),this.caseSensitive=he(n,"boolean","caseSensitive"),this.caseFirst=he(i,["upper","lower","false"],"caseFirst"),this.ignorePunctuation=he(N,"boolean","ignorePunctuation"),this.chooseAddressMappingPolicy=a??kt.defaultConfig.chooseAddressMappingPolicy,this.dateFormats=[...ci(l,Array.isArray,"array","dateFormats")],this.timeFormats=[...ci(Ee,Array.isArray,"array","timeFormats")],this.functionArgSeparator=he(f,"string","functionArgSeparator"),this.decimalSeparator=he(h,[".",","],"decimalSeparator"),this.language=he(v,"string","language"),this.ignoreWhiteSpace=he(A,["standard","any"],"ignoreWhiteSpace"),this.licenseKey=he(C,"string","licenseKey"),this.thousandSeparator=he(Ue,["",","," ","."],"thousandSeparator"),this.arrayColumnSeparator=he(M,[",",";"],"arrayColumnSeparator"),this.arrayRowSeparator=he(L,[";","|"],"arrayRowSeparator"),this.localeLang=he(S,"string","localeLang"),this.functionPlugins=[...p??kt.defaultConfig.functionPlugins],this.smartRounding=he(Te,"boolean","smartRounding"),this.evaluateNullToZero=he(d,"boolean","evaluateNullToZero"),this.nullYear=he(k,"number","nullYear"),Ln(this.nullYear,"nullYear",0),Cy(this.nullYear,"nullYear",100),this.precisionRounding=he(z,"number","precisionRounding"),Ln(this.precisionRounding,"precisionRounding",0),this.precisionEpsilon=he(K,"number","precisionEpsilon"),Ln(this.precisionEpsilon,"precisionEpsilon",0),this.useColumnIndex=he(ne,"boolean","useColumnIndex"),this.useStats=he(Re,"boolean","useStats"),this.parseDateTime=he(U,"function","parseDateTime"),this.stringifyDateTime=he(te,"function","stringifyDateTime"),this.stringifyDuration=he(le,"function","stringifyDuration"),this.translationPackage=rt.getLanguage(this.language),this.errorMapping=this.translationPackage.buildErrorMapping(),this.nullDate=ci(G,Ls,"IDate","nullDate"),this.leapYear1900=he(g,"boolean","leapYear1900"),this.undoLimit=he(ve,"number","undoLimit"),this.useRegularExpressions=he(Ae,"boolean","useRegularExpressions"),this.useWildcards=he(ce,"boolean","useWildcards"),this.matchWholeCell=he(w,"boolean","matchWholeCell"),Ln(this.undoLimit,"undoLimit",0),this.maxRows=he(_,"number","maxRows"),Ln(this.maxRows,"maxRows",1),this.maxColumns=he(V,"number","maxColumns"),this.currencySymbol=this.setupCurrencySymbol(u),Ln(this.maxColumns,"maxColumns",1),this.context=o,zl.set(this,{licenseKeyValidityState:Qy(this.licenseKey)}),Ml({value:this.decimalSeparator,name:"decimalSeparator"},{value:this.functionArgSeparator,name:"functionArgSeparator"},{value:this.thousandSeparator,name:"thousandSeparator"}),Ml({value:this.arrayRowSeparator,name:"arrayRowSeparator"},{value:this.arrayColumnSeparator,name:"arrayColumnSeparator"})}setupCurrencySymbol(e){const t=[...ci(e,Array.isArray,"array","currencySymbol")];return t.forEach(r=>{if(typeof r!="string")throw new oe("string[]","currencySymbol");if(r==="")throw new WN("currencySymbol")}),t}get licenseKeyValidityState(){return zl.get(this).licenseKeyValidityState}getConfig(){return zd(this)}mergeConfig(e){const t=Object.assign({},this.getConfig(),e);return new kt(t,!1)}static warnDeprecatedOptions(e){}static warnDeprecatedIfUsed(e,t,r,n){e!==void 0&&console.warn(n===void 0?`${t} option is deprecated since ${r}`:`${t} option is deprecated since ${r}, please use ${n}`)}}kt.defaultConfig={accentSensitive:!1,currencySymbol:["$"],caseSensitive:!1,caseFirst:"lower",context:void 0,chooseAddressMappingPolicy:new By,dateFormats:["DD/MM/YYYY","DD/MM/YY"],decimalSeparator:".",evaluateNullToZero:!1,functionArgSeparator:",",functionPlugins:[],ignorePunctuation:!1,language:"enGB",ignoreWhiteSpace:"standard",licenseKey:"",leapYear1900:!1,localeLang:"en",matchWholeCell:!0,arrayColumnSeparator:",",arrayRowSeparator:";",maxRows:4e4,maxColumns:18278,nullYear:30,nullDate:{year:1899,month:12,day:30},parseDateTime:by,precisionEpsilon:1e-13,precisionRounding:10,smartRounding:!0,stringifyDateTime:$y,stringifyDuration:jy,timeFormats:["hh:mm","hh:mm:ss.sss"],thousandSeparator:"",undoLimit:20,useRegularExpressions:!1,useWildcards:!0,useColumnIndex:!1,useStats:!1,useArrayArithmetic:!1};function zd(s){var e;const t={};for(const r in kt.defaultConfig){const n=(e=s[r])!==null&&e!==void 0?e:kt.defaultConfig[r];Array.isArray(n)?t[r]=[...n]:t[r]=n}return t}function rv(){return zd({})}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Fo={errors:{CYCLE:"#CYCLE!",DIV_BY_ZERO:"#DIV/0!",ERROR:"#ERROR!",NA:"#N/A",NAME:"#NAME?",NUM:"#NUM!",REF:"#REF!",SPILL:"#SPILL!",VALUE:"#VALUE!"},functions:{FILTER:"FILTER",ADDRESS:"ADDRESS",ARRAY_CONSTRAIN:"ARRAY_CONSTRAIN",ARRAYFORMULA:"ARRAYFORMULA",ABS:"ABS",ACOS:"ACOS",ACOSH:"ACOSH",ACOT:"ACOT",ACOTH:"ACOTH",AND:"AND",ARABIC:"ARABIC",ASIN:"ASIN",ASINH:"ASINH",ATAN2:"ATAN2",ATAN:"ATAN",ATANH:"ATANH",AVERAGE:"AVERAGE",AVERAGEA:"AVERAGEA",AVERAGEIF:"AVERAGEIF",BASE:"BASE",BIN2DEC:"BIN2DEC",BIN2HEX:"BIN2HEX",BIN2OCT:"BIN2OCT",BITAND:"BITAND",BITLSHIFT:"BITLSHIFT",BITOR:"BITOR",BITRSHIFT:"BITRSHIFT",BITXOR:"BITXOR",CEILING:"CEILING",CHAR:"CHAR",CHOOSE:"CHOOSE",CLEAN:"CLEAN",CODE:"CODE",COLUMN:"COLUMN",COLUMNS:"COLUMNS",CONCATENATE:"CONCATENATE",CORREL:"CORREL",COS:"COS",COSH:"COSH",COT:"COT",COTH:"COTH",COUNT:"COUNT",COUNTA:"COUNTA",COUNTBLANK:"COUNTBLANK",COUNTIF:"COUNTIF",COUNTIFS:"COUNTIFS",COUNTUNIQUE:"COUNTUNIQUE",CSC:"CSC",CSCH:"CSCH",CUMIPMT:"CUMIPMT",CUMPRINC:"CUMPRINC",DATE:"DATE",DATEDIF:"DATEDIF",DATEVALUE:"DATEVALUE",DAY:"DAY",DAYS360:"DAYS360",DAYS:"DAYS",DB:"DB",DDB:"DDB",DEC2BIN:"DEC2BIN",DEC2HEX:"DEC2HEX",DEC2OCT:"DEC2OCT",DECIMAL:"DECIMAL",DEGREES:"DEGREES",DELTA:"DELTA",DOLLARDE:"DOLLARDE",DOLLARFR:"DOLLARFR",EDATE:"EDATE",EFFECT:"EFFECT",EOMONTH:"EOMONTH",ERF:"ERF",ERFC:"ERFC",EVEN:"EVEN",EXACT:"EXACT",EXP:"EXP",FALSE:"FALSE",FIND:"FIND",FORMULATEXT:"FORMULATEXT",FV:"FV",FVSCHEDULE:"FVSCHEDULE",HEX2BIN:"HEX2BIN",HEX2DEC:"HEX2DEC",HEX2OCT:"HEX2OCT",HLOOKUP:"HLOOKUP",HOUR:"HOUR",HYPERLINK:"HYPERLINK",IF:"IF",IFERROR:"IFERROR",IFNA:"IFNA",IFS:"IFS",INDEX:"INDEX",INT:"INT",INTERVAL:"INTERVAL",IPMT:"IPMT",ISBINARY:"ISBINARY",ISBLANK:"ISBLANK",ISERR:"ISERR",ISERROR:"ISERROR",ISEVEN:"ISEVEN",ISFORMULA:"ISFORMULA",ISLOGICAL:"ISLOGICAL",ISNA:"ISNA",ISNONTEXT:"ISNONTEXT",ISNUMBER:"ISNUMBER",ISODD:"ISODD",ISOWEEKNUM:"ISOWEEKNUM",ISPMT:"ISPMT",ISREF:"ISREF",ISTEXT:"ISTEXT",LEFT:"LEFT",LEN:"LEN",LN:"LN",LOG10:"LOG10",LOG:"LOG",LOWER:"LOWER",MATCH:"MATCH",MAX:"MAX",MAXA:"MAXA",MAXIFS:"MAXIFS",MAXPOOL:"MAXPOOL",MEDIAN:"MEDIAN",MEDIANPOOL:"MEDIANPOOL",MID:"MID",MIN:"MIN",MINA:"MINA",MINIFS:"MINIFS",MINUTE:"MINUTE",MIRR:"MIRR",MMULT:"MMULT",MOD:"MOD",MONTH:"MONTH",NA:"NA",NETWORKDAYS:"NETWORKDAYS","NETWORKDAYS.INTL":"NETWORKDAYS.INTL",NOMINAL:"NOMINAL",NOT:"NOT",NOW:"NOW",NPER:"NPER",NPV:"NPV",OCT2BIN:"OCT2BIN",OCT2DEC:"OCT2DEC",OCT2HEX:"OCT2HEX",ODD:"ODD",OFFSET:"OFFSET",OR:"OR",PI:"PI",PMT:"PMT",PDURATION:"PDURATION",PRODUCT:"PRODUCT",POWER:"POWER",PPMT:"PPMT",PROPER:"PROPER",PV:"PV",RADIANS:"RADIANS",RAND:"RAND",RATE:"RATE",REPLACE:"REPLACE",REPT:"REPT",RIGHT:"RIGHT",ROMAN:"ROMAN",ROUND:"ROUND",ROUNDDOWN:"ROUNDDOWN",ROUNDUP:"ROUNDUP",ROW:"ROW",ROWS:"ROWS",RRI:"RRI",SEARCH:"SEARCH",SEC:"SEC",SECH:"SECH",SECOND:"SECOND",SHEET:"SHEET",SHEETS:"SHEETS",SIN:"SIN",SINH:"SINH",SLN:"SLN",SPLIT:"SPLIT",SQRT:"SQRT",STDEVA:"STDEVA","STDEV.P":"STDEV.P",STDEVPA:"STDEVPA","STDEV.S":"STDEV.S",SUBSTITUTE:"SUBSTITUTE",SUBTOTAL:"SUBTOTAL",SUM:"SUM",SUMIF:"SUMIF",SUMIFS:"SUMIFS",SUMPRODUCT:"SUMPRODUCT",SUMSQ:"SUMSQ",SWITCH:"SWITCH",SYD:"SYD",T:"T",TAN:"TAN",TANH:"TANH",TBILLEQ:"TBILLEQ",TBILLPRICE:"TBILLPRICE",TBILLYIELD:"TBILLYIELD",TEXT:"TEXT",TIME:"TIME",TIMEVALUE:"TIMEVALUE",TODAY:"TODAY",TRANSPOSE:"TRANSPOSE",TRIM:"TRIM",TRUE:"TRUE",TRUNC:"TRUNC",UNICHAR:"UNICHAR",UNICODE:"UNICODE",UPPER:"UPPER",VARA:"VARA","VAR.P":"VAR.P",VARPA:"VARPA","VAR.S":"VAR.S",VLOOKUP:"VLOOKUP",WEEKDAY:"WEEKDAY",WEEKNUM:"WEEKNUM",WORKDAY:"WORKDAY","WORKDAY.INTL":"WORKDAY.INTL",XNPV:"XNPV",XOR:"XOR",XLOOKUP:"XLOOKUP",YEAR:"YEAR",YEARFRAC:"YEARFRAC","HF.ADD":"HF.ADD","HF.CONCAT":"HF.CONCAT","HF.DIVIDE":"HF.DIVIDE","HF.EQ":"HF.EQ","HF.GT":"HF.GT","HF.GTE":"HF.GTE","HF.LT":"HF.LT","HF.LTE":"HF.LTE","HF.MINUS":"HF.MINUS","HF.MULTIPLY":"HF.MULTIPLY","HF.NE":"HF.NE","HF.POW":"HF.POW","HF.UMINUS":"HF.UMINUS","HF.UNARY_PERCENT":"HF.UNARY_PERCENT","HF.UPLUS":"HF.UPLUS",VARP:"VARP",VAR:"VAR",STDEVP:"STDEVP",STDEV:"STDEV","EXPON.DIST":"EXPON.DIST",FISHER:"FISHER",FISHERINV:"FISHERINV",GAMMA:"GAMMA","GAMMA.DIST":"GAMMA.DIST",GAMMALN:"GAMMALN","GAMMALN.PRECISE":"GAMMALN.PRECISE","GAMMA.INV":"GAMMA.INV",GAUSS:"GAUSS",FACT:"FACT",FACTDOUBLE:"FACTDOUBLE",COMBIN:"COMBIN",COMBINA:"COMBINA",GCD:"GCD",LCM:"LCM",MROUND:"MROUND",MULTINOMIAL:"MULTINOMIAL",QUOTIENT:"QUOTIENT",RANDBETWEEN:"RANDBETWEEN",SERIESSUM:"SERIESSUM",SIGN:"SIGN",SQRTPI:"SQRTPI",SUMX2MY2:"SUMX2MY2",SUMX2PY2:"SUMX2PY2",SUMXMY2:"SUMXMY2",EXPONDIST:"EXPONDIST",GAMMADIST:"GAMMADIST",GAMMAINV:"GAMMAINV","BETA.DIST":"BETA.DIST",BETADIST:"BETADIST","BETA.INV":"BETA.INV",BETAINV:"BETAINV","BINOM.DIST":"BINOM.DIST",BINOMDIST:"BINOMDIST","BINOM.INV":"BINOM.INV",BESSELI:"BESSELI",BESSELJ:"BESSELJ",BESSELK:"BESSELK",BESSELY:"BESSELY","CHISQ.DIST":"CHISQ.DIST","CHISQ.DIST.RT":"CHISQ.DIST.RT","CHISQ.INV":"CHISQ.INV","CHISQ.INV.RT":"CHISQ.INV.RT",CHIDIST:"CHIDIST",CHIINV:"CHIINV","F.DIST":"F.DIST","F.DIST.RT":"F.DIST.RT","F.INV":"F.INV","F.INV.RT":"F.INV.RT",FDIST:"FDIST",FINV:"FINV",WEIBULL:"WEIBULL","WEIBULL.DIST":"WEIBULL.DIST",POISSON:"POISSON","POISSON.DIST":"POISSON.DIST","HYPGEOM.DIST":"HYPGEOM.DIST",HYPGEOMDIST:"HYPGEOMDIST","T.DIST":"T.DIST","T.DIST.2T":"T.DIST.2T","T.DIST.RT":"T.DIST.RT","T.INV":"T.INV","T.INV.2T":"T.INV.2T",TDIST:"TDIST",TINV:"TINV",LOGINV:"LOGINV","LOGNORM.DIST":"LOGNORM.DIST","LOGNORM.INV":"LOGNORM.INV",LOGNORMDIST:"LOGNORMDIST","NORM.DIST":"NORM.DIST","NORM.INV":"NORM.INV","NORM.S.DIST":"NORM.S.DIST","NORM.S.INV":"NORM.S.INV",NORMDIST:"NORMDIST",NORMINV:"NORMINV",NORMSDIST:"NORMSDIST",NORMSINV:"NORMSINV",PHI:"PHI","NEGBINOM.DIST":"NEGBINOM.DIST",NEGBINOMDIST:"NEGBINOMDIST",COMPLEX:"COMPLEX",IMABS:"IMABS",IMAGINARY:"IMAGINARY",IMARGUMENT:"IMARGUMENT",IMCONJUGATE:"IMCONJUGATE",IMCOS:"IMCOS",IMCOSH:"IMCOSH",IMCOT:"IMCOT",IMCSC:"IMCSC",IMCSCH:"IMCSCH",IMDIV:"IMDIV",IMEXP:"IMEXP",IMLN:"IMLN",IMLOG10:"IMLOG10",IMLOG2:"IMLOG2",IMPOWER:"IMPOWER",IMPRODUCT:"IMPRODUCT",IMREAL:"IMREAL",IMSEC:"IMSEC",IMSECH:"IMSECH",IMSIN:"IMSIN",IMSINH:"IMSINH",IMSQRT:"IMSQRT",IMSUB:"IMSUB",IMSUM:"IMSUM",IMTAN:"IMTAN",LARGE:"LARGE",SMALL:"SMALL",AVEDEV:"AVEDEV",CONFIDENCE:"CONFIDENCE","CONFIDENCE.NORM":"CONFIDENCE.NORM","CONFIDENCE.T":"CONFIDENCE.T",DEVSQ:"DEVSQ",GEOMEAN:"GEOMEAN",HARMEAN:"HARMEAN",CRITBINOM:"CRITBINOM","COVARIANCE.P":"COVARIANCE.P","COVARIANCE.S":"COVARIANCE.S",COVAR:"COVAR",PEARSON:"PEARSON",RSQ:"RSQ",STANDARDIZE:"STANDARDIZE","Z.TEST":"Z.TEST",ZTEST:"ZTEST","F.TEST":"F.TEST",FTEST:"FTEST",STEYX:"STEYX",SLOPE:"SLOPE","CHISQ.TEST":"CHISQ.TEST",CHITEST:"CHITEST","T.TEST":"T.TEST",TTEST:"TTEST",SKEW:"SKEW","SKEW.P":"SKEW.P",WEIBULLDIST:"WEIBULLDIST",VARS:"VARS",TINV2T:"TINV2T",TDISTRT:"TDISTRT",TDIST2T:"TDIST2T",STDEVS:"STDEVS",FINVRT:"FINVRT",FDISTRT:"FDISTRT",CHIDISTRT:"CHIDISTRT",CHIINVRT:"CHIINVRT",COVARIANCEP:"COVARIANCEP",COVARIANCES:"COVARIANCES",LOGNORMINV:"LOGNORMINV",POISSONDIST:"POISSONDIST",SKEWP:"SKEWP","CEILING.MATH":"CEILING.MATH",FLOOR:"FLOOR","FLOOR.MATH":"FLOOR.MATH","CEILING.PRECISE":"CEILING.PRECISE","FLOOR.PRECISE":"FLOOR.PRECISE","ISO.CEILING":"ISO.CEILING"},langCode:"enGB",ui:{NEW_SHEET_PREFIX:"Sheet"}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Qr;(function(s){s[s.FullyAbsolute=1]="FullyAbsolute",s[s.RowAbsoluteColRelative=2]="RowAbsoluteColRelative",s[s.RowRelativeColAbsolute=3]="RowRelativeColAbsolute",s[s.FullyRelative=4]="FullyRelative"})(Qr||(Qr={}));class Yd extends ${verifyAddressArguments(e,t,r,n){if(n){if(e<1||t<1)return new m(E.VALUE,y.LessThanOne)}else if(Qr.FullyAbsolute==r){if(e<1||t<1)return new m(E.VALUE,y.LessThanOne)}else if(Qr.RowAbsoluteColRelative==r){if(e<1)return new m(E.VALUE,y.LessThanOne)}else if(Qr.RowRelativeColAbsolute==r&&t<1)return new m(E.VALUE,y.LessThanOne)}address(e,t){return this.runFunction(e.args,t,this.metadata("ADDRESS"),(r,n,i,a,o)=>{const u=this.verifyAddressArguments(r,n,i,a);if(u!==void 0)return u;const l=ya(n-1);let h="";o!=null&&(h=`${o}!`);const d=n==0?"C":`C[${n}]`,f=r==0?"R":`R[${r}]`;return Qr.FullyRelative==i?a?`${h}${l}${r}`:`${h}${f}${d}`:Qr.RowRelativeColAbsolute==i?a?`${h}$${l}${r}`:`${h}${f}C${n}`:Qr.RowAbsoluteColRelative==i?a?`${h}${l}$${r}`:`${h}R${r}${d}`:a?`${h}$${l}$${r}`:`${h}R${r}C${n}`})}}Yd.implementedFunctions={ADDRESS:{method:"address",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,optionalArg:!0,defaultValue:1,minValue:1,maxValue:4},{argumentType:c.BOOLEAN,optionalArg:!0,defaultValue:!0},{argumentType:c.STRING,optionalArg:!0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class jd extends ${arrayformula(e,t){return this.runFunction(e.args,t,this.metadata("ARRAYFORMULA"),r=>r)}arrayformulaArraySize(e,t){if(e.args.length!==1)return X.error();const r=this.metadata("ARRAYFORMULA");return e.args.map(i=>{var a;return this.arraySizeForAst(i,new Ir(t.formulaAddress,t.arraysFlag||((a=r?.enableArrayArithmeticForArguments)!==null&&a!==void 0?a:!1)))})[0]}arrayconstrain(e,t){return this.runFunction(e.args,t,this.metadata("ARRAY_CONSTRAIN"),(r,n,i)=>{n=Math.min(n,r.height()),i=Math.min(i,r.width());const a=r.data,o=[];for(let u=0;u<n;u++)o.push(a[u].slice(0,i));return F.onlyValues(o)})}arrayconstrainArraySize(e,t){if(e.args.length!==3)return X.error();const r=this.metadata("ARRAY_CONSTRAIN"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new Ir(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))});let{height:i,width:a}=n[0];return e.args[1].type===R.NUMBER&&(i=Math.min(i,e.args[1].value)),e.args[2].type===R.NUMBER&&(a=Math.min(a,e.args[2].value)),i<1||a<1||!Number.isInteger(i)||!Number.isInteger(a)?X.error():new X(a,i)}filter(e,t){return this.runFunction(e.args,t,this.metadata("FILTER"),(r,...n)=>{for(const o of n)if(r.width()!==o.width()||r.height()!==o.height())return new m(E.NA,y.EqualLength);if(r.width()>1&&r.height()>1)return new m(E.NA,y.WrongDimension);const i=r.data,a=[];for(let o=0;o<r.height();o++){const u=[];for(let l=0;l<r.width();l++){let h=!0;for(const d of n)if(Ad(d.data[o][l])!==!0){h=!1;break}h&&u.push(i[o][l])}u.length>0&&a.push(u)}return a.length>0?F.onlyValues(a):new m(E.NA,y.EmptyRange)})}filterArraySize(e,t){if(e.args.length<=1)return X.error();const r=this.metadata("FILTER"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new Ir(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))}),i=Math.max(...n.map(o=>o.width)),a=Math.max(...n.map(o=>o.height));return new X(i,a)}}jd.implementedFunctions={ARRAYFORMULA:{method:"arrayformula",sizeOfResultArrayMethod:"arrayformulaArraySize",enableArrayArithmeticForArguments:!0,parameters:[{argumentType:c.ANY}]},ARRAY_CONSTRAIN:{method:"arrayconstrain",sizeOfResultArrayMethod:"arrayconstrainArraySize",parameters:[{argumentType:c.RANGE},{argumentType:c.INTEGER,minValue:1},{argumentType:c.INTEGER,minValue:1}],vectorizationForbidden:!0},FILTER:{method:"filter",sizeOfResultArrayMethod:"filterArraySize",enableArrayArithmeticForArguments:!0,parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class $d extends ${abs(e,t){return this.runFunction(e.args,t,this.metadata("ABS"),Math.abs)}}$d.implementedFunctions={ABS:{method:"abs",parameters:[{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const nv=0xffffffffffff,Yl=-53,jl=53;class Xd extends ${bitlshift(e,t){return this.runFunction(e.args,t,this.metadata("BITLSHIFT"),Kd)}bitrshift(e,t){return this.runFunction(e.args,t,this.metadata("BITRSHIFT"),qd)}}Xd.implementedFunctions={BITLSHIFT:{method:"bitlshift",parameters:[{argumentType:c.INTEGER,minValue:0},{argumentType:c.INTEGER,minValue:Yl,maxValue:jl}]},BITRSHIFT:{method:"bitrshift",parameters:[{argumentType:c.INTEGER,minValue:0},{argumentType:c.INTEGER,minValue:Yl,maxValue:jl}]}};function Kd(s,e){return e<0?qd(s,-e):Qd(s*Math.pow(2,e))}function qd(s,e){return e<0?Kd(s,-e):Qd(Math.floor(s/Math.pow(2,e)))}function Qd(s){return s>nv?new m(E.NUM,y.BitshiftLong):s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Zd extends ${bitand(e,t){return this.runFunction(e.args,t,this.metadata("BITAND"),(r,n)=>r&n)}bitor(e,t){return this.runFunction(e.args,t,this.metadata("BITOR"),(r,n)=>r|n)}bitxor(e,t){return this.runFunction(e.args,t,this.metadata("BITXOR"),(r,n)=>r^n)}}Zd.implementedFunctions={BITAND:{method:"bitand",parameters:[{argumentType:c.INTEGER,minValue:0},{argumentType:c.INTEGER,minValue:0}]},BITOR:{method:"bitor",parameters:[{argumentType:c.INTEGER,minValue:0},{argumentType:c.INTEGER,minValue:0}]},BITXOR:{method:"bitxor",parameters:[{argumentType:c.INTEGER,minValue:0},{argumentType:c.INTEGER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Jd extends ${literalTrue(e,t){return this.runFunction(e.args,t,this.metadata("TRUE"),()=>!0)}literalFalse(e,t){return this.runFunction(e.args,t,this.metadata("FALSE"),()=>!1)}conditionalIf(e,t){return this.runFunction(e.args,t,this.metadata("IF"),(r,n,i)=>r?n:i)}ifs(e,t){return this.runFunction(e.args,t,this.metadata("IFS"),(...r)=>{for(let n=0;n<r.length;n+=2)if(r[n])return r[n+1];return new m(E.NA,y.NoConditionMet)})}and(e,t){return this.runFunction(e.args,t,this.metadata("AND"),(...r)=>r.filter(n=>n!==void 0).every(n=>!!n))}or(e,t){return this.runFunction(e.args,t,this.metadata("OR"),(...r)=>r.filter(n=>n!==void 0).some(n=>n))}not(e,t){return this.runFunction(e.args,t,this.metadata("NOT"),r=>!r)}xor(e,t){return this.runFunction(e.args,t,this.metadata("XOR"),(...r)=>{let n=0;return r.filter(i=>i!==void 0).forEach(i=>{i&&n++}),n%2===1})}switch(e,t){return this.runFunction(e.args,t,this.metadata("SWITCH"),(r,...n)=>{const i=n.length;let a=0;for(;a+1<i;a+=2)if(!(n[a]instanceof m)&&this.arithmeticHelper.eq(r,n[a]))return n[a+1];return a<i?n[a]:new m(E.NA,y.NoDefault)})}iferror(e,t){return this.runFunction(e.args,t,this.metadata("IFERROR"),(r,n)=>r instanceof m?n:r)}ifna(e,t){return this.runFunction(e.args,t,this.metadata("IFNA"),(r,n)=>r instanceof m&&r.type===E.NA?n:r)}choose(e,t){return this.runFunction(e.args,t,this.metadata("CHOOSE"),(r,...n)=>r>n.length?new m(E.NUM,y.Selector):n[r-1])}}Jd.implementedFunctions={TRUE:{method:"literalTrue",parameters:[]},FALSE:{method:"literalFalse",parameters:[]},IF:{method:"conditionalIf",parameters:[{argumentType:c.BOOLEAN},{argumentType:c.SCALAR,passSubtype:!0},{argumentType:c.SCALAR,defaultValue:!1,passSubtype:!0}]},IFS:{method:"ifs",parameters:[{argumentType:c.BOOLEAN},{argumentType:c.SCALAR,passSubtype:!0}],repeatLastArgs:2},AND:{method:"and",parameters:[{argumentType:c.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},OR:{method:"or",parameters:[{argumentType:c.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},XOR:{method:"xor",parameters:[{argumentType:c.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},NOT:{method:"not",parameters:[{argumentType:c.BOOLEAN}]},SWITCH:{method:"switch",parameters:[{argumentType:c.NOERROR},{argumentType:c.SCALAR,passSubtype:!0},{argumentType:c.SCALAR,passSubtype:!0}],repeatLastArgs:1},IFERROR:{method:"iferror",parameters:[{argumentType:c.SCALAR,passSubtype:!0},{argumentType:c.SCALAR,passSubtype:!0}]},IFNA:{method:"ifna",parameters:[{argumentType:c.SCALAR,passSubtype:!0},{argumentType:c.SCALAR,passSubtype:!0}]},CHOOSE:{method:"choose",parameters:[{argumentType:c.INTEGER,minValue:1},{argumentType:c.SCALAR,passSubtype:!0}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ef extends ${char(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),r=>r<1||r>=256?new m(E.VALUE,y.CharacterCodeBounds):String.fromCharCode(Math.trunc(r)))}unichar(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),r=>r<1||r>=1114112?new m(E.VALUE,y.CharacterCodeBounds):String.fromCodePoint(Math.trunc(r)))}}ef.implementedFunctions={CHAR:{method:"char",parameters:[{argumentType:c.NUMBER}]},UNICHAR:{method:"unichar",parameters:[{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class tf extends ${code(e,t){return this.runFunction(e.args,t,this.metadata("CODE"),r=>r.length===0?new m(E.VALUE,y.EmptyString):r.charCodeAt(0))}unicode(e,t){return this.runFunction(e.args,t,this.metadata("UNICODE"),r=>{var n;return(n=r.codePointAt(0))!==null&&n!==void 0?n:new m(E.VALUE,y.EmptyString)})}}tf.implementedFunctions={CODE:{method:"code",parameters:[{argumentType:c.STRING}]},UNICODE:{method:"unicode",parameters:[{argumentType:c.STRING}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class rf extends ${countblank(e,t){return this.runFunction(e.args,t,this.metadata("COUNTBLANK"),(...r)=>{let n=0;return r.forEach(i=>{i===Z&&n++}),n})}}rf.implementedFunctions={COUNTBLANK:{method:"countblank",parameters:[{argumentType:c.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class nf extends ${countunique(e,t){return this.runFunction(e.args,t,this.metadata("COUNTUNIQUE"),(...r)=>{const n=new Set,i=new Set;for(const a of r)a instanceof m?i.add(a.type):a!==""&&n.add(a);return n.size+i.size})}}nf.implementedFunctions={COUNTUNIQUE:{method:"countunique",parameters:[{argumentType:c.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class sf extends ${constructor(){super(...arguments),this.isoweeknumCore=e=>{const t=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),r=this.dateTimeHelper.numberToSimpleDate(e),n=this.dateTimeHelper.dateToNumber({year:r.year,month:1,day:1}),i=this.dateTimeHelper.relativeNumberToAbsoluteNumber(n),a=i+((4-i)%7+7)%7,o=Math.floor((t-1)/7)-Math.floor((a-1)/7)+1;return o===0?this.isoweeknumCore(e-7)+1:o},this.days360Core=(e,t,r)=>{const n=this.dateTimeHelper.numberToSimpleDate(e),i=this.dateTimeHelper.numberToSimpleDate(t);let a,o;return r?(a=Ll(n),o=Ll(i)):[a,o]=this.dateTimeHelper.toBasisUS(n,i),360*(o.year-a.year)+30*(o.month-a.month)+o.day-a.day}}date(e,t){return this.runFunction(e.args,t,this.metadata("DATE"),(r,n,i)=>{const a=Math.trunc(i);let o=Math.trunc(n),u=Math.trunc(r);u<this.dateTimeHelper.getEpochYearZero()&&(u+=this.dateTimeHelper.getEpochYearZero());const l=Math.floor((o-1)/12);u+=l,o-=l*12;const h={year:u,month:o,day:1};if(this.dateTimeHelper.isValidDate(h)){let d=this.dateTimeHelper.dateToNumber(h)+(a-1);return d=this.dateTimeHelper.getWithinBounds(d),d===void 0?new m(E.NUM,y.DateBounds):d}return new m(E.VALUE,y.InvalidDate)})}time(e,t){return this.runFunction(e.args,t,this.metadata("TIME"),(r,n,i)=>{const a=qn({hours:Math.trunc(r),minutes:Math.trunc(n),seconds:Math.trunc(i)});return a<0?new m(E.NUM,y.NegativeTime):a%1})}eomonth(e,t){return this.runFunction(e.args,t,this.metadata("EOMONTH"),(r,n)=>{const i=this.dateTimeHelper.numberToSimpleDate(r);let a=this.dateTimeHelper.dateToNumber(this.dateTimeHelper.endOfMonth(_l(i,n)));return a=this.dateTimeHelper.getWithinBounds(a),a===void 0?new m(E.NUM,y.DateBounds):a})}day(e,t){return this.runFunction(e.args,t,this.metadata("DAY"),r=>this.dateTimeHelper.numberToSimpleDate(r).day)}days(e,t){return this.runFunction(e.args,t,this.metadata("DAYS"),(r,n)=>Math.trunc(r)-Math.trunc(n))}month(e,t){return this.runFunction(e.args,t,this.metadata("MONTH"),r=>this.dateTimeHelper.numberToSimpleDate(r).month)}year(e,t){return this.runFunction(e.args,t,this.metadata("YEAR"),r=>this.dateTimeHelper.numberToSimpleDate(r).year)}hour(e,t){return this.runFunction(e.args,t,this.metadata("HOUR"),r=>Kn(Ka(r)%1).hours)}minute(e,t){return this.runFunction(e.args,t,this.metadata("MINUTE"),r=>Kn(Ka(r)%1).minutes)}second(e,t){return this.runFunction(e.args,t,this.metadata("SECOND"),r=>Kn(Ka(r)%1).seconds)}text(e,t){return this.runFunction(e.args,t,this.metadata("TEXT"),(r,n)=>Wy(r,n,this.config,this.dateTimeHelper))}weekday(e,t){return this.runFunction(e.args,t,this.metadata("WEEKDAY"),(r,n)=>{const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(r));if(n===3)return(i-1)%7;const a=Kl.get(n);return a===void 0?new m(E.NUM,y.BadMode):(i-a)%7+1})}weeknum(e,t){return this.runFunction(e.args,t,this.metadata("WEEKNUM"),(r,n)=>{const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(r)),a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.dateToNumber({year:a.year,month:1,day:1}),u=this.dateTimeHelper.relativeNumberToAbsoluteNumber(o);if(n===21)return this.isoweeknumCore(r);const l=Kl.get(n);return l===void 0?new m(E.NUM,y.BadMode):Math.floor((i-l)/7)-Math.floor((u-l)/7)+1})}isoweeknum(e,t){return this.runFunction(e.args,t,this.metadata("ISOWEEKNUM"),this.isoweeknumCore)}datevalue(e,t){return this.runFunction(e.args,t,this.metadata("DATEVALUE"),r=>{const{dateTime:n}=this.dateTimeHelper.parseDateTimeFromConfigFormats(r);return n===void 0?new m(E.VALUE,y.IncorrectDateTime):Ls(n)?(xd(n)?Math.trunc(qn(n)):0)+this.dateTimeHelper.dateToNumber(n):0})}timevalue(e,t){return this.runFunction(e.args,t,this.metadata("TIMEVALUE"),r=>{const n=this.dateTimeHelper.dateStringToDateNumber(r);return n===void 0?new m(E.VALUE,y.IncorrectDateTime):b(n)%1})}now(e,t){return this.runFunction(e.args,t,this.metadata("NOW"),()=>{const r=new Date(Date.now());return qn({hours:r.getHours(),minutes:r.getMinutes(),seconds:r.getSeconds()})+this.dateTimeHelper.dateToNumber({year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()})})}today(e,t){return this.runFunction(e.args,t,this.metadata("TODAY"),()=>{const r=new Date(Date.now());return this.dateTimeHelper.dateToNumber({year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()})})}edate(e,t){return this.runFunction(e.args,t,this.metadata("EDATE"),(r,n)=>{const i=this.dateTimeHelper.numberToSimpleDate(r),a=Dy(_l(i,n));let o=this.dateTimeHelper.dateToNumber(a);return o=this.dateTimeHelper.getWithinBounds(o),o===void 0?new m(E.NUM,y.DateBounds):o})}datedif(e,t){return this.runFunction(e.args,t,this.metadata("DATEDIF"),(r,n,i)=>{if(r>n)return new m(E.NUM,y.StartEndDate);if(i==="D")return Math.floor(n)-Math.floor(r);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);switch(i){case"M":return(o.year-a.year)*12+(o.month-a.month)-(o.day<a.day?1:0);case"YM":return(12+(o.month-a.month)-(o.day<a.day?1:0))%12;case"Y":return o.month>a.month||o.month===a.month&&o.day>=a.day?o.year-a.year:o.year-a.year-1;case"MD":if(o.day>=a.day)return o.day-a.day;{const u=o.month===1?12:o.month-1,l=o.month===1?o.year-1:o.year;return this.dateTimeHelper.daysInMonth(l,u)+o.day-a.day}case"YD":return o.month>a.month||o.month===a.month&&o.day>=a.day?Math.floor(n)-this.dateTimeHelper.dateToNumber({year:o.year,month:a.month,day:a.day}):Math.floor(n)-Math.floor(r)-365*(o.year-a.year-1)-this.dateTimeHelper.leapYearsCount(o.year-1)+this.dateTimeHelper.leapYearsCount(a.year);default:return new m(E.NUM,y.BadMode)}})}days360(e,t){return this.runFunction(e.args,t,this.metadata("DAYS360"),this.days360Core)}yearfrac(e,t){return this.runFunction(e.args,t,this.metadata("YEARFRAC"),(r,n,i)=>{switch(r=Math.trunc(r),n=Math.trunc(n),r>n&&([r,n]=[n,r]),i){case 0:return this.days360Core(r,n,!1)/360;case 1:return(n-r)/this.dateTimeHelper.yearLengthForBasis(this.dateTimeHelper.numberToSimpleDate(r),this.dateTimeHelper.numberToSimpleDate(n));case 2:return(n-r)/360;case 3:return(n-r)/365;case 4:return this.days360Core(r,n,!0)/360}throw new Error("Should not be reachable.")})}interval(e,t){return this.runFunction(e.args,t,this.metadata("INTERVAL"),r=>{r=Math.trunc(r);const n=r%60;r=Math.trunc(r/60);const i=r%60;r=Math.trunc(r/60);const a=r%24;r=Math.trunc(r/24);const o=r%30;r=Math.trunc(r/30);const u=r%12,l=Math.trunc(r/12);return"P"+(l>0?`${l}Y`:"")+(u>0?`${u}M`:"")+(o>0?`${o}D`:"")+"T"+(a>0?`${a}H`:"")+(i>0?`${i}M`:"")+(n>0?`${n}S`:"")})}networkdays(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS"),(r,n,i)=>this.networkdayscore(r,n,1,i))}networkdaysintl(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS.INTL"),(r,n,i,a)=>this.networkdayscore(r,n,i,a))}workday(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY"),(r,n,i)=>this.workdaycore(r,n,1,i))}workdayintl(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY.INTL"),(r,n,i,a)=>this.workdaycore(r,n,i,a))}networkdayscore(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t);let i=1;e>t&&([e,t]=[t,e],i=-1);const a=Xl(r);if(a instanceof m)return a;const o=this.simpleRangeToFilteredHolidays(a,n);return o instanceof m?o:i*this.countWorkdays(e,t,a,o)}workdaycore(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t);const i=Xl(r);if(i instanceof m)return i;const a=this.simpleRangeToFilteredHolidays(i,n);if(a instanceof m)return a;if(t>0){let o=1;for(;this.countWorkdays(e+1,e+o,i,a)<t;)o*=2;let u=1;for(;u+1<o;){const l=Math.trunc((u+o)/2);this.countWorkdays(e+1,e+l,i,a)<t?u=l:o=l}return e+o}else if(t<0){t*=-1;let o=1;for(;this.countWorkdays(e-o,e-1,i,a)<t;)o*=2;let u=1;for(;u+1<o;){const l=Math.trunc((u+o)/2);this.countWorkdays(e-l,e-1,i,a)<t?u=l:o=l}return e-o}else return e}countWorkdays(e,t,r,n){const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(t)),a=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e));let o=0;for(let u=0;u<7;u++)r.charAt(u)==="0"&&(o+=Math.floor((i+6-u)/7),o-=Math.floor((a-1+6-u)/7));return o-=$l(t+1,n)-$l(e,n),o}simpleRangeToFilteredHolidays(e,t){var r;const n=(r=t?.valuesFromTopLeftCorner())!==null&&r!==void 0?r:[];for(const a of n)if(a instanceof m)return a;const i=[];for(const a of n)if(a!==Z)if(ue(a))i.push(Math.trunc(b(a)));else return new m(E.VALUE,y.WrongType);return[...new Set(i)].sort((a,o)=>a-o).filter(a=>{const u=(this.dateTimeHelper.relativeNumberToAbsoluteNumber(a)-1)%7;return e.charAt(u)==="0"})}}sf.implementedFunctions={DATE:{method:"date",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER}],returnNumberType:D.NUMBER_DATE},TIME:{method:"time",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER}],returnNumberType:D.NUMBER_TIME},MONTH:{method:"month",parameters:[{argumentType:c.NUMBER,minValue:0}]},YEAR:{method:"year",parameters:[{argumentType:c.NUMBER,minValue:0}]},HOUR:{method:"hour",parameters:[{argumentType:c.NUMBER,minValue:0}]},MINUTE:{method:"minute",parameters:[{argumentType:c.NUMBER,minValue:0}]},SECOND:{method:"second",parameters:[{argumentType:c.NUMBER,minValue:0}]},TEXT:{method:"text",parameters:[{argumentType:c.NUMBER},{argumentType:c.STRING}]},EOMONTH:{method:"eomonth",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER}],returnNumberType:D.NUMBER_DATE},DAY:{method:"day",parameters:[{argumentType:c.NUMBER,minValue:0}]},DAYS:{method:"days",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0}]},WEEKDAY:{method:"weekday",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,defaultValue:1}]},WEEKNUM:{method:"weeknum",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,defaultValue:1}]},ISOWEEKNUM:{method:"isoweeknum",parameters:[{argumentType:c.NUMBER,minValue:0}]},DATEVALUE:{method:"datevalue",parameters:[{argumentType:c.STRING}],returnNumberType:D.NUMBER_DATE},TIMEVALUE:{method:"timevalue",parameters:[{argumentType:c.STRING}],returnNumberType:D.NUMBER_TIME},NOW:{method:"now",parameters:[],isVolatile:!0,returnNumberType:D.NUMBER_DATETIME},TODAY:{method:"today",parameters:[],isVolatile:!0,returnNumberType:D.NUMBER_DATE},EDATE:{method:"edate",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER}],returnNumberType:D.NUMBER_DATE},DAYS360:{method:"days360",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.BOOLEAN,defaultValue:!1}]},DATEDIF:{method:"datedif",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.STRING}]},YEARFRAC:{method:"yearfrac",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.INTEGER,defaultValue:0,minValue:0,maxValue:4}]},INTERVAL:{method:"interval",parameters:[{argumentType:c.NUMBER,minValue:0}]},NETWORKDAYS:{method:"networkdays",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.RANGE,optionalArg:!0}]},"NETWORKDAYS.INTL":{method:"networkdaysintl",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.NOERROR,defaultValue:1},{argumentType:c.RANGE,optionalArg:!0}]},WORKDAY:{method:"workday",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER},{argumentType:c.RANGE,optionalArg:!0}]},"WORKDAY.INTL":{method:"workdayintl",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER},{argumentType:c.NOERROR,defaultValue:1},{argumentType:c.RANGE,optionalArg:!0}]}};function $l(s,e){if(e.length===0||s<=e[0])return 0;if(e[e.length-1]<s)return e.length;let t=0,r=e.length-1;for(;t+1<r;){const n=Math.floor((r+t)/2);e[n]>=s?r=n:t=n}return r}function Xl(s){var e;return typeof s!="number"&&typeof s!="string"?new m(E.VALUE,y.WrongType):typeof s=="string"?s.length!==7||!/^(0|1)*$/.test(s)||s==="1111111"?new m(E.NUM,y.WeekendString):s:(e=sv.get(s))!==null&&e!==void 0?e:new m(E.NUM,y.BadMode)}const Kl=new Map([[1,0],[2,1],[11,1],[12,2],[13,3],[14,4],[15,5],[16,6],[17,0]]),sv=new Map([[1,"0000011"],[2,"1000001"],[3,"1100000"],[4,"0110000"],[5,"0011000"],[6,"0001100"],[7,"0000110"],[11,"0000001"],[12,"1000000"],[13,"0100000"],[14,"0010000"],[15,"0001000"],[16,"0000100"],[17,"0000010"]]);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class af extends ${degrees(e,t){return this.runFunction(e.args,t,this.metadata("DEGREES"),r=>r*(180/Math.PI))}}af.implementedFunctions={DEGREES:{method:"degrees",parameters:[{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class of extends ${delta(e,t){return this.runFunction(e.args,t,this.metadata("DELTA"),(r,n)=>r===n?1:0)}}of.implementedFunctions={DELTA:{method:"delta",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class uf extends ${exp(e,t){return this.runFunction(e.args,t,this.metadata("EXP"),Math.exp)}}uf.implementedFunctions={EXP:{method:"exp",parameters:[{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class lf extends ${pmt(e,t){return this.runFunction(e.args,t,this.metadata("PMT"),vu)}ipmt(e,t){return this.runFunction(e.args,t,this.metadata("IPMT"),Uo)}ppmt(e,t){return this.runFunction(e.args,t,this.metadata("PPMT"),ql)}fv(e,t){return this.runFunction(e.args,t,this.metadata("FV"),Po)}cumipmt(e,t){return this.runFunction(e.args,t,this.metadata("CUMIPMT"),(r,n,i,a,o,u)=>{if(a>o)return new m(E.NUM,y.EndStartPeriod);let l=0;for(let h=a;h<=o;h++)l+=Uo(r,h,n,i,0,u);return l})}cumprinc(e,t){return this.runFunction(e.args,t,this.metadata("CUMPRINC"),(r,n,i,a,o,u)=>{if(a>o)return new m(E.NUM,y.EndStartPeriod);let l=0;for(let h=a;h<=o;h++)l+=ql(r,h,n,i,0,u);return l})}db(e,t){return this.runFunction(e.args,t,this.metadata("DB"),(r,n,i,a,o)=>{if(o===12&&a>i||a>i+1)return new m(E.NUM,y.PeriodLong);if(n>=r)return 0;const u=Math.round((1-Math.pow(n/r,1/i))*1e3)/1e3,l=r*u*o/12;if(a===1)return l;let h=l;for(let d=0;d<a-2;d++)h+=(r-h)*u;return a===i+1?(r-h)*u*(12-o)/12:(r-h)*u})}ddb(e,t){return this.runFunction(e.args,t,this.metadata("DDB"),(r,n,i,a,o)=>{if(a>i)return new m(E.NUM);let u=o/i,l;u>=1?(u=1,a===1?l=r:l=0):l=r*Math.pow(1-u,a-1);const h=r*Math.pow(1-u,a);return Math.max(l-Math.max(n,h),0)})}dollarde(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARDE"),(r,n)=>{if(n<1)return new m(E.DIV_BY_ZERO);for(n=Math.trunc(n);n>10;)n/=10;return Math.trunc(r)+(r-Math.trunc(r))*10/n})}dollarfr(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARFR"),(r,n)=>{if(n<1)return new m(E.DIV_BY_ZERO);for(n=Math.trunc(n);n>10;)n/=10;return Math.trunc(r)+(r-Math.trunc(r))*n/10})}effect(e,t){return this.runFunction(e.args,t,this.metadata("EFFECT"),(r,n)=>(n=Math.trunc(n),Math.pow(1+r/n,n)-1))}ispmt(e,t){return this.runFunction(e.args,t,this.metadata("ISPMT"),(r,n,i,a)=>i===0?new m(E.DIV_BY_ZERO):a*r*(n/i-1))}nominal(e,t){return this.runFunction(e.args,t,this.metadata("NOMINAL"),(r,n)=>(n=Math.trunc(n),(Math.pow(r+1,1/n)-1)*n))}nper(e,t){return this.runFunction(e.args,t,this.metadata("NPER"),(r,n,i,a,o)=>r===0?n===0?new m(E.DIV_BY_ZERO):(-i-a)/n:(o&&(n*=1+r),Math.log((n-a*r)/(i*r+n))/Math.log(1+r)))}rate(e,t){return this.runFunction(e.args,t,this.metadata("RATE"),(r,n,i,a,o,u)=>{if(u<=-1)return new m(E.VALUE);const l=1e-7,h=50;let d=u;o=o?1:0;for(let f=0;f<h;f++){if(d<=-1)return new m(E.NUM);let p;if(Math.abs(d)<l)p=i*(1+r*d)+n*(1+d*o)*r+a;else{const g=Math.pow(1+d,r);p=i*g+n*(1/d+o)*(g-1)+a}if(Math.abs(p)<l)return d;let N;if(Math.abs(d)<l)N=i*r+n*o*r;else{const g=Math.pow(1+d,r),S=r*Math.pow(1+d,r-1);N=i*S+n*(1/d+o)*S+n*(-1/(d*d))*(g-1)}d-=p/N}return new m(E.NUM)})}pv(e,t){return this.runFunction(e.args,t,this.metadata("PV"),(r,n,i,a,o)=>(o=o?1:0,r===-1?n===0?new m(E.NUM):new m(E.DIV_BY_ZERO):r===0?-i*n-a:((1-Math.pow(1+r,n))*i*(1+r*o)/r-a)/Math.pow(1+r,n)))}rri(e,t){return this.runFunction(e.args,t,this.metadata("RRI"),(r,n,i)=>n===0||i<0&&n>0||i>0&&n<0?new m(E.NUM):Math.pow(i/n,1/r)-1)}sln(e,t){return this.runFunction(e.args,t,this.metadata("SLN"),(r,n,i)=>i===0?new m(E.DIV_BY_ZERO):(r-n)/i)}syd(e,t){return this.runFunction(e.args,t,this.metadata("SYD"),(r,n,i,a)=>a>i?new m(E.NUM):(r-n)*(i-a+1)*2/(i*(i+1)))}tbilleq(e,t){return this.runFunction(e.args,t,this.metadata("TBILLEQ"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new m(E.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);if(o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day))return new m(E.NUM);const u=360-i*(n-r);return u===0?0:u<0?new m(E.NUM):365*i/u})}tbillprice(e,t){return this.runFunction(e.args,t,this.metadata("TBILLPRICE"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new m(E.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);if(o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day))return new m(E.NUM);const u=360-i*(n-r);return u===0?0:u<0?new m(E.NUM):100*(1-i*(n-r)/360)})}tbillyield(e,t){return this.runFunction(e.args,t,this.metadata("TBILLYIELD"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new m(E.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);return o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day)?new m(E.NUM):(100-i)*360/(i*(n-r))})}fvschedule(e,t){return this.runFunction(e.args,t,this.metadata("FVSCHEDULE"),(r,n)=>{const i=n.valuesFromTopLeftCorner();for(const a of i)if(a instanceof m)return a;for(const a of i)if(ue(a))r*=1+b(a);else if(a!==Z)return new m(E.VALUE,y.NumberExpected);return r})}npv(e,t){return this.runFunction(e.args,t,this.metadata("NPV"),(r,...n)=>{const i=this.arithmeticHelper.coerceNumbersExactRanges(n);return i instanceof m?i:Za(r,i)})}mirr(e,t){return this.runFunction(e.args,t,this.metadata("MIRR"),(r,n,i)=>{const a=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());if(a instanceof m)return a;let o=!1,u=!1;const l=[],h=[];for(const N of a)N>0?(o=!0,l.push(N),h.push(0)):N<0?(u=!0,h.push(N),l.push(0)):(h.push(0),l.push(0));if(!o||!u)return new m(E.DIV_BY_ZERO);const d=a.length,f=Za(i,l);if(f instanceof m)return f;const p=Za(n,h);return p instanceof m?p:Math.pow(-f*Math.pow(1+i,d)/p/(1+n),1/(d-1))-1})}pduration(e,t){return this.runFunction(e.args,t,this.metadata("PDURATION"),(r,n,i)=>(Math.log(i)-Math.log(n))/Math.log(1+r))}xnpv(e,t){return this.runFunction(e.args,t,this.metadata("XNPV"),(r,n,i)=>{const a=n.valuesFromTopLeftCorner();for(const f of a)if(typeof f!="number")return new m(E.VALUE,y.NumberExpected);const o=a,u=i.valuesFromTopLeftCorner();for(const f of u)if(typeof f!="number")return new m(E.VALUE,y.NumberExpected);const l=u;if(l.length!==o.length)return new m(E.NUM,y.EqualLength);const h=l.length;let d=0;if(l[0]<0)return new m(E.NUM,y.ValueSmall);for(let f=0;f<h;f++){if(l[f]=Math.floor(l[f]),l[f]<l[0])return new m(E.NUM,y.ValueSmall);d+=o[f]/Math.pow(1+r,(l[f]-l[0])/365)}return d})}}lf.implementedFunctions={PMT:{method:"pmt",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0},{argumentType:c.NUMBER,defaultValue:0}],returnNumberType:D.NUMBER_CURRENCY},IPMT:{method:"ipmt",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0},{argumentType:c.NUMBER,defaultValue:0}],returnNumberType:D.NUMBER_CURRENCY},PPMT:{method:"ppmt",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0},{argumentType:c.NUMBER,defaultValue:0}],returnNumberType:D.NUMBER_CURRENCY},FV:{method:"fv",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0},{argumentType:c.NUMBER,defaultValue:0}],returnNumberType:D.NUMBER_CURRENCY},CUMIPMT:{method:"cumipmt",parameters:[{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.INTEGER,minValue:1},{argumentType:c.INTEGER,minValue:1},{argumentType:c.INTEGER,minValue:0,maxValue:1}],returnNumberType:D.NUMBER_CURRENCY},CUMPRINC:{method:"cumprinc",parameters:[{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.INTEGER,minValue:1},{argumentType:c.INTEGER,minValue:1},{argumentType:c.INTEGER,minValue:0,maxValue:1}],returnNumberType:D.NUMBER_CURRENCY},DB:{method:"db",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.INTEGER,minValue:0},{argumentType:c.INTEGER,minValue:0},{argumentType:c.INTEGER,minValue:1,maxValue:12,defaultValue:12}],returnNumberType:D.NUMBER_CURRENCY},DDB:{method:"ddb",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.INTEGER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,greaterThan:0,defaultValue:2}],returnNumberType:D.NUMBER_CURRENCY},DOLLARDE:{method:"dollarde",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,minValue:0}]},DOLLARFR:{method:"dollarfr",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,minValue:0}]},EFFECT:{method:"effect",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:1}],returnNumberType:D.NUMBER_PERCENT},ISPMT:{method:"ispmt",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER}]},NOMINAL:{method:"nominal",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:1}],returnNumberType:D.NUMBER_PERCENT},NPER:{method:"nper",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0},{argumentType:c.NUMBER,defaultValue:0}]},PV:{method:"pv",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0},{argumentType:c.NUMBER,defaultValue:0}],returnNumberType:D.NUMBER_CURRENCY},RATE:{method:"rate",parameters:[{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0},{argumentType:c.NUMBER,defaultValue:0},{argumentType:c.NUMBER,defaultValue:.1}],returnNumberType:D.NUMBER_PERCENT},RRI:{method:"rri",parameters:[{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER},{argumentType:c.NUMBER}],returnNumberType:D.NUMBER_PERCENT},SLN:{method:"sln",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER}],returnNumberType:D.NUMBER_CURRENCY},SYD:{method:"syd",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0}],returnNumberType:D.NUMBER_CURRENCY},TBILLEQ:{method:"tbilleq",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,greaterThan:0}],returnNumberType:D.NUMBER_PERCENT},TBILLPRICE:{method:"tbillprice",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,greaterThan:0}],returnNumberType:D.NUMBER_CURRENCY},TBILLYIELD:{method:"tbillyield",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,greaterThan:0}],returnNumberType:D.NUMBER_PERCENT},FVSCHEDULE:{method:"fvschedule",parameters:[{argumentType:c.NUMBER},{argumentType:c.RANGE}],returnNumberType:D.NUMBER_CURRENCY},NPV:{method:"npv",parameters:[{argumentType:c.NUMBER},{argumentType:c.ANY}],repeatLastArgs:1,returnNumberType:D.NUMBER_CURRENCY},MIRR:{method:"mirr",parameters:[{argumentType:c.RANGE},{argumentType:c.NUMBER},{argumentType:c.NUMBER}],returnNumberType:D.NUMBER_PERCENT},PDURATION:{method:"pduration",parameters:[{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0}]},XNPV:{method:"xnpv",parameters:[{argumentType:c.NUMBER,greaterThan:-1},{argumentType:c.RANGE},{argumentType:c.RANGE}]}};function vu(s,e,t,r,n){if(s===0)return(-t-r)/e;{const i=Math.pow(1+s,e);return(r*s+t*s*i)*(n?1/(1+s):1)/(1-i)}}function Uo(s,e,t,r,n,i){const a=vu(s,t,r,n,i);return e===1?s*(i?0:-r):s*(i?Po(s,e-2,a,r,i)-a:Po(s,e-1,a,r,i))}function Po(s,e,t,r,n){if(s===0)return-r-t*e;{const i=Math.pow(1+s,e);return t*(n?1+s:1)*(1-i)/s-r*i}}function ql(s,e,t,r,n,i){return vu(s,t,r,n,i)-Uo(s,e,t,r,n,i)}function Za(s,e){let t=0;for(let r=e.length-1;r>=0;r--){if(t+=e[r],s===-1){if(t===0)continue;return new m(E.DIV_BY_ZERO)}t/=1+s}return t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class cf extends ${formulatext(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("FORMULATEXT"),()=>new m(E.NA,y.WrongArgNumber),r=>{var n;return(n=this.serialization.getCellFormula(r))!==null&&n!==void 0?n:new m(E.NA,y.Formula)})}}cf.implementedFunctions={FORMULATEXT:{method:"formulatext",parameters:[{argumentType:c.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,isDependentOnSheetStructureChange:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class hf extends ${hyperlink(e,t){return this.runFunction(e.args,t,this.metadata("HYPERLINK"),(r,n)=>(e.hyperlink=r,n??r))}}hf.implementedFunctions={HYPERLINK:{method:"hyperlink",parameters:[{argumentType:c.STRING},{argumentType:c.STRING,optionalArg:!0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class df extends ${isbinary(e,t){return this.runFunction(e.args,t,this.metadata("ISBINARY"),r=>/^[01]{1,10}$/.test(r))}iserr(e,t){return this.runFunction(e.args,t,this.metadata("ISERR"),r=>r instanceof m&&r.type!==E.NA)}iserror(e,t){return this.runFunction(e.args,t,this.metadata("ISERROR"),r=>r instanceof m)}isformula(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ISFORMULA"),()=>new m(E.NA,y.WrongArgNumber),r=>this.dependencyGraph.addressMapping.getCell(r)instanceof Bt)}isblank(e,t){return this.runFunction(e.args,t,this.metadata("ISBLANK"),r=>r===Z)}isna(e,t){return this.runFunction(e.args,t,this.metadata("ISNA"),r=>r instanceof m&&r.type==E.NA)}isnumber(e,t){return this.runFunction(e.args,t,this.metadata("ISNUMBER"),ue)}islogical(e,t){return this.runFunction(e.args,t,this.metadata("ISLOGICAL"),r=>typeof r=="boolean")}isref(e,t){return this.runFunction(e.args,t,this.metadata("ISREF"),r=>r instanceof m&&(r.type==E.REF||r.type==E.CYCLE))}istext(e,t){return this.runFunction(e.args,t,this.metadata("ISTEXT"),r=>typeof r=="string")}isnontext(e,t){return this.runFunction(e.args,t,this.metadata("ISNONTEXT"),r=>typeof r!="string")}column(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("COLUMN"),()=>t.formulaAddress.col+1,r=>r.col+1)}columns(e,t){if(e.args.length!==1)return new m(E.NA,y.WrongArgNumber);if(e.args.some(n=>n.type===R.EMPTY))return new m(E.NUM,y.EmptyArg);let r=e.args[0];for(;r.type===R.PARENTHESIS;)r=r.expression;if(r.type===R.CELL_RANGE||r.type===R.COLUMN_RANGE)return r.end.col-r.start.col+1;if(r.type===R.CELL_REFERENCE)return 1;if(r.type===R.ROW_RANGE)return this.config.maxColumns;{const n=this.evaluateAst(r,t);return n instanceof F?n.width():n instanceof m?n:1}}row(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ROW"),()=>t.formulaAddress.row+1,r=>r.row+1)}rows(e,t){if(e.args.length!==1)return new m(E.NA,y.WrongArgNumber);if(e.args.some(n=>n.type===R.EMPTY))return new m(E.NUM,y.EmptyArg);let r=e.args[0];for(;r.type===R.PARENTHESIS;)r=r.expression;if(r.type===R.CELL_RANGE||r.type===R.ROW_RANGE)return r.end.row-r.start.row+1;if(r.type===R.CELL_REFERENCE)return 1;if(r.type===R.COLUMN_RANGE)return this.config.maxRows;{const n=this.evaluateAst(r,t);return n instanceof F?n.height():n instanceof m?n:1}}index(e,t){return this.runFunction(e.args,t,this.metadata("INDEX"),(r,n,i)=>{var a,o,u,l,h,d;return i<1||n<1?new m(E.VALUE,y.LessThanOne):i>r.width()||n>r.height()?new m(E.NUM,y.ValueLarge):(d=(u=(o=(a=r?.data)===null||a===void 0?void 0:a[n-1])===null||o===void 0?void 0:o[i-1])!==null&&u!==void 0?u:(h=(l=r?.data)===null||l===void 0?void 0:l[0])===null||h===void 0?void 0:h[0])!==null&&d!==void 0?d:new m(E.VALUE,y.CellRangeExpected)})}na(e,t){return new m(E.NA)}sheet(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEET"),()=>t.formulaAddress.sheet+1,r=>r.sheet+1,r=>{const n=this.dependencyGraph.sheetMapping.get(r);return n!==void 0?n+1:new m(E.NA,y.SheetRef)})}sheets(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEETS"),()=>this.dependencyGraph.sheetMapping.numberOfSheets(),()=>1,()=>new m(E.VALUE,y.CellRefExpected))}}df.implementedFunctions={COLUMN:{method:"column",parameters:[{argumentType:c.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},COLUMNS:{method:"columns",parameters:[{argumentType:c.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISBINARY:{method:"isbinary",parameters:[{argumentType:c.STRING}]},ISERR:{method:"iserr",parameters:[{argumentType:c.SCALAR}]},ISFORMULA:{method:"isformula",parameters:[{argumentType:c.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISNA:{method:"isna",parameters:[{argumentType:c.SCALAR}]},ISREF:{method:"isref",parameters:[{argumentType:c.SCALAR}],vectorizationForbidden:!0},ISERROR:{method:"iserror",parameters:[{argumentType:c.SCALAR}]},ISBLANK:{method:"isblank",parameters:[{argumentType:c.SCALAR}]},ISNUMBER:{method:"isnumber",parameters:[{argumentType:c.SCALAR}]},ISLOGICAL:{method:"islogical",parameters:[{argumentType:c.SCALAR}]},ISTEXT:{method:"istext",parameters:[{argumentType:c.SCALAR}]},ISNONTEXT:{method:"isnontext",parameters:[{argumentType:c.SCALAR}]},INDEX:{method:"index",parameters:[{argumentType:c.RANGE},{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:1}]},NA:{method:"na",parameters:[]},ROW:{method:"row",parameters:[{argumentType:c.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ROWS:{method:"rows",parameters:[{argumentType:c.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEET:{method:"sheet",parameters:[{argumentType:c.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEETS:{method:"sheets",parameters:[{argumentType:c.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ff extends ${iseven(e,t){return this.runFunction(e.args,t,this.metadata("ISEVEN"),r=>r%2===0)}}ff.implementedFunctions={ISEVEN:{method:"iseven",parameters:[{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pf extends ${isodd(e,t){return this.runFunction(e.args,t,this.metadata("ISODD"),r=>r%2===1)}}pf.implementedFunctions={ISODD:{method:"isodd",parameters:[{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mf extends ${log10(e,t){return this.runFunction(e.args,t,this.metadata("LOG10"),Math.log10)}log(e,t){return this.runFunction(e.args,t,this.metadata("LOG"),(r,n)=>Math.log(r)/Math.log(n))}ln(e,t){return this.runFunction(e.args,t,this.metadata("LN"),Math.log)}}mf.implementedFunctions={LOG10:{method:"log10",parameters:[{argumentType:c.NUMBER}]},LOG:{method:"log",parameters:[{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,defaultValue:10,greaterThan:0}]},LN:{method:"ln",parameters:[{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Do=parseFloat(Math.PI.toFixed(14));class gf extends ${pi(e,t){return this.runFunction(e.args,t,this.metadata("PI"),()=>Do)}sqrtpi(e,t){return this.runFunction(e.args,t,this.metadata("SQRTPI"),r=>Math.sqrt(Do*r))}}gf.implementedFunctions={PI:{method:"pi",parameters:[]},SQRTPI:{method:"sqrtpi",parameters:[{argumentType:c.NUMBER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Ql(s,e){return new X(e.width,s.height)}function Ja(s,e,t){return new X(1+(s.width-e)/t,1+(s.height-e)/t)}class Ef extends ${mmult(e,t){return this.runFunction(e.args,t,this.metadata("MMULT"),(r,n)=>{if(!r.hasOnlyNumbers()||!n.hasOnlyNumbers())return new m(E.VALUE,y.NumberRange);if(n.height()!==r.width())return new m(E.VALUE,y.ArrayDimensions);const i=Ql(r.size,n.size),a=this.createKernel(function(o,u,l){let h=0;for(let d=0;d<l;++d)h+=o[this.thread.y][d]*u[d][this.thread.x];return h},i)(r.rawNumbers(),n.rawNumbers(),r.width());return F.onlyNumbers(a)})}mmultArraySize(e,t){if(e.args.length!==2)return X.error();const r=this.metadata("MMULT"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new Ir(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))}),[i,a]=n;return Ql(i,a)}maxpool(e,t){return this.runFunction(e.args,t,this.metadata("MAXPOOL"),(r,n,i=n)=>{if(!r.hasOnlyNumbers())return new m(E.VALUE,y.NumberRange);const a=Ja(r.size,n,i),o=this.createKernel(function(u,l,h){const d=this.thread.x*h,f=this.thread.y*h;let p=u[f][d];for(let N=0;N<l;N++)for(let g=0;g<l;g++)p=Math.max(p,u[f+N][d+g]);return p},a)(r.rawNumbers(),n,i);return F.onlyNumbers(o)})}medianpool(e,t){return this.runFunction(e.args,t,this.metadata("MEDIANPOOL"),(r,n,i=n)=>{if(!r.hasOnlyNumbers())return new m(E.VALUE,y.NumberRange);const a=Ja(r.size,n,i),o=this.createKernel(function(u,l,h){const d=this.thread.x*h,f=this.thread.y*h;let p=u[f][d];for(let C=0;C<l;C++)for(let w=0;w<l;w++)p=Math.max(p,u[f+C][d+w]);let N=u[f][d];for(let C=0;C<l;C++)for(let w=0;w<l;w++)N=Math.min(N,u[f+C][d+w]);const g=l*l;let S=N,v=p,A=42;for(let C=0;C<32;C++){const w=(S+v)/2;let M=0;for(let L=0;L<l;L++)for(let _=0;_<l;_++)u[f+L][d+_]>w&&M++;if(l%2===0)if(M===g/2){A=w;break}else M>g/2?S=w:v=w;else if(M===(g-1)/2){A=w;break}else M>(g-1)/2?S=w:v=w}return A},a)(r.rawNumbers(),n,i);return F.onlyNumbers(o)})}maxpoolArraySize(e,t){if(e.args.length<2||e.args.length>3)return X.error();const r=this.metadata("MAXPOOL"),i=e.args.map(l=>{var h;return this.arraySizeForAst(l,new Ir(t.formulaAddress,t.arraysFlag||((h=r?.enableArrayArithmeticForArguments)!==null&&h!==void 0?h:!1)))})[0],a=e.args[1];let o;a.type===R.NUMBER?o=a.value:o=1;let u=o;if(e.args.length===3){const l=e.args[2];l.type===R.NUMBER?u=l.value:u=1}return o>i.width||o>i.height||u>o||(i.width-o)%u!==0||(i.height-o)%u!==0?X.error():Ja(i,o,u)}medianpoolArraySize(e,t){return this.maxpoolArraySize(e,t)}transpose(e,t){return this.runFunction(e.args,t,this.metadata("TRANSPOSE"),r=>{const n=r.rawData(),i=r.size,a=[];for(let o=0;o<i.width;++o){a[o]=[];for(let u=0;u<i.height;++u)a[o][u]=n[u][o]}return F.onlyValues(a)})}transposeArraySize(e,t){if(e.args.length!==1)return X.error();const r=this.metadata("TRANSPOSE"),n=e.args.map(a=>{var o;return this.arraySizeForAst(a,new Ir(t.formulaAddress,t.arraysFlag||((o=r?.enableArrayArithmeticForArguments)!==null&&o!==void 0?o:!1)))}),[i]=n;return new X(i.height,i.width)}createKernel(e,t){return function(...r){const n=[];for(let i=0;i<t.height;++i){n.push([]);for(let a=0;a<t.width;++a)n[i][a]=e.apply({thread:{x:a,y:i}},r)}return n}}}Ef.implementedFunctions={MMULT:{method:"mmult",sizeOfResultArrayMethod:"mmultArraySize",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}],vectorizationForbidden:!0},TRANSPOSE:{method:"transpose",sizeOfResultArrayMethod:"transposeArraySize",parameters:[{argumentType:c.RANGE}],vectorizationForbidden:!0},MAXPOOL:{method:"maxpool",sizeOfResultArrayMethod:"maxpoolArraySize",parameters:[{argumentType:c.RANGE},{argumentType:c.NUMBER},{argumentType:c.NUMBER,optionalArg:!0}],vectorizationForbidden:!0},MEDIANPOOL:{method:"medianpool",sizeOfResultArrayMethod:"medianpoolArraySize",parameters:[{argumentType:c.RANGE},{argumentType:c.NUMBER},{argumentType:c.NUMBER,optionalArg:!0}],vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Rf extends ${median(e,t){return this.runFunction(e.args,t,this.metadata("MEDIAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);return n instanceof m?n:n.length===0?new m(E.NUM,y.OneValue):(n.sort((i,a)=>i-a),n.length%2===0?(n[n.length/2-1]+n[n.length/2])/2:n[Math.floor(n.length/2)])})}large(e,t){return this.runFunction(e.args,t,this.metadata("LARGE"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());return i instanceof m?i:(i.sort((a,o)=>a-o),n=Math.trunc(n),n>i.length?new m(E.NUM,y.ValueLarge):i[i.length-n])})}small(e,t){return this.runFunction(e.args,t,this.metadata("SMALL"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());return i instanceof m?i:(i.sort((a,o)=>a-o),n=Math.trunc(n),n>i.length?new m(E.NUM,y.ValueLarge):i[n-1])})}}Rf.implementedFunctions={MEDIAN:{method:"median",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},LARGE:{method:"large",parameters:[{argumentType:c.RANGE},{argumentType:c.NUMBER,minValue:1}]},SMALL:{method:"small",parameters:[{argumentType:c.RANGE},{argumentType:c.NUMBER,minValue:1}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Nf extends ${mod(e,t){return this.runFunction(e.args,t,this.metadata("MOD"),(r,n)=>n===0?new m(E.DIV_BY_ZERO):r%n)}}Nf.implementedFunctions={MOD:{method:"mod",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Ri(s){return ue(s)&&!Number.isFinite(b(s))?0:s}class or{constructor(e,t,r){this.sumsq=e,this.sum=t,this.count=r}static single(e){return new or(e*e,e,1)}compose(e){return new or(this.sumsq+e.sumsq,this.sum+e.sum,this.count+e.count)}averageValue(){if(this.count>0)return this.sum/this.count}varSValue(){if(this.count>1)return(this.sumsq-this.sum*this.sum/this.count)/(this.count-1)}varPValue(){if(this.count>0)return(this.sumsq-this.sum*this.sum/this.count)/this.count}}or.empty=new or(0,0,0);class Su extends ${constructor(){super(...arguments),this.addWithEpsilonRaw=(e,t)=>this.arithmeticHelper.addWithEpsilonRaw(e,t)}sum(e,t){return this.doSum(e.args,t)}sumsq(e,t){return this.reduce(e.args,t,0,"SUMSQ",this.addWithEpsilonRaw,r=>Math.pow(b(r),2),Un)}max(e,t){return this.doMax(e.args,t)}maxa(e,t){const r=this.reduce(e.args,t,Number.NEGATIVE_INFINITY,"MAXA",(n,i)=>Math.max(n,i),b,Ni);return Ri(r)}min(e,t){return this.doMin(e.args,t)}mina(e,t){const r=this.reduce(e.args,t,Number.POSITIVE_INFINITY,"MINA",(n,i)=>Math.min(n,i),b,Ni);return Ri(r)}count(e,t){return this.doCount(e.args,t)}counta(e,t){return this.doCounta(e.args,t)}average(e,t){return this.doAverage(e.args,t)}averagea(e,t){var r;const n=this.reduce(e.args,t,or.empty,"_AGGREGATE_A",(i,a)=>i.compose(a),i=>or.single(b(i)),Ni);return n instanceof m?n:(r=n.averageValue())!==null&&r!==void 0?r:new m(E.DIV_BY_ZERO)}vars(e,t){return this.doVarS(e.args,t)}varp(e,t){return this.doVarP(e.args,t)}vara(e,t){var r;const n=this.reduceAggregateA(e.args,t);return n instanceof m?n:(r=n.varSValue())!==null&&r!==void 0?r:new m(E.DIV_BY_ZERO)}varpa(e,t){var r;const n=this.reduceAggregateA(e.args,t);return n instanceof m?n:(r=n.varPValue())!==null&&r!==void 0?r:new m(E.DIV_BY_ZERO)}stdevs(e,t){return this.doStdevS(e.args,t)}stdevp(e,t){return this.doStdevP(e.args,t)}stdeva(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof m)return r;{const n=r.varSValue();return n===void 0?new m(E.DIV_BY_ZERO):Math.sqrt(n)}}stdevpa(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof m)return r;{const n=r.varPValue();return n===void 0?new m(E.DIV_BY_ZERO):Math.sqrt(n)}}product(e,t){return this.doProduct(e.args,t)}subtotal(e,t){if(e.args.length<2)return new m(E.NA,y.WrongArgNumber);const r=this.coerceToType(this.evaluateAst(e.args[0],t),{argumentType:c.NUMBER},t),n=e.args.slice(1);switch(r){case 1:case 101:return this.doAverage(n,t);case 2:case 102:return this.doCount(n,t);case 3:case 103:return this.doCounta(n,t);case 4:case 104:return this.doMax(n,t);case 5:case 105:return this.doMin(n,t);case 6:case 106:return this.doProduct(n,t);case 7:case 107:return this.doStdevS(n,t);case 8:case 108:return this.doStdevP(n,t);case 9:case 109:return this.doSum(n,t);case 10:case 110:return this.doVarS(n,t);case 11:case 111:return this.doVarP(n,t);default:return new m(E.VALUE,y.BadMode)}}reduceAggregate(e,t){return this.reduce(e,t,or.empty,"_AGGREGATE",(r,n)=>r.compose(n),r=>or.single(b(r)),Un)}reduceAggregateA(e,t){return this.reduce(e,t,or.empty,"_AGGREGATE_A",(r,n)=>r.compose(n),r=>or.single(b(r)),Ni)}doAverage(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof m?n:(r=n.averageValue())!==null&&r!==void 0?r:new m(E.DIV_BY_ZERO)}doVarS(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof m?n:(r=n.varSValue())!==null&&r!==void 0?r:new m(E.DIV_BY_ZERO)}doVarP(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof m?n:(r=n.varPValue())!==null&&r!==void 0?r:new m(E.DIV_BY_ZERO)}doStdevS(e,t){const r=this.reduceAggregate(e,t);if(r instanceof m)return r;{const n=r.varSValue();return n===void 0?new m(E.DIV_BY_ZERO):Math.sqrt(n)}}doStdevP(e,t){const r=this.reduceAggregate(e,t);if(r instanceof m)return r;{const n=r.varPValue();return n===void 0?new m(E.DIV_BY_ZERO):Math.sqrt(n)}}doCount(e,t){return this.reduce(e,t,0,"COUNT",(r,n)=>r+n,b,r=>ue(r)?1:0)}doCounta(e,t){return this.reduce(e,t,0,"COUNTA",(r,n)=>r+n,b,r=>r===Z?0:1)}doMax(e,t){const r=this.reduce(e,t,Number.NEGATIVE_INFINITY,"MAX",(n,i)=>Math.max(n,i),b,Un);return Ri(r)}doMin(e,t){const r=this.reduce(e,t,Number.POSITIVE_INFINITY,"MIN",(n,i)=>Math.min(n,i),b,Un);return Ri(r)}doSum(e,t){return this.reduce(e,t,0,"SUM",this.addWithEpsilonRaw,b,Un)}doProduct(e,t){return this.reduce(e,t,1,"PRODUCT",(r,n)=>r*n,b,Un)}reduce(e,t,r,n,i,a,o){return e.length<1?new m(E.NA,y.WrongArgNumber):e.reduce((u,l)=>{if(u instanceof m)return u;if(l.type===R.CELL_RANGE||l.type===R.COLUMN_RANGE||l.type===R.ROW_RANGE){const d=this.evaluateRange(l,t,r,n,i,a,o);return d instanceof m?d:i(d,u)}let h;if(h=this.evaluateAst(l,t),h instanceof F)return Array.from(h.valuesFromTopLeftCorner()).map(o).filter(f=>f!==void 0).map(f=>f instanceof m?f:a(f)).reduce((f,p)=>f instanceof m?f:p instanceof m?p:i(f,p),u);if(l.type===R.CELL_REFERENCE){if(h=o(h),h===void 0)return u}else if(h=this.coerceScalarToNumberOrError(h),h=o(h),h===void 0)return u;return h instanceof m?h:i(u,a(h))},r)}evaluateRange(e,t,r,n,i,a,o){let u;try{u=B.fromAst(e,t.formulaAddress)}catch(d){if(d instanceof Ws)return new m(E.REF,y.RangeManySheets);throw d}const l=this.dependencyGraph.getRange(u.start,u.end);if(l===void 0)throw new Error("Range does not exists in graph");let h=l.getFunctionValue(n);return h===void 0&&(h=this.getRangeValues(n,u,l,a,o).reduce((f,p)=>f instanceof m?f:p instanceof m?p:i(f,p),r),l.setFunctionValue(n,h)),h}getRangeValues(e,t,r,n,i){const a=[],{smallerRangeVertex:o,restRange:u}=this.dependencyGraph.rangeMapping.findSmallerRange(t);let l;if(o!==void 0&&this.dependencyGraph.existsEdge(o,r)){const h=o.getFunctionValue(e);if(h!==void 0)a.push(h);else for(const d of o.range.addresses(this.dependencyGraph)){const f=i(this.dependencyGraph.getScalarValue(d));f instanceof m?a.push(f):f!==void 0&&a.push(n(f))}l=u}else l=t;for(const h of l.addresses(this.dependencyGraph)){const d=i(this.dependencyGraph.getScalarValue(h));d instanceof m?a.push(d):d!==void 0&&a.push(n(d))}return a}}Su.implementedFunctions={SUM:{method:"sum",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},SUMSQ:{method:"sumsq",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},MAX:{method:"max",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},MIN:{method:"min",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},MAXA:{method:"maxa",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},MINA:{method:"mina",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},COUNT:{method:"count",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},COUNTA:{method:"counta",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},AVERAGE:{method:"average",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},AVERAGEA:{method:"averagea",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},PRODUCT:{method:"product",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},"VAR.S":{method:"vars",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},"VAR.P":{method:"varp",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},VARA:{method:"vara",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},VARPA:{method:"varpa",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},"STDEV.S":{method:"stdevs",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},"STDEV.P":{method:"stdevp",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},STDEVA:{method:"stdeva",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},STDEVPA:{method:"stdevpa",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},SUBTOTAL:{method:"subtotal",parameters:[{argumentType:c.NUMBER},{argumentType:c.ANY}],repeatLastArgs:1}};Su.aliases={VAR:"VAR.S",VARP:"VAR.P",STDEV:"STDEV.S",STDEVP:"STDEV.P",VARS:"VAR.S",STDEVS:"STDEV.S"};function Un(s){if(ue(s)||s instanceof m)return s}function Ni(s){return typeof s=="boolean"?Co(s):ue(s)||s instanceof m?s:typeof s=="string"?0:void 0}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class yf extends ${power(e,t){return this.runFunction(e.args,t,this.metadata("POWER"),Math.pow)}}yf.implementedFunctions={POWER:{method:"power",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Tf extends ${radians(e,t){return this.runFunction(e.args,t,this.metadata("RADIANS"),r=>r*(Math.PI/180))}}Tf.implementedFunctions={RADIANS:{method:"radians",parameters:[{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Qe=10,vf=255,Zl=2,Jl=36,iv="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";class Sf extends ${dec2bin(e,t){return this.runFunction(e.args,t,this.metadata("DEC2BIN"),(r,n)=>Lr(r,2,n))}dec2oct(e,t){return this.runFunction(e.args,t,this.metadata("DEC2OCT"),(r,n)=>Lr(r,8,n))}dec2hex(e,t){return this.runFunction(e.args,t,this.metadata("DEC2HEX"),(r,n)=>Lr(r,16,n))}bin2dec(e,t){return this.runFunction(e.args,t,this.metadata("BIN2DEC"),r=>{const n=gr(r,2,Qe);return n===void 0?new m(E.NUM,y.NotBinary):Fr(n,2)})}bin2oct(e,t){return this.runFunction(e.args,t,this.metadata("BIN2OCT"),(r,n)=>{const i=gr(r,2,Qe);return i===void 0?new m(E.NUM,y.NotBinary):Lr(Fr(i,2),8,n)})}bin2hex(e,t){return this.runFunction(e.args,t,this.metadata("BIN2HEX"),(r,n)=>{const i=gr(r,2,Qe);return i===void 0?new m(E.NUM,y.NotBinary):Lr(Fr(i,2),16,n)})}oct2dec(e,t){return this.runFunction(e.args,t,this.metadata("OCT2DEC"),r=>{const n=gr(r,8,Qe);return n===void 0?new m(E.NUM,y.NotOctal):Fr(n,8)})}oct2bin(e,t){return this.runFunction(e.args,t,this.metadata("OCT2BIN"),(r,n)=>{const i=gr(r,8,Qe);return i===void 0?new m(E.NUM,y.NotOctal):Lr(Fr(i,8),2,n)})}oct2hex(e,t){return this.runFunction(e.args,t,this.metadata("OCT2HEX"),(r,n)=>{const i=gr(r,8,Qe);return i===void 0?new m(E.NUM,y.NotOctal):Lr(Fr(i,8),16,n)})}hex2dec(e,t){return this.runFunction(e.args,t,this.metadata("HEX2DEC"),r=>{const n=gr(r,16,Qe);return n===void 0?new m(E.NUM,y.NotHex):Fr(n,16)})}hex2bin(e,t){return this.runFunction(e.args,t,this.metadata("HEX2BIN"),(r,n)=>{const i=gr(r,16,Qe);return i===void 0?new m(E.NUM,y.NotHex):Lr(Fr(i,16),2,n)})}hex2oct(e,t){return this.runFunction(e.args,t,this.metadata("HEX2OCT"),(r,n)=>{const i=gr(r,16,Qe);return i===void 0?new m(E.NUM,y.NotHex):Lr(Fr(i,16),8,n)})}base(e,t){return this.runFunction(e.args,t,this.metadata("BASE"),ov)}decimal(e,t){return this.runFunction(e.args,t,this.metadata("DECIMAL"),(r,n)=>{const i=gr(r,n,vf);return i===void 0?new m(E.NUM,y.NotHex):parseInt(i,n)})}}Sf.implementedFunctions={DEC2BIN:{method:"dec2bin",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2OCT:{method:"dec2oct",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2HEX:{method:"dec2hex",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},BIN2DEC:{method:"bin2dec",parameters:[{argumentType:c.STRING}]},BIN2OCT:{method:"bin2oct",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER,optionalArg:!0,minValue:0,maxValue:Qe}]},BIN2HEX:{method:"bin2hex",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER,optionalArg:!0,minValue:0,maxValue:Qe}]},OCT2DEC:{method:"oct2dec",parameters:[{argumentType:c.STRING}]},OCT2BIN:{method:"oct2bin",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER,optionalArg:!0,minValue:0,maxValue:Qe}]},OCT2HEX:{method:"oct2hex",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER,optionalArg:!0,minValue:0,maxValue:Qe}]},HEX2DEC:{method:"hex2dec",parameters:[{argumentType:c.STRING}]},HEX2BIN:{method:"hex2bin",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER,optionalArg:!0,minValue:0,maxValue:Qe}]},HEX2OCT:{method:"hex2oct",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER,optionalArg:!0,minValue:0,maxValue:Qe}]},DECIMAL:{method:"decimal",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER,minValue:Zl,maxValue:Jl}]},BASE:{method:"base",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:Zl,maxValue:Jl},{argumentType:c.NUMBER,optionalArg:!0,minValue:0,maxValue:vf}]}};function gr(s,e,t){const r=iv.substr(0,e),n=new RegExp(`^[${r}]+$`);if(!(s.length>t||!n.test(s)))return s}function Lr(s,e,t){if(s>av(e))return new m(E.NUM,y.ValueBaseLarge);if(s<Af(e))return new m(E.NUM,y.ValueBaseSmall);const r=Cf(s,e);return t===void 0||s<0?r:r.length>t?new m(E.NUM,y.ValueBaseLong):St(r,t)}function Af(s){return-Math.pow(s,Qe)/2}function av(s){return-Af(s)-1}function ov(s,e,t){const r=Cf(s,e);return t!==void 0&&t>r.length?St(r,t):r}function Cf(s,e){const t=s<0?Math.pow(e,Qe):0;return(s+t).toString(e).toUpperCase()}function Fr(s,e){const t=parseInt(s,e),r=Math.pow(e,Qe);return t>=r/2?t-r:t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class If extends ${rand(e,t){return this.runFunction(e.args,t,this.metadata("RAND"),Math.random)}randbetween(e,t){return this.runFunction(e.args,t,this.metadata("RANDBETWEEN"),(r,n)=>n<r?new m(E.NUM,y.WrongOrder):(r=Math.ceil(r),n=Math.floor(n)+1,r===n&&(n+=1),r+Math.floor(Math.random()*(n-r))))}}If.implementedFunctions={RAND:{method:"rand",parameters:[],isVolatile:!0},RANDBETWEEN:{method:"randbetween",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER}],isVolatile:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function ec(s){const e=Math.ceil(s);return e%2===1?e:e+1}function tc(s){const e=Math.ceil(s);return e%2===0?e:e+1}class Au extends ${roundup(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.ceil(-r*i)/i:Math.ceil(r*i)/i})}rounddown(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.floor(-r*i)/i:Math.floor(r*i)/i})}round(e,t){return this.runFunction(e.args,t,this.metadata("ROUND"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.round(-r*i)/i:Math.round(r*i)/i})}intFunc(e,t){return this.runFunction(e.args,t,this.metadata("INT"),r=>r<0?-Math.floor(-r):Math.floor(r))}even(e,t){return this.runFunction(e.args,t,this.metadata("EVEN"),r=>r<0?-tc(-r):tc(r))}odd(e,t){return this.runFunction(e.args,t,this.metadata("ODD"),r=>r<0?-ec(-r):ec(r))}ceilingmath(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.MATH"),(r,n,i)=>n===0||r===0?0:(n=Math.abs(n),i===1&&r<0&&(n=-n),Math.ceil(r/n)*n))}ceiling(e,t){return this.runFunction(e.args,t,this.metadata("CEILING"),(r,n)=>r===0?0:n===0?new m(E.DIV_BY_ZERO):r>0&&n<0?new m(E.NUM,y.DistinctSigns):Math.ceil(r/n)*n)}ceilingprecise(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.PRECISE"),(r,n)=>n===0||r===0?0:(n=Math.abs(n),Math.ceil(r/n)*n))}floormath(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.MATH"),(r,n,i)=>n===0||r===0?0:(n=Math.abs(n),i===1&&r<0&&(n*=-1),Math.floor(r/n)*n))}floor(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR"),(r,n)=>r===0?0:n===0?new m(E.DIV_BY_ZERO):r>0&&n<0?new m(E.NUM,y.DistinctSigns):Math.floor(r/n)*n)}floorprecise(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.PRECISE"),(r,n)=>n===0||r===0?0:(n=Math.abs(n),Math.floor(r/n)*n))}}Au.implementedFunctions={ROUNDUP:{method:"roundup",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0}]},ROUNDDOWN:{method:"rounddown",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0}]},ROUND:{method:"round",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:0}]},INT:{method:"intFunc",parameters:[{argumentType:c.NUMBER}]},EVEN:{method:"even",parameters:[{argumentType:c.NUMBER}]},ODD:{method:"odd",parameters:[{argumentType:c.NUMBER}]},"CEILING.MATH":{method:"ceilingmath",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:1},{argumentType:c.NUMBER,defaultValue:0}]},CEILING:{method:"ceiling",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER}]},"CEILING.PRECISE":{method:"ceilingprecise",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:1}]},"FLOOR.MATH":{method:"floormath",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:1},{argumentType:c.NUMBER,defaultValue:0}]},FLOOR:{method:"floor",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER}]},"FLOOR.PRECISE":{method:"floorprecise",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,defaultValue:1}]}};Au.aliases={"ISO.CEILING":"CEILING.PRECISE",TRUNC:"ROUNDDOWN"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class wf extends ${sqrt(e,t){return this.runFunction(e.args,t,this.metadata("SQRT"),Math.sqrt)}}wf.implementedFunctions={SQRT:{method:"sqrt",parameters:[{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function*uv(){}function lv(s){const e=s[Symbol.iterator](),{done:t,value:r}=e.next();return t?{rest:uv()}:{value:r,rest:e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const cv=(s,e,t)=>{if(t.end.row>t.start.row){const r=x(t.end.sheet,t.end.col,t.end.row-1),n=s.getRange(t.start,r);if(n!==void 0)return{smallerRangeVertex:n,restValuesRange:t.withStart(x(t.start.sheet,t.start.col,t.end.row)),restConditionRanges:e.map(i=>i.withStart(x(i.start.sheet,i.start.col,i.end.row)))}}return{restValuesRange:t,restConditionRanges:e}};class hv{constructor(e,t,r,n,i){this.interpreter=e,this.cacheKey=t,this.reduceInitialValue=r,this.composeFunction=n,this.mapFunction=i,this.dependencyGraph=this.interpreter.dependencyGraph}compute(e,t){for(const i of t)if(!i.conditionRange.sameDimensionsAs(e))return new m(E.VALUE,y.EqualLength);const r=this.tryToGetRangeVertexForRangeValue(e),n=t.map(i=>this.tryToGetRangeVertexForRangeValue(i.conditionRange));if(r&&n.every(i=>i!==void 0)){const i=t.map(u=>u.criterionPackage.raw).join(","),a=this.findAlreadyComputedValueInCache(r,this.cacheKey(t),i);if(a!==void 0)return this.interpreter.stats.incrementCriterionFunctionFullCacheUsed(),a;const o=this.buildNewCriterionCache(this.cacheKey(t),t.map(u=>u.conditionRange.range),e.range);return o.has(i)||o.set(i,[this.evaluateRangeValue(e,t),t.map(u=>u.criterionPackage.lambda)]),r.setCriterionFunctionValues(this.cacheKey(t),o),n.forEach(u=>{u!==void 0&&u.addDependentCacheRange(r)}),o.get(i)[0]}else return this.evaluateRangeValue(e,t)}tryToGetRangeVertexForRangeValue(e){const t=e.range;if(t!==void 0)return this.dependencyGraph.getRange(t.start,t.end)}reduceFunction(e){let t=this.reduceInitialValue;for(const r of e)t=this.composeFunction(t,r);return t}findAlreadyComputedValueInCache(e,t,r){return e.getCriterionFunctionValue(t,r)}evaluateRangeValue(e,t){const r=t.map(o=>o.criterionPackage.lambda),n=Array.from(e.valuesFromTopLeftCorner()).map(this.mapFunction)[Symbol.iterator](),i=t.map(o=>o.conditionRange.iterateValuesFromTopLeftCorner()),a=nc(r,i,n);return this.reduceFunction(a)}buildNewCriterionCache(e,t,r){const n=this.dependencyGraph.getRange(r.start,r.end),{smallerRangeVertex:i,restConditionRanges:a,restValuesRange:o}=cv(this.dependencyGraph,t,r);let u;i!==void 0&&this.dependencyGraph.existsEdge(i,n)?u=i.getCriterionFunctionValues(e):u=new Map;const l=new Map;return u.forEach(([h,d],f)=>{const p=nc(d,a.map(g=>rc(this.dependencyGraph,g)),Array.from(rc(this.dependencyGraph,o)).map(this.mapFunction)[Symbol.iterator]()),N=this.composeFunction(h,this.reduceFunction(p));this.interpreter.stats.incrementCriterionFunctionPartialCacheUsed(),l.set(f,[N,d])}),l}}class dv{constructor(e,t){this.conditionRange=e,this.criterionPackage=t}}function*rc(s,e){for(const t of e.addresses(s))yield b(s.getScalarValue(t))}function*nc(s,e,t){for(const r of t){const n=e.map(a=>lv(a));if(!n.every(a=>Object.prototype.hasOwnProperty.call(a,"value")))return;const i=n.map(a=>b(a.value));fv(i,s).every(([a,o])=>o(a))&&(yield r),e=n.map(a=>a.rest)}}function fv(s,e){const t=[];for(let r=0;r<Math.min(s.length,e.length);r++)t.push([s[r],e[r]]);return t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class sn{constructor(e,t){this.sum=e,this.count=t}static single(e){return new sn(e,1)}compose(e){return new sn(this.sum+e.sum,this.count+e.count)}averageValue(){if(this.count>0)return this.sum/this.count}}sn.empty=new sn(0,0);function pv(s){return e=>{const t=e.map(r=>`${r.conditionRange.range.sheet},${r.conditionRange.range.start.col},${r.conditionRange.range.start.row}`);return[s,...t].join(",")}}function sc(s){return ue(s)&&!Number.isFinite(b(s))?0:s}function yi(s){if(s instanceof m)return s;if(ue(s))return b(s)}class Mf extends ${sumif(e,t){const r="SUMIF",n=(i,a,o)=>this.computeConditionalAggregationFunction(o??i,[i,a],r,0,(u,l)=>this.arithmeticHelper.nonstrictadd(u,l),yi);return this.runFunction(e.args,t,this.metadata(r),n)}sumifs(e,t){const r="SUMIFS",n=(i,...a)=>this.computeConditionalAggregationFunction(i,a,r,0,(o,u)=>this.arithmeticHelper.nonstrictadd(o,u),yi);return this.runFunction(e.args,t,this.metadata(r),n)}averageif(e,t){const r="AVERAGEIF",n=(i,a,o)=>{const u=this.computeConditionalAggregationFunction(o??i,[i,a],r,sn.empty,(l,h)=>l.compose(h),l=>ue(l)?sn.single(b(l)):sn.empty);return u instanceof m?u:u.averageValue()||new m(E.DIV_BY_ZERO)};return this.runFunction(e.args,t,this.metadata(r),n)}countif(e,t){const r="COUNTIF",n=(i,a)=>this.computeConditionalAggregationFunction(i,[i,a],r,0,(o,u)=>o+u,()=>1);return this.runFunction(e.args,t,this.metadata(r),n)}countifs(e,t){const r="COUNTIFS",n=(...i)=>this.computeConditionalAggregationFunction(i[0],i,r,0,(a,o)=>a+o,()=>1);return this.runFunction(e.args,t,this.metadata(r),n)}minifs(e,t){const r="MINIFS",n=(a,o)=>o===void 0||a===void 0?o===void 0?a:o:Math.min(a,o),i=(a,...o)=>{const u=this.computeConditionalAggregationFunction(a,o,r,Number.POSITIVE_INFINITY,n,yi);return sc(u)};return this.runFunction(e.args,t,this.metadata(r),i)}maxifs(e,t){const r="MAXIFS",n=(a,o)=>o===void 0||a===void 0?o===void 0?a:o:Math.max(a,o),i=(a,...o)=>{const u=this.computeConditionalAggregationFunction(a,o,r,Number.NEGATIVE_INFINITY,n,yi);return sc(u)};return this.runFunction(e.args,t,this.metadata(r),i)}computeConditionalAggregationFunction(e,t,r,n,i,a){const o=[];for(let u=0;u<t.length;u+=2){const l=t[u],h=this.interpreter.criterionBuilder.fromCellValue(t[u+1],this.arithmeticHelper);if(h===void 0)return new m(E.VALUE,y.BadCriterion);o.push(new dv(l,h))}return new hv(this.interpreter,pv(r),n,i,a).compute(e,o)}}Mf.implementedFunctions={SUMIF:{method:"sumif",parameters:[{argumentType:c.RANGE},{argumentType:c.NOERROR},{argumentType:c.RANGE,optionalArg:!0}]},COUNTIF:{method:"countif",parameters:[{argumentType:c.RANGE},{argumentType:c.NOERROR}]},AVERAGEIF:{method:"averageif",parameters:[{argumentType:c.RANGE},{argumentType:c.NOERROR},{argumentType:c.RANGE,optionalArg:!0}]},SUMIFS:{method:"sumifs",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE},{argumentType:c.NOERROR}],repeatLastArgs:2},COUNTIFS:{method:"countifs",parameters:[{argumentType:c.RANGE},{argumentType:c.NOERROR}],repeatLastArgs:2},MINIFS:{method:"minifs",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE},{argumentType:c.NOERROR}],repeatLastArgs:2},MAXIFS:{method:"maxifs",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE},{argumentType:c.NOERROR}],repeatLastArgs:2}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Of extends ${sumproduct(e,t){return this.runFunction(e.args,t,this.metadata("SUMPRODUCT"),(...r)=>{const n=r[0].width(),i=r[0].height();for(const u of r)if(u.width()!==n||u.height()!==i)return new m(E.VALUE,y.EqualLength);let a=0;const o=r.map(u=>u.iterateValuesFromTopLeftCorner());for(let u=0;u<n*i;u++){let l=1;for(const h of o){const d=h.next().value;if(d instanceof m)return d;const f=this.coerceScalarToNumberOrError(d);ue(f)?l*=b(f):l=0}a+=l}return a})}}Of.implementedFunctions={SUMPRODUCT:{method:"sumproduct",parameters:[{argumentType:c.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class bf extends ${concatenate(e,t){return this.runFunction(e.args,t,this.metadata("CONCATENATE"),(...r)=>"".concat(...r))}split(e,t){return this.runFunction(e.args,t,this.metadata("SPLIT"),(r,n)=>{const i=r.split(" ");return n>=i.length||n<0?new m(E.VALUE,y.IndexBounds):i[n]})}len(e,t){return this.runFunction(e.args,t,this.metadata("LEN"),r=>r.length)}lower(e,t){return this.runFunction(e.args,t,this.metadata("LOWER"),r=>r.toLowerCase())}trim(e,t){return this.runFunction(e.args,t,this.metadata("TRIM"),r=>r.replace(/^ +/g,"").replace(/ +$/g,"").replace(/ +/g," "))}proper(e,t){return this.runFunction(e.args,t,this.metadata("PROPER"),r=>r.replace(new RegExp("\\p{L}+","gu"),n=>n.charAt(0).toUpperCase()+n.substring(1).toLowerCase()))}clean(e,t){return this.runFunction(e.args,t,this.metadata("CLEAN"),r=>r.replace(/[\u0000-\u001F]/g,""))}exact(e,t){return this.runFunction(e.args,t,this.metadata("EXACT"),(r,n)=>r===n)}rept(e,t){return this.runFunction(e.args,t,this.metadata("REPT"),(r,n)=>n<0?new m(E.VALUE,y.NegativeCount):r.repeat(n))}right(e,t){return this.runFunction(e.args,t,this.metadata("RIGHT"),(r,n)=>n<0?new m(E.VALUE,y.NegativeLength):n===0?"":r.slice(-n))}left(e,t){return this.runFunction(e.args,t,this.metadata("LEFT"),(r,n)=>n<0?new m(E.VALUE,y.NegativeLength):r.slice(0,n))}mid(e,t){return this.runFunction(e.args,t,this.metadata("MID"),(r,n,i)=>n<1?new m(E.VALUE,y.LessThanOne):i<0?new m(E.VALUE,y.NegativeLength):r.substring(n-1,n+i-1))}replace(e,t){return this.runFunction(e.args,t,this.metadata("REPLACE"),(r,n,i,a)=>n<1?new m(E.VALUE,y.LessThanOne):i<0?new m(E.VALUE,y.NegativeLength):r.substring(0,n-1)+a+r.substring(n+i-1))}search(e,t){return this.runFunction(e.args,t,this.metadata("SEARCH"),(r,n,i)=>{if(i<1||i>n.length)return new m(E.VALUE,y.LengthBounds);const a=r.toLowerCase(),o=n.substring(i-1).toLowerCase(),u=this.arithmeticHelper.requiresRegex(a)?this.arithmeticHelper.searchString(a,o):o.indexOf(a);return u>-1?u+i:new m(E.VALUE,y.PatternNotFound)})}substitute(e,t){return this.runFunction(e.args,t,this.metadata("SUBSTITUTE"),(r,n,i,a)=>{const o=this.escapeRegExpSpecialCharacters(n),u=new RegExp(o,"g");if(a===void 0)return r.replace(u,i);if(a<1)return new m(E.VALUE,y.LessThanOne);let l,h=0;for(;(l=u.exec(r))!==null;)if(a===++h)return r.substring(0,l.index)+i+r.substring(u.lastIndex);return r})}find(e,t){return this.runFunction(e.args,t,this.metadata("FIND"),(r,n,i)=>{if(i<1||i>n.length)return new m(E.VALUE,y.IndexBounds);const o=n.substring(i-1).indexOf(r)+i;return o>0?o:new m(E.VALUE,y.PatternNotFound)})}t(e,t){return this.runFunction(e.args,t,this.metadata("T"),r=>r instanceof m||typeof r=="string"?r:"")}upper(e,t){return this.runFunction(e.args,t,this.metadata("UPPER"),r=>r.toUpperCase())}escapeRegExpSpecialCharacters(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}bf.implementedFunctions={CONCATENATE:{method:"concatenate",parameters:[{argumentType:c.STRING}],repeatLastArgs:1,expandRanges:!0},EXACT:{method:"exact",parameters:[{argumentType:c.STRING},{argumentType:c.STRING}]},SPLIT:{method:"split",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER}]},LEN:{method:"len",parameters:[{argumentType:c.STRING}]},LOWER:{method:"lower",parameters:[{argumentType:c.STRING}]},MID:{method:"mid",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER},{argumentType:c.NUMBER}]},TRIM:{method:"trim",parameters:[{argumentType:c.STRING}]},T:{method:"t",parameters:[{argumentType:c.SCALAR}]},PROPER:{method:"proper",parameters:[{argumentType:c.STRING}]},CLEAN:{method:"clean",parameters:[{argumentType:c.STRING}]},REPT:{method:"rept",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER}]},RIGHT:{method:"right",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER,defaultValue:1}]},LEFT:{method:"left",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER,defaultValue:1}]},REPLACE:{method:"replace",parameters:[{argumentType:c.STRING},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.STRING}]},SEARCH:{method:"search",parameters:[{argumentType:c.STRING},{argumentType:c.STRING},{argumentType:c.NUMBER,defaultValue:1}]},SUBSTITUTE:{method:"substitute",parameters:[{argumentType:c.STRING},{argumentType:c.STRING},{argumentType:c.STRING},{argumentType:c.NUMBER,optionalArg:!0}]},FIND:{method:"find",parameters:[{argumentType:c.STRING},{argumentType:c.STRING},{argumentType:c.NUMBER,defaultValue:1}]},UPPER:{method:"upper",parameters:[{argumentType:c.STRING}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class xf extends ${acos(e,t){return this.runFunction(e.args,t,this.metadata("ACOS"),Math.acos)}asin(e,t){return this.runFunction(e.args,t,this.metadata("ASIN"),Math.asin)}cos(e,t){return this.runFunction(e.args,t,this.metadata("COS"),Math.cos)}sin(e,t){return this.runFunction(e.args,t,this.metadata("SIN"),Math.sin)}tan(e,t){return this.runFunction(e.args,t,this.metadata("TAN"),Math.tan)}atan(e,t){return this.runFunction(e.args,t,this.metadata("ATAN"),Math.atan)}atan2(e,t){return this.runFunction(e.args,t,this.metadata("ATAN2"),(r,n)=>r===0&&n===0?new m(E.DIV_BY_ZERO):Math.atan2(n,r))}cot(e,t){return this.runFunction(e.args,t,this.metadata("COT"),r=>r===0?new m(E.DIV_BY_ZERO):1/Math.tan(r))}acot(e,t){return this.runFunction(e.args,t,this.metadata("ACOT"),r=>r===0?Do/2:Math.atan(1/r))}sec(e,t){return this.runFunction(e.args,t,this.metadata("SEC"),r=>1/Math.cos(r))}csc(e,t){return this.runFunction(e.args,t,this.metadata("CSC"),r=>r===0?new m(E.DIV_BY_ZERO):1/Math.sin(r))}sinh(e,t){return this.runFunction(e.args,t,this.metadata("SINH"),Math.sinh)}asinh(e,t){return this.runFunction(e.args,t,this.metadata("ASINH"),Math.asinh)}cosh(e,t){return this.runFunction(e.args,t,this.metadata("COSH"),Math.cosh)}acosh(e,t){return this.runFunction(e.args,t,this.metadata("ACOSH"),Math.acosh)}tanh(e,t){return this.runFunction(e.args,t,this.metadata("TANH"),Math.tanh)}atanh(e,t){return this.runFunction(e.args,t,this.metadata("ATANH"),Math.atanh)}coth(e,t){return this.runFunction(e.args,t,this.metadata("COTH"),r=>r===0?new m(E.DIV_BY_ZERO):1/Math.tanh(r))}acoth(e,t){return this.runFunction(e.args,t,this.metadata("ACOTH"),r=>r===0?new m(E.NUM,y.NonZero):Math.atanh(1/r))}sech(e,t){return this.runFunction(e.args,t,this.metadata("SECH"),r=>1/Math.cosh(r))}csch(e,t){return this.runFunction(e.args,t,this.metadata("CSCH"),r=>r===0?new m(E.DIV_BY_ZERO):1/Math.sinh(r))}}xf.implementedFunctions={ACOS:{method:"acos",parameters:[{argumentType:c.NUMBER}]},ASIN:{method:"asin",parameters:[{argumentType:c.NUMBER}]},COS:{method:"cos",parameters:[{argumentType:c.NUMBER}]},SIN:{method:"sin",parameters:[{argumentType:c.NUMBER}]},TAN:{method:"tan",parameters:[{argumentType:c.NUMBER}]},ATAN:{method:"atan",parameters:[{argumentType:c.NUMBER}]},ATAN2:{method:"atan2",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER}]},COT:{method:"cot",parameters:[{argumentType:c.NUMBER}]},SEC:{method:"sec",parameters:[{argumentType:c.NUMBER}]},CSC:{method:"csc",parameters:[{argumentType:c.NUMBER}]},SINH:{method:"sinh",parameters:[{argumentType:c.NUMBER}]},COSH:{method:"cosh",parameters:[{argumentType:c.NUMBER}]},TANH:{method:"tanh",parameters:[{argumentType:c.NUMBER}]},COTH:{method:"coth",parameters:[{argumentType:c.NUMBER}]},SECH:{method:"sech",parameters:[{argumentType:c.NUMBER}]},CSCH:{method:"csch",parameters:[{argumentType:c.NUMBER}]},ACOT:{method:"acot",parameters:[{argumentType:c.NUMBER}]},ASINH:{method:"asinh",parameters:[{argumentType:c.NUMBER}]},ACOSH:{method:"acosh",parameters:[{argumentType:c.NUMBER}]},ATANH:{method:"atanh",parameters:[{argumentType:c.NUMBER}]},ACOTH:{method:"acoth",parameters:[{argumentType:c.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mv extends Hd{constructor(e){super(e),this.dependencyGraph=e}find(e,t,r){return this.basicFind(e,t,"col",r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class _f extends ${constructor(){super(...arguments),this.rowSearch=new mv(this.dependencyGraph)}vlookup(e,t){return this.runFunction(e.args,t,this.metadata("VLOOKUP"),(r,n,i,a)=>{const o=n.range;if(o===void 0)return new m(E.VALUE,y.WrongType);if(i<1)return new m(E.VALUE,y.LessThanOne);if(i>o.width())return new m(E.REF,y.IndexLarge);const u={ordering:a?"asc":"none",ifNoMatch:a?"returnLowerBound":"returnNotFound"};return this.doVlookup(li(r),n,i-1,u)})}hlookup(e,t){return this.runFunction(e.args,t,this.metadata("HLOOKUP"),(r,n,i,a)=>{const o=n.range;if(o===void 0)return new m(E.VALUE,y.WrongType);if(i<1)return new m(E.VALUE,y.LessThanOne);if(i>o.height())return new m(E.REF,y.IndexLarge);const u={ordering:a?"asc":"none",ifNoMatch:a?"returnLowerBound":"returnNotFound"};return this.doHlookup(li(r),n,i-1,u)})}xlookup(e,t){return this.runFunction(e.args,t,this.metadata("XLOOKUP"),(r,n,i,a,o,u)=>{if(![0,-1,1,2].includes(o))return new m(E.VALUE,y.BadMode);if(![1,-1,2,-2].includes(u))return new m(E.VALUE,y.BadMode);const l=n instanceof F?n:F.fromScalar(n),h=i instanceof F?i:F.fromScalar(i),d=o===2,f={ordering:u===2?"asc":u===-2?"desc":"none",returnOccurrence:u===-1?"last":"first",ifNoMatch:o===-1?"returnLowerBound":o===1?"returnUpperBound":"returnNotFound"};return this.doXlookup(li(r),l,h,a,d,f)})}xlookupArraySize(e){var t,r;const n=(t=e?.args)===null||t===void 0?void 0:t[1],i=(r=e?.args)===null||r===void 0?void 0:r[2];if(n?.start==null||n?.end==null||i?.start==null||i?.end==null)return X.error();const a=n.end.row-n.start.row+1,o=n.end.col-n.start.col+1,u=i.end.row-i.start.row+1,l=i.end.col-i.start.col+1,h=o===1&&u===a;return!h&&!(a===1&&l===o)?X.error():h?new X(l,1):new X(1,u)}match(e,t){return this.runFunction(e.args,t,this.metadata("MATCH"),(r,n,i)=>this.doMatch(li(r),n,i))}searchInRange(e,t,r,n,i){return r&&typeof e=="string"&&this.arithmeticHelper.requiresRegex(e)?i.advancedFind(this.arithmeticHelper.eqMatcherFunction(e),t,{returnOccurrence:n.returnOccurrence}):i.find(e,t,n)}doVlookup(e,t,r,n){this.dependencyGraph.stats.start(Y.VLOOKUP);const i=t.range;let a;i===void 0?a=F.onlyValues(t.data.map(l=>[l[0]])):a=F.onlyRange(B.spanFrom(i.start,1,i.height()),this.dependencyGraph);const o=this.searchInRange(e,a,n.ordering==="none",n,this.columnSearch);if(this.dependencyGraph.stats.end(Y.VLOOKUP),o===-1)return new m(E.NA,y.ValueNotFound);let u;if(i===void 0)u=t.data[o][r];else{const l=x(i.sheet,i.start.col+r,i.start.row+o);u=this.dependencyGraph.getCellValue(l)}return u instanceof F?new m(E.VALUE,y.WrongType):u}doHlookup(e,t,r,n){const i=t.range;let a;i===void 0?a=F.onlyValues([t.data[0]]):a=F.onlyRange(B.spanFrom(i.start,i.width(),1),this.dependencyGraph);const o=this.searchInRange(e,a,n.ordering==="none",n,this.rowSearch);if(o===-1)return new m(E.NA,y.ValueNotFound);let u;if(i===void 0)u=t.data[r][o];else{const l=x(i.sheet,i.start.col+o,i.start.row+r);u=this.dependencyGraph.getCellValue(l)}return u instanceof F?new m(E.VALUE,y.WrongType):u}doXlookup(e,t,r,n,i,a){const o=t.width()===1&&r.height()===t.height(),u=t.height()===1&&r.width()===t.width();if(!o&&!u)return new m(E.VALUE,y.WrongDimension);const l=o?this.columnSearch:this.rowSearch,h=this.searchInRange(e,t,i,a,l);if(h===-1)return n==E.NA?new m(E.NA,y.ValueNotFound):n;const d=o?[r.data[h]]:r.data.map(f=>[f[h]]);return F.onlyValues(d)}doMatch(e,t,r){if(![-1,0,1].includes(r))return new m(E.VALUE,y.BadMode);if(t.width()>1&&t.height()>1)return new m(E.NA);const n=t.width()===1?this.columnSearch:this.rowSearch,i=r===0?{ordering:"none",ifNoMatch:"returnNotFound"}:{ordering:r===-1?"desc":"asc",ifNoMatch:r===-1?"returnUpperBound":"returnLowerBound"},a=n.find(e,t,i);return a===-1?new m(E.NA,y.ValueNotFound):a+1}}_f.implementedFunctions={VLOOKUP:{method:"vlookup",parameters:[{argumentType:c.NOERROR},{argumentType:c.RANGE},{argumentType:c.NUMBER},{argumentType:c.BOOLEAN,defaultValue:!0}]},HLOOKUP:{method:"hlookup",parameters:[{argumentType:c.NOERROR},{argumentType:c.RANGE},{argumentType:c.NUMBER},{argumentType:c.BOOLEAN,defaultValue:!0}]},XLOOKUP:{method:"xlookup",sizeOfResultArrayMethod:"xlookupArraySize",parameters:[{argumentType:c.NOERROR},{argumentType:c.RANGE},{argumentType:c.RANGE},{argumentType:c.SCALAR,optionalArg:!0,defaultValue:E.NA},{argumentType:c.NUMBER,optionalArg:!0,defaultValue:0},{argumentType:c.NUMBER,optionalArg:!0,defaultValue:1}]},MATCH:{method:"match",parameters:[{argumentType:c.NOERROR},{argumentType:c.RANGE},{argumentType:c.NUMBER,defaultValue:1}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Lf extends ${roman(e,t){return this.runFunction(e.args,t,this.metadata("ROMAN"),(r,n)=>(r=Math.trunc(r),n===!1?n=4:n===!0&&(n=0),n=b(this.coerceScalarToNumberOrError(n)),n instanceof m?n:(n=Math.trunc(n),n<0?new m(E.VALUE,y.ValueSmall):n>4?new m(E.VALUE,y.ValueLarge):gv(r,n))))}arabic(e,t){return this.runFunction(e.args,t,this.metadata("ARABIC"),r=>{r=r.trim().toUpperCase();let n=!1;if(r.startsWith("-")&&(r=r.slice(1),n=!0,r===""))return new m(E.VALUE,y.InvalidRoman);const i={input:r,acc:0};return Er(i,{token:"MMM",val:3e3},{token:"MM",val:2e3},{token:"M",val:1e3}),Er(i,{token:"IM",val:999},{token:"VM",val:995},{token:"XM",val:990},{token:"LM",val:950},{token:"CM",val:900}),Er(i,{token:"D",val:500},{token:"ID",val:499},{token:"VD",val:495},{token:"XD",val:490},{token:"LD",val:450},{token:"CD",val:400}),Er(i,{token:"CCC",val:300},{token:"CC",val:200},{token:"C",val:100}),Er(i,{token:"IC",val:99},{token:"VC",val:95},{token:"XC",val:90}),Er(i,{token:"L",val:50},{token:"IL",val:49},{token:"VL",val:45},{token:"XL",val:40}),Er(i,{token:"XXX",val:30},{token:"XX",val:20},{token:"X",val:10}),Er(i,{token:"IX",val:9}),Er(i,{token:"V",val:5},{token:"IV",val:4}),Er(i,{token:"III",val:3},{token:"II",val:2},{token:"I",val:1}),i.input!==""?new m(E.VALUE,y.InvalidRoman):n?-i.acc:i.acc})}}Lf.implementedFunctions={ROMAN:{method:"roman",parameters:[{argumentType:c.NUMBER,minValue:1,lessThan:4e3},{argumentType:c.NOERROR,optionalArg:!0,defaultValue:0}]},ARABIC:{method:"arabic",parameters:[{argumentType:c.STRING}]}};function Er(s,...e){for(const t of e)if(s.input.startsWith(t.token)){s.input=s.input.slice(t.token.length),s.acc+=t.val;break}}function gv(s,e){const t={val:s%1e3,acc:"M".repeat(Math.floor(s/1e3))};return e===4&&(Be(t,"IM",999,1e3),Be(t,"ID",499,500)),e>=3&&(Be(t,"VM",995,1e3),Be(t,"VD",495,500)),e>=2&&(Be(t,"XM",990,1e3),Be(t,"XD",490,500)),e>=1&&(Be(t,"LM",950,1e3),Be(t,"LD",450,500)),Be(t,"CM",900,1e3),Be(t,"CD",400,500),Be(t,"D",500,900),t.acc+="C".repeat(Math.floor(t.val/100)),t.val%=100,e>=2&&(Be(t,"IC",99,100),Be(t,"IL",49,50)),e>=1&&(Be(t,"VC",95,100),Be(t,"VL",45,50)),Be(t,"XC",90,100),Be(t,"XL",40,50),Be(t,"L",50,90),t.acc+="X".repeat(Math.floor(t.val/10)),t.val%=10,Be(t,"IX",9,10),Be(t,"IV",4,5),Be(t,"V",5,9),t.acc+="I".repeat(t.val),t.acc}function Be(s,e,t,r){s.val>=t&&s.val<r&&(s.val-=t,s.acc+=e)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ff extends ${add(e,t){return this.runFunction(e.args,t,this.metadata("HF.ADD"),this.arithmeticHelper.addWithEpsilon)}concat(e,t){return this.runFunction(e.args,t,this.metadata("HF.CONCAT"),this.arithmeticHelper.concat)}divide(e,t){return this.runFunction(e.args,t,this.metadata("HF.DIVIDE"),this.arithmeticHelper.divide)}eq(e,t){return this.runFunction(e.args,t,this.metadata("HF.EQ"),this.arithmeticHelper.eq)}gt(e,t){return this.runFunction(e.args,t,this.metadata("HF.GT"),this.arithmeticHelper.gt)}gte(e,t){return this.runFunction(e.args,t,this.metadata("HF.GTE"),this.arithmeticHelper.geq)}lt(e,t){return this.runFunction(e.args,t,this.metadata("HF.LT"),this.arithmeticHelper.lt)}lte(e,t){return this.runFunction(e.args,t,this.metadata("HF.LTE"),this.arithmeticHelper.leq)}minus(e,t){return this.runFunction(e.args,t,this.metadata("HF.MINUS"),this.arithmeticHelper.subtract)}multiply(e,t){return this.runFunction(e.args,t,this.metadata("HF.MULTIPLY"),this.arithmeticHelper.multiply)}ne(e,t){return this.runFunction(e.args,t,this.metadata("HF.NE"),this.arithmeticHelper.neq)}pow(e,t){return this.runFunction(e.args,t,this.metadata("HF.POW"),this.arithmeticHelper.pow)}uminus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UMINUS"),this.arithmeticHelper.unaryMinus)}upercent(e,t){return this.runFunction(e.args,t,this.metadata("HF.UNARY_PERCENT"),this.arithmeticHelper.unaryPercent)}uplus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UPLUS"),this.arithmeticHelper.unaryPlus)}}Ff.implementedFunctions={"HF.ADD":{method:"add",parameters:[{argumentType:c.NUMBER,passSubtype:!0},{argumentType:c.NUMBER,passSubtype:!0}]},"HF.CONCAT":{method:"concat",parameters:[{argumentType:c.STRING,passSubtype:!0},{argumentType:c.STRING,passSubtype:!0}]},"HF.DIVIDE":{method:"divide",parameters:[{argumentType:c.NUMBER,passSubtype:!0},{argumentType:c.NUMBER,passSubtype:!0}]},"HF.EQ":{method:"eq",parameters:[{argumentType:c.NOERROR,passSubtype:!0},{argumentType:c.NOERROR,passSubtype:!0}]},"HF.GT":{method:"gt",parameters:[{argumentType:c.NOERROR,passSubtype:!0},{argumentType:c.NOERROR,passSubtype:!0}]},"HF.GTE":{method:"gte",parameters:[{argumentType:c.NOERROR,passSubtype:!0},{argumentType:c.NOERROR,passSubtype:!0}]},"HF.LT":{method:"lt",parameters:[{argumentType:c.NOERROR,passSubtype:!0},{argumentType:c.NOERROR,passSubtype:!0}]},"HF.LTE":{method:"lte",parameters:[{argumentType:c.NOERROR,passSubtype:!0},{argumentType:c.NOERROR,passSubtype:!0}]},"HF.MINUS":{method:"minus",parameters:[{argumentType:c.NUMBER,passSubtype:!0},{argumentType:c.NUMBER,passSubtype:!0}]},"HF.MULTIPLY":{method:"multiply",parameters:[{argumentType:c.NUMBER,passSubtype:!0},{argumentType:c.NUMBER,passSubtype:!0}]},"HF.NE":{method:"ne",parameters:[{argumentType:c.NOERROR,passSubtype:!0},{argumentType:c.NOERROR,passSubtype:!0}]},"HF.POW":{method:"pow",parameters:[{argumentType:c.NUMBER,passSubtype:!0},{argumentType:c.NUMBER,passSubtype:!0}]},"HF.UMINUS":{method:"uminus",parameters:[{argumentType:c.NUMBER,passSubtype:!0}]},"HF.UNARY_PERCENT":{method:"upercent",parameters:[{argumentType:c.NUMBER,passSubtype:!0}]},"HF.UPLUS":{method:"uplus",parameters:[{argumentType:c.NUMBER,passSubtype:!0}]}};/**
 * @license
 bessel.js (C) 2013-present SheetJS -- http://sheetjs.com

 Apache License
 Version 2.0, January 2004
 http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

 "License" shall mean the terms and conditions for use, reproduction,
 and distribution as defined by Sections 1 through 9 of this document.

 "Licensor" shall mean the copyright owner or entity authorized by
 the copyright owner that is granting the License.

 "Legal Entity" shall mean the union of the acting entity and all
 other entities that control, are controlled by, or are under common
 control with that entity. For the purposes of this definition,
 "control" means (i) the power, direct or indirect, to cause the
 direction or management of such entity, whether by contract or
 otherwise, or (ii) ownership of fifty percent (50%) or more of the
 outstanding shares, or (iii) beneficial ownership of such entity.

 "You" (or "Your") shall mean an individual or Legal Entity
 exercising permissions granted by this License.

 "Source" form shall mean the preferred form for making modifications,
 including but not limited to software source code, documentation
 source, and configuration files.

 "Object" form shall mean any form resulting from mechanical
 transformation or translation of a Source form, including but
 not limited to compiled object code, generated documentation,
 and conversions to other media types.

 "Work" shall mean the work of authorship, whether in Source or
 Object form, made available under the License, as indicated by a
 copyright notice that is included in or attached to the work
 (an example is provided in the Appendix below).

 "Derivative Works" shall mean any work, whether in Source or Object
 form, that is based on (or derived from) the Work and for which the
 editorial revisions, annotations, elaborations, or other modifications
 represent, as a whole, an original work of authorship. For the purposes
 of this License, Derivative Works shall not include works that remain
 separable from, or merely link (or bind by name) to the interfaces of,
 the Work and Derivative Works thereof.

 "Contribution" shall mean any work of authorship, including
 the original version of the Work and any modifications or additions
 to that Work or Derivative Works thereof, that is intentionally
 submitted to Licensor for inclusion in the Work by the copyright owner
 or by an individual or Legal Entity authorized to submit on behalf of
 the copyright owner. For the purposes of this definition, "submitted"
 means any form of electronic, verbal, or written communication sent
 to the Licensor or its representatives, including but not limited to
 communication on electronic mailing lists, source code control systems,
 and issue tracking systems that are managed by, or on behalf of, the
 Licensor for the purpose of discussing and improving the Work, but
 excluding communication that is conspicuously marked or otherwise
 designated in writing by the copyright owner as "Not a Contribution."

 "Contributor" shall mean Licensor and any individual or Legal Entity
 on behalf of whom a Contribution has been received by Licensor and
 subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 copyright license to reproduce, prepare Derivative Works of,
 publicly display, publicly perform, sublicense, and distribute the
 Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 (except as stated in this section) patent license to make, have made,
 use, offer to sell, sell, import, and otherwise transfer the Work,
 where such license applies only to those patent claims licensable
 by such Contributor that are necessarily infringed by their
 Contribution(s) alone or by combination of their Contribution(s)
 with the Work to which such Contribution(s) was submitted. If You
 institute patent litigation against any entity (including a
 cross-claim or counterclaim in a lawsuit) alleging that the Work
 or a Contribution incorporated within the Work constitutes direct
 or contributory patent infringement, then any patent licenses
 granted to You under this License for that Work shall terminate
 as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
 Work or Derivative Works thereof in any medium, with or without
 modifications, and in Source or Object form, provided that You
 meet the following conditions:

 (a) You must give any other recipients of the Work or
 Derivative Works a copy of this License; and

 (b) You must cause any modified files to carry prominent notices
 stating that You changed the files; and

 (c) You must retain, in the Source form of any Derivative Works
 that You distribute, all copyright, patent, trademark, and
 attribution notices from the Source form of the Work,
 excluding those notices that do not pertain to any part of
 the Derivative Works; and

 (d) If the Work includes a "NOTICE" text file as part of its
 distribution, then any Derivative Works that You distribute must
 include a readable copy of the attribution notices contained
 within such NOTICE file, excluding those notices that do not
 pertain to any part of the Derivative Works, in at least one
 of the following places: within a NOTICE text file distributed
 as part of the Derivative Works; within the Source form or
 documentation, if provided along with the Derivative Works; or,
 within a display generated by the Derivative Works, if and
 wherever such third-party notices normally appear. The contents
 of the NOTICE file are for informational purposes only and
 do not modify the License. You may add Your own attribution
 notices within Derivative Works that You distribute, alongside
 or as an addendum to the NOTICE text from the Work, provided
 that such additional attribution notices cannot be construed
 as modifying the License.

 You may add Your own copyright statement to Your modifications and
 may provide additional or different license terms and conditions
 for use, reproduction, or distribution of Your modifications, or
 for any such Derivative Works as a whole, provided Your use,
 reproduction, and distribution of the Work otherwise complies with
 the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
 any Contribution intentionally submitted for inclusion in the Work
 by You to the Licensor shall be under the terms and conditions of
 this License, without any additional terms or conditions.
 Notwithstanding the above, nothing herein shall supersede or modify
 the terms of any separate license agreement you may have executed
 with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
 names, trademarks, service marks, or product names of the Licensor,
 except as required for reasonable and customary use in describing the
 origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
 agreed to in writing, Licensor provides the Work (and each
 Contributor provides its Contributions) on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 implied, including, without limitation, any warranties or conditions
 of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
 PARTICULAR PURPOSE. You are solely responsible for determining the
 appropriateness of using or redistributing the Work and assume any
 risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
 whether in tort (including negligence), contract, or otherwise,
 unless required by applicable law (such as deliberate and grossly
 negligent acts) or agreed to in writing, shall any Contributor be
 liable to You for damages, including any direct, indirect, special,
 incidental, or consequential damages of any character arising as a
 result of this License or out of the use or inability to use the
 Work (including but not limited to damages for loss of goodwill,
 work stoppage, computer failure or malfunction, or any and all
 other commercial damages or losses), even if such Contributor
 has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
 the Work or Derivative Works thereof, You may choose to offer,
 and charge a fee for, acceptance of support, warranty, indemnity,
 or other liability obligations and/or rights consistent with this
 License. However, in accepting such obligations, You may act only
 on Your own behalf and on Your sole responsibility, not on behalf
 of any other Contributor, and only if You agree to indemnify,
 defend, and hold each Contributor harmless for any liability
 incurred by, or claims asserted against, such Contributor by reason
 of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

 To apply the Apache License to your work, attach the following
 boilerplate notice, with the fields enclosed by brackets "{}"
 replaced with your own identifying information. (Don't include
 the brackets!)  The text should be enclosed in the appropriate
 comment syntax for the file format. We also recommend that a
 file or class name and description of purpose be included on the
 same "printed page" as the copyright notice for easier
 identification within third-party archives.

 Copyright (C) 2013-present   SheetJS LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 */var q=Math;function we(s,e){for(var t=0,r=0;t<s.length;++t)r=e*r+s[t];return r}function Uf(s,e,t,r,n){if(e===0)return t;if(e===1)return r;for(var i=2/s,a=r,o=1;o<e;++o)a=r*o*i+n*t,t=r,r=a;return a}function Pf(s,e,t,r,n){return function(a,o){if(r){if(a===0)return r==1?-1/0:1/0;if(a<0)return NaN}if(o===0)return s(a);if(o===1)return e(a);if(o<0)return NaN;o|=0;var u=s(a),l=e(a);return Uf(a,o,u,l,n)}}var Vo=function(){var s=.636619772,e=[57568490574,-13362590354,6516196407e-1,-1121442418e-2,77392.33017,-184.9052456].reverse(),t=[57568490411,1029532985,9494680718e-3,59272.64853,267.8532712,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),n=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934935152e-16].reverse();function i(d){var f=0,p=0,N=0,g=d*d;if(d<8)p=we(e,g),N=we(t,g),f=p/N;else{var S=d-.785398164;g=64/g,p=we(r,g),N=we(n,g),f=q.sqrt(s/d)*(q.cos(S)*p-q.sin(S)*N*8/d)}return f}var a=[72362614232,-7895059235,2423968531e-1,-2972611439e-3,15704.4826,-30.16036606].reverse(),o=[144725228442,2300535178,1858330474e-2,99447.43394,376.9991397,1].reverse(),u=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function h(d){var f=0,p=0,N=0,g=d*d,S=q.abs(d)-2.356194491;return Math.abs(d)<8?(p=d*we(a,g),N=we(o,g),f=p/N):(g=64/g,p=we(u,g),N=we(l,g),f=q.sqrt(s/q.abs(d))*(q.cos(S)*p-q.sin(S)*N*8/q.abs(d)),d<0&&(f=-f)),f}return function d(f,p){if(p=Math.round(p),!isFinite(f))return isNaN(f)?f:0;if(p<0)return(p%2?-1:1)*d(f,-p);if(f<0)return(p%2?-1:1)*d(-f,p);if(p===0)return i(f);if(p===1)return h(f);if(f===0)return 0;var N=0;if(f>p)N=Uf(f,p,i(f),h(f),-1);else{for(var g=2*q.floor((p+q.floor(q.sqrt(40*p)))/2),S=!1,v=0,A=0,C=1,w=0,M=2/f,L=g;L>0;L--)w=L*M*C-v,v=C,C=w,q.abs(C)>1e10&&(C*=1e-10,v*=1e-10,N*=1e-10,A*=1e-10),S&&(A+=C),S=!S,L==p&&(N=v);A=2*A-C,N/=A}return N}}(),Ev=function(){var s=.636619772,e=[-2957821389,7062834065,-5123598036e-1,1087988129e-2,-86327.92757,228.4622733].reverse(),t=[40076544269,7452499648e-1,7189466438e-3,47447.2647,226.1030244,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),n=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934945152e-16].reverse();function i(d){var f=0,p=0,N=0,g=d*d,S=d-.785398164;return d<8?(p=we(e,g),N=we(t,g),f=p/N+s*Vo(d,0)*q.log(d)):(g=64/g,p=we(r,g),N=we(n,g),f=q.sqrt(s/d)*(q.sin(S)*p+q.cos(S)*N*8/d)),f}var a=[-4900604943e3,127527439e4,-51534381390,7349264551e-1,-4237922726e-3,8511.937935].reverse(),o=[249958057e5,424441966400,3733650367,2245904002e-2,102042.605,354.9632885,1].reverse(),u=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function h(d){var f=0,p=0,N=0,g=d*d,S=d-2.356194491;return d<8?(p=d*we(a,g),N=we(o,g),f=p/N+s*(Vo(d,1)*q.log(d)-1/d)):(g=64/g,p=we(u,g),N=we(l,g),f=q.sqrt(s/d)*(q.sin(S)*p+q.cos(S)*N*8/d)),f}return Pf(i,h,"BESSELY",1,-1)}(),Bo=function(){var s=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),e=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse();function t(a){return a<=3.75?we(s,a*a/(3.75*3.75)):q.exp(q.abs(a))/q.sqrt(q.abs(a))*we(e,3.75/q.abs(a))}var r=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),n=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse();function i(a){return a<3.75?a*we(r,a*a/(3.75*3.75)):(a<0?-1:1)*q.exp(q.abs(a))/q.sqrt(q.abs(a))*we(n,3.75/q.abs(a))}return function a(o,u){if(u=Math.round(u),u===0)return t(o);if(u===1)return i(o);if(u<0)return NaN;if(q.abs(o)===0)return 0;if(o==1/0)return 1/0;var l=0,h,d=2/q.abs(o),f=0,p=1,N=0,g=2*q.round((u+q.round(q.sqrt(40*u)))/2);for(h=g;h>0;h--)N=h*d*p+f,f=p,p=N,q.abs(p)>1e10&&(p*=1e-10,f*=1e-10,l*=1e-10),h==u&&(l=f);return l*=a(o,0)/p,o<0&&u%2?-l:l}}(),Rv=function(){var s=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),e=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();function t(a){return a<=2?-q.log(a/2)*Bo(a,0)+we(s,a*a/4):q.exp(-a)/q.sqrt(a)*we(e,2/a)}var r=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),n=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();function i(a){return a<=2?q.log(a/2)*Bo(a,1)+1/a*we(r,a*a/4):q.exp(-a)/q.sqrt(a)*we(n,2/a)}return Pf(t,i,"BESSELK",2,1)}();/**
 * @license
 Copyright (c) 2013 jStat

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 */function Qn(s){const e=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let t=e.length-1,r=!1,n=0,i=0,a,o,u,l;if(s===0)return 0;for(s<0&&(s=-s,r=!0),a=2/(2+s),o=4*a-2;t>0;t--)u=n,n=o*n-i+e[t],i=u;return l=a*Math.exp(-s*s+.5*(e[0]+o*n)-i),r?l-1:1-l}function Df(s){return 1-Qn(s)}function Vf(s){let e=0,t,r,n,i;if(s>=2)return-100;if(s<=0)return 100;for(i=s<1?s:2-s,n=Math.sqrt(-2*Math.log(i/2)),t=-.70711*((2.30753+n*.27061)/(1+n*(.99229+n*.04481))-n);e<2;e++)r=Df(t)-i,t+=r/(1.1283791670955126*Math.exp(-t*t)-t*r);return s<1?t:-t}const ic={pdf:(s,e)=>s<0?0:e*Math.exp(-e*s),cdf:(s,e)=>s<0?0:1-Math.exp(-e*s)};function Us(s){const e=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],t=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let r=!1,n=0,i=0,a=0,o=s,u,l,h,d;if(s>171.6243769536076)return 1/0;if(o<=0)if(d=o%1,d)r=(o&1?-1:1)*Math.PI/Math.sin(Math.PI*d),o=1-o;else return 1/0;for(h=o,o<1?l=o++:l=(o-=n=(o|0)-1)-1,u=0;u<8;++u)a=(a+e[u])*l,i=i*l+t[u];if(d=a/i+1,h<o)d/=h;else if(h>o)for(u=0;u<n;++u)d*=o,o++;return r&&(d=r/d),d}const eo={pdf:function(e,t,r){return e<0?0:e===0&&t===1?1/r:Math.exp((t-1)*Math.log(e)-e/r-et(t)-t*Math.log(r))},cdf:function(e,t,r){return e<0?0:Cu(t,e/r)},inv:function(s,e,t){return Bf(s,e)*t}};function et(s){let e=0;const t=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let r=1.000000000190015,n,i,a;for(a=(i=n=s)+5.5,a-=(n+.5)*Math.log(a);e<6;e++)r+=t[e]/++i;return Math.log(2.5066282746310007*r/n)-a}function Cu(s,e){const t=et(s);let r=s,n=1/s,i=n,a=e+1-s,o=1/1e-30,u=1/a,l=u,h=1;const d=-~(Math.log(s>=1?s:1/s)*8.5+s*.4+17);let f;if(e<0||s<=0)return NaN;if(e<s+1){for(;h<=d;h++)n+=i*=e/++r;return n*Math.exp(-e+s*Math.log(e)-t)}for(;h<=d;h++)f=-h*(h-s),a+=2,u=f*u+a,o=a+f/o,u=1/u,l*=u*o;return 1-l*Math.exp(-e+s*Math.log(e)-t)}function Bf(s,e){let t=0;const r=e-1,n=1e-8,i=et(e);let a,o,u,l,h,d,f;if(s>=1)return Math.max(100,e+100*Math.sqrt(e));if(s<=0)return 0;for(e>1?(d=Math.log(r),f=Math.exp(r*(d-1)-i),h=s<.5?s:1-s,u=Math.sqrt(-2*Math.log(h)),a=(2.30753+u*.27061)/(1+u*(.99229+u*.04481))-u,s<.5&&(a=-a),a=Math.max(.001,e*Math.pow(1-1/(9*e)-a/(3*Math.sqrt(e)),3))):(u=1-e*(.253+e*.12),s<u?a=Math.pow(s/u,1/e):a=1-Math.log(1-(s-u)/(1-u)));t<12;t++){if(a<=0)return 0;if(o=Cu(e,a)-s,e>1?u=f*Math.exp(-(a-r)+r*(Math.log(a)-d)):u=Math.exp(-a+r*Math.log(a)-i),l=o/u,a-=u=l/(1-.5*Math.min(1,l*((e-1)/a-1))),a<=0&&(a=.5*(a+u)),Math.abs(u)<n*a)break}return a}const ir={pdf:function(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(e-t,2)/(2*r*r))},cdf:function(e,t,r){return .5*(1+Qn((e-t)/Math.sqrt(2*r*r)))},inv:function(s,e,t){return-1.4142135623730951*t*Vf(2*s)+e}},to={pdf:function(e,t,r){return e>1||e<0?0:t==1&&r==1?1:t<512&&r<512?Math.pow(e,t-1)*Math.pow(1-e,r-1)/Iu(t,r):Math.exp((t-1)*Math.log(e)+(r-1)*Math.log(1-e)-kf(t,r))},cdf:function(e,t,r){return e>1||e<0?+(e>1):_a(e,t,r)},inv:function(e,t,r){return wu(e,t,r)}};function Iu(s,e){if(!(s<=0||e<=0))return s+e>170?Math.exp(kf(s,e)):Us(s)*Us(e)/Us(s+e)}function kf(s,e){return et(s)+et(e)-et(s+e)}function wu(s,e,t){var r=1e-8,n=e-1,i=t-1,a=0,o,u,l,h,d,f,p,N,g,S,v;if(s<=0)return 0;if(s>=1)return 1;for(e>=1&&t>=1?(l=s<.5?s:1-s,h=Math.sqrt(-2*Math.log(l)),p=(2.30753+h*.27061)/(1+h*(.99229+h*.04481))-h,s<.5&&(p=-p),N=(p*p-3)/6,g=2/(1/(2*e-1)+1/(2*t-1)),S=p*Math.sqrt(N+g)/g-(1/(2*t-1)-1/(2*e-1))*(N+5/6-2/(3*g)),p=e/(e+t*Math.exp(2*S))):(o=Math.log(e/(e+t)),u=Math.log(t/(e+t)),h=Math.exp(e*o)/e,d=Math.exp(t*u)/t,S=h+d,s<h/S?p=Math.pow(e*S*s,1/e):p=1-Math.pow(t*S*(1-s),1/t)),v=-et(e)-et(t)+et(e+t);a<10;a++){if(p===0||p===1)return p;if(f=_a(p,e,t)-s,h=Math.exp(n*Math.log(p)+i*Math.log(1-p)+v),d=f/h,p-=h=d/(1-.5*Math.min(1,d*(n/p-i/(1-p)))),p<=0&&(p=.5*(p+h)),p>=1&&(p=.5*(p+h+1)),Math.abs(h)<r*p&&a>0)break}return p}function _a(s,e,t){var r=s===0||s===1?0:Math.exp(et(e+t)-et(e)-et(t)+e*Math.log(s)+t*Math.log(1-s));return s<0||s>1?!1:s<(e+1)/(e+t+2)?r*ac(s,e,t)/e:1-r*ac(1-s,t,e)/t}function ac(s,e,t){var r=1e-30,n=1,i=e+t,a=e+1,o=e-1,u=1,l=1-i*s/a,h,d,f,p;for(Math.abs(l)<r&&(l=r),l=1/l,p=l;n<=100&&(h=2*n,d=n*(t-n)*s/((o+h)*(e+h)),l=1+d*l,Math.abs(l)<r&&(l=r),u=1+d/u,Math.abs(u)<r&&(u=r),l=1/l,p*=l*u,d=-(e+n)*(i+n)*s/((e+h)*(a+h)),l=1+d*l,Math.abs(l)<r&&(l=r),u=1+d/u,Math.abs(u)<r&&(u=r),l=1/l,f=l*u,p*=f,!(Math.abs(f-1)<3e-7));n++);return p}const Pi={pdf:function(s,e,t){return t===0||t===1?e*t===s?1:0:Gf(e,s)*Math.pow(t,s)*Math.pow(1-t,e-s)},cdf:function(s,e,t){var r,n=1e-10;if(s<0)return 0;if(s>=e)return 1;if(t<0||t>1||e<=0)return NaN;s=Math.floor(s);var i=t,a=s+1,o=e-s,u=a+o,l=Math.exp(et(u)-et(o)-et(a)+a*Math.log(i)+o*Math.log(1-i));return i<(a+1)/(u+2)?r=l*oc(i,a,o,n):r=1-l*oc(1-i,o,a,n),Math.round((1-r)*(1/n))/(1/n)}};function oc(s,e,t,r){for(var n=0,i=1,a=1,o=1,u=0,l=0,h;Math.abs((a-l)/a)>r;)l=a,h=-(e+u)*(e+t+u)*s/(e+2*u)/(e+2*u+1),n=a+h*n,i=o+h*i,u=u+1,h=u*(t-u)*s/(e+2*u-1)/(e+2*u),a=n+h*a,o=i+h*o,n=n/o,i=i/o,a=a/o,o=1;return a/e}function Gf(s,e){return s>170||e>170?Math.exp(Nv(s,e)):Di(s)/Di(e)/Di(s-e)}function Nv(s,e){return ro(s)-ro(e)-ro(s-e)}function ro(s){return s<0?NaN:et(s+1)}function Di(s){return s<0?NaN:Us(s+1)}const kn={pdf:function(e,t){return e<0?0:e===0&&t===2?.5:Math.exp((t/2-1)*Math.log(e)-e/2-t/2*Math.log(2)-et(t/2))},cdf:function(e,t){return e<0?0:Cu(t/2,e/2)},inv:function(s,e){return 2*Bf(s,.5*e)}},Gn={pdf:function(e,t,r){var n,i,a;return e<0?0:t<=2?e===0&&t<2?1/0:e===0&&t===2?1:1/Iu(t/2,r/2)*Math.pow(t/r,t/2)*Math.pow(e,t/2-1)*Math.pow(1+t/r*e,-(t+r)/2):(n=t*e/(r+e*t),i=r/(r+e*t),a=t*i/2,a*Pi.pdf((t-2)/2,(t+r-2)/2,n))},cdf:function(e,t,r){return e<0?0:_a(t*e/(t*e+r),t/2,r/2)},inv:function(e,t,r){return r/(t*(1/wu(e,t/2,r/2)-1))}},uc={pdf:function(e,t,r){return e<0||t<0||r<0?0:r/t*Math.pow(e/t,r-1)*Math.exp(-Math.pow(e/t,r))},cdf:function(e,t,r){return e<0?0:1-Math.exp(-Math.pow(e/t,r))}},ko={pdf:function(e,t){return t<0||e%1!==0||e<0?0:Math.pow(t,e)*Math.exp(-t)/Di(e)},cdf:function(e,t){var r=0;if(e<0)return 0;for(var n=0;r<=e;r++)n+=ko.pdf(r,t);return n}},Pr={pdf:function(e,t,r,n){if(e<0||e<r-(t-n))return 0;if(e>n||e>r)return 0;if(r*2>t)return n*2>t?Pr.pdf(t-r-n+e,t,t-r,t-n):Pr.pdf(n-e,t,t-r,n);if(n*2>t)return Pr.pdf(r-e,t,r,t-n);if(r<n)return Pr.pdf(e,t,n,r);for(var i=1,a=0,o=0;o<e;o++){for(;i>1&&a<n;)i*=1-r/(t-a),a++;i*=(n-o)*(r-o)/((o+1)*(t-r-n+o+1))}for(;a<n;a++)i*=1-r/(t-a);return Math.min(1,Math.max(0,i))},cdf:function s(e,t,r,n){if(e<0||e<r-(t-n))return 0;if(e>=n||e>=r)return 1;if(r*2>t)return n*2>t?s(t-r-n+e,t,t-r,t-n):1-Pr.cdf(n-e-1,t,t-r,n);if(n*2>t)return 1-Pr.cdf(r-e-1,t,r,t-n);if(r<n)return Pr.cdf(e,t,n,r);for(var i=1,a=1,o=0,u=0;u<e;u++){for(;i>1&&o<n;){var l=1-r/(t-o);a*=l,i*=l,o++}a*=(n-u)*(r-u)/((u+1)*(t-r-n+u+1)),i+=a}for(;o<n;o++)i*=1-r/(t-o);return Math.min(1,Math.max(0,i))}},qt={pdf:function(e,t){return t=t>1e100?1e100:t,1/(Math.sqrt(t)*Iu(.5,t/2))*Math.pow(1+e*e/t,-((t+1)/2))},cdf:function(e,t){var r=t/2;return _a((e+Math.sqrt(e*e+t))/(2*Math.sqrt(e*e+t)),r,r)},inv:function(s,e){var t=wu(2*Math.min(s,1-s),.5*e,.5);return t=Math.sqrt(e*(1-t)/t),s>.5?t:-t}},no={pdf:function(e,t,r){return e<=0?0:Math.exp(-Math.log(e)-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(Math.log(e)-t,2)/(2*r*r))},cdf:function(e,t,r){return e<0?0:.5+.5*Qn((Math.log(e)-t)/Math.sqrt(2*r*r))},inv:function(s,e,t){return Math.exp(-1.4142135623730951*t*Vf(2*s)+e)}},Go={pdf:function(e,t,r){return e!==e>>>0?!1:e<0?0:Gf(e+t-1,t-1)*Math.pow(1-r,e)*Math.pow(r,t)},cdf:function(e,t,r){var n=0,i=0;if(e<0)return 0;for(;i<=e;i++)n+=Go.pdf(i,t,r);return n}};function Hf(s){for(var e=0,t=s.length;--t>=0;)e+=s[t];return e}function Kt(s){return Hf(s)/s.length}function Rn(s){for(var e=Kt(s),t=0,r=s.length,n;--r>=0;)n=s[r]-e,t+=n*n;return t}function As(s,e){return Rn(s)/(s.length-(e?1:0))}function tn(s,e){return Math.sqrt(As(s,e))}function yv(){var s=[].slice.call(arguments),e=new Array(2),t;return s.length===4?t=Math.abs(ir.inv(s[1]/2,0,1)*s[2]/Math.sqrt(s[3])):t=Math.abs(ir.inv(s[1]/2,0,1)*tn(s[2])/Math.sqrt(s[2].length)),e[0]=s[0]-t,e[1]=s[0]+t,e}function Tv(){var s=[].slice.call(arguments),e=new Array(2),t;return s.length===4?t=Math.abs(qt.inv(s[1]/2,s[3]-1)*s[2]/Math.sqrt(s[3])):t=Math.abs(qt.inv(s[1]/2,s[2].length-1)*tn(s[2],!0)/Math.sqrt(s[2].length)),e[0]=s[0]-t,e[1]=s[0]+t,e}function vv(s){for(var e=1,t=s.length;--t>=0;)e*=s[t];return e}function Sv(s){return Math.pow(vv(s),1/s.length)}function Cs(s,e){var t=Kt(s),r=Kt(e),n=s.length,i=new Array(n),a;for(a=0;a<n;a++)i[a]=(s[a]-t)*(e[a]-r);return Hf(i)/(n-1)}function lc(s,e){return Cs(s,e)/tn(s,1)/tn(e,1)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Mu extends ${erf(e,t){return this.runFunction(e.args,t,this.metadata("ERF"),(r,n)=>n===void 0?Qn(r):Qn(n)-Qn(r))}erfc(e,t){return this.runFunction(e.args,t,this.metadata("ERFC"),Df)}expondist(e,t){return this.runFunction(e.args,t,this.metadata("EXPON.DIST"),(r,n,i)=>i?ic.cdf(r,n):ic.pdf(r,n))}fisher(e,t){return this.runFunction(e.args,t,this.metadata("FISHER"),r=>Math.log((1+r)/(1-r))/2)}fisherinv(e,t){return this.runFunction(e.args,t,this.metadata("FISHERINV"),r=>1-2/(Math.exp(2*r)+1))}gamma(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA"),Us)}gammadist(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.DIST"),(r,n,i,a)=>a?eo.cdf(r,n,i):eo.pdf(r,n,i))}gammaln(e,t){return this.runFunction(e.args,t,this.metadata("GAMMALN"),et)}gammainv(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.INV"),eo.inv)}gauss(e,t){return this.runFunction(e.args,t,this.metadata("GAUSS"),r=>ir.cdf(r,0,1)-.5)}betadist(e,t){return this.runFunction(e.args,t,this.metadata("BETA.DIST"),(r,n,i,a,o,u)=>r<=o?new m(E.NUM,y.ValueSmall):r>=u?new m(E.NUM,y.ValueLarge):(r=(r-o)/(u-o),a?to.cdf(r,n,i):to.pdf(r,n,i)))}betainv(e,t){return this.runFunction(e.args,t,this.metadata("BETA.INV"),(r,n,i,a,o)=>a>=o?new m(E.NUM,y.WrongOrder):to.inv(r,n,i)*(o-a)+a)}binomialdist(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.DIST"),(r,n,i,a)=>r>n?new m(E.NUM,y.WrongOrder):(r=Math.trunc(r),n=Math.trunc(n),a?Pi.cdf(r,n,i):Pi.pdf(r,n,i)))}binomialinv(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.INV"),(r,n,i)=>{r=Math.trunc(r);let a=-1,o=r;for(;o>a+1;){const u=Math.trunc((a+o)/2);Pi.cdf(u,r,n)>=i?o=u:a=u}return o})}besselifn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELI"),(r,n)=>Bo(r,Math.trunc(n)))}besseljfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELJ"),(r,n)=>Vo(r,Math.trunc(n)))}besselkfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELK"),(r,n)=>Rv(r,Math.trunc(n)))}besselyfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELY"),(r,n)=>Ev(r,Math.trunc(n)))}chisqdist(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST"),(r,n,i)=>(n=Math.trunc(n),i?kn.cdf(r,n):kn.pdf(r,n)))}chisqdistrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST.RT"),(r,n)=>1-kn.cdf(r,Math.trunc(n)))}chisqinv(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV"),(r,n)=>kn.inv(r,Math.trunc(n)))}chisqinvrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV.RT"),(r,n)=>kn.inv(1-r,Math.trunc(n)))}fdist(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST"),(r,n,i,a)=>(n=Math.trunc(n),i=Math.trunc(i),a?Gn.cdf(r,n,i):Gn.pdf(r,n,i)))}fdistrt(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST.RT"),(r,n,i)=>1-Gn.cdf(r,Math.trunc(n),Math.trunc(i)))}finv(e,t){return this.runFunction(e.args,t,this.metadata("F.INV"),(r,n,i)=>Gn.inv(r,Math.trunc(n),Math.trunc(i)))}finvrt(e,t){return this.runFunction(e.args,t,this.metadata("F.INV.RT"),(r,n,i)=>Gn.inv(1-r,Math.trunc(n),Math.trunc(i)))}weibulldist(e,t){return this.runFunction(e.args,t,this.metadata("WEIBULL.DIST"),(r,n,i,a)=>a?uc.cdf(r,i,n):uc.pdf(r,i,n))}poissondist(e,t){return this.runFunction(e.args,t,this.metadata("POISSON.DIST"),(r,n,i)=>(r=Math.trunc(r),i?ko.cdf(r,n):ko.pdf(r,n)))}hypgeomdist(e,t){return this.runFunction(e.args,t,this.metadata("HYPGEOM.DIST"),(r,n,i,a,o)=>r>n||r>i||n>a||i>a?new m(E.NUM,y.ValueLarge):r+a<i+n?new m(E.NUM,y.ValueLarge):(r=Math.trunc(r),n=Math.trunc(n),i=Math.trunc(i),a=Math.trunc(a),o?Pr.cdf(r,a,i,n):Pr.pdf(r,a,i,n)))}tdist(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST"),(r,n,i)=>(n=Math.trunc(n),i?qt.cdf(r,n):qt.pdf(r,n)))}tdist2t(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.2T"),(r,n)=>(1-qt.cdf(r,Math.trunc(n)))*2)}tdistrt(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.RT"),(r,n)=>1-qt.cdf(r,Math.trunc(n)))}tdistold(e,t){return this.runFunction(e.args,t,this.metadata("TDIST"),(r,n,i)=>i*(1-qt.cdf(r,Math.trunc(n))))}tinv(e,t){return this.runFunction(e.args,t,this.metadata("T.INV"),(r,n)=>qt.inv(r,Math.trunc(n)))}tinv2t(e,t){return this.runFunction(e.args,t,this.metadata("T.INV.2T"),(r,n)=>qt.inv(1-r/2,Math.trunc(n)))}lognormdist(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.DIST"),(r,n,i,a)=>a?no.cdf(r,n,i):no.pdf(r,n,i))}lognorminv(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.INV"),(r,n,i)=>no.inv(r,n,i))}normdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.DIST"),(r,n,i,a)=>a?ir.cdf(r,n,i):ir.pdf(r,n,i))}norminv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.INV"),(r,n,i)=>ir.inv(r,n,i))}normsdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.DIST"),(r,n)=>n?ir.cdf(r,0,1):ir.pdf(r,0,1))}normsinv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.INV"),r=>ir.inv(r,0,1))}phi(e,t){return this.runFunction(e.args,t,this.metadata("PHI"),r=>ir.pdf(r,0,1))}negbinomdist(e,t){return this.runFunction(e.args,t,this.metadata("NEGBINOM.DIST"),(r,n,i,a)=>(r=Math.trunc(r),n=Math.trunc(n),a?Go.cdf(r,n,i):Go.pdf(r,n,i)))}confidencenorm(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.NORM"),(r,n,i)=>yv(1,r,n,Math.trunc(i))[1]-1)}confidencet(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.T"),(r,n,i)=>(i=Math.trunc(i),i===1?new m(E.DIV_BY_ZERO):Tv(1,r,n,i)[1]-1))}standardize(e,t){return this.runFunction(e.args,t,this.metadata("STANDARDIZE"),(r,n,i)=>(r-n)/i)}}Mu.implementedFunctions={ERF:{method:"erf",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,optionalArg:!0}]},ERFC:{method:"erfc",parameters:[{argumentType:c.NUMBER}]},"EXPON.DIST":{method:"expondist",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.BOOLEAN}]},FISHER:{method:"fisher",parameters:[{argumentType:c.NUMBER,greaterThan:-1,lessThan:1}]},FISHERINV:{method:"fisherinv",parameters:[{argumentType:c.NUMBER}]},GAMMA:{method:"gamma",parameters:[{argumentType:c.NUMBER}]},"GAMMA.DIST":{method:"gammadist",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.BOOLEAN}]},GAMMALN:{method:"gammaln",parameters:[{argumentType:c.NUMBER,greaterThan:0}]},"GAMMA.INV":{method:"gammainv",parameters:[{argumentType:c.NUMBER,minValue:0,lessThan:1},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0}]},GAUSS:{method:"gauss",parameters:[{argumentType:c.NUMBER}]},"BETA.DIST":{method:"betadist",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.BOOLEAN},{argumentType:c.NUMBER,defaultValue:0},{argumentType:c.NUMBER,defaultValue:1}]},"BETA.INV":{method:"betainv",parameters:[{argumentType:c.NUMBER,greaterThan:0,maxValue:1},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,defaultValue:0},{argumentType:c.NUMBER,defaultValue:1}]},"BINOM.DIST":{method:"binomialdist",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0,maxValue:1},{argumentType:c.BOOLEAN}]},"BINOM.INV":{method:"binomialinv",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0,maxValue:1},{argumentType:c.NUMBER,greaterThan:0,lessThan:1}]},BESSELI:{method:"besselifn",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,minValue:0}]},BESSELJ:{method:"besseljfn",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,minValue:0}]},BESSELK:{method:"besselkfn",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,minValue:0}]},BESSELY:{method:"besselyfn",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,minValue:0}]},"CHISQ.DIST":{method:"chisqdist",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,minValue:1,maxValue:1e10},{argumentType:c.BOOLEAN}]},"CHISQ.DIST.RT":{method:"chisqdistrt",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV":{method:"chisqinv",parameters:[{argumentType:c.NUMBER,minValue:0,maxValue:1},{argumentType:c.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV.RT":{method:"chisqinvrt",parameters:[{argumentType:c.NUMBER,minValue:0,maxValue:1},{argumentType:c.NUMBER,minValue:1}]},"F.DIST":{method:"fdist",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:1},{argumentType:c.NUMBER,minValue:1},{argumentType:c.BOOLEAN}]},"F.DIST.RT":{method:"fdistrt",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:1},{argumentType:c.NUMBER,minValue:1}]},"F.INV":{method:"finv",parameters:[{argumentType:c.NUMBER,minValue:0,maxValue:1},{argumentType:c.NUMBER,minValue:1},{argumentType:c.NUMBER,minValue:1}]},"F.INV.RT":{method:"finvrt",parameters:[{argumentType:c.NUMBER,minValue:0,maxValue:1},{argumentType:c.NUMBER,minValue:1},{argumentType:c.NUMBER,minValue:1}]},"WEIBULL.DIST":{method:"weibulldist",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.BOOLEAN}]},"POISSON.DIST":{method:"poissondist",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0},{argumentType:c.BOOLEAN}]},"HYPGEOM.DIST":{method:"hypgeomdist",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.BOOLEAN}]},"T.DIST":{method:"tdist",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,minValue:1},{argumentType:c.BOOLEAN}]},"T.DIST.2T":{method:"tdist2t",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:1}]},"T.DIST.RT":{method:"tdistrt",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER,minValue:1}]},TDIST:{method:"tdistold",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:1},{argumentType:c.INTEGER,minValue:1,maxValue:2}]},"T.INV":{method:"tinv",parameters:[{argumentType:c.NUMBER,greaterThan:0,lessThan:1},{argumentType:c.NUMBER,minValue:1}]},"T.INV.2T":{method:"tinv2t",parameters:[{argumentType:c.NUMBER,greaterThan:0,maxValue:1},{argumentType:c.NUMBER,minValue:1}]},"LOGNORM.DIST":{method:"lognormdist",parameters:[{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.BOOLEAN}]},"LOGNORM.INV":{method:"lognorminv",parameters:[{argumentType:c.NUMBER,greaterThan:0,lessThan:1},{argumentType:c.NUMBER},{argumentType:c.NUMBER,greaterThan:0}]},"NORM.DIST":{method:"normdist",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.BOOLEAN}]},"NORM.INV":{method:"norminv",parameters:[{argumentType:c.NUMBER,greaterThan:0,lessThan:1},{argumentType:c.NUMBER},{argumentType:c.NUMBER,greaterThan:0}]},"NORM.S.DIST":{method:"normsdist",parameters:[{argumentType:c.NUMBER},{argumentType:c.BOOLEAN}]},"NORM.S.INV":{method:"normsinv",parameters:[{argumentType:c.NUMBER,greaterThan:0,lessThan:1}]},PHI:{method:"phi",parameters:[{argumentType:c.NUMBER}]},"NEGBINOM.DIST":{method:"negbinomdist",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:1},{argumentType:c.NUMBER,minValue:0,maxValue:1},{argumentType:c.BOOLEAN}]},"CONFIDENCE.NORM":{method:"confidencenorm",parameters:[{argumentType:c.NUMBER,greaterThan:0,lessThan:1},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,minValue:1}]},"CONFIDENCE.T":{method:"confidencet",parameters:[{argumentType:c.NUMBER,greaterThan:0,lessThan:1},{argumentType:c.NUMBER,greaterThan:0},{argumentType:c.NUMBER,minValue:1}]},STANDARDIZE:{method:"standardize",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER,greaterThan:0}]}};Mu.aliases={NEGBINOMDIST:"NEGBINOM.DIST",EXPONDIST:"EXPON.DIST",BETADIST:"BETA.DIST",NORMDIST:"NORM.DIST",NORMINV:"NORM.INV",NORMSDIST:"NORM.S.DIST",NORMSINV:"NORM.S.INV",LOGNORMDIST:"LOGNORM.DIST",LOGINV:"LOGNORM.INV",TINV:"T.INV.2T",HYPGEOMDIST:"HYPGEOM.DIST",POISSON:"POISSON.DIST",WEIBULL:"WEIBULL.DIST",FINV:"F.INV.RT",FDIST:"F.DIST.RT",CHIDIST:"CHISQ.DIST.RT",CHIINV:"CHISQ.INV.RT",GAMMADIST:"GAMMA.DIST","GAMMALN.PRECISE":"GAMMALN",GAMMAINV:"GAMMA.INV",BETAINV:"BETA.INV",BINOMDIST:"BINOM.DIST",CONFIDENCE:"CONFIDENCE.NORM",CRITBINOM:"BINOM.INV",WEIBULLDIST:"WEIBULL.DIST",TINV2T:"T.INV.2T",TDISTRT:"T.DIST.RT",TDIST2T:"T.DIST.2T",FINVRT:"F.INV.RT",FDISTRT:"F.DIST.RT",CHIDISTRT:"CHISQ.DIST.RT",CHIINVRT:"CHISQ.INV.RT",LOGNORMINV:"LOGNORM.INV",POISSONDIST:"POISSON.DIST"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Wf extends ${fact(e,t){return this.runFunction(e.args,t,this.metadata("FACT"),r=>{r=Math.trunc(r);let n=1;for(let i=1;i<=r;i++)n*=i;return n})}factdouble(e,t){return this.runFunction(e.args,t,this.metadata("FACTDOUBLE"),r=>{r=Math.trunc(r);let n=1;for(let i=r;i>=1;i-=2)n*=i;return n})}combin(e,t){return this.runFunction(e.args,t,this.metadata("COMBIN"),(r,n)=>n>r?new m(E.NUM,y.WrongOrder):(r=Math.trunc(r),n=Math.trunc(n),cc(r,n)))}combina(e,t){return this.runFunction(e.args,t,this.metadata("COMBINA"),(r,n)=>(r=Math.trunc(r),n=Math.trunc(n),r+n-1>=1030?new m(E.NUM,y.ValueLarge):r===0&&n===0?1:cc(r+n-1,n)))}gcd(e,t){return this.runFunction(e.args,t,this.metadata("GCD"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(r);if(n instanceof m)return n;let i=0;for(const a of n){if(a<0)return new m(E.NUM,y.ValueSmall);i=zf(i,Math.trunc(a))}return i>Number.MAX_SAFE_INTEGER?new m(E.NUM,y.ValueLarge):i})}lcm(e,t){return this.runFunction(e.args,t,this.metadata("LCM"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(r);if(n instanceof m)return n;let i=1;for(const a of n){if(a<0)return new m(E.NUM,y.ValueSmall);i=Av(i,Math.trunc(a))}return i>Number.MAX_SAFE_INTEGER?new m(E.NUM,y.ValueLarge):i})}mround(e,t){return this.runFunction(e.args,t,this.metadata("MROUND"),(r,n)=>n===0?0:r>0&&n<0||r<0&&n>0?new m(E.NUM,y.DistinctSigns):Math.round(r/n)*n)}multinomial(e,t){return this.runFunction(e.args,t,this.metadata("MULTINOMIAL"),(...r)=>{let n=0,i=1;for(let a of r){if(a<0)return new m(E.NUM,y.ValueSmall);a=Math.trunc(a);for(let o=1;o<=a;o++)i*=(n+o)/o;n+=a}return Math.round(i)})}quotient(e,t){return this.runFunction(e.args,t,this.metadata("QUOTIENT"),(r,n)=>n===0?new m(E.DIV_BY_ZERO):Math.trunc(r/n))}seriessum(e,t){return this.runFunction(e.args,t,this.metadata("SERIESSUM"),(r,n,i,a)=>{const o=this.arithmeticHelper.manyToOnlyNumbersDropNulls(a.valuesFromTopLeftCorner());if(o instanceof m)return o;let u=0;o.reverse();for(const l of o)u*=Math.pow(r,i),u+=l;return u*Math.pow(r,n)})}sign(e,t){return this.runFunction(e.args,t,this.metadata("SIGN"),r=>r>0?1:r<0?-1:0)}sumx2my2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2MY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new m(E.NA,y.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const h=i[l],d=a[l];if(h instanceof m)return h;if(d instanceof m)return d;typeof h=="number"&&typeof d=="number"&&(u+=Math.pow(h,2)-Math.pow(d,2))}return u})}sumx2py2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2PY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new m(E.NA,y.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const h=i[l],d=a[l];if(h instanceof m)return h;if(d instanceof m)return d;typeof h=="number"&&typeof d=="number"&&(u+=Math.pow(h,2)+Math.pow(d,2))}return u})}sumxmy2(e,t){return this.runFunction(e.args,t,this.metadata("SUMXMY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new m(E.NA,y.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const h=i[l],d=a[l];if(h instanceof m)return h;if(d instanceof m)return d;typeof h=="number"&&typeof d=="number"&&(u+=Math.pow(h-d,2))}return u})}}Wf.implementedFunctions={FACT:{method:"fact",parameters:[{argumentType:c.NUMBER,minValue:0,maxValue:170}]},FACTDOUBLE:{method:"factdouble",parameters:[{argumentType:c.NUMBER,minValue:0,maxValue:288}]},COMBIN:{method:"combin",parameters:[{argumentType:c.NUMBER,minValue:0,lessThan:1030},{argumentType:c.NUMBER,minValue:0}]},COMBINA:{method:"combina",parameters:[{argumentType:c.NUMBER,minValue:0},{argumentType:c.NUMBER,minValue:0}]},GCD:{method:"gcd",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},LCM:{method:"lcm",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},MROUND:{method:"mround",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER}]},MULTINOMIAL:{method:"multinomial",parameters:[{argumentType:c.NUMBER}],repeatLastArgs:1,expandRanges:!0},QUOTIENT:{method:"quotient",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER}]},SERIESSUM:{method:"seriessum",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.RANGE}]},SIGN:{method:"sign",parameters:[{argumentType:c.NUMBER}]},SUMX2MY2:{method:"sumx2my2",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]},SUMX2PY2:{method:"sumx2py2",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]},SUMXMY2:{method:"sumxmy2",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]}};function cc(s,e){2*e>s&&(e=s-e);let t=1;for(let r=1;r<=e;r++)t*=(s-e+r)/r;return Math.round(t)}function zf(s,e){for(s<e&&([s,e]=[e,s]);e>0;)[s,e]=[e,s%e];return s}function Av(s,e){return s===0||e===0?0:s*(e/zf(s,e))}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Yf extends ${complex(e,t){return this.runFunction(e.args,t,this.metadata("COMPLEX"),(r,n,i)=>i!=="i"&&i!=="j"?new m(E.VALUE,y.ShouldBeIorJ):xe([r,n],i))}imabs(e,t){return this.runFunction(e.args,t,this.metadata("IMABS"),Xf)}imaginary(e,t){return this.runFunction(e.args,t,this.metadata("IMAGINARY"),([r,n])=>n)}imreal(e,t){return this.runFunction(e.args,t,this.metadata("IMREAL"),([r,n])=>r)}imargument(e,t){return this.runFunction(e.args,t,this.metadata("IMARGUMENT"),([r,n])=>r===0&&n===0?new m(E.DIV_BY_ZERO):Math.atan2(n,r))}imconjugate(e,t){return this.runFunction(e.args,t,this.metadata("IMCONJUGATE"),([r,n])=>xe([r,-n]))}imcos(e,t){return this.runFunction(e.args,t,this.metadata("IMCOS"),r=>xe(Ti(r)))}imcosh(e,t){return this.runFunction(e.args,t,this.metadata("IMCOSH"),r=>xe(hc(r)))}imcot(e,t){return this.runFunction(e.args,t,this.metadata("IMCOT"),r=>xe(pn(Ti(r),vi(r))))}imcsc(e,t){return this.runFunction(e.args,t,this.metadata("IMCSC"),r=>xe(pn([1,0],vi(r))))}imcsch(e,t){return this.runFunction(e.args,t,this.metadata("IMCSCH"),r=>xe(pn([1,0],dc(r))))}imsec(e,t){return this.runFunction(e.args,t,this.metadata("IMSEC"),r=>xe(pn([1,0],Ti(r))))}imsech(e,t){return this.runFunction(e.args,t,this.metadata("IMSECH"),r=>xe(pn([1,0],hc(r))))}imsin(e,t){return this.runFunction(e.args,t,this.metadata("IMSIN"),r=>xe(vi(r)))}imsinh(e,t){return this.runFunction(e.args,t,this.metadata("IMSINH"),r=>xe(dc(r)))}imtan(e,t){return this.runFunction(e.args,t,this.metadata("IMTAN"),r=>xe(pn(vi(r),Ti(r))))}imdiv(e,t){return this.runFunction(e.args,t,this.metadata("IMDIV"),(r,n)=>xe(pn(r,n)))}improduct(e,t){return this.runFunction(e.args,t,this.metadata("IMPRODUCT"),(...r)=>{const n=this.arithmeticHelper.coerceComplexExactRanges(r);if(n instanceof m)return n;let i=[1,0];for(const a of n)i=jf(i,a);return xe(i)})}imsum(e,t){return this.runFunction(e.args,t,this.metadata("IMSUM"),(...r)=>{const n=this.arithmeticHelper.coerceComplexExactRanges(r);if(n instanceof m)return n;let i=[0,0];for(const a of n)i=Cv(i,a);return xe(i)})}imsub(e,t){return this.runFunction(e.args,t,this.metadata("IMSUB"),(r,n)=>xe(Iv(r,n)))}imexp(e,t){return this.runFunction(e.args,t,this.metadata("IMEXP"),r=>xe($f(r)))}imln(e,t){return this.runFunction(e.args,t,this.metadata("IMLN"),r=>xe(Vi(r)))}imlog10(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG10"),r=>{const[n,i]=Vi(r),a=Math.log(10);return xe([n/a,i/a])})}imlog2(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG2"),r=>{const[n,i]=Vi(r),a=Math.log(2);return xe([n/a,i/a])})}impower(e,t){return this.runFunction(e.args,t,this.metadata("IMPOWER"),(r,n)=>xe(fc(r,n)))}imsqrt(e,t){return this.runFunction(e.args,t,this.metadata("IMSQRT"),r=>xe(fc(r,.5)))}}Yf.implementedFunctions={COMPLEX:{method:"complex",parameters:[{argumentType:c.NUMBER},{argumentType:c.NUMBER},{argumentType:c.STRING,defaultValue:"i"}]},IMABS:{method:"imabs",parameters:[{argumentType:c.COMPLEX}]},IMAGINARY:{method:"imaginary",parameters:[{argumentType:c.COMPLEX}]},IMREAL:{method:"imreal",parameters:[{argumentType:c.COMPLEX}]},IMARGUMENT:{method:"imargument",parameters:[{argumentType:c.COMPLEX}]},IMCONJUGATE:{method:"imconjugate",parameters:[{argumentType:c.COMPLEX}]},IMCOS:{method:"imcos",parameters:[{argumentType:c.COMPLEX}]},IMCOSH:{method:"imcosh",parameters:[{argumentType:c.COMPLEX}]},IMCOT:{method:"imcot",parameters:[{argumentType:c.COMPLEX}]},IMCSC:{method:"imcsc",parameters:[{argumentType:c.COMPLEX}]},IMCSCH:{method:"imcsch",parameters:[{argumentType:c.COMPLEX}]},IMSEC:{method:"imsec",parameters:[{argumentType:c.COMPLEX}]},IMSECH:{method:"imsech",parameters:[{argumentType:c.COMPLEX}]},IMSIN:{method:"imsin",parameters:[{argumentType:c.COMPLEX}]},IMSINH:{method:"imsinh",parameters:[{argumentType:c.COMPLEX}]},IMTAN:{method:"imtan",parameters:[{argumentType:c.COMPLEX}]},IMDIV:{method:"imdiv",parameters:[{argumentType:c.COMPLEX},{argumentType:c.COMPLEX}]},IMPRODUCT:{method:"improduct",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},IMSUM:{method:"imsum",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},IMSUB:{method:"imsub",parameters:[{argumentType:c.COMPLEX},{argumentType:c.COMPLEX}]},IMEXP:{method:"imexp",parameters:[{argumentType:c.COMPLEX}]},IMLN:{method:"imln",parameters:[{argumentType:c.COMPLEX}]},IMLOG10:{method:"imlog10",parameters:[{argumentType:c.COMPLEX}]},IMLOG2:{method:"imlog2",parameters:[{argumentType:c.COMPLEX}]},IMPOWER:{method:"impower",parameters:[{argumentType:c.COMPLEX},{argumentType:c.NUMBER}]},IMSQRT:{method:"imsqrt",parameters:[{argumentType:c.COMPLEX}]}};function Cv([s,e],[t,r]){return[s+t,e+r]}function Iv([s,e],[t,r]){return[s-t,e-r]}function jf([s,e],[t,r]){return[s*t-e*r,s*r+t*e]}function pn([s,e],[t,r]){const n=Math.pow(t,2)+Math.pow(r,2),[i,a]=jf([s,e],[t,-r]);return[i/n,a/n]}function Ti([s,e]){return[Math.cos(s)*Math.cosh(e),-Math.sin(s)*Math.sinh(e)]}function hc([s,e]){return[Math.cosh(s)*Math.cos(e),Math.sinh(s)*Math.sin(e)]}function vi([s,e]){return[Math.sin(s)*Math.cosh(e),Math.cos(s)*Math.sinh(e)]}function dc([s,e]){return[Math.sinh(s)*Math.cos(e),Math.cosh(s)*Math.sin(e)]}function $f([s,e]){return[Math.exp(s)*Math.cos(e),Math.exp(s)*Math.sin(e)]}function Xf([s,e]){return Math.sqrt(s*s+e*e)}function Vi([s,e]){return[Math.log(Xf([s,e])),Math.atan2(e,s)]}function fc(s,e){const[t,r]=Vi(s);return $f([e*t,e*r])}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ou extends ${avedev(e,t){return this.runFunction(e.args,t,this.metadata("AVEDEV"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof m)return n;if(n.length===0)return new m(E.DIV_BY_ZERO);const i=Kt(n);return n.reduce((a,o)=>a+Math.abs(o-i),0)/n.length})}devsq(e,t){return this.runFunction(e.args,t,this.metadata("DEVSQ"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);return n instanceof m?n:n.length===0?0:Rn(n)})}geomean(e,t){return this.runFunction(e.args,t,this.metadata("GEOMEAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof m)return n;if(n.length===0)return new m(E.NUM,y.OneValue);for(const i of n)if(i<=0)return new m(E.NUM,y.ValueSmall);return Sv(n)})}harmean(e,t){return this.runFunction(e.args,t,this.metadata("HARMEAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof m)return n;if(n.length===0)return new m(E.NUM,y.OneValue);for(const i of n)if(i<=0)return new m(E.NUM,y.ValueSmall);return n.length/n.reduce((i,a)=>i+1/a,0)})}correl(e,t){return this.runFunction(e.args,t,this.metadata("CORREL"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new m(E.NA,y.EqualLength);const i=mn(r,n);return i instanceof m?i:i[0].length<=1?new m(E.DIV_BY_ZERO,y.TwoValues):lc(i[0],i[1])})}rsq(e,t){return this.runFunction(e.args,t,this.metadata("RSQ"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new m(E.NA,y.EqualLength);const i=mn(r,n);return i instanceof m?i:i[0].length<=1?new m(E.DIV_BY_ZERO,y.TwoValues):Math.pow(lc(i[0],i[1]),2)})}covariancep(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.P"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new m(E.NA,y.EqualLength);const i=mn(r,n);if(i instanceof m)return i;const a=i[0].length;return a<1?new m(E.DIV_BY_ZERO,y.OneValue):a===1?0:Cs(i[0],i[1])*(a-1)/a})}covariances(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.S"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new m(E.NA,y.EqualLength);const i=mn(r,n);return i instanceof m?i:i[0].length<=1?new m(E.DIV_BY_ZERO,y.TwoValues):Cs(i[0],i[1])})}ztest(e,t){return this.runFunction(e.args,t,this.metadata("Z.TEST"),(r,n,i)=>{const a=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());if(a instanceof m)return a;const o=a.length;if(i===void 0){if(o<2)return new m(E.DIV_BY_ZERO,y.TwoValues);i=tn(a,!0)}return o<1?new m(E.NA,y.OneValue):i===0?new m(E.DIV_BY_ZERO):1-ir.cdf((Kt(a)-n)/(i/Math.sqrt(o)),0,1)})}ftest(e,t){return this.runFunction(e.args,t,this.metadata("F.TEST"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner()),a=this.arithmeticHelper.manyToExactNumbers(n.valuesFromTopLeftCorner());if(i instanceof m)return i;if(a instanceof m)return a;if(i.length<=1||a.length<=1)return new m(E.DIV_BY_ZERO);const o=As(i,!0),u=As(a,!0);if(o===0||u===0)return new m(E.DIV_BY_ZERO);const l=o/u,h=Gn.cdf(l,i.length-1,a.length-1);return 2*Math.min(h,1-h)})}steyx(e,t){return this.runFunction(e.args,t,this.metadata("STEYX"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new m(E.NA,y.EqualLength);const i=mn(r,n);if(i instanceof m)return i;const a=i[0].length;return a<=2?new m(E.DIV_BY_ZERO,y.ThreeValues):Math.sqrt((Rn(i[0])-Math.pow(Cs(i[0],i[1])*(a-1),2)/Rn(i[1]))/(a-2))})}slope(e,t){return this.runFunction(e.args,t,this.metadata("SLOPE"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new m(E.NA,y.EqualLength);const i=mn(r,n);if(i instanceof m)return i;const a=i[0].length;return a<=1?new m(E.DIV_BY_ZERO,y.TwoValues):Cs(i[0],i[1])*(a-1)/Rn(i[1])})}chisqtest(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.TEST"),(r,n)=>{const i=r.height(),a=r.width();if(n.height()!==i||n.width()!==a)return new m(E.NA,y.EqualLength);const o=mn(r,n);if(o instanceof m)return o;if(o[0].length<=1)return new m(E.DIV_BY_ZERO,y.TwoValues);let u=0;for(let l=0;l<o[0].length;l++){if(o[1][l]===0)return new m(E.DIV_BY_ZERO);u+=Math.pow(o[0][l]-o[1][l],2)/o[1][l]}return u<0?new m(E.NUM,y.NaN):1-kn.cdf(u,i>1&&a>1?(i-1)*(a-1):i*a-1)})}ttest(e,t){return this.runFunction(e.args,t,this.metadata("T.TEST"),(r,n,i,a)=>{const o=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner()),u=this.arithmeticHelper.manyToExactNumbers(n.valuesFromTopLeftCorner());if(o instanceof m)return o;if(u instanceof m)return u;const l=o.length,h=u.length;if(a===1){if(h!==l)return new m(E.NA,y.EqualLength);if(l<=1)return new m(E.DIV_BY_ZERO,y.TwoValues);const d=Array(l);for(let N=0;N<l;N++)d[N]=o[N]-u[N];const f=tn(d,!0);if(f===0)return new m(E.DIV_BY_ZERO);const p=Math.abs(Math.sqrt(l)*Kt(d)/f);return i*(1-qt.cdf(p,l-1))}else if(a===2){if(l<=1||h<=1)return new m(E.DIV_BY_ZERO,y.TwoValues);const d=(Rn(o)+Rn(u))/(l+h-2);if(d===0)return new m(E.DIV_BY_ZERO);const f=Math.abs((Kt(o)-Kt(u))/Math.sqrt(d*(1/l+1/h)));return i*(1-qt.cdf(f,l+h-2))}else{if(l<=1||h<=1)return new m(E.DIV_BY_ZERO,y.TwoValues);const d=As(o,!0),f=As(u,!0);if(d===0&&f===0)return new m(E.DIV_BY_ZERO);const p=Math.abs((Kt(o)-Kt(u))/Math.sqrt(d/l+f/h)),N=Math.pow(d/l+f/h,2)/(Math.pow(d/l,2)/(l-1)+Math.pow(f/h,2)/(h-1));return i*(1-qt.cdf(p,N))}})}skew(e,t){return this.runFunction(e.args,t,this.metadata("SKEW"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof m)return n;const i=n.length;if(i<3)return new m(E.DIV_BY_ZERO,y.ThreeValues);const a=Kt(n),o=tn(n,!0);return o===0?new m(E.DIV_BY_ZERO):n.reduce((u,l)=>u+Math.pow((l-a)/o,3),0)*i/(i-1)/(i-2)})}skewp(e,t){return this.runFunction(e.args,t,this.metadata("SKEW.P"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof m)return n;const i=n.length;if(i<3)return new m(E.DIV_BY_ZERO,y.ThreeValues);const a=Kt(n),o=tn(n,!1);return o===0?new m(E.DIV_BY_ZERO):n.reduce((u,l)=>u+Math.pow((l-a)/o,3),0)/i})}}Ou.implementedFunctions={AVEDEV:{method:"avedev",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},DEVSQ:{method:"devsq",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},GEOMEAN:{method:"geomean",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},HARMEAN:{method:"harmean",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},CORREL:{method:"correl",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]},RSQ:{method:"rsq",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]},"COVARIANCE.P":{method:"covariancep",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]},"COVARIANCE.S":{method:"covariances",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]},"Z.TEST":{method:"ztest",parameters:[{argumentType:c.RANGE},{argumentType:c.NUMBER},{argumentType:c.NUMBER,optionalArg:!0}]},"F.TEST":{method:"ftest",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]},STEYX:{method:"steyx",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]},SLOPE:{method:"slope",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]},"CHISQ.TEST":{method:"chisqtest",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE}]},"T.TEST":{method:"ttest",parameters:[{argumentType:c.RANGE},{argumentType:c.RANGE},{argumentType:c.INTEGER,minValue:1,maxValue:2},{argumentType:c.INTEGER,minValue:1,maxValue:3}]},SKEW:{method:"skew",parameters:[{argumentType:c.ANY}],repeatLastArgs:1},"SKEW.P":{method:"skewp",parameters:[{argumentType:c.ANY}],repeatLastArgs:1}};Ou.aliases={COVAR:"COVARIANCE.P",FTEST:"F.TEST",PEARSON:"CORREL",ZTEST:"Z.TEST",CHITEST:"CHISQ.TEST",TTEST:"T.TEST",COVARIANCEP:"COVARIANCE.P",COVARIANCES:"COVARIANCE.S",SKEWP:"SKEW.P"};function mn(s,e){const t=s.iterateValuesFromTopLeftCorner(),r=e.iterateValuesFromTopLeftCorner();let n,i;const a=[],o=[];for(;n=t.next(),i=r.next(),!n.done&&!i.done;){const u=n.value,l=i.value;if(u instanceof m)return u;if(l instanceof m)return l;ue(u)&&ue(l)&&(a.push(b(u)),o.push(b(l)))}return[a,o]}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const pc=Object.freeze(Object.defineProperty({__proto__:null,AbsPlugin:$d,AddressPlugin:Yd,ArrayPlugin:jd,BitShiftPlugin:Xd,BitwiseLogicOperationsPlugin:Zd,BooleanPlugin:Jd,CharPlugin:ef,CodePlugin:tf,ComplexPlugin:Yf,ConditionalAggregationPlugin:Mf,CountBlankPlugin:rf,CountUniquePlugin:nf,DateTimePlugin:sf,DegreesPlugin:af,DeltaPlugin:of,ExpPlugin:uf,FinancialPlugin:lf,FormulaTextPlugin:cf,HyperlinkPlugin:hf,InformationPlugin:df,IsEvenPlugin:ff,IsOddPlugin:pf,LogarithmPlugin:mf,LookupPlugin:_f,MathConstantsPlugin:gf,MathPlugin:Wf,MatrixPlugin:Ef,MedianPlugin:Rf,ModuloPlugin:Nf,NumericAggregationPlugin:Su,PowerPlugin:yf,RadiansPlugin:Tf,RadixConversionPlugin:Sf,RandomPlugin:If,RomanPlugin:Lf,RoundingPlugin:Au,SimpleArithmerticPlugin:Ff,SqrtPlugin:wf,StatisticalAggregationPlugin:Ou,StatisticalPlugin:Mu,SumprodPlugin:Of,TextPlugin:bf,TrigonometryPlugin:xf},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ee extends rt{}ee.HyperFormula=rt;ee.ErrorType=E;ee.CellError=m;ee.CellType=vt;ee.CellValueType=ur;ee.CellValueDetailedType=oy;ee.DetailedCellError=Md;ee.ExportedCellChange=Lo;ee.ExportedNamedExpressionChange=kd;ee.ConfigValueTooBigError=gd;ee.ConfigValueTooSmallError=md;ee.EvaluationSuspendedError=Rd;ee.ExpectedOneOfValuesError=Ed;ee.ExpectedValueOfTypeError=oe;ee.ArraySize=X;ee.SimpleRangeValue=F;ee.EmptyValue=Z;ee.FunctionPlugin=$;ee.FunctionArgumentType=c;ee.FunctionPluginValidationError=es;ee.InvalidAddressError=ud;ee.InvalidArgumentsError=We;ee.LanguageNotRegisteredError=vo;ee.LanguageAlreadyRegisteredError=yd;ee.MissingTranslationError=Vn;ee.NamedExpressionDoesNotExistError=zs;ee.NamedExpressionNameIsAlreadyTakenError=ld;ee.NamedExpressionNameIsInvalidError=cd;ee.NoOperationToRedoError=dd;ee.NoOperationToUndoError=hd;ee.NoRelativeAddressesAllowedError=Ru;ee.NoSheetWithIdError=Oe;ee.NoSheetWithNameError=od;ee.NotAFormulaError=Li;ee.NothingToPasteError=fd;ee.ProtectedFunctionTranslationError=Nd;ee.SheetNameAlreadyTakenError=Hs;ee.SheetSizeLimitExceededError=vn;ee.SourceLocationHasArrayError=zn;ee.TargetLocationHasArrayError=ra;ee.UnableToParseError=pd;const wv=kt.defaultConfig.language;rt.registerLanguage(wv,Fo);rt.languages[Fo.langCode]=Fo;for(const s of Object.getOwnPropertyNames(pc))s.startsWith("_")||rt.registerFunctionPlugin(pc[s]);yg(bg);kc();const Mv=({hotRef:s,search:e,columns:t,rowData:r,colorData:n,colorTextData:i,afterSelection:a,handleAfterColumnResize:o})=>{const{theme:u}=Rg();I.useEffect(()=>{const p=s.current?.hotInstance;if(!p||!r)return;let N=!1;n&&n.forEach((g,S)=>{g&&g.forEach((v,A)=>{const C=p.getCellMeta(S,A).backgroundColor,w=v||void 0;C!==w&&(p.setCellMeta(S,A,"backgroundColor",w),N=!0)})}),i&&i.forEach((g,S)=>{g&&g.forEach((v,A)=>{const C=p.getCellMeta(S,A).color,w=v||void 0;C!==w&&(p.setCellMeta(S,A,"color",w),N=!0)})}),N&&p.render()},[r,n,i,s]);const l=[],h=I.useMemo(()=>{if(!t)return;const p=[];return t.forEach((N,g)=>{N.select&&l.push({value:g,text:N.title,label:N.title}),p.push({...N,title:N.title})}),p},[t]),d=I.useMemo(()=>h&&h.map((p,N)=>{const{readOnly:g,...S}=p;let v={...S,theme:u,isFirstColumn:h.indexOf(p)===0,data:N,colorData:n,colorTextData:i};return p.type==="numeric"?v={...v,type:"numeric",numericFormat:{pattern:"0,0"},originalRenderer:J.renderers.NumericRenderer}:p.type==="date"?v={...v,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:bv},originalRenderer:J.renderers.DateRenderer}:p.type==="checkbox"?v={...v,type:"checkbox",className:"htCenter",originalRenderer:J.renderers.CheckboxRenderer}:v.originalRenderer=J.renderers.TextRenderer,{...v,renderer:Ov}}),[h,r,u]),f=u==="dark"?"ht-theme-main-dark-auto":"ht-theme-main";return T.jsx("div",{className:"TwHotTable w-full",children:T.jsx(Ng,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:s,data:r,themeName:f,rowHeaders:!0,language:"ko-KR",colHeaders:t&&t.map(p=>p.title),autoWrapRow:!0,height:"auto",contextMenu:!0,search:e,observeChanges:!0,columnSorting:!0,afterSelection:a,formulas:{engine:rt.buildEmpty({licenseKey:"gpl-v3"})},columns:d,manualColumnResize:!0,afterColumnResize:o,colWidths:t.map(p=>p.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})})},Ov=(s,e,t,r,n,i,a)=>{a.originalRenderer?a.originalRenderer.apply(void 0,[s,e,t,r,n,i,a]):J.renderers.TextRenderer.apply(void 0,[s,e,t,r,n,i,a]);const o=s.getSettings().search,u=a.theme,l=s.getCellMeta(t,r),h=a.backgroundColor||l.backgroundColor,d=a.color||l.color,f=a.colorData,p=a.colorTextData;e.style.backgroundColor="",e.style.color="",o&&i&&String(i).toLowerCase().includes(o.toLowerCase())?(e.style.backgroundColor=u==="dark"?"#facc15":"yellow",e.style.color="black"):(e.style.backgroundColor=h,h||(t%2===0?e.style.backgroundColor=u==="dark"?"#101010":"#ffffff":e.style.backgroundColor=u==="dark"?"#000000":"#f8f8f8")),d&&(e.style.color=d),f?.[t]?.[r]&&(e.style.backgroundColor=f[t]?.[r]),p?.[t]?.[r]&&(e.style.color=p[t]?.[r])},bv={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(s,e){const t=s.getDate(),r=s.getMonth()+1;return`${s.getFullYear()}-${r.toString().padStart(2,"0")}-${t.toString().padStart(2,"0")}`},parse(s,e){const t=s.split("-");return new Date(t[0],t[1]-1,t[2])}};function xv(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return I.useMemo(()=>r=>{e.forEach(n=>n(r))},e)}const La=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function is(s){const e=Object.prototype.toString.call(s);return e==="[object Window]"||e==="[object global]"}function bu(s){return"nodeType"in s}function xt(s){var e,t;return s?is(s)?s:bu(s)&&(e=(t=s.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function xu(s){const{Document:e}=xt(s);return s instanceof e}function ni(s){return is(s)?!1:s instanceof xt(s).HTMLElement}function Kf(s){return s instanceof xt(s).SVGElement}function as(s){return s?is(s)?s.document:bu(s)?xu(s)?s:ni(s)||Kf(s)?s.ownerDocument:document:document:document}const Or=La?I.useLayoutEffect:I.useEffect;function _u(s){const e=I.useRef(s);return Or(()=>{e.current=s}),I.useCallback(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.current==null?void 0:e.current(...r)},[])}function _v(){const s=I.useRef(null),e=I.useCallback((r,n)=>{s.current=setInterval(r,n)},[]),t=I.useCallback(()=>{s.current!==null&&(clearInterval(s.current),s.current=null)},[]);return[e,t]}function Ks(s,e){e===void 0&&(e=[s]);const t=I.useRef(s);return Or(()=>{t.current!==s&&(t.current=s)},e),t}function si(s,e){const t=I.useRef();return I.useMemo(()=>{const r=s(t.current);return t.current=r,r},[...e])}function fa(s){const e=_u(s),t=I.useRef(null),r=I.useCallback(n=>{n!==t.current&&e?.(n,t.current),t.current=n},[]);return[t,r]}function Ho(s){const e=I.useRef();return I.useEffect(()=>{e.current=s},[s]),e.current}let so={};function ii(s,e){return I.useMemo(()=>{if(e)return e;const t=so[s]==null?0:so[s]+1;return so[s]=t,s+"-"+t},[s,e])}function qf(s){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce((i,a)=>{const o=Object.entries(a);for(const[u,l]of o){const h=i[u];h!=null&&(i[u]=h+s*l)}return i},{...e})}}const Zn=qf(1),pa=qf(-1);function Lv(s){return"clientX"in s&&"clientY"in s}function Lu(s){if(!s)return!1;const{KeyboardEvent:e}=xt(s.target);return e&&s instanceof e}function Fv(s){if(!s)return!1;const{TouchEvent:e}=xt(s.target);return e&&s instanceof e}function Wo(s){if(Fv(s)){if(s.touches&&s.touches.length){const{clientX:e,clientY:t}=s.touches[0];return{x:e,y:t}}else if(s.changedTouches&&s.changedTouches.length){const{clientX:e,clientY:t}=s.changedTouches[0];return{x:e,y:t}}}return Lv(s)?{x:s.clientX,y:s.clientY}:null}const rs=Object.freeze({Translate:{toString(s){if(!s)return;const{x:e,y:t}=s;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(s){if(!s)return;const{scaleX:e,scaleY:t}=s;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(s){if(s)return[rs.Translate.toString(s),rs.Scale.toString(s)].join(" ")}},Transition:{toString(s){let{property:e,duration:t,easing:r}=s;return e+" "+t+"ms "+r}}}),mc="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Uv(s){return s.matches(mc)?s:s.querySelector(mc)}const Pv={display:"none"};function Dv(s){let{id:e,value:t}=s;return Tt.createElement("div",{id:e,style:Pv},t)}function Vv(s){let{id:e,announcement:t,ariaLiveType:r="assertive"}=s;const n={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Tt.createElement("div",{id:e,style:n,role:"status","aria-live":r,"aria-atomic":!0},t)}function Bv(){const[s,e]=I.useState("");return{announce:I.useCallback(r=>{r!=null&&e(r)},[]),announcement:s}}const Qf=I.createContext(null);function kv(s){const e=I.useContext(Qf);I.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(s)},[s,e])}function Gv(){const[s]=I.useState(()=>new Set),e=I.useCallback(r=>(s.add(r),()=>s.delete(r)),[s]);return[I.useCallback(r=>{let{type:n,event:i}=r;s.forEach(a=>{var o;return(o=a[n])==null?void 0:o.call(a,i)})},[s]),e]}const Hv={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Wv={onDragStart(s){let{active:e}=s;return"Picked up draggable item "+e.id+"."},onDragOver(s){let{active:e,over:t}=s;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(s){let{active:e,over:t}=s;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(s){let{active:e}=s;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function zv(s){let{announcements:e=Wv,container:t,hiddenTextDescribedById:r,screenReaderInstructions:n=Hv}=s;const{announce:i,announcement:a}=Bv(),o=ii("DndLiveRegion"),[u,l]=I.useState(!1);if(I.useEffect(()=>{l(!0)},[]),kv(I.useMemo(()=>({onDragStart(d){let{active:f}=d;i(e.onDragStart({active:f}))},onDragMove(d){let{active:f,over:p}=d;e.onDragMove&&i(e.onDragMove({active:f,over:p}))},onDragOver(d){let{active:f,over:p}=d;i(e.onDragOver({active:f,over:p}))},onDragEnd(d){let{active:f,over:p}=d;i(e.onDragEnd({active:f,over:p}))},onDragCancel(d){let{active:f,over:p}=d;i(e.onDragCancel({active:f,over:p}))}}),[i,e])),!u)return null;const h=Tt.createElement(Tt.Fragment,null,Tt.createElement(Dv,{id:r,value:n.draggable}),Tt.createElement(Vv,{id:o,announcement:a}));return t?ys.createPortal(h,t):h}var $e;(function(s){s.DragStart="dragStart",s.DragMove="dragMove",s.DragEnd="dragEnd",s.DragCancel="dragCancel",s.DragOver="dragOver",s.RegisterDroppable="registerDroppable",s.SetDroppableDisabled="setDroppableDisabled",s.UnregisterDroppable="unregisterDroppable"})($e||($e={}));function ma(){}function GA(s,e){return I.useMemo(()=>({sensor:s,options:e??{}}),[s,e])}function HA(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return I.useMemo(()=>[...e].filter(r=>r!=null),[...e])}const hr=Object.freeze({x:0,y:0});function Yv(s,e){return Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2))}function jv(s,e){let{data:{value:t}}=s,{data:{value:r}}=e;return t-r}function $v(s,e){let{data:{value:t}}=s,{data:{value:r}}=e;return r-t}function Xv(s,e){if(!s||s.length===0)return null;const[t]=s;return t[e]}function gc(s,e,t){return e===void 0&&(e=s.left),t===void 0&&(t=s.top),{x:e+s.width*.5,y:t+s.height*.5}}const WA=s=>{let{collisionRect:e,droppableRects:t,droppableContainers:r}=s;const n=gc(e,e.left,e.top),i=[];for(const a of r){const{id:o}=a,u=t.get(o);if(u){const l=Yv(gc(u),n);i.push({id:o,data:{droppableContainer:a,value:l}})}}return i.sort(jv)};function Kv(s,e){const t=Math.max(e.top,s.top),r=Math.max(e.left,s.left),n=Math.min(e.left+e.width,s.left+s.width),i=Math.min(e.top+e.height,s.top+s.height),a=n-r,o=i-t;if(r<n&&t<i){const u=e.width*e.height,l=s.width*s.height,h=a*o,d=h/(u+l-h);return Number(d.toFixed(4))}return 0}const qv=s=>{let{collisionRect:e,droppableRects:t,droppableContainers:r}=s;const n=[];for(const i of r){const{id:a}=i,o=t.get(a);if(o){const u=Kv(o,e);u>0&&n.push({id:a,data:{droppableContainer:i,value:u}})}}return n.sort($v)};function Qv(s,e,t){return{...s,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function Zf(s,e){return s&&e?{x:s.left-e.left,y:s.top-e.top}:hr}function Zv(s){return function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n.reduce((a,o)=>({...a,top:a.top+s*o.y,bottom:a.bottom+s*o.y,left:a.left+s*o.x,right:a.right+s*o.x}),{...t})}}const Jv=Zv(1);function eS(s){if(s.startsWith("matrix3d(")){const e=s.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(s.startsWith("matrix(")){const e=s.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function tS(s,e,t){const r=eS(e);if(!r)return s;const{scaleX:n,scaleY:i,x:a,y:o}=r,u=s.left-a-(1-n)*parseFloat(t),l=s.top-o-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),h=n?s.width/n:s.width,d=i?s.height/i:s.height;return{width:h,height:d,top:l,right:u+h,bottom:l+d,left:u}}const rS={ignoreTransform:!1};function os(s,e){e===void 0&&(e=rS);let t=s.getBoundingClientRect();if(e.ignoreTransform){const{transform:l,transformOrigin:h}=xt(s).getComputedStyle(s);l&&(t=tS(t,l,h))}const{top:r,left:n,width:i,height:a,bottom:o,right:u}=t;return{top:r,left:n,width:i,height:a,bottom:o,right:u}}function Ec(s){return os(s,{ignoreTransform:!0})}function nS(s){const e=s.innerWidth,t=s.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function sS(s,e){return e===void 0&&(e=xt(s).getComputedStyle(s)),e.position==="fixed"}function iS(s,e){e===void 0&&(e=xt(s).getComputedStyle(s));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(n=>{const i=e[n];return typeof i=="string"?t.test(i):!1})}function Fu(s,e){const t=[];function r(n){if(e!=null&&t.length>=e||!n)return t;if(xu(n)&&n.scrollingElement!=null&&!t.includes(n.scrollingElement))return t.push(n.scrollingElement),t;if(!ni(n)||Kf(n)||t.includes(n))return t;const i=xt(s).getComputedStyle(n);return n!==s&&iS(n,i)&&t.push(n),sS(n,i)?t:r(n.parentNode)}return s?r(s):t}function Jf(s){const[e]=Fu(s,1);return e??null}function io(s){return!La||!s?null:is(s)?s:bu(s)?xu(s)||s===as(s).scrollingElement?window:ni(s)?s:null:null}function ep(s){return is(s)?s.scrollX:s.scrollLeft}function tp(s){return is(s)?s.scrollY:s.scrollTop}function zo(s){return{x:ep(s),y:tp(s)}}var Ze;(function(s){s[s.Forward=1]="Forward",s[s.Backward=-1]="Backward"})(Ze||(Ze={}));function rp(s){return!La||!s?!1:s===document.scrollingElement}function np(s){const e={x:0,y:0},t=rp(s)?{height:window.innerHeight,width:window.innerWidth}:{height:s.clientHeight,width:s.clientWidth},r={x:s.scrollWidth-t.width,y:s.scrollHeight-t.height},n=s.scrollTop<=e.y,i=s.scrollLeft<=e.x,a=s.scrollTop>=r.y,o=s.scrollLeft>=r.x;return{isTop:n,isLeft:i,isBottom:a,isRight:o,maxScroll:r,minScroll:e}}const aS={x:.2,y:.2};function oS(s,e,t,r,n){let{top:i,left:a,right:o,bottom:u}=t;r===void 0&&(r=10),n===void 0&&(n=aS);const{isTop:l,isBottom:h,isLeft:d,isRight:f}=np(s),p={x:0,y:0},N={x:0,y:0},g={height:e.height*n.y,width:e.width*n.x};return!l&&i<=e.top+g.height?(p.y=Ze.Backward,N.y=r*Math.abs((e.top+g.height-i)/g.height)):!h&&u>=e.bottom-g.height&&(p.y=Ze.Forward,N.y=r*Math.abs((e.bottom-g.height-u)/g.height)),!f&&o>=e.right-g.width?(p.x=Ze.Forward,N.x=r*Math.abs((e.right-g.width-o)/g.width)):!d&&a<=e.left+g.width&&(p.x=Ze.Backward,N.x=r*Math.abs((e.left+g.width-a)/g.width)),{direction:p,speed:N}}function uS(s){if(s===document.scrollingElement){const{innerWidth:i,innerHeight:a}=window;return{top:0,left:0,right:i,bottom:a,width:i,height:a}}const{top:e,left:t,right:r,bottom:n}=s.getBoundingClientRect();return{top:e,left:t,right:r,bottom:n,width:s.clientWidth,height:s.clientHeight}}function sp(s){return s.reduce((e,t)=>Zn(e,zo(t)),hr)}function lS(s){return s.reduce((e,t)=>e+ep(t),0)}function cS(s){return s.reduce((e,t)=>e+tp(t),0)}function hS(s,e){if(e===void 0&&(e=os),!s)return;const{top:t,left:r,bottom:n,right:i}=e(s);Jf(s)&&(n<=0||i<=0||t>=window.innerHeight||r>=window.innerWidth)&&s.scrollIntoView({block:"center",inline:"center"})}const dS=[["x",["left","right"],lS],["y",["top","bottom"],cS]];class Uu{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Fu(t),n=sp(r);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,a,o]of dS)for(const u of a)Object.defineProperty(this,u,{get:()=>{const l=o(r),h=n[i]-l;return this.rect[u]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ps{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...t)})},this.target=e}add(e,t,r){var n;(n=this.target)==null||n.addEventListener(e,t,r),this.listeners.push([e,t,r])}}function fS(s){const{EventTarget:e}=xt(s);return s instanceof e?s:as(s)}function ao(s,e){const t=Math.abs(s.x),r=Math.abs(s.y);return typeof e=="number"?Math.sqrt(t**2+r**2)>e:"x"in e&&"y"in e?t>e.x&&r>e.y:"x"in e?t>e.x:"y"in e?r>e.y:!1}var Qt;(function(s){s.Click="click",s.DragStart="dragstart",s.Keydown="keydown",s.ContextMenu="contextmenu",s.Resize="resize",s.SelectionChange="selectionchange",s.VisibilityChange="visibilitychange"})(Qt||(Qt={}));function Rc(s){s.preventDefault()}function pS(s){s.stopPropagation()}var de;(function(s){s.Space="Space",s.Down="ArrowDown",s.Right="ArrowRight",s.Left="ArrowLeft",s.Up="ArrowUp",s.Esc="Escape",s.Enter="Enter",s.Tab="Tab"})(de||(de={}));const ip={start:[de.Space,de.Enter],cancel:[de.Esc],end:[de.Space,de.Enter,de.Tab]},mS=(s,e)=>{let{currentCoordinates:t}=e;switch(s.code){case de.Right:return{...t,x:t.x+25};case de.Left:return{...t,x:t.x-25};case de.Down:return{...t,y:t.y+25};case de.Up:return{...t,y:t.y-25}}};class ap{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Ps(as(t)),this.windowListeners=new Ps(xt(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Qt.Resize,this.handleCancel),this.windowListeners.add(Qt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Qt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,r=e.node.current;r&&hS(r),t(hr)}handleKeyDown(e){if(Lu(e)){const{active:t,context:r,options:n}=this.props,{keyboardCodes:i=ip,coordinateGetter:a=mS,scrollBehavior:o="smooth"}=n,{code:u}=e;if(i.end.includes(u)){this.handleEnd(e);return}if(i.cancel.includes(u)){this.handleCancel(e);return}const{collisionRect:l}=r.current,h=l?{x:l.left,y:l.top}:hr;this.referenceCoordinates||(this.referenceCoordinates=h);const d=a(e,{active:t,context:r.current,currentCoordinates:h});if(d){const f=pa(d,h),p={x:0,y:0},{scrollableAncestors:N}=r.current;for(const g of N){const S=e.code,{isTop:v,isRight:A,isLeft:C,isBottom:w,maxScroll:M,minScroll:L}=np(g),_=uS(g),V={x:Math.min(S===de.Right?_.right-_.width/2:_.right,Math.max(S===de.Right?_.left:_.left+_.width/2,d.x)),y:Math.min(S===de.Down?_.bottom-_.height/2:_.bottom,Math.max(S===de.Down?_.top:_.top+_.height/2,d.y))},k=S===de.Right&&!A||S===de.Left&&!C,G=S===de.Down&&!w||S===de.Up&&!v;if(k&&V.x!==d.x){const U=g.scrollLeft+f.x,K=S===de.Right&&U<=M.x||S===de.Left&&U>=L.x;if(K&&!f.y){g.scrollTo({left:U,behavior:o});return}K?p.x=g.scrollLeft-U:p.x=S===de.Right?g.scrollLeft-M.x:g.scrollLeft-L.x,p.x&&g.scrollBy({left:-p.x,behavior:o});break}else if(G&&V.y!==d.y){const U=g.scrollTop+f.y,K=S===de.Down&&U<=M.y||S===de.Up&&U>=L.y;if(K&&!f.x){g.scrollTo({top:U,behavior:o});return}K?p.y=g.scrollTop-U:p.y=S===de.Down?g.scrollTop-M.y:g.scrollTop-L.y,p.y&&g.scrollBy({top:-p.y,behavior:o});break}}this.handleMove(e,Zn(pa(d,this.referenceCoordinates),p))}}}handleMove(e,t){const{onMove:r}=this.props;e.preventDefault(),r(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}ap.activators=[{eventName:"onKeyDown",handler:(s,e,t)=>{let{keyboardCodes:r=ip,onActivation:n}=e,{active:i}=t;const{code:a}=s.nativeEvent;if(r.start.includes(a)){const o=i.activatorNode.current;return o&&s.target!==o?!1:(s.preventDefault(),n?.({event:s.nativeEvent}),!0)}return!1}}];function Nc(s){return!!(s&&"distance"in s)}function yc(s){return!!(s&&"delay"in s)}class Pu{constructor(e,t,r){var n;r===void 0&&(r=fS(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:a}=i;this.props=e,this.events=t,this.document=as(a),this.documentListeners=new Ps(this.document),this.listeners=new Ps(r),this.windowListeners=new Ps(xt(a)),this.initialCoordinates=(n=Wo(i))!=null?n:hr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:r}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Qt.Resize,this.handleCancel),this.windowListeners.add(Qt.DragStart,Rc),this.windowListeners.add(Qt.VisibilityChange,this.handleCancel),this.windowListeners.add(Qt.ContextMenu,Rc),this.documentListeners.add(Qt.Keydown,this.handleKeydown),t){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(yc(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(Nc(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:r,onPending:n}=this.props;n(r,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Qt.Click,pS,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Qt.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:r,initialCoordinates:n,props:i}=this,{onMove:a,options:{activationConstraint:o}}=i;if(!n)return;const u=(t=Wo(e))!=null?t:hr,l=pa(n,u);if(!r&&o){if(Nc(o)){if(o.tolerance!=null&&ao(l,o.tolerance))return this.handleCancel();if(ao(l,o.distance))return this.handleStart()}if(yc(o)&&ao(l,o.tolerance))return this.handleCancel();this.handlePending(o,l);return}e.cancelable&&e.preventDefault(),a(u)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===de.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const gS={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class op extends Pu{constructor(e){const{event:t}=e,r=as(t.target);super(e,gS,r)}}op.activators=[{eventName:"onPointerDown",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:r}=e;return!t.isPrimary||t.button!==0?!1:(r?.({event:t}),!0)}}];const ES={move:{name:"mousemove"},end:{name:"mouseup"}};var Yo;(function(s){s[s.RightClick=2]="RightClick"})(Yo||(Yo={}));class RS extends Pu{constructor(e){super(e,ES,as(e.event.target))}}RS.activators=[{eventName:"onMouseDown",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:r}=e;return t.button===Yo.RightClick?!1:(r?.({event:t}),!0)}}];const oo={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class NS extends Pu{constructor(e){super(e,oo)}static setup(){return window.addEventListener(oo.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(oo.move.name,e)};function e(){}}}NS.activators=[{eventName:"onTouchStart",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:r}=e;const{touches:n}=t;return n.length>1?!1:(r?.({event:t}),!0)}}];var Ds;(function(s){s[s.Pointer=0]="Pointer",s[s.DraggableRect=1]="DraggableRect"})(Ds||(Ds={}));var ga;(function(s){s[s.TreeOrder=0]="TreeOrder",s[s.ReversedTreeOrder=1]="ReversedTreeOrder"})(ga||(ga={}));function yS(s){let{acceleration:e,activator:t=Ds.Pointer,canScroll:r,draggingRect:n,enabled:i,interval:a=5,order:o=ga.TreeOrder,pointerCoordinates:u,scrollableAncestors:l,scrollableAncestorRects:h,delta:d,threshold:f}=s;const p=vS({delta:d,disabled:!i}),[N,g]=_v(),S=I.useRef({x:0,y:0}),v=I.useRef({x:0,y:0}),A=I.useMemo(()=>{switch(t){case Ds.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case Ds.DraggableRect:return n}},[t,n,u]),C=I.useRef(null),w=I.useCallback(()=>{const L=C.current;if(!L)return;const _=S.current.x*v.current.x,V=S.current.y*v.current.y;L.scrollBy(_,V)},[]),M=I.useMemo(()=>o===ga.TreeOrder?[...l].reverse():l,[o,l]);I.useEffect(()=>{if(!i||!l.length||!A){g();return}for(const L of M){if(r?.(L)===!1)continue;const _=l.indexOf(L),V=h[_];if(!V)continue;const{direction:k,speed:G}=oS(L,V,A,e,f);for(const U of["x","y"])p[U][k[U]]||(G[U]=0,k[U]=0);if(G.x>0||G.y>0){g(),C.current=L,N(w,a),S.current=G,v.current=k;return}}S.current={x:0,y:0},v.current={x:0,y:0},g()},[e,w,r,g,i,a,JSON.stringify(A),JSON.stringify(p),N,l,M,h,JSON.stringify(f)])}const TS={x:{[Ze.Backward]:!1,[Ze.Forward]:!1},y:{[Ze.Backward]:!1,[Ze.Forward]:!1}};function vS(s){let{delta:e,disabled:t}=s;const r=Ho(e);return si(n=>{if(t||!r||!n)return TS;const i={x:Math.sign(e.x-r.x),y:Math.sign(e.y-r.y)};return{x:{[Ze.Backward]:n.x[Ze.Backward]||i.x===-1,[Ze.Forward]:n.x[Ze.Forward]||i.x===1},y:{[Ze.Backward]:n.y[Ze.Backward]||i.y===-1,[Ze.Forward]:n.y[Ze.Forward]||i.y===1}}},[t,e,r])}function SS(s,e){const t=e!=null?s.get(e):void 0,r=t?t.node.current:null;return si(n=>{var i;return e==null?null:(i=r??n)!=null?i:null},[r,e])}function AS(s,e){return I.useMemo(()=>s.reduce((t,r)=>{const{sensor:n}=r,i=n.activators.map(a=>({eventName:a.eventName,handler:e(a.handler,r)}));return[...t,...i]},[]),[s,e])}var qs;(function(s){s[s.Always=0]="Always",s[s.BeforeDragging=1]="BeforeDragging",s[s.WhileDragging=2]="WhileDragging"})(qs||(qs={}));var jo;(function(s){s.Optimized="optimized"})(jo||(jo={}));const Tc=new Map;function CS(s,e){let{dragging:t,dependencies:r,config:n}=e;const[i,a]=I.useState(null),{frequency:o,measure:u,strategy:l}=n,h=I.useRef(s),d=S(),f=Ks(d),p=I.useCallback(function(v){v===void 0&&(v=[]),!f.current&&a(A=>A===null?v:A.concat(v.filter(C=>!A.includes(C))))},[f]),N=I.useRef(null),g=si(v=>{if(d&&!t)return Tc;if(!v||v===Tc||h.current!==s||i!=null){const A=new Map;for(let C of s){if(!C)continue;if(i&&i.length>0&&!i.includes(C.id)&&C.rect.current){A.set(C.id,C.rect.current);continue}const w=C.node.current,M=w?new Uu(u(w),w):null;C.rect.current=M,M&&A.set(C.id,M)}return A}return v},[s,i,t,d,u]);return I.useEffect(()=>{h.current=s},[s]),I.useEffect(()=>{d||p()},[t,d]),I.useEffect(()=>{i&&i.length>0&&a(null)},[JSON.stringify(i)]),I.useEffect(()=>{d||typeof o!="number"||N.current!==null||(N.current=setTimeout(()=>{p(),N.current=null},o))},[o,d,p,...r]),{droppableRects:g,measureDroppableContainers:p,measuringScheduled:i!=null};function S(){switch(l){case qs.Always:return!1;case qs.BeforeDragging:return t;default:return!t}}}function up(s,e){return si(t=>s?t||(typeof e=="function"?e(s):s):null,[e,s])}function IS(s,e){return up(s,e)}function wS(s){let{callback:e,disabled:t}=s;const r=_u(e),n=I.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(r)},[r,t]);return I.useEffect(()=>()=>n?.disconnect(),[n]),n}function Fa(s){let{callback:e,disabled:t}=s;const r=_u(e),n=I.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(r)},[t]);return I.useEffect(()=>()=>n?.disconnect(),[n]),n}function MS(s){return new Uu(os(s),s)}function vc(s,e,t){e===void 0&&(e=MS);const[r,n]=I.useState(null);function i(){n(u=>{if(!s)return null;if(s.isConnected===!1){var l;return(l=u??t)!=null?l:null}const h=e(s);return JSON.stringify(u)===JSON.stringify(h)?u:h})}const a=wS({callback(u){if(s)for(const l of u){const{type:h,target:d}=l;if(h==="childList"&&d instanceof HTMLElement&&d.contains(s)){i();break}}}}),o=Fa({callback:i});return Or(()=>{i(),s?(o?.observe(s),a?.observe(document.body,{childList:!0,subtree:!0})):(o?.disconnect(),a?.disconnect())},[s]),r}function OS(s){const e=up(s);return Zf(s,e)}const Sc=[];function bS(s){const e=I.useRef(s),t=si(r=>s?r&&r!==Sc&&s&&e.current&&s.parentNode===e.current.parentNode?r:Fu(s):Sc,[s]);return I.useEffect(()=>{e.current=s},[s]),t}function xS(s){const[e,t]=I.useState(null),r=I.useRef(s),n=I.useCallback(i=>{const a=io(i.target);a&&t(o=>o?(o.set(a,zo(a)),new Map(o)):null)},[]);return I.useEffect(()=>{const i=r.current;if(s!==i){a(i);const o=s.map(u=>{const l=io(u);return l?(l.addEventListener("scroll",n,{passive:!0}),[l,zo(l)]):null}).filter(u=>u!=null);t(o.length?new Map(o):null),r.current=s}return()=>{a(s),a(i)};function a(o){o.forEach(u=>{const l=io(u);l?.removeEventListener("scroll",n)})}},[n,s]),I.useMemo(()=>s.length?e?Array.from(e.values()).reduce((i,a)=>Zn(i,a),hr):sp(s):hr,[s,e])}function Ac(s,e){e===void 0&&(e=[]);const t=I.useRef(null);return I.useEffect(()=>{t.current=null},e),I.useEffect(()=>{const r=s!==hr;r&&!t.current&&(t.current=s),!r&&t.current&&(t.current=null)},[s]),t.current?pa(s,t.current):hr}function _S(s){I.useEffect(()=>{if(!La)return;const e=s.map(t=>{let{sensor:r}=t;return r.setup==null?void 0:r.setup()});return()=>{for(const t of e)t?.()}},s.map(e=>{let{sensor:t}=e;return t}))}function LS(s,e){return I.useMemo(()=>s.reduce((t,r)=>{let{eventName:n,handler:i}=r;return t[n]=a=>{i(a,e)},t},{}),[s,e])}function lp(s){return I.useMemo(()=>s?nS(s):null,[s])}const Cc=[];function FS(s,e){e===void 0&&(e=os);const[t]=s,r=lp(t?xt(t):null),[n,i]=I.useState(Cc);function a(){i(()=>s.length?s.map(u=>rp(u)?r:new Uu(e(u),u)):Cc)}const o=Fa({callback:a});return Or(()=>{o?.disconnect(),a(),s.forEach(u=>o?.observe(u))},[s]),n}function US(s){if(!s)return null;if(s.children.length>1)return s;const e=s.children[0];return ni(e)?e:s}function PS(s){let{measure:e}=s;const[t,r]=I.useState(null),n=I.useCallback(l=>{for(const{target:h}of l)if(ni(h)){r(d=>{const f=e(h);return d?{...d,width:f.width,height:f.height}:f});break}},[e]),i=Fa({callback:n}),a=I.useCallback(l=>{const h=US(l);i?.disconnect(),h&&i?.observe(h),r(h?e(h):null)},[e,i]),[o,u]=fa(a);return I.useMemo(()=>({nodeRef:o,rect:t,setRef:u}),[t,o,u])}const DS=[{sensor:op,options:{}},{sensor:ap,options:{}}],VS={current:{}},Bi={draggable:{measure:Ec},droppable:{measure:Ec,strategy:qs.WhileDragging,frequency:jo.Optimized},dragOverlay:{measure:os}};class Vs extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,r;return(t=(r=this.get(e))==null?void 0:r.node.current)!=null?t:void 0}}const BS={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Vs,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:ma},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Bi,measureDroppableContainers:ma,windowRect:null,measuringScheduled:!1},kS={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:ma,draggableNodes:new Map,over:null,measureDroppableContainers:ma},Ua=I.createContext(kS),cp=I.createContext(BS);function GS(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Vs}}}function HS(s,e){switch(e.type){case $e.DragStart:return{...s,draggable:{...s.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case $e.DragMove:return s.draggable.active==null?s:{...s,draggable:{...s.draggable,translate:{x:e.coordinates.x-s.draggable.initialCoordinates.x,y:e.coordinates.y-s.draggable.initialCoordinates.y}}};case $e.DragEnd:case $e.DragCancel:return{...s,draggable:{...s.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case $e.RegisterDroppable:{const{element:t}=e,{id:r}=t,n=new Vs(s.droppable.containers);return n.set(r,t),{...s,droppable:{...s.droppable,containers:n}}}case $e.SetDroppableDisabled:{const{id:t,key:r,disabled:n}=e,i=s.droppable.containers.get(t);if(!i||r!==i.key)return s;const a=new Vs(s.droppable.containers);return a.set(t,{...i,disabled:n}),{...s,droppable:{...s.droppable,containers:a}}}case $e.UnregisterDroppable:{const{id:t,key:r}=e,n=s.droppable.containers.get(t);if(!n||r!==n.key)return s;const i=new Vs(s.droppable.containers);return i.delete(t),{...s,droppable:{...s.droppable,containers:i}}}default:return s}}function WS(s){let{disabled:e}=s;const{active:t,activatorEvent:r,draggableNodes:n}=I.useContext(Ua),i=Ho(r),a=Ho(t?.id);return I.useEffect(()=>{if(!e&&!r&&i&&a!=null){if(!Lu(i)||document.activeElement===i.target)return;const o=n.get(a);if(!o)return;const{activatorNode:u,node:l}=o;if(!u.current&&!l.current)return;requestAnimationFrame(()=>{for(const h of[u.current,l.current]){if(!h)continue;const d=Uv(h);if(d){d.focus();break}}})}},[r,e,n,a,i]),null}function zS(s,e){let{transform:t,...r}=e;return s!=null&&s.length?s.reduce((n,i)=>i({transform:n,...r}),t):t}function YS(s){return I.useMemo(()=>({draggable:{...Bi.draggable,...s?.draggable},droppable:{...Bi.droppable,...s?.droppable},dragOverlay:{...Bi.dragOverlay,...s?.dragOverlay}}),[s?.draggable,s?.droppable,s?.dragOverlay])}function jS(s){let{activeNode:e,measure:t,initialRect:r,config:n=!0}=s;const i=I.useRef(!1),{x:a,y:o}=typeof n=="boolean"?{x:n,y:n}:n;Or(()=>{if(!a&&!o||!e){i.current=!1;return}if(i.current||!r)return;const l=e?.node.current;if(!l||l.isConnected===!1)return;const h=t(l),d=Zf(h,r);if(a||(d.x=0),o||(d.y=0),i.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const f=Jf(l);f&&f.scrollBy({top:d.y,left:d.x})}},[e,a,o,r,t])}const hp=I.createContext({...hr,scaleX:1,scaleY:1});var Zr;(function(s){s[s.Uninitialized=0]="Uninitialized",s[s.Initializing=1]="Initializing",s[s.Initialized=2]="Initialized"})(Zr||(Zr={}));const zA=I.memo(function(e){var t,r,n,i;let{id:a,accessibility:o,autoScroll:u=!0,children:l,sensors:h=DS,collisionDetection:d=qv,measuring:f,modifiers:p,...N}=e;const g=I.useReducer(HS,void 0,GS),[S,v]=g,[A,C]=Gv(),[w,M]=I.useState(Zr.Uninitialized),L=w===Zr.Initialized,{draggable:{active:_,nodes:V,translate:k},droppable:{containers:G}}=S,U=_!=null?V.get(_):null,K=I.useRef({initial:null,translated:null}),z=I.useMemo(()=>{var ft;return _!=null?{id:_,data:(ft=U?.data)!=null?ft:VS,rect:K}:null},[_,U]),te=I.useRef(null),[le,Te]=I.useState(null),[Ee,Ue]=I.useState(null),re=Ks(N,Object.values(N)),Re=ii("DndDescribedBy",a),ve=I.useMemo(()=>G.getEnabled(),[G]),ne=YS(f),{droppableRects:Ae,measureDroppableContainers:ce,measuringScheduled:nt}=CS(ve,{dragging:L,dependencies:[k.x,k.y],config:ne.droppable}),ie=SS(V,_),zt=I.useMemo(()=>Ee?Wo(Ee):null,[Ee]),pe=Sp(),Pe=IS(ie,ne.draggable.measure);jS({activeNode:_!=null?V.get(_):null,config:pe.layoutShiftCompensation,initialRect:Pe,measure:ne.draggable.measure});const j=vc(ie,ne.draggable.measure,Pe),st=vc(ie?ie.parentElement:null),Ye=I.useRef({activatorEvent:null,active:null,activeNode:ie,collisionRect:null,collisions:null,droppableRects:Ae,draggableNodes:V,draggingNode:null,draggingNodeRect:null,droppableContainers:G,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),it=G.getNodeFor((t=Ye.current.over)==null?void 0:t.id),De=PS({measure:ne.dragOverlay.measure}),Me=(r=De.nodeRef.current)!=null?r:ie,yt=L?(n=De.rect)!=null?n:j:null,_t=!!(De.nodeRef.current&&De.rect),Et=OS(_t?null:j),Yt=lp(Me?xt(Me):null),me=bS(L?it??ie:null),Ve=FS(me),Q=zS(p,{transform:{x:k.x-Et.x,y:k.y-Et.y,scaleX:1,scaleY:1},activatorEvent:Ee,active:z,activeNodeRect:j,containerNodeRect:st,draggingNodeRect:yt,over:Ye.current.over,overlayNodeRect:De.rect,scrollableAncestors:me,scrollableAncestorRects:Ve,windowRect:Yt}),Ce=zt?Zn(zt,k):null,at=xS(me),zr=Ac(at),jt=Ac(at,[j]),Ke=Zn(Q,zr),bn=yt?Jv(yt,Q):null,us=z&&bn?d({active:z,collisionRect:bn,droppableRects:Ae,droppableContainers:ve,pointerCoordinates:Ce}):null,Vu=Xv(us,"id"),[Yr,Bu]=I.useState(null),Rp=_t?Q:Zn(Q,jt),Np=Qv(Rp,(i=Yr?.rect)!=null?i:null,j),Pa=I.useRef(null),ku=I.useCallback((ft,Lt)=>{let{sensor:Ft,options:jr}=Lt;if(te.current==null)return;const $t=V.get(te.current);if(!$t)return;const Ut=ft.nativeEvent,pr=new Ft({active:te.current,activeNode:$t,event:Ut,options:jr,context:Ye,onAbort(ot){if(!V.get(ot))return;const{onDragAbort:mr}=re.current,_r={id:ot};mr?.(_r),A({type:"onDragAbort",event:_r})},onPending(ot,$r,mr,_r){if(!V.get(ot))return;const{onDragPending:cs}=re.current,Xr={id:ot,constraint:$r,initialCoordinates:mr,offset:_r};cs?.(Xr),A({type:"onDragPending",event:Xr})},onStart(ot){const $r=te.current;if($r==null)return;const mr=V.get($r);if(!mr)return;const{onDragStart:_r}=re.current,ls={activatorEvent:Ut,active:{id:$r,data:mr.data,rect:K}};ys.unstable_batchedUpdates(()=>{_r?.(ls),M(Zr.Initializing),v({type:$e.DragStart,initialCoordinates:ot,active:$r}),A({type:"onDragStart",event:ls}),Te(Pa.current),Ue(Ut)})},onMove(ot){v({type:$e.DragMove,coordinates:ot})},onEnd:xn($e.DragEnd),onCancel:xn($e.DragCancel)});Pa.current=pr;function xn(ot){return async function(){const{active:mr,collisions:_r,over:ls,scrollAdjustedTranslate:cs}=Ye.current;let Xr=null;if(mr&&cs){const{cancelDrop:hs}=re.current;Xr={activatorEvent:Ut,active:mr,collisions:_r,delta:cs,over:ls},ot===$e.DragEnd&&typeof hs=="function"&&await Promise.resolve(hs(Xr))&&(ot=$e.DragCancel)}te.current=null,ys.unstable_batchedUpdates(()=>{v({type:ot}),M(Zr.Uninitialized),Bu(null),Te(null),Ue(null),Pa.current=null;const hs=ot===$e.DragEnd?"onDragEnd":"onDragCancel";if(Xr){const Da=re.current[hs];Da?.(Xr),A({type:hs,event:Xr})}})}}},[V]),yp=I.useCallback((ft,Lt)=>(Ft,jr)=>{const $t=Ft.nativeEvent,Ut=V.get(jr);if(te.current!==null||!Ut||$t.dndKit||$t.defaultPrevented)return;const pr={active:Ut};ft(Ft,Lt.options,pr)===!0&&($t.dndKit={capturedBy:Lt.sensor},te.current=jr,ku(Ft,Lt))},[V,ku]),Gu=AS(h,yp);_S(h),Or(()=>{j&&w===Zr.Initializing&&M(Zr.Initialized)},[j,w]),I.useEffect(()=>{const{onDragMove:ft}=re.current,{active:Lt,activatorEvent:Ft,collisions:jr,over:$t}=Ye.current;if(!Lt||!Ft)return;const Ut={active:Lt,activatorEvent:Ft,collisions:jr,delta:{x:Ke.x,y:Ke.y},over:$t};ys.unstable_batchedUpdates(()=>{ft?.(Ut),A({type:"onDragMove",event:Ut})})},[Ke.x,Ke.y]),I.useEffect(()=>{const{active:ft,activatorEvent:Lt,collisions:Ft,droppableContainers:jr,scrollAdjustedTranslate:$t}=Ye.current;if(!ft||te.current==null||!Lt||!$t)return;const{onDragOver:Ut}=re.current,pr=jr.get(Vu),xn=pr&&pr.rect.current?{id:pr.id,rect:pr.rect.current,data:pr.data,disabled:pr.disabled}:null,ot={active:ft,activatorEvent:Lt,collisions:Ft,delta:{x:$t.x,y:$t.y},over:xn};ys.unstable_batchedUpdates(()=>{Bu(xn),Ut?.(ot),A({type:"onDragOver",event:ot})})},[Vu]),Or(()=>{Ye.current={activatorEvent:Ee,active:z,activeNode:ie,collisionRect:bn,collisions:us,droppableRects:Ae,draggableNodes:V,draggingNode:Me,draggingNodeRect:yt,droppableContainers:G,over:Yr,scrollableAncestors:me,scrollAdjustedTranslate:Ke},K.current={initial:yt,translated:bn}},[z,ie,us,bn,V,Me,yt,Ae,G,Yr,me,Ke]),yS({...pe,delta:k,draggingRect:bn,pointerCoordinates:Ce,scrollableAncestors:me,scrollableAncestorRects:Ve});const Tp=I.useMemo(()=>({active:z,activeNode:ie,activeNodeRect:j,activatorEvent:Ee,collisions:us,containerNodeRect:st,dragOverlay:De,draggableNodes:V,droppableContainers:G,droppableRects:Ae,over:Yr,measureDroppableContainers:ce,scrollableAncestors:me,scrollableAncestorRects:Ve,measuringConfiguration:ne,measuringScheduled:nt,windowRect:Yt}),[z,ie,j,Ee,us,st,De,V,G,Ae,Yr,ce,me,Ve,ne,nt,Yt]),vp=I.useMemo(()=>({activatorEvent:Ee,activators:Gu,active:z,activeNodeRect:j,ariaDescribedById:{draggable:Re},dispatch:v,draggableNodes:V,over:Yr,measureDroppableContainers:ce}),[Ee,Gu,z,j,v,Re,V,Yr,ce]);return Tt.createElement(Qf.Provider,{value:C},Tt.createElement(Ua.Provider,{value:vp},Tt.createElement(cp.Provider,{value:Tp},Tt.createElement(hp.Provider,{value:Np},l)),Tt.createElement(WS,{disabled:o?.restoreFocus===!1})),Tt.createElement(zv,{...o,hiddenTextDescribedById:Re}));function Sp(){const ft=le?.autoScrollEnabled===!1,Lt=typeof u=="object"?u.enabled===!1:u===!1,Ft=L&&!ft&&!Lt;return typeof u=="object"?{...u,enabled:Ft}:{enabled:Ft}}}),$S=I.createContext(null),Ic="button",XS="Draggable";function KS(s){let{id:e,data:t,disabled:r=!1,attributes:n}=s;const i=ii(XS),{activators:a,activatorEvent:o,active:u,activeNodeRect:l,ariaDescribedById:h,draggableNodes:d,over:f}=I.useContext(Ua),{role:p=Ic,roleDescription:N="draggable",tabIndex:g=0}=n??{},S=u?.id===e,v=I.useContext(S?hp:$S),[A,C]=fa(),[w,M]=fa(),L=LS(a,e),_=Ks(t);Or(()=>(d.set(e,{id:e,key:i,node:A,activatorNode:w,data:_}),()=>{const k=d.get(e);k&&k.key===i&&d.delete(e)}),[d,e]);const V=I.useMemo(()=>({role:p,tabIndex:g,"aria-disabled":r,"aria-pressed":S&&p===Ic?!0:void 0,"aria-roledescription":N,"aria-describedby":h.draggable}),[r,p,g,S,N,h.draggable]);return{active:u,activatorEvent:o,activeNodeRect:l,attributes:V,isDragging:S,listeners:r?void 0:L,node:A,over:f,setNodeRef:C,setActivatorNodeRef:M,transform:v}}function qS(){return I.useContext(cp)}const QS="Droppable",ZS={timeout:25};function JS(s){let{data:e,disabled:t=!1,id:r,resizeObserverConfig:n}=s;const i=ii(QS),{active:a,dispatch:o,over:u,measureDroppableContainers:l}=I.useContext(Ua),h=I.useRef({disabled:t}),d=I.useRef(!1),f=I.useRef(null),p=I.useRef(null),{disabled:N,updateMeasurementsFor:g,timeout:S}={...ZS,...n},v=Ks(g??r),A=I.useCallback(()=>{if(!d.current){d.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{l(Array.isArray(v.current)?v.current:[v.current]),p.current=null},S)},[S]),C=Fa({callback:A,disabled:N||!a}),w=I.useCallback((V,k)=>{C&&(k&&(C.unobserve(k),d.current=!1),V&&C.observe(V))},[C]),[M,L]=fa(w),_=Ks(e);return I.useEffect(()=>{!C||!M.current||(C.disconnect(),d.current=!1,C.observe(M.current))},[M,C]),I.useEffect(()=>(o({type:$e.RegisterDroppable,element:{id:r,key:i,disabled:t,node:M,rect:f,data:_}}),()=>o({type:$e.UnregisterDroppable,key:i,id:r})),[r]),I.useEffect(()=>{t!==h.current.disabled&&(o({type:$e.SetDroppableDisabled,id:r,key:i,disabled:t}),h.current.disabled=t)},[r,i,t,o]),{active:a,rect:f,isOver:u?.id===r,node:M,over:u,setNodeRef:L}}function dp(s,e,t){const r=s.slice();return r.splice(t<0?r.length+t:t,0,r.splice(e,1)[0]),r}function eA(s,e){return s.reduce((t,r,n)=>{const i=e.get(r);return i&&(t[n]=i),t},Array(s.length))}function Si(s){return s!==null&&s>=0}function tA(s,e){if(s===e)return!0;if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0}function rA(s){return typeof s=="boolean"?{draggable:s,droppable:s}:s}const Ai={scaleX:1,scaleY:1},YA=s=>{var e;let{rects:t,activeNodeRect:r,activeIndex:n,overIndex:i,index:a}=s;const o=(e=t[n])!=null?e:r;if(!o)return null;const u=nA(t,a,n);if(a===n){const l=t[i];return l?{x:n<i?l.left+l.width-(o.left+o.width):l.left-o.left,y:0,...Ai}:null}return a>n&&a<=i?{x:-o.width-u,y:0,...Ai}:a<n&&a>=i?{x:o.width+u,y:0,...Ai}:{x:0,y:0,...Ai}};function nA(s,e,t){const r=s[e],n=s[e-1],i=s[e+1];return!r||!n&&!i?0:t<e?n?r.left-(n.left+n.width):i.left-(r.left+r.width):i?i.left-(r.left+r.width):r.left-(n.left+n.width)}const fp=s=>{let{rects:e,activeIndex:t,overIndex:r,index:n}=s;const i=dp(e,r,t),a=e[n],o=i[n];return!o||!a?null:{x:o.left-a.left,y:o.top-a.top,scaleX:o.width/a.width,scaleY:o.height/a.height}},Ci={scaleX:1,scaleY:1},jA=s=>{var e;let{activeIndex:t,activeNodeRect:r,index:n,rects:i,overIndex:a}=s;const o=(e=i[t])!=null?e:r;if(!o)return null;if(n===t){const l=i[a];return l?{x:0,y:t<a?l.top+l.height-(o.top+o.height):l.top-o.top,...Ci}:null}const u=sA(i,n,t);return n>t&&n<=a?{x:0,y:-o.height-u,...Ci}:n<t&&n>=a?{x:0,y:o.height+u,...Ci}:{x:0,y:0,...Ci}};function sA(s,e,t){const r=s[e],n=s[e-1],i=s[e+1];return r?t<e?n?r.top-(n.top+n.height):i?i.top-(r.top+r.height):0:i?i.top-(r.top+r.height):n?r.top-(n.top+n.height):0:0}const pp="Sortable",mp=Tt.createContext({activeIndex:-1,containerId:pp,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:fp,disabled:{draggable:!1,droppable:!1}});function $A(s){let{children:e,id:t,items:r,strategy:n=fp,disabled:i=!1}=s;const{active:a,dragOverlay:o,droppableRects:u,over:l,measureDroppableContainers:h}=qS(),d=ii(pp,t),f=o.rect!==null,p=I.useMemo(()=>r.map(L=>typeof L=="object"&&"id"in L?L.id:L),[r]),N=a!=null,g=a?p.indexOf(a.id):-1,S=l?p.indexOf(l.id):-1,v=I.useRef(p),A=!tA(p,v.current),C=S!==-1&&g===-1||A,w=rA(i);Or(()=>{A&&N&&h(p)},[A,p,N,h]),I.useEffect(()=>{v.current=p},[p]);const M=I.useMemo(()=>({activeIndex:g,containerId:d,disabled:w,disableTransforms:C,items:p,overIndex:S,useDragOverlay:f,sortedRects:eA(p,u),strategy:n}),[g,d,w.draggable,w.droppable,C,p,S,u,f,n]);return Tt.createElement(mp.Provider,{value:M},e)}const iA=s=>{let{id:e,items:t,activeIndex:r,overIndex:n}=s;return dp(t,r,n).indexOf(e)},aA=s=>{let{containerId:e,isSorting:t,wasDragging:r,index:n,items:i,newIndex:a,previousItems:o,previousContainerId:u,transition:l}=s;return!l||!r||o!==i&&n===a?!1:t?!0:a!==n&&e===u},oA={duration:200,easing:"ease"},gp="transform",uA=rs.Transition.toString({property:gp,duration:0,easing:"linear"}),lA={roleDescription:"sortable"};function cA(s){let{disabled:e,index:t,node:r,rect:n}=s;const[i,a]=I.useState(null),o=I.useRef(t);return Or(()=>{if(!e&&t!==o.current&&r.current){const u=n.current;if(u){const l=os(r.current,{ignoreTransform:!0}),h={x:u.left-l.left,y:u.top-l.top,scaleX:u.width/l.width,scaleY:u.height/l.height};(h.x||h.y)&&a(h)}}t!==o.current&&(o.current=t)},[e,t,r,n]),I.useEffect(()=>{i&&a(null)},[i]),i}function hA(s){let{animateLayoutChanges:e=aA,attributes:t,disabled:r,data:n,getNewIndex:i=iA,id:a,strategy:o,resizeObserverConfig:u,transition:l=oA}=s;const{items:h,containerId:d,activeIndex:f,disabled:p,disableTransforms:N,sortedRects:g,overIndex:S,useDragOverlay:v,strategy:A}=I.useContext(mp),C=dA(r,p),w=h.indexOf(a),M=I.useMemo(()=>({sortable:{containerId:d,index:w,items:h},...n}),[d,n,w,h]),L=I.useMemo(()=>h.slice(h.indexOf(a)),[h,a]),{rect:_,node:V,isOver:k,setNodeRef:G}=JS({id:a,data:M,disabled:C.droppable,resizeObserverConfig:{updateMeasurementsFor:L,...u}}),{active:U,activatorEvent:K,activeNodeRect:z,attributes:te,setNodeRef:le,listeners:Te,isDragging:Ee,over:Ue,setActivatorNodeRef:re,transform:Re}=KS({id:a,data:M,attributes:{...lA,...t},disabled:C.draggable}),ve=xv(G,le),ne=!!U,Ae=ne&&!N&&Si(f)&&Si(S),ce=!v&&Ee,nt=ce&&Ae?Re:null,zt=Ae?nt??(o??A)({rects:g,activeNodeRect:z,activeIndex:f,overIndex:S,index:w}):null,pe=Si(f)&&Si(S)?i({id:a,items:h,activeIndex:f,overIndex:S}):w,Pe=U?.id,j=I.useRef({activeId:Pe,items:h,newIndex:pe,containerId:d}),st=h!==j.current.items,Ye=e({active:U,containerId:d,isDragging:Ee,isSorting:ne,id:a,index:w,items:h,newIndex:j.current.newIndex,previousItems:j.current.items,previousContainerId:j.current.containerId,transition:l,wasDragging:j.current.activeId!=null}),it=cA({disabled:!Ye,index:w,node:V,rect:_});return I.useEffect(()=>{ne&&j.current.newIndex!==pe&&(j.current.newIndex=pe),d!==j.current.containerId&&(j.current.containerId=d),h!==j.current.items&&(j.current.items=h)},[ne,pe,d,h]),I.useEffect(()=>{if(Pe===j.current.activeId)return;if(Pe!=null&&j.current.activeId==null){j.current.activeId=Pe;return}const Me=setTimeout(()=>{j.current.activeId=Pe},50);return()=>clearTimeout(Me)},[Pe]),{active:U,activeIndex:f,attributes:te,data:M,rect:_,index:w,newIndex:pe,items:h,isOver:k,isSorting:ne,isDragging:Ee,listeners:Te,node:V,overIndex:S,over:Ue,setNodeRef:ve,setActivatorNodeRef:re,setDroppableNodeRef:G,setDraggableNodeRef:le,transform:it??zt,transition:De()};function De(){if(it||st&&j.current.newIndex===w)return uA;if(!(ce&&!Lu(K)||!l)&&(ne||Ye))return rs.Transition.toString({...l,property:gp})}}function dA(s,e){var t,r;return typeof s=="boolean"?{draggable:s,droppable:!1}:{draggable:(t=s?.draggable)!=null?t:e.draggable,droppable:(r=s?.droppable)!=null?r:e.droppable}}de.Down,de.Right,de.Up,de.Left;var fs={},ps={},wc;function fA(){if(wc)return ps;wc=1,Object.defineProperty(ps,"__esModule",{value:!0}),ps.PopoverPortal=void 0;var s=on(),e=Tg(),t=function(r){var n=r.container,i=r.element,a=r.scoutElement,o=r.children;return(0,s.useLayoutEffect)(function(){return n.appendChild(i),n.appendChild(a),function(){n.removeChild(i),n.removeChild(a)}},[n,i,a]),(0,e.createPortal)(o,i)};return ps.PopoverPortal=t,ps}var ms={},Mc;function Du(){return Mc||(Mc=1,function(s){var e=ms&&ms.__assign||function(){return e=Object.assign||function(u){for(var l,h=1,d=arguments.length;h<d;h++){l=arguments[h];for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(u[f]=l[f])}return u},e.apply(this,arguments)};Object.defineProperty(s,"__esModule",{value:!0}),s.getNudgedPopoverRect=s.getNewPopoverRect=s.popoverRectForPosition=s.createContainer=s.rectsAreEqual=s.createRect=s.EMPTY_RECT=void 0,s.EMPTY_RECT={top:0,left:0,right:0,bottom:0,width:0,height:0};var t=function(u){var l=u.top,h=u.left,d=u.width,f=u.height;return{top:l,left:h,width:d,height:f,right:h+d,bottom:l+f}};s.createRect=t;var r=function(u,l){return u===l||u?.bottom===l?.bottom&&u?.height===l?.height&&u?.left===l?.left&&u?.right===l?.right&&u?.top===l?.top&&u?.width===l?.width};s.rectsAreEqual=r;var n=function(u){var l=u.containerStyle,h=u.containerClassName,d=window.document.createElement("div");return h&&(d.className=h),Object.assign(d.style,l),d};s.createContainer=n;var i=function(u,l,h,d,f){var p=l.left+l.width/2,N=l.top+l.height/2,g=h.width,S=h.height,v,A;switch(u){case"left":v=N-S/2,A=l.left-d-g,f==="start"&&(v=l.top),f==="end"&&(v=l.bottom-S);break;case"bottom":v=l.bottom+d,A=p-g/2,f==="start"&&(A=l.left),f==="end"&&(A=l.right-g);break;case"right":v=N-S/2,A=l.right+d,f==="start"&&(v=l.top),f==="end"&&(v=l.bottom-S);break;default:v=l.top-S-d,A=p-g/2,f==="start"&&(A=l.left),f==="end"&&(A=l.right-g);break}return(0,s.createRect)({left:A,top:v,width:g,height:S})};s.popoverRectForPosition=i;var a=function(u,l){var h=u.position,d=u.align,f=u.childRect,p=u.popoverRect,N=u.boundaryRect,g=u.padding,S=u.reposition,v=(0,s.popoverRectForPosition)(h,f,p,g,d),A=S&&(h==="top"&&v.top<N.top+l||h==="left"&&v.left<N.left+l||h==="right"&&v.right>N.right-l||h==="bottom"&&v.bottom>N.bottom-l);return{rect:v,boundaryViolation:A}};s.getNewPopoverRect=a;var o=function(u,l,h){var d=l.top+h,f=l.left+h,p=l.right-h,N=l.bottom-h,g=u.top<d?d:u.top;g=g+u.height>N?N-u.height:g;var S=u.left<f?f:u.left;return S=S+u.width>p?p-u.width:S,(0,s.createRect)(e(e({},u),{top:g,left:S}))};s.getNudgedPopoverRect=o}(ms)),ms}var gs={},Es={},Oc;function pA(){if(Oc)return Es;Oc=1,Object.defineProperty(Es,"__esModule",{value:!0}),Es.useElementRef=void 0;var s=on(),e=Du(),t=function(r){var n=r.containerClassName,i=r.containerStyle,a=(0,s.useRef)(),o=(0,s.useState)(function(){return(0,e.createContainer)({containerStyle:i,containerClassName:n})})[0];return(0,s.useLayoutEffect)(function(){o.className=n},[n,o]),(0,s.useLayoutEffect)(function(){Object.assign(o.style,i)},[i,o]),a.current=o,a};return Es.useElementRef=t,Es}var bc;function mA(){if(bc)return gs;bc=1,Object.defineProperty(gs,"__esModule",{value:!0}),gs.usePopover=void 0;var s=on(),e=Du(),t=pA(),r={position:"fixed",overflow:"visible",top:"0px",left:"0px"},n={position:"fixed",top:"0px",left:"0px",width:"0px",height:"0px",visibility:"hidden"},i=function(a){var o=a.isOpen,u=a.childRef,l=a.positions,h=a.containerClassName,d=a.parentElement,f=a.transform,p=a.transformMode,N=a.align,g=a.padding,S=a.reposition,v=a.boundaryInset,A=a.boundaryElement,C=a.onPositionPopover,w=(0,t.useElementRef)({containerClassName:"react-tiny-popover-scout",containerStyle:n}),M=(0,t.useElementRef)({containerClassName:h!=null&&h.length>0&&h!=="react-tiny-popover-container"?"react-tiny-popover-container ".concat(h):"react-tiny-popover-container",containerStyle:r}),L=(0,s.useCallback)(function(_){var V,k,G=_===void 0?{}:_,U=G.positionIndex,K=U===void 0?0:U,z=G.parentRect,te=z===void 0?d.getBoundingClientRect():z,le=G.childRect,Te=le===void 0?(V=u?.current)===null||V===void 0?void 0:V.getBoundingClientRect():le,Ee=G.scoutRect,Ue=Ee===void 0?(k=w?.current)===null||k===void 0?void 0:k.getBoundingClientRect():Ee,re=G.popoverRect,Re=re===void 0?M.current.getBoundingClientRect():re,ve=G.boundaryRect,ne=ve===void 0?A===d?te:A.getBoundingClientRect():ve;if(!(!Te||!te||!o)){if(f&&p==="absolute"){var Ae=typeof f=="function"?f({childRect:Te,popoverRect:Re,parentRect:te,boundaryRect:ne,padding:g,align:N,nudgedTop:0,nudgedLeft:0,boundaryInset:v,violations:e.EMPTY_RECT,hasViolations:!1}):f,ce=Ae.top,nt=Ae.left,ie=Math.round(te.left+nt-Ue.left),zt=Math.round(te.top+ce-Ue.top);M.current.style.transform="translate(".concat(ie,"px, ").concat(zt,"px)"),C({childRect:Te,popoverRect:(0,e.createRect)({left:ie,top:zt,width:Re.width,height:Re.height}),parentRect:te,boundaryRect:ne,padding:g,align:N,transform:{top:ce,left:nt},nudgedTop:0,nudgedLeft:0,boundaryInset:v,violations:e.EMPTY_RECT,hasViolations:!1});return}var pe=K===l.length,Pe=pe?l[0]:l[K],j=(0,e.getNewPopoverRect)({childRect:Te,popoverRect:Re,boundaryRect:ne,position:Pe,align:N,padding:g,reposition:S},v),st=j.rect,Ye=j.boundaryViolation;if(Ye&&S&&!pe){L({positionIndex:K+1,childRect:Te,popoverRect:Re,parentRect:te,boundaryRect:ne});return}var it=st.top,De=st.left,Me=st.width,yt=st.height,_t=S&&!pe,Et=(0,e.getNudgedPopoverRect)(st,ne,v),Yt=Et.left,me=Et.top,Ve=it,Q=De;_t&&(Ve=me,Q=Yt),Ve=Math.round(Ve-Ue.top),Q=Math.round(Q-Ue.left),M.current.style.transform="translate(".concat(Q,"px, ").concat(Ve,"px)");var Ce={top:ne.top+v-Ve,left:ne.left+v-Q,right:Q+Me-ne.right+v,bottom:Ve+yt-ne.bottom+v},at={childRect:Te,popoverRect:(0,e.createRect)({left:Q,top:Ve,width:Me,height:yt}),parentRect:te,boundaryRect:ne,position:Pe,align:N,padding:g,nudgedTop:me-it,nudgedLeft:Yt-De,boundaryInset:v,violations:{top:Ce.top<=0?0:Ce.top,left:Ce.left<=0?0:Ce.left,right:Ce.right<=0?0:Ce.right,bottom:Ce.bottom<=0?0:Ce.bottom},hasViolations:Ce.top>0||Ce.left>0||Ce.right>0||Ce.bottom>0};if(f){C(at);var zr=typeof f=="function"?f(at):f,jt=zr.top,Ke=zr.left;M.current.style.transform="translate(".concat(Math.round(Q+(Ke??0)),"px, ").concat(Math.round(Ve+(jt??0)),"px)"),at.nudgedLeft+=Ke??0,at.nudgedTop+=jt??0,at.transform={top:jt,left:Ke}}C(at)}},[d,u,w,M,A,o,f,p,l,N,g,S,v,C]);return{positionPopover:L,popoverRef:M,scoutRef:w}};return gs.usePopover=i,gs}var Rs={},xc;function gA(){if(xc)return Rs;xc=1,Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.useMemoizedArray=void 0;var s=on(),e=function(t){var r=(0,s.useRef)(t),n=(0,s.useMemo)(function(){if(r.current===t)return r.current;if(r.current.length!==t.length)return r.current=t,t;for(var i=0;i<t.length;i+=1)if(t[i]!==r.current[i])return r.current=t,t;return r.current},[t]);return n};return Rs.useMemoizedArray=e,Rs}var Ns={},_c;function EA(){if(_c)return Ns;_c=1,Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.useHandlePrevValues=void 0;var s=on(),e=function(t){var r=(0,s.useRef)(t.positions),n=(0,s.useRef)(t.reposition),i=(0,s.useRef)(t.transformMode),a=(0,s.useRef)(t.transform),o=(0,s.useRef)(t.boundaryElement),u=(0,s.useRef)(t.boundaryInset),l=(0,s.useCallback)(function(){r.current=t.positions,n.current=t.reposition,i.current=t.transformMode,a.current=t.transform,o.current=t.boundaryElement,u.current=t.boundaryInset},[t.boundaryElement,t.boundaryInset,t.positions,t.reposition,t.transform,t.transformMode]);return{prev:{positions:r.current,reposition:n.current,transformMode:i.current,transform:a.current,boundaryElement:o.current,boundaryInset:u.current},updatePrevValues:l}};return Ns.useHandlePrevValues=e,Ns}var gn={},Lc;function Ep(){if(Lc)return gn;Lc=1;var s=gn&&gn.__assign||function(){return s=Object.assign||function(r){for(var n,i=1,a=arguments.length;i<a;i++){n=arguments[i];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},s.apply(this,arguments)};Object.defineProperty(gn,"__esModule",{value:!0}),gn.useArrowContainer=void 0;var e=on(),t=function(r){var n=r.childRect,i=r.popoverRect,a=r.position,o=r.arrowSize,u=r.arrowColor,l=(0,e.useMemo)(function(){return{padding:o}},[o]),h=(0,e.useMemo)(function(){return s({position:"absolute"},function(){var d=o*2,f=n.top-i.top+n.height/2-d/2,p=n.left-i.left+n.width/2-d/2,N=o,g=i.width-o,S=i.height-o;switch(p=p<N?N:p,p=p+d>g?g-d:p,f=f<N?N:f,f=f+d>S?S-d:f,f=Number.isNaN(f)?0:f,p=Number.isNaN(p)?0:p,a){case"right":return{borderTop:"".concat(o,"px solid transparent"),borderBottom:"".concat(o,"px solid transparent"),borderRight:"".concat(o,"px solid ").concat(u),left:0,top:f};case"left":return{borderTop:"".concat(o,"px solid transparent"),borderBottom:"".concat(o,"px solid transparent"),borderLeft:"".concat(o,"px solid ").concat(u),right:0,top:f};case"bottom":return{borderLeft:"".concat(o,"px solid transparent"),borderRight:"".concat(o,"px solid transparent"),borderBottom:"".concat(o,"px solid ").concat(u),top:0,left:p};case"top":return{borderLeft:"".concat(o,"px solid transparent"),borderRight:"".concat(o,"px solid transparent"),borderTop:"".concat(o,"px solid ").concat(u),bottom:0,left:p};default:return{display:"hidden"}}}())},[u,o,n.height,n.left,n.top,n.width,i.height,i.left,i.top,i.width,a]);return{arrowContainerStyle:l,arrowStyle:h}};return gn.useArrowContainer=t,gn}var En={},Fc;function RA(){if(Fc)return En;Fc=1;var s=En&&En.__assign||function(){return s=Object.assign||function(i){for(var a,o=1,u=arguments.length;o<u;o++){a=arguments[o];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(i[l]=a[l])}return i},s.apply(this,arguments)};Object.defineProperty(En,"__esModule",{value:!0}),En.ArrowContainer=void 0;var e=jc(),t=on(),r=Ep(),n=function(i){var a=i.childRect,o=i.popoverRect,u=i.position,l=i.arrowColor,h=i.arrowSize,d=i.arrowClassName,f=i.arrowStyle,p=i.className,N=i.children,g=i.style,S=(0,r.useArrowContainer)({childRect:a,popoverRect:o,position:u,arrowColor:l,arrowSize:h}),v=S.arrowContainerStyle,A=S.arrowStyle,C=(0,t.useMemo)(function(){return s(s({},v),g)},[v,g]),w=(0,t.useMemo)(function(){return s(s({},A),f)},[A,f]);return(0,e.jsxs)("div",{className:p,style:C,children:[(0,e.jsx)("div",{style:w,className:d}),N]})};return En.ArrowContainer=n,En}var Uc;function NA(){return Uc||(Uc=1,function(s){var e=fs&&fs.__assign||function(){return e=Object.assign||function(p){for(var N,g=1,S=arguments.length;g<S;g++){N=arguments[g];for(var v in N)Object.prototype.hasOwnProperty.call(N,v)&&(p[v]=N[v])}return p},e.apply(this,arguments)};Object.defineProperty(s,"__esModule",{value:!0}),s.Popover=s.usePopover=s.ArrowContainer=s.useArrowContainer=void 0;var t=jc(),r=on(),n=fA(),i=Du(),a=mA();Object.defineProperty(s,"usePopover",{enumerable:!0,get:function(){return a.usePopover}});var o=gA(),u=EA(),l=Ep();Object.defineProperty(s,"useArrowContainer",{enumerable:!0,get:function(){return l.useArrowContainer}});var h=RA();Object.defineProperty(s,"ArrowContainer",{enumerable:!0,get:function(){return h.ArrowContainer}});var d=["top","left","right","bottom"],f=(0,r.forwardRef)(function(p,N){var g=p.isOpen,S=p.children,v=p.content,A=p.positions,C=A===void 0?d:A,w=p.align,M=w===void 0?"center":w,L=p.padding,_=L===void 0?0:L,V=p.reposition,k=V===void 0?!0:V,G=p.parentElement,U=G===void 0?window.document.body:G,K=p.boundaryElement,z=K===void 0?U:K,te=p.containerClassName,le=p.containerStyle,Te=p.transform,Ee=p.transformMode,Ue=Ee===void 0?"absolute":Ee,re=p.boundaryInset,Re=re===void 0?0:re,ve=p.onClickOutside,ne=p.clickOutsideCapture,Ae=ne===void 0?!1:ne,ce=(0,o.useMemoizedArray)(Array.isArray(C)?C:[C]),nt=(0,u.useHandlePrevValues)({positions:ce,reposition:k,transformMode:Ue,transform:Te,boundaryElement:z,boundaryInset:Re}),ie=nt.prev,zt=nt.updatePrevValues,pe=(0,r.useRef)(),Pe=(0,r.useState)({align:M,nudgedLeft:0,nudgedTop:0,position:ce[0],padding:_,childRect:i.EMPTY_RECT,popoverRect:i.EMPTY_RECT,parentRect:i.EMPTY_RECT,boundaryRect:i.EMPTY_RECT,boundaryInset:Re,violations:i.EMPTY_RECT,hasViolations:!1}),j=Pe[0],st=Pe[1],Ye=(0,r.useCallback)(function(Q){return st(Q)},[]),it=(0,a.usePopover)({isOpen:g,childRef:pe,containerClassName:te,parentElement:U,boundaryElement:z,transform:Te,transformMode:Ue,positions:ce,align:M,padding:_,boundaryInset:Re,reposition:k,onPositionPopover:Ye}),De=it.positionPopover,Me=it.popoverRef,yt=it.scoutRef;(0,r.useLayoutEffect)(function(){var Q=!0,Ce=function(){var at,zr;if(g&&Q){var jt=(at=pe?.current)===null||at===void 0?void 0:at.getBoundingClientRect(),Ke=(zr=Me?.current)===null||zr===void 0?void 0:zr.getBoundingClientRect();jt!=null&&Ke!=null&&(!(0,i.rectsAreEqual)(jt,j.childRect)||Ke.width!==j.popoverRect.width||Ke.height!==j.popoverRect.height||j.padding!==_||j.align!==M||ce!==ie.positions||k!==ie.reposition||Ue!==ie.transformMode||Te!==ie.transform||z!==ie.boundaryElement||Re!==ie.boundaryInset)&&De(),zt(),Q&&window.requestAnimationFrame(Ce)}};return Ce(),function(){Q=!1}},[M,z,Re,g,_,Me,j.align,j.childRect,j.padding,j.popoverRect.height,j.popoverRect.width,De,ce,ie.boundaryElement,ie.boundaryInset,ie.positions,ie.reposition,ie.transform,ie.transformMode,k,Te,Ue,zt]),(0,r.useEffect)(function(){var Q=Me.current;return Object.assign(Q.style,le),function(){Object.keys(le??{}).forEach(function(Ce){return delete Q.style[Ce]})}},[le,g,Me]);var _t=(0,r.useCallback)(function(Q){var Ce,at;g&&!(!((Ce=Me.current)===null||Ce===void 0)&&Ce.contains(Q.target))&&!(!((at=pe.current)===null||at===void 0)&&at.contains(Q.target))&&ve?.(Q)},[g,ve,Me]),Et=(0,r.useCallback)(function(){pe.current&&g&&window.requestAnimationFrame(function(){return De()})},[De,g]);(0,r.useEffect)(function(){var Q=U.ownerDocument.body;return Q.addEventListener("click",_t,Ae),Q.addEventListener("contextmenu",_t,Ae),window.addEventListener("resize",Et),function(){Q.removeEventListener("click",_t,Ae),Q.removeEventListener("contextmenu",_t,Ae),window.removeEventListener("resize",Et)}},[Ae,_t,Et,U]);var Yt=(0,r.useCallback)(function(Q){pe.current=Q,N!=null&&(typeof N=="object"?N.current=Q:typeof N=="function"&&N(Q))},[N]),me=function(){return(0,r.cloneElement)(S,{ref:Yt})},Ve=function(){return g?(0,t.jsx)(n.PopoverPortal,{element:Me.current,scoutElement:yt.current,container:U,children:typeof v=="function"?v(j):v}):null};return(0,t.jsxs)(t.Fragment,{children:[me(),Ve()]})});s.Popover=(0,r.forwardRef)(function(p,N){return typeof window>"u"?p.children:(0,t.jsx)(f,e({},p,{ref:N}))})}(fs)),fs}var yA=NA();const ut="작업메뉴",TA=({isOpen:s,onClose:e,children:t,id:r,block:n,onUpdateBlock:i,onStyleChange:a,onDelete:o,onDuplicate:u,onResetWidth:l,selection:h})=>{const{t:d}=vg(),[f,p]=I.useState(ut),[N,g]=I.useState(!1),S=(A,C)=>{if(console.log("handleHotColorClick=",A,C,h),!h)return;const{row:w,col:M,row2:L,col2:_}=h,V=Math.min(w,L),k=Math.max(w,L),G=Math.min(M,_),U=Math.max(M,_),K=C==="bg"?"colorData":"colorTextData",z=n.content[K]?JSON.parse(JSON.stringify(n.content[K])):[];for(let te=V;te<=k;te++){z[te]||(z[te]=[]);for(let le=G;le<=U;le++)z[te][le]=A}i(r,{content:{...n.content,[K]:z}})},v=()=>{if(console.log("handleHotColorReset.selection=",h),!h)return;const{row:A,col:C,row2:w,col2:M}=h,L=Math.min(A,w),_=Math.max(A,w),V=Math.min(C,M),k=Math.max(C,M),G=n.content.colorData?JSON.parse(JSON.stringify(n.content.colorData)):[],U=n.content.colorTextData?JSON.parse(JSON.stringify(n.content.colorTextData)):[];for(let K=L;K<=_;K++)for(let z=V;z<=k;z++)G[K]&&(G[K][z]=null),U[K]&&(U[K][z]=null);i(r,{content:{...n.content,colorData:G,colorTextData:U}})};return T.jsxs(T.Fragment,{children:[T.jsx(yA.Popover,{isOpen:s,positions:["left","right","top","bottom"],padding:10,onClickOutside:e,containerClassName:"z-[9999]",content:({position:A,childRect:C,popoverRect:w})=>T.jsxs($c.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.1,ease:"easeOut"},style:{transformOrigin:"center center"},className:`relative flex flex-col space-y-2 ${n.style==="handsontable"?"":"w-44"} bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-700 rounded-md shadow-lg p-2 pt-8`,children:[T.jsx("div",{className:"absolute top-0 left-0 w-full px-2 pt-1 pb-1 text-center",children:T.jsx("div",{className:"bg-zinc-700 dark:bg-zinc-800 text-white text-xs rounded py-1 px-2 min-h-[22px] flex items-center justify-center",children:f})}),T.jsx("div",{className:"w-full",onMouseEnter:()=>p("블록 스타일 변경"),onMouseLeave:()=>p(ut),children:T.jsxs("select",{value:n.style,onChange:M=>a(r,M.target.value),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded focus:ring-blue-500 focus:border-blue-500 block p-1 dark:bg-zinc-800 dark:border-zinc-600 dark:placeholder-zinc-400 dark:text-gray-200","aria-label":"Change block style",children:[T.jsx("option",{value:"p",children:"본문"}),T.jsx("option",{value:"h1",children:"H1"}),T.jsx("option",{value:"h2",children:"H2"}),T.jsx("option",{value:"todo",children:"할 일"}),T.jsx("option",{value:"quote",children:"인용"}),T.jsx("option",{value:"divider",children:"구분선"}),T.jsx("option",{value:"handsontable",children:"표(고급)"}),T.jsx("option",{value:"code",children:"코드"})]})}),["p","h1","h2","quote"].includes(n.style)&&T.jsxs("div",{className:"flex w-full border-t border-gray-200 dark:border-zinc-700 pt-2",children:[T.jsx("div",{className:"text-sm min-w-10 mr-2 text-gray-600 dark:text-gray-400",children:"정렬"}),T.jsxs("div",{className:"flex w-full items-center justify-center",children:[T.jsx("button",{onMouseEnter:()=>p("왼쪽 정렬"),onMouseLeave:()=>p(ut),onClick:()=>i(r,{textAlign:"left"}),className:`p-1 rounded ${n.textAlign==="left"?"bg-gray-200 dark:bg-zinc-700":""} text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50`,"aria-label":"Align left",children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[T.jsx("line",{x1:"21",y1:"10",x2:"3",y2:"10"}),T.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),T.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),T.jsx("line",{x1:"21",y1:"18",x2:"3",y2:"18"})]})}),T.jsx("button",{onMouseEnter:()=>p("가운데 정렬"),onMouseLeave:()=>p(ut),onClick:()=>i(r,{textAlign:"center"}),className:`p-1 rounded ${n.textAlign==="center"?"bg-gray-200 dark:bg-zinc-700":""} text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50`,"aria-label":"Align center",children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[T.jsx("line",{x1:"18",y1:"10",x2:"6",y2:"10"}),T.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),T.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),T.jsx("line",{x1:"18",y1:"18",x2:"6",y2:"18"})]})}),T.jsx("button",{onMouseEnter:()=>p("오른쪽 정렬"),onMouseLeave:()=>p(ut),onClick:()=>i(r,{textAlign:"right"}),className:`p-1 rounded ${n.textAlign==="right"?"bg-gray-200 dark:bg-zinc-700":""} text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50`,"aria-label":"Align right",children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[T.jsx("line",{x1:"21",y1:"10",x2:"7",y2:"10"}),T.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),T.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),T.jsx("line",{x1:"21",y1:"18",x2:"7",y2:"18"})]})})]})]}),n.style==="handsontable"&&T.jsxs("div",{className:"w-full border-t border-gray-200 dark:border-zinc-700 pt-2",children:[T.jsx("div",{className:"text-sm min-w-10 mr-2 text-gray-600 dark:text-gray-400",children:"셀 색상"}),T.jsxs("div",{className:"flex flex-col space-y-2",children:[T.jsx("div",{onMouseEnter:()=>p("셀 배경색 변경"),onMouseLeave:()=>p(ut),children:T.jsx("div",{className:"grid grid-cols-8 gap-1",children:["#FFADAD","#FFD6A5","#FDFFB6","#CAFFBF","#9BF6FF","#A0C4FF","#BDB2FF","#FFC6FF"].map(M=>T.jsx("button",{onClick:()=>S(M,"bg"),className:"w-5 h-5 rounded-full border",style:{backgroundColor:M}},M))})}),T.jsx("div",{onMouseEnter:()=>p("셀 글자색 변경"),onMouseLeave:()=>p(ut),children:T.jsx("div",{className:"grid grid-cols-8 gap-1",children:["#000000","#D00000","#AE4600","#006400","#00529B","#0018A8","#5A00A8","#A800A8"].map((M,L)=>T.jsx("button",{onClick:()=>S(M,"text"),className:"w-5 h-5 rounded-full border flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:M},children:L%2===0?"A":"a"},M))})}),T.jsx("button",{onMouseEnter:()=>p("셀 색상 초기화"),onMouseLeave:()=>p(ut),onClick:v,className:"p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50","aria-label":"Reset cell colors",children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4 mx-auto",children:[T.jsx("path",{d:"M23 4v6h-6"}),T.jsx("path",{d:"M1 20v-6h6"}),T.jsx("path",{d:"M3.5 9a9 9 0 0 1 14.85-3.36L23 10V4"}),T.jsx("path",{d:"M20.5 15a9 9 0 0 1-14.85 3.36L1 14v6"})]})})]})]}),T.jsx("div",{className:"flex items-center justify-center w-full",children:["p","h1","h2","todo","quote"].includes(n.style)&&T.jsxs("div",{className:"flex w-full border-t border-gray-200 dark:border-zinc-700 pt-2",children:[T.jsx("div",{className:"text-sm min-w-10 mr-2 text-gray-600 dark:text-gray-400",children:"색상"}),T.jsxs("div",{className:"flex w-full items-center justify-center",children:[T.jsxs("div",{className:"relative w-6 h-6",onMouseEnter:()=>p("배경색 변경"),onMouseLeave:()=>p(ut),children:[T.jsx("input",{type:"color",value:n.backgroundColor||"#ffffff",onChange:M=>i(r,{backgroundColor:M.target.value}),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),T.jsx("div",{className:"w-full h-full rounded border border-gray-300 dark:border-zinc-600 pointer-events-none",style:{backgroundColor:n.backgroundColor||"transparent"}})]}),T.jsxs("div",{className:"relative w-6 h-6 flex items-center justify-center",onMouseEnter:()=>p("글자색 변경"),onMouseLeave:()=>p(ut),children:[T.jsx("input",{type:"color",value:n.textColor||"#000000",onChange:M=>i(r,{textColor:M.target.value}),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),T.jsxs("div",{className:"relative pointer-events-none",children:[T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 text-gray-600 dark:text-gray-300",children:[T.jsx("path",{d:"M4 7V4h16v3"}),T.jsx("path",{d:"M9 20h6"}),T.jsx("path",{d:"M12 4v16"})]}),T.jsx("div",{className:"absolute bottom-0.5 left-0 right-0 h-1 rounded-sm",style:{backgroundColor:n.textColor||"currentColor"}})]})]}),T.jsx("button",{onMouseEnter:()=>p("색상 초기화"),onMouseLeave:()=>p(ut),onClick:()=>i(r,{backgroundColor:null,textColor:null}),className:"p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50","aria-label":"Reset colors",children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[T.jsx("path",{d:"M23 4v6h-6"}),T.jsx("path",{d:"M1 20v-6h6"}),T.jsx("path",{d:"M3.5 9a9 9 0 0 1 14.85-3.36L23 10V4"}),T.jsx("path",{d:"M20.5 15a9 9 0 0 1-14.85 3.36L1 14v6"})]})})]})]})}),["p","todo","quote"].includes(n.style)&&T.jsxs("div",{className:"flex w-full border-t border-gray-200 dark:border-zinc-700 pt-2",children:[T.jsx("div",{className:"text-sm min-w-15 mr-2 text-gray-600 dark:text-gray-400",children:"폰트크기"}),T.jsx("div",{onMouseEnter:()=>p("글자 크기 변경"),onMouseLeave:()=>p(ut),className:"w-full",children:T.jsxs("select",{value:n.fontSize||"base",onChange:M=>i(r,{fontSize:M.target.value}),className:"bg-gray-50 w-full border border-gray-300 text-gray-900 text-xs rounded focus:ring-blue-500 focus:border-blue-500 block p-1 dark:bg-zinc-800 dark:border-zinc-600 dark:placeholder-zinc-400 dark:text-gray-200","aria-label":"Change font size",children:[T.jsx("option",{value:"sm",children:"작게"}),T.jsx("option",{value:"base",children:"보통"}),T.jsx("option",{value:"lg",children:"크게"})]})})]}),["p","h1","h2","todo","quote"].includes(n.style)&&T.jsx("div",{className:"w-full border-t border-gray-200 dark:border-zinc-700 pt-2",onMouseEnter:()=>p("글꼴 변경"),onMouseLeave:()=>p(ut),children:T.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400",children:[T.jsx("div",{className:"text-sm min-w-10 mr-2 text-gray-600 dark:text-gray-400",children:"글꼴"}),T.jsxs("select",{value:n.fontFamily||"sans",onChange:M=>i(r,{fontFamily:M.target.value}),className:"bg-gray-50 w-full border border-gray-300 text-gray-900 text-xs rounded focus:ring-blue-500 focus:border-blue-500 block p-1 dark:bg-zinc-800 dark:border-zinc-600 dark:placeholder-zinc-400 dark:text-gray-200","aria-label":"Change font family",children:[T.jsx("option",{value:"monospace",children:"모노스페이스"}),T.jsx("option",{value:"sans",children:"산세리프"}),T.jsx("option",{value:"serif",children:"세리프"}),T.jsx("option",{value:"noto",children:"나눔명조"})]})]})}),n.style==="code"&&T.jsx("div",{className:"w-full border-t border-gray-200 dark:border-zinc-700 pt-2",onMouseEnter:()=>p("언어 변경"),onMouseLeave:()=>p(ut),children:T.jsx("select",{value:n.language||"javascript",onChange:M=>i(r,{language:M.target.value}),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded focus:ring-blue-500 focus:border-blue-500 block p-1 dark:bg-zinc-800 dark:border-zinc-600 dark:placeholder-zinc-400 dark:text-gray-200",children:["javascript","React","css","html","bash","json","python","java","csharp","sql","typescript"].map(M=>T.jsx("option",{value:M,children:M},M))})}),T.jsxs("div",{className:"flex w-full border-t border-gray-200 dark:border-zinc-700 pt-2",children:[T.jsx("div",{className:"text-sm min-w-15 mr-2 text-gray-600 dark:text-gray-400",children:"작업"}),n.width&&T.jsx("button",{onMouseEnter:()=>p("너비 초기화"),onMouseLeave:()=>p(ut),onClick:l,className:"p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50","aria-label":"Reset width",children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[T.jsx("path",{d:"M21.25 2H2.75"}),T.jsx("path",{d:"M7 6v12"}),T.jsx("path",{d:"M17 6v12"}),T.jsx("path",{d:"M21.25 22H2.75"})]})}),T.jsx("button",{onMouseEnter:()=>p("블록 복제"),onMouseLeave:()=>p(ut),onClick:()=>u(r),className:"p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50","aria-label":"Duplicate block",children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[T.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),T.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),T.jsx("button",{onMouseEnter:()=>p("블록 삭제"),onMouseLeave:()=>p(ut),onClick:()=>g(!0),className:"p-1 text-gray-500 dark:text-gray-400 hover:text-red-500 dark:hover:bg-red-500/20 rounded-md",children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[T.jsx("polyline",{points:"3 6 5 6 21 6"}),T.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),T.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),T.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]}),children:t}),T.jsx(Sg,{isOpen:N,size:"sm",color:"warning",title:d("delete_confirm_title","삭제 확인"),message:d("block_delete_confirm_message","이 블록을 정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."),onClose:()=>g(!1),onConfirm:()=>{o(r),g(!1)}})]})},vA=()=>T.jsx("hr",{className:"border w-full border-gray-300 dark:border-gray-500 my-2 mr-4"}),SA=({type:s="p"})=>{const e="animate-pulse bg-gray-200 dark:bg-zinc-700 rounded-md";switch(s){case"h1":return T.jsx("div",{className:`${e} h-9 w-4/5 my-4`});case"h2":return T.jsx("div",{className:`${e} h-7 w-3/5 my-3`});case"code":return T.jsxs("div",{className:"w-full p-4 bg-gray-100 dark:bg-zinc-800 rounded-md animate-pulse",children:[T.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-1/4 mb-4"}),T.jsxs("div",{className:"space-y-2",children:[T.jsx("div",{className:"h-3 bg-gray-300 dark:bg-zinc-700 rounded w-full"}),T.jsx("div",{className:"h-3 bg-gray-300 dark:bg-zinc-700 rounded w-5/6"}),T.jsx("div",{className:"h-3 bg-gray-300 dark:bg-zinc-700 rounded w-full"})]})]});case"image":return T.jsx("div",{className:`${e} h-48 w-full my-4`});case"table":return T.jsxs("div",{className:"w-full my-4 space-y-2 animate-pulse",children:[T.jsxs("div",{className:"flex space-x-2",children:[T.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"}),T.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"}),T.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"})]}),T.jsxs("div",{className:"flex space-x-2",children:[T.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"}),T.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"}),T.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"})]})]});case"handsontable":return T.jsx("div",{className:`${e} h-40 w-full my-4`});case"youtube":return T.jsx("div",{className:`${e} h-48 w-full my-4`});case"p":default:return T.jsxs("div",{className:"space-y-2 animate-pulse",children:[T.jsx("div",{className:`${e} h-4 w-full`}),T.jsx("div",{className:`${e} h-4 w-5/6`})]})}},AA=({id:s,block:e,styleClasses:t,onUpdateBlock:r,readOnly:n=!1})=>{const[i,a]=I.useState(!1),[o,u]=I.useState(e.content),[l,h]=I.useState(e.text),d=I.useRef(null);I.useEffect(()=>{i&&d.current?.focus()},[i]);const f=()=>{n||a(!0)},p=()=>{a(!1),r(s,{content:o,text:l||o})};return i?T.jsx("div",{className:"p-2 bg-gray-100 dark:bg-zinc-700 rounded-md w-full",children:T.jsxs("div",{className:"flex flex-col space-y-2",children:[T.jsx("input",{ref:d,type:"text",value:o,onChange:N=>u(N.target.value),onBlur:p,placeholder:"Enter URL",className:"w-full p-1 bg-transparent border-b border-gray-400 focus:outline-none focus:border-blue-500"}),T.jsx("input",{type:"text",value:l,onChange:N=>h(N.target.value),onBlur:p,placeholder:"Enter link text (optional)",className:"w-full p-1 bg-transparent border-b border-gray-400 focus:outline-none focus:border-blue-500"})]})}):T.jsx("a",{href:e.content,target:"_blank",rel:"noopener noreferrer",className:`${t.link} w-full`,onDoubleClick:f,children:e.text||e.content})},Pc=({id:s,block:e,styleClasses:t,onUpdate:r,fontFamily:n,readOnly:i=!1})=>{const a=I.useRef(null),o=u=>{r&&r(s,u.currentTarget.innerHTML)};return T.jsx("div",{ref:a,contentEditable:!i,suppressContentEditableWarning:!0,onBlur:o,className:`${t[e.style]||t.p} w-full focus:outline-none ${i?"":"focus:ring-2 focus:ring-blue-500"} rounded-sm px-1 min-h-[1em]`,style:{fontFamily:n},dangerouslySetInnerHTML:{__html:e.content}})},CA=({id:s,block:e,styleClasses:t,onUpdate:r,onUpdateBlock:n})=>{const i=I.useRef(null),[a,o]=I.useState(!1),u=h=>{o(!1),r&&r(s,h.currentTarget.innerHTML)},l=()=>{n(s,{checked:!e.checked})};return T.jsxs("div",{className:t.todo,children:[T.jsx("input",{type:"checkbox",checked:e.checked||!1,onChange:l,className:"form-checkbox h-5 w-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),T.jsx("div",{ref:i,contentEditable:"true",suppressContentEditableWarning:!0,onFocus:()=>o(!0),onBlur:u,className:`w-full focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-sm px-1 min-h-[1em] ${e.checked?"line-through text-gray-400 dark:text-gray-500":""}`,dangerouslySetInnerHTML:{__html:e.content}})]})},IA=s=>{const{attributes:e,listeners:t,setNodeRef:r,transform:n,transition:i,isDragging:a,isOver:o,rect:u}=hA({id:s,transition:{duration:200,easing:"cubic-bezier(0.25, 1, 0.5, 1)"}}),l=n?`${rs.Transform.toString(n)} scale(1.02)`:null,h={transform:a?l:rs.Transform.toString(n),transition:a?"box-shadow 0.2s ease-in-out, opacity 0.2s ease-in-out":"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s ease-in-out",zIndex:a?10:"auto",opacity:a?.6:1,boxShadow:a?"0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23)":"none"};return{attributes:e,listeners:t,setNodeRef:r,style:h,isDragging:a,isOver:o,rect:u}},wA=({id:s,block:e,styleClasses:t,onUpdateBlock:r,isCodeEditing:n,setIsCodeEditing:i,readOnly:a=!1})=>{const o=u=>{i(!1),r(s,{content:u.target.value})};return T.jsx(T.Fragment,{children:n&&!a?T.jsx("textarea",{defaultValue:e.content,onBlur:o,autoFocus:!0,className:`CodeBlock ${t.code} w-full min-h-[100px] focus:outline-none focus:ring-2 focus:ring-blue-500`}):T.jsx(Ag,{language:e.language||"javascript",postData:`${e.content}`})})},MA=({id:s,block:e,onUpdateBlock:t,afterSelection:r})=>{const n=I.useRef(null),i=o=>{t(s,{content:o})},a=async(o,u,l)=>{const h=n.current?.hotInstance;if(!h)return;const d=e.content.columns.map((f,p)=>({...f,width:h.getColWidth(p)}));t(s,{content:{...e.content,columns:d}})};return T.jsx(T.Fragment,{children:T.jsx(Mv,{hotRef:n,columns:e.content.columns,rowData:e.content.data,colorData:e.content.colorData,colorTextData:e.content.colorTextData,gridData:e.content,onGridDataChange:i,afterSelection:r,handleAfterColumnResize:a,isDraggable:!1})})},OA=({id:s,block:e,onUpdateBlock:t})=>{const r=I.useRef(null),n=i=>{i.preventDefault(),i.stopPropagation();const a=i.clientX,o=r.current.offsetWidth,u=h=>{const d=o+(h.clientX-a);r.current&&(r.current.style.width=`${d}px`)},l=()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",l),t&&r.current&&t(s,{width:r.current.offsetWidth})};document.addEventListener("mousemove",u),document.addEventListener("mouseup",l)};return T.jsxs("div",{className:"relative",children:[T.jsx("img",{ref:r,src:e.content,alt:"Uploaded content",className:"h-auto rounded-md",style:{width:e.width?`${e.width}px`:"auto",maxWidth:"100%"}}),T.jsx("div",{onMouseDown:n,className:"absolute bottom-0 right-0 w-4 h-4 bg-blue-500 cursor-se-resize opacity-0 group-hover:opacity-100 transition-opacity"})]})},bA=({id:s,block:e,onUpdateBlock:t,onDelete:r})=>{const n=I.useRef(null),i=(f,p,N)=>{const g={...e.content};g.rows[p][N].text=f.currentTarget.innerHTML,t(s,{content:g})},a=()=>{const f={...e.content},p=f.rows[0]?.length||1;f.rows.push(Array(p).fill({text:""})),t(s,{content:f})},o=f=>{if(e.content.rows.length<=1)return;const p={...e.content};p.rows.splice(f,1),t(s,{content:p})},u=()=>{const f={...e.content};f.rows.forEach(p=>p.push({text:""})),t(s,{content:f})},l=f=>{if(e.content.rows[0]?.length<=1)return;const p={...e.content};p.rows.forEach(N=>N.splice(f,1)),t(s,{content:p})},h=f=>{f.preventDefault(),f.stopPropagation();const p=f.clientX,N=n.current;if(!N)return;const g=N.offsetWidth,S=A=>{const C=g+(A.clientX-p);N.style.width=`${C}px`},v=()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",v),t&&N&&t(s,{width:N.offsetWidth})};document.addEventListener("mousemove",S),document.addEventListener("mouseup",v)},d=(f,p)=>{f.preventDefault(),f.stopPropagation();const N=f.clientX,S=f.currentTarget.parentElement.offsetWidth,v=C=>{const w=S+(C.clientX-N);if(w>30){const M=n.current.querySelector("table");if(M){const L=M.querySelector("colgroup");L&&L.children[p]&&(L.children[p].style.width=`${w}px`)}}},A=C=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",A);const w=S+(C.clientX-N),M=[...e.content.colWidths||[]];M[p]=Math.max(w,30),t(s,{content:{...e.content,colWidths:M}})};document.addEventListener("mousemove",v),document.addEventListener("mouseup",A)};return T.jsxs("div",{className:"flex items-start group relative w-full",children:[T.jsxs("button",{onClick:a,className:"absolute -bottom-2.5 left-1/2 -translate-x-1/2 w-full h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[T.jsx("div",{className:"w-6 h-px bg-blue-500"}),T.jsx("div",{className:"absolute w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs",children:"＋"})]}),T.jsxs("div",{ref:n,className:"relative w-full",style:{width:e.width?`${e.width}px`:"100%"},children:[T.jsxs("button",{onClick:u,className:"absolute top-1/2 -right-2.5 -translate-y-1/2 h-full w-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[T.jsx("div",{className:"h-6 w-px bg-blue-500"}),T.jsx("div",{className:"absolute w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs",children:"＋"})]}),T.jsxs("table",{className:"w-full border-collapse border border-gray-300 dark:border-zinc-600 table-fixed",children:[T.jsx("colgroup",{children:e.content.rows[0]?.map((f,p)=>T.jsx("col",{style:{width:e.content.colWidths?.[p]?`${e.content.colWidths[p]}px`:"auto"}},p))}),T.jsx("thead",{children:T.jsx("tr",{children:e.content.rows[0]?.map((f,p)=>T.jsxs("th",{className:"relative border-none p-0 h-4 group/col",children:[T.jsx("button",{onClick:()=>l(p),className:"absolute -top-2.5 left-1/2 -translate-x-1/2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs opacity-0 group-hover/col:opacity-100 transition-opacity z-10",children:"－"}),T.jsx("div",{onMouseDown:N=>d(N,p),className:"absolute top-0 right-0 h-full w-1.5 cursor-col-resize opacity-0 group-hover/col:opacity-100",children:T.jsx("div",{className:"h-full w-px bg-blue-500"})})]},p))})}),T.jsx("tbody",{children:e.content.rows.map((f,p)=>T.jsxs("tr",{className:"relative group/row",children:[T.jsx("button",{onClick:()=>o(p),className:"absolute -left-2.5 top-1/2 -translate-y-1/2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs opacity-0 group-hover/row:opacity-100 transition-opacity z-10",children:"－"}),f.map((N,g)=>T.jsx("td",{contentEditable:!0,suppressContentEditableWarning:!0,onBlur:S=>i(S,p,g),className:"border border-gray-300 dark:border-zinc-600 p-2 focus:outline-blue-500 overflow-hidden whitespace-nowrap",dangerouslySetInnerHTML:{__html:N.text}},g))]},p))})]}),T.jsx("div",{onMouseDown:h,className:"absolute bottom-0 right-0 w-4 h-4 bg-blue-500 cursor-se-resize opacity-0 group-hover:opacity-100 transition-opacity"})]}),T.jsx("button",{onClick:()=>r(s),className:"p-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity absolute -top-2 -right-2 bg-white dark:bg-zinc-800 rounded-full","aria-label":"Delete block",children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[T.jsx("path",{d:"M3 6h18"}),T.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),T.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})},xA=({block:s})=>T.jsx("div",{className:"w-full aspect-w-16 aspect-h-9",children:T.jsx("iframe",{src:`https://www.youtube.com/embed/${s.content}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"w-full h-full rounded-md"})}),XA=I.memo(({id:s,block:e,styleClasses:t,onUpdateBlock:r,onUpdate:n,onStyleChange:i,onDelete:a,onDuplicate:o,onInsertBlock:u,readOnly:l=!1})=>{const{attributes:h,listeners:d,setNodeRef:f,style:p,isDragging:N,isOver:g,rect:S}=IA(s),[v,A]=I.useState(!1),[C,w]=I.useState(!1),[M,L]=I.useState(!1),[_,V]=I.useState(null),k=I.useRef(null),G={sm:"text-sm",base:"text-base",lg:"text-lg"},U=G[e.fontSize]||G.base,K={monospace:"monospace",sans:"font-sans",serif:"serif",noto:"Noto Serif Korean"},z=K[e.fontFamily]||K.sans,le={left:"text-left",center:"text-center",right:"text-right"}[e.textAlign]||"text-left",Te=(re,Re)=>{re.preventDefault(),re.stopPropagation();const ve=re.clientX,ne=k.current.offsetWidth,Ae=nt=>{let ie;Re==="left"?ie=ne-(nt.clientX-ve):ie=ne+(nt.clientX-ve),k.current&&(k.current.style.width=`${Math.max(ie,100)}px`)},ce=()=>{document.removeEventListener("mousemove",Ae),document.removeEventListener("mouseup",ce),r(s,{width:k.current.offsetWidth})};document.addEventListener("mousemove",Ae),document.addEventListener("mouseup",ce)},Ee=(re,Re,ve,ne)=>{V({row:re,col:Re,row2:ve,col2:ne})},Ue=()=>{switch(e.style){case"handsontable":return T.jsx(MA,{id:s,block:e,onUpdateBlock:r,afterSelection:Ee,readOnly:l});case"divider":return T.jsx(vA,{});case"todo":return T.jsx(CA,{id:s,block:e,styleClasses:t,onUpdate:n,onUpdateBlock:r,fontFamily:z,readOnly:l});case"quote":return T.jsx(Pc,{id:s,block:e,styleClasses:t,onUpdate:n,fontFamily:z,readOnly:l});case"link":return T.jsx(AA,{id:s,block:e,styleClasses:t,onUpdateBlock:r,fontFamily:z,readOnly:l});case"code":return T.jsx(wA,{id:s,block:e,styleClasses:t,onUpdateBlock:r,isCodeEditing:v,setIsCodeEditing:A,readOnly:l});case"youtube":return T.jsx(xA,{block:e});case"table":return T.jsx(bA,{id:s,block:e,onUpdateBlock:r,onDelete:a,readOnly:l});case"image":return T.jsx(OA,{id:s,block:e,onUpdateBlock:r,readOnly:l});default:return T.jsx(Pc,{id:s,block:e,styleClasses:t,onUpdate:n,fontFamily:z,readOnly:l})}};if(N){const re=Re=>{const ve="bg-gray-100 dark:bg-zinc-800 rounded-md border-2 border-dashed border-gray-300 dark:border-zinc-600";switch(Re){case"divider":return`${ve} h-2`;case"image":case"youtube":case"handsontable":return`${ve} h-24`;case"code":return`${ve} h-20`;default:return`${ve} h-10`}};return T.jsx("div",{ref:f,style:p,className:re(e.style)})}return T.jsxs("div",{ref:f,style:p,className:"SortableBlock px-4 group relative mx-auto",children:[g&&T.jsx("div",{className:"absolute top-0 left-0 right-0 h-full pointer-events-none",children:T.jsx("div",{className:"absolute -top-1 left-0 right-0 h-1 bg-blue-500 rounded-full",style:{opacity:g&&S.top>0?1:0,transition:"opacity 0.2s"}})}),T.jsxs("div",{ref:k,className:"SortableBlock01 relative transition-shadow rounded-md",style:{width:e.width?`${e.width}px`:"100%"},children:[!l&&T.jsxs(T.Fragment,{children:[T.jsx("div",{onMouseDown:re=>Te(re,"left"),className:"SortableBlock02 absolute top-0 left-0 h-full w-2 cursor-ew-resize opacity-0 group-hover:opacity-100 z-20",children:T.jsx("div",{className:"h-full w-0.5 bg-blue-500/50 mr-auto"})}),T.jsx("div",{onMouseDown:re=>Te(re,"right"),className:"SortableBlock03 absolute top-0 right-0 h-full w-2 cursor-ew-resize opacity-0 group-hover:opacity-100 z-20",children:T.jsx("div",{className:"h-full w-0.5 bg-blue-500/50 ml-auto"})})]}),T.jsxs($c.div,{layout:!0,style:{backgroundColor:e.backgroundColor,color:e.textColor},className:`SortableBlock_motion flex w-full rounded-md ${U} ${le}
            ${!l&&!e.backgroundColor?"hover:bg-gray-200 group-hover:bg-gray-50 dark:group-hover:bg-zinc-800/50 dark:hover:bg-zinc-800/50":""}`,onDoubleClick:()=>{e.style==="code"&&!l&&A(!0)},children:[T.jsx(I.Suspense,{fallback:T.jsx(SA,{type:e.style}),children:Ue()}),!l&&T.jsx("button",{onClick:()=>u(s),className:`absolute ${e.style==="code"?"top-11":"top-1"} right-6 z-9999 p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity bg-white dark:bg-zinc-800 hover:bg-gray-200 dark:hover:bg-zinc-700" aria-label="블록 추가`,children:T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[T.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),T.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),T.jsx(TA,{isOpen:C,onClose:()=>w(!1),id:s,block:e,onUpdateBlock:r,onStyleChange:i,onDelete:a,onDuplicate:o,onResetWidth:()=>{r(s,{width:null}),w(!1)},selection:_,children:T.jsx("div",{role:"button","aria-expanded":"false","aria-label":"드래그","aria-haspopup":"dialog",...h,...!M&&!v&&!l&&d,className:`absolute ${e.style==="code"?"top-11":"top-1"}  right-1 z-9999 flex flex-col items-center ${l?"":"cursor-grab"}`,onClick:()=>!l&&w(re=>!re),children:T.jsx("svg",{"aria-hidden":"true",role:"graphics-symbol",viewBox:"0 0 10 10",fill:"currentcolor",className:`dragHandle mt-1 ${l?"opacity-0":"opacity-0 group-hover:opacity-100"} transition-opacity`,style:{width:"14px",height:"14px",display:"block",flexShrink:0},children:T.jsx("path",{d:"M3,2 C2.44771525,2 2,1.55228475 2,1 C2,0.44771525 2.44771525,0 3,0 C3.55228475,0 4,0.44771525 4,1 C4,1.55228475 3.55228475,2 3,2 Z M3,6 C2.44771525,6 2,5.55228475 2,5 C2,4.44771525 2.44771525,4 3,4 C3.55228475,4 4,4.44771525 4,5 C4,5.55228475 3.55228475,6 3,6 Z M3,10 C2.44771525,10 2,9.55228475 2,9 C2,8.44771525 2.44771525,8 3,8 C3.55228475,8 4,8.44771525 4,9 C4,9.55228475 3.55228475,10 3,10 Z M7,2 C6.44771525,2 6,1.55228475 6,1 C6,0.44771525 6.44771525,0 7,0 C7.55228475,0 8,0.44771525 8,1 C8,1.55228475 7.55228475,2 7,2 Z M7,6 C6.44771525,6 6,5.55228475 6,5 C6,4.44771525 6.44771525,4 7,4 C7.55228475,4 8,4.44771525 8,5 C8,5.55228475 7.55228475,6 7,6 Z M7,10 C6.44771525,10 6,9.55228475 6,9 C6,8.44771525 6.44771525,8 7,8 C7.55228475,8 8,8.44771525 8,9 C8,9.55228475 7.55228475,10 7,10 Z"})})})})]})]})]})});export{SA as B,rs as C,zA as D,op as P,XA as S,Mv as T,GA as a,$A as b,WA as c,dp as d,UA as e,kA as f,Xc as g,Cg as h,hA as i,YA as j,BA as k,VA as l,FA as m,PA as n,DA as s,HA as u,jA as v};
