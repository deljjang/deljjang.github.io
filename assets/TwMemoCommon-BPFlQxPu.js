const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DR2AJDfj.js","assets/index-CvT5YaSg.js","assets/index-Bxn7MviP.css","assets/createSvgIcon-CVbHwdI_.js","assets/useControlled-IYaOVZhp.js","assets/ownerWindow-DvT1GKkC.js","assets/isMuiElement-DWhK3728.js","assets/fireDatabase-V756jICp.js","assets/fireStorage-KtnmbIfI.js","assets/SinyDate-DASoKPnH.js","assets/Grid-C9y34BYf.js","assets/useTheme-DFlWa2Mk.js","assets/index-BAiSu5QZ.js","assets/Typography-CHb_Yaam.js","assets/Menu-BLVqlSbS.js","assets/useSlotProps-BlJXSYDE.js","assets/resolveComponentProps-Op5Zu1FD.js","assets/IconButton-DIZWXFv9.js","assets/TextField-DYRK4ui4.js","assets/InputAdornment-OePoEkcC.js","assets/Popper-MB0Xb1qb.js","assets/Button-BL8t6y7w.js","assets/Chip-DTO5lcYH.js","assets/index.esm-BjAQZWJ4.js","assets/TwButton-Dlyxo1KU.js","assets/Loading-0EEKtlum.js","assets/Container-tgbpLRfl.js","assets/styled-CZC7bwuH.js","assets/CircularProgress-C4ffWbHS.js","assets/Divider-Bwjk2vy1.js","assets/dividerClasses-D1fPCAFU.js","assets/index-Cmdt2tIm.css"])))=>i.map(i=>d[i]);
import{b as m,u as V,j as e,h as Q,q as ye,e as We,o as Je,c as we,f as Ce,i as Ne,D as xe,E as re,F as Ge,K as $e,H as Ke,I as Se,J as Ve,B as Qe,ck as Te,L as Ze,R as Xe,M as X}from"./index-CvT5YaSg.js";import{u as et}from"./useSuspenseQuery-CdFQGTyr.js";import{T as tt}from"./Footer-BzN4yNqc.js";import{b as st,T as oe}from"./TwLinkItem-DyZdov9f.js";import{L as M}from"./Loading-0EEKtlum.js";import{g as De,s as B}from"./fireDatabase-V756jICp.js";import{g as Le,S as Fe,T as Ie}from"./index-DUp0-uXk.js";import{S as Re,a as Ee}from"./right-B6eMk70X.js";import{D as Pe}from"./DndProvider-CwKNg52d.js";import{a as ot,T as nt}from"./TwTitleItem-Cf7vvt9n.js";import{F as Be}from"./Favorite-CyfOfJQ_.js";import{u as fe,a as pe,F as at,b as rt,D as Ue,l as lt,I as it,s as ne,d as ae,e as _e}from"./index-DR2AJDfj.js";import{S as ct}from"./SinyImageList-CVKwgmP5.js";import{L as mt,H as ve}from"./HtmlCode-hNbsvGm4.js";import{c as dt}from"./CodeText-q5M8sHdK.js";import{s as je}from"./commonUtil-BVvWhpjp.js";import{T as E}from"./TwButton-Dlyxo1KU.js";import{C as ut}from"./CircularProgress-C4ffWbHS.js";import{u as Me}from"./useWindowDimensions-DFaRtNkh.js";import{D as ht}from"./datetime-BDx6lZXm.js";import{u as He}from"./index.esm-BjAQZWJ4.js";import{T as ge}from"./TwCheckbox-BhzaCk8h.js";import{T as Ae}from"./TwTextArea-CY1Xrm8X.js";import{T as P}from"./TwBadge-CLrTtP-_.js";import"./SinyDate-DASoKPnH.js";import{T as G}from"./TwInput-Dod_gj7Y.js";import{T as Ye}from"./TwSelect-eOO_IWYR.js";import{T as Oe}from"./TwDatePicker-BKuZG050.js";import{d as K,e as qe,f as gt,h as xt}from"./fireStorage-KtnmbIfI.js";import{I as ft}from"./IpInfo-B9XA54o6.js";import{f as pt}from"./fireMemoDetail-Deoe5gzE.js";import{S as vt}from"./check-circle-BfFWYh9B.js";import{H as jt,a as bt,b as kt}from"./HomeChartSemiDonut-C8lC6dKG.js";import"./useBaseQuery-BzUDA1ET.js";import"./LinkItem-CPuYx88B.js";import"./Typography-CHb_Yaam.js";import"./Divider-Bwjk2vy1.js";import"./dividerClasses-D1fPCAFU.js";import"./Link-CDtkXzdW.js";import"./Container-tgbpLRfl.js";import"./styled-CZC7bwuH.js";import"./createSvgIcon-CVbHwdI_.js";import"./useControlled-IYaOVZhp.js";import"./ownerWindow-DvT1GKkC.js";import"./isMuiElement-DWhK3728.js";import"./IconButton-DIZWXFv9.js";import"./ImageListItem-Bzg6IH4D.js";/* empty css                 */import"./copy-H6wBFEHv.js";import"./ComponentCard-D2fPtw54.js";import"./TwRadio-Uvp9kuTu.js";import"./toPropertyKey-DCwh5dYN.js";import"./Grid-C9y34BYf.js";import"./useTheme-DFlWa2Mk.js";import"./index-BAiSu5QZ.js";import"./Menu-BLVqlSbS.js";import"./useSlotProps-BlJXSYDE.js";import"./resolveComponentProps-Op5Zu1FD.js";import"./TextField-DYRK4ui4.js";import"./InputAdornment-OePoEkcC.js";import"./Popper-MB0Xb1qb.js";import"./Button-BL8t6y7w.js";import"./Chip-DTO5lcYH.js";function yt({initTreeData:o}){const[t,c]=m.useState(),s=x=>c(x),p=V();m.useEffect(()=>{c(o)},[o]);const b=x=>{console.log("node",x),p(`/m/${x.id}`)};return t===void 0?e.jsx(e.Fragment,{}):t===null||t.length===0?e.jsx(M,{}):e.jsx(Pe,{backend:Fe,options:Le(),children:e.jsx(Ie,{tree:t,rootId:"root",onDrop:s,canDrag:()=>!1,render:(x,{depth:h,isOpen:r,onToggle:v})=>e.jsxs("div",{className:`w-62 flex items-center rounded-sm
          text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ml-1
          hover:bg-gray-300 dark:hover:bg-gray-700`,style:{paddingLeft:h*20+(x.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[x.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:v,children:r?e.jsx(Re,{className:"size-6"}):e.jsx(Ee,{className:"size-6"})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>b(x),children:x.text})]}),x.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",x.cnt,")"]})]})})})}function wt({onSelected:o}){const{user:t}=Q(),c=V(),[s,p]=m.useState(),[b,x]=m.useState(),h=async r=>{const v=[],d=ye(we(Ce,`memo_tree/${r}`),Je("bm"),We("Y")),u=await Ne(d);if(!u.exists())return console.log("getBookmark.getFireData.null"),null;const N=u.val();for(let y in N){const $=N[y];$.id=y,$.key=y,$.text=$.title,v.push($)}v.sort((y,$)=>y.title>$.title?1:-1),p([...v])};return m.useEffect(()=>{t!==void 0&&t!=null&&h(t?.uid)},[t]),m.useEffect(()=>{const r=async(v,d)=>{const u=[...d];if(d)for(const N of d){let y=N;for(;y.parent!==void 0&&y.parent!=="root";){const $=y.parent;y=await De(`memo_tree/${v}/${$}`);const f={id:y.key,text:y.title,droppable:!1,parent:y.parent};u.filter(a=>a.id===f.id).length===0&&u.push(f)}}for(const N of u){const y=N.id;N.cnt=u.filter($=>$.parent===y).length}x(u)};s&&s.length>0&&r(t?.uid,s)},[s]),t===null?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(ot,{children:"주요 목록"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((r,v)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{o(r.key),c(`/m/${r.key}`)},children:e.jsx("span",{className:"text-base",children:r.title})})},v))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-3"}),e.jsx(m.Suspense,{fallback:e.jsx(M,{}),children:e.jsx(yt,{initTreeData:b,uid:t?.uid})})]})}const Ct=o=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:`70px 70px 70px ${o.master?"70px":""}`},children:[o.master&&e.jsx(E,{size:"sm",variant:"outlined",color:"brand",onClick:o.onUtil,children:"유틸"}),e.jsx(E,{size:"sm",variant:"outlined",color:"blue",onClick:o.onEdit,children:"수정"}),e.jsx(E,{size:"sm",variant:"outlined",color:"warning",onClick:o.onNewMemo,children:"새글"}),e.jsx(E,{size:"sm",variant:"outlined",color:"error",onClick:o.onDelete,children:"삭제"})]}),Nt=o=>{const{rootDb:t,isLoading:c,memoDetailData:s,onBookmark:p,onTreeUpdate:b,searchWord:x}=o,[h,r]=m.useState(!1),{scrollYProgress:v}=fe(),d=pe(v,{stiffness:100,damping:30,restDelta:.001}),u=V(),{memoId:N}=xe(),$=re()?.state?.fullIndex,{user:f}=Q(),S=()=>{const g=`/${t==="memo"?"m":t}/edit/${N}`;u(g,{state:{fullIndex:$}})},a=()=>{const g=`/${t==="memo"?"m":t}/util/${N}`;u(g,{state:{fullIndex:$}})},i=()=>{const g=`/${t==="memo"?"m":t}/insert/${N}`;u(g,{state:{fullIndex:$}})},k=async()=>{const g=t==="memo"?`${t}_txt/${f.uid}/${N}`:`${t}_txt/${N}`,T=t==="memo"?`${t}_tree/${f.uid}/${N}`:`${t}/${N}`;await rt(g,T)!==void 0&&(b(),u(`/${t==="memo"?"m":t}`))},C=()=>{r(!0)},D=()=>{r(!1),k()};return m.useEffect(()=>{s&&s.title!==void 0&&je({title:s.title,description:s.title});function g(){window.scrollTo({top:0}),s&&s.html!=="N"&&document.querySelectorAll("pre").forEach(T=>{T.innerHTML=dt(T.innerHTML)})}s&&s.memo!==null&&(g(),s.image&&s.image.map((T,U)=>(console.log("image."+U+"=",T.key),T)))},[s]),c?e.jsx(M,{}):N===""||f===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(Ge.div,{className:"progress-bar",style:{scaleX:d}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:s&&s.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:p,children:s&&s.bookmark==="Y"?e.jsx(Be,{className:"text-red-500"}):e.jsx(at,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s?.path&&s?.path.map((g,T)=>T===0?g?.text:` > ${g?.text}`)})]})]}),e.jsx(mt,{isOpen:h,size:"sm",color:"warning",title:"삭제 확인",message:`하위 자료가 있는 경우 같이 삭제됩니다.
<br/>삭제하시겠습니까?`,onClose:()=>r(!1),onConfirm:()=>{D()}}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(Ct,{master:f?.uid===$e,rootDb:t,onEdit:S,onUtil:a,onNewMemo:i,onDelete:C,bookmark:s&&s.bookmark}),e.jsxs("div",{className:"my-4",children:[s&&s.html==="N"?e.jsx(ve,{postData:s&&s.memo,highlightWord:x}):s&&s.html!=="N"&&s.memo&&e.jsx(Ke,{text:s.memo}),e.jsx(ct,{imageList:s&&s.image}),!s&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(ut,{})})})]})]})]})},ze=({onSubmit:o,onCancel:t,isSubmitting:c,newMode:s=!1})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(E,{variant:"outlined",color:"success",disabled:c,onClick:p=>{p.preventDefault(),o(p)},children:[s?"새글":""," 저장"]}),e.jsx(E,{variant:"outlined",color:"error",onClick:p=>{p.preventDefault(),t()},children:"취소"})]}),$t=m.lazy(()=>Ve(()=>import("./index-DR2AJDfj.js").then(o=>o.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31])));lt.Quill.register("modules/imageDrop",it);Se.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const St={syntax:{highlight:o=>Se.highlightAuto(o).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},Tt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],Dt=o=>{const[t,c]=m.useState(o.imageList),[s,p]=m.useState(o.htmlCheck==="Y"),[b,x]=m.useState(o.iconCheck==="Y"),[h,r]=m.useState(!1),[v,d]=m.useState(o.newMode?"":o.content),[u,N]=m.useState(),y=m.useRef(),$=m.useRef(),f=m.useRef(null);m.useRef(null);const S=m.useRef(null),a=o.newMode,i=m.useRef([]),{height:k}=Me(),C=ht.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),D={edTitle:a?"":o.title,edGbn:o.gbn?o.gbn:"etc",edDate:a?C:o.date,content:a?"":o.content,memoTxt:a?"":o.content,htmlCheck:o.htmlCheck,iconCheck:o.iconCheck},{register:g,handleSubmit:T,trigger:U,control:H,setValue:I,getValues:O,watch:le,formState:{errors:be,isSubmitting:ie}}=He({mode:"onChange",defaultValues:D});m.useEffect(()=>{g("edDate"),g("edGbn",{required:!0}),g("htmlCheck"),g("iconCheck"),g("memoTxt")},[]),m.useEffect(()=>{i.current=[],y.current=o.content,$.current=!1},[o.content]);const ee=async l=>{a?await o.onNewSubmit(l,i.current):await o.onPostSubmit(l,t,i.current)},ce=()=>{T(ee)()},_=l=>{console.log("onDelete.imageList=",l),c(l)},Y=l=>{console.log("onInsert.file",l);let w=y.current;l.ext==="jpg"||l.ext==="png"?(w+=`<img src='${l.url}'/>`,F(`<img src='${l.url}'/>
`)):l.ext==="mp4"?(w+=`<video preload="auto" controls="" src='${l.url}'></video>`,F(`<video preload="auto" controls="" src='${l.url}'></video>`)):(w+=`<a src='${l.url}'>${l.name}}</a>`,F(`다운로드
<a href="${l.url}" target="_blank">${l.name}</a>
`)),y.current=w},me=l=>o.onRename(l,O("edTitle")),de=l=>{y.current=l},ue=l=>{console.log("handleFileUpload",l),i.current=l};function he(l){y.current=l,I("content",l),U("content")}const Z=(l,w)=>{console.log(`onChecked.e.${l}=`,w),I(l,w?"Y":"N"),console.log(`onChecked.v.${l}=`,O(l)),l==="htmlCheck"?p(w):l==="rootCheck"?r(w):x(w)},n=le("content"),j=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],L=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],F=l=>{const w=f.current;if(w){const J=w.selectionStart,A=w.selectionEnd,q=v.slice(0,J),te=v.slice(A);d(q+l+te),I("memoTxt",q+l+te),setTimeout(()=>{w.selectionStart=w.selectionEnd=J+l.length,w.focus()},0)}},R=l=>{F(l)},z=l=>l?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(l)||l.includes("image")||l.includes("img"):!1,W=l=>new Promise((w,J)=>{const A=new Image;A.crossOrigin="anonymous",A.onload=()=>{const q=document.createElement("canvas"),te=q.getContext("2d");q.width=A.width,q.height=A.height,te.drawImage(A,0,0);try{const se=q.toDataURL("image/png");console.log("convertImageToBase64.base64=",se.substring(0,30)+"..."),w(se)}catch(se){J(se)}},A.onerror=()=>{J(new Error("Failed to load image"))},A.src=l});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:T(ee),style:{width:"100%",minHeight:"300px",maxHeight:{height:k},display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsx(ge,{id:"rootCheck",checked:h,onChange:l=>Z("rootCheck",l),label:"root로 이동"}),e.jsx(ge,{id:"htmlCheck",checked:s,onChange:l=>Z("htmlCheck",l),label:"HTML사용"}),e.jsx(ge,{id:"iconCheck",checked:b,onChange:l=>Z("iconCheck",l),label:"Icon"}),e.jsx(ze,{onSubmit:l=>ce(),onCancel:o.onCancel,isSubmitting:ie,newMode:a})]}),e.jsx(Ue,{control:H,onDelete:_,onInsert:Y,onRename:me,setContent:de,onFileUpload:ue,imageList:o.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(G,{name:"edTitle",placeholder:"제목",control:H,rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:l=>{l.preventDefault(),I("edTitle",l.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ye,{name:"edGbn",label:"구분",control:H,rules:{required:!0},placeholder:"-- 구분 --",options:j,className:"",allClassName:"max-w-40",onChange:l=>{l.preventDefault();const w=l.target.value;console.log("edGbn=",O("edGbn")),I("edGbn",w)}}),e.jsx(Oe,{id:"edDate",name:"edDate",placeholder:"Select a date",control:H,onChange:(l,w)=>{console.log({dates:l,currentDateString:w}),I("edDate",w)}})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(ve,{postData:v})}),e.jsxs("div",{children:[e.jsx(Ae,{ref:f,className:"",value:v,onChange:l=>{I("memoTxt",l),d(l)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>R(`<box>
</box>`),children:"<Box>"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>R('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>R('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>R('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>R('<hr style="width=100%"/>'),children:"line"}),L.map((l,w)=>e.jsx(P,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>R("<code>"+l+`
</code>`),children:l},w))]})]}),O("edUrl")&&z(O("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:u,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async l=>{try{const w=await W(u);I("edUrl2",w)}catch(w){console.error("Base64 conversion failed:",w)}},onError:l=>{l.target.style.display="none"}})})]}),s&&e.jsx(m.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx($t,{ref:S,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:n,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:St,formats:Tt,onChange:he})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},ke=o=>{const{rootDb:t,isLoading:c,memoDetailData:s}=o,{scrollYProgress:p}=fe();pe(p,{stiffness:100,damping:30,restDelta:.001});const b=V(),x=m.useRef(),h=m.useRef();h.current=o.searchWord;const{memoId:r}=xe(),v=re(),{user:d}=Q();x.current=v.pathname.split("/")[2]==="insert",console.log("memoDetailData=",s);const u=()=>{const a=`/${t==="memo"?"m":t}/${r==="insert"?"":r}`;b(a)},N=async a=>{await K(d.uid,r,a)},y=async a=>{if(console.log("onFilePathList.fileNm=",a),a.length>0)for(let i=0;i<a.length;i++){const k=a[i];console.log("onFilePathList.file=",k);try{const C=await K(d.uid,r,k);console.log("onFilePathList.path=",C)}catch{console.log("onFilePathList.error=",k)}}else await K(d.uid,r,a)},$=async(a,i)=>{console.log("onNewSubmit.values",a);const k=await ne({rootDb:t,uid:d.uid,newData:x.current,key:r==="insert"?"root":r,values:a});if(await ae(`${t}_txt`,t,k,i),k!==void 0){const C=`/${t==="memo"?"m":t}/${k}`;b(C,{state:{reflash:!0}})}},f=async(a,i)=>{const k=t==="memo"?`${t}/${d.uid}/`:`${t}/`,C=await qe(k,a.key,i,a.ext);if(C.success){const D=t==="memo"?`${t}_txt/${d.uid}/${r}/image/`:`${t}_txt/${r}/image/`;return B(D+a.key,null),a.key=C.key,a.url=C.url,a.name=C.key+"."+a.ext,B(D+C.key,a),console.log("onRename.file",a),a}},S=async(a,i,k)=>{const C=t==="memo"?`${t}_txt/${d.uid}/`:`${t}_txt/`;t==="memo"?`${t}${d.uid}`:`${t}`,await _e(C,t==="memo"?`${t}/${d.uid}/`:`${t}/`,r,i),console.log("onPostSubmit.values",a);const D=await ne({rootDb:t,uid:d.uid,newData:x.current,key:r==="insert"?"root":r,values:a});console.log("onPostSubmit.newKey=",D),console.log("onPostSubmit.files=",k);const g=await ae(`${C}`,t==="memo"?`${t}/${d.uid}/`:`${t}/`,r,k);console.log("onNewSubmit.imageResult",g),t==="memo"&&(B(`memo_tree/${d.uid}/${r}/title`,a.edTitle),a.rootCheck==="Y"&&B(`memo_tree/${d.uid}/${r}/parent`,"root")),x.current=!1;const T=`/${t==="memo"?"m":t}/${r}`;t==="home"&&B("home/tree",null),b(T,{state:{reflash:!0}})};return m.useEffect(()=>{s&&s.title!==void 0&&je({title:s.title,description:s.title});function a(){document.querySelectorAll("pre").forEach((i,k)=>{})}s&&s.memo!==null&&a()},[s]),r===""||d===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",c),s===void 0||c?e.jsx(M,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:x.current===!1&&s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(M,{}):e.jsx(Dt,{newMode:x.current,onPostSubmit:S,onNewSubmit:$,onCancel:u,onRename:f,onFilePath:N,onFilePathList:y,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})}))},Lt=o=>{const[t,c]=m.useState(o.imageList),[s,p]=m.useState(o.content),[b,x]=m.useState(),h=m.useRef(),r=m.useRef(),v=m.useRef(null),d=m.useRef([]),{height:u}=Me(),N={edTitle:o.title,edGbn:o.gbn?o.gbn:"etc",edDate:o.date,content:o.content,memoTxt:o.content,htmlCheck:"N",iconCheck:"N"},{register:y,handleSubmit:$,trigger:f,control:S,setValue:a,getValues:i,watch:k,formState:{errors:C,isSubmitting:D}}=He({mode:"onChange",defaultValues:N});m.useEffect(()=>{y("edDate"),y("memoTxt")},[]),m.useEffect(()=>{d.current=[],h.current=o.content,r.current=!1},[o.content]);const g=async n=>{await o.onPostSubmit(n,t,d.current)},T=()=>{$(g)()},U=n=>{console.log("onDelete.imageList=",n),c(n)},H=n=>{console.log("onInsert.file",n);let j=h.current;n.ext==="jpg"||n.ext==="png"?(j+=`<img src='${n.url}'/>`,_(`<img src='${n.url}'/>
`)):n.ext==="pdf"?(j+=`<PDF>${n.url}</PDF>`,_(`<PDF>${n.url}</PDF>`)):n.ext==="mp4"?(j+=`<video preload="auto" controls="" src='${n.url}'></video>`,_(`<video preload="auto" controls="" src='${n.url}'></video>`)):(j+=`<a src='${n.url}'>${n.name}}</a>`,_(`다운로드
<a href="${n.url}" target="_blank">${n.name}</a>
`)),h.current=j},I=n=>o.onRename(n,i("edTitle")),O=n=>{h.current=n},le=n=>{console.log("handleFileUpload",n),d.current=n};function be(n){_(`<img src='${n}'/>`)}function ie(){console.log("HtmlEditor.imageList=",t);let n="";t&&t.length>0&&t.map((j,L)=>{n+=`<img src="/data/memo/${j.key}.${j.ext}" style="width: 50px;"/>
`}),n!==""&&_(n)}const ee=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],ce=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],_=n=>{const j=v.current;if(j){const L=j.selectionStart,F=j.selectionEnd,R=s.slice(0,L),z=s.slice(F);p(R+n+z),a("memoTxt",R+n+z),setTimeout(()=>{j.selectionStart=j.selectionEnd=L+n.length,j.focus()},100)}},Y=n=>{_(n)},me=n=>n?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(n)||n.includes("image")||n.includes("img"):!1,de=async()=>{const n=await gt("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile.result=",n)},ue=async()=>{const n=await xt("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile10.result=",n);let j="";n.map(L=>{j+=L+`
`}),_(j)},he=async()=>{const n=i("edFilePath");if(n===""){const j=[];let L=v.current.value;L=L.replace(/<img src="\/data\/memo\//g,""),L=L.replace(/ style="width: 50px;"/g,""),L=L.replace(/"\/>/g,""),L=L.replace(/ /g,""),L.split(`
`).forEach(async F=>{F.indexOf(".")>0&&(j.push(F),console.log(F))}),j.length>0&&(console.log(j),await o.onFilePathList(j))}else await o.onFilePath(n)},Z=n=>new Promise((j,L)=>{const F=new Image;F.crossOrigin="anonymous",F.onload=()=>{const R=document.createElement("canvas"),z=R.getContext("2d");R.width=F.width,R.height=F.height,z.drawImage(F,0,0);try{const W=R.toDataURL("image/png");console.log("convertImageToBase64.base64=",W.substring(0,30)+"..."),j(W)}catch(W){L(W)}},F.onerror=()=>{L(new Error("Failed to load image"))},F.src=n});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:$(g),style:{width:"100%",minHeight:"300px",maxHeight:{height:u},display:"flex",flexDirection:"column"},children:[e.jsx(ze,{onSubmit:n=>T(),onCancel:o.onCancel,isSubmitting:D}),e.jsx(Ue,{control:S,onDelete:U,onInsert:H,onRename:I,setContent:O,onFileUpload:le,imageList:o.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(G,{name:"edTitle",placeholder:"제목",control:S,className:"w-full",rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:n=>{n.preventDefault(),a("edTitle",n.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ye,{name:"edGbn",label:"구분",control:S,rules:{required:!0},placeholder:"-- 구분 --",options:ee,className:"",allClassName:"max-w-40",onChange:n=>{n.preventDefault();const j=n.target.value;console.log("edGbn=",i("edGbn")),a("edGbn",j)}}),e.jsx(Oe,{id:"edDate",name:"edDate",placeholder:"Select a date",control:S,onChange:(n,j)=>{console.log({dates:n,currentDateString:j}),a("edDate",j)}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{name:"edUrl",placeholder:"Base64로 만들 URL",control:S,className:"w-full",allClassName:"w-full",onChange:n=>{n.preventDefault();const j=n.target.value;console.log("edUrl=",j),a("edUrl",j),x(j)}}),e.jsx(E,{variant:"outlined",color:"success",className:"w-25 h-9",onClick:n=>{n.preventDefault(),be(i("edUrl2"))},children:"적용"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{name:"edUrl2",placeholder:"Base64 이미지 데이터",className:"w-full",allClassName:"w-full",variant:"filled",size:"md",value:i("edUrl2")||""}),e.jsx(E,{variant:"outlined",color:"success",className:"w-25 h-9",onClick:n=>{n.preventDefault(),ie()},children:"첨부추가"})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(G,{name:"edFilePath",placeholder:"이미지리스트에 추가할 파일명",className:"w-full",allClassName:"w-full",control:S,onChange:n=>{n.preventDefault();const j=n.target.value;a("edFilePath",j)}}),e.jsx(E,{size:"sm",variant:"outlined",color:"success",className:"w-25 h-9",onClick:n=>{n.preventDefault(),he()},children:"파일경로"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),de()},children:"전체파일"}),e.jsx(E,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),ue()},children:"전체파일10"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(ve,{postData:s})})}),e.jsxs("div",{children:[e.jsx(Ae,{ref:v,className:"",value:s,onChange:n=>{a("memoTxt",n),p(n)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>Y(`<box>
</box>`),children:"<Box>"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>Y('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>Y('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>Y('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>Y('<hr style="width=100%"/>'),children:"line"}),ce.map((n,j)=>e.jsx(P,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>Y("<code>"+n+`
</code>`),children:n},j))]})]}),i("edUrl")&&me(i("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:b,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async n=>{try{const j=await Z(b);a("edUrl2",j)}catch(j){console.error("Base64 conversion failed:",j)}},onError:n=>{n.target.style.display="none"}})})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},Ft=o=>{const{rootDb:t,isLoading:c,memoDetailData:s}=o,{scrollYProgress:p}=fe();pe(p,{stiffness:100,damping:30,restDelta:.001});const b=V(),x=m.useRef();x.current=o.searchWord;const{memoId:h}=xe();re();const{user:r}=Q();console.log("memoDetailData=",s);const v=()=>{const f=`/${t==="memo"?"m":t}/${h==="insert"?"":h}`;b(f)},d=async f=>{await K(r.uid,h,f)},u=async f=>{if(console.log("onFilePathList.fileNm=",f),f.length>0)for(let S=0;S<f.length;S++){const a=f[S];console.log("onFilePathList.file=",a);try{const i=await K(r.uid,h,a);console.log("onFilePathList.path=",i)}catch{console.log("onFilePathList.error=",a)}}else await K(r.uid,h,f)},N=async(f,S)=>{console.log("onNewSubmit.values",f);const a=await ne({rootDb:t,uid:r.uid,newData:!1,key:h,values:f});if(await ae(`${t}_txt`,t,a,S),a!==void 0){const i=`/${t==="memo"?"m":t}/${a}`;b(i,{state:{reflash:!0}})}},y=async(f,S)=>{const a=t==="memo"?`${t}/${r.uid}/`:`${t}/`,i=await qe(a,f.key,S,f.ext);if(i.success){const k=t==="memo"?`${t}_txt/${r.uid}/${h}/image/`:`${t}_txt/${h}/image/`;return B(k+f.key,null),f.key=i.key,f.url=i.url,f.name=i.key+"."+f.ext,B(k+i.key,f),console.log("onRename.file",f),f}},$=async(f,S,a)=>{const i=t==="memo"?`${t}_txt/${r.uid}/`:`${t}_txt/`;t==="memo"?`${t}${r.uid}`:`${t}`,await _e(i,t==="memo"?`${t}/${r.uid}/`:`${t}/`,h,S),console.log("onPostSubmit.values",f);const k=await ne({rootDb:t,uid:r.uid,newData:!1,key:h==="insert"?"root":h,values:f});console.log("onPostSubmit.newKey=",k),console.log("onPostSubmit.files=",a);const C=await ae(`${i}`,t==="memo"?`${t}/${r.uid}/`:`${t}/`,h,a);console.log("onNewSubmit.imageResult",C),t==="memo"&&B(`memo_tree/${r.uid}/${h}/title`,f.edTitle);const D=`/${t==="memo"?"m":t}/${h}`;t==="home"&&B("home/tree",null),b(D,{state:{reflash:!0}})};return m.useEffect(()=>{s&&s.title!==void 0&&je({title:s.title,description:s.title});function f(){document.querySelectorAll("pre").forEach((S,a)=>{})}s&&s.memo!==null&&f()},[s]),h===""||r===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",c),s===void 0||c?e.jsx(M,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(M,{}):e.jsx(Lt,{onPostSubmit:$,onNewSubmit:N,onCancel:v,onRename:y,onFilePath:d,onFilePathList:u,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})}))},It=({data:o,onNewMemoBtn:t,title:c,rootDb:s})=>{const{user:p}=Q();return e.jsx("div",{className:"justify-items-center space-y-6",children:e.jsxs("div",{className:"text-center mt-5 mb-7 p-8 bg-white dark:bg-gray-900 rounded-xl shadow-lg",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-3",children:c}),e.jsxs("div",{className:"grid gird-cols-1 md:grid-cols-5 items-center gap-3",children:[p===null?e.jsx("p",{className:"text-red-500 font-semibold text-lg text-left md:col-span-3",children:"로그인해야 이용 가능합니다."}):e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-left md:col-span-3",children:["좌측 사이드 메뉴에서 '새글' 버튼을 사용해 메모를 작성하거나, ",e.jsx("br",{}),"기존 메모를 선택하여 확인하세요."]}),e.jsx("div",{className:"w-full items-center justify-center md:col-span-2",children:e.jsx(ft,{})})]})]})})};function Rt({initTreeData:o,userId:t,memoId:c,onClick:s}){const[p,b]=m.useState(o),x=m.useRef(),h=m.useRef(),r=m.useRef(null),[v,d]=m.useState(0),[u,N]=m.useState({labels:[],series:[]}),{isMobileFooter:y}=Qe(),$=(a,i)=>{if(i.dragSource.id!==void 0&&i.dropTargetId!==void 0){const k=`memo_tree/${t}/${i.dragSource.id}/parent`;B(k,i.dropTargetId)}b(a)};m.useEffect(()=>{(()=>{if(o==null)return;for(const g of o){const T=g.id;g.cnt=o.filter(U=>U.parent===T).length}b(o);const i=o.filter(g=>g.parent==="root").sort((g,T)=>g.text.localeCompare(T.text)),k=(g,T)=>{const U=T.filter(I=>I.parent===g);let H=U.length;for(const I of U)H+=k(I.id,T);return H},C=i.map(g=>g.text),D=i.map(g=>k(g.id,o));N({labels:C,series:D})})()},[o]),m.useEffect(()=>{if(!r.current)return;const a=new ResizeObserver(()=>{r.current&&d(r.current.offsetHeight)});return a.observe(r.current),()=>a.disconnect()},[u]),m.useEffect(()=>{},[o]);const f=(a,i)=>{const k=[],C=D=>{const g=i.find(T=>T.id===D);if(!g)return!1;if(g.parent&&g.parent!=="root"){if(C(g.parent))return k.push(g.parent),!0}else return!0;return!1};return C(a)?k.reverse():[]},S=a=>{if(!p||!a||!h.current)return;const i=f(a,p);i.length>0&&setTimeout(()=>{h.current.open(i)},500)};return m.useEffect(()=>{x.current===void 0&&c!==void 0&&(x.current=c,S(c))},[p]),p===void 0||p===""?e.jsx(M,{}):p===null?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(Pe,{backend:Fe,options:Le(),children:e.jsx("div",{className:`overflow-y-auto scrollbar-hide 
          h-[calc(100vh-235px-var(--chart-height)-var(--footer-height))] 
          min-[875px]:h-[calc(100vh-175px-var(--chart-height)-var(--footer-height))]`,style:{"--chart-height":`${v}px`,"--footer-height":y?"56px":"0px"},children:e.jsx(Ie,{ref:h,tree:p,rootId:"root",onDrop:$,sort:!0,render:(a,{depth:i,isOpen:k,onToggle:C,isDragging:D,isDropTarget:g})=>e.jsxs("div",{className:`flex items-center rounded-sm
                text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 pr-1 mx-1 ${D?"opacity-50":""} ${g?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
                ${x.current===a.id?"bg-gray-200 dark:bg-gray-800 rounded-r-sm border-l-4 border-blue-500":""}
                `,style:{paddingLeft:i*20+(a.cnt===0?5:0)-(x.current===a.id?4:0)},children:[e.jsx("div",{className:"min-w-0",children:a.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:C,children:k?e.jsx(Re,{className:"size-6"}):e.jsx(Ee,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{x.current=a.id,s(a)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[a.icon,a.text]}),a.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",a.cnt,")"]})]})]})})})}),e.jsx("div",{ref:r,children:e.jsx(Te,{series:[{name:"건수",data:u.series}],labels:u.labels,showDownload:!1})})]})}const Et=o=>{const t=m.useRef(null);function c(){o.onSearchDataBtn(t.current.value)}function s(){return o.onNewMemoBtn(),!1}function p(b){b.which===13&&c()}return e.jsxs(e.Fragment,{children:[e.jsx(G,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:t,className:"w-full ",allClassName:"px-3 py-2",placeholder:"Enter Search...",fullWidth:!0,onKeyDownCapture:p}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(E,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:s,children:"새글"}),e.jsx(E,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:b=>c(),children:"조회"})]})]})};async function Pt(o,t,c=""){if(t==null||t==="")return"";if(o==="home"){const v=await De("home/tree");if(v!=null)try{return JSON.parse(v)}catch(d){console.error("Error parsing JSON data:",d)}}const s=o==="home"?"home_txt":c===""?`${o}_tree/${t}`:`${o}_txt/${t}`,p=ye(we(Ce,s)),b=await Ne(p);if(!b.exists())return console.log("getTreeData.null"),null;if(!b.exists())return console.log("getTreeData.exists"),null;const x=b.val(),h=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],r=[];o==="home"&&r.push(...h);for(const v in x){const d=x[v];d.id=v;const u={id:v,key:v,text:d.title,parent:o==="home"?d.gbn:d.parent};o==="memo"?(u.icon=d.bm==="Y"?e.jsx(Be,{className:"text-red-500"}):d.icon==="Y"?e.jsx(vt,{}):null,u.droppable=!0):u.droppable=!1,!((c===""||c===void 0||c===null)&&(u.parent===void 0||u.parent===null||u.parent===""))&&(o==="home"||c===""||c===void 0||c===null?r.push(u):(d.id=v,(d.memo+"").toLowerCase().indexOf(c.toLowerCase())>-1&&(u.parent="root",u.droppable=!1,r.push(u))))}return r.sort((v,d)=>v.title>d.title?1:-1),o==="home"&&B("home/tree",JSON.stringify(r)),r}const Bt=({data:o})=>{const[t,c]=m.useState({labels:[],series:[]});return m.useEffect(()=>{if(o&&o.length>0){const s=o.filter(h=>h.parent==="root").sort((h,r)=>h.text.localeCompare(r.text)),p=(h,r)=>{const v=r.filter(u=>u.parent===h);let d=v.length;for(const u of v)d+=p(u.id,r);return d},b=s.map(h=>h.text),x=s.map(h=>p(h.id,o));c({labels:b,series:x})}else c({labels:[],series:[]})},[o]),e.jsxs(e.Fragment,{children:[e.jsx(nt,{className:"mt-3 ",children:"건수 통계"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 w-full gap-2 justify-center",children:[e.jsx(jt,{series:t.series,labels:t.labels}),e.jsx(Te,{series:[{name:"건수",data:t.series}],labels:t.labels}),e.jsx(bt,{series:[{name:"건수",data:t.series}],labels:t.labels}),e.jsx(kt,{series:t.series,labels:t.labels})]})]})},Js=({rootDb:o})=>{const t=V(),{user:c}=Q(),s=m.useRef(),p=m.useRef(!0),b=m.useRef(),[x,h]=m.useState(),r=m.useRef(!1),v=re(),d=m.useRef(!1);d.current=v?.state?.reflash===!0;const u=et({queryKey:["twTreeData",c?.uid,s.current],queryFn:()=>Pt(o,c?.uid,s.current)});u.data!==void 0&&u.data!==""&&!r.current&&(r.current=!0);const N=()=>{const i=x;i&&(i.bookmark=i.bookmark==="Y"?"N":"Y"),console.log("onBookmark.memoDetailData.bookmark=",i.bookmark),console.log("onBookmark.rootDb=",o);const k=o==="memo"?`memo_tree/${c.uid}/${b.current}/bm`:`home_txt/${b.current}/bookmark`;B(k,x.bookmark),h({...x,bookmark:i.bookmark})};m.useEffect(()=>{c!==void 0&&c!=null&&u.refetch()},[c]),m.useEffect(()=>{const i=async D=>{if(D!==""&&c){const g=await pt(o,c?.uid,D,s.current);o==="memo"&&(g.path=Ut(u.data,D)),g.code==="404"&&(g.title="No title"),p.current=!1,h(g===void 0?{}:g)}else h({})},k=v.pathname.split("/"),C=k.length>2?k[k.length-1]:"";p.current=!0,b.current=C,i(C)},[v.pathname,c,d.current]),m.useEffect(()=>{c!==void 0&&c!=null&&u.refetch()},[d.current]);const y=i=>{r.current=!1,i!==void 0&&(s.current=i),u.refetch()},$=i=>{i.id!==b.current&&(p.current=!0,t(`/${o==="memo"?"m":o}/${i.id}`))},f=()=>{if(c==null){alert("로그인 후 이용 가능합니다.");return}const i=`/${o==="memo"?"m":o}/insert/insert`;t(i)},S=i=>{},a=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3 flex items-center justify-center",children:e.jsx(st,{to:o==="memo"?"/m":"/home",children:o==="memo"?"메모장":"홈관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[o==="memo"?"":e.jsx(oe,{to:"/m",children:"메모"}),o==="memo"&&c?.uid===$e?e.jsx(oe,{to:"/home",children:"홈관리"}):null,e.jsx(oe,{to:"/todo",children:"TODO"}),e.jsx(oe,{to:"/tw",children:"Sheet"})]}),c!==null&&e.jsx(Et,{onNewMemoBtn:f,onSearchDataBtn:y}),r.current&&u.isFetched?e.jsx(Rt,{initTreeData:u.data,userId:c?.uid,memoId:b.current,onClick:$}):c===null?e.jsx(e.Fragment,{}):e.jsx(M,{})]});return e.jsxs(Ze,{sideType:"memo",title:o==="memo"?"메모장":"홈페이지관리",sideContents:a,children:[e.jsx(m.Suspense,{fallback:e.jsx(M,{}),children:e.jsxs(Xe,{children:[e.jsx(X,{path:"/edit/:memoId",element:e.jsx(ke,{rootDb:o,isLoading:p.current,searchWord:s.current,memoDetailData:x})}),e.jsx(X,{path:"/insert/:memoId",element:e.jsx(ke,{rootDb:o,isLoading:p.current,searchWord:s.current,memoDetailData:x})}),e.jsx(X,{path:"/util/:memoId",element:e.jsx(Ft,{rootDb:o,isLoading:p.current,searchWord:s.current,memoDetailData:x})}),e.jsx(X,{path:"/:memoId",element:e.jsx(Nt,{rootDb:o,isLoading:p.current,searchWord:s.current,memoDetailData:x,onTreeUpdate:y,onBookmark:N,data:u.data})}),e.jsx(X,{path:"*",element:e.jsx(It,{searchWord:s.current,data:u.data,onNewMemoBtn:f,title:o==="memo"?"메모장":"홈페이지관리",rootDb:o})})]})}),o==="memo"?e.jsx(wt,{onSelected:S}):null,b.current===""?e.jsx(Bt,{data:u.data}):null,e.jsx(tt,{})]})},Ut=(o,t)=>{let c=[],s=t;if(!o)return c;const p=o.find(b=>b.id===s);for(c.unshift(p),s=p?.parent;s!=null&&s!==""&&s!=="root";){const b=o.find(x=>x.id===s);s=b?.parent,c.unshift(b)}return c};export{Js as default};
