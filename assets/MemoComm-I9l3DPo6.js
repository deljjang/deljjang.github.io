const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MemoSheet-DJPRhedl.js","assets/index-CEJkszmk.js","assets/index-Dksd_SFz.css","assets/TwToast-BNMv6fVA.js","assets/MemoSheetGrid-CmKBXbIO.js","assets/MemoDetailEdit-sqjF84NI.js","assets/useMemoMutation-BBfYANIb.js","assets/Delete-DD-fI4XB.js","assets/Divider-D5ZMPGLC.js","assets/TwCheckbox-BQRwUfCI.js","assets/TwTextArea-BkgiLIYh.js","assets/SinySelect-C9mMSfVv.js","assets/Grid-vuX5M0P0.js","assets/index-Bkvq60V9.js","assets/TextField-C2eLljp9.js","assets/InputAdornment-B-yzVjYp.js","assets/Popper-BxE4ebk3.js","assets/Button-CFC5iSHv.js","assets/Chip-CyQ1oIZD.js","assets/HomeChartSemiDonut-B6GB3Zor.js","assets/Favorite-CmpfouQs.js","assets/angle-right-CBYGxBfi.js","assets/MemoDetailEdit-Cmdt2tIm.css","assets/MemoDetailUtil-C8eOBUxn.js","assets/HomeChartVisitors-BJ4J2aG9.js"])))=>i.map(i=>d[i]);
import{cn as B,co as $e,cp as Ie,cq as Je,cr as Ue,cs as Xe,ct as Ze,cu as De,cv as Ce,cw as et,cx as tt,cy as Se,cz as R,cA as _e,r as v,cB as st,cC as Ee,cD as me,cE as nt,cF as E,K as N,by as Me,bz as ze,E as K,G as Q,cG as rt,cH as at,cI as it,cJ as ot,i as W,j as s,a9 as T,cK as lt,p as G,o as ct,f as I,t as L,D as se,cL as V,bo as _,z as x,cM as D,l as O,m as ee,cN as dt,M as ue,a7 as he,q as mt,bG as ut,cO as ht,cf as fe,k as ne,bE as ft,bv as Te,J as Le,br as Oe,cP as gt,cQ as xt,cl as pt,bF as Be,cR as vt,cS as yt,bw as wt,cT as We,R as jt,c as z,_ as H,cU as kt,cV as bt,cW as Nt,cX as $t,cY as Ct,cZ as St,c_ as _t,Q as Et,c$ as Mt,d0 as zt,d1 as Tt}from"./index-CEJkszmk.js";import{H as Lt,a as Ot,b as Bt}from"./HomeChartSemiDonut-B6GB3Zor.js";import{F as Wt}from"./Favorite-CmpfouQs.js";import{a as Ht,S as He,b as Ft,c as Rt}from"./angle-right-CBYGxBfi.js";function Fe(e,t){let r;const a=()=>{const{currentTime:n}=t,l=(n===null?0:n.value)/100;r!==l&&e(l),r=l};return B.update(a,!0),()=>$e(a)}const q=new WeakMap;let M;function At(e,t){if(t){const{inlineSize:r,blockSize:a}=t[0];return{width:r,height:a}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function Pt({target:e,contentRect:t,borderBoxSize:r}){var a;(a=q.get(e))===null||a===void 0||a.forEach(n=>{n({target:e,contentSize:t,get size(){return At(e,r)}})})}function Vt(e){e.forEach(Pt)}function qt(){typeof ResizeObserver>"u"||(M=new ResizeObserver(Vt))}function Yt(e,t){M||qt();const r=Ie(e);return r.forEach(a=>{let n=q.get(a);n||(n=new Set,q.set(a,n)),n.add(t),M?.observe(a)}),()=>{r.forEach(a=>{const n=q.get(a);n?.delete(t),n?.size||M?.unobserve(a)})}}const Y=new Set;let A;function Kt(){A=()=>{const e={width:window.innerWidth,height:window.innerHeight},t={target:window,size:e,contentSize:e};Y.forEach(r=>r(t))},window.addEventListener("resize",A)}function Qt(e){return Y.add(e),A||Kt(),()=>{Y.delete(e),!Y.size&&A&&(A=void 0)}}function Gt(e,t){return typeof e=="function"?Qt(e):Yt(e,t)}const It=50,ge=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Jt=()=>({time:0,x:ge(),y:ge()}),Ut={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function xe(e,t,r,a){const n=r[t],{length:i,position:l}=Ut[t],c=n.current,m=r.time;n.current=e[`scroll${l}`],n.scrollLength=e[`scroll${i}`]-e[`client${i}`],n.offset.length=0,n.offset[0]=0,n.offset[1]=n.scrollLength,n.progress=Je(0,n.scrollLength,n.current);const o=a-m;n.velocity=o>It?0:Ue(n.current-c,o)}function Xt(e,t,r){xe(e,"x",t,r),xe(e,"y",t,r),t.time=r}function Zt(e,t){const r={x:0,y:0};let a=e;for(;a&&a!==t;)if(a instanceof HTMLElement)r.x+=a.offsetLeft,r.y+=a.offsetTop,a=a.offsetParent;else if(a.tagName==="svg"){const n=a.getBoundingClientRect();a=a.parentElement;const i=a.getBoundingClientRect();r.x+=n.left-i.left,r.y+=n.top-i.top}else if(a instanceof SVGGraphicsElement){const{x:n,y:i}=a.getBBox();r.x+=n,r.y+=i;let l=null,c=a.parentNode;for(;!l;)c.tagName==="svg"&&(l=c),c=a.parentNode;a=l}else break;return r}const te={start:0,center:.5,end:1};function pe(e,t,r=0){let a=0;if(e in te&&(e=te[e]),typeof e=="string"){const n=parseFloat(e);e.endsWith("px")?a=n:e.endsWith("%")?e=n/100:e.endsWith("vw")?a=n/100*document.documentElement.clientWidth:e.endsWith("vh")?a=n/100*document.documentElement.clientHeight:e=n}return typeof e=="number"&&(a=t*e),r+a}const Dt=[0,0];function es(e,t,r,a){let n=Array.isArray(e)?e:Dt,i=0,l=0;return typeof e=="number"?n=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?n=e.split(" "):n=[e,te[e]?e:"0"]),i=pe(n[0],r,a),l=pe(n[1],t),i-l}const ts={All:[[0,0],[1,1]]},ss={x:0,y:0};function ns(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function rs(e,t,r){const{offset:a=ts.All}=r,{target:n=e,axis:i="y"}=r,l=i==="y"?"height":"width",c=n!==e?Zt(n,e):ss,m=n===e?{width:e.scrollWidth,height:e.scrollHeight}:ns(n),o={width:e.clientWidth,height:e.clientHeight};t[i].offset.length=0;let d=!t[i].interpolate;const u=a.length;for(let y=0;y<u;y++){const h=es(a[y],o[l],m[l],c[i]);!d&&h!==t[i].interpolatorOffsets[y]&&(d=!0),t[i].offset[y]=h}d&&(t[i].interpolate=Xe(t[i].offset,Ze(a),{clamp:!1}),t[i].interpolatorOffsets=[...t[i].offset]),t[i].progress=De(0,1,t[i].interpolate(t[i].current))}function as(e,t=e,r){if(r.x.targetOffset=0,r.y.targetOffset=0,t!==e){let a=t;for(;a&&a!==e;)r.x.targetOffset+=a.offsetLeft,r.y.targetOffset+=a.offsetTop,a=a.offsetParent}r.x.targetLength=t===e?t.scrollWidth:t.clientWidth,r.y.targetLength=t===e?t.scrollHeight:t.clientHeight,r.x.containerLength=e.clientWidth,r.y.containerLength=e.clientHeight}function is(e,t,r,a={}){return{measure:()=>as(e,a.target,r),update:n=>{Xt(e,r,n),(a.offset||a.target)&&rs(e,r,a)},notify:()=>t(r)}}const F=new WeakMap,ve=new WeakMap,X=new WeakMap,ye=e=>e===document.documentElement?window:e;function re(e,{container:t=document.documentElement,...r}={}){let a=X.get(t);a||(a=new Set,X.set(t,a));const n=Jt(),i=is(t,e,n,r);if(a.add(i),!F.has(t)){const c=()=>{for(const y of a)y.measure()},m=()=>{for(const y of a)y.update(Ce.timestamp)},o=()=>{for(const y of a)y.notify()},d=()=>{B.read(c,!1,!0),B.read(m,!1,!0),B.update(o,!1,!0)};F.set(t,d);const u=ye(t);window.addEventListener("resize",d,{passive:!0}),t!==document.documentElement&&ve.set(t,Gt(t,d)),u.addEventListener("scroll",d,{passive:!0})}const l=F.get(t);return B.read(l,!1,!0),()=>{var c;$e(l);const m=X.get(t);if(!m||(m.delete(i),m.size))return;const o=F.get(t);F.delete(t),o&&(ye(t).removeEventListener("scroll",o),(c=ve.get(t))===null||c===void 0||c(),window.removeEventListener("resize",o))}}function os({source:e,container:t,axis:r="y"}){e&&(t=e);const a={value:0},n=re(i=>{a.value=i[r].progress*100},{container:t,axis:r});return{currentTime:a,cancel:n}}const Z=new Map;function Re({source:e,container:t=document.documentElement,axis:r="y"}={}){e&&(t=e),Z.has(t)||Z.set(t,{});const a=Z.get(t);return a[r]||(a[r]=tt()?new ScrollTimeline({source:t,axis:r}):os({source:t,axis:r})),a[r]}function ls(e){return e.length===2}function Ae(e){return e&&(e.target||e.offset)}function cs(e,t){return ls(e)||Ae(t)?re(r=>{e(r[t.axis].progress,r)},t):Fe(e,Re(t))}function ds(e,t){if(e.flatten(),Ae(t))return e.pause(),re(r=>{e.time=e.duration*r[t.axis].progress},t);{const r=Re(t);return e.attachTimeline?e.attachTimeline(r,a=>(a.pause(),Fe(n=>{a.time=a.duration*n},r))):et}}function ms(e,{axis:t="y",...r}={}){const a={axis:t,...r};return typeof e=="function"?cs(e,a):ds(e,a)}function we(e,t){st(!!(!t||t.current))}const us=()=>({scrollX:R(0),scrollY:R(0),scrollXProgress:R(0),scrollYProgress:R(0)});function hs({container:e,target:t,layoutEffect:r=!0,...a}={}){const n=Se(us);return(r?_e:v.useEffect)(()=>(we("target",t),we("container",e),ms((l,{x:c,y:m})=>{n.scrollX.set(c.current),n.scrollXProgress.set(c.progress),n.scrollY.set(m.current),n.scrollYProgress.set(m.progress)},{...a,container:e?.current||void 0,target:t?.current||void 0})),[e,t,JSON.stringify(a.offset)]),n}function fs(e){const t=Se(()=>R(e)),{isStatic:r}=v.useContext(Ee);if(r){const[,a]=v.useState(e);v.useEffect(()=>t.on("change",a),[])}return t}function je(e){return typeof e=="number"?e:parseFloat(e)}function gs(e,t={}){const{isStatic:r}=v.useContext(Ee),a=v.useRef(null),n=fs(me(e)?je(e.get()):e),i=v.useRef(n.get()),l=v.useRef(()=>{}),c=()=>{const o=a.current;o&&o.time===0&&o.sample(Ce.delta),m(),a.current=nt({keyframes:[n.get(),i.current],velocity:n.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...t,onUpdate:l.current})},m=()=>{a.current&&a.current.stop()};return v.useInsertionEffect(()=>n.attach((o,d)=>r?d(o):(i.current=o,l.current=d,B.update(c),n.get()),m),[JSON.stringify(t)]),_e(()=>{if(me(e))return e.on("change",o=>n.set(je(o)))},[n]),n}const xs=async(e,t)=>(await E(e)===void 0||N(e,null),N(t,null),"OK"),Rs=async({rootDb:e,uid:t,newData:r=!1,key:a,values:n})=>{const i=e==="memo"?`${e}_txt/${t}/`:`${e}_txt/`,l=e==="memo"?`${e}_tree/${t}/`:`${e}/`;let c=a;r&&(c=Me(ze(K(Q),l)).key),console.log("setFireDetailData.values=",n);const m=i+c;return N(m+"/title",n.edTitle),n.htmlCheck==="N"||n.htmlCheck==="sheet"?N(m+"/memo",n.memoTxt):N(m+"/memo",n.content),N(m+"/date",n.edDate),N(m+"/gbn",n.edGbn),N(m+"/html",n.htmlCheck),r&&e!=="home"&&(N(`${l}/${c}/key`,c),N(`${l}/${c}/parent`,a)),e!=="home"&&(N(`${l}${c}/title`,n.edTitle),N(`${l}${c}/icon`,n.iconCheck)),c},As=async(e,t,r,a)=>{if(a!==void 0)for(let n=0;n<a.length;n++){const i=a[n];i.del==="Y"&&(N(`${e}/${r}/image/${i.key}`,null),rt(t,r,i))}},Ps=async(e,t,r,a)=>{for(let n=0;n<a.length;n++){const i=a[n].object,c={ext:at(i.name),name:i.name,use:"Y",sever:""},m=Me(ze(K(Q),e+"/image")).key,o=await it(t,r,m,i);c.sever=ot(o.metadata.name);const d=`${e}${r}/image/${c.sever}`;N(d,c)}},ke=e=>{const{t}=W();return s.jsxs("div",{className:"mx-auto grid w-full max-w-lg grid-cols-5 items-center justify-center gap-2 px-4 py-2 text-center",children:[e.master&&s.jsx(T,{size:"sm",variant:"outlined",color:"brand",onClick:e.onUtil,className:"gap-1.5",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),s.jsx("span",{className:"ml-2 whitespace-nowrap",children:t("util")})]})}),s.jsx(T,{size:"sm",variant:"outlined",color:"brand",onClick:e.onEdit,className:"gap-1.5",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),s.jsx("path",{d:"m15 5 4 4"})]}),s.jsx("span",{className:"ml-2 whitespace-nowrap",children:t("edit")})]})}),s.jsx(T,{size:"sm",variant:"outlined",color:"brand",onClick:e.onNewMemo,className:"gap-1.5",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M5 12h14"}),s.jsx("path",{d:"M12 5v14"})]}),s.jsx("span",{className:"ml-2 whitespace-nowrap",children:t("new")})]})}),s.jsx(T,{size:"sm",variant:"outlined",color:"error",onClick:e.onDelete,className:"gap-1.5",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M3 6h18"}),s.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),s.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),s.jsx("span",{className:"ml-2 whitespace-nowrap",children:t("delete")})]})}),e.onCopy&&s.jsx(T,{size:"sm",variant:"outlined",color:"secondary",onClick:e.onCopy,className:"gap-1.5",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}),s.jsx("span",{className:"ml-2 whitespace-nowrap",children:t("public")})]})})]})},ps=({rootDb:e,memoDetailData:t,onBookmark:r,searchWord:a,onDeleteTab:n})=>{const[i,l]=v.useState(!1),{alertInfo:c,setAlertInfo:m,resetAlertInfo:o}=lt(),[d,u]=v.useState(!1),[y,h]=v.useState(""),[p,k]=v.useState(!1),{t:f}=W(),{scrollYProgress:w}=hs(),b=gs(w,{stiffness:100,damping:30,restDelta:.001}),C=G(),{memoId:j}=ct(),J=I()?.state?.fullIndex,{user:S}=L(),U=se(),Pe=V({mutationFn:async()=>{const g=e==="memo"?`${e}_txt/${S.uid}/${j}`:`${e}_txt/${j}`,$=e==="memo"?`${e}_tree/${S.uid}/${j}`:`${e}/${j}`;return await xs(g,$)},onSuccess:()=>{U.invalidateQueries({queryKey:["twTreeData",e]}),n&&n(j),C(`/${e==="memo"?"m":e}`)},onError:g=>{console.error("삭제 중 오류 발생:",g)}}),Ve=V({mutationFn:async()=>{if(!S||!j||e!=="memo")throw new Error("Only private memos can be copied.");`${S.uid}${j}`;const g=t;if(!g)throw new Error("Memo data not found.");const $=`home_txt/${j}`;await N($,g);const de=`memo_tree/${S.uid}/${j}`,Ge=`home/${j}`;await N(`${de}/public`,"Y"),await N(Ge,{...g,key:j,text:g.title})},onSuccess:()=>{m({isOpen:!0,title:f("complete"),message:f("copy_completed"),color:"success",onConfirm:o,onClose:o}),U.invalidateQueries({queryKey:["memoDetail","home",S?.uid,j]})},onError:g=>{console.error("Copy failed:",g);const $=`${f("copy_failed")} ${g.message?`: ${g.message}`:""}`;m({isOpen:!0,title:f("error"),message:$,color:"error",onConfirm:o,onClose:o})}}),qe=V({mutationFn:async g=>{const $=e==="memo"?`memo_txt/${S.uid}/${j}/memo`:`home_txt/${j}/memo`;return await N($,g),g},onSuccess:g=>{U.setQueryData(["memoDetail",e,S?.uid,j],$=>({...$,memo:g})),u(!1)},onError:g=>{console.error("메모 저장 중 오류 발생:",g)}}),Ye=()=>{qe.mutate(y)},Ke=()=>{h(t?.memo||""),u(!0)},ae=()=>{const g=`/${e==="memo"?"m":e}/edit/${j}`;C(g,{state:{fullIndex:J}})},ie=()=>{const g=`/${e==="memo"?"m":e}/util/${j}`;C(g,{state:{fullIndex:J}})},oe=()=>{const g=`/${e==="memo"?"m":e}/insert/${j}`;C(g,{state:{fullIndex:J}})},le=()=>{l(!0)},ce=()=>{Ve.mutate()},Qe=()=>{l(!1),Pe.mutate()};return v.useEffect(()=>{function g(){const $=t.scrollY?t.scrollY:0;window.scrollTo({top:$})}t&&t.memo!==null&&(g(),t.image&&t.image.map(($,de)=>$))},[t]),j===""||S===void 0?s.jsx(s.Fragment,{}):s.jsxs("div",{className:"MemoDetail py-2 relative",children:[s.jsx(_.div,{className:`progress-bar sticky ${p?"top-28":"top-16"} z-10`,style:{scaleX:b}}),s.jsxs("div",{className:"overflow-hidden ",children:[s.jsxs("div",{className:"sticky top-0 z-20 bg-white/80 dark:bg-zinc-900/80 backdrop-blur-sm",children:[s.jsxs("div",{className:"p-2 sm:p-4",children:[s.jsxs("div",{className:x.between,children:[s.jsxs("p",{className:`${x.truncate} ${x.textXs} ${x.textGray500DarkZinc400}`,children:[s.jsx(D,{to:e==="memo"?"/m":"/hmoe",className:`${x.navLinkHoverText}`,children:e==="memo"?"MEMO":"HOME"}),t?.path?.map((g,$)=>t.path.length===$+1?` > ${g?.title}`:s.jsxs(O.Fragment,{children:[" "," > ",s.jsx(D,{to:e==="memo"?`/m/${g.id}`:`/home/${g.id}`,className:`${x.navLinkHoverText}`,children:g?.title})]},$))]}),s.jsx(_.button,{whileTap:{scale:.8},className:`${x.flexShrink0} ${x.roundedFull} p-2 ${x.buttonHoverGrayLight}`,"aria-label":f("bookmark"),onClick:r,children:t?.bookmark==="Y"?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`${x.h5W5} ${x.textRed500}`,fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}):s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`${x.h5W5} ${x.textGray500}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})})]}),s.jsx("button",{onClick:()=>k(!p),className:`text-left ${x.heading2XlBoldSm3Xl} ${x.textGray900}`,children:t?.title})]}),!p&&s.jsx("div",{className:`${x.line}`}),s.jsx(_.div,{initial:!1,animate:{height:p?"auto":0,opacity:p?1:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:s.jsx("div",{className:`${x.line}`,children:s.jsx(ke,{master:S?.uid===ee,rootDb:e,onEdit:ae,onUtil:ie,onNewMemo:oe,onDelete:le,onCopy:e==="memo"?ce:null})})})]}),t&&t.html==="sheet"&&s.jsx(dt,{rootDb:e,detailData:t}),s.jsxs("div",{className:`MemoDetail_Content ${t?.memo?.length>0?"p-2 sm:p-4":"p-1"}`,onDoubleClick:Ke,children:[d?s.jsxs("div",{className:`${x.card} p-4`,children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(ue,{children:f("input")}),s.jsx("textarea",{className:"w-full h-64 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",value:y,onChange:g=>h(g.target.value),autoFocus:!0})]}),s.jsxs("div",{children:[s.jsx(ue,{children:f("preview")}),s.jsx("div",{className:"prose dark:prose-invert max-w-none p-2 border rounded h-64 overflow-y-auto dark:bg-gray-700 dark:border-gray-600",children:s.jsx(he,{postData:y,highlightWord:""})})]})]}),s.jsxs("div",{className:"mt-2 flex justify-end gap-2",children:[s.jsx(T,{variant:"outlined",color:x.button.indigo,size:"sm",onClick:()=>u(!1),children:f("cancel")}),s.jsx(T,{color:x.button.indigo,onClick:Ye,children:f("save")})]})]}):t&&t.html!=="sheet"?t?.html==="N"?s.jsx(he,{postData:t?.memo,highlightWord:a}):t?.html!=="N"&&t?.memo&&s.jsx(mt,{text:t.memo}):"",s.jsx(ut,{imageList:t?.image}),!t&&s.jsx("div",{className:"flex justify-center py-12",children:s.jsx("div",{className:`${x.flexCenter} py-12`})})]})]}),s.jsx(ht,{rootDb:e,memoId:j,readOnly:!1}),s.jsx(_.div,{initial:!1,animate:{height:p?"auto":0,opacity:p?1:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:s.jsx("div",{className:`${x.line}`,children:s.jsx(ke,{master:S?.uid===ee,rootDb:e,onEdit:ae,onUtil:ie,onNewMemo:oe,onDelete:le,onCopy:e==="memo"?ce:null})})}),s.jsx(fe,{isOpen:i,size:"sm",color:"warning",title:f("delete_confirm_title"),message:f("delete_confirm_message"),onClose:()=>l(!1),onConfirm:Qe}),s.jsx(fe,{...c})]})},vs=async(e,t)=>{const r=[];let a=t;if(!e||!a)return r;for(;a&&a!=="root";){const n=await E(`memo_tree/${e}/${a}`);if(!n)break;r.unshift({id:a,...n}),a=n.parent}return r};function ys(e,t,r,a){const n=se(),{data:i,isLoading:l}=ne({queryKey:["memoDetail",e,t?.uid,r],queryFn:async()=>{if(!r||!t||r==="insert")return{};if(e==="memo"||e==="home"){const o=await ft(e,t.uid,r);if(o&&e==="memo"){o.path=await vs(t?.uid,r);const d=await E(`memo_tree/${t.uid}/${r}/bm`);o.bookmark=d==="Y"?"Y":"N"}return o||{}}else if(e==="sheet")return{title:await E(`memo_sheet/${t.uid}/${r}/title`)}},enabled:!!t&&!!r,staleTime:1e3*60*5}),{mutate:c}=V({mutationFn:async o=>{const d=e==="memo"?`memo_tree/${t.uid}/${r}/bm`:`home_txt/${r}/bookmark`;await N(d,o)},onMutate:async o=>{await n.cancelQueries({queryKey:["memoDetail",e,t?.uid,r]});const d=n.getQueryData(["memoDetail",e,t?.uid,r]);return n.setQueryData(["memoDetail",e,t?.uid,r],u=>({...u,bookmark:o})),{previousMemoDetail:d}},onError:(o,d,u)=>{n.setQueryData(["memoDetail",e,t?.uid,r],u.previousMemoDetail)},onSettled:()=>{n.invalidateQueries({queryKey:["memoDetail",e,t?.uid,r],refetchType:"all"}),n.invalidateQueries({queryKey:["twTreeData",e],refetchType:"all"}),n.invalidateQueries({queryKey:["bookmarks",t?.uid],refetchType:"all"}),a(!0)}});return{memoDetailData:i,isLoading:l,onBookmark:()=>{if(!i)return;const o=i.bookmark==="Y"?"N":"Y";c(o)}}}async function ws(e,t,r=""){if(t==null||t==="")return"";if(e==="home"){const o=await E("home/tree");if(o!=null)try{return JSON.parse(o)}catch(d){console.error("Error parsing JSON data:",d)}}const a=e==="home"?"home_txt":r===""?`${e}_tree/${t}`:`${e}_txt/${t}`,n=Te(K(Q,a)),i=await Le(n);if(!i.exists()||!i.exists())return null;const l=i.val(),c=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],m=[];e==="home"&&m.push(...c);for(const o in l){const d=l[o];d.id=o;const u={id:o,key:o,text:d.title,parent:e==="home"?d.gbn:d.parent};e==="memo"?(u.icon=d.bm==="Y"?s.jsx(Wt,{className:"text-red-500"}):d.icon==="Y"?s.jsx(Ht,{}):null,u.droppable=!0):u.droppable=!1,!((r===""||r===void 0||r===null)&&(u.parent===void 0||u.parent===null||u.parent===""))&&(e==="home"||r===""||r===void 0||r===null?m.push(u):(d.id=o,(d.memo+"").toLowerCase().indexOf(r.toLowerCase())>-1&&(u.parent="root",u.droppable=!1,m.push(u))))}return m.sort((o,d)=>o.title>d.title?1:-1),e==="home"&&N("home/tree",JSON.stringify(m)),m}const js=({rootDb:e})=>{const{user:t}=L(),[r,a]=Oe(gt(e)),{t:n}=W(),[i,l]=v.useState({labels:[],series:[]}),c=["#6366f1","#3b82f6","#22c55e","#ef4444","#f97316","#eab308","#8b5cf6","#d946ef","#14b8a6","#a855f7"],m=async()=>{const u=await ws(e==="sheet"?"memo":e,t?.uid);o(u)};v.useEffect(()=>{r&&r.labels&&r.labels.length>0?l(r):m()},[e,t,r,a]);const o=u=>{if(u&&u.length>0){const y=u.filter(w=>w.parent==="root").sort((w,b)=>w.text.localeCompare(b.text)),h=(w,b)=>{const C=b.filter(P=>P.parent===w);let j=C.length;for(const P of C)j+=h(P.id,b);return j},p=y.map(w=>w.text),k=y.map(w=>h(w.id,u)),f={labels:p,series:k};l(f),a(f)}},d=()=>{m()};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`HomeChartForm ${x.between} bg-[#f1f1f1] dark:bg-[#181818] p-2`,children:[s.jsx("div",{className:"px-6 py-5",children:s.jsx(xt,{title:n("count_stats")})}),s.jsx("button",{onClick:d,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors mr-2","aria-label":n("reload_chart"),children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-600 dark:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h5M20 20v-5h-5M4 4l1.5 1.5A9 9 0 0121.5 12M20 20l-1.5-1.5A9 9 0 012.5 12"})})})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 w-full gap-2 justify-center",children:[s.jsx(Lt,{series:i.series,labels:i.labels,colors:c}),s.jsx(pt,{series:[{name:n("count"),data:i.series}],labels:i.labels,colors:c}),s.jsx(Ot,{series:[{name:n("count"),data:i.series}],labels:i.labels,colors:c}),s.jsx(Bt,{series:i.series,labels:i.labels,colors:c})]})]})},ks=({rootDb:e})=>{const{user:t}=L(),{t:r}=W(),a=r(e==="memo"?"appMemo":"home_mng"),n=s.jsx("div",{className:"text-center",children:s.jsx("h1",{className:`text-3xl font-bold ${x.textIndigo}`,children:a})});return s.jsx(s.Fragment,{children:s.jsx(Be,{title:n,className:"my-5",children:s.jsxs("div",{className:"grid gird-cols-1 md:grid-cols-5 items-center gap-3",children:[t===null?s.jsx("p",{className:`${x.textRed500} ${x.textLgFontSemiboldLeft} ${x.mdColSpan3}`,children:r("login_used")}):s.jsx("p",{className:`${x.textGray600DarkZinc400} text-left ${x.mdColSpan3}`,dangerouslySetInnerHTML:{__html:r("memo_main_guide").replace(`
`,"<br/>")}}),s.jsx("div",{className:`w-full ${x.flexCenter} md:col-span-2`,children:s.jsx(vt,{})})]})})})},bs=({item:e})=>{const{user:t}=L(),r=G();return s.jsx("div",{onClick:()=>r(`/m/${e.key}`),className:`${x.roundedXl} border border-gray-200 
      bg-white dark:border-gray-800 dark:bg-white/[0.03] 
      overflow-hidden cursor-pointer hover:shadow-md transition-shadow h-full flex flex-col`,children:s.jsx("div",{className:"px-4 py-3",children:s.jsx("h3",{className:"text-base font-medium text-gray-800 dark:text-white/90 truncate",children:e.title})})})};function Ns(){const{user:e}=L(),{t}=W(),{data:r,isLoading:a}=ne({queryKey:["bookmarks",e?.uid],queryFn:async()=>{const l=[],c=Te(K(Q,`memo_tree/${e.uid}`),wt("bm"),yt("Y")),m=await Le(c);if(!m.exists())return[];const o=m.val();for(let d in o){const u=o[d];u.id=d,u.key=d,u.text=u.title,l.push(u)}return l.sort((d,u)=>d.title>u.title?1:-1),l},enabled:!!e}),n="grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-6",i=()=>s.jsx("div",{className:`grid ${n} gap-3 p-4`,children:[...Array(8)].map((l,c)=>s.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"},c))});return e===null?s.jsx(s.Fragment,{}):s.jsx(Be,{title:t("main_list"),children:s.jsx("div",{className:"p-2",children:a?s.jsx(i,{}):s.jsx("div",{className:`grid ${n} gap-3`,children:r?.map(l=>s.jsx(bs,{item:l},l.id))})})})}O.lazy(()=>H(()=>import("./MemoSheet-DJPRhedl.js"),__vite__mapDeps([0,1,2,3])));const $s=O.lazy(()=>H(()=>import("./MemoSheetGrid-CmKBXbIO.js"),__vite__mapDeps([4,1,2,3]))),be=O.lazy(()=>H(()=>import("./MemoDetailEdit-sqjF84NI.js"),__vite__mapDeps([5,1,2,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),Cs=O.lazy(()=>H(()=>import("./MemoDetailUtil-C8eOBUxn.js"),__vite__mapDeps([23,1,2,10,6,7,8,19,20,21]))),Ss=O.lazy(()=>H(()=>import("./index-CEJkszmk.js").then(e=>e.dI),__vite__mapDeps([1,2]))),_s=O.lazy(()=>H(()=>import("./HomeChartVisitors-BJ4J2aG9.js"),__vite__mapDeps([24,1,2]))),Es=({rootDb:e,ui:t,user:r,memoId:a,memoDetailData:n,isLoading:i,onBookmark:l,handleCloseTab:c})=>{const m=I();return s.jsxs(v.Suspense,{fallback:s.jsx(Ne,{}),children:[s.jsx(We,{mode:"wait",children:s.jsxs(jt,{location:m,children:[s.jsx(z,{path:"todo",element:s.jsx(_.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:s.jsx(Ss,{})})}),s.jsx(z,{path:"sheet/:sheetId?",element:s.jsx(_.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:s.jsx($s,{detailData:n})})}),s.jsx(z,{path:"edit/:memoId",element:s.jsx(_.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:s.jsx(be,{rootDb:e,isLoading:i,memoDetailData:n,ui:t})})}),s.jsx(z,{path:"insert/:memoId",element:s.jsx(_.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:s.jsx(be,{rootDb:e,isLoading:i,memoDetailData:n,ui:t})})}),s.jsx(z,{path:"util/:memoId",element:s.jsx(_.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:s.jsx(Cs,{rootDb:e,isLoading:i,memoDetailData:n})})}),s.jsx(z,{path:":memoId",element:s.jsx(s.Fragment,{children:i?s.jsx(Ne,{}):s.jsx(ps,{rootDb:e,memoDetailData:n,onBookmark:l,onDeleteTab:()=>c(null,{id:a})})})}),s.jsx(z,{path:"/",element:s.jsx(_.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:s.jsx(ks,{rootDb:e,ui:t})})})]},m.pathname)}),(e==="memo"||e==="sheet")&&s.jsx(Ns,{}),(a===""||a==="m")&&r?.uid===ee&&s.jsxs(s.Fragment,{children:[s.jsx(_s,{}),s.jsx("div",{className:`mt-5 ${x.card}`,children:s.jsx(js,{rootDb:e})})]})]})},Ne=()=>s.jsxs("div",{className:"MemoDetail py-2 relative",children:[s.jsxs("div",{className:"overflow-hidden",children:[s.jsxs("div",{className:"p-2 sm:p-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded-md w-1/2 animate-shimmer relative overflow-hidden"}),s.jsx("div",{className:"h-6 w-6 bg-gray-300 dark:bg-zinc-700 rounded-full animate-shimmer relative overflow-hidden"})]}),s.jsx("div",{className:"mt-3 h-8 bg-gray-300 dark:bg-zinc-700 rounded-md w-3/4 animate-shimmer relative overflow-hidden"})]}),s.jsx("div",{className:`${x.line} my-2`}),s.jsxs("div",{className:"p-2 sm:p-4 space-y-6 animate-shimmer relative overflow-hidden",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-full "}),s.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-5/6 "}),s.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-full "})]}),s.jsx("div",{className:"h-48 bg-gray-300 dark:bg-zinc-700 rounded-lg "}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-4/6 "}),s.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-full "})]})]})]}),s.jsx("div",{className:`NotionStyleEditor ${x.card} mt-1 py-4 border-gray-200 dark:border-zinc-700`,children:s.jsxs("div",{className:"mb-4 space-y-4 p-2 ",children:[s.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),s.jsx("div",{className:"h-20 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})]})})]}),Ms=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",...e,children:s.jsx("path",{fillRule:"evenodd",d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM6 20V4h7v5h5v11H6zM8 12h3v3H8v-3zm0 4h3v3H8v-3zm4-4h3v3h-3v-3zm0 4h3v3h-3v-3z",clipRule:"evenodd"})}),zs=({tabInfo:e,handleCloseTab:t,isActive:r})=>{const{t:a}=W(),{user:n}=L(),{attributes:i,listeners:l,setNodeRef:c,transform:m,transition:o,isDragging:d}=kt({id:e.id}),u={transform:bt.Transform?.toString(m),transition:o,zIndex:d?1:"auto"},{data:y}=ne({queryKey:["tabTitle",e.rootDb,n?.uid,e.id],queryFn:async()=>e.rootDb==="sheet"?await E(`memo_sheet/${n?.uid}/${e.id}/title`):e.rootDb==="memo"?await E(`${e.rootDb}_txt/${n?.uid}/${e.id}/title`):e.rootDb==="home"?await E(`${e.rootDb}_txt/${e.id}/title`):e.title,enabled:!!n&&!!e.id,staleTime:1/0,placeholderData:e.title});return s.jsxs(D,{ref:c,style:u,...i,...l,"data-tab-id":e.id,to:e.path,title:y,end:!0,className:({isActive:h})=>`group relative flex flex-shrink-0 items-center pl-3 pr-2 py-1.5 text-sm rounded-t-md transition-colors duration-200 min-w-28 max-w-48 border-b-2
				${h?"bg-gray-200 dark:bg-zinc-700 border-blue-500 text-gray-800 dark:text-gray-100":"border-transparent text-gray-500 dark:text-gray-400 hover:bg-gray-200/70 dark:hover:bg-zinc-700/70"}
				${d?"opacity-50 shadow-lg":""}`,children:[e.rootDb==="memo"?s.jsx(Nt,{className:`w-5 h-5 mr-1 flex-shrink-0 transition-transform duration-200 ${r?"scale-110":""}`,fill:"currentColor"}):e.rootDb==="sheet"?s.jsx(Ms,{className:`w-5 h-5 mr-1 flex-shrink-0 transition-transform duration-200 ${r?"scale-110":""}`}):null,s.jsx("span",{className:"truncate pr-1",style:{fontFamily:"sans-serif"},children:y||a("loading")}),s.jsx("button",{onClick:h=>t(h,e),className:`ml-auto flex-shrink-0 p-1 rounded-full transition-opacity duration-200 opacity-0 group-hover:opacity-100
					text-gray-500 dark:text-gray-400 
					hover:bg-gray-300/50 dark:hover:bg-gray-600/50 hover:text-gray-700 dark:hover:text-white
				`,children:s.jsx(He,{className:"w-3 h-3"})})]})},Ts=({openTabs:e,setOpenTabs:t,handleCloseTab:r,handleCloseAllTabs:a,activeId:n})=>{const i=v.useRef(null),[l,c]=v.useState({left:!1,right:!1}),[m,o]=v.useState({left:0,width:0}),d=v.useCallback(()=>{const h=i.current;if(h){const p=h.scrollWidth>h.clientWidth,k=h.scrollLeft===0,f=h.scrollLeft+h.clientWidth>=h.scrollWidth-1;c(w=>{const b={left:p&&!k,right:p&&!f};return w.left===b.left&&w.right===b.right?w:b})}},[]),u=h=>{i.current?.scrollBy({left:h==="left"?-200:200,behavior:"smooth"})},y=h=>{const{active:p,over:k}=h;console.log("active=",p,"over=",k),p.id!==k.id&&t(f=>{const w=f.findIndex(C=>C.id===p.id),b=f.findIndex(C=>C.id===k.id);return _t(f,w,b)})};return v.useEffect(()=>{d();const h=i.current;return h?.addEventListener("scroll",d),window.addEventListener("resize",d),()=>{h?.removeEventListener("scroll",d),window.removeEventListener("resize",d)}},[e,d]),v.useEffect(()=>{const h=setTimeout(()=>{const p=i.current?.querySelector(`[data-tab-id="${n}"]`);if(p){const{offsetLeft:k,offsetWidth:f}=p;o({left:k,width:f})}},0);return()=>clearTimeout(h)},[n,e]),s.jsxs("div",{className:"relative flex items-center justify-between ",children:[l.left&&s.jsx("button",{onClick:()=>u("left"),className:"absolute left-0 z-10 p-1 border border-gray-200 dark:border-gray-700 text-gray-500 dark:text-gray-400 bg-white dark:bg-zinc-900 dark:hover:!text-white hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full group",children:s.jsx(Ft,{className:"w-5 h-5 fill-current"})}),s.jsx($t,{id:"memo-tabs",onDragEnd:y,children:s.jsx("div",{ref:i,className:"MemoTabs relative flex items-center overflow-x-scroll scrollbar-hide whitespace-nowrap",children:s.jsx(Ct,{items:e.map(h=>h.id),strategy:St,children:s.jsx(We,{children:e.map(h=>s.jsx(_.div,{layout:!0,initial:{opacity:0,scale:.8},transition:{type:"spring",stiffness:350,damping:30},animate:{opacity:1,scale:1},exit:{opacity:0,width:0,paddingLeft:0,paddingRight:0,transition:{duration:.3}},children:s.jsx(zs,{tabInfo:h,handleCloseTab:r,isActive:h.id===n})},h.id))})})})}),s.jsxs("div",{className:"flex items-center",children:[l.right&&s.jsx("button",{onClick:()=>u("right"),className:"z-10 p-1 border border-gray-200 dark:border-gray-700 text-gray-500 dark:text-gray-400 bg-white dark:bg-zinc-900 dark:hover:!text-white hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full group",children:s.jsx(Rt,{className:"w-5 h-5 fill-current"})}),e.length>0&&s.jsx("button",{onClick:a,className:"ml-2 mr-2 p-1.5 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md",title:"Close all tabs",children:s.jsx(He,{className:"w-4 h-4"})})]})]})};function Ls(e,t,r,a,n){const i=r?.uid,[l,c]=v.useState(()=>{try{const p=localStorage.getItem(`openTabs_${i}`);return p?JSON.parse(p):[]}catch(p){return console.error("Failed to parse openTabs from localStorage",p),[]}}),m=v.useRef(),o=I(),d=G(),u=v.useCallback(async p=>{if(e&&a&&a!=="insert"&&o.pathname!=="/m"&&o.pathname!=="/home"){const k={id:a,path:o.pathname,icon:null,rootDb:t,title:p?.title};if(o.pathname.startsWith("/m/sheet/")){const f=await E(`memo_sheet/${r?.uid}/${a}/title`);k.title=f}else a==="sheet"&&(k.title="Main Sheet");!l.some(f=>f.id===k.id)&&m.current!==a?(m.current=a,c(f=>[...f,k])):(m.current="",c(f=>f.map(w=>w.id===k.id?{...w,title:k.title||w.title}:w)))}},[n,e]);v.useEffect(()=>{n&&u(n)},[n,e]),v.useEffect(()=>{if(i)try{localStorage.setItem(`openTabs_${i}`,JSON.stringify(l))}catch(p){console.error("Failed to save openTabs to localStorage",p)}},[l,i]);const y=v.useCallback((p,k)=>{p?.preventDefault(),p?.stopPropagation(),m.current="";const f=l.findIndex(b=>b.id===k.id),w=l.filter(b=>b.id!==k.id);if(c(w),o.pathname.includes(k.id)){const b=w.length>0?w[Math.max(0,f-1)].path:`/${t==="memo"||t==="sheet"?"m":t}`;d(b,{relative:"path"})}},[l,o.pathname,t,d]),h=v.useCallback(()=>{m.current="",c([]),d(`/${t==="memo"||t==="sheet"?"m":t}`)},[t,d]);return{openTabs:l,setOpenTabs:c,handleCloseTab:y,handleCloseAllTabs:h}}const Os=()=>{const e=G(),{user:t}=L(),r=Et(Mt),a=I(),{rootDb:n,memoId:i}=v.useMemo(()=>{const b=a.pathname,C=b.startsWith("/m/sheet")?"sheet":b.startsWith("/m")?"memo":b.startsWith("/home")?"home":b.startsWith("/bible")?"bible":"default",j=b.split("/").pop()||"";return{rootDb:C,memoId:j}},[a.pathname]),l=a?.state?.reflash===!0,c=se(),{ui:m}=zt(),[o,d]=Oe(Tt),{memoDetailData:u,isLoading:y,onBookmark:h}=ys(n,t,i,d),{openTabs:p,setOpenTabs:k,handleCloseTab:f,handleCloseAllTabs:w}=Ls(r,n,t,i,u);return v.useEffect(()=>{l&&c.invalidateQueries({queryKey:["memoDetail",n,t?.uid,i]})},[l,a.pathname,c,n,t?.uid,i]),v.useEffect(()=>{t===null&&a.pathname!=="/m"&&e("/m")},[t]),s.jsxs(s.Fragment,{children:[r&&s.jsx("div",{className:"sticky top-0 z-1000 bg-gray-50/70 dark:bg-zinc-800/70 backdrop-blur-sm shadow-sm",children:s.jsx(Ts,{openTabs:p,setOpenTabs:k,handleCloseTab:f,handleCloseAllTabs:w,activeId:i})}),s.jsx(Es,{rootDb:n,ui:m,user:t,memoId:i,memoDetailData:u,isLoading:y,onBookmark:h,handleCloseTab:f})]})},Vs=Object.freeze(Object.defineProperty({__proto__:null,default:Os},Symbol.toStringTag,{value:"Module"}));export{Vs as M,gs as a,Ps as b,As as f,Rs as s,hs as u};
