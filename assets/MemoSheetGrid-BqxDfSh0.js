import{db as H,U as Qu,dc as nd,dd as sd,de as id,df as ad,dg as ar,dh as od,di as ud,dj as hd,dk as ld,dl as cd,dm as dd,dn as pd,dp as fd,dq as md,dr as gd,ds as Ed,dt as Rd,du as Td,dv as Nd,dw as Zu,dx as Sd,dy as yd,dz as Ju,dA as Ti,dB as Ad,dC as Cd,dD as eh,dE as vd,dF as Id,dG as th,dH as Od,dI as Md,dJ as rh,dK as wd,dL as yo,dM as _d,dN as Ld,dO as Fd,dP as Ud,dQ as bd,dR as xd,dS as Pd,dT as Dd,dU as Vd,dV as Bd,dW as kd,dX as Gd,dY as Hd,dZ as Wd,d_ as Yd,d$ as zd,e0 as $d,e1 as Xd,e2 as Kd,e3 as jd,e4 as qd,e5 as Qd,e6 as Zd,e7 as Jd,e8 as ep,e9 as tp,ea as rp,eb as np,ec as sp,ed as ip,ee as ap,ef as op,eg as up,eh as hp,ei as lp,ej as cp,ek as dp,el as pp,em as fp,en as mp,eo as gp,ep as Ep,eq as Rp,er as Tp,es as Np,et as Sp,eu as yp,ev as Ap,ew as Cp,ex as vp,ey as Ip,ez as Op,eA as Mp,eB as wp,eC as _p,eD as Lp,eE as Fp,eF as Up,eG as bp,eH as xp,eI as Pp,eJ as Dp,eK as Vp,eL as Bp,eM as kp,eN as Gp,eO as Hp,eP as Wp,eQ as Yp,eR as zp,eS as $p,eT as Xp,eU as Kp,a2 as sa,r as _e,j as P,S as jp,eV as qp,h as nh,a4 as hn,q as Qp,n as Zp,z as Jp,Q as ef,i as tf,cc as Un,cG as Ao,I as fr,J as Di,ck as rf,bh as nf,bU as sf,x as ms,eW as af}from"./index-DJXDEmOP.js";import{A as gs}from"./AniButton-DVnv5iZy.js";import{M as Co}from"./HtmlCode-XSts92lL.js";import"./Button-DiyxLEWF.js";import"./copy-eoDGR6ZM.js";import"./ComponentCard-Bw3CjfH9.js";import"./TwRadio-682InW8m.js";import"./TwBadge-Bnmr6D88.js";import"./HtmlCode-DWYujvCw.js";import"./toPropertyKey-DCwh5dYN.js";function of(s){const e=typeof window>"u"?!1:window.jQuery;e&&(e.fn.handsontable=function(t){const r=this.first();let n=r.data("handsontable");if(typeof t!="string"){const l=t||{};return n?n.updateSettings(l):(n=new s.Core(r[0],l),r.data("handsontable",n),n.init()),r}let i;if(n)if(typeof n[t]<"u"){for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];i=n[t].call(n,...o),t==="destroy"&&r.removeData()}else throw new Error(`Handsontable do not provide action: ${t}`);return i})}var Vi,Bi,ki,Gi,Hi;Qu();of(H);H.__GhostTable=nd;H._getListenersCounter=sd;H._getRegisteredMapsCounter=id;H.EventManager=ad;const uf=[od,ud,hd,ld,cd,dd,pd,fd,md,gd,Ed,Rd],hf=[Td,Nd];H.helper={};H.dom={};ar(uf,s=>{ar(Object.getOwnPropertyNames(s),e=>{e.charAt(0)!=="_"&&(H.helper[e]=s[e])})});ar(hf,s=>{ar(Object.getOwnPropertyNames(s),e=>{e.charAt(0)!=="_"&&(H.dom[e]=s[e])})});H.cellTypes=(Vi=H.cellTypes)!==null&&Vi!==void 0?Vi:{};ar(Sd(),s=>{H.cellTypes[s]=Zu(s)});H.cellTypes.registerCellType=yd;H.cellTypes.getCellType=Zu;H.editors=(Bi=H.editors)!==null&&Bi!==void 0?Bi:{};ar(Ad(),s=>{H.editors[`${Ti(s)}Editor`]=Ju(s)});H.editors.registerEditor=Cd;H.editors.getEditor=Ju;H.renderers=(ki=H.renderers)!==null&&ki!==void 0?ki:{};ar(vd(),s=>{const e=eh(s);s==="base"&&(H.renderers.cellDecorator=e),H.renderers[`${Ti(s)}Renderer`]=e});H.renderers.registerRenderer=Id;H.renderers.getRenderer=eh;H.validators=(Gi=H.validators)!==null&&Gi!==void 0?Gi:{};ar(Od(),s=>{H.validators[`${Ti(s)}Validator`]=th(s)});H.validators.registerValidator=Md;H.validators.getValidator=th;H.plugins=(Hi=H.plugins)!==null&&Hi!==void 0?Hi:{};ar(wd(),s=>{H.plugins[s]=rh(s)});H.plugins[`${Ti(yo.PLUGIN_KEY)}Plugin`]=yo;H.plugins.registerPlugin=_d;H.plugins.getPlugin=rh;/**
 * @preserve
 * Authors: Hwang, Gun-gu
 * Last updated: Aug 20, 2018
 *
 * Description: Definition file for Korean - Korea language-country.
 */const lf={languageCode:"ko-KR",[Kp]:"위쪽에 행 삽입",[Xp]:"아래쪽에 행 삽입",[$p]:"왼쪽에 열 삽입",[zp]:"오른쪽에 열 삽입",[Yp]:["행 삭제","여러 행 삭제"],[Wp]:["열 삭제","여러 열 삭제"],[Hp]:"되돌리기",[Gp]:"다시하기",[kp]:"읽기 전용",[Bp]:"열 지우기",[Vp]:"정렬",[Dp]:"왼쪽",[Pp]:"중앙",[xp]:"오른쪽",[bp]:"자동",[Up]:"위쪽",[Fp]:"가운데",[Lp]:"아래쪽",[_p]:"열 고정",[wp]:"열 고정 해제",[Mp]:"테두리",[Op]:"위쪽",[Ip]:"오른쪽",[vp]:"아래쪽",[Cp]:"왼쪽",[Ap]:"테두리 지우기",[yp]:"댓글 달기",[Sp]:"댓글 편집",[Np]:"댓글 삭제",[Tp]:"읽기 전용 댓글",[Rp]:"셀 병합",[Ep]:"셀 병합 해제",[gp]:"복사",[mp]:"잘라내기",[fp]:"자녀 행 추가",[pp]:"부모행에서 제거",[dp]:["열 숨기기","여러 열 숨기기"],[cp]:["열 숨기기 해제","여러 열 숨기기 해제"],[lp]:["행 숨기기","여러 행 숨기기"],[hp]:["행 숨기기 해제","여러 행 숨기기 해제"],[up]:"조건없음",[op]:"비어있음",[ap]:"비어있지 않음",[ip]:"같",[sp]:"같지 않음",[np]:"시작 문자",[rp]:"끝 문자",[tp]:"포함",[ep]:"포함하지 않음",[Jd]:"보다 큼",[Zd]:"크거나 같음",[Qd]:"보다 작",[qd]:"작거나 같음",[jd]:"사이",[Kd]:"사이 제외",[Xd]:"다음",[$d]:"전",[zd]:"오늘",[Yd]:"내일",[Wd]:"어제",[Hd]:"공란",[Gd]:"조건부 필터",[kd]:"값 필터",[Bd]:"그리고",[Vd]:"또는",[Dd]:"전체선택",[Pd]:"지우기",[xd]:"확인",[bd]:"취소",[Ud]:"찾기",[Fd]:"값",[Ld]:"두번째 값"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Re;(function(s){s.RELATIVE="RELATIVE",s.ABSOLUTE="ABSOLUTE"})(Re||(Re={}));class $e{constructor(e,t,r){this.type=e,this.col=t,this.sheet=r}static absolute(e,t){return new $e(Re.ABSOLUTE,e,t)}static relative(e,t){return new $e(Re.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleColumnAddress(e).col-r.toSimpleColumnAddress(e).col}isColumnAbsolute(){return this.type===Re.ABSOLUTE}isColumnRelative(){return this.type===Re.RELATIVE}isAbsolute(){return this.type===Re.ABSOLUTE&&this.sheet!==void 0}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new $e(this.type,this.col+t,n)}shiftedByColumns(e){return new $e(this.type,this.col+e,this.sheet)}toSimpleColumnAddress(e){const t=Ut(this,e);let r=this.col;return this.isColumnRelative()&&(r=e.col+this.col),Ll(t,r)}shiftRelativeDimensions(e,t){const r=this.isColumnRelative()?this.col+e:this.col;return new $e(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnAbsolute()?this.col+e:this.col;return new $e(this.type,r,this.sheet)}withSheet(e){return new $e(this.type,this.col,e)}isInvalid(e){return this.toSimpleColumnAddress(e).col<0}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case Re.RELATIVE:return`${t}#COLR${this.col}`;case Re.ABSOLUTE:return`${t}#COLA${this.col}`}}unparse(e){const t=this.toSimpleColumnAddress(e);if(zE(t))return;const r=Si(t.col);return`${this.type===Re.ABSOLUTE?"$":""}${r}`}exceedsSheetSizeLimits(e){return this.col>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class We{constructor(e,t,r){this.type=e,this.row=t,this.sheet=r}static absolute(e,t){return new We(Re.ABSOLUTE,e,t)}static relative(e,t){return new We(Re.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleRowAddress(e).row-r.toSimpleRowAddress(e).row}isRowAbsolute(){return this.type===Re.ABSOLUTE}isRowRelative(){return this.type===Re.RELATIVE}isAbsolute(){return this.type===Re.ABSOLUTE&&this.sheet!==void 0}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new We(this.type,this.row+r,n)}shiftedByRows(e){return new We(this.type,this.row+e,this.sheet)}toSimpleRowAddress(e){const t=Ut(this,e);let r=this.row;return this.isRowRelative()&&(r=e.row+this.row),_l(t,r)}shiftRelativeDimensions(e,t){const r=this.isRowRelative()?this.row+t:this.row;return new We(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isRowAbsolute()?this.row+t:this.row;return new We(this.type,r,this.sheet)}withSheet(e){return new We(this.type,this.row,e)}isInvalid(e){return this.toSimpleRowAddress(e).row<0}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case Re.RELATIVE:return`${t}#ROWR${this.row}`;case Re.ABSOLUTE:return`${t}#ROWA${this.row}`}}unparse(e){const t=this.toSimpleRowAddress(e);return YE(t)?void 0:`${this.type===Re.ABSOLUTE?"$":""}${t.row+1}`}exceedsSheetSizeLimits(e){return this.row>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var re;(function(s){s.CELL_REFERENCE_RELATIVE="CELL_REFERENCE",s.CELL_REFERENCE_ABSOLUTE="CELL_REFERENCE_ABSOLUTE",s.CELL_REFERENCE_ABSOLUTE_COL="CELL_REFERENCE_ABSOLUTE_COL",s.CELL_REFERENCE_ABSOLUTE_ROW="CELL_REFERENCE_ABSOLUTE_ROW"})(re||(re={}));class ie{constructor(e,t,r,n){this.col=e,this.row=t,this.type=r,this.sheet=n}static fromColAndRow(e,t,r){return(e.isColumnAbsolute()&&t.isRowAbsolute()?ie.absolute.bind(this):e.isColumnAbsolute()?ie.absoluteCol.bind(this):t.isRowAbsolute()?ie.absoluteRow.bind(this):ie.relative.bind(this))(e.col,t.row,r)}static relative(e,t,r){return new ie(e,t,re.CELL_REFERENCE_RELATIVE,r)}static absolute(e,t,r){return new ie(e,t,re.CELL_REFERENCE_ABSOLUTE,r)}static absoluteCol(e,t,r){return new ie(e,t,re.CELL_REFERENCE_ABSOLUTE_COL,r)}static absoluteRow(e,t,r){return new ie(e,t,re.CELL_REFERENCE_ABSOLUTE_ROW,r)}toSimpleCellAddress(e){const t=Ut(this,e);return this.type===re.CELL_REFERENCE_ABSOLUTE?M(t,this.col,this.row):this.type===re.CELL_REFERENCE_ABSOLUTE_ROW?M(t,e.col+this.col,this.row):this.type===re.CELL_REFERENCE_ABSOLUTE_COL?M(t,this.col,e.row+this.row):M(t,e.col+this.col,e.row+this.row)}toColumnAddress(){const e=this.isColumnRelative()?Re.RELATIVE:Re.ABSOLUTE;return new $e(e,this.col,this.sheet)}toRowAddress(){const e=this.isRowRelative()?Re.RELATIVE:Re.ABSOLUTE;return new We(e,this.row,this.sheet)}toSimpleColumnAddress(e){const t=Ut(this,e);let r=this.col;return this.isColumnRelative()&&(r+=e.col),Ll(t,r)}toSimpleRowAddress(e){const t=Ut(this,e);let r=this.row;return this.isRowRelative()&&(r+=e.row),_l(t,r)}isRowAbsolute(){return this.type===re.CELL_REFERENCE_ABSOLUTE||this.type===re.CELL_REFERENCE_ABSOLUTE_ROW}isColumnAbsolute(){return this.type===re.CELL_REFERENCE_ABSOLUTE||this.type===re.CELL_REFERENCE_ABSOLUTE_COL}isColumnRelative(){return this.type===re.CELL_REFERENCE_RELATIVE||this.type===re.CELL_REFERENCE_ABSOLUTE_ROW}isRowRelative(){return this.type===re.CELL_REFERENCE_RELATIVE||this.type===re.CELL_REFERENCE_ABSOLUTE_COL}isAbsolute(){return this.type===re.CELL_REFERENCE_ABSOLUTE&&this.sheet!==void 0}shiftedByRows(e){return new ie(this.col,this.row+e,this.type,this.sheet)}shiftedByColumns(e){return new ie(this.col+e,this.row,this.type,this.sheet)}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new ie(this.col+t,this.row+r,this.type,n)}withSheet(e){return new ie(this.col,this.row,this.type,e)}isInvalid(e){return et(this.toSimpleCellAddress(e))}shiftRelativeDimensions(e,t){const r=this.isColumnAbsolute()?this.col:this.col+e,n=this.isRowAbsolute()?this.row:this.row+t;return new ie(r,n,this.type,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnRelative()?this.col:this.col+e,n=this.isRowRelative()?this.row:this.row+t;return new ie(r,n,this.type,this.sheet)}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case re.CELL_REFERENCE_RELATIVE:return`${t}#${this.row}R${this.col}`;case re.CELL_REFERENCE_ABSOLUTE:return`${t}#${this.row}A${this.col}`;case re.CELL_REFERENCE_ABSOLUTE_COL:return`${t}#${this.row}AC${this.col}`;case re.CELL_REFERENCE_ABSOLUTE_ROW:return`${t}#${this.row}AR${this.col}`}}unparse(e){const t=this.toSimpleCellAddress(e);if(et(t))return;const r=Si(t.col),n=this.type===re.CELL_REFERENCE_ABSOLUTE||this.type===re.CELL_REFERENCE_ABSOLUTE_ROW?"$":"";return`${this.type===re.CELL_REFERENCE_ABSOLUTE||this.type===re.CELL_REFERENCE_ABSOLUTE_COL?"$":""}${r}${n}${t.row+1}`}exceedsSheetSizeLimits(e,t){return this.row>=t||this.col>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const as=":",Xe="$",cf="\\s+",df="[ \\t\\n\\r]+",Ni="A-Za-zÀ-ʯ",Va=`${Ni}0-9_.`,sh=`[${Ni}0-9_]+`,pf="'(((?!').|'')*)'",An=`(${sh}|${pf})!`,ih=`(${An})?\\${Xe}?[A-Za-z]+\\${Xe}?[0-9]+`,vo=`(${An})?\\${Xe}?[A-Za-z]+`,Io=`(${An})?\\${Xe}?[0-9]+`,ah="[rR][0-9]*[cC][0-9]*",ff=`(${ih})[^${Va}]`,oh=`[${Ni}_][${Va}]*`,mf=["0","1","2","3","4","5","6","7","8","9"],uh=[...Array.from(Array(26)).map((s,e)=>e+65),...Array.from(Array(26)).map((s,e)=>e+97),...Array.from(Array(496)).map((s,e)=>e+192)].map(s=>String.fromCharCode(s));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const hh=new RegExp(`^(${An})?(\\${Xe}?)([A-Za-z]+)(\\${Xe}?)([0-9]+)$`),gf=new RegExp(`^(${An})?(\\${Xe}?)([A-Za-z]+)$`),Ef=new RegExp(`^(${An})?(\\${Xe}?)([0-9]+)$`),Rf=new RegExp(`^${sh}$`),rn=(s,e,t)=>{const r=hh.exec(e),n=Ba(r[6]);let i=yi(r,s);if(i===void 0)return;i===null&&(i=void 0);const a=Number(r[8])-1;return r[5]===Xe&&r[7]===Xe?ie.absolute(n,a,i):r[5]===Xe?ie.absoluteCol(n,a-t.row,i):r[7]===Xe?ie.absoluteRow(n-t.col,a,i):ie.relative(n-t.col,a-t.row,i)},Xs=(s,e,t)=>{const r=gf.exec(e);let n=yi(r,s);if(n===void 0)return;n===null&&(n=void 0);const i=Ba(r[6]);return r[5]===Xe?$e.absolute(i,n):$e.relative(i-t.col,n)},Ks=(s,e,t)=>{const r=Ef.exec(e);let n=yi(r,s);if(n===void 0)return;n===null&&(n=void 0);const i=Number(r[6])-1;return r[5]===Xe?We.absolute(i,n):We.relative(i-t.row,n)},ia=(s,e,t)=>{const r=hh.exec(e);if(!r)return;const n=Ba(r[6]);let i=yi(r,s);if(i===void 0)return;i===null&&(i=t);const a=Number(r[8])-1;return M(i,n,a)},Tf=(s,e,t)=>{const r=e.split(as);if(r.length!==2)return;const[n,i]=r,a=ia(s,n,t);if(a===void 0)return;const o=ia(s,i,a.sheet);if(o!==void 0&&a.sheet===o.sheet)return Na(a,o)},js=(s,e,t)=>{const r=Si(e.col),n=lh(e.sheet,s);if(n!==void 0)return t!==e.sheet?`${n}!${r}${e.row+1}`:`${r}${e.row+1}`},Nf=(s,e,t)=>{const r=js(s,e.start,t),n=js(s,e.end,e.start.sheet);if(!(r===void 0||n===void 0))return`${r}${as}${n}`};function Ba(s){return s.length===1?s.toUpperCase().charCodeAt(0)-65:s.split("").reduce((e,t)=>e*26+(t.toUpperCase().charCodeAt(0)-64),0)-1}function Si(s){let e="";for(;s>=0;)e=String.fromCharCode(s%26+97)+e,s=Math.floor(s/26)-1;return e.toUpperCase()}function lh(s,e){let t=e(s);if(t!==void 0)return Rf.test(t)?t:(t=t.replace(/'/g,"''"),`'${t}'`)}function yi(s,e){var t;let r=(t=s[3])!==null&&t!==void 0?t:s[2];return r?(r=r.replace(/''/g,"'"),e(r)):null}function ae(s){return s&&s.length===0}function ur(s){return s==null?[]:Object.keys(s)}function Ye(s){for(var e=[],t=Object.keys(s),r=0;r<t.length;r++)e.push(s[t[r]]);return e}function Sf(s,e){for(var t=[],r=ur(s),n=0;n<r.length;n++){var i=r[n];t.push(e.call(null,s[i],i))}return t}function _(s,e){for(var t=[],r=0;r<s.length;r++)t.push(e.call(null,s[r],r));return t}function nt(s){for(var e=[],t=0;t<s.length;t++){var r=s[t];Array.isArray(r)?e=e.concat(nt(r)):e.push(r)}return e}function yt(s){return ae(s)?void 0:s[0]}function ch(s){var e=s&&s.length;return e?s[e-1]:void 0}function x(s,e){if(Array.isArray(s))for(var t=0;t<s.length;t++)e.call(null,s[t],t);else if(Ga(s))for(var r=ur(s),t=0;t<r.length;t++){var n=r[t],i=s[n];e.call(null,i,n)}else throw Error("non exhaustive match")}function $t(s){return typeof s=="string"}function At(s){return s===void 0}function vr(s){return s instanceof Function}function Be(s,e){return e===void 0&&(e=1),s.slice(e,s.length)}function qn(s,e){return e===void 0&&(e=1),s.slice(0,s.length-e)}function bt(s,e){var t=[];if(Array.isArray(s))for(var r=0;r<s.length;r++){var n=s[r];e.call(null,n)&&t.push(n)}return t}function Hr(s,e){return bt(s,function(t){return!e(t)})}function It(s,e){for(var t=Object.keys(s),r={},n=0;n<t.length;n++){var i=t[n],a=s[i];e(a)&&(r[i]=a)}return r}function b(s,e){return Ga(s)?s.hasOwnProperty(e):!1}function we(s,e){return Nn(s,function(t){return t===e})!==void 0}function st(s){for(var e=[],t=0;t<s.length;t++)e.push(s[t]);return e}function os(s){var e={};for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t]);return e}function Nn(s,e){for(var t=0;t<s.length;t++){var r=s[t];if(e.call(null,r))return r}}function yf(s,e){for(var t=[],r=0;r<s.length;r++){var n=s[r];e.call(null,n)&&t.push(n)}return t}function Ge(s,e,t){for(var r=Array.isArray(s),n=r?s:Ye(s),i=r?[]:ur(s),a=t,o=0;o<n.length;o++)a=e.call(null,a,n[o],r?o:i[o]);return a}function us(s){return Hr(s,function(e){return e==null})}function ka(s,e){e===void 0&&(e=function(r){return r});var t=[];return Ge(s,function(r,n){var i=e(n);return we(t,i)?r:(t.push(i),r.concat(n))},[])}function Ft(s){return Array.isArray(s)}function or(s){return s instanceof RegExp}function Ga(s){return s instanceof Object}function St(s,e){for(var t=0;t<s.length;t++)if(!e(s[t],t))return!1;return!0}function Ai(s,e){return Hr(s,function(t){return we(e,t)})}function dh(s,e){for(var t=0;t<s.length;t++)if(e(s[t]))return!0;return!1}function Af(s,e){for(var t=0;t<s.length;t++)if(s[t]===e)return t;return-1}function xt(s){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r++)for(var n=e[r],i=ur(n),a=0;a<i.length;a++){var o=i[a];s[o]=n[o]}return s}function Cf(s){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r++){var n=e[r];if(!At(n))for(var i=ur(n),a=0;a<i.length;a++){var o=i[a];b(s,o)||(s[o]=n[o])}}return s}function Ci(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return Cf.apply(null,[{}].concat(s))}function ph(s,e){var t={};return x(s,function(r){var n=e(r),i=t[n];i?i.push(r):t[n]=[r]}),t}function Oo(s,e){for(var t=os(s),r=ur(e),n=0;n<r.length;n++){var i=r[n],a=e[i];t[i]=a}return t}function Le(){}function Mo(s){return s}function vf(s){for(var e=[],t=0;t<s.length;t++){var r=s[t];e.push(r!==void 0?r:void 0)}return e}function aa(s){console&&console.error&&console.error("Error: "+s)}function Ha(s){console&&console.warn&&console.warn("Warning: "+s)}function wo(){return typeof Map=="function"}function If(s,e){e.forEach(function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach(function(n){if(n!=="constructor"){var i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(s.prototype,n,i):s.prototype[n]=t.prototype[n]}})})}function fh(s){function e(){}e.prototype=s;var t=new e;function r(){return typeof t.bar}return r(),r(),s}function qs(s){return s[s.length-1]}function mh(s){var e=new Date().getTime(),t=s(),r=new Date().getTime(),n=r-e;return{time:n,value:t}}var bs={exports:{}},Of=bs.exports,_o;function Mf(){return _o||(_o=1,function(s){(function(e,t){s.exports?s.exports=t():e.regexpToAst=t()})(typeof self<"u"?self:Of,function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(R){this.idx=R.idx,this.input=R.input,this.groupIdx=R.groupIdx},e.prototype.pattern=function(R){this.idx=0,this.input=R,this.groupIdx=0,this.consumeChar("/");var y=this.disjunction();this.consumeChar("/");for(var S={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":o(S,"global");break;case"i":o(S,"ignoreCase");break;case"m":o(S,"multiLine");break;case"u":o(S,"unicode");break;case"y":o(S,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:S,value:y}},e.prototype.disjunction=function(){var R=[];for(R.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),R.push(this.alternative());return{type:"Disjunction",value:R}},e.prototype.alternative=function(){for(var R=[];this.isTerm();)R.push(this.term());return{type:"Alternative",value:R}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var R;switch(this.popChar()){case"=":R="Lookahead";break;case"!":R="NegativeLookahead";break}u(R);var y=this.disjunction();return this.consumeChar(")"),{type:R,value:y}}l()},e.prototype.quantifier=function(R){var y;switch(this.popChar()){case"*":y={atLeast:0,atMost:1/0};break;case"+":y={atLeast:1,atMost:1/0};break;case"?":y={atLeast:0,atMost:1};break;case"{":var S=this.integerIncludingZero();switch(this.popChar()){case"}":y={atLeast:S,atMost:S};break;case",":var A;this.isDigit()?(A=this.integerIncludingZero(),y={atLeast:S,atMost:A}):y={atLeast:S,atMost:1/0},this.consumeChar("}");break}if(R===!0&&y===void 0)return;u(y);break}if(!(R===!0&&y===void 0))return u(y),this.peekChar(0)==="?"?(this.consumeChar("?"),y.greedy=!1):y.greedy=!0,y.type="Quantifier",y},e.prototype.atom=function(){var R;switch(this.peekChar()){case".":R=this.dotAll();break;case"\\":R=this.atomEscape();break;case"[":R=this.characterClass();break;case"(":R=this.group();break}return R===void 0&&this.isPatternCharacter()&&(R=this.patternCharacter()),u(R),this.isQuantifier()&&(R.quantifier=this.quantifier()),R},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[i(`
`),i("\r"),i("\u2028"),i("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var R=this.positiveInteger();return{type:"GroupBackReference",value:R}},e.prototype.characterClassEscape=function(){var R,y=!1;switch(this.popChar()){case"d":R=d;break;case"D":R=d,y=!0;break;case"s":R=E;break;case"S":R=E,y=!0;break;case"w":R=f;break;case"W":R=f,y=!0;break}return u(R),{type:"Set",value:R,complement:y}},e.prototype.controlEscapeAtom=function(){var R;switch(this.popChar()){case"f":R=i("\f");break;case"n":R=i(`
`);break;case"r":R=i("\r");break;case"t":R=i("	");break;case"v":R=i("\v");break}return u(R),{type:"Character",value:R}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var R=this.popChar();if(/[a-zA-Z]/.test(R)===!1)throw Error("Invalid ");var y=R.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:y}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:i("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var R=this.popChar();return{type:"Character",value:i(R)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var R=this.popChar();return{type:"Character",value:i(R)}}},e.prototype.characterClass=function(){var R=[],y=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),y=!0);this.isClassAtom();){var S=this.classAtom(),A=S.type==="Character";if(A&&this.isRangeDash()){this.consumeChar("-");var C=this.classAtom(),I=C.type==="Character";if(I){if(C.value<S.value)throw Error("Range out of order in character class");R.push({from:S.value,to:C.value})}else a(S.value,R),R.push(i("-")),a(C.value,R)}else a(S.value,R)}return this.consumeChar("]"),{type:"Set",complement:y,value:R}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:i("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var R=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),R=!1;break;default:this.groupIdx++;break}var y=this.disjunction();this.consumeChar(")");var S={type:"Group",capturing:R,value:y};return R&&(S.idx=this.groupIdx),S},e.prototype.positiveInteger=function(){var R=this.popChar();if(n.test(R)===!1)throw Error("Expecting a positive integer");for(;r.test(this.peekChar(0));)R+=this.popChar();return parseInt(R,10)},e.prototype.integerIncludingZero=function(){var R=this.popChar();if(r.test(R)===!1)throw Error("Expecting an integer");for(;r.test(this.peekChar(0));)R+=this.popChar();return parseInt(R,10)},e.prototype.patternCharacter=function(){var R=this.popChar();switch(R){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:i(R)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},e.prototype.isDigit=function(){return r.test(this.peekChar(0))},e.prototype.isClassAtom=function(R){switch(R===void 0&&(R=0),this.peekChar(R)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}},e.prototype.isQuantifier=function(){var R=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(R)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(R){for(var y="",S=0;S<R;S++){var A=this.popChar();if(t.test(A)===!1)throw Error("Expecting a HexDecimal digits");y+=A}var C=parseInt(y,16);return{type:"Character",value:C}},e.prototype.peekChar=function(R){return R===void 0&&(R=0),this.input[this.idx+R]},e.prototype.popChar=function(){var R=this.peekChar(0);return this.consumeChar(),R},e.prototype.consumeChar=function(R){if(R!==void 0&&this.input[this.idx]!==R)throw Error("Expected: '"+R+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t=/[0-9a-fA-F]/,r=/[0-9]/,n=/[1-9]/;function i(R){return R.charCodeAt(0)}function a(R,y){R.length!==void 0?R.forEach(function(S){y.push(S)}):y.push(R)}function o(R,y){if(R[y]===!0)throw"duplicate flag "+y;R[y]=!0}function u(R){if(R===void 0)throw Error("Internal Error - Should never get here!")}function l(){throw Error("Internal Error - Should never get here!")}var c,d=[];for(c=i("0");c<=i("9");c++)d.push(c);var f=[i("_")].concat(d);for(c=i("a");c<=i("z");c++)f.push(c);for(c=i("A");c<=i("Z");c++)f.push(c);var E=[i(" "),i("\f"),i(`
`),i("\r"),i("	"),i("\v"),i("	"),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i("\u2028"),i("\u2029"),i(" "),i(" "),i("　"),i("\uFEFF")];function N(){}return N.prototype.visitChildren=function(R){for(var y in R){var S=R[y];R.hasOwnProperty(y)&&(S.type!==void 0?this.visit(S):Array.isArray(S)&&S.forEach(function(A){this.visit(A)},this))}},N.prototype.visit=function(R){switch(R.type){case"Pattern":this.visitPattern(R);break;case"Flags":this.visitFlags(R);break;case"Disjunction":this.visitDisjunction(R);break;case"Alternative":this.visitAlternative(R);break;case"StartAnchor":this.visitStartAnchor(R);break;case"EndAnchor":this.visitEndAnchor(R);break;case"WordBoundary":this.visitWordBoundary(R);break;case"NonWordBoundary":this.visitNonWordBoundary(R);break;case"Lookahead":this.visitLookahead(R);break;case"NegativeLookahead":this.visitNegativeLookahead(R);break;case"Character":this.visitCharacter(R);break;case"Set":this.visitSet(R);break;case"Group":this.visitGroup(R);break;case"GroupBackReference":this.visitGroupBackReference(R);break;case"Quantifier":this.visitQuantifier(R);break}this.visitChildren(R)},N.prototype.visitPattern=function(R){},N.prototype.visitFlags=function(R){},N.prototype.visitDisjunction=function(R){},N.prototype.visitAlternative=function(R){},N.prototype.visitStartAnchor=function(R){},N.prototype.visitEndAnchor=function(R){},N.prototype.visitWordBoundary=function(R){},N.prototype.visitNonWordBoundary=function(R){},N.prototype.visitLookahead=function(R){},N.prototype.visitNegativeLookahead=function(R){},N.prototype.visitCharacter=function(R){},N.prototype.visitSet=function(R){},N.prototype.visitGroup=function(R){},N.prototype.visitGroupBackReference=function(R){},N.prototype.visitQuantifier=function(R){},{RegExpParser:e,BaseRegExpVisitor:N,VERSION:"0.4.0"}})}(bs)),bs.exports}var hs=Mf(),xs={},wf=new hs.RegExpParser;function vi(s){var e=s.toString();if(xs.hasOwnProperty(e))return xs[e];var t=wf.pattern(e);return xs[e]=t,t}function _f(){xs={}}var Lf=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),gh="Complement Sets are not supported for first char optimization",Qs=`Unable to use "first char" lexer optimizations:
`;function Ff(s,e){e===void 0&&(e=!1);try{var t=vi(s),r=oa(t.value,{},t.flags.ignoreCase);return r}catch(i){if(i.message===gh)e&&Ha(""+Qs+("	Unable to optimize: < "+s.toString()+` >
`)+`	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{var n="";e&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),aa(Qs+`
`+("	Failed parsing: < "+s.toString()+` >
`)+("	Using the regexp-to-ast library version: "+hs.VERSION+`
`)+"	Please open an issue at: https://github.com/bd82/regexp-to-ast/issues"+n)}}return[]}function oa(s,e,t){switch(s.type){case"Disjunction":for(var r=0;r<s.value.length;r++)oa(s.value[r],e,t);break;case"Alternative":for(var n=s.value,r=0;r<n.length;r++){var i=n[r];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var a=i;switch(a.type){case"Character":Es(a.value,e,t);break;case"Set":if(a.complement===!0)throw Error(gh);x(a.value,function(l){if(typeof l=="number")Es(l,e,t);else{var c=l;if(t===!0)for(var d=c.from;d<=c.to;d++)Es(d,e,t);else{for(var d=c.from;d<=c.to&&d<xn;d++)Es(d,e,t);if(c.to>=xn)for(var f=c.from>=xn?c.from:xn,E=c.to,N=Cr(f),R=Cr(E),y=N;y<=R;y++)e[y]=y}}});break;case"Group":oa(a.value,e,t);break;default:throw Error("Non Exhaustive Match")}var o=a.quantifier!==void 0&&a.quantifier.atLeast===0;if(a.type==="Group"&&ua(a)===!1||a.type!=="Group"&&o===!1)break}break;default:throw Error("non exhaustive match!")}return Ye(e)}function Es(s,e,t){var r=Cr(s);e[r]=r,t===!0&&Uf(s,e)}function Uf(s,e){var t=String.fromCharCode(s),r=t.toUpperCase();if(r!==t){var n=Cr(r.charCodeAt(0));e[n]=n}else{var i=t.toLowerCase();if(i!==t){var n=Cr(i.charCodeAt(0));e[n]=n}}}function Lo(s,e){return Nn(s.value,function(t){if(typeof t=="number")return we(e,t);var r=t;return Nn(e,function(n){return r.from<=n&&n<=r.to})!==void 0})}function ua(s){return s.quantifier&&s.quantifier.atLeast===0?!0:s.value?Ft(s.value)?St(s.value,ua):ua(s.value):!1}var bf=function(s){Lf(e,s);function e(t){var r=s.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return e.prototype.visitChildren=function(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}s.prototype.visitChildren.call(this,t)}},e.prototype.visitCharacter=function(t){we(this.targetCharCodes,t.value)&&(this.found=!0)},e.prototype.visitSet=function(t){t.complement?Lo(t,this.targetCharCodes)===void 0&&(this.found=!0):Lo(t,this.targetCharCodes)!==void 0&&(this.found=!0)},e}(hs.BaseRegExpVisitor);function Wa(s,e){if(e instanceof RegExp){var t=vi(e),r=new bf(s);return r.visit(t),r.found}else return Nn(e,function(n){return we(s,n.charCodeAt(0))})!==void 0}var Eh=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Xt="PATTERN",Br="defaultMode",Rs="modes",Rh=typeof new RegExp("(?:)").sticky=="boolean";function xf(s,e){e=Ci(e,{useSticky:Rh,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:function(A,C){return C()}});var t=e.tracer;t("initCharCodeToOptimizedIndexMap",function(){sm()});var r;t("Reject Lexer.NA",function(){r=Hr(s,function(A){return A[Xt]===rt.NA})});var n=!1,i;t("Transform Patterns",function(){n=!1,i=_(r,function(A){var C=A[Xt];if(or(C)){var I=C.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."?I:I.length===2&&I[0]==="\\"&&!we(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:e.useSticky?Uo(C):Fo(C)}else{if(vr(C))return n=!0,{exec:C};if(b(C,"exec"))return n=!0,C;if(typeof C=="string"){if(C.length===1)return C;var oe=C.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),Q=new RegExp(oe);return e.useSticky?Uo(Q):Fo(Q)}else throw Error("non exhaustive match")}})});var a,o,u,l,c;t("misc mapping",function(){a=_(r,function(A){return A.tokenTypeIdx}),o=_(r,function(A){var C=A.GROUP;if(C!==rt.SKIPPED){if($t(C))return C;if(At(C))return!1;throw Error("non exhaustive match")}}),u=_(r,function(A){var C=A.LONGER_ALT;if(C){var I=Af(r,C);return I}}),l=_(r,function(A){return A.PUSH_MODE}),c=_(r,function(A){return b(A,"POP_MODE")})});var d;t("Line Terminator Handling",function(){var A=Sh(e.lineTerminatorCharacters);d=_(r,function(C){return!1}),e.positionTracking!=="onlyOffset"&&(d=_(r,function(C){if(b(C,"LINE_BREAKS"))return C.LINE_BREAKS;if(Nh(C,A)===!1)return Wa(A,C.PATTERN)}))});var f,E,N,R;t("Misc Mapping #2",function(){f=_(r,Th),E=_(i,tm),N=Ge(r,function(A,C){var I=C.GROUP;return $t(I)&&I!==rt.SKIPPED&&(A[I]=[]),A},{}),R=_(i,function(A,C){return{pattern:i[C],longerAlt:u[C],canLineTerminator:d[C],isCustom:f[C],short:E[C],group:o[C],push:l[C],pop:c[C],tokenTypeIdx:a[C],tokenType:r[C]}})});var y=!0,S=[];return e.safeMode||t("First Char Optimization",function(){S=Ge(r,function(A,C,I){if(typeof C.PATTERN=="string"){var oe=C.PATTERN.charCodeAt(0),Q=Cr(oe);Wi(A,Q,R[I])}else if(Ft(C.START_CHARS_HINT)){var ee;x(C.START_CHARS_HINT,function(Te){var he=typeof Te=="string"?Te.charCodeAt(0):Te,q=Cr(he);ee!==q&&(ee=q,Wi(A,q,R[I]))})}else if(or(C.PATTERN))if(C.PATTERN.unicode)y=!1,e.ensureOptimizations&&aa(""+Qs+("	Unable to analyze < "+C.PATTERN.toString()+` > pattern.
`)+`	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{var ve=Ff(C.PATTERN,e.ensureOptimizations);ae(ve)&&(y=!1),x(ve,function(Te){Wi(A,Te,R[I])})}else e.ensureOptimizations&&aa(""+Qs+("	TokenType: <"+C.name+`> is using a custom token pattern without providing <start_chars_hint> parameter.
`)+`	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),y=!1;return A},[])}),t("ArrayPacking",function(){S=vf(S)}),{emptyGroups:N,patternIdxToConfig:R,charCodeToPatternIdxToConfig:S,hasCustom:n,canBeOptimized:y}}function Pf(s,e){var t=[],r=Vf(s);t=t.concat(r.errors);var n=Bf(r.valid),i=n.valid;return t=t.concat(n.errors),t=t.concat(Df(i)),t=t.concat(Xf(i)),t=t.concat(Kf(i,e)),t=t.concat(jf(i)),t}function Df(s){var e=[],t=bt(s,function(r){return or(r[Xt])});return e=e.concat(Gf(t)),e=e.concat(Yf(t)),e=e.concat(zf(t)),e=e.concat($f(t)),e=e.concat(Hf(t)),e}function Vf(s){var e=bt(s,function(n){return!b(n,Xt)}),t=_(e,function(n){return{message:"Token Type: ->"+n.name+"<- missing static 'PATTERN' property",type:Ce.MISSING_PATTERN,tokenTypes:[n]}}),r=Ai(s,e);return{errors:t,valid:r}}function Bf(s){var e=bt(s,function(n){var i=n[Xt];return!or(i)&&!vr(i)&&!b(i,"exec")&&!$t(i)}),t=_(e,function(n){return{message:"Token Type: ->"+n.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ce.INVALID_PATTERN,tokenTypes:[n]}}),r=Ai(s,e);return{errors:t,valid:r}}var kf=/[^\\][\$]/;function Gf(s){var e=function(n){Eh(i,n);function i(){var a=n!==null&&n.apply(this,arguments)||this;return a.found=!1,a}return i.prototype.visitEndAnchor=function(a){this.found=!0},i}(hs.BaseRegExpVisitor),t=bt(s,function(n){var i=n[Xt];try{var a=vi(i),o=new e;return o.visit(a),o.found}catch{return kf.test(i.source)}}),r=_(t,function(n){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+n.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ce.EOI_ANCHOR_FOUND,tokenTypes:[n]}});return r}function Hf(s){var e=bt(s,function(r){var n=r[Xt];return n.test("")}),t=_(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ce.EMPTY_MATCH_PATTERN,tokenTypes:[r]}});return t}var Wf=/[^\\[][\^]|^\^/;function Yf(s){var e=function(n){Eh(i,n);function i(){var a=n!==null&&n.apply(this,arguments)||this;return a.found=!1,a}return i.prototype.visitStartAnchor=function(a){this.found=!0},i}(hs.BaseRegExpVisitor),t=bt(s,function(n){var i=n[Xt];try{var a=vi(i),o=new e;return o.visit(a),o.found}catch{return Wf.test(i.source)}}),r=_(t,function(n){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+n.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ce.SOI_ANCHOR_FOUND,tokenTypes:[n]}});return r}function zf(s){var e=bt(s,function(r){var n=r[Xt];return n instanceof RegExp&&(n.multiline||n.global)}),t=_(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ce.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}});return t}function $f(s){var e=[],t=_(s,function(i){return Ge(s,function(a,o){return i.PATTERN.source===o.PATTERN.source&&!we(e,o)&&o.PATTERN!==rt.NA&&(e.push(o),a.push(o)),a},[])});t=us(t);var r=bt(t,function(i){return i.length>1}),n=_(r,function(i){var a=_(i,function(u){return u.name}),o=yt(i).PATTERN;return{message:"The same RegExp pattern ->"+o+"<-"+("has been used in all of the following Token Types: "+a.join(", ")+" <-"),type:Ce.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}});return n}function Xf(s){var e=bt(s,function(r){if(!b(r,"GROUP"))return!1;var n=r.GROUP;return n!==rt.SKIPPED&&n!==rt.NA&&!$t(n)}),t=_(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ce.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}});return t}function Kf(s,e){var t=bt(s,function(n){return n.PUSH_MODE!==void 0&&!we(e,n.PUSH_MODE)}),r=_(t,function(n){var i="Token Type: ->"+n.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+n.PUSH_MODE+"<-which does not exist";return{message:i,type:Ce.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[n]}});return r}function jf(s){var e=[],t=Ge(s,function(r,n,i){var a=n.PATTERN;return a===rt.NA||($t(a)?r.push({str:a,idx:i,tokenType:n}):or(a)&&Qf(a)&&r.push({str:a.source,idx:i,tokenType:n})),r},[]);return x(s,function(r,n){x(t,function(i){var a=i.str,o=i.idx,u=i.tokenType;if(n<o&&qf(a,r.PATTERN)){var l="Token: ->"+u.name+`<- can never be matched.
`+("Because it appears AFTER the Token Type ->"+r.name+"<-")+`in the lexer's definition.
See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:l,type:Ce.UNREACHABLE_PATTERN,tokenTypes:[r,u]})}})}),e}function qf(s,e){if(or(e)){var t=e.exec(s);return t!==null&&t.index===0}else{if(vr(e))return e(s,0,[],{});if(b(e,"exec"))return e.exec(s,0,[],{});if(typeof e=="string")return e===s;throw Error("non exhaustive match")}}function Qf(s){var e=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return Nn(e,function(t){return s.source.indexOf(t)!==-1})===void 0}function Fo(s){var e=s.ignoreCase?"i":"";return new RegExp("^(?:"+s.source+")",e)}function Uo(s){var e=s.ignoreCase?"iy":"y";return new RegExp(""+s.source,e)}function Zf(s,e,t){var r=[];return b(s,Br)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Br+`> property in its definition
`,type:Ce.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),b(s,Rs)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Rs+`> property in its definition
`,type:Ce.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),b(s,Rs)&&b(s,Br)&&!b(s.modes,s.defaultMode)&&r.push({message:"A MultiMode Lexer cannot be initialized with a "+Br+": <"+s.defaultMode+`>which does not exist
`,type:Ce.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),b(s,Rs)&&x(s.modes,function(n,i){x(n,function(a,o){At(a)&&r.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+("<"+i+"> at index: <"+o+`>
`),type:Ce.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),r}function Jf(s,e,t){var r=[],n=!1,i=us(nt(Sf(s.modes,function(u){return u}))),a=Hr(i,function(u){return u[Xt]===rt.NA}),o=Sh(t);return e&&x(a,function(u){var l=Nh(u,o);if(l!==!1){var c=nm(u,l),d={message:c,type:l.issue,tokenType:u};r.push(d)}else b(u,"LINE_BREAKS")?u.LINE_BREAKS===!0&&(n=!0):Wa(o,u.PATTERN)&&(n=!0)}),e&&!n&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ce.NO_LINE_BREAKS_FLAGS}),r}function em(s){var e={},t=ur(s);return x(t,function(r){var n=s[r];if(Ft(n))e[r]=[];else throw Error("non exhaustive match")}),e}function Th(s){var e=s.PATTERN;if(or(e))return!1;if(vr(e))return!0;if(b(e,"exec"))return!0;if($t(e))return!1;throw Error("non exhaustive match")}function tm(s){return $t(s)&&s.length===1?s.charCodeAt(0):!1}var rm={test:function(s){for(var e=s.length,t=this.lastIndex;t<e;t++){var r=s.charCodeAt(t);if(r===10)return this.lastIndex=t+1,!0;if(r===13)return s.charCodeAt(t+1)===10?this.lastIndex=t+2:this.lastIndex=t+1,!0}return!1},lastIndex:0};function Nh(s,e){if(b(s,"LINE_BREAKS"))return!1;if(or(s.PATTERN)){try{Wa(e,s.PATTERN)}catch(t){return{issue:Ce.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}else{if($t(s.PATTERN))return!1;if(Th(s))return{issue:Ce.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function nm(s,e){if(e.issue===Ce.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
`+("	The problem is in the <"+s.name+`> Token Type
`)+("	 Root cause: "+e.errMsg+`.
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(e.issue===Ce.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
`+("	The problem is in the <"+s.name+`> Token Type
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function Sh(s){var e=_(s,function(t){return $t(t)&&t.length>0?t.charCodeAt(0):t});return e}function Wi(s,e,t){s[e]===void 0?s[e]=[t]:s[e].push(t)}var xn=256;function Cr(s){return s<xn?s:Ps[s]}var Ps=[];function sm(){if(ae(Ps)){Ps=new Array(65536);for(var s=0;s<65536;s++)Ps[s]=s>255?255+~~(s/255):s}}function Ii(s,e){var t=s.tokenTypeIdx;return t===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[t]===!0}function Zs(s,e){return s.tokenTypeIdx===e.tokenTypeIdx}var bo=1,yh={};function ls(s){var e=im(s);am(e),um(e),om(e),x(e,function(t){t.isParent=t.categoryMatches.length>0})}function im(s){for(var e=st(s),t=s,r=!0;r;){t=us(nt(_(t,function(i){return i.CATEGORIES})));var n=Ai(t,e);e=e.concat(n),ae(n)?r=!1:t=n}return e}function am(s){x(s,function(e){Ch(e)||(yh[bo]=e,e.tokenTypeIdx=bo++),xo(e)&&!Ft(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),xo(e)||(e.CATEGORIES=[]),hm(e)||(e.categoryMatches=[]),lm(e)||(e.categoryMatchesMap={})})}function om(s){x(s,function(e){e.categoryMatches=[],x(e.categoryMatchesMap,function(t,r){e.categoryMatches.push(yh[r].tokenTypeIdx)})})}function um(s){x(s,function(e){Ah([],e)})}function Ah(s,e){x(s,function(t){e.categoryMatchesMap[t.tokenTypeIdx]=!0}),x(e.CATEGORIES,function(t){var r=s.concat(e);we(r,t)||Ah(r,t)})}function Ch(s){return b(s,"tokenTypeIdx")}function xo(s){return b(s,"CATEGORIES")}function hm(s){return b(s,"categoryMatches")}function lm(s){return b(s,"categoryMatchesMap")}function cm(s){return b(s,"tokenTypeIdx")}var dm={buildUnableToPopLexerModeMessage:function(s){return"Unable to pop Lexer Mode after encountering Token ->"+s.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(s,e,t,r,n){return"unexpected character: ->"+s.charAt(e)+"<- at offset: "+e+","+(" skipped "+t+" characters.")}},Ce;(function(s){s[s.MISSING_PATTERN=0]="MISSING_PATTERN",s[s.INVALID_PATTERN=1]="INVALID_PATTERN",s[s.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",s[s.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",s[s.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",s[s.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",s[s.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",s[s.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",s[s.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",s[s.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",s[s.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",s[s.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",s[s.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",s[s.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",s[s.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",s[s.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",s[s.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"})(Ce||(Ce={}));var Pn={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:dm,traceInitPerf:!1,skipValidations:!1};Object.freeze(Pn);var rt=function(){function s(e,t){var r=this;if(t===void 0&&(t=Pn),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},typeof t=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Oo(Pn,t);var n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var i,a=!0;r.TRACE_INIT("Lexer Config handling",function(){if(r.config.lineTerminatorsPattern===Pn.lineTerminatorsPattern)r.config.lineTerminatorsPattern=rm;else if(r.config.lineTerminatorCharacters===Pn.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');r.trackStartLines=/full|onlyStart/i.test(r.config.positionTracking),r.trackEndLines=/full/i.test(r.config.positionTracking),Ft(e)?(i={modes:{}},i.modes[Br]=st(e),i[Br]=Br):(a=!1,i=os(e))}),r.config.skipValidations===!1&&(r.TRACE_INIT("performRuntimeChecks",function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(Zf(i,r.trackStartLines,r.config.lineTerminatorCharacters))}),r.TRACE_INIT("performWarningRuntimeChecks",function(){r.lexerDefinitionWarning=r.lexerDefinitionWarning.concat(Jf(i,r.trackStartLines,r.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},x(i.modes,function(c,d){i.modes[d]=Hr(c,function(f){return At(f)})});var o=ur(i.modes);if(x(i.modes,function(c,d){r.TRACE_INIT("Mode: <"+d+"> processing",function(){if(r.modes.push(d),r.config.skipValidations===!1&&r.TRACE_INIT("validatePatterns",function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(Pf(c,o))}),ae(r.lexerDefinitionErrors)){ls(c);var f;r.TRACE_INIT("analyzeTokenTypes",function(){f=xf(c,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:r.TRACE_INIT.bind(r)})}),r.patternIdxToConfig[d]=f.patternIdxToConfig,r.charCodeToPatternIdxToConfig[d]=f.charCodeToPatternIdxToConfig,r.emptyGroups=Oo(r.emptyGroups,f.emptyGroups),r.hasCustom=f.hasCustom||r.hasCustom,r.canModeBeOptimized[d]=f.canBeOptimized}})}),r.defaultMode=i.defaultMode,!ae(r.lexerDefinitionErrors)&&!r.config.deferDefinitionErrorsHandling){var u=_(r.lexerDefinitionErrors,function(c){return c.message}),l=u.join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+l)}x(r.lexerDefinitionWarning,function(c){Ha(c.message)}),r.TRACE_INIT("Choosing sub-methods implementations",function(){if(Rh?(r.chopInput=Mo,r.match=r.matchWithTest):(r.updateLastIndex=Le,r.match=r.matchWithExec),a&&(r.handleModes=Le),r.trackStartLines===!1&&(r.computeNewColumn=Mo),r.trackEndLines===!1&&(r.updateTokenEndLineColumnLocation=Le),/full/i.test(r.config.positionTracking))r.createTokenInstance=r.createFullToken;else if(/onlyStart/i.test(r.config.positionTracking))r.createTokenInstance=r.createStartOnlyToken;else if(/onlyOffset/i.test(r.config.positionTracking))r.createTokenInstance=r.createOffsetOnlyToken;else throw Error('Invalid <positionTracking> config option: "'+r.config.positionTracking+'"');r.hasCustom?(r.addToken=r.addTokenUsingPush,r.handlePayload=r.handlePayloadWithCustom):(r.addToken=r.addTokenUsingMemberAccess,r.handlePayload=r.handlePayloadNoCustom)}),r.TRACE_INIT("Failed Optimization Warnings",function(){var c=Ge(r.canModeBeOptimized,function(d,f,E){return f===!1&&d.push(E),d},[]);if(t.ensureOptimizations&&!ae(c))throw Error("Lexer Modes: < "+c.join(", ")+` > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),r.TRACE_INIT("clearRegExpParserCache",function(){_f()}),r.TRACE_INIT("toFastProperties",function(){fh(r)})})}return s.prototype.tokenize=function(e,t){if(t===void 0&&(t=this.defaultMode),!ae(this.lexerDefinitionErrors)){var r=_(this.lexerDefinitionErrors,function(a){return a.message}),n=r.join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+n)}var i=this.tokenizeInternal(e,t);return i},s.prototype.tokenizeInternal=function(e,t){var r=this,n,i,a,o,u,l,c,d,f,E,N,R,y,S,A=e,C=A.length,I=0,oe=0,Q=this.hasCustom?0:Math.floor(e.length/10),ee=new Array(Q),ve=[],Te=this.trackStartLines?1:void 0,he=this.trackStartLines?1:void 0,q=em(this.emptyGroups),at=this.trackStartLines,ze=this.config.lineTerminatorsPattern,gt=0,Ke=[],qt=[],lr=[],Kr=[];Object.freeze(Kr);var cr=void 0;function jr(){return Ke}function vn(De){var Lr=Cr(De),Qt=qt[Lr];return Qt===void 0?Kr:Qt}var ds=function(De){if(lr.length===1&&De.tokenType.PUSH_MODE===void 0){var Lr=r.config.errorMessageProvider.buildUnableToPopLexerModeMessage(De);ve.push({offset:De.startOffset,line:De.startLine!==void 0?De.startLine:void 0,column:De.startColumn!==void 0?De.startColumn:void 0,length:De.image.length,message:Lr})}else{lr.pop();var Qt=ch(lr);Ke=r.patternIdxToConfig[Qt],qt=r.charCodeToPatternIdxToConfig[Qt],gt=Ke.length;var Pi=r.canModeBeOptimized[Qt]&&r.config.safeMode===!1;qt&&Pi?cr=vn:cr=jr}};function In(De){lr.push(De),qt=this.charCodeToPatternIdxToConfig[De],Ke=this.patternIdxToConfig[De],gt=Ke.length,gt=Ke.length;var Lr=this.canModeBeOptimized[De]&&this.config.safeMode===!1;qt&&Lr?cr=vn:cr=jr}In.call(this,t);for(var je;I<C;){u=null;var bi=A.charCodeAt(I),dr=cr(bi),xi=dr.length;for(n=0;n<xi;n++){je=dr[n];var Pt=je.pattern;l=null;var wr=je.short;if(wr!==!1?bi===wr&&(u=Pt):je.isCustom===!0?(S=Pt.exec(A,I,ee,q),S!==null?(u=S[0],S.payload!==void 0&&(l=S.payload)):u=null):(this.updateLastIndex(Pt,I),u=this.match(Pt,e,I)),u!==null){if(o=je.longerAlt,o!==void 0){var On=Ke[o],Mn=On.pattern;c=null,On.isCustom===!0?(S=Mn.exec(A,I,ee,q),S!==null?(a=S[0],S.payload!==void 0&&(c=S.payload)):a=null):(this.updateLastIndex(Mn,I),a=this.match(Mn,e,I)),a&&a.length>u.length&&(u=a,l=c,je=On)}break}}if(u!==null){if(d=u.length,f=je.group,f!==void 0&&(E=je.tokenTypeIdx,N=this.createTokenInstance(u,I,E,je.tokenType,Te,he,d),this.handlePayload(N,l),f===!1?oe=this.addToken(ee,oe,N):q[f].push(N)),e=this.chopInput(e,d),I=I+d,he=this.computeNewColumn(he,d),at===!0&&je.canLineTerminator===!0){var qr=0,wn=void 0,_n=void 0;ze.lastIndex=0;do wn=ze.test(u),wn===!0&&(_n=ze.lastIndex-1,qr++);while(wn===!0);qr!==0&&(Te=Te+qr,he=d-_n,this.updateTokenEndLineColumnLocation(N,f,_n,qr,Te,he,d))}this.handleModes(je,ds,In,N)}else{for(var Qr=I,ps=Te,fs=he,_r=!1;!_r&&I<C;)for(A.charCodeAt(I),e=this.chopInput(e,1),I++,i=0;i<gt;i++){var Ln=Ke[i],Pt=Ln.pattern,wr=Ln.short;if(wr!==!1?A.charCodeAt(I)===wr&&(_r=!0):Ln.isCustom===!0?_r=Pt.exec(A,I,ee,q)!==null:(this.updateLastIndex(Pt,I),_r=Pt.exec(e)!==null),_r===!0)break}R=I-Qr,y=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(A,Qr,R,ps,fs),ve.push({offset:Qr,line:ps,column:fs,length:R,message:y})}}return this.hasCustom||(ee.length=oe),{tokens:ee,groups:q,errors:ve}},s.prototype.handleModes=function(e,t,r,n){if(e.pop===!0){var i=e.push;t(n),i!==void 0&&r.call(this,i)}else e.push!==void 0&&r.call(this,e.push)},s.prototype.chopInput=function(e,t){return e.substring(t)},s.prototype.updateLastIndex=function(e,t){e.lastIndex=t},s.prototype.updateTokenEndLineColumnLocation=function(e,t,r,n,i,a,o){var u,l;t!==void 0&&(u=r===o-1,l=u?-1:0,n===1&&u===!0||(e.endLine=i+l,e.endColumn=a-1+-l))},s.prototype.computeNewColumn=function(e,t){return e+t},s.prototype.createTokenInstance=function(){return null},s.prototype.createOffsetOnlyToken=function(e,t,r,n){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:n}},s.prototype.createStartOnlyToken=function(e,t,r,n,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:r,tokenType:n}},s.prototype.createFullToken=function(e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:n}},s.prototype.addToken=function(e,t,r){return 666},s.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},s.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,t++,t},s.prototype.handlePayload=function(e,t){},s.prototype.handlePayloadNoCustom=function(e,t){},s.prototype.handlePayloadWithCustom=function(e,t){t!==null&&(e.payload=t)},s.prototype.match=function(e,t,r){return null},s.prototype.matchWithTest=function(e,t,r){var n=e.test(t);return n===!0?t.substring(r,e.lastIndex):null},s.prototype.matchWithExec=function(e,t){var r=e.exec(t);return r!==null?r[0]:r},s.prototype.TRACE_INIT=function(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--> <"+e+">");var n=mh(t),i=n.time,a=n.value,o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(r+"<-- <"+e+"> time: "+i+"ms"),this.traceInitIndent--,a}else return t()},s.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",s.NA=/NOT_APPLICABLE/,s}();function fn(s){return vh(s)?s.LABEL:s.name}function vh(s){return $t(s.LABEL)&&s.LABEL!==""}var pm="parent",Po="categories",Do="label",Vo="group",Bo="push_mode",ko="pop_mode",Go="longer_alt",Ho="line_breaks",Wo="start_chars_hint";function z(s){return fm(s)}function fm(s){var e=s.pattern,t={};if(t.name=s.name,At(e)||(t.PATTERN=e),b(s,pm))throw`The parent property is no longer supported.
See: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.`;return b(s,Po)&&(t.CATEGORIES=s[Po]),ls([t]),b(s,Do)&&(t.LABEL=s[Do]),b(s,Vo)&&(t.GROUP=s[Vo]),b(s,ko)&&(t.POP_MODE=s[ko]),b(s,Bo)&&(t.PUSH_MODE=s[Bo]),b(s,Go)&&(t.LONGER_ALT=s[Go]),b(s,Ho)&&(t.LINE_BREAKS=s[Ho]),b(s,Wo)&&(t.START_CHARS_HINT=s[Wo]),t}var Wr=z({name:"EOF",pattern:rt.NA});ls([Wr]);function Ya(s,e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:r,startLine:n,endLine:i,startColumn:a,endColumn:o,tokenTypeIdx:s.tokenTypeIdx,tokenType:s}}function se(s,e){return Ii(s,e)}var hr=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Kt=function(){function s(e){this.definition=e}return s.prototype.accept=function(e){e.visit(this),x(this.definition,function(t){t.accept(e)})},s}(),pt=function(s){hr(e,s);function e(t){var r=s.call(this,[])||this;return r.idx=1,xt(r,It(t,function(n){return n!==void 0})),r}return Object.defineProperty(e.prototype,"definition",{get:function(){return this.referencedRule!==void 0?this.referencedRule.definition:[]},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.accept=function(t){t.visit(this)},e}(Kt),Cn=function(s){hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.orgText="",xt(r,It(t,function(n){return n!==void 0})),r}return e}(Kt),it=function(s){hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.ignoreAmbiguities=!1,xt(r,It(t,function(n){return n!==void 0})),r}return e}(Kt),ke=function(s){hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,xt(r,It(t,function(n){return n!==void 0})),r}return e}(Kt),Ct=function(s){hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,xt(r,It(t,function(n){return n!==void 0})),r}return e}(Kt),vt=function(s){hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,xt(r,It(t,function(n){return n!==void 0})),r}return e}(Kt),Ae=function(s){hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,xt(r,It(t,function(n){return n!==void 0})),r}return e}(Kt),ft=function(s){hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,xt(r,It(t,function(n){return n!==void 0})),r}return e}(Kt),mt=function(s){hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,r.ignoreAmbiguities=!1,r.hasPredicates=!1,xt(r,It(t,function(n){return n!==void 0})),r}return e}(Kt),fe=function(){function s(e){this.idx=1,xt(this,It(e,function(t){return t!==void 0}))}return s.prototype.accept=function(e){e.visit(this)},s}();function mm(s){return _(s,Ds)}function Ds(s){function e(n){return _(n,Ds)}if(s instanceof pt)return{type:"NonTerminal",name:s.nonTerminalName,idx:s.idx};if(s instanceof it)return{type:"Flat",definition:e(s.definition)};if(s instanceof ke)return{type:"Option",idx:s.idx,definition:e(s.definition)};if(s instanceof Ct)return{type:"RepetitionMandatory",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof vt)return{type:"RepetitionMandatoryWithSeparator",name:s.name,idx:s.idx,separator:Ds(new fe({terminalType:s.separator})),definition:e(s.definition)};if(s instanceof ft)return{type:"RepetitionWithSeparator",name:s.name,idx:s.idx,separator:Ds(new fe({terminalType:s.separator})),definition:e(s.definition)};if(s instanceof Ae)return{type:"Repetition",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof mt)return{type:"Alternation",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof fe){var t={type:"Terminal",name:s.terminalType.name,label:fn(s.terminalType),idx:s.idx},r=s.terminalType.PATTERN;return s.terminalType.PATTERN&&(t.pattern=or(r)?r.source:r),t}else{if(s instanceof Cn)return{type:"Rule",name:s.name,orgText:s.orgText,definition:e(s.definition)};throw Error("non exhaustive match")}}var Oi=function(){function s(){}return s.prototype.walk=function(e,t){var r=this;t===void 0&&(t=[]),x(e.definition,function(n,i){var a=Be(e.definition,i+1);if(n instanceof pt)r.walkProdRef(n,a,t);else if(n instanceof fe)r.walkTerminal(n,a,t);else if(n instanceof it)r.walkFlat(n,a,t);else if(n instanceof ke)r.walkOption(n,a,t);else if(n instanceof Ct)r.walkAtLeastOne(n,a,t);else if(n instanceof vt)r.walkAtLeastOneSep(n,a,t);else if(n instanceof ft)r.walkManySep(n,a,t);else if(n instanceof Ae)r.walkMany(n,a,t);else if(n instanceof mt)r.walkOr(n,a,t);else throw Error("non exhaustive match")})},s.prototype.walkTerminal=function(e,t,r){},s.prototype.walkProdRef=function(e,t,r){},s.prototype.walkFlat=function(e,t,r){var n=t.concat(r);this.walk(e,n)},s.prototype.walkOption=function(e,t,r){var n=t.concat(r);this.walk(e,n)},s.prototype.walkAtLeastOne=function(e,t,r){var n=[new ke({definition:e.definition})].concat(t,r);this.walk(e,n)},s.prototype.walkAtLeastOneSep=function(e,t,r){var n=Yo(e,t,r);this.walk(e,n)},s.prototype.walkMany=function(e,t,r){var n=[new ke({definition:e.definition})].concat(t,r);this.walk(e,n)},s.prototype.walkManySep=function(e,t,r){var n=Yo(e,t,r);this.walk(e,n)},s.prototype.walkOr=function(e,t,r){var n=this,i=t.concat(r);x(e.definition,function(a){var o=new it({definition:[a]});n.walk(o,i)})},s}();function Yo(s,e,t){var r=[new ke({definition:[new fe({terminalType:s.separator})].concat(s.definition)})],n=r.concat(e,t);return n}var $r=function(){function s(){}return s.prototype.visit=function(e){var t=e;switch(t.constructor){case pt:return this.visitNonTerminal(t);case it:return this.visitFlat(t);case ke:return this.visitOption(t);case Ct:return this.visitRepetitionMandatory(t);case vt:return this.visitRepetitionMandatoryWithSeparator(t);case ft:return this.visitRepetitionWithSeparator(t);case Ae:return this.visitRepetition(t);case mt:return this.visitAlternation(t);case fe:return this.visitTerminal(t);case Cn:return this.visitRule(t);default:throw Error("non exhaustive match")}},s.prototype.visitNonTerminal=function(e){},s.prototype.visitFlat=function(e){},s.prototype.visitOption=function(e){},s.prototype.visitRepetition=function(e){},s.prototype.visitRepetitionMandatory=function(e){},s.prototype.visitRepetitionMandatoryWithSeparator=function(e){},s.prototype.visitRepetitionWithSeparator=function(e){},s.prototype.visitAlternation=function(e){},s.prototype.visitTerminal=function(e){},s.prototype.visitRule=function(e){},s}(),gm=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function Em(s){return s instanceof it||s instanceof ke||s instanceof Ae||s instanceof Ct||s instanceof vt||s instanceof ft||s instanceof fe||s instanceof Cn}function Js(s,e){e===void 0&&(e=[]);var t=s instanceof ke||s instanceof Ae||s instanceof ft;return t?!0:s instanceof mt?dh(s.definition,function(r){return Js(r,e)}):s instanceof pt&&we(e,s)?!1:s instanceof Kt?(s instanceof pt&&e.push(s),St(s.definition,function(r){return Js(r,e)})):!1}function Rm(s){return s instanceof mt}function wt(s){if(s instanceof pt)return"SUBRULE";if(s instanceof ke)return"OPTION";if(s instanceof mt)return"OR";if(s instanceof Ct)return"AT_LEAST_ONE";if(s instanceof vt)return"AT_LEAST_ONE_SEP";if(s instanceof ft)return"MANY_SEP";if(s instanceof Ae)return"MANY";if(s instanceof fe)return"CONSUME";throw Error("non exhaustive match")}var Tm=function(s){gm(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return e.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},e.prototype.visitTerminal=function(t){var r=t.terminalType.name+this.separator+"Terminal";b(this.dslMethods,r)||(this.dslMethods[r]=[]),this.dslMethods[r].push(t)},e.prototype.visitNonTerminal=function(t){var r=t.nonTerminalName+this.separator+"Terminal";b(this.dslMethods,r)||(this.dslMethods[r]=[]),this.dslMethods[r].push(t)},e.prototype.visitOption=function(t){this.dslMethods.option.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.dslMethods.repetitionWithSeparator.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.dslMethods.repetitionMandatory.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)},e.prototype.visitRepetition=function(t){this.dslMethods.repetition.push(t)},e.prototype.visitAlternation=function(t){this.dslMethods.alternation.push(t)},e}($r),Ts=new Tm;function Nm(s){Ts.reset(),s.accept(Ts);var e=Ts.dslMethods;return Ts.reset(),e}function cs(s){if(s instanceof pt)return cs(s.referencedRule);if(s instanceof fe)return Am(s);if(Em(s))return Sm(s);if(Rm(s))return ym(s);throw Error("non exhaustive match")}function Sm(s){for(var e=[],t=s.definition,r=0,n=t.length>r,i,a=!0;n&&a;)i=t[r],a=Js(i),e=e.concat(cs(i)),r=r+1,n=t.length>r;return ka(e)}function ym(s){var e=_(s.definition,function(t){return cs(t)});return ka(nt(e))}function Am(s){return[s.terminalType]}var Ih="_~IN~_",Cm=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),vm=function(s){Cm(e,s);function e(t){var r=s.call(this)||this;return r.topProd=t,r.follows={},r}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},e.prototype.walkTerminal=function(t,r,n){},e.prototype.walkProdRef=function(t,r,n){var i=Om(t.referencedRule,t.idx)+this.topProd.name,a=r.concat(n),o=new it({definition:a}),u=cs(o);this.follows[i]=u},e}(Oi);function Im(s){var e={};return x(s,function(t){var r=new vm(t).startWalking();xt(e,r)}),e}function Om(s,e){return s.name+e+Ih}var Mm=4,Ir=8,wm=8,mn=1<<Ir,ei=2<<Ir,kn=3<<Ir,Gn=4<<Ir,Hn=5<<Ir,ln=6<<Ir;function Wn(s,e,t){return t|e|s}var _m=32-wm;function Oh(s,e,t,r){var n=r+1<<_m;return Wn(s,e,t)|n}var Lm=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function zo(s,e){isNaN(s.startOffset)===!0?(s.startOffset=e.startOffset,s.endOffset=e.endOffset):s.endOffset<e.endOffset&&(s.endOffset=e.endOffset)}function $o(s,e){isNaN(s.startOffset)===!0?(s.startOffset=e.startOffset,s.startColumn=e.startColumn,s.startLine=e.startLine,s.endOffset=e.endOffset,s.endColumn=e.endColumn,s.endLine=e.endLine):s.endOffset<e.endOffset&&(s.endOffset=e.endOffset,s.endColumn=e.endColumn,s.endLine=e.endLine)}function Fm(s,e,t){s.children[t]===void 0?s.children[t]=[e]:s.children[t].push(e)}function Xo(s,e,t){s.children[e]===void 0?s.children[e]=[t]:s.children[e].push(t)}var za=function(s){Lm(e,s);function e(t){var r=s.call(this)||this;return r.result=[],r.ruleIdx=t,r}return e.prototype.collectNamedDSLMethod=function(t,r,n){if(!At(t.name)){var i=void 0;if(t instanceof ke||t instanceof Ae||t instanceof Ct||t instanceof mt)i=new r({definition:t.definition,idx:t.idx});else if(t instanceof vt||t instanceof ft)i=new r({definition:t.definition,idx:t.idx,separator:t.separator});else throw Error("non exhaustive match");var a=[i],o=Wn(this.ruleIdx,n,t.idx);this.result.push({def:a,key:o,name:t.name,orgProd:t})}},e.prototype.visitOption=function(t){this.collectNamedDSLMethod(t,ke,ei)},e.prototype.visitRepetition=function(t){this.collectNamedDSLMethod(t,Ae,kn)},e.prototype.visitRepetitionMandatory=function(t){this.collectNamedDSLMethod(t,Ct,Gn)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.collectNamedDSLMethod(t,vt,ln)},e.prototype.visitRepetitionWithSeparator=function(t){this.collectNamedDSLMethod(t,ft,Hn)},e.prototype.visitAlternation=function(t){var r=this;this.collectNamedDSLMethod(t,mt,mn);var n=t.definition.length>1;x(t.definition,function(i,a){if(!At(i.name)){var o=i.definition;n?o=[new ke({definition:i.definition})]:o=i.definition;var u=Oh(r.ruleIdx,mn,t.idx,a);r.result.push({def:o,key:u,name:i.name,orgProd:i})}})},e}($r);function Um(s,e){var t={allRuleNames:[]};return x(s,function(r){var n=e[r.name];t.allRuleNames.push(r.name);var i=new za(n);r.accept(i),x(i.result,function(a){a.def,a.key;var o=a.name;t.allRuleNames.push(r.name+o)})}),t}var Xr=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),bm=function(s){Xr(e,s);function e(t,r){var n=s.call(this)||this;return n.topProd=t,n.path=r,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}return e.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=st(this.path.ruleStack).reverse(),this.occurrenceStack=st(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},e.prototype.walk=function(t,r){r===void 0&&(r=[]),this.found||s.prototype.walk.call(this,t,r)},e.prototype.walkProdRef=function(t,r,n){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){var i=r.concat(n);this.updateExpectedNext(),this.walk(t.referencedRule,i)}},e.prototype.updateExpectedNext=function(){ae(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},e}(Oi),xm=function(s){Xr(e,s);function e(t,r){var n=s.call(this,t,r)||this;return n.path=r,n.nextTerminalName="",n.nextTerminalOccurrence=0,n.nextTerminalName=n.path.lastTok.name,n.nextTerminalOccurrence=n.path.lastTokOccurrence,n}return e.prototype.walkTerminal=function(t,r,n){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){var i=r.concat(n),a=new it({definition:i});this.possibleTokTypes=cs(a),this.found=!0}},e}(bm),Mi=function(s){Xr(e,s);function e(t,r){var n=s.call(this)||this;return n.topRule=t,n.occurrence=r,n.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},n}return e.prototype.startWalking=function(){return this.walk(this.topRule),this.result},e}(Oi),Pm=function(s){Xr(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkMany=function(t,r,n){if(t.idx===this.occurrence){var i=yt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkMany.call(this,t,r,n)},e}(Mi),Ko=function(s){Xr(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkManySep=function(t,r,n){if(t.idx===this.occurrence){var i=yt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkManySep.call(this,t,r,n)},e}(Mi),Dm=function(s){Xr(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkAtLeastOne=function(t,r,n){if(t.idx===this.occurrence){var i=yt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkAtLeastOne.call(this,t,r,n)},e}(Mi),jo=function(s){Xr(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkAtLeastOneSep=function(t,r,n){if(t.idx===this.occurrence){var i=yt(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkAtLeastOneSep.call(this,t,r,n)},e}(Mi);function ha(s,e,t){t===void 0&&(t=[]),t=st(t);var r=[],n=0;function i(l){return l.concat(Be(s,n+1))}function a(l){var c=ha(i(l),e,t);return r.concat(c)}for(;t.length<e&&n<s.length;){var o=s[n];if(o instanceof it)return a(o.definition);if(o instanceof pt)return a(o.definition);if(o instanceof ke)r=a(o.definition);else if(o instanceof Ct){var u=o.definition.concat([new Ae({definition:o.definition})]);return a(u)}else if(o instanceof vt){var u=[new it({definition:o.definition}),new Ae({definition:[new fe({terminalType:o.separator})].concat(o.definition)})];return a(u)}else if(o instanceof ft){var u=o.definition.concat([new Ae({definition:[new fe({terminalType:o.separator})].concat(o.definition)})]);r=a(u)}else if(o instanceof Ae){var u=o.definition.concat([new Ae({definition:o.definition})]);r=a(u)}else{if(o instanceof mt)return x(o.definition,function(l){r=a(l.definition)}),r;if(o instanceof fe)t.push(o.terminalType);else throw Error("non exhaustive match")}n++}return r.push({partialPath:t,suffixDef:Be(s,n)}),r}function Mh(s,e,t,r){var n="EXIT_NONE_TERMINAL",i=[n],a="EXIT_ALTERNATIVE",o=!1,u=e.length,l=u-r-1,c=[],d=[];for(d.push({idx:-1,def:s,ruleStack:[],occurrenceStack:[]});!ae(d);){var f=d.pop();if(f===a){o&&ch(d).idx<=l&&d.pop();continue}var E=f.def,N=f.idx,R=f.ruleStack,y=f.occurrenceStack;if(!ae(E)){var S=E[0];if(S===n){var A={idx:N,def:Be(E),ruleStack:qn(R),occurrenceStack:qn(y)};d.push(A)}else if(S instanceof fe)if(N<u-1){var C=N+1,I=e[C];if(t(I,S.terminalType)){var A={idx:C,def:Be(E),ruleStack:R,occurrenceStack:y};d.push(A)}}else if(N===u-1)c.push({nextTokenType:S.terminalType,nextTokenOccurrence:S.idx,ruleStack:R,occurrenceStack:y}),o=!0;else throw Error("non exhaustive match");else if(S instanceof pt){var oe=st(R);oe.push(S.nonTerminalName);var Q=st(y);Q.push(S.idx);var A={idx:N,def:S.definition.concat(i,Be(E)),ruleStack:oe,occurrenceStack:Q};d.push(A)}else if(S instanceof ke){var ee={idx:N,def:Be(E),ruleStack:R,occurrenceStack:y};d.push(ee),d.push(a);var ve={idx:N,def:S.definition.concat(Be(E)),ruleStack:R,occurrenceStack:y};d.push(ve)}else if(S instanceof Ct){var Te=new Ae({definition:S.definition,idx:S.idx}),he=S.definition.concat([Te],Be(E)),A={idx:N,def:he,ruleStack:R,occurrenceStack:y};d.push(A)}else if(S instanceof vt){var q=new fe({terminalType:S.separator}),Te=new Ae({definition:[q].concat(S.definition),idx:S.idx}),he=S.definition.concat([Te],Be(E)),A={idx:N,def:he,ruleStack:R,occurrenceStack:y};d.push(A)}else if(S instanceof ft){var ee={idx:N,def:Be(E),ruleStack:R,occurrenceStack:y};d.push(ee),d.push(a);var q=new fe({terminalType:S.separator}),at=new Ae({definition:[q].concat(S.definition),idx:S.idx}),he=S.definition.concat([at],Be(E)),ve={idx:N,def:he,ruleStack:R,occurrenceStack:y};d.push(ve)}else if(S instanceof Ae){var ee={idx:N,def:Be(E),ruleStack:R,occurrenceStack:y};d.push(ee),d.push(a);var at=new Ae({definition:S.definition,idx:S.idx}),he=S.definition.concat([at],Be(E)),ve={idx:N,def:he,ruleStack:R,occurrenceStack:y};d.push(ve)}else if(S instanceof mt)for(var ze=S.definition.length-1;ze>=0;ze--){var gt=S.definition[ze],Ke={idx:N,def:gt.definition.concat(Be(E)),ruleStack:R,occurrenceStack:y};d.push(Ke),d.push(a)}else if(S instanceof it)d.push({idx:N,def:S.definition.concat(Be(E)),ruleStack:R,occurrenceStack:y});else if(S instanceof Cn)d.push(Vm(S,N,R,y));else throw Error("non exhaustive match")}}return c}function Vm(s,e,t,r){var n=st(t);n.push(s.name);var i=st(r);return i.push(1),{idx:e,def:s.definition,ruleStack:n,occurrenceStack:i}}var wh=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ue;(function(s){s[s.OPTION=0]="OPTION",s[s.REPETITION=1]="REPETITION",s[s.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",s[s.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",s[s.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",s[s.ALTERNATION=5]="ALTERNATION"})(ue||(ue={}));function Bm(s){if(s instanceof ke)return ue.OPTION;if(s instanceof Ae)return ue.REPETITION;if(s instanceof Ct)return ue.REPETITION_MANDATORY;if(s instanceof vt)return ue.REPETITION_MANDATORY_WITH_SEPARATOR;if(s instanceof ft)return ue.REPETITION_WITH_SEPARATOR;if(s instanceof mt)return ue.ALTERNATION;throw Error("non exhaustive match")}function km(s,e,t,r,n,i){var a=$a(s,e,t),o=Fh(a)?Zs:Ii;return i(a,r,o,n)}function Gm(s,e,t,r,n,i){var a=Xa(s,e,n,t),o=Fh(a)?Zs:Ii;return i(a[0],o,r)}function Hm(s,e,t,r){var n=s.length,i=St(s,function(u){return St(u,function(l){return l.length===1})});if(e)return function(u){for(var l=_(u,function(C){return C.GATE}),c=0;c<n;c++){var d=s[c],f=d.length,E=l[c];if(!(E!==void 0&&E.call(this)===!1))e:for(var N=0;N<f;N++){for(var R=d[N],y=R.length,S=0;S<y;S++){var A=this.LA(S+1);if(t(A,R[S])===!1)continue e}return c}}};if(i&&!r){var a=_(s,function(u){return nt(u)}),o=Ge(a,function(u,l,c){return x(l,function(d){b(u,d.tokenTypeIdx)||(u[d.tokenTypeIdx]=c),x(d.categoryMatches,function(f){b(u,f)||(u[f]=c)})}),u},[]);return function(){var u=this.LA(1);return o[u.tokenTypeIdx]}}else return function(){for(var u=0;u<n;u++){var l=s[u],c=l.length;e:for(var d=0;d<c;d++){for(var f=l[d],E=f.length,N=0;N<E;N++){var R=this.LA(N+1);if(t(R,f[N])===!1)continue e}return u}}}}function Wm(s,e,t){var r=St(s,function(l){return l.length===1}),n=s.length;if(r&&!t){var i=nt(s);if(i.length===1&&ae(i[0].categoryMatches)){var a=i[0],o=a.tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===o}}else{var u=Ge(i,function(l,c,d){return l[c.tokenTypeIdx]=!0,x(c.categoryMatches,function(f){l[f]=!0}),l},[]);return function(){var l=this.LA(1);return u[l.tokenTypeIdx]===!0}}}else return function(){e:for(var l=0;l<n;l++){for(var c=s[l],d=c.length,f=0;f<d;f++){var E=this.LA(f+1);if(e(E,c[f])===!1)continue e}return!0}return!1}}var Ym=function(s){wh(e,s);function e(t,r,n){var i=s.call(this)||this;return i.topProd=t,i.targetOccurrence=r,i.targetProdType=n,i}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},e.prototype.checkIsTarget=function(t,r,n,i){return t.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1},e.prototype.walkOption=function(t,r,n){this.checkIsTarget(t,ue.OPTION,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkAtLeastOne=function(t,r,n){this.checkIsTarget(t,ue.REPETITION_MANDATORY,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkAtLeastOneSep=function(t,r,n){this.checkIsTarget(t,ue.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkMany=function(t,r,n){this.checkIsTarget(t,ue.REPETITION,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkManySep=function(t,r,n){this.checkIsTarget(t,ue.REPETITION_WITH_SEPARATOR,r,n)||s.prototype.walkOption.call(this,t,r,n)},e}(Oi),_h=function(s){wh(e,s);function e(t,r,n){var i=s.call(this)||this;return i.targetOccurrence=t,i.targetProdType=r,i.targetRef=n,i.result=[],i}return e.prototype.checkIsTarget=function(t,r){t.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)},e.prototype.visitOption=function(t){this.checkIsTarget(t,ue.OPTION)},e.prototype.visitRepetition=function(t){this.checkIsTarget(t,ue.REPETITION)},e.prototype.visitRepetitionMandatory=function(t){this.checkIsTarget(t,ue.REPETITION_MANDATORY)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.checkIsTarget(t,ue.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.visitRepetitionWithSeparator=function(t){this.checkIsTarget(t,ue.REPETITION_WITH_SEPARATOR)},e.prototype.visitAlternation=function(t){this.checkIsTarget(t,ue.ALTERNATION)},e}($r);function qo(s){for(var e=new Array(s),t=0;t<s;t++)e[t]=[];return e}function Yi(s){for(var e=[""],t=0;t<s.length;t++){for(var r=s[t],n=[],i=0;i<e.length;i++){var a=e[i];n.push(a+"_"+r.tokenTypeIdx);for(var o=0;o<r.categoryMatches.length;o++){var u="_"+r.categoryMatches[o];n.push(a+u)}}e=n}return e}function zm(s,e,t){for(var r=0;r<s.length;r++)if(r!==t)for(var n=s[r],i=0;i<e.length;i++){var a=e[i];if(n[a]===!0)return!1}return!0}function Lh(s,e){for(var t=_(s,function(c){return ha([c],1)}),r=qo(t.length),n=_(t,function(c){var d={};return x(c,function(f){var E=Yi(f.partialPath);x(E,function(N){d[N]=!0})}),d}),i=t,a=1;a<=e;a++){var o=i;i=qo(o.length);for(var u=function(c){for(var d=o[c],f=0;f<d.length;f++){var E=d[f].partialPath,N=d[f].suffixDef,R=Yi(E),y=zm(n,R,c);if(y||ae(N)||E.length===e){var S=r[c];if(la(S,E)===!1){S.push(E);for(var A=0;A<R.length;A++){var C=R[A];n[c][C]=!0}}}else{var I=ha(N,a+1,E);i[c]=i[c].concat(I),x(I,function(oe){var Q=Yi(oe.partialPath);x(Q,function(ee){n[c][ee]=!0})})}}},l=0;l<o.length;l++)u(l)}return r}function $a(s,e,t,r){var n=new _h(s,ue.ALTERNATION,r);return e.accept(n),Lh(n.result,t)}function Xa(s,e,t,r){var n=new _h(s,t);e.accept(n);var i=n.result,a=new Ym(e,s,t),o=a.startWalking(),u=new it({definition:i}),l=new it({definition:o});return Lh([u,l],r)}function la(s,e){e:for(var t=0;t<s.length;t++){var r=s[t];if(r.length===e.length){for(var n=0;n<r.length;n++){var i=e[n],a=r[n],o=i===a||a.categoryMatchesMap[i.tokenTypeIdx]!==void 0;if(o===!1)continue e}return!0}}return!1}function $m(s,e){return s.length<e.length&&St(s,function(t,r){var n=e[r];return t===n||n.categoryMatchesMap[t.tokenTypeIdx]})}function Fh(s){return St(s,function(e){return St(e,function(t){return St(t,function(r){return ae(r.categoryMatches)})})})}var Ka=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function Xm(s,e,t,r,n,i){var a=_(s,function(A){return jm(A,n)}),o=_(s,function(A){return xh(A,A,n)}),u=[],l=[],c=[];St(o,ae)&&(u=_(s,function(A){return ng(A,n)}),l=_(s,function(A){return sg(A,e,r,n)}),c=og(s,e,n));var d=lg(s,t,n),f=_(t,function(A){return eg(A,n)}),E=Km(s,n),N=cg(s,n),R=_(s,function(A){return ag(A,n)}),y=_(s,function(A){return Zm(A,n)}),S=_(s,function(A){return tg(A,s,i,n)});return nt(a.concat(f,E,N,c,o,u,l,d,R,y,S))}function Km(s,e){var t=[];return x(s,function(r){var n=new za("");r.accept(n);var i=_(n.result,function(a){return a.orgProd});t.push(_(i,function(a){return Jm(r,a,e)}))}),nt(t)}function jm(s,e){var t=new Qm;s.accept(t);var r=t.allProductions,n=ph(r,qm),i=It(n,function(o){return o.length>1}),a=_(Ye(i),function(o){var u=yt(o),l=e.buildDuplicateFoundError(s,o),c=wt(u),d={message:l,type:xe.DUPLICATE_PRODUCTIONS,ruleName:s.name,dslName:c,occurrence:u.idx},f=Uh(u);return f&&(d.parameter=f),d});return a}function qm(s){return wt(s)+"_#_"+s.idx+"_#_"+Uh(s)}function Uh(s){return s instanceof fe?s.terminalType.name:s instanceof pt?s.nonTerminalName:""}var Qm=function(s){Ka(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.allProductions=[],t}return e.prototype.visitNonTerminal=function(t){this.allProductions.push(t)},e.prototype.visitOption=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e.prototype.visitAlternation=function(t){this.allProductions.push(t)},e.prototype.visitTerminal=function(t){this.allProductions.push(t)},e}($r),Yr=/^[a-zA-Z_]\w*$/,bh=new RegExp(Yr.source.replace("^","^\\$"));function Zm(s,e){var t=[],r=s.name;return r.match(Yr)||t.push({message:e.buildInvalidRuleNameError({topLevelRule:s,expectedPattern:Yr}),type:xe.INVALID_RULE_NAME,ruleName:r}),t}function Jm(s,e,t){var r=[],n;return e.name.match(bh)||(n=t.buildInvalidNestedRuleNameError(s,e),r.push({message:n,type:xe.INVALID_NESTED_RULE_NAME,ruleName:s.name})),r}function eg(s,e){var t=[],r=s.name;return r.match(Yr)||t.push({message:e.buildTokenNameError({tokenType:s,expectedPattern:Yr}),type:xe.INVALID_TOKEN_NAME}),t}function tg(s,e,t,r){var n=[],i=Ge(e,function(o,u){return u.name===s.name?o+1:o},0);if(i>1){var a=r.buildDuplicateRuleNameError({topLevelRule:s,grammarName:t});n.push({message:a,type:xe.DUPLICATE_RULE_NAME,ruleName:s.name})}return n}function rg(s,e,t){var r=[],n;return we(e,s)||(n="Invalid rule override, rule: ->"+s+"<- cannot be overridden in the grammar: ->"+t+"<-as it is not defined in any of the super grammars ",r.push({message:n,type:xe.INVALID_RULE_OVERRIDE,ruleName:s})),r}function xh(s,e,t,r){r===void 0&&(r=[]);var n=[],i=Vs(e.definition);if(ae(i))return[];var a=s.name,o=we(i,s);o&&n.push({message:t.buildLeftRecursionError({topLevelRule:s,leftRecursionPath:r}),type:xe.LEFT_RECURSION,ruleName:a});var u=Ai(i,r.concat([s])),l=_(u,function(c){var d=st(r);return d.push(c),xh(s,c,t,d)});return n.concat(nt(l))}function Vs(s){var e=[];if(ae(s))return e;var t=yt(s);if(t instanceof pt)e.push(t.referencedRule);else if(t instanceof it||t instanceof ke||t instanceof Ct||t instanceof vt||t instanceof ft||t instanceof Ae)e=e.concat(Vs(t.definition));else if(t instanceof mt)e=nt(_(t.definition,function(a){return Vs(a.definition)}));else if(!(t instanceof fe))throw Error("non exhaustive match");var r=Js(t),n=s.length>1;if(r&&n){var i=Be(s);return e.concat(Vs(i))}else return e}var ja=function(s){Ka(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.alternations=[],t}return e.prototype.visitAlternation=function(t){this.alternations.push(t)},e}($r);function ng(s,e){var t=new ja;s.accept(t);var r=t.alternations,n=Ge(r,function(i,a){var o=qn(a.definition),u=_(o,function(l,c){var d=Mh([l],[],null,1);return ae(d)?{message:e.buildEmptyAlternationError({topLevelRule:s,alternation:a,emptyChoiceIdx:c}),type:xe.NONE_LAST_EMPTY_ALT,ruleName:s.name,occurrence:a.idx,alternative:c+1}:null});return i.concat(us(u))},[]);return n}function sg(s,e,t,r){var n=new ja;s.accept(n);var i=n.alternations,a=t[s.name];a&&(i=Hr(i,function(u){return a[wt(u)+(u.idx===0?"":u.idx)]})),i=Hr(i,function(u){return u.ignoreAmbiguities===!0});var o=Ge(i,function(u,l){var c=l.idx,d=l.maxLookahead||e,f=$a(c,s,d,l),E=ug(f,l,s,r),N=hg(f,l,s,r);return u.concat(E,N)},[]);return o}var ig=function(s){Ka(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.allProductions=[],t}return e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e}($r);function ag(s,e){var t=new ja;s.accept(t);var r=t.alternations,n=Ge(r,function(i,a){return a.definition.length>255&&i.push({message:e.buildTooManyAlternativesError({topLevelRule:s,alternation:a}),type:xe.TOO_MANY_ALTS,ruleName:s.name,occurrence:a.idx}),i},[]);return n}function og(s,e,t){var r=[];return x(s,function(n){var i=new ig;n.accept(i);var a=i.allProductions;x(a,function(o){var u=Bm(o),l=o.maxLookahead||e,c=o.idx,d=Xa(c,n,u,l),f=d[0];if(ae(nt(f))){var E=t.buildEmptyRepetitionError({topLevelRule:n,repetition:o});r.push({message:E,type:xe.NO_NON_EMPTY_LOOKAHEAD,ruleName:n.name})}})}),r}function ug(s,e,t,r){var n=[],i=Ge(s,function(o,u,l){return e.definition[l].ignoreAmbiguities===!0||x(u,function(c){var d=[l];x(s,function(f,E){l!==E&&la(f,c)&&e.definition[E].ignoreAmbiguities!==!0&&d.push(E)}),d.length>1&&!la(n,c)&&(n.push(c),o.push({alts:d,path:c}))}),o},[]),a=_(i,function(o){var u=_(o.alts,function(c){return c+1}),l=r.buildAlternationAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:u,prefixPath:o.path});return{message:l,type:xe.AMBIGUOUS_ALTS,ruleName:t.name,occurrence:e.idx,alternatives:[o.alts]}});return a}function hg(s,e,t,r){var n=[],i=Ge(s,function(a,o,u){var l=_(o,function(c){return{idx:u,path:c}});return a.concat(l)},[]);return x(i,function(a){var o=e.definition[a.idx];if(o.ignoreAmbiguities!==!0){var u=a.idx,l=a.path,c=yf(i,function(f){return e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<u&&$m(f.path,l)}),d=_(c,function(f){var E=[f.idx+1,u+1],N=e.idx===0?"":e.idx,R=r.buildAlternationPrefixAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:E,prefixPath:f.path});return{message:R,type:xe.AMBIGUOUS_PREFIX_ALTS,ruleName:t.name,occurrence:N,alternatives:E}});n=n.concat(d)}}),n}function lg(s,e,t){var r=[],n=_(e,function(i){return i.name});return x(s,function(i){var a=i.name;if(we(n,a)){var o=t.buildNamespaceConflictError(i);r.push({message:o,type:xe.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:a})}}),r}function cg(s,e){var t=[];return x(s,function(r){var n=new za("");r.accept(n);var i=ph(n.result,function(o){return o.name}),a=It(i,function(o){return o.length>1});x(Ye(a),function(o){var u=_(o,function(c){return c.orgProd}),l=e.buildDuplicateNestedRuleNameError(r,u);t.push({message:l,type:xe.DUPLICATE_NESTED_NAME,ruleName:r.name})})}),t}var Ph={buildMismatchTokenMessage:function(s){var e=s.expected,t=s.actual;s.previous,s.ruleName;var r=vh(e),n=r?"--> "+fn(e)+" <--":"token of type --> "+e.name+" <--",i="Expecting "+n+" but found --> '"+t.image+"' <--";return i},buildNotAllInputParsedMessage:function(s){var e=s.firstRedundant;return s.ruleName,"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage:function(s){var e=s.expectedPathsPerAlt,t=s.actual;s.previous;var r=s.customUserDescription;s.ruleName;var n="Expecting: ",i=yt(t).image,a=`
but found: '`+i+"'";if(r)return n+r+a;var o=Ge(e,function(d,f){return d.concat(f)},[]),u=_(o,function(d){return"["+_(d,function(f){return fn(f)}).join(", ")+"]"}),l=_(u,function(d,f){return"  "+(f+1)+". "+d}),c=`one of these possible Token sequences:
`+l.join(`
`);return n+c+a},buildEarlyExitMessage:function(s){var e=s.expectedIterationPaths,t=s.actual,r=s.customUserDescription;s.ruleName;var n="Expecting: ",i=yt(t).image,a=`
but found: '`+i+"'";if(r)return n+r+a;var o=_(e,function(l){return"["+_(l,function(c){return fn(c)}).join(",")+"]"}),u=`expecting at least one iteration which starts with one of these possible Token sequences::
  `+("<"+o.join(" ,")+">");return n+u+a}};Object.freeze(Ph);var dg={buildRuleNotFoundError:function(s,e){var t="Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+s.name+"<-";return t}},qa={buildDuplicateFoundError:function(s,e){function t(c){return c instanceof fe?c.terminalType.name:c instanceof pt?c.nonTerminalName:""}var r=s.name,n=yt(e),i=n.idx,a=wt(n),o=t(n),u=i>0,l="->"+a+(u?i:"")+"<- "+(o?"with argument: ->"+o+"<-":"")+`
                  appears more than once (`+e.length+" times) in the top level rule: ->"+r+`<-.                  
                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildInvalidNestedRuleNameError:function(s,e){var t="Invalid nested rule name: ->"+e.name+"<- inside rule: ->"+s.name+`<-
`+("it must match the pattern: ->"+bh.toString()+`<-.
`)+"Note that this means a nested rule name must start with the '$'(dollar) sign.";return t},buildDuplicateNestedRuleNameError:function(s,e){var t=yt(e).name,r="Duplicate nested rule name: ->"+t+"<- inside rule: ->"+s.name+`<-
A nested name must be unique in the scope of a top level grammar rule.`;return r},buildNamespaceConflictError:function(s){var e=`Namespace conflict found in grammar.
`+("The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+s.name+`>.
`)+`To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`;return e},buildAlternationPrefixAmbiguityError:function(s){var e=_(s.prefixPath,function(n){return fn(n)}).join(", "),t=s.alternation.idx===0?"":s.alternation.idx,r="Ambiguous alternatives: <"+s.ambiguityIndices.join(" ,")+`> due to common lookahead prefix
`+("in <OR"+t+"> inside <"+s.topLevelRule.name+`> Rule,
`)+("<"+e+`> may appears as a prefix path in all these alternatives.
`)+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`;return r},buildAlternationAmbiguityError:function(s){var e=_(s.prefixPath,function(n){return fn(n)}).join(", "),t=s.alternation.idx===0?"":s.alternation.idx,r="Ambiguous Alternatives Detected: <"+s.ambiguityIndices.join(" ,")+"> in <OR"+t+">"+(" inside <"+s.topLevelRule.name+`> Rule,
`)+("<"+e+`> may appears as a prefix path in all these alternatives.
`);return r=r+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError:function(s){var e=wt(s.repetition);s.repetition.idx!==0&&(e+=s.repetition.idx);var t="The repetition <"+e+"> within Rule <"+s.topLevelRule.name+`> can never consume any tokens.
This could lead to an infinite loop.`;return t},buildTokenNameError:function(s){var e=s.tokenType.name,t="Invalid Grammar Token name: ->"+e+"<- it must match the pattern: ->"+s.expectedPattern.toString()+"<-";return t},buildEmptyAlternationError:function(s){var e="Ambiguous empty alternative: <"+(s.emptyChoiceIdx+1)+">"+(" in <OR"+s.alternation.idx+"> inside <"+s.topLevelRule.name+`> Rule.
`)+"Only the last alternative may be an empty alternative.";return e},buildTooManyAlternativesError:function(s){var e=`An Alternation cannot have more than 256 alternatives:
`+("<OR"+s.alternation.idx+"> inside <"+s.topLevelRule.name+`> Rule.
 has `+(s.alternation.definition.length+1)+" alternatives.");return e},buildLeftRecursionError:function(s){var e=s.topLevelRule.name,t=_(s.leftRecursionPath,function(i){return i.name}),r=e+" --> "+t.concat([e]).join(" --> "),n=`Left Recursion found in grammar.
`+("rule: <"+e+`> can be invoked from itself (directly or indirectly)
`)+(`without consuming any Tokens. The grammar path that causes this is: 
 `+r+`
`)+` To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring.`;return n},buildInvalidRuleNameError:function(s){var e=s.topLevelRule.name,t=s.expectedPattern.toString(),r="Invalid grammar rule name: ->"+e+"<- it must match the pattern: ->"+t+"<-";return r},buildDuplicateRuleNameError:function(s){var e;s.topLevelRule instanceof Cn?e=s.topLevelRule.name:e=s.topLevelRule;var t="Duplicate definition, rule: ->"+e+"<- is already defined in the grammar: ->"+s.grammarName+"<-";return t}},pg=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function fg(s,e){var t=new mg(s,e);return t.resolveRefs(),t.errors}var mg=function(s){pg(e,s);function e(t,r){var n=s.call(this)||this;return n.nameToTopRule=t,n.errMsgProvider=r,n.errors=[],n}return e.prototype.resolveRefs=function(){var t=this;x(Ye(this.nameToTopRule),function(r){t.currTopLevel=r,r.accept(t)})},e.prototype.visitNonTerminal=function(t){var r=this.nameToTopRule[t.nonTerminalName];if(r)t.referencedRule=r;else{var n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:n,type:xe.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}},e}($r);function gg(s){s=Ci(s,{errMsgProvider:dg});var e={};return x(s.rules,function(t){e[t.name]=t}),fg(e,s.errMsgProvider)}function Eg(s){return s=Ci(s,{errMsgProvider:qa,ignoredIssues:{}}),Xm(s.rules,s.maxLookahead,s.tokenTypes,s.ignoredIssues,s.errMsgProvider,s.grammarName)}var Dh="MismatchedTokenException",Vh="NoViableAltException",Bh="EarlyExitException",kh="NotAllInputParsedException",Gh=[Dh,Vh,Bh,kh];Object.freeze(Gh);function ti(s){return we(Gh,s.name)}function Qa(s,e,t){this.name=Dh,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}Qa.prototype=Error.prototype;function Hh(s,e,t){this.name=Vh,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}Hh.prototype=Error.prototype;function Wh(s,e){this.name=kh,this.message=s,this.token=e,this.resyncedTokens=[]}Wh.prototype=Error.prototype;function Yh(s,e,t){this.name=Bh,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}Yh.prototype=Error.prototype;var zi={},zh="InRuleRecoveryException";function $h(s){this.name=zh,this.message=s}$h.prototype=Error.prototype;var Rg=function(){function s(){}return s.prototype.initRecoverable=function(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=b(e,"recoveryEnabled")?e.recoveryEnabled:Je.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Tg)},s.prototype.getTokenToInsert=function(e){var t=Ya(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},s.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},s.prototype.tryInRepetitionRecovery=function(e,t,r,n){for(var i=this,a=this.findReSyncTokenType(),o=this.exportLexerState(),u=[],l=!1,c=this.LA(1),d=this.LA(1),f=function(){var E=i.LA(0),N=i.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:c,previous:E,ruleName:i.getCurrRuleFullName()}),R=new Qa(N,c,i.LA(0));R.resyncedTokens=qn(u),i.SAVE_ERROR(R)};!l;)if(this.tokenMatcher(d,n)){f();return}else if(r.call(this)){f(),e.apply(this,t);return}else this.tokenMatcher(d,a)?l=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,u));this.importLexerState(o)},s.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,r){return!(r===!1||e===void 0||t===void 0||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))},s.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t),n=this.getNextPossibleTokenTypes(r);return n},s.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t)){var r=this.getTokenToInsert(e);return r}if(this.canRecoverWithSingleTokenDeletion(e)){var n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new $h("sad sad panda")},s.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},s.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e)||ae(t))return!1;var n=this.LA(1),i=Nn(t,function(a){return r.tokenMatcher(n,a)})!==void 0;return i},s.prototype.canRecoverWithSingleTokenDeletion=function(e){var t=this.tokenMatcher(this.LA(2),e);return t},s.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return we(r,e)},s.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var n=t.tokenType;if(we(e,n))return n;t=this.LA(r),r++}},s.prototype.getCurrFollowKey=function(){if(this.RULE_STACK.length===1)return zi;var e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(r)}},s.prototype.buildFullFollowKeyStack=function(){var e=this,t=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return ae(this.LAST_EXPLICIT_RULE_STACK)||(t=_(this.LAST_EXPLICIT_RULE_STACK,function(n){return e.RULE_STACK[n]}),r=_(this.LAST_EXPLICIT_RULE_STACK,function(n){return e.RULE_OCCURRENCE_STACK[n]})),_(t,function(n,i){return i===0?zi:{ruleName:e.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:e.shortRuleNameToFullName(t[i-1])}})},s.prototype.flattenFollowSet=function(){var e=this,t=_(this.buildFullFollowKeyStack(),function(r){return e.getFollowSetFromFollowKey(r)});return nt(t)},s.prototype.getFollowSetFromFollowKey=function(e){if(e===zi)return[Wr];var t=e.ruleName+e.idxInCallingRule+Ih+e.inRule;return this.resyncFollows[t]},s.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,Wr)||t.push(e),t},s.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return qn(t)},s.prototype.attemptInRepetitionRecovery=function(e,t,r,n,i,a,o){},s.prototype.getCurrentGrammarPath=function(e,t){var r=this.getHumanReadableRuleStack(),n=st(this.RULE_OCCURRENCE_STACK),i={ruleStack:r,occurrenceStack:n,lastTok:e,lastTokOccurrence:t};return i},s.prototype.getHumanReadableRuleStack=function(){var e=this;return ae(this.LAST_EXPLICIT_RULE_STACK)?_(this.RULE_STACK,function(t){return e.shortRuleNameToFullName(t)}):_(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])})},s}();function Tg(s,e,t,r,n,i,a){var o=this.getKeyForAutomaticLookahead(r,n),u=this.firstAfterRepMap[o];if(u===void 0){var l=this.getCurrRuleFullName(),c=this.getGAstProductions()[l],d=new i(c,n);u=d.startWalking(),this.firstAfterRepMap[o]=u}var f=u.token,E=u.occurrence,N=u.isEndOfRule;this.RULE_STACK.length===1&&N&&f===void 0&&(f=Wr,E=1),this.shouldInRepetitionRecoveryBeTried(f,E,a)&&this.tryInRepetitionRecovery(s,e,t,f)}var Ng=function(){function s(){}return s.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=b(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Je.dynamicTokensEnabled,this.maxLookahead=b(e,"maxLookahead")?e.maxLookahead:Je.maxLookahead,this.lookAheadFuncsCache=wo()?new Map:[],wo()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},s.prototype.preComputeLookaheadFunctions=function(e){var t=this;x(e,function(r){t.TRACE_INIT(r.name+" Rule Lookahead",function(){var n=Nm(r),i=n.alternation,a=n.repetition,o=n.option,u=n.repetitionMandatory,l=n.repetitionMandatoryWithSeparator,c=n.repetitionWithSeparator;x(i,function(d){var f=d.idx===0?"":d.idx;t.TRACE_INIT(""+wt(d)+f,function(){var E=km(d.idx,r,d.maxLookahead||t.maxLookahead,d.hasPredicates,t.dynamicTokensEnabled,t.lookAheadBuilderForAlternatives),N=Wn(t.fullRuleNameToShort[r.name],mn,d.idx);t.setLaFuncCache(N,E)})}),x(a,function(d){t.computeLookaheadFunc(r,d.idx,kn,ue.REPETITION,d.maxLookahead,wt(d))}),x(o,function(d){t.computeLookaheadFunc(r,d.idx,ei,ue.OPTION,d.maxLookahead,wt(d))}),x(u,function(d){t.computeLookaheadFunc(r,d.idx,Gn,ue.REPETITION_MANDATORY,d.maxLookahead,wt(d))}),x(l,function(d){t.computeLookaheadFunc(r,d.idx,ln,ue.REPETITION_MANDATORY_WITH_SEPARATOR,d.maxLookahead,wt(d))}),x(c,function(d){t.computeLookaheadFunc(r,d.idx,Hn,ue.REPETITION_WITH_SEPARATOR,d.maxLookahead,wt(d))})})})},s.prototype.computeLookaheadFunc=function(e,t,r,n,i,a){var o=this;this.TRACE_INIT(""+a+(t===0?"":t),function(){var u=Gm(t,e,i||o.maxLookahead,o.dynamicTokensEnabled,n,o.lookAheadBuilderForOptional),l=Wn(o.fullRuleNameToShort[e.name],r,t);o.setLaFuncCache(l,u)})},s.prototype.lookAheadBuilderForOptional=function(e,t,r){return Wm(e,t,r)},s.prototype.lookAheadBuilderForAlternatives=function(e,t,r,n){return Hm(e,t,r,n)},s.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return Wn(r,e,t)},s.prototype.getLaFuncFromCache=function(e){},s.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},s.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},s.prototype.setLaFuncCache=function(e,t){},s.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},s.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},s}();function Sg(s){return wi(s.constructor)}var yg=/^\s*function\s*(\S*)\s*\(/,Qo="name";function wi(s){var e=s.name;if(e)return e;var t=s.toString().match(yg)[1];return t}function Xh(s,e){var t=Object.getOwnPropertyDescriptor(s,Qo);return At(t)||t.configurable?(Object.defineProperty(s,Qo,{enumerable:!1,configurable:!0,writable:!1,value:e}),!0):!1}function Ag(s,e){for(var t=ur(s),r=t.length,n=0;n<r;n++)for(var i=t[n],a=s[i],o=a.length,u=0;u<o;u++){var l=a[u];l.tokenTypeIdx===void 0&&(l.fullName!==void 0?this[l.fullName](l.children,e):this[l.name](l.children,e))}}function Cg(s,e){var t=function(){};Xh(t,s+"BaseSemantics");var r={visit:function(n,i){if(Ft(n)&&(n=n[0]),!At(n))return n.fullName!==void 0?this[n.fullName](n.children,i):this[n.name](n.children,i)},validateVisitor:function(){var n=Ig(this,e);if(!ae(n)){var i=_(n,function(a){return a.msg});throw Error("Errors Detected in CST Visitor <"+wi(this.constructor)+`>:
	`+(""+i.join(`

`).replace(/\n/g,`
	`)))}}};return t.prototype=r,t.prototype.constructor=t,t._RULE_NAMES=e,t}function vg(s,e,t){var r=function(){};Xh(r,s+"BaseSemanticsWithDefaults");var n=Object.create(t.prototype);return x(e,function(i){n[i]=Ag}),r.prototype=n,r.prototype.constructor=r,r}var ri;(function(s){s[s.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",s[s.MISSING_METHOD=1]="MISSING_METHOD"})(ri||(ri={}));function Ig(s,e){var t=Og(s,e),r=wg(s,e);return t.concat(r)}function Og(s,e){var t=_(e,function(r){if(!vr(s[r]))return{msg:"Missing visitor method: <"+r+"> on "+wi(s.constructor)+" CST Visitor.",type:ri.MISSING_METHOD,methodName:r}});return us(t)}var Mg=["constructor","visit","validateVisitor"];function wg(s,e){var t=[];for(var r in s)Yr.test(r)&&vr(s[r])&&!we(Mg,r)&&!we(e,r)&&t.push({msg:"Redundant visitor method: <"+r+"> on "+wi(s.constructor)+` CST Visitor
There is no Grammar Rule corresponding to this method's name.
`+("For utility methods on visitor classes use methods names that do not match /"+Yr.source+"/."),type:ri.REDUNDANT_METHOD,methodName:r});return t}var _g=function(){function s(){}return s.prototype.initTreeBuilder=function(e){if(this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=b(e,"outputCst")?e.outputCst:Je.outputCst,this.nodeLocationTracking=b(e,"nodeLocationTracking")?e.nodeLocationTracking:Je.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Le,this.cstFinallyStateUpdate=Le,this.cstPostTerminal=Le,this.cstPostNonTerminal=Le,this.cstPostRule=Le,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=$o,this.setNodeLocationFromNode=$o,this.cstPostRule=Le,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Le,this.setNodeLocationFromNode=Le,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=zo,this.setNodeLocationFromNode=zo,this.cstPostRule=Le,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Le,this.setNodeLocationFromNode=Le,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Le,this.setNodeLocationFromNode=Le,this.cstPostRule=Le,this.setInitialNodeLocation=Le;else throw Error('Invalid <nodeLocationTracking> config option: "'+e.nodeLocationTracking+'"')},s.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},s.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},s.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},s.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},s.prototype.cstNestedInvocationStateUpdate=function(e,t){var r={name:e,fullName:this.shortRuleNameToFull[this.getLastExplicitRuleShortName()]+e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},s.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1);var r={name:e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},s.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},s.prototype.cstNestedFinallyStateUpdate=function(){var e=this.CST_STACK.pop();this.cstPostRule(e)},s.prototype.cstPostRuleFull=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?(r.endOffset=t.endOffset,r.endLine=t.endLine,r.endColumn=t.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)},s.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?r.endOffset=t.endOffset:r.startOffset=NaN},s.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];Fm(r,t,e),this.setNodeLocationFromToken(r.location,t)},s.prototype.cstPostNonTerminal=function(e,t){if(this.isBackTracking()!==!0){var r=this.CST_STACK[this.CST_STACK.length-1];Xo(r,t,e),this.setNodeLocationFromNode(r.location,e.location)}},s.prototype.getBaseCstVisitorConstructor=function(){if(At(this.baseCstVisitorConstructor)){var e=Cg(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},s.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(At(this.baseCstVisitorWithDefaultsConstructor)){var e=vg(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},s.prototype.nestedRuleBeforeClause=function(e,t){var r;if(e.NAME!==void 0)return r=e.NAME,this.nestedRuleInvocationStateUpdate(r,t),r},s.prototype.nestedAltBeforeClause=function(e,t,r,n){var i=this.getLastExplicitRuleShortName(),a=Oh(i,r,t,n),o;if(e.NAME!==void 0)return o=e.NAME,this.nestedRuleInvocationStateUpdate(o,a),{shortName:a,nestedName:o}},s.prototype.nestedRuleFinallyClause=function(e,t){var r=this.CST_STACK,n=r[r.length-1];this.nestedRuleFinallyStateUpdate();var i=r[r.length-1];Xo(i,t,n),this.setNodeLocationFromNode(i.location,n.location)},s.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},s.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},s.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},s.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},s.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},s.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},s.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},s.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},s}(),Lg=function(){function s(){}return s.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(s.prototype,"input",{get:function(){return this.tokVector},set:function(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),s.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):si},s.prototype.LA=function(e){var t=this.currIdx+e;return t<0||this.tokVectorLength<=t?si:this.tokVector[t]},s.prototype.consumeToken=function(){this.currIdx++},s.prototype.exportLexerState=function(){return this.currIdx},s.prototype.importLexerState=function(e){this.currIdx=e},s.prototype.resetLexerState=function(){this.currIdx=-1},s.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},s.prototype.getLexerPosition=function(){return this.exportLexerState()},s}(),Fg=function(){function s(){}return s.prototype.ACTION=function(e){return e.call(this)},s.prototype.consume=function(e,t,r){return this.consumeInternal(t,e,r)},s.prototype.subrule=function(e,t,r){return this.subruleInternal(t,e,r)},s.prototype.option=function(e,t){return this.optionInternal(t,e)},s.prototype.or=function(e,t){return this.orInternal(t,e)},s.prototype.many=function(e,t){return this.manyInternal(e,t)},s.prototype.atLeastOne=function(e,t){return this.atLeastOneInternal(e,t)},s.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},s.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},s.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},s.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},s.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},s.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},s.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},s.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},s.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},s.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},s.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},s.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},s.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},s.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},s.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},s.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},s.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},s.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},s.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},s.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},s.prototype.OPTION=function(e){return this.optionInternal(e,0)},s.prototype.OPTION1=function(e){return this.optionInternal(e,1)},s.prototype.OPTION2=function(e){return this.optionInternal(e,2)},s.prototype.OPTION3=function(e){return this.optionInternal(e,3)},s.prototype.OPTION4=function(e){return this.optionInternal(e,4)},s.prototype.OPTION5=function(e){return this.optionInternal(e,5)},s.prototype.OPTION6=function(e){return this.optionInternal(e,6)},s.prototype.OPTION7=function(e){return this.optionInternal(e,7)},s.prototype.OPTION8=function(e){return this.optionInternal(e,8)},s.prototype.OPTION9=function(e){return this.optionInternal(e,9)},s.prototype.OR=function(e){return this.orInternal(e,0)},s.prototype.OR1=function(e){return this.orInternal(e,1)},s.prototype.OR2=function(e){return this.orInternal(e,2)},s.prototype.OR3=function(e){return this.orInternal(e,3)},s.prototype.OR4=function(e){return this.orInternal(e,4)},s.prototype.OR5=function(e){return this.orInternal(e,5)},s.prototype.OR6=function(e){return this.orInternal(e,6)},s.prototype.OR7=function(e){return this.orInternal(e,7)},s.prototype.OR8=function(e){return this.orInternal(e,8)},s.prototype.OR9=function(e){return this.orInternal(e,9)},s.prototype.MANY=function(e){this.manyInternal(0,e)},s.prototype.MANY1=function(e){this.manyInternal(1,e)},s.prototype.MANY2=function(e){this.manyInternal(2,e)},s.prototype.MANY3=function(e){this.manyInternal(3,e)},s.prototype.MANY4=function(e){this.manyInternal(4,e)},s.prototype.MANY5=function(e){this.manyInternal(5,e)},s.prototype.MANY6=function(e){this.manyInternal(6,e)},s.prototype.MANY7=function(e){this.manyInternal(7,e)},s.prototype.MANY8=function(e){this.manyInternal(8,e)},s.prototype.MANY9=function(e){this.manyInternal(9,e)},s.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},s.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},s.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},s.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},s.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},s.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},s.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},s.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},s.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},s.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},s.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},s.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},s.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},s.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},s.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},s.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},s.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},s.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},s.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},s.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},s.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},s.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},s.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},s.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},s.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},s.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},s.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},s.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},s.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},s.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},s.prototype.RULE=function(e,t,r){if(r===void 0&&(r=ii),we(this.definedRulesNames,e)){var n=qa.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),i={message:n,type:xe.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}this.definedRulesNames.push(e);var a=this.defineRule(e,t,r);return this[e]=a,a},s.prototype.OVERRIDE_RULE=function(e,t,r){r===void 0&&(r=ii);var n=[];n=n.concat(rg(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,n);var i=this.defineRule(e,t,r);return this[e]=i,i},s.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(n){if(ti(n))return!1;throw n}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},s.prototype.getGAstProductions=function(){return this.gastProductionsCache},s.prototype.getSerializedGastProductions=function(){return mm(Ye(this.gastProductionsCache))},s}(),Ug=function(){function s(){}return s.prototype.initRecognizerEngine=function(e,t){if(this.className=Sg(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Zs,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},b(t,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Ft(e)){if(ae(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Ft(e))this.tokensMap=Ge(e,function(a,o){return a[o.name]=o,a},{});else if(b(e,"modes")&&St(nt(Ye(e.modes)),cm)){var r=nt(Ye(e.modes)),n=ka(r);this.tokensMap=Ge(n,function(a,o){return a[o.name]=o,a},{})}else if(Ga(e))this.tokensMap=os(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Wr;var i=St(Ye(e),function(a){return ae(a.categoryMatches)});this.tokenMatcher=i?Zs:Ii,ls(Ye(this.tokensMap))},s.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+`> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);var n=b(r,"resyncEnabled")?r.resyncEnabled:ii.resyncEnabled,i=b(r,"recoveryValueFunc")?r.recoveryValueFunc:ii.recoveryValueFunc,a=this.ruleShortNameIdx<<Mm+Ir;this.ruleShortNameIdx++,this.shortRuleNameToFull[a]=e,this.fullRuleNameToShort[e]=a;function o(c){try{if(this.outputCst===!0){t.apply(this,c);var d=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(d),d}else return t.apply(this,c)}catch(f){return this.invokeRuleCatch(f,n,i)}finally{this.ruleFinallyStateUpdate()}}var u;u=function(c,d){return c===void 0&&(c=0),this.ruleInvocationStateUpdate(a,e,c),o.call(this,d)};var l="ruleName";return u[l]=e,u.originalGrammarAction=t,u},s.prototype.invokeRuleCatch=function(e,t,r){var n=this.RULE_STACK.length===1,i=t&&!this.isBackTracking()&&this.recoveryEnabled;if(ti(e)){var a=e;if(i){var o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))if(a.resyncedTokens=this.reSyncTo(o),this.outputCst){var u=this.CST_STACK[this.CST_STACK.length-1];return u.recoveredNode=!0,u}else return r();else{if(this.outputCst){var u=this.CST_STACK[this.CST_STACK.length-1];u.recoveredNode=!0,a.partialCstResult=u}throw a}}else{if(n)return this.moveToTerminatedState(),r();throw a}}else throw e},s.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(ei,t),n=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(ei,t);return this.optionInternalLogic(e,t,r)},s.prototype.optionInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(e.DEF!==void 0){if(a=e.DEF,o=e.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=e;if(i.call(this)===!0)return a.call(this)},s.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Gn,e),n=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Gn,e);this.atLeastOneInternalLogic(e,t,r)},s.prototype.atLeastOneInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(t.DEF!==void 0){if(a=t.DEF,o=t.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=t;if(i.call(this)===!0)for(var l=this.doSingleRepetition(a);i.call(this)===!0&&l===!0;)l=this.doSingleRepetition(a);else throw this.raiseEarlyExitException(e,ue.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],i,Gn,e,Dm)},s.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(ln,e),n=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(ln,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},s.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var n=this,i=t.DEF,a=t.SEP,o=this.getLaFuncFromCache(r);if(o.call(this)===!0){i.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),a)};this.tokenMatcher(this.LA(1),a)===!0;)this.CONSUME(a),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,a,u,i,jo],u,ln,e,jo)}else throw this.raiseEarlyExitException(e,ue.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)},s.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(kn,e),n=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(kn,e);return this.manyInternalLogic(e,t,r)},s.prototype.manyInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(t.DEF!==void 0){if(a=t.DEF,o=t.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=t;for(var l=!0;i.call(this)===!0&&l===!0;)l=this.doSingleRepetition(a);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],i,kn,e,Pm,l)},s.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Hn,e),n=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Hn,e);this.manySepFirstInternalLogic(e,t,r)},s.prototype.manySepFirstInternalLogic=function(e,t,r){var n=this,i=t.DEF,a=t.SEP,o=this.getLaFuncFromCache(r);if(o.call(this)===!0){i.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),a)};this.tokenMatcher(this.LA(1),a)===!0;)this.CONSUME(a),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,a,u,i,Ko],u,Hn,e,Ko)}},s.prototype.repetitionSepSecondInternal=function(e,t,r,n,i){for(;r();)this.CONSUME(t),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,n,i],r,ln,e,i)},s.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();e.call(this);var r=this.getLexerPosition();return r>t},s.prototype.orInternalNoCst=function(e,t){var r=Ft(e)?e:e.DEF,n=this.getKeyForAutomaticLookahead(mn,t),i=this.getLaFuncFromCache(n),a=i.call(this,r);if(a!==void 0){var o=r[a];return o.ALT.call(this)}this.raiseNoAltException(t,e.ERR_MSG)},s.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(mn,t),n=this.nestedRuleBeforeClause(e,r);try{var i=Ft(e)?e:e.DEF,a=this.getLaFuncFromCache(r),o=a.call(this,i);if(o!==void 0){var u=i[o],l=this.nestedAltBeforeClause(u,t,mn,o);try{return u.ALT.call(this)}finally{l!==void 0&&this.nestedRuleFinallyClause(l.shortName,l.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Wh(t,e))}},s.prototype.subruleInternal=function(e,t,r){var n;try{var i=r!==void 0?r.ARGS:void 0;return n=e.call(this,t,i),this.cstPostNonTerminal(n,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),n}catch(a){this.subruleInternalError(a,r,e.ruleName)}},s.prototype.subruleInternalError=function(e,t,r){throw ti(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,t!==void 0&&t.LABEL!==void 0?t.LABEL:r),delete e.partialCstResult),e},s.prototype.consumeInternal=function(e,t,r){var n;try{var i=this.LA(1);this.tokenMatcher(i,e)===!0?(this.consumeToken(),n=i):this.consumeInternalError(e,i,r)}catch(a){n=this.consumeInternalRecovery(e,t,a)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,n),n},s.prototype.consumeInternalError=function(e,t,r){var n,i=this.LA(0);throw r!==void 0&&r.ERR_MSG?n=r.ERR_MSG:n=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Qa(n,t,i))},s.prototype.consumeInternalRecovery=function(e,t,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){var n=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,n)}catch(i){throw i.name===zh?r:i}}else throw r},s.prototype.saveRecogState=function(){var e=this.errors,t=st(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},s.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},s.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},s.prototype.isBackTracking=function(){return this.isBackTrackingStack.length!==0},s.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]},s.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull[e]},s.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),Wr)},s.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},s}(),bg=function(){function s(){}return s.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=Ci(e.errorMessageProvider,Je.errorMessageProvider)},s.prototype.SAVE_ERROR=function(e){if(ti(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:st(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(s.prototype,"errors",{get:function(){return st(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),s.prototype.raiseEarlyExitException=function(e,t,r){for(var n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],a=Xa(e,i,t,this.maxLookahead),o=a[0],u=[],l=1;l<=this.maxLookahead;l++)u.push(this.LA(l));var c=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:o,actual:u,previous:this.LA(0),customUserDescription:r,ruleName:n});throw this.SAVE_ERROR(new Yh(c,this.LA(1),this.LA(0)))},s.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),n=this.getGAstProductions()[r],i=$a(e,n,this.maxLookahead),a=[],o=1;o<=this.maxLookahead;o++)a.push(this.LA(o));var u=this.LA(0),l=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:a,previous:u,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Hh(l,this.LA(1),u))},s}(),xg=function(){function s(){}return s.prototype.initContentAssist=function(){},s.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache[e];if(At(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return Mh([r],t,this.tokenMatcher,this.maxLookahead)},s.prototype.getNextPossibleTokenTypes=function(e){var t=yt(e.ruleStack),r=this.getGAstProductions(),n=r[t],i=new xm(n,e).startWalking();return i},s}(),_i={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(_i);var Zo=!0,Jo=Math.pow(2,Ir)-1,Kh=z({name:"RECORDING_PHASE_TOKEN",pattern:rt.NA});ls([Kh]);var jh=Ya(Kh,`This IToken indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(jh);var Pg={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,children:{}},Dg=function(){function s(){}return s.prototype.initGastRecorder=function(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1},s.prototype.enableRecording=function(){var e=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var t=function(n){var i=n>0?n:"";e["CONSUME"+i]=function(a,o){return this.consumeInternalRecord(a,n,o)},e["SUBRULE"+i]=function(a,o){return this.subruleInternalRecord(a,n,o)},e["OPTION"+i]=function(a){return this.optionInternalRecord(a,n)},e["OR"+i]=function(a){return this.orInternalRecord(a,n)},e["MANY"+i]=function(a){this.manyInternalRecord(n,a)},e["MANY_SEP"+i]=function(a){this.manySepFirstInternalRecord(n,a)},e["AT_LEAST_ONE"+i]=function(a){this.atLeastOneInternalRecord(n,a)},e["AT_LEAST_ONE_SEP"+i]=function(a){this.atLeastOneSepFirstInternalRecord(n,a)}},r=0;r<10;r++)t(r);e.consume=function(n,i,a){return this.consumeInternalRecord(i,n,a)},e.subrule=function(n,i,a){return this.subruleInternalRecord(i,n,a)},e.option=function(n,i){return this.optionInternalRecord(i,n)},e.or=function(n,i){return this.orInternalRecord(i,n)},e.many=function(n,i){this.manyInternalRecord(n,i)},e.atLeastOne=function(n,i){this.atLeastOneInternalRecord(n,i)},e.ACTION=e.ACTION_RECORD,e.BACKTRACK=e.BACKTRACK_RECORD,e.LA=e.LA_RECORD})},s.prototype.disableRecording=function(){var e=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var t=0;t<10;t++){var r=t>0?t:"";delete e["CONSUME"+r],delete e["SUBRULE"+r],delete e["OPTION"+r],delete e["OR"+r],delete e["MANY"+r],delete e["MANY_SEP"+r],delete e["AT_LEAST_ONE"+r],delete e["AT_LEAST_ONE_SEP"+r]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})},s.prototype.ACTION_RECORD=function(e){},s.prototype.BACKTRACK_RECORD=function(e,t){return function(){return!0}},s.prototype.LA_RECORD=function(e){return si},s.prototype.topLevelRuleRecord=function(e,t){try{var r=new Cn({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}},s.prototype.optionInternalRecord=function(e,t){return bn.call(this,ke,e,t)},s.prototype.atLeastOneInternalRecord=function(e,t){bn.call(this,Ct,t,e)},s.prototype.atLeastOneSepFirstInternalRecord=function(e,t){bn.call(this,vt,t,e,Zo)},s.prototype.manyInternalRecord=function(e,t){bn.call(this,Ae,t,e)},s.prototype.manySepFirstInternalRecord=function(e,t){bn.call(this,ft,t,e,Zo)},s.prototype.orInternalRecord=function(e,t){return Vg.call(this,e,t)},s.prototype.subruleInternalRecord=function(e,t,r){if(ni(t),!e||b(e,"ruleName")===!1){var n=new Error("<SUBRULE"+eu(t)+"> argument is invalid"+(" expecting a Parser method reference but got: <"+JSON.stringify(e)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw n.KNOWN_RECORDER_ERROR=!0,n}var i=qs(this.recordingProdStack),a=e.ruleName,o=new pt({idx:t,nonTerminalName:a,referencedRule:void 0});return i.definition.push(o),this.outputCst?Pg:_i},s.prototype.consumeInternalRecord=function(e,t,r){if(ni(t),!Ch(e)){var n=new Error("<CONSUME"+eu(t)+"> argument is invalid"+(" expecting a TokenType reference but got: <"+JSON.stringify(e)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw n.KNOWN_RECORDER_ERROR=!0,n}var i=qs(this.recordingProdStack),a=new fe({idx:t,terminalType:e});return i.definition.push(a),jh},s}();function bn(s,e,t,r){r===void 0&&(r=!1),ni(t);var n=qs(this.recordingProdStack),i=vr(e)?e:e.DEF,a=new s({definition:[],idx:t});return b(e,"NAME")&&(a.name=e.NAME),r&&(a.separator=e.SEP),b(e,"MAX_LOOKAHEAD")&&(a.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(a),i.call(this),n.definition.push(a),this.recordingProdStack.pop(),_i}function Vg(s,e){var t=this;ni(e);var r=qs(this.recordingProdStack),n=Ft(s)===!1,i=n===!1?s:s.DEF,a=new mt({definition:[],idx:e,ignoreAmbiguities:n&&s.IGNORE_AMBIGUITIES===!0});b(s,"NAME")&&(a.name=s.NAME),b(s,"MAX_LOOKAHEAD")&&(a.maxLookahead=s.MAX_LOOKAHEAD);var o=dh(i,function(u){return vr(u.GATE)});return a.hasPredicates=o,r.definition.push(a),x(i,function(u){var l=new it({definition:[]});a.definition.push(l),b(u,"NAME")&&(l.name=u.NAME),b(u,"IGNORE_AMBIGUITIES")?l.ignoreAmbiguities=u.IGNORE_AMBIGUITIES:b(u,"GATE")&&(l.ignoreAmbiguities=!0),t.recordingProdStack.push(l),u.ALT.call(t),t.recordingProdStack.pop()}),_i}function eu(s){return s===0?"":""+s}function ni(s){if(s<0||s>Jo){var e=new Error("Invalid DSL Method idx value: <"+s+`>
	`+("Idx value must be a none negative value smaller than "+(Jo+1)));throw e.KNOWN_RECORDER_ERROR=!0,e}}var Bg=function(){function s(){}return s.prototype.initPerformanceTracer=function(e){if(b(e,"traceInitPerf")){var t=e.traceInitPerf,r=typeof t=="number";this.traceInitMaxIdent=r?t:1/0,this.traceInitPerf=r?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=Je.traceInitPerf;this.traceInitIndent=-1},s.prototype.TRACE_INIT=function(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--> <"+e+">");var n=mh(t),i=n.time,a=n.value,o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(r+"<-- <"+e+"> time: "+i+"ms"),this.traceInitIndent--,a}else return t()},s}(),qh=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),si=Ya(Wr,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(si);var Je=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Ph,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),ii=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),xe;(function(s){s[s.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",s[s.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",s[s.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",s[s.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",s[s.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",s[s.LEFT_RECURSION=5]="LEFT_RECURSION",s[s.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",s[s.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",s[s.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",s[s.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",s[s.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",s[s.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",s[s.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",s[s.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",s[s.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"})(xe||(xe={}));function kg(s){return s===void 0&&(s=void 0),function(){return s}}var Za=function(){function s(e,t){t===void 0&&(t=Je),this.ignoredIssues=Je.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1;var r=this;r.initErrorHandler(t),r.initLexerAdapter(),r.initLooksAhead(t),r.initRecognizerEngine(e,t),r.initRecoverable(t),r.initTreeBuilder(t),r.initContentAssist(),r.initGastRecorder(t),r.initPerformanceTracer(t),b(t,"ignoredIssues")&&t.ignoredIssues!==Je.ignoredIssues&&Ha(`The <ignoredIssues> IParserConfig property is soft-deprecated and will be removed in future versions.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.`),this.ignoredIssues=b(t,"ignoredIssues")?t.ignoredIssues:Je.ignoredIssues,this.skipValidations=b(t,"skipValidations")?t.skipValidations:Je.skipValidations}return s.performSelfAnalysis=function(e){e.performSelfAnalysis()},s.prototype.performSelfAnalysis=function(){var e=this;this.TRACE_INIT("performSelfAnalysis",function(){var t;e.selfAnalysisDone=!0;var r=e.className;e.TRACE_INIT("toFastProps",function(){fh(e)}),e.TRACE_INIT("Grammar Recording",function(){try{e.enableRecording(),x(e.definedRulesNames,function(i){var a=e[i],o=a.originalGrammarAction,u=void 0;e.TRACE_INIT(i+" Rule",function(){u=e.topLevelRuleRecord(i,o)}),e.gastProductionsCache[i]=u})}finally{e.disableRecording()}});var n=[];if(e.TRACE_INIT("Grammar Resolving",function(){n=gg({rules:Ye(e.gastProductionsCache)}),e.definitionErrors.push.apply(e.definitionErrors,n)}),e.TRACE_INIT("Grammar Validations",function(){if(ae(n)&&e.skipValidations===!1){var i=Eg({rules:Ye(e.gastProductionsCache),maxLookahead:e.maxLookahead,tokenTypes:Ye(e.tokensMap),ignoredIssues:e.ignoredIssues,errMsgProvider:qa,grammarName:r});e.definitionErrors.push.apply(e.definitionErrors,i)}}),ae(e.definitionErrors)&&(e.recoveryEnabled&&e.TRACE_INIT("computeAllProdsFollows",function(){var i=Im(Ye(e.gastProductionsCache));e.resyncFollows=i}),e.TRACE_INIT("ComputeLookaheadFunctions",function(){e.preComputeLookaheadFunctions(Ye(e.gastProductionsCache))})),e.TRACE_INIT("expandAllNestedRuleNames",function(){var i=Um(Ye(e.gastProductionsCache),e.fullRuleNameToShort);e.allRuleNames=i.allRuleNames}),!s.DEFER_DEFINITION_ERRORS_HANDLING&&!ae(e.definitionErrors))throw t=_(e.definitionErrors,function(i){return i.message}),new Error(`Parser Definition Errors detected:
 `+t.join(`
-------------------------------
`))})},s.DEFER_DEFINITION_ERRORS_HANDLING=!1,s}();If(Za,[Rg,Ng,_g,Lg,Ug,Fg,bg,xg,Dg,Bg]);(function(s){qh(e,s);function e(t,r){r===void 0&&(r=Je);var n=this,i=os(r);return i.outputCst=!0,n=s.call(this,t,i)||this,n}return e})(Za);var Gg=function(s){qh(e,s);function e(t,r){r===void 0&&(r=Je);var n=this,i=os(r);return i.outputCst=!1,n=s.call(this,t,i)||this,n}return e}(Za);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const tu=(s,e)=>({type:s,message:e});var Ee;(function(s){s.LexingError="LexingError",s.ParserError="ParsingError",s.StaticOffsetError="StaticOffsetError",s.StaticOffsetOutOfRangeError="StaticOffsetOutOfRangeError",s.RangeOffsetNotAllowed="RangeOffsetNotAllowed",s.InvalidRangeSize="InvalidRangeSize"})(Ee||(Ee={}));var g;(function(s){s.EMPTY="EMPTY",s.NUMBER="NUMBER",s.STRING="STRING",s.MINUS_UNARY_OP="MINUS_UNARY_OP",s.PLUS_UNARY_OP="PLUS_UNARY_OP",s.PERCENT_OP="PERCENT_OP",s.CONCATENATE_OP="CONCATENATE_OP",s.EQUALS_OP="EQUALS_OP",s.NOT_EQUAL_OP="NOT_EQUAL_OP",s.GREATER_THAN_OP="GREATER_THAN_OP",s.LESS_THAN_OP="LESS_THAN_OP",s.GREATER_THAN_OR_EQUAL_OP="GREATER_THAN_OR_EQUAL_OP",s.LESS_THAN_OR_EQUAL_OP="LESS_THAN_OR_EQUAL_OP",s.PLUS_OP="PLUS_OP",s.MINUS_OP="MINUS_OP",s.TIMES_OP="TIMES_OP",s.DIV_OP="DIV_OP",s.POWER_OP="POWER_OP",s.FUNCTION_CALL="FUNCTION_CALL",s.NAMED_EXPRESSION="NAMED_EXPRESSION",s.PARENTHESIS="PARENTHESES",s.CELL_REFERENCE="CELL_REFERENCE",s.CELL_RANGE="CELL_RANGE",s.COLUMN_RANGE="COLUMN_RANGE",s.ROW_RANGE="ROW_RANGE",s.ERROR="ERROR",s.ERROR_WITH_RAW_INPUT="ERROR_WITH_RAW_INPUT",s.ARRAY="ARRAY"})(g||(g={}));var ht;(function(s){s[s.RELATIVE=0]="RELATIVE",s[s.START_ABSOLUTE=1]="START_ABSOLUTE",s[s.BOTH_ABSOLUTE=2]="BOTH_ABSOLUTE"})(ht||(ht={}));const Hg=s=>({type:g.EMPTY,leadingWhitespace:s?.image}),Wg=(s,e)=>({type:g.NUMBER,value:s,leadingWhitespace:e?.image}),Yg=s=>{var e;return{type:g.STRING,value:s.image.slice(1,-1),leadingWhitespace:(e=s.leadingWhitespace)===null||e===void 0?void 0:e.image}},ru=(s,e)=>({type:g.CELL_REFERENCE,reference:s,leadingWhitespace:e?.image}),nu=(s,e,t,r)=>(Ja(s,e,t),{type:g.CELL_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r}),zg=(s,e,t,r)=>(Ja(s,e,t),{type:g.COLUMN_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r?.image}),$g=(s,e,t,r)=>(Ja(s,e,t),{type:g.ROW_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r?.image}),Xg=(s,e,t)=>({type:g.CONCATENATE_OP,left:s,right:e,leadingWhitespace:t?.image}),Kg=(s,e,t)=>({type:g.EQUALS_OP,left:s,right:e,leadingWhitespace:t?.image}),jg=(s,e,t)=>({type:g.NOT_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),qg=(s,e,t)=>({type:g.GREATER_THAN_OP,left:s,right:e,leadingWhitespace:t?.image}),Qg=(s,e,t)=>({type:g.LESS_THAN_OP,left:s,right:e,leadingWhitespace:t?.image}),Zg=(s,e,t)=>({type:g.GREATER_THAN_OR_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),Jg=(s,e,t)=>({type:g.LESS_THAN_OR_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),eE=(s,e,t)=>({type:g.PLUS_OP,left:s,right:e,leadingWhitespace:t?.image}),tE=(s,e,t)=>({type:g.MINUS_OP,left:s,right:e,leadingWhitespace:t?.image}),rE=(s,e,t)=>({type:g.TIMES_OP,left:s,right:e,leadingWhitespace:t?.image}),nE=(s,e,t)=>({type:g.DIV_OP,left:s,right:e,leadingWhitespace:t?.image}),sE=(s,e,t)=>({type:g.POWER_OP,left:s,right:e,leadingWhitespace:t?.image}),iE=(s,e)=>({type:g.MINUS_UNARY_OP,value:s,leadingWhitespace:e?.image}),aE=(s,e)=>({type:g.PLUS_UNARY_OP,value:s,leadingWhitespace:e?.image}),oE=(s,e)=>({type:g.PERCENT_OP,value:s,leadingWhitespace:e?.image}),uE=(s,e,t,r,n)=>({type:g.FUNCTION_CALL,procedureName:s,args:e,leadingWhitespace:t?.image,internalWhitespace:r?.image,hyperlink:n}),su=(s,e,t)=>({type:g.ARRAY,args:s,leadingWhitespace:e?.image,internalWhitespace:t?.image}),hE=(s,e)=>({type:g.NAMED_EXPRESSION,expressionName:s,leadingWhitespace:e?.image}),lE=(s,e,t)=>({type:g.PARENTHESIS,expression:s,leadingWhitespace:e?.image,internalWhitespace:t?.image}),Gt=(s,e)=>({type:g.ERROR,error:s,leadingWhitespace:e?.image}),Zr=(s,e,t)=>({type:g.ERROR_WITH_RAW_INPUT,error:e,rawInput:s,leadingWhitespace:t?.image}),ca=()=>({type:g.ERROR,error:p.parsingError()});function Ja(s,e,t){if(s.sheet!==void 0&&e.sheet===void 0||s.sheet===void 0&&e.sheet!==void 0)throw new Error("Start address inconsistent with end address");if(s.sheet===void 0&&t!==ht.RELATIVE||s.sheet!==void 0&&t===ht.RELATIVE)throw new Error("Sheet address inconsistent with sheet reference type")}function $(s,e){return(e??"")+s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Qh={[g.PLUS_OP]:"+",[g.MINUS_OP]:"-",[g.TIMES_OP]:"*",[g.DIV_OP]:"/",[g.CONCATENATE_OP]:"&",[g.POWER_OP]:"^",[g.EQUALS_OP]:"=",[g.NOT_EQUAL_OP]:"<>",[g.GREATER_THAN_OP]:">",[g.GREATER_THAN_OR_EQUAL_OP]:">=",[g.LESS_THAN_OP]:"<",[g.LESS_THAN_OR_EQUAL_OP]:"<="};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const cE=(s,e,t,r)=>({ast:s,relativeDependencies:e,hasVolatileFunction:t,hasStructuralChangeFunction:r});class dE{constructor(e){this.functionRegistry=e,this.cache=new Map}set(e,t){const r=Fi(t,this.functionRegistry),n=cE(t,r,mr(t,this.functionRegistry.isFunctionVolatile),mr(t,this.functionRegistry.isFunctionDependentOnSheetStructureChange));return this.cache.set(e,n),n}get(e){return this.cache.get(e)}maybeSetAndThenGet(e,t){const r=this.cache.get(e);return r!==void 0?r.ast:(this.set(e,t),t)}}const mr=(s,e)=>{switch(s.type){case g.EMPTY:case g.NUMBER:case g.STRING:case g.ERROR:case g.ERROR_WITH_RAW_INPUT:case g.CELL_REFERENCE:case g.CELL_RANGE:case g.COLUMN_RANGE:case g.ROW_RANGE:case g.NAMED_EXPRESSION:return!1;case g.PERCENT_OP:case g.PLUS_UNARY_OP:case g.MINUS_UNARY_OP:return mr(s.value,e);case g.CONCATENATE_OP:case g.EQUALS_OP:case g.NOT_EQUAL_OP:case g.LESS_THAN_OP:case g.GREATER_THAN_OP:case g.LESS_THAN_OR_EQUAL_OP:case g.GREATER_THAN_OR_EQUAL_OP:case g.MINUS_OP:case g.PLUS_OP:case g.TIMES_OP:case g.DIV_OP:case g.POWER_OP:return mr(s.left,e)||mr(s.right,e);case g.PARENTHESIS:return mr(s.expression,e);case g.FUNCTION_CALL:return e(s.procedureName)?!0:s.args.some(t=>mr(t,e));case g.ARRAY:return s.args.some(t=>t.some(r=>mr(r,e)))}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class T{}T.DistinctSigns="Distinct signs.";T.WrongArgNumber="Wrong number of arguments.";T.EmptyArg="Empty function argument.";T.EmptyArray="Empty array not allowed.";T.ArrayDimensions="Array dimensions are not compatible.";T.NoSpaceForArrayResult="No space for array result.";T.ValueSmall="Value too small.";T.ValueLarge="Value too large.";T.BadCriterion="Incorrect criterion.";T.RangeManySheets="Range spans more than one sheet.";T.CellRangeExpected="Cell range expected.";T.WrongDimension="Wrong range dimension.";T.ScalarExpected="Cell range not allowed.";T.NumberCoercion="Value cannot be coerced to number.";T.NumberExpected="Number argument expected.";T.IntegerExpected="Value needs to be an integer.";T.BadMode="Mode not recognized.";T.DateBounds="Date outside of bounds.";T.OutOfSheet="Resulting reference is out of the sheet.";T.WrongType="Wrong type of argument.";T.NaN="NaN or infinite value encountered.";T.EqualLength="Ranges need to be of equal length.";T.Negative="Value cannot be negative.";T.NotBinary="String does not represent a binary number.";T.NotOctal="String does not represent an octal number.";T.NotHex="String does not represent a hexadecimal number.";T.EndStartPeriod="End period needs to be at least start period.";T.CellRefExpected="Cell reference expected.";T.EmptyRange="Empty range not allowed.";T.BadRef="Address is not correct.";T.NumberRange="Number-only range expected.";T.ValueNotFound="Value not found.";T.ValueBaseLarge="Value in base too large.";T.ValueBaseSmall="Value in base too small.";T.ValueBaseLong="Value in base too long.";T.NegativeLength="Length cannot be negative.";T.PatternNotFound="Pattern not found.";T.OneValue="Needs at least one value.";T.TwoValues="Range needs to contain at least two elements.";T.ThreeValues="Range needs to contain at least three elements.";T.IndexBounds="Index out of bounds.";T.IndexLarge="Index too large.";T.Formula="Expected formula.";T.NegativeCount="Count cannot be negative.";T.ParseError="Parsing error.";T.SheetRef="Sheet does not exist.";T.PeriodLong="Period number cannot exceed life length.";T.InvalidDate="Invalid date.";T.BitshiftLong="Result of bitshift is too long.";T.EmptyString="Empty-string argument not allowed.";T.LengthBounds="Length out of bounds.";T.NegativeTime="Time cannot be negative.";T.NoDefault="No default option.";T.NoConditionMet="None of the conditions were met.";T.Selector="Selector cannot exceed the number of arguments.";T.StartEndDate="Start date needs to be earlier than end date.";T.IncorrectDateTime="String does not represent correct DateTime.";T.CharacterCodeBounds="Character code out of bounds.";T.NonZero="Argument cannot be 0.";T.LessThanOne="Argument cannot be less than 1.";T.WeekendString="Incorrect weekend bitmask string.";T.InvalidRoman="Invalid roman numeral.";T.WrongOrder="Wrong order of values.";T.ComplexNumberExpected="Complex number expected.";T.ShouldBeIorJ="Should be 'i' or 'j'.";T.SizeMismatch="Array dimensions mismatched.";T.FunctionName=s=>`Function name ${s} not recognized.`;T.NamedExpressionName=s=>`Named expression ${s} not recognized.`;T.LicenseKey=s=>`License key is ${s}.`;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pE{constructor(){this.POSSIBLE_START_CHARACTERS=[...uh,...mf,Xe,"'","_"],this.cellReferenceRegexp=new RegExp(ff,"y")}match(e,t){this.cellReferenceRegexp.lastIndex=t;const r=this.cellReferenceRegexp.exec(e+"@");return r==null||r[1]==null?null:(r[0]=r[1],r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class fE{constructor(){this.POSSIBLE_START_CHARACTERS=[...uh,"_"],this.namedExpressionRegexp=new RegExp(oh,"y"),this.r1c1CellRefRegexp=new RegExp(`^${ah}$`)}match(e,t){this.namedExpressionRegexp.lastIndex=t;const r=this.namedExpressionRegexp.exec(e);return r==null||r[0]==null||this.r1c1CellRefRegexp.test(r[0])?null:r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Qn=z({name:"AdditionOp",pattern:rt.NA}),da=z({name:"PlusOp",pattern:/\+/,categories:Qn}),pa=z({name:"MinusOp",pattern:/-/,categories:Qn}),Li=z({name:"MultiplicationOp",pattern:rt.NA}),Zh=z({name:"TimesOp",pattern:/\*/,categories:Li}),Jh=z({name:"DivOp",pattern:/\//,categories:Li}),fa=z({name:"PowerOp",pattern:/\^/}),el=z({name:"PercentOp",pattern:/%/}),Or=z({name:"BooleanOp",pattern:rt.NA}),ma=z({name:"EqualsOp",pattern:/=/,categories:Or}),tl=z({name:"NotEqualOp",pattern:/<>/,categories:Or}),rl=z({name:"GreaterThanOp",pattern:/>/,categories:Or}),nl=z({name:"LessThanOp",pattern:/</,categories:Or}),sl=z({name:"GreaterThanOrEqualOp",pattern:/>=/,categories:Or}),il=z({name:"LessThanOrEqualOp",pattern:/<=/,categories:Or}),al=z({name:"ConcatenateOp",pattern:/&/}),ga=z({name:"LParen",pattern:/\(/}),Bs=z({name:"RParen",pattern:/\)/}),ol=z({name:"ArrayLParen",pattern:/{/}),ul=z({name:"ArrayRParen",pattern:/}/}),hl=z({name:"StringLiteral",pattern:/"([^"\\]*(\\.[^"\\]*)*)"/}),ll=z({name:"ErrorLiteral",pattern:/#[A-Za-z0-9\/]+[?!]?/}),Zn=z({name:"RangeSeparator",pattern:new RegExp(as)}),eo=z({name:"ColumnRange",pattern:new RegExp(`${vo}${as}${vo}`)}),to=z({name:"RowRange",pattern:new RegExp(`${Io}${as}${Io}`)}),ro=z({name:"ProcedureName",pattern:new RegExp(`([${Ni}][${Va}]*)\\(`)}),$i=new pE,Tr=z({name:"CellReference",pattern:$i.match.bind($i),start_chars_hint:$i.POSSIBLE_START_CHARACTERS,line_breaks:!1}),Xi=new fE,cl=z({name:"NamedExpression",pattern:Xi.match.bind(Xi),start_chars_hint:Xi.POSSIBLE_START_CHARACTERS,line_breaks:!1}),no=s=>{const e=s.translationPackage.getFunctionTranslation("OFFSET"),t=s.errorMapping,r=s.translationPackage.buildFunctionMapping(),n=new RegExp(s.ignoreWhiteSpace==="standard"?df:cf),i=z({name:"WhiteSpace",pattern:n}),a=z({name:"ArrayRowSep",pattern:s.arrayRowSeparator}),o=z({name:"ArrayColSep",pattern:s.arrayColumnSeparator}),u=z({name:"NumberLiteral",pattern:new RegExp(`(([${s.decimalSeparator}]\\d+)|(\\d+([${s.decimalSeparator}]\\d*)?))(e[+-]?\\d+)?`)}),l=z({name:"OffsetProcedureName",pattern:new RegExp(e,"i")});let c,d;s.functionArgSeparator===s.arrayColumnSeparator?(c=o,d=[]):s.functionArgSeparator===s.arrayRowSeparator?(c=a,d=[]):(c=z({name:"ArgSeparator",pattern:s.functionArgSeparator}),d=[c]);const f=[i,da,pa,Zh,Jh,fa,ma,tl,el,sl,il,rl,nl,ga,Bs,ol,ul,l,ro,Zn,...d,eo,to,u,hl,ll,al,Or,Qn,Li,Tr,cl,a,o];return{ArgSeparator:c,NumberLiteral:u,OffsetProcedureName:l,ArrayRowSeparator:a,ArrayColSeparator:o,WhiteSpace:i,allTokens:f,errorMapping:t,functionMapping:r,decimalSeparator:s.decimalSeparator,maxColumns:s.maxColumns,maxRows:s.maxRows}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class cn extends Gg{constructor(e,t){super(e.allTokens,{outputCst:!1,maxLookahead:7}),this.booleanExpressionOrEmpty=this.RULE("booleanExpressionOrEmpty",()=>this.OR([{ALT:()=>this.SUBRULE(this.booleanExpression)},{ALT:kg(Hg())}])),this.procedureExpression=this.RULE("procedureExpression",()=>{var r;const n=this.CONSUME(ro),i=n.image.toUpperCase().slice(0,-1),a=(r=this.lexerConfig.functionMapping[i])!==null&&r!==void 0?r:i,o=[];let u=this.SUBRULE(this.booleanExpressionOrEmpty);this.MANY(()=>{var c;const d=this.CONSUME(this.lexerConfig.ArgSeparator);u.type===g.EMPTY&&(u.leadingWhitespace=(c=d.leadingWhitespace)===null||c===void 0?void 0:c.image),o.push(u),u=this.SUBRULE2(this.booleanExpressionOrEmpty)}),o.push(u),o.length===1&&o[0].type===g.EMPTY&&(o.length=0);const l=this.CONSUME(Bs);return uE(a,o,n.leadingWhitespace,l.leadingWhitespace)}),this.namedExpressionExpression=this.RULE("namedExpressionExpression",()=>{const r=this.CONSUME(cl);return hE(r.image,r.leadingWhitespace)}),this.offsetProcedureExpression=this.RULE("offsetProcedureExpression",()=>{const r=[];return this.CONSUME(this.lexerConfig.OffsetProcedureName),this.CONSUME(ga),this.MANY_SEP({SEP:this.lexerConfig.ArgSeparator,DEF:()=>{r.push(this.SUBRULE(this.booleanExpression))}}),this.CONSUME(Bs),this.handleOffsetHeuristic(r)}),this.columnRangeExpression=this.RULE("columnRangeExpression",()=>{const r=this.CONSUME(eo),[n,i]=r.image.split(":"),a=this.ACTION(()=>Xs(this.sheetMapping,n,this.formulaAddress)),o=this.ACTION(()=>Xs(this.sheetMapping,i,this.formulaAddress));if(a===void 0||o===void 0)return Gt(new p(m.REF));if(a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns)||o.exceedsSheetSizeLimits(this.lexerConfig.maxColumns))return Zr(r.image,new p(m.NAME),r.leadingWhitespace);if(a.sheet===void 0&&o.sheet!==void 0)return this.parsingError(Ee.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:l,sheetRefType:c}=cn.fixSheetIdsForRangeEnds(a,o);return zg(u,l,c,r.leadingWhitespace)}),this.rowRangeExpression=this.RULE("rowRangeExpression",()=>{const r=this.CONSUME(to),[n,i]=r.image.split(":"),a=this.ACTION(()=>Ks(this.sheetMapping,n,this.formulaAddress)),o=this.ACTION(()=>Ks(this.sheetMapping,i,this.formulaAddress));if(a===void 0||o===void 0)return Gt(new p(m.REF));if(a.exceedsSheetSizeLimits(this.lexerConfig.maxRows)||o.exceedsSheetSizeLimits(this.lexerConfig.maxRows))return Zr(r.image,new p(m.NAME),r.leadingWhitespace);if(a.sheet===void 0&&o.sheet!==void 0)return this.parsingError(Ee.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:l,sheetRefType:c}=cn.fixSheetIdsForRangeEnds(a,o);return $g(u,l,c,r.leadingWhitespace)}),this.cellReference=this.RULE("cellReference",()=>{const r=this.CONSUME(Tr),n=this.ACTION(()=>rn(this.sheetMapping,r.image,this.formulaAddress));return n===void 0?Zr(r.image,new p(m.REF),r.leadingWhitespace):n.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?Zr(r.image,new p(m.NAME),r.leadingWhitespace):ru(n,r.leadingWhitespace)}),this.endRangeReference=this.RULE("endRangeReference",r=>{var n;const i=this.CONSUME(Tr),a=this.ACTION(()=>rn(this.sheetMapping,r.image,this.formulaAddress)),o=this.ACTION(()=>rn(this.sheetMapping,i.image,this.formulaAddress));return a===void 0||o===void 0?this.ACTION(()=>Zr(`${r.image}:${i.image}`,new p(m.REF),r.leadingWhitespace)):a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)||o.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?this.ACTION(()=>Zr(`${r.image}:${i.image}`,new p(m.NAME),r.leadingWhitespace)):this.buildCellRange(a,o,(n=r.leadingWhitespace)===null||n===void 0?void 0:n.image)}),this.endOfRangeExpression=this.RULE("endOfRangeExpression",r=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeReference,{ARGS:[r]})},{ALT:()=>{var n;const i=this.SUBRULE(this.offsetProcedureExpression),a=this.ACTION(()=>rn(this.sheetMapping,r.image,this.formulaAddress));return a===void 0?Gt(new p(m.REF)):i.type===g.CELL_REFERENCE?this.buildCellRange(a,i.reference,(n=r.leadingWhitespace)===null||n===void 0?void 0:n.image):this.parsingError(Ee.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.cellRangeExpression=this.RULE("cellRangeExpression",()=>{const r=this.CONSUME(Tr);return this.CONSUME2(Zn),this.SUBRULE(this.endOfRangeExpression,{ARGS:[r]})}),this.endRangeWithOffsetStartReference=this.RULE("endRangeWithOffsetStartReference",r=>{const n=this.CONSUME(Tr),i=this.ACTION(()=>rn(this.sheetMapping,n.image,this.formulaAddress));return i===void 0?this.ACTION(()=>Gt(new p(m.REF))):this.buildCellRange(r.reference,i,r.leadingWhitespace)}),this.endOfRangeWithOffsetStartExpression=this.RULE("endOfRangeWithOffsetStartExpression",r=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeWithOffsetStartReference,{ARGS:[r]})},{ALT:()=>{const n=this.SUBRULE(this.offsetProcedureExpression);return n.type===g.CELL_REFERENCE?this.buildCellRange(r.reference,n.reference,r.leadingWhitespace):this.parsingError(Ee.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.offsetExpression=this.RULE("offsetExpression",()=>{const r=this.SUBRULE(this.offsetProcedureExpression);let n;return this.OPTION(()=>{this.CONSUME(Zn),r.type===g.CELL_RANGE?n=this.parsingError(Ee.RangeOffsetNotAllowed,"Range offset not allowed here"):n=this.SUBRULE(this.endOfRangeWithOffsetStartExpression,{ARGS:[r]})}),n!==void 0?n:r}),this.insideArrayExpression=this.RULE("insideArrayExpression",()=>{const r=[[]];return r[r.length-1].push(this.SUBRULE(this.booleanExpression)),this.MANY(()=>{this.OR([{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayColSeparator),r[r.length-1].push(this.SUBRULE2(this.booleanExpression))}},{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayRowSeparator),r.push([]),r[r.length-1].push(this.SUBRULE3(this.booleanExpression))}}])}),su(r)}),this.parenthesisExpression=this.RULE("parenthesisExpression",()=>{const r=this.CONSUME(ga),n=this.SUBRULE(this.booleanExpression),i=this.CONSUME(Bs);return lE(n,r.leadingWhitespace,i.leadingWhitespace)}),this.arrayExpression=this.RULE("arrayExpression",()=>this.OR([{ALT:()=>{const r=this.CONSUME(ol),n=this.SUBRULE(this.insideArrayExpression),i=this.CONSUME(ul);return su(n.args,r.leadingWhitespace,i.leadingWhitespace)}},{ALT:()=>this.SUBRULE(this.parenthesisExpression)}])),this.numericStringToNumber=r=>{const n=r.replace(this.lexerConfig.decimalSeparator,".");return Number(n)},this.positiveAtomicExpression=this.RULE("positiveAtomicExpression",()=>{var r;return this.OR((r=this.atomicExpCache)!==null&&r!==void 0?r:this.atomicExpCache=[{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.SUBRULE(this.cellRangeExpression)},{ALT:()=>this.SUBRULE(this.columnRangeExpression)},{ALT:()=>this.SUBRULE(this.rowRangeExpression)},{ALT:()=>this.SUBRULE(this.offsetExpression)},{ALT:()=>this.SUBRULE(this.cellReference)},{ALT:()=>this.SUBRULE(this.procedureExpression)},{ALT:()=>this.SUBRULE(this.namedExpressionExpression)},{ALT:()=>{const n=this.CONSUME(this.lexerConfig.NumberLiteral);return Wg(this.numericStringToNumber(n.image),n.leadingWhitespace)}},{ALT:()=>{const n=this.CONSUME(hl);return Yg(n)}},{ALT:()=>{const n=this.CONSUME(ll),i=n.image.toUpperCase(),a=this.lexerConfig.errorMapping[i];return a?Gt(new p(a),n.leadingWhitespace):this.parsingError(Ee.ParserError,"Unknown error literal")}}])}),this.rightUnaryOpAtomicExpression=this.RULE("rightUnaryOpAtomicExpression",()=>{const r=this.SUBRULE(this.positiveAtomicExpression),n=this.OPTION(()=>this.CONSUME(el));return n?oE(r,n.leadingWhitespace):r}),this.atomicExpression=this.RULE("atomicExpression",()=>this.OR([{ALT:()=>{const r=this.CONSUME(Qn),n=this.SUBRULE(this.atomicExpression);return se(r,da)?aE(n,r.leadingWhitespace):se(r,pa)?iE(n,r.leadingWhitespace):(this.customParsingError=tu(Ee.ParserError,"Mismatched token type"),this.customParsingError)}},{ALT:()=>this.SUBRULE2(this.rightUnaryOpAtomicExpression)}])),this.powerExpression=this.RULE("powerExpression",()=>{let r=this.SUBRULE(this.atomicExpression);return this.MANY(()=>{const n=this.CONSUME(fa),i=this.SUBRULE2(this.atomicExpression);se(n,fa)?r=sE(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{let r=this.SUBRULE(this.powerExpression);return this.MANY(()=>{const n=this.CONSUME(Li),i=this.SUBRULE2(this.powerExpression);se(n,Zh)?r=rE(r,i,n.leadingWhitespace):se(n,Jh)?r=nE(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.additionExpression=this.RULE("additionExpression",()=>{let r=this.SUBRULE(this.multiplicationExpression);return this.MANY(()=>{const n=this.CONSUME(Qn),i=this.SUBRULE2(this.multiplicationExpression);se(n,da)?r=eE(r,i,n.leadingWhitespace):se(n,pa)?r=tE(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.concatenateExpression=this.RULE("concatenateExpression",()=>{let r=this.SUBRULE(this.additionExpression);return this.MANY(()=>{const n=this.CONSUME(al),i=this.SUBRULE2(this.additionExpression);r=Xg(r,i,n.leadingWhitespace)}),r}),this.booleanExpression=this.RULE("booleanExpression",()=>{let r=this.SUBRULE(this.concatenateExpression);return this.MANY(()=>{const n=this.CONSUME(Or),i=this.SUBRULE2(this.concatenateExpression);se(n,ma)?r=Kg(r,i,n.leadingWhitespace):se(n,tl)?r=jg(r,i,n.leadingWhitespace):se(n,rl)?r=qg(r,i,n.leadingWhitespace):se(n,nl)?r=Qg(r,i,n.leadingWhitespace):se(n,sl)?r=Zg(r,i,n.leadingWhitespace):se(n,il)?r=Jg(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.formula=this.RULE("formula",()=>(this.CONSUME(ma),this.SUBRULE(this.booleanExpression))),this.lexerConfig=e,this.sheetMapping=t,this.formulaAddress=M(0,0,0),this.performSelfAnalysis()}parseFromTokens(e,t){this.input=e;let r=this.formulaWithContext(t),n=[];return this.customParsingError&&n.push(this.customParsingError),n=n.concat(this.errors.map(i=>({type:Ee.ParserError,message:i.message}))),n.length>0&&(r=ca()),{ast:r,errors:n}}reset(){super.reset(),this.customParsingError=void 0}formulaWithContext(e){return this.formulaAddress=e,this.formula()}buildCellRange(e,t,r){if(e.sheet===void 0&&t.sheet!==void 0)return this.parsingError(Ee.ParserError,"Malformed range expression");const{firstEnd:n,secondEnd:i,sheetRefType:a}=cn.fixSheetIdsForRangeEnds(e,t);return nu(n,i,a,r)}static fixSheetIdsForRangeEnds(e,t){const r=cn.rangeSheetReferenceType(e.sheet,t.sheet),n=e.sheet!==void 0&&t.sheet===void 0?t.withSheet(e.sheet):t;return{firstEnd:e,secondEnd:n,sheetRefType:r}}handleOffsetHeuristic(e){var t;const r=e[0];if(r.type!==g.CELL_REFERENCE)return this.parsingError(Ee.StaticOffsetError,"First argument to OFFSET is not a reference");const n=e[1];let i;if(n.type===g.NUMBER&&Number.isInteger(n.value))i=n.value;else if(n.type===g.PLUS_UNARY_OP&&n.value.type===g.NUMBER&&Number.isInteger(n.value.value))i=n.value.value;else if(n.type===g.MINUS_UNARY_OP&&n.value.type===g.NUMBER&&Number.isInteger(n.value.value))i=-n.value.value;else return this.parsingError(Ee.StaticOffsetError,"Second argument to OFFSET is not a static number");const a=e[2];let o;if(a.type===g.NUMBER&&Number.isInteger(a.value))o=a.value;else if(a.type===g.PLUS_UNARY_OP&&a.value.type===g.NUMBER&&Number.isInteger(a.value.value))o=a.value.value;else if(a.type===g.MINUS_UNARY_OP&&a.value.type===g.NUMBER&&Number.isInteger(a.value.value))o=-a.value.value;else return this.parsingError(Ee.StaticOffsetError,"Third argument to OFFSET is not a static number");const u=e[3];let l;if(u===void 0)l=1;else if(u.type===g.NUMBER){if(l=u.value,l<1)return this.parsingError(Ee.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(l))return this.parsingError(Ee.StaticOffsetError,"Fourth argument to OFFSET is not integer")}else return this.parsingError(Ee.StaticOffsetError,"Fourth argument to OFFSET is not a static number");const c=e[4];let d;if(c===void 0)d=1;else if(c.type===g.NUMBER){if(d=c.value,d<1)return this.parsingError(Ee.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(d))return this.parsingError(Ee.StaticOffsetError,"Fifth argument to OFFSET is not integer")}else return this.parsingError(Ee.StaticOffsetError,"Fifth argument to OFFSET is not a static number");const f=new ie(r.reference.col+o,r.reference.row+i,r.reference.type,(t=r.reference.sheet)!==null&&t!==void 0?t:void 0);let E=f.col,N=f.row;if((r.reference.type===re.CELL_REFERENCE_RELATIVE||r.reference.type===re.CELL_REFERENCE_ABSOLUTE_COL)&&(N=N+this.formulaAddress.row),(r.reference.type===re.CELL_REFERENCE_RELATIVE||r.reference.type===re.CELL_REFERENCE_ABSOLUTE_ROW)&&(E=E+this.formulaAddress.col),E<0||N<0)return Gt(new p(m.REF,T.OutOfSheet));if(d===1&&l===1)return ru(f);{const R=new ie(f.col+d-1,f.row+l-1,f.type,f.sheet),y=r.reference.sheet==null?ht.RELATIVE:ht.BOTH_ABSOLUTE;return nu(f,R,y)}}parsingError(e,t){return this.customParsingError=tu(e,t),ca()}static rangeSheetReferenceType(e,t){return e===void 0?ht.RELATIVE:t===void 0?ht.START_ABSOLUTE:ht.BOTH_ABSOLUTE}}class ai{constructor(e){this.lexerConfig=e,this.lexer=new rt(e.allTokens,{ensureOptimizations:!0})}tokenizeFormula(e){const t=this.lexer.tokenize(e);let r=t.tokens;return r=this.trimTrailingWhitespaces(r),r=this.skipWhitespacesInsideRanges(r),r=this.skipWhitespacesBeforeArgSeparators(r),t.tokens=r,t}skipWhitespacesInsideRanges(e){return ai.filterTokensByNeighbors(e,(t,r,n)=>(se(t,Tr)||se(t,Zn))&&se(r,this.lexerConfig.WhiteSpace)&&(se(n,Tr)||se(n,Zn)))}skipWhitespacesBeforeArgSeparators(e){return ai.filterTokensByNeighbors(e,(t,r,n)=>!se(t,this.lexerConfig.ArgSeparator)&&se(r,this.lexerConfig.WhiteSpace)&&se(n,this.lexerConfig.ArgSeparator))}static filterTokensByNeighbors(e,t){if(e.length<3)return e;let r=0;const n=[e[r++]];for(;r<e.length-1;)t(e[r-1],e[r],e[r+1])||n.push(e[r]),++r;return n.push(e[r]),n}trimTrailingWhitespaces(e){return e.length>0&&se(e[e.length-1],this.lexerConfig.WhiteSpace)&&e.pop(),e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class dl{constructor(e,t,r,n){this.config=e,this.lexerConfig=t,this.sheetMappingFn=r,this.namedExpressions=n}unparse(e,t){return"="+this.unparseAst(e,t)}unparseAst(e,t){var r,n;switch(e.type){case g.EMPTY:return $("",e.leadingWhitespace);case g.NUMBER:return $(pl(e.value,this.config.decimalSeparator),e.leadingWhitespace);case g.STRING:return $('"'+e.value+'"',e.leadingWhitespace);case g.FUNCTION_CALL:{const i=e.args.map(u=>u!==void 0?this.unparseAst(u,t):"").join(this.config.functionArgSeparator),o=(this.config.translationPackage.isFunctionTranslated(e.procedureName)?this.config.translationPackage.getFunctionTranslation(e.procedureName):e.procedureName)+"("+i+$(")",e.internalWhitespace);return $(o,e.leadingWhitespace)}case g.NAMED_EXPRESSION:{const i=(r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.sheet))===null||r===void 0?void 0:r.displayName;return $(i||e.expressionName,e.leadingWhitespace)}case g.CELL_REFERENCE:{let i;return e.reference.sheet!==void 0?i=this.unparseSheetName(e.reference.sheet)+"!":i="",i+=(n=e.reference.unparse(t))!==null&&n!==void 0?n:this.config.translationPackage.getErrorTranslation(m.REF),$(i,e.leadingWhitespace)}case g.COLUMN_RANGE:case g.ROW_RANGE:case g.CELL_RANGE:return $(this.formatRange(e,t),e.leadingWhitespace);case g.PLUS_UNARY_OP:{const i=this.unparseAst(e.value,t);return $("+",e.leadingWhitespace)+i}case g.MINUS_UNARY_OP:{const i=this.unparseAst(e.value,t);return $("-",e.leadingWhitespace)+i}case g.PERCENT_OP:return this.unparseAst(e.value,t)+$("%",e.leadingWhitespace);case g.ERROR:{const i=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:m.ERROR);return $(i,e.leadingWhitespace)}case g.ERROR_WITH_RAW_INPUT:return $(e.rawInput,e.leadingWhitespace);case g.PARENTHESIS:{const a="("+this.unparseAst(e.expression,t)+$(")",e.internalWhitespace);return $(a,e.leadingWhitespace)}case g.ARRAY:{const i="{"+e.args.map(a=>a.map(o=>this.unparseAst(o,t)).join(this.config.arrayColumnSeparator)).join(this.config.arrayRowSeparator)+$("}",e.internalWhitespace);return $(i,e.leadingWhitespace)}default:{const i=this.unparseAst(e.left,t),a=this.unparseAst(e.right,t);return i+$(Qh[e.type],e.leadingWhitespace)+a}}}unparseSheetName(e){const t=lh(e,this.sheetMappingFn);if(t===void 0)throw new pe(e);return t}formatRange(e,t){let r="",n="";e.start.sheet!==void 0&&e.sheetReferenceType!==ht.RELATIVE&&(r=this.unparseSheetName(e.start.sheet)+"!"),e.end.sheet!==void 0&&e.sheetReferenceType===ht.BOTH_ABSOLUTE&&(n=this.unparseSheetName(e.end.sheet)+"!");const i=e.start.unparse(t),a=e.end.unparse(t);return i===void 0||a===void 0?this.config.translationPackage.getErrorTranslation(m.REF):`${r}${i}:${n}${a}`}}function pl(s,e){return s.toString().replace(".",e)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Yn{constructor(e,t,r){this.config=e,this.functionRegistry=t,this.sheetMapping=r,this.statsCacheUsed=0,this.lexerConfig=no(e),this.lexer=new ai(this.lexerConfig),this.formulaParser=new cn(this.lexerConfig,this.sheetMapping),this.cache=new dE(this.functionRegistry)}parse(e,t){this.formulaAddress=t;const r=this.tokenizeFormula(e);if(r.errors.length>0){const d=r.errors.map(f=>({type:Ee.LexingError,message:f.message}));return{ast:ca(),errors:d,hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]}}const n=this.computeHashFromTokens(r.tokens,t);let i=this.cache.get(n);if(i!==void 0)++this.statsCacheUsed;else{const d=this.bindWhitespacesToTokens(r.tokens),f=this.formulaParser.parseFromTokens(d,t);if(f.errors.length>0)return Object.assign(Object.assign({},f),{hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]});i=this.cache.set(n,f.ast)}const{ast:a,hasVolatileFunction:o,hasStructuralChangeFunction:u}=i,l=this.convertReversedRangesToRegularRanges(a),c=Fi(l,this.functionRegistry);return{ast:l,errors:[],hasVolatileFunction:o,hasStructuralChangeFunction:u,dependencies:c}}convertReversedRangesToRegularRanges(e){switch(e.type){case g.EMPTY:case g.NUMBER:case g.STRING:case g.ERROR:case g.ERROR_WITH_RAW_INPUT:case g.CELL_REFERENCE:case g.NAMED_EXPRESSION:return e;case g.CELL_RANGE:{const{start:t,end:r}=e,n=this.orderCellRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case g.COLUMN_RANGE:{const{start:t,end:r}=e,n=this.orderColumnRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case g.ROW_RANGE:{const{start:t,end:r}=e,n=this.orderRowRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case g.PERCENT_OP:case g.PLUS_UNARY_OP:case g.MINUS_UNARY_OP:{const t=this.convertReversedRangesToRegularRanges(e.value);return Object.assign(Object.assign({},e),{value:t})}case g.CONCATENATE_OP:case g.EQUALS_OP:case g.NOT_EQUAL_OP:case g.LESS_THAN_OP:case g.GREATER_THAN_OP:case g.LESS_THAN_OR_EQUAL_OP:case g.GREATER_THAN_OR_EQUAL_OP:case g.MINUS_OP:case g.PLUS_OP:case g.TIMES_OP:case g.DIV_OP:case g.POWER_OP:{const t=this.convertReversedRangesToRegularRanges(e.left),r=this.convertReversedRangesToRegularRanges(e.right);return Object.assign(Object.assign({},e),{left:t,right:r})}case g.PARENTHESIS:{const t=this.convertReversedRangesToRegularRanges(e.expression);return Object.assign(Object.assign({},e),{expression:t})}case g.FUNCTION_CALL:{const t=e.args.map(r=>this.convertReversedRangesToRegularRanges(r));return Object.assign(Object.assign({},e),{args:t})}case g.ARRAY:{const t=e.args.map(r=>r.map(n=>this.convertReversedRangesToRegularRanges(n)));return Object.assign(Object.assign({},e),{args:t})}}}orderCellRangeEnds(e,t){const r=[e,t],[n,i]=r.map(c=>c.toColumnAddress()).sort($e.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(c=>c.toRowAddress()).sort(We.compareByAbsoluteAddress(this.formulaAddress)),[u,l]=r.map(c=>c.sheet).sort(Yn.compareSheetIds.bind(this));return{start:ie.fromColAndRow(n,a,u),end:ie.fromColAndRow(i,o,l)}}orderColumnRangeEnds(e,t){const r=[e,t],[n,i]=r.sort($e.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(u=>u.sheet).sort(Yn.compareSheetIds.bind(this));return{start:new $e(n.type,n.col,a),end:new $e(i.type,i.col,o)}}orderRowRangeEnds(e,t){const r=[e,t],[n,i]=r.sort(We.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(u=>u.sheet).sort(Yn.compareSheetIds.bind(this));return{start:new We(n.type,n.row,a),end:new We(i.type,i.row,o)}}static compareSheetIds(e,t){return e=e??1/0,t=t??1/0,e-t}fetchCachedResultForAst(e){const t=this.computeHashFromAst(e);return this.fetchCachedResult(t)}fetchCachedResult(e){const t=this.cache.get(e);if(t===void 0)throw new Error("There is no AST with such key in the cache");{const{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,relativeDependencies:a}=t;return{ast:r,errors:[],hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}}}computeHashFromTokens(e,t){var r;let n="",i=0;for(;i<e.length;){const a=e[i];if(se(a,Tr)){const o=rn(this.sheetMapping,a.image,t);o===void 0?n=n.concat(a.image):n=n.concat(o.hash(!0))}else if(se(a,ro)){const o=a.image.toUpperCase().slice(0,-1),u=(r=this.lexerConfig.functionMapping[o])!==null&&r!==void 0?r:o;n=n.concat(u,"(")}else if(se(a,eo)){const[o,u]=a.image.split(":"),l=Xs(this.sheetMapping,o,t),c=Xs(this.sheetMapping,u,t);l===void 0||c===void 0?n=n.concat("!REF"):n=n.concat(l.hash(!0),":",c.hash(!0))}else if(se(a,to)){const[o,u]=a.image.split(":"),l=Ks(this.sheetMapping,o,t),c=Ks(this.sheetMapping,u,t);l===void 0||c===void 0?n=n.concat("!REF"):n=n.concat(l.hash(!0),":",c.hash(!0))}else n=n.concat(a.image);i++}return n}rememberNewAst(e){const t=this.computeHashFromAst(e);return this.cache.maybeSetAndThenGet(t,e)}computeHashFromAst(e){return"="+this.computeHashOfAstNode(e)}computeHashOfAstNode(e){switch(e.type){case g.EMPTY:return e.leadingWhitespace||"";case g.NUMBER:return $(pl(e.value,this.config.decimalSeparator),e.leadingWhitespace);case g.STRING:return $('"'+e.value+'"',e.leadingWhitespace);case g.NAMED_EXPRESSION:return $(e.expressionName,e.leadingWhitespace);case g.FUNCTION_CALL:{const t=e.args.map(n=>this.computeHashOfAstNode(n)).join(this.config.functionArgSeparator),r=e.procedureName+"("+t+$(")",e.internalWhitespace);return $(r,e.leadingWhitespace)}case g.CELL_REFERENCE:return $(e.reference.hash(!0),e.leadingWhitespace);case g.COLUMN_RANGE:case g.ROW_RANGE:case g.CELL_RANGE:{const t=e.start.hash(e.sheetReferenceType!==ht.RELATIVE),r=e.end.hash(e.sheetReferenceType===ht.BOTH_ABSOLUTE);return $(t+":"+r,e.leadingWhitespace)}case g.MINUS_UNARY_OP:return $("-"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case g.PLUS_UNARY_OP:return $("+"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case g.PERCENT_OP:return this.computeHashOfAstNode(e.value)+$("%",e.leadingWhitespace);case g.ERROR:{const t=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:m.ERROR);return $(t,e.leadingWhitespace)}case g.ERROR_WITH_RAW_INPUT:return $(e.rawInput,e.leadingWhitespace);case g.ARRAY:{const t=e.args.map(r=>r.map(n=>this.computeHashOfAstNode(n)).join(",")).join(";");return $("{"+t+$("}",e.internalWhitespace),e.leadingWhitespace)}case g.PARENTHESIS:{const r="("+this.computeHashOfAstNode(e.expression)+$(")",e.internalWhitespace);return $(r,e.leadingWhitespace)}default:return this.computeHashOfAstNode(e.left)+$(Qh[e.type],e.leadingWhitespace)+this.computeHashOfAstNode(e.right)}}bindWhitespacesToTokens(e){const t=[],r=e[0];se(r,this.lexerConfig.WhiteSpace)||t.push(r);for(let n=1;n<e.length;++n){const i=e[n];if(se(i,this.lexerConfig.WhiteSpace))continue;const a=e[n-1];se(a,this.lexerConfig.WhiteSpace)&&(i.leadingWhitespace=a),t.push(i)}return t}tokenizeFormula(e){return this.lexer.tokenizeFormula(e)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const nn=(s,e,t,r)=>{switch(s.type){case g.EMPTY:case g.NUMBER:case g.STRING:case g.ERROR:return;case g.NAMED_EXPRESSION:{r&&t.push(new nr(s.expressionName));return}case g.CELL_REFERENCE:{r&&t.push(new fl(s.reference));return}case g.CELL_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new mE(s.start,s.end));return}case g.COLUMN_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new gE(s.start,s.end));return}case g.ROW_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new EE(s.start,s.end));return}case g.PERCENT_OP:case g.PLUS_UNARY_OP:case g.MINUS_UNARY_OP:{nn(s.value,e,t,!0);return}case g.CONCATENATE_OP:case g.EQUALS_OP:case g.NOT_EQUAL_OP:case g.LESS_THAN_OP:case g.GREATER_THAN_OP:case g.LESS_THAN_OR_EQUAL_OP:case g.GREATER_THAN_OR_EQUAL_OP:case g.MINUS_OP:case g.PLUS_OP:case g.TIMES_OP:case g.DIV_OP:case g.POWER_OP:nn(s.left,e,t,!0),nn(s.right,e,t,!0);return;case g.PARENTHESIS:nn(s.expression,e,t,r);return;case g.FUNCTION_CALL:{const n=!e.doesFunctionNeedArgumentToBeComputed(s.procedureName);s.args.forEach(i=>nn(i,e,t,n));return}}},Fi=(s,e)=>{const t=new Array;return nn(s,e,t,!0),t};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class fl{constructor(e){this.dependency=e}absolutize(e){return this.dependency.toSimpleCellAddress(e)}}class mE{constructor(e,t){this.start=e,this.end=t}absolutize(e){return new U(this.start.toSimpleCellAddress(e),this.end.toSimpleCellAddress(e))}}class gE{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleColumnAddress(e),r=this.end.toSimpleColumnAddress(e);return new sr(t.sheet,t.col,r.col)}}class EE{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleRowAddress(e),r=this.end.toSimpleRowAddress(e);return new ir(t.sheet,t.row,r.row)}}class nr{constructor(e){this.name=e}absolutize(e){return this}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Ht=(s,e)=>s.map(t=>t.absolutize(e)),RE=s=>s.filter(e=>e instanceof nr?!0:e instanceof U?!(et(e.start)||et(e.end)):!et(e));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const G=Symbol("Empty value");function O(s){return s instanceof jt?s.val:s}class jt{constructor(e,t){this.val=e,this.format=t}fromNumber(e){return new this.constructor(e)}}function so(s,e){if(typeof s=="number")return e;{const t=s.fromNumber(e);return t.format=s.format,t}}class io extends jt{getDetailedType(){return L.NUMBER_DATE}}class Ea extends jt{getDetailedType(){return L.NUMBER_CURRENCY}}class ao extends jt{getDetailedType(){return L.NUMBER_TIME}}class oo extends jt{getDetailedType(){return L.NUMBER_DATETIME}}class ks extends jt{getDetailedType(){return L.NUMBER_PERCENT}}function j(s){return typeof s=="number"||s instanceof jt}var L;(function(s){s.NUMBER_RAW="NUMBER_RAW",s.NUMBER_DATE="NUMBER_DATE",s.NUMBER_TIME="NUMBER_TIME",s.NUMBER_DATETIME="NUMBER_DATETIME",s.NUMBER_CURRENCY="NUMBER_CURRENCY",s.NUMBER_PERCENT="NUMBER_PERCENT"})(L||(L={}));function TE(s){return s instanceof jt?s.getDetailedType():L.NUMBER_RAW}function NE(s){if(s instanceof jt)return s.format}function oi(s){return s instanceof jt?{type:s.getDetailedType(),format:s.format}:{type:L.NUMBER_RAW}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class w{constructor(e,t,r,n){this._data=e,this.range=t,this.dependencyGraph=r,this._hasOnlyNumbers=n,this.size=e===void 0?new B(t.effectiveWidth(r),t.effectiveHeight(r)):new B(e[0].length,e.length)}get data(){return this.ensureThatComputed(),this._data}static fromRange(e,t,r){return new w(e,t,r,!0)}static onlyNumbers(e){return new w(e,void 0,void 0,!0)}static onlyValues(e){return new w(e,void 0,void 0,void 0)}static onlyRange(e,t){return new w(void 0,e,t,void 0)}static fromScalar(e){return new w([[e]],void 0,void 0,void 0)}isAdHoc(){return this.range===void 0}width(){return this.size.width}height(){return this.size.height}valuesFromTopLeftCorner(){this.ensureThatComputed();const e=[];for(let t=0;t<this._data.length;t++)for(let r=0;r<this._data[0].length;r++)e.push(this._data[t][r]);return e}*effectiveAddressesFromData(e){for(let t=0;t<this.data.length;++t){const r=this.data[t];for(let n=0;n<r.length;++n)yield M(e.sheet,e.col+n,e.row+t)}}*entriesFromTopLeftCorner(e){this.ensureThatComputed();for(let t=0;t<this.size.height;++t)for(let r=0;r<this.size.width;++r)yield[this._data[t][r],M(e.sheet,e.col+r,e.row+t)]}*iterateValuesFromTopLeftCorner(){yield*this.valuesFromTopLeftCorner()}numberOfElements(){return this.size.width*this.size.height}hasOnlyNumbers(){if(this._hasOnlyNumbers===void 0){this._hasOnlyNumbers=!0;for(const e of this.data)for(const t of e)if(typeof t!="number")return this._hasOnlyNumbers=!1,!1}return this._hasOnlyNumbers}rawNumbers(){return this._data}rawData(){var e;return this.ensureThatComputed(),(e=this._data)!==null&&e!==void 0?e:[]}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}ensureThatComputed(){this._data===void 0&&(this._hasOnlyNumbers=!0,this._data=this.range.addressesArrayMap(this.dependencyGraph,e=>{const t=this.dependencyGraph.getCellValue(e);return t instanceof w?(this._hasOnlyNumbers=!1,new p(m.VALUE,T.ScalarExpected)):(j(t)||(this._hasOnlyNumbers=!1),t)}))}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Sr{constructor(){this.changes=new Map}static empty(){return new Sr}addAll(e){for(const t of e.changes.values())this.add(t.address,t);return this}addChange(e,t,r){this.addInterpreterValue(e,t,r)}exportChanges(e){let t=[];return this.changes.forEach(r=>{const n=e.exportChange(r);Array.isArray(n)?t=t.concat(n):t.push(n)}),t}getChanges(){return Array.from(this.changes.values())}isEmpty(){return this.changes.size===0}add(e,t){const r=t.value;if(r instanceof w)for(const n of r.effectiveAddressesFromData(e))this.changes.delete(zn(n));this.changes.set(zn(e),t)}addInterpreterValue(e,t,r){this.add(t,{address:t,value:e,oldValue:r})}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class tt{constructor(e,t,r){if(this.sheet=e,this.rowStart=t,this.rowEnd=r,t<0)throw Error("Starting row cant be less than 0");if(r<t)throw Error("Row span cant end before start")}get numberOfRows(){return this.rowEnd-this.rowStart+1}get start(){return this.rowStart}get end(){return this.rowEnd}static fromNumberOfRows(e,t,r){return new tt(e,t,t+r-1)}static fromRowStartAndEnd(e,t,r){return new tt(e,t,r)}*rows(){for(let e=this.rowStart;e<=this.rowEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.rowStart,e.rowStart),r=Math.min(this.rowEnd,e.rowEnd);return t>r?null:new tt(this.sheet,t,r)}firstRow(){return new tt(this.sheet,this.rowStart,this.rowStart)}}class lt{constructor(e,t,r){if(this.sheet=e,this.columnStart=t,this.columnEnd=r,t<0)throw Error("Starting column cant be less than 0");if(r<t)throw Error("Column span cant end before start")}get numberOfColumns(){return this.columnEnd-this.columnStart+1}get start(){return this.columnStart}get end(){return this.columnEnd}static fromNumberOfColumns(e,t,r){return new lt(e,t,t+r-1)}static fromColumnStartAndEnd(e,t,r){return new lt(e,t,r)}*columns(){for(let e=this.columnStart;e<=this.columnEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.columnStart,e.columnStart),r=Math.min(this.columnEnd,e.columnEnd);return t>r?null:new lt(this.sheet,t,r)}firstColumn(){return new lt(this.sheet,this.columnStart,this.columnStart)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var D;(function(s){s.BUILD_ENGINE_TOTAL="BUILD_ENGINE_TOTAL",s.PARSER="PARSER",s.GRAPH_BUILD="GRAPH_BUILD",s.COLLECT_DEPENDENCIES="COLLECT_DEPENDENCIES",s.PROCESS_DEPENDENCIES="PROCESS_DEPENDENCIES",s.TOP_SORT="TOP_SORT",s.BUILD_COLUMN_INDEX="BUILD_COLUMN_INDEX",s.EVALUATION="EVALUATION",s.VLOOKUP="VLOOKUP",s.TRANSFORM_ASTS="TRANSFORM_ASTS",s.TRANSFORM_ASTS_POSTPONED="TRANSFORM_ASTS_POSTPONED",s.ADJUSTING_ADDRESS_MAPPING="ADJUSTING_ADDRESS_MAPPING",s.ADJUSTING_ARRAY_MAPPING="ADJUSTING_ARRAY_MAPPING",s.ADJUSTING_RANGES="ADJUSTING_RANGES",s.ADJUSTING_GRAPH="ADJUSTING_GRAPH",s.CRITERION_FUNCTION_FULL_CACHE_USED="CRITERION_FUNCTION_FULL_CACHE_USED",s.CRITERION_FUNCTION_PARTIAL_CACHE_USED="CRITERION_FUNCTION_PARTIAL_CACHE_USED"})(D||(D={}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ml{constructor(){this.stats=new Map([[D.CRITERION_FUNCTION_FULL_CACHE_USED,0],[D.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0]]),this.startTimes=new Map}incrementCriterionFunctionFullCacheUsed(){var e;const t=((e=this.stats.get(D.CRITERION_FUNCTION_FULL_CACHE_USED))!==null&&e!==void 0?e:0)+1;this.stats.set(D.CRITERION_FUNCTION_FULL_CACHE_USED,t)}incrementCriterionFunctionPartialCacheUsed(){var e;const t=((e=this.stats.get(D.CRITERION_FUNCTION_PARTIAL_CACHE_USED))!==null&&e!==void 0?e:0)+1;this.stats.set(D.CRITERION_FUNCTION_PARTIAL_CACHE_USED,t)}reset(){this.stats.clear(),this.startTimes.clear(),this.stats.set(D.CRITERION_FUNCTION_FULL_CACHE_USED,0),this.stats.set(D.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0)}start(e){if(this.startTimes.get(e))throw Error(`Statistics ${e} already started`);this.startTimes.set(e,Date.now())}end(e){var t;const r=Date.now(),n=this.startTimes.get(e);if(n){let i=(t=this.stats.get(e))!==null&&t!==void 0?t:0;i+=r-n,this.stats.set(e,i),this.startTimes.delete(e)}else throw Error(`Statistics ${e} not started`)}measure(e,t){this.start(e);const r=t();return this.end(e),r}snapshot(){return new Map(this.stats)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class SE extends ml{incrementCriterionFunctionFullCacheUsed(){}incrementCriterionFunctionPartialCacheUsed(){}start(e){}end(e){}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pe extends Error{constructor(e){super(`There's no sheet with id = ${e}`)}}class gl extends Error{constructor(e){super(`There's no sheet with name '${e}'`)}}class Jn extends Error{constructor(e){super(`Sheet with name ${e} already exists`)}}class kr extends Error{constructor(){super("Sheet size limit exceeded")}}class Gs extends Error{constructor(){super("This is not a formula")}}class El extends Error{constructor(e){super(`Address (row = ${e.row}, col = ${e.col}) is invalid`)}}class Ie extends Error{constructor(e){super(`Invalid arguments, expected ${e}`)}}class es extends Error{constructor(e,t){super(`Sheets ${e} and ${t} are not equal.`)}}class Rl extends Error{constructor(e){super(`Name of Named Expression '${e}' is already present`)}}class Tl extends Error{constructor(e){super(`Name of Named Expression '${e}' is invalid`)}}class ts extends Error{constructor(e){super(`Named Expression '${e}' does not exist`)}}class Nl extends Error{constructor(){super("There is no operation to undo")}}class Sl extends Error{constructor(){super("There is no operation to redo")}}class yl extends Error{constructor(){super("There is nothing to paste")}}function yE(s,e){switch(typeof e){case"function":case"symbol":return e.toString();case"bigint":return"BigInt("+e.toString()+")";default:return e instanceof RegExp?"RegExp("+e.toString()+")":e}}class Al extends Error{constructor(e){super(`Unable to parse value: ${JSON.stringify(e,yE,4)}`)}}class K extends Error{constructor(e,t){super(`Expected value of type: ${e} for config parameter: ${t}`)}}class AE extends Error{constructor(e){super(`Config parameter ${e} cannot be empty.`)}}class Cl extends Error{constructor(e,t){super(`Config parameter ${e} should be at least ${t}`)}}class vl extends Error{constructor(e,t){super(`Config parameter ${e} should be at most ${t}`)}}class Il extends Error{constructor(e,t){super(`Expected one of ${e} for config parameter: ${t}`)}}class Ol extends Error{constructor(){super("Computations are suspended")}}class sn extends Error{constructor(e){super(`Translation for ${e} is missing in the translation package you're using.`)}}class Ml extends Error{constructor(e){super(`Cannot register translation for function with id: ${e}`)}}class Ra extends Error{constructor(){super("Language not registered.")}}class wl extends Error{constructor(){super("Language already registered.")}}class Sn extends Error{static functionNotDeclaredInPlugin(e,t){return new Sn(`Function with id ${e} not declared in plugin ${t}`)}static functionMethodNotFound(e,t){return new Sn(`Function method ${e} not found in plugin ${t}`)}}class Gr extends Error{static cannotRegisterFunctionWithId(e){return new Gr(`Cannot register function with id ${e}`)}static cannotUnregisterFunctionWithId(e){return new Gr(`Cannot unregister function with id ${e}`)}static cannotUnregisterProtectedPlugin(){return new Gr("Cannot unregister protected plugin")}}class dn extends Error{constructor(){super("Cannot perform this operation, source location has an array inside.")}}class ui extends Error{constructor(){super("Cannot perform this operation, target location has an array inside.")}}class uo extends Error{constructor(){super("Relative addresses not allowed in named expressions.")}}class CE extends Error{constructor(e,t){super(`Alias id ${e} in plugin ${t} already defined as a function or alias.`)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class vE{constructor(e){this.policy=e,this.mapping=new Map}getCell(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new pe(e.sheet);return t.getCell(e)}fetchCell(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new pe(e.sheet);const r=t.getCell(e);if(!r)throw Error("Vertex for address missing in AddressMapping");return r}strategyFor(e){const t=this.mapping.get(e);if(t===void 0)throw new pe(e);return t}addSheet(e,t){if(this.mapping.has(e))throw Error("Sheet already added");this.mapping.set(e,t)}autoAddSheet(e,t){const{height:r,width:n,fill:i}=t,a=this.policy.call(i);this.addSheet(e,new a(n,r))}getCellValue(e){const t=this.getCell(e);return t===void 0?G:t instanceof ye?t.getArrayCellValue(e):t.getCellValue()}getRawValue(e){const t=this.getCell(e);return t instanceof yr?t.getValues().rawValue:t instanceof ye?t.getArrayCellRawValue(e):null}setCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized");r.setCell(e,t)}moveCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized.");if(e.sheet!==t.sheet)throw Error("Cannot move cells between sheets.");if(r.has(t))throw new Error("Cannot move cell. Destination already occupied.");const n=r.getCell(e);if(n===void 0)throw new Error("Cannot move cell. No cell with such address.");this.setCell(t,n),this.removeCell(e)}removeCell(e){const t=this.mapping.get(e.sheet);if(!t)throw Error("Sheet not initialized");t.removeCell(e)}has(e){const t=this.mapping.get(e.sheet);return t===void 0?!1:t.has(e)}getHeight(e){const t=this.mapping.get(e);if(t===void 0)throw new pe(e);return t.getHeight()}getWidth(e){const t=this.mapping.get(e);if(!t)throw new pe(e);return t.getWidth()}addRows(e,t,r){const n=this.mapping.get(e);if(n===void 0)throw new pe(e);n.addRows(t,r)}removeRows(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new pe(e.sheet);t.removeRows(e)}removeSheet(e){this.mapping.delete(e)}addColumns(e,t,r){const n=this.mapping.get(e);if(n===void 0)throw new pe(e);n.addColumns(t,r)}removeColumns(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new pe(e.sheet);t.removeColumns(e)}*verticesFromRowsSpan(e){yield*this.mapping.get(e.sheet).verticesFromRowsSpan(e)}*verticesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).verticesFromColumnsSpan(e)}*entriesFromRowsSpan(e){yield*this.mapping.get(e.sheet).entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).entriesFromColumnsSpan(e)}*entries(){for(const[e,t]of this.mapping.entries())yield*t.getEntries(e)}*sheetEntries(e){const t=this.mapping.get(e);if(t!==void 0)yield*t.getEntries(e);else throw new pe(e)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class IE{constructor(){this.arrayMapping=new Map}getArray(e){const t=this.getArrayByCorner(e.start);if(t?.getRange().sameAs(e))return t}getArrayByCorner(e){return this.arrayMapping.get(zn(e))}setArray(e,t){this.arrayMapping.set(zn(e.start),t)}removeArray(e){typeof e=="string"?this.arrayMapping.delete(e):this.arrayMapping.delete(zn(e.start))}count(){return this.arrayMapping.size}*arraysInRows(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetRows(e.sheet,e.rowStart,e.rowEnd)&&(yield[t,r])}*arraysInCols(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetColumn(e.sheet,e.columnStart,e.columnEnd)&&(yield[t,r])}isFormulaArrayInRow(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetRows(e,t))return!0;return!1}isFormulaArrayInAllRows(e){let t=!0;for(const r of e.rows())this.isFormulaArrayInRow(e.sheet,r)||(t=!1);return t}isFormulaArrayInColumn(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetColumn(e,t))return!0;return!1}isFormulaArrayInAllColumns(e){let t=!0;for(const r of e.columns())this.isFormulaArrayInColumn(e.sheet,r)||(t=!1);return t}isFormulaArrayInRange(e){for(const t of this.arrayMapping.values())if(t.getRange().doesOverlap(e))return!0;return!1}isFormulaArrayAtAddress(e){for(const t of this.arrayMapping.values())if(t.getRange().addressInRange(e))return!0;return!1}moveArrayVerticesAfterRowByRows(e,t,r){this.updateArrayVerticesInSheet(e,(n,i)=>{const a=i.getRange();return t<=a.start.row?[a.shifted(0,r),i]:void 0})}moveArrayVerticesAfterColumnByColumns(e,t,r){this.updateArrayVerticesInSheet(e,(n,i)=>{const a=i.getRange();return t<=a.start.col?[a.shifted(r,0),i]:void 0})}updateArrayVerticesInSheet(e,t){const r=Array();for(const[n,i]of this.arrayMapping.entries()){if(i.sheet!==e)continue;const a=t(n,i);a!==void 0&&(this.removeArray(n),r.push(a))}r.forEach(([n,i])=>{this.setArray(n,i)})}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Dn{constructor(e){this.size=e}width(){return this.size.width}height(){return this.size.height}get(e,t){throw Error("Array not computed yet.")}simpleRangeValue(){throw Error("Array not computed yet.")}}class yn{constructor(e){if(this.size=new B(e.length>0?e[0].length:0,e.length),this.array=e,this.size.width<=0||this.size.height<=0)throw Error("Incorrect array size")}static fromInterpreterValue(e){return e instanceof w?new yn(e.data):new yn([[e]])}simpleRangeValue(){return w.onlyValues(this.array)}addRows(e,t){this.array.splice(e,0,...this.nullArrays(t,this.width())),this.size.height+=t}addColumns(e,t){for(let r=0;r<this.height();r++)this.array[r].splice(e,0,...new Array(t).fill(G));this.size.width+=t}removeRows(e,t){if(this.outOfBound(0,e)||this.outOfBound(0,t))throw Error("Array index out of bound");const r=t-e+1;this.array.splice(e,r),this.size.height-=r}removeColumns(e,t){if(this.outOfBound(e,0)||this.outOfBound(t,0))throw Error("Array index out of bound");const r=t-e+1;for(const n of this.array)n.splice(e,r);this.size.width-=r}nullArrays(e,t){const r=[];for(let n=0;n<e;++n)r.push(new Array(t).fill(G));return r}get(e,t){if(this.outOfBound(e,t))throw Error("Array index out of bound");return this.array[t][e]}set(e,t,r){if(this.outOfBound(e,t))throw Error("Array index out of bound");this.array[t][e]=r}width(){return this.size.width}height(){return this.size.height}raw(){return this.array}resize(e){if(this.height()<e.height&&isFinite(e.height)&&this.addRows(this.height(),e.height-this.height()),this.height()>e.height||(this.width()<e.width&&isFinite(e.width)&&this.addColumns(this.width(),e.width-this.width()),this.width()>e.width))throw Error("Resizing to smaller array")}outOfBound(e,t){return e<0||t<0||t>this.size.height-1||e>this.size.width-1}}class Ki{constructor(e,t){this.error=e,this.size=t}get(e,t){return this.error}width(){return this.size.width}height(){return this.size.height}simpleRangeValue(){return this.error}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ct{constructor(e,t,r){this.formula=e,this.cellAddress=t,this.version=r}get width(){return 1}get height(){return 1}static fromAst(e,t,r,n){return r.isScalar()?new Wt(e,t,n):new ye(e,t,r,n)}getFormula(e){return this.ensureRecentData(e),this.formula}ensureRecentData(e){if(this.version!=e.version()){const[t,r,n]=e.applyTransformations(this.formula,this.cellAddress,this.version);this.formula=t,this.cellAddress=r,this.version=n}}getAddress(e){return this.ensureRecentData(e),this.cellAddress}}class ye extends ct{constructor(e,t,r,n=0){super(e,t,n),r.isRef?this.array=new Ki(new p(m.REF,T.NoSpaceForArrayResult),B.error()):this.array=new Dn(r)}get width(){return this.array.width()}get height(){return this.array.height()}get sheet(){return this.cellAddress.sheet}get leftCorner(){return this.cellAddress}setCellValue(e){if(e instanceof p)return this.setErrorValue(e),e;const t=yn.fromInterpreterValue(e);return t.resize(this.array.size),this.array=t,e}getCellValue(){if(this.array instanceof Dn)throw Error("Array not computed yet.");return this.array.simpleRangeValue()}valueOrUndef(){if(!(this.array instanceof Dn))return this.array.simpleRangeValue()}getArrayCellValue(e){const t=e.col-this.cellAddress.col,r=e.row-this.cellAddress.row;try{return this.array.get(t,r)}catch{return new p(m.REF)}}getArrayCellRawValue(e){const t=this.getArrayCellValue(e);if(!(t instanceof p||t===G))return O(t)}setArrayCellValue(e,t){const r=e.col-this.cellAddress.col,n=e.row-this.cellAddress.row;this.array instanceof yn&&this.array.set(r,n,t)}setNoSpace(){return this.array=new Ki(new p(m.SPILL,T.NoSpaceForArrayResult),B.error()),this.getCellValue()}getRange(){return U.spanFrom(this.cellAddress,this.width,this.height)}getRangeOrUndef(){return U.spanFromOrUndef(this.cellAddress,this.width,this.height)}setAddress(e){this.cellAddress=e}setFormula(e){this.formula=e}spansThroughSheetRows(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.row<=r&&t<this.cellAddress.row+this.height}spansThroughSheetColumn(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.col<=r&&t<this.cellAddress.col+this.width}isComputed(){return!(this.array instanceof Dn)}columnsFromArray(){return lt.fromNumberOfColumns(this.cellAddress.sheet,this.cellAddress.col,this.width)}rowsFromArray(){return tt.fromNumberOfRows(this.cellAddress.sheet,this.cellAddress.row,this.height)}ensureRecentData(e){}isLeftCorner(e){return ns(this.cellAddress,e)}setErrorValue(e){this.array=new Ki(e,this.array.size)}}class Wt extends ct{constructor(e,t,r){super(e,t,r)}valueOrUndef(){return this.cachedCellValue}setCellValue(e){return this.cachedCellValue=e,this.cachedCellValue}getCellValue(){if(this.cachedCellValue!==void 0)return this.cachedCellValue;throw Error("Value of the formula cell is not computed.")}isComputed(){return this.cachedCellValue!==void 0}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class He{constructor(e){this.range=e,this.functionCache=new Map,this.criterionFunctionCache=new Map,this.dependentCacheRanges=new Set,this.bruteForce=!1}get start(){return this.range.start}get end(){return this.range.end}get sheet(){return this.range.start.sheet}getFunctionValue(e){return this.functionCache.get(e)}setFunctionValue(e,t){this.functionCache.set(e,t)}getCriterionFunctionValue(e,t){var r;return(r=this.getCriterionFunctionValues(e).get(t))===null||r===void 0?void 0:r[0]}getCriterionFunctionValues(e){var t;return(t=this.criterionFunctionCache.get(e))!==null&&t!==void 0?t:new Map}setCriterionFunctionValues(e,t){this.criterionFunctionCache.set(e,t)}addDependentCacheRange(e){e!==this&&this.dependentCacheRanges.add(e)}clearCache(){this.functionCache.clear(),this.criterionFunctionCache.clear(),this.dependentCacheRanges.forEach(e=>e.criterionFunctionCache.clear()),this.dependentCacheRanges.clear()}getStart(){return this.start}getEnd(){return this.end}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const OE=(s,e,t,r,n)=>{if(e instanceof He){const o=e.range.intersectionWith(t);return o!==void 0?Array.from(o.addresses(n)):[]}let i,a;if(e instanceof ct)i=e.getFormula(r),a=e.getAddress(r);else return[];return Fi(i,s).filter(o=>o instanceof fl).map(o=>o.dependency.toSimpleCellAddress(a)).filter(o=>t.addressInRange(o))};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var tr;(function(s){s[s.ON_STACK=0]="ON_STACK",s[s.PROCESSED=1]="PROCESSED",s[s.POPPED=2]="POPPED"})(tr||(tr={}));class ME{constructor(e=[],t=[]){this.nodesSparseArray=e,this.edgesSparseArray=t,this.entranceTime=[],this.low=[],this.parent=[],this.inSCC=[],this.nodeStatus=[],this.order=[],this.sccNonSingletons=[],this.timeCounter=0}getTopSortedWithSccSubgraphFrom(e,t,r){const n=e.reverse();return n.forEach(i=>this.runDFS(i)),this.postprocess(n,r,t)}getAdjacentNodeIds(e){return this.edgesSparseArray[e].filter(t=>t!==void 0&&this.nodesSparseArray[t])}runDFS(e){if(this.nodeStatus[e]!==void 0)return;this.nodeStatus[e]=tr.ON_STACK;const t=[e],r=[];for(;t.length>0;){const n=t[t.length-1];switch(this.nodeStatus[n]){case tr.ON_STACK:{this.handleOnStack(n,r,t);break}case tr.PROCESSED:{this.handleProcessed(n,r,t);break}case tr.POPPED:{t.pop();break}}}}handleOnStack(e,t,r){this.entranceTime[e]=this.timeCounter,this.low[e]=this.timeCounter,this.timeCounter++,t.push(e),this.getAdjacentNodeIds(e).forEach(n=>{this.entranceTime[n]===void 0&&(r.push(n),this.parent[n]=e,this.nodeStatus[n]=tr.ON_STACK)}),this.nodeStatus[e]=tr.PROCESSED}handleProcessed(e,t,r){let n=this.entranceTime[e];if(this.getAdjacentNodeIds(e).forEach(i=>{this.inSCC[i]||(n=this.parent[i]===e?Math.min(n,this.low[i]):Math.min(n,this.entranceTime[i]))}),this.low[e]=n,n===this.entranceTime[e]){const i=[];do i.push(t[t.length-1]),t.pop();while(i[i.length-1]!==e);i.forEach(a=>{this.inSCC[a]=!0}),this.order.push(...i),i.length>1&&i.forEach(a=>{this.sccNonSingletons[a]=!0})}r.pop(),this.nodeStatus[e]=tr.POPPED}postprocess(e,t,r){const n=[];e.forEach(o=>{n[o]=!0});const i=[],a=[];return this.order.reverse(),this.order.forEach(o=>{const u=this.getAdjacentNodeIds(o);this.sccNonSingletons[o]||u.includes(o)?(a.push(this.nodesSparseArray[o]),t(this.nodesSparseArray[o]),u.forEach(l=>n[l]=!0)):(i.push(this.nodesSparseArray[o]),n[o]&&r(this.nodesSparseArray[o])&&u.forEach(l=>n[l]=!0))}),{sorted:i,cycled:a}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class wE{constructor(e,t){this.rawValue=e,this.processFn=t,this.processedValue=null}getProcessedValue(){return this.processedValue===null&&(this.processedValue=this.processFn(this.rawValue)),this.processedValue}markAsModified(){this.processedValue=null}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class _E{constructor(e){this.dependencyQuery=e,this.nodesSparseArray=[],this.edgesSparseArray=[],this.nodesIds=new Map,this.dirtyAndVolatileNodeIds=new wE({dirty:[],volatile:[]},t=>this.processDirtyAndVolatileNodeIds(t)),this.infiniteRangeIds=new Set,this.changingWithStructureNodeIds=[],this.nextId=0}getNodes(){return this.nodesSparseArray.filter(e=>e!==void 0)}hasNode(e){return this.nodesIds.has(e)}existsEdge(e,t){const r=this.getNodeId(e),n=this.getNodeId(t);return r===void 0||n===void 0?!1:this.edgesSparseArray[r].includes(n)}adjacentNodes(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);return new Set(this.edgesSparseArray[t].filter(r=>r!==void 0).map(r=>this.nodesSparseArray[r]))}adjacentNodesCount(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);return this.fixEdgesArrayForNode(t).length}addNodeAndReturnId(e){const t=this.nodesIds.get(e);if(t!==void 0)return t;const r=this.nextId;return this.nextId++,this.nodesSparseArray[r]=e,this.edgesSparseArray[r]=[],this.nodesIds.set(e,r),r}addEdge(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0)throw this.missingNodeError(e);if(n===void 0)throw this.missingNodeError(t);this.edgesSparseArray[r].includes(n)||this.edgesSparseArray[r].push(n)}removeNode(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);this.edgesSparseArray[t].length>0&&(this.edgesSparseArray[t].forEach(n=>this.dirtyAndVolatileNodeIds.rawValue.dirty.push(n)),this.dirtyAndVolatileNodeIds.markAsModified());const r=this.removeDependencies(e);return delete this.nodesSparseArray[t],delete this.edgesSparseArray[t],this.infiniteRangeIds.delete(t),this.nodesIds.delete(e),r}removeEdge(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0)throw this.missingNodeError(e);if(n===void 0)throw this.missingNodeError(t);const i=this.edgesSparseArray[r].indexOf(n);if(i===-1)throw new Error("Edge does not exist");delete this.edgesSparseArray[r][i]}removeEdgeIfExists(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0||n===void 0)return;const i=this.edgesSparseArray[r].indexOf(n);i!==-1&&delete this.edgesSparseArray[r][i]}topSortWithScc(){return this.getTopSortedWithSccSubgraphFrom(this.getNodes(),()=>!0,()=>{})}getTopSortedWithSccSubgraphFrom(e,t,r){const n=new ME(this.nodesSparseArray,this.edgesSparseArray),i=e.map(a=>this.getNodeId(a)).filter(a=>a!==void 0);return n.getTopSortedWithSccSubgraphFrom(i,t,r)}markNodeAsVolatile(e){const t=this.getNodeId(e);t!==void 0&&(this.dirtyAndVolatileNodeIds.rawValue.volatile.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsDirty(e){const t=this.getNodeId(e);t!==void 0&&(this.dirtyAndVolatileNodeIds.rawValue.dirty.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}getDirtyAndVolatileNodes(){return this.dirtyAndVolatileNodeIds.getProcessedValue()}clearDirtyNodes(){this.dirtyAndVolatileNodeIds.rawValue.dirty=[],this.dirtyAndVolatileNodeIds.markAsModified()}markNodeAsChangingWithStructure(e){const t=this.getNodeId(e);t!==void 0&&this.changingWithStructureNodeIds.push(t)}markChangingWithStructureNodesAsDirty(){this.changingWithStructureNodeIds.length<=0||(this.dirtyAndVolatileNodeIds.rawValue.dirty=[...this.dirtyAndVolatileNodeIds.rawValue.dirty,...this.changingWithStructureNodeIds],this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsInfiniteRange(e){const t=this.getNodeIdIfNotNumber(e);t!==void 0&&this.infiniteRangeIds.add(t)}getInfiniteRanges(){return[...this.infiniteRangeIds].map(e=>({node:this.nodesSparseArray[e],id:e}))}getNodeId(e){return this.nodesIds.get(e)}getNodeIdIfNotNumber(e){return typeof e=="number"?e:this.nodesIds.get(e)}fixEdgesArrayForNode(e){const t=this.edgesSparseArray[e];return this.edgesSparseArray[e]=t.filter(r=>r!==void 0&&this.nodesSparseArray[r]),this.edgesSparseArray[e]}removeDependencies(e){const t=this.dependencyQuery(e);return t.forEach(([r,n])=>{this.removeEdgeIfExists(n,e)}),t}processDirtyAndVolatileNodeIds({dirty:e,volatile:t}){return[...new Set([...e,...t])].map(r=>this.nodesSparseArray[r]).filter(r=>r!==void 0)}missingNodeError(e){return new Error(`Unknown node ${e}`)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class LE{constructor(){this.rangeMapping=new Map}getMappingSize(e){var t,r;return(r=(t=this.rangeMapping.get(e))===null||t===void 0?void 0:t.size)!==null&&r!==void 0?r:0}setRange(e){let t=this.rangeMapping.get(e.getStart().sheet);t===void 0&&(t=new Map,this.rangeMapping.set(e.getStart().sheet,t));const r=Hs(e.getStart(),e.getEnd());t.set(r,e)}removeRange(e){const t=e.getStart().sheet,r=this.rangeMapping.get(t);if(r===void 0)return;const n=Hs(e.getStart(),e.getEnd());r.delete(n),r.size===0&&this.rangeMapping.delete(t)}getRange(e,t){const r=this.rangeMapping.get(e.sheet),n=Hs(e,t);return r?.get(n)}fetchRange(e,t){const r=this.getRange(e,t);if(!r)throw Error("Range does not exist");return r}truncateRanges(e,t){const r=Array(),n=Array(),i=Array(),a=e.sheet;for(const[u,l]of this.entriesFromSheet(e.sheet)){const c=l.range;e.start<=t(l.range.end)&&(c.removeSpan(e),c.shouldBeRemoved()?(this.removeByKey(a,u),r.push(l)):n.push([u,l]),i.push(l))}const o=[];n.sort((u,l)=>UE(u[1],l[1],t));for(const[u,l]of n){const c=FE(l.range);if(c===u)continue;const d=this.getByKey(a,c);this.removeByKey(a,u),d!==void 0&&l!=d?o.push([d,l]):this.setRange(l)}return{verticesToRemove:r,verticesToMerge:o,verticesWithChangedSize:i}}moveAllRangesInSheetAfterRowByRows(e,t,r){return this.updateVerticesFromSheet(e,(n,i)=>t<=i.start.row?(i.range.shiftByRows(r),{changedSize:!1,vertex:i}):t>i.start.row&&t<=i.end.row?(i.range.expandByRows(r),{changedSize:!0,vertex:i}):void 0)}moveAllRangesInSheetAfterColumnByColumns(e,t,r){return this.updateVerticesFromSheet(e,(n,i)=>t<=i.start.col?(i.range.shiftByColumns(r),{changedSize:!1,vertex:i}):t>i.start.col&&t<=i.end.col?(i.range.expandByColumns(r),{changedSize:!0,vertex:i}):void 0)}moveRangesInsideSourceRange(e,t,r,n){this.updateVerticesFromSheet(e.sheet,(i,a)=>{if(e.containsRange(a.range))return a.range.shiftByColumns(t),a.range.shiftByRows(r),a.range.moveToSheet(n),{changedSize:!1,vertex:a}})}removeRangesInSheet(e){if(this.rangeMapping.has(e)){const t=this.rangeMapping.get(e).values();return this.rangeMapping.delete(e),t}return[][Symbol.iterator]()}*rangesInSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.values())}*rangeVerticesContainedInRange(e){for(const t of this.rangesInSheet(e.sheet))e.containsRange(t.range)&&(yield t)}findSmallerRange(e){if(e.height()>1&&Number.isFinite(e.height())){const t=M(e.end.sheet,e.end.col,e.end.row-1),r=this.getRange(e.start,t);if(r!==void 0){const n=U.fromSimpleCellAddresses(M(e.start.sheet,e.start.col,e.end.row),e.end);return{smallerRangeVertex:r,restRange:n}}}return{restRange:e}}*entriesFromSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.entries())}removeByKey(e,t){this.rangeMapping.get(e).delete(t)}getByKey(e,t){var r;return(r=this.rangeMapping.get(e))===null||r===void 0?void 0:r.get(t)}updateVerticesFromSheet(e,t){const r=Array();for(const[n,i]of this.entriesFromSheet(e)){const a=t(n,i);a!==void 0&&(this.removeByKey(e,n),r.push(a))}return r.forEach(n=>{this.setRange(n.vertex)}),{verticesWithChangedSize:r.filter(n=>n.changedSize).map(n=>n.vertex)}}}function Hs(s,e){return`${s.col},${s.row},${e.col},${e.row}`}function FE(s){return Hs(s.start,s.end)}const UE=(s,e,t)=>{const r=t(s.range.start),n=t(s.range.start);if(r===n){const i=t(s.range.end),a=t(e.range.end);return i-a}else return r-n};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class bE{constructor(e,t,r){this.functions=e,this.errors=t,this.ui=r,this._protectedTranslations={VERSION:"VERSION"},this.checkUI(),this.checkErrors(),this.checkFunctionTranslations(this.functions),Object.assign(this.functions,this._protectedTranslations)}extendFunctions(e){this.checkFunctionTranslations(e),Object.assign(this.functions,e)}buildFunctionMapping(){return Object.keys(this.functions).reduce((e,t)=>(e[this.functions[t]]=t,e),{})}buildErrorMapping(){return Object.keys(this.errors).reduce((e,t)=>(e[this.errors[t]]=t,e),{})}isFunctionTranslated(e){return this.functions[e]!==void 0}getFunctionTranslations(e){const t=[];for(const r of e)this.isFunctionTranslated(r)&&t.push(this.functions[r]);return t}getFunctionTranslation(e){const t=this.functions[e];if(t===void 0)throw new sn(`functions.${e}`);return t}getMaybeFunctionTranslation(e){return this.functions[e]}getErrorTranslation(e){if(e===m.LIC)return`#${m.LIC}!`;const t=this.errors[e];if(t===void 0)throw new sn(`errors.${e}`);return t}getUITranslation(e){const t=this.ui[e];if(t===void 0)throw new sn(`ui.${e}`);return t}checkUI(){for(const e of Object.values(rs))if(!(e in this.ui))throw new sn(`ui.${e}`)}checkErrors(){for(const e of Object.values(m))if(!(e in this.errors)&&e!==m.LIC)throw new sn(`errors.${e}`)}checkFunctionTranslations(e){const t=new Set(Object.getOwnPropertyNames(e));for(const r of Object.getOwnPropertyNames(this._protectedTranslations))if(t.has(r))throw new Ml(r)}}function xE(s){return new bE(Object.assign({},s.functions),Object.assign({},s.errors),Object.assign({},s.ui))}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var rs;(function(s){s.NEW_SHEET_PREFIX="NEW_SHEET_PREFIX"})(rs||(rs={}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function an(s){return s.toLowerCase()}class PE{constructor(e,t){this.id=e,this.displayName=t}get canonicalName(){return an(this.displayName)}}class DE{constructor(e){this.languages=e,this.mappingFromCanonicalName=new Map,this.mappingFromId=new Map,this.lastSheetId=-1,this.fetch=t=>{const r=this.mappingFromCanonicalName.get(an(t));if(r===void 0)throw new gl(t);return r.id},this.get=t=>{var r;return(r=this.mappingFromCanonicalName.get(an(t)))===null||r===void 0?void 0:r.id},this.fetchDisplayName=t=>this.fetchSheetById(t).displayName,this.sheetNamePrefix=e.getUITranslation(rs.NEW_SHEET_PREFIX)}addSheet(e=`${this.sheetNamePrefix}${this.lastSheetId+2}`){const t=an(e);if(this.mappingFromCanonicalName.has(t))throw new Jn(e);this.lastSheetId++;const r=new PE(this.lastSheetId,e);return this.store(r),r.id}removeSheet(e){const t=this.fetchSheetById(e);e==this.lastSheetId&&--this.lastSheetId,this.mappingFromCanonicalName.delete(t.canonicalName),this.mappingFromId.delete(t.id)}getDisplayName(e){var t;return(t=this.mappingFromId.get(e))===null||t===void 0?void 0:t.displayName}*displayNames(){for(const e of this.mappingFromCanonicalName.values())yield e.displayName}numberOfSheets(){return this.mappingFromCanonicalName.size}hasSheetWithId(e){return this.mappingFromId.has(e)}hasSheetWithName(e){return this.mappingFromCanonicalName.has(an(e))}renameSheet(e,t){const r=this.fetchSheetById(e),n=r.displayName;if(n===t)return;const i=this.mappingFromCanonicalName.get(an(t));if(i!==void 0&&i.id!==r.id)throw new Jn(t);const a=r.canonicalName;return this.mappingFromCanonicalName.delete(a),r.displayName=t,this.store(r),n}sheetNames(){return Array.from(this.mappingFromId.values()).map(e=>e.displayName)}store(e){this.mappingFromId.set(e.id,e),this.mappingFromCanonicalName.set(e.canonicalName,e)}fetchSheetById(e){const t=this.mappingFromId.get(e);if(t===void 0)throw new pe(e);return t}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ho{constructor(e,t,r,n,i,a,o,u){this.addressMapping=e,this.rangeMapping=t,this.sheetMapping=r,this.arrayMapping=n,this.stats=i,this.lazilyTransformingAstService=a,this.functionRegistry=o,this.namedExpressions=u,this.changes=Sr.empty(),this.dependencyQueryAddresses=l=>{if(l instanceof He)return this.rangeDependencyQuery(l).map(([c,d])=>c);{const c=this.formulaDependencyQuery(l);if(c!==void 0){const[d,f]=c;return f.map(E=>E instanceof nr?this.namedExpressions.namedExpressionOrPlaceholder(E.name,d.sheet).address:ge(E)?E:Na(E.start,E.end))}else return[]}},this.dependencyQueryVertices=l=>{if(l instanceof He)return this.rangeDependencyQuery(l);{const c=this.formulaDependencyQuery(l);if(c!==void 0){const[d,f]=c;return f.map(E=>{if(E instanceof U)return[E.start,this.rangeMapping.fetchRange(E.start,E.end)];if(E instanceof nr){const N=this.namedExpressions.namedExpressionOrPlaceholder(E.name,d.sheet);return[N.address,this.addressMapping.fetchCell(N.address)]}else return[E,this.addressMapping.fetchCell(E)]})}else return[]}},this.rangeDependencyQuery=l=>{const c=[],{smallerRangeVertex:d,restRange:f}=this.rangeMapping.findSmallerRange(l.range);let E;d!==void 0&&this.graph.adjacentNodes(d).has(l)?(E=f,c.push([new U(d.start,d.end),d])):E=l.range;for(const N of E.addresses(this)){const R=this.addressMapping.getCell(N);R!==void 0&&c.push([N,R])}return c},this.formulaDependencyQuery=l=>{let c,d;if(l instanceof ct)d=l.getAddress(this.lazilyTransformingAstService),c=l.getFormula(this.lazilyTransformingAstService);else return;const f=Fi(c,this.functionRegistry);return[d,Ht(f,d)]},this.graph=new _E(this.dependencyQueryVertices)}static buildEmpty(e,t,r,n,i){return new ho(new vE(t.chooseAddressMappingPolicy),new LE,new DE(t.translationPackage),new IE,i,e,r,n)}setFormulaToCell(e,t,r,n,i,a){const o=ct.fromAst(t,e,n,this.lazilyTransformingAstService.version());return this.exchangeOrAddFormulaVertex(o),this.processCellDependencies(r,o),this.graph.markNodeAsDirty(o),i&&this.markAsVolatile(o),a&&this.markAsDependentOnStructureChange(o),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setParsingErrorToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);return this.exchangeOrAddGraphNode(r,t),this.addressMapping.setCell(e,t),this.graph.markNodeAsDirty(t),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setValueToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);if(r instanceof ye&&this.arrayMapping.removeArray(r.getRange()),r instanceof yr)r.getValues().rawValue!==t.rawValue&&(r.setValues(t),this.graph.markNodeAsDirty(r));else{const n=new yr(t.parsedValue,t.rawValue);this.exchangeOrAddGraphNode(r,n),this.addressMapping.setCell(e,n),this.graph.markNodeAsDirty(n)}return this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setCellEmpty(e){const t=this.shrinkPossibleArrayAndGetCell(e);if(t===void 0)return Sr.empty();if(this.graph.adjacentNodes(t).size>0){const r=new Rr;this.exchangeGraphNode(t,r),this.graph.adjacentNodesCount(r)===0?(this.removeVertex(r),this.addressMapping.removeCell(e)):(this.graph.markNodeAsDirty(r),this.addressMapping.setCell(e,r))}else this.removeVertex(t),this.addressMapping.removeCell(e);return this.getAndClearContentChanges()}clearDirtyVertices(){this.graph.clearDirtyNodes()}verticesToRecompute(){return this.graph.getDirtyAndVolatileNodes()}processCellDependencies(e,t){const r=this.graph.getNodeId(t);e.forEach(n=>{if(n instanceof U){const i=n;let a=this.getRange(i.start,i.end);a===void 0&&(a=new He(i),this.rangeMapping.setRange(a)),this.graph.addNodeAndReturnId(a);const o=this.graph.getNodeId(a);i.isFinite()||this.graph.markNodeAsInfiniteRange(o);const{smallerRangeVertex:u,restRange:l}=this.rangeMapping.findSmallerRange(i);if(u!==void 0){if(this.graph.addEdge(u,o),a.bruteForce){a.bruteForce=!1;for(const d of i.addresses(this))this.graph.removeEdge(this.fetchCell(d),o)}}else a.bruteForce=!0;const c=this.arrayMapping.getArray(l);if(c!==void 0)this.graph.addEdge(c,o);else for(const d of l.addresses(this)){const{vertex:f,id:E}=this.fetchCellOrCreateEmpty(d);this.graph.addEdge(E??f,o)}this.graph.addEdge(o,r),i.isFinite()&&this.correctInfiniteRangesDependenciesByRangeVertex(a)}else if(n instanceof nr){const i=t.getAddress(this.lazilyTransformingAstService).sheet,{vertex:a,id:o}=this.fetchNamedExpressionVertex(n.name,i);this.graph.addEdge(o??a,r)}else{const{vertex:i,id:a}=this.fetchCellOrCreateEmpty(n);this.graph.addEdge(a??i,r)}})}fetchNamedExpressionVertex(e,t){const r=this.namedExpressions.namedExpressionOrPlaceholder(e,t);return this.fetchCellOrCreateEmpty(r.address)}exchangeNode(e,t){const r=this.fetchCellOrCreateEmpty(e).vertex,n=this.fetchCellOrCreateEmpty(t).vertex;this.addressMapping.removeCell(e),this.exchangeGraphNode(r,n)}fetchCellOrCreateEmpty(e){const t=this.addressMapping.getCell(e);if(t!==void 0)return{vertex:t,id:void 0};const r=new Rr,n=this.graph.addNodeAndReturnId(r);return this.addressMapping.setCell(e,r),{vertex:r,id:n}}removeRows(e){this.stats.measure(D.ADJUSTING_GRAPH,()=>{for(const[r,n]of this.addressMapping.entriesFromRowsSpan(e)){for(const i of this.graph.adjacentNodes(n))this.graph.markNodeAsDirty(i);if(n instanceof ye)if(n.isLeftCorner(r))this.shrinkArrayToCorner(n),this.arrayMapping.removeArray(n.getRange());else continue;this.removeVertex(n)}}),this.stats.measure(D.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeRows(e)});const t=this.stats.measure(D.ADJUSTING_RANGES,()=>{const r=this.truncateRanges(e,n=>n.row);return this.getArrayVerticesRelatedToRanges(r)});return this.stats.measure(D.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterRemovingRows(e.sheet,e.rowStart,e.numberOfRows)}),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}removeSheet(e){this.clearSheet(e);for(const[t,r]of this.addressMapping.sheetEntries(e)){for(const n of this.graph.adjacentNodes(r))this.graph.markNodeAsDirty(n);this.removeVertex(r),this.addressMapping.removeCell(t)}this.stats.measure(D.ADJUSTING_RANGES,()=>{const t=this.rangeMapping.removeRangesInSheet(e);for(const r of t)this.removeVertex(r);this.stats.measure(D.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeSheet(e)})})}clearSheet(e){const t=new Set;for(const[r,n]of this.addressMapping.sheetEntries(e))n instanceof ye?t.add(n):this.setCellEmpty(r);for(const r of t.values())this.setArrayEmpty(r);this.addStructuralNodesToChangeSet()}removeColumns(e){this.stats.measure(D.ADJUSTING_GRAPH,()=>{for(const[r,n]of this.addressMapping.entriesFromColumnsSpan(e)){for(const i of this.graph.adjacentNodes(n))this.graph.markNodeAsDirty(i);if(n instanceof ye)if(n.isLeftCorner(r))this.shrinkArrayToCorner(n),this.arrayMapping.removeArray(n.getRange());else continue;this.removeVertex(n)}}),this.stats.measure(D.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeColumns(e)});const t=this.stats.measure(D.ADJUSTING_RANGES,()=>{const r=this.truncateRanges(e,n=>n.col);return this.getArrayVerticesRelatedToRanges(r)});return this.stats.measure(D.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterRemovingColumns(e.sheet,e.columnStart,e.numberOfColumns)),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}addRows(e){this.stats.measure(D.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addRows(e.sheet,e.rowStart,e.numberOfRows)});const t=this.stats.measure(D.ADJUSTING_RANGES,()=>{const r=this.rangeMapping.moveAllRangesInSheetAfterRowByRows(e.sheet,e.rowStart,e.numberOfRows);return this.fixRangesWhenAddingRows(e.sheet,e.rowStart,e.numberOfRows),this.getArrayVerticesRelatedToRanges(r.verticesWithChangedSize)});this.stats.measure(D.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterAddingRow(e.sheet,e.rowStart,e.numberOfRows)});for(const r of this.addressMapping.verticesFromRowsSpan(e))this.graph.markNodeAsDirty(r);return this.addStructuralNodesToChangeSet(),{affectedArrays:t}}addColumns(e){this.stats.measure(D.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addColumns(e.sheet,e.columnStart,e.numberOfColumns)});const t=this.stats.measure(D.ADJUSTING_RANGES,()=>{const r=this.rangeMapping.moveAllRangesInSheetAfterColumnByColumns(e.sheet,e.columnStart,e.numberOfColumns);return this.fixRangesWhenAddingColumns(e.sheet,e.columnStart,e.numberOfColumns),this.getArrayVerticesRelatedToRanges(r.verticesWithChangedSize)});this.stats.measure(D.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterAddingColumn(e.sheet,e.columnStart,e.numberOfColumns));for(const r of this.addressMapping.verticesFromColumnsSpan(e))this.graph.markNodeAsDirty(r);return this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}isThereSpaceForArray(e){const t=e.getRangeOrUndef();if(t===void 0)return!1;for(const r of t.addresses(this)){const n=this.addressMapping.getCell(r);if(n!==void 0&&!(n instanceof Rr)&&n!==e)return!1}return!0}moveCells(e,t,r,n){for(const i of e.addressesWithDirection(t,r,this)){const a=M(n,i.col+t,i.row+r);let o=this.addressMapping.getCell(i);const u=this.addressMapping.getCell(a);if(this.addressMapping.removeCell(i),o!==void 0){this.graph.markNodeAsDirty(o),this.addressMapping.setCell(a,o);let l;for(const c of this.graph.adjacentNodes(o))c instanceof He&&!e.containsRange(c.range)&&(l=l??this.fetchCellOrCreateEmpty(i).vertex,this.graph.addEdge(l,c),this.graph.removeEdge(o,c));l&&(this.graph.markNodeAsDirty(l),this.addressMapping.setCell(i,l))}if(u!==void 0){o===void 0&&this.addressMapping.removeCell(a);for(const l of this.graph.adjacentNodes(u))o=o??this.fetchCellOrCreateEmpty(a).vertex,this.graph.addEdge(o,l),this.graph.markNodeAsDirty(o);this.removeVertex(u)}}for(const i of this.rangeMapping.rangeVerticesContainedInRange(e))for(const a of this.graph.adjacentNodes(i))if(a instanceof He&&!e.containsRange(a.range)){this.graph.removeEdge(i,a);for(const o of i.range.addresses(this)){const{vertex:u,id:l}=this.fetchCellOrCreateEmpty(o);this.graph.addEdge(l??u,a),this.addressMapping.setCell(o,u),this.graph.markNodeAsDirty(u)}}this.rangeMapping.moveRangesInsideSourceRange(e,t,r,n)}setArrayEmpty(e){const t=U.spanFrom(e.getAddress(this.lazilyTransformingAstService),e.width,e.height),r=this.graph.adjacentNodes(e);for(const n of t.addresses(this))this.addressMapping.removeCell(n);for(const n of r.values()){const i=OE(this.functionRegistry,n,e.getRange(),this.lazilyTransformingAstService,this);for(const a of i){const{vertex:o,id:u}=this.fetchCellOrCreateEmpty(a);this.graph.addEdge(u??o,n)}i.length>0&&this.graph.markNodeAsDirty(n)}this.removeVertex(e),this.arrayMapping.removeArray(e.getRange())}addVertex(e,t){this.graph.addNodeAndReturnId(t),this.addressMapping.setCell(e,t)}addArrayVertex(e,t){this.graph.addNodeAndReturnId(t),this.setAddressMappingForArrayVertex(t,e)}*arrayFormulaNodes(){for(const e of this.graph.getNodes())e instanceof ye&&(yield e)}*entriesFromRowsSpan(e){yield*this.addressMapping.entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.addressMapping.entriesFromColumnsSpan(e)}fetchCell(e){return this.addressMapping.fetchCell(e)}getCell(e){return this.addressMapping.getCell(e)}getCellValue(e){return this.addressMapping.getCellValue(e)}getRawValue(e){return this.addressMapping.getRawValue(e)}getScalarValue(e){const t=this.addressMapping.getCellValue(e);return t instanceof w?new p(m.VALUE,T.ScalarExpected):t}existsEdge(e,t){return this.graph.existsEdge(e,t)}getSheetId(e){return this.sheetMapping.fetch(e)}getSheetHeight(e){return this.addressMapping.getHeight(e)}getSheetWidth(e){return this.addressMapping.getWidth(e)}getArray(e){return this.arrayMapping.getArray(e)}getRange(e,t){return this.rangeMapping.getRange(e,t)}topSortWithScc(){return this.graph.topSortWithScc()}markAsVolatile(e){this.graph.markNodeAsVolatile(e)}markAsDependentOnStructureChange(e){this.graph.markNodeAsChangingWithStructure(e)}forceApplyPostponedTransformations(){for(const e of this.graph.getNodes())e instanceof Wt&&e.ensureRecentData(this.lazilyTransformingAstService)}*rawValuesFromRange(e){for(const t of e.addresses(this)){const r=this.getScalarValue(t);r!==G&&(yield[O(r),t])}}computeListOfValuesInRange(e){const t=[];for(const r of e.addresses(this)){const n=this.getScalarValue(r);t.push(n)}return t}shrinkArrayToCorner(e){this.cleanAddressMappingUnderArray(e);for(const t of this.adjacentArrayVertices(e)){let r;t instanceof ct?r=this.formulaDirectDependenciesToArray(t,e):r=this.rangeDirectDependenciesToArray(t,e);let n=!1;for(const[i,a]of r)e.isLeftCorner(i)&&(n=!0),this.graph.addEdge(a,t),this.graph.markNodeAsDirty(a);n||this.graph.removeEdge(e,t)}this.graph.markNodeAsDirty(e)}isArrayInternalCell(e){const t=this.getCell(e);return t instanceof ye&&!t.isLeftCorner(e)}getAndClearContentChanges(){const e=this.changes;return this.changes=Sr.empty(),e}getAdjacentNodesAddresses(e){const t=this.graph.adjacentNodes(e),r=[];return t.forEach(n=>{const i=n;i instanceof He?r.push(Na(i.start,i.end)):r.push(i.getAddress(this.lazilyTransformingAstService))}),r}exchangeGraphNode(e,t){this.graph.addNodeAndReturnId(t);const r=this.graph.adjacentNodes(e);this.removeVertex(e),r.forEach(n=>{this.graph.hasNode(n)&&this.graph.addEdge(t,n)})}setArray(e,t){this.arrayMapping.setArray(e,t)}correctInfiniteRangesDependency(e){const t=this.graph.getInfiniteRanges().filter(({node:a})=>a.range.addressInRange(e));if(t.length<=0)return;const{vertex:r,id:n}=this.fetchCellOrCreateEmpty(e),i=n??this.graph.getNodeId(r);t.forEach(({id:a})=>{this.graph.addEdge(i,a)})}exchangeOrAddGraphNode(e,t){e?this.exchangeGraphNode(e,t):this.graph.addNodeAndReturnId(t)}getArrayVerticesRelatedToRanges(e){const t=new Set;return e.forEach(r=>{this.graph.hasNode(r)&&this.graph.adjacentNodes(r).forEach(n=>{n instanceof ye&&t.add(n)})}),t}correctInfiniteRangesDependenciesByRangeVertex(e){this.graph.getInfiniteRanges().forEach(({id:t,node:r})=>{const n=e.range.intersectionWith(r.range);n!==void 0&&n.addresses(this).forEach(i=>{const{vertex:a,id:o}=this.fetchCellOrCreateEmpty(i);this.graph.addEdge(o??a,t)})})}cleanAddressMappingUnderArray(e){const t=e.getRange();for(const r of t.addresses(this)){const n=e.getArrayCellValue(r);this.getCell(r)===e?e.isLeftCorner(r)?this.changes.addChange(new p(m.REF),r,n):(this.addressMapping.removeCell(r),this.changes.addChange(G,r,n)):this.changes.addChange(G,r,n)}}*formulaDirectDependenciesToArray(e,t){var r;const[,n]=(r=this.formulaDependencyQuery(e))!==null&&r!==void 0?r:[];if(n!==void 0){for(const i of n)if(!(i instanceof nr||i instanceof U)&&t.getRange().addressInRange(i)){const a=this.fetchCellOrCreateEmpty(i).vertex;yield[i,a]}}}*rangeDirectDependenciesToArray(e,t){const{restRange:r}=this.rangeMapping.findSmallerRange(e.range);for(const n of r.addresses(this))if(t.getRange().addressInRange(n)){const i=this.fetchCellOrCreateEmpty(n).vertex;yield[n,i]}}*adjacentArrayVertices(e){const t=this.graph.adjacentNodes(e);for(const r of t)(r instanceof ct||r instanceof He)&&(yield r)}addStructuralNodesToChangeSet(){this.graph.markChangingWithStructureNodesAsDirty()}fixRangesWhenAddingRows(e,t,r){const n=Array.from(this.rangeMapping.rangesInSheet(e));for(const i of n)if(i.range.includesRow(t+r))if(i.bruteForce){const a=i.range.rangeWithSameWidth(t,r);for(const o of a.addresses(this)){const{vertex:u,id:l}=this.fetchCellOrCreateEmpty(o);this.graph.addEdge(l??u,i)}}else{let a=i,o=this.rangeMapping.findSmallerRange(a.range);if(o.smallerRangeVertex!==void 0)continue;for(;o.smallerRangeVertex===void 0;){const u=new He(U.spanFrom(a.range.start,a.range.width(),a.range.height()-1));this.rangeMapping.setRange(u),this.graph.addNodeAndReturnId(u);const l=new U(M(a.range.start.sheet,a.range.start.col,a.range.end.row),a.range.end);this.addAllFromRange(l,a),this.graph.addEdge(u,a),a=u,o=this.rangeMapping.findSmallerRange(a.range)}this.graph.addEdge(o.smallerRangeVertex,a),this.addAllFromRange(o.restRange,a),this.graph.removeEdge(o.smallerRangeVertex,i)}}addAllFromRange(e,t){for(const r of e.addresses(this)){const{vertex:n,id:i}=this.fetchCellOrCreateEmpty(r);this.graph.addEdge(i??n,t)}}fixRangesWhenAddingColumns(e,t,r){for(const n of this.rangeMapping.rangesInSheet(e))if(n.range.includesColumn(t+r)){let i;n.bruteForce?i=n.range.rangeWithSameHeight(t,r):i=U.spanFrom(M(e,t,n.range.end.row),r,1);for(const a of i.addresses(this)){const{vertex:o,id:u}=this.fetchCellOrCreateEmpty(a);this.graph.addEdge(u??o,n)}}}exchangeOrAddFormulaVertex(e){const t=e.getAddress(this.lazilyTransformingAstService),r=U.spanFrom(t,e.width,e.height),n=this.shrinkPossibleArrayAndGetCell(t);if(e instanceof ye&&this.setArray(r,e),this.exchangeOrAddGraphNode(n,e),this.addressMapping.setCell(t,e),e instanceof ye){if(!this.isThereSpaceForArray(e))return;for(const i of r.addresses(this)){if(e.isLeftCorner(i))continue;const a=this.getCell(i);this.exchangeOrAddGraphNode(a,e)}}for(const i of r.addresses(this))this.addressMapping.setCell(i,e)}setAddressMappingForArrayVertex(e,t){if(this.addressMapping.setCell(t,e),!(e instanceof ye))return;const r=U.spanFromOrUndef(t,e.width,e.height);if(r!==void 0&&(this.setArray(r,e),!!this.isThereSpaceForArray(e)))for(const n of r.addresses(this))this.addressMapping.setCell(n,e)}truncateRanges(e,t){const{verticesToRemove:r,verticesToMerge:n,verticesWithChangedSize:i}=this.rangeMapping.truncateRanges(e,t);for(const[a,o]of n)this.mergeRangeVertices(a,o);for(const a of r)this.removeVertexAndCleanupDependencies(a);return i}fixArraysAfterAddingRow(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInRows(tt.fromRowStartAndEnd(e,t-1,t-1))){const i=n.getRange();for(let a=i.start.col;a<=i.end.col;++a)for(let o=t;o<=i.end.row;++o){const u=M(e,a,o),l=M(e,a,o+r),c=n.getArrayCellValue(u);this.addressMapping.moveCell(l,u),this.changes.addChange(G,l,c)}}}fixArraysAfterRemovingRows(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,-r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInRows(tt.fromRowStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(n))for(const i of n.getRange().addresses(this))this.addressMapping.setCell(i,n);else this.setNoSpaceIfArray(n)}fixArraysAfterAddingColumn(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInCols(lt.fromColumnStartAndEnd(e,t-1,t-1))){const i=n.getRange();for(let a=i.start.row;a<=i.end.row;++a)for(let o=t;o<=i.end.col;++o){const u=M(e,o,a),l=M(e,o+r,a),c=n.getArrayCellValue(u);this.addressMapping.moveCell(l,u),this.changes.addChange(G,l,c)}}}fixArraysAfterRemovingColumns(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,-r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInCols(lt.fromColumnStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(n))for(const i of n.getRange().addresses(this))this.addressMapping.setCell(i,n);else this.setNoSpaceIfArray(n)}shrinkPossibleArrayAndGetCell(e){const t=this.getCell(e);return t instanceof ye?(this.setNoSpaceIfArray(t),this.getCell(e)):t}setNoSpaceIfArray(e){e instanceof ye&&(this.shrinkArrayToCorner(e),e.setNoSpace())}removeVertex(e){this.removeVertexAndCleanupDependencies(e),e instanceof He&&this.rangeMapping.removeRange(e)}mergeRangeVertices(e,t){const r=this.graph.adjacentNodes(t);this.removeVertexAndCleanupDependencies(t),this.graph.removeEdgeIfExists(e,t),r.forEach(n=>{this.graph.hasNode(n)&&this.graph.addEdge(e,n)})}removeVertexAndCleanupDependencies(e){const t=new Set(this.graph.removeNode(e));for(;t.size>0;){const r=t.values().next().value;t.delete(r);const[n,i]=r;this.graph.hasNode(i)&&this.graph.adjacentNodesCount(i)===0&&((i instanceof He||i instanceof Rr)&&this.graph.removeNode(i).forEach(a=>t.add(a)),i instanceof He?this.rangeMapping.removeRange(i):i instanceof Rr&&this.addressMapping.removeCell(n))}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Rr{constructor(){}getCellValue(){return G}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class yr{constructor(e,t){this.parsedValue=e,this.rawValue=t}getValues(){return{parsedValue:this.parsedValue,rawValue:this.rawValue}}setValues(e){this.parsedValue=e.parsedValue,this.rawValue=e.rawValue}getCellValue(){return this.parsedValue}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class gn{constructor(e,t){this.errors=e,this.rawInput=t}getCellValue(){const e=this.errors.map(t=>t.message).find(t=>t);return p.parsingError(e)}getFormula(){return this.rawInput}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class VE{constructor(e,t){this.width=e,this.height=t,this.mapping=new Map}getCell(e){var t;return(t=this.mapping.get(e.col))===null||t===void 0?void 0:t.get(e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1);let r=this.mapping.get(e.col);r||(r=new Map,this.mapping.set(e.col,r)),r.set(e.row,t)}has(e){var t;return!!(!((t=this.mapping.get(e.col))===null||t===void 0)&&t.get(e.row))}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){var t;(t=this.mapping.get(e.col))===null||t===void 0||t.delete(e.row)}addRows(e,t){this.mapping.forEach(r=>{const n=new Map;r.forEach((i,a)=>{a>=e&&(n.set(a+t,i),r.delete(a))}),n.forEach((i,a)=>{r.set(a,i)})}),this.height+=t}addColumns(e,t){const r=new Map;this.mapping.forEach((n,i)=>{i>=e&&(r.set(i+t,n),this.mapping.delete(i))}),r.forEach((n,i)=>{this.mapping.set(i,n)}),this.width+=t}removeRows(e){this.mapping.forEach(n=>{const i=new Map;n.forEach((a,o)=>{o>=e.rowStart&&(n.delete(o),o>e.rowEnd&&i.set(o-e.numberOfRows,a))}),i.forEach((a,o)=>{n.set(o,a)})});const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){const t=new Map;this.mapping.forEach((i,a)=>{a>=e.columnStart&&(this.mapping.delete(a),a>e.columnEnd&&t.set(a-e.numberOfColumns,i))}),t.forEach((i,a)=>{this.mapping.set(a,i)});const r=Math.min(this.width-1,e.columnEnd),n=Math.max(0,r-e.columnStart+1);this.width=Math.max(0,this.width-n)}*getEntries(e){for(const[t,r]of this.mapping)for(const[n,i]of r)yield[M(e,t,n),i]}*verticesFromColumn(e){const t=this.mapping.get(e);if(t!==void 0)for(const[r,n]of t)yield n}*verticesFromRow(e){for(const t of this.mapping.values()){const r=t.get(e);r!==void 0&&(yield r)}}*verticesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(r!==void 0)for(const[n,i]of r)yield i}}*verticesFromRowsSpan(e){for(const t of this.mapping.values())for(const r of e.rows()){const n=t.get(r);n!==void 0&&(yield n)}}*entriesFromRowsSpan(e){for(const[t,r]of this.mapping.entries())for(const n of e.rows()){const i=r.get(n);i!==void 0&&(yield[M(e.sheet,t,n),i])}}*entriesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(r!==void 0)for(const[n,i]of r.entries())yield[M(e.sheet,t,n),i]}}*vertices(){for(const[e,t]of this.mapping)for(const[r,n]of t)n!==void 0&&(yield n)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class BE{constructor(e,t){this.width=e,this.height=t,this.mapping=new Array(t);for(let r=0;r<t;r++)this.mapping[r]=new Array(e)}getCell(e){return this.getCellVertex(e.col,e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1),this.mapping[e.row]||(this.mapping[e.row]=new Array(this.width)),this.mapping[e.row][e.col]=t}has(e){const t=this.mapping[e.row];return t?!!t[e.col]:!1}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){this.mapping[e.row]!==void 0&&delete this.mapping[e.row][e.col]}addRows(e,t){const r=[];for(let n=0;n<t;n++)r.push(new Array(this.width));this.mapping.splice(e,0,...r),this.height+=t}addColumns(e,t){for(let r=0;r<this.height;r++)this.mapping[r]!==void 0&&this.mapping[r].splice(e,0,...new Array(t));this.width+=t}removeRows(e){this.mapping.splice(e.rowStart,e.numberOfRows);const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){for(let n=0;n<this.height;n++)this.mapping[n]!==void 0&&this.mapping[n].splice(e.columnStart,e.numberOfColumns);const t=Math.min(this.width-1,e.columnEnd),r=Math.max(0,t-e.columnStart+1);this.width=Math.max(0,this.width-r)}*getEntries(e){for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r){const n=this.getCellVertex(r,t);n&&(yield[M(e,r,t),n])}}*verticesFromColumn(e){for(let t=0;t<this.height;++t){const r=this.getCellVertex(e,t);r&&(yield r)}}*verticesFromRow(e){for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}*verticesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const n=this.getCellVertex(t,r);n&&(yield n)}}*verticesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const n=this.getCellVertex(t,r);n&&(yield n)}}*entriesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const n=this.getCellVertex(t,r);n&&(yield[M(e.sheet,t,r),n])}}*entriesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const n=this.getCellVertex(t,r);n&&(yield[M(e.sheet,t,r),n])}}*vertices(){for(let e=0;e<this.height;++e)for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}getCellVertex(e,t){var r;return(r=this.mapping[t])===null||r===void 0?void 0:r[e]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var m;(function(s){s.DIV_BY_ZERO="DIV_BY_ZERO",s.NAME="NAME",s.VALUE="VALUE",s.NUM="NUM",s.NA="NA",s.CYCLE="CYCLE",s.REF="REF",s.SPILL="SPILL",s.LIC="LIC",s.ERROR="ERROR"})(m||(m={}));var Qe;(function(s){s.FORMULA="FORMULA",s.VALUE="VALUE",s.ARRAY="ARRAY",s.EMPTY="EMPTY",s.ARRAYFORMULA="ARRAYFORMULA"})(Qe||(Qe={}));const kE=(s,e)=>s instanceof ye?s.isLeftCorner(e)?Qe.ARRAYFORMULA:Qe.ARRAY:s instanceof Wt||s instanceof gn?Qe.FORMULA:s instanceof yr?Qe.VALUE:Qe.EMPTY;var hi;(function(s){s.EMPTY="EMPTY",s.NUMBER="NUMBER",s.STRING="STRING",s.BOOLEAN="BOOLEAN",s.ERROR="ERROR"})(hi||(hi={}));var Ta;(function(s){s.NUMBER="NUMBER"})(Ta||(Ta={}));const Lt=Object.assign(Object.assign({},hi),Ta),GE=Object.assign(Object.assign({},hi),L),iu=s=>{switch(s){case Lt.EMPTY:return 0;case Lt.NUMBER:return 1;case Lt.STRING:return 2;case Lt.BOOLEAN:return 3;case Lt.ERROR:return 4}throw new Error("Cell value not computed")},li=s=>{if(s===G)return Lt.EMPTY;if(s instanceof p||s instanceof w)return Lt.ERROR;if(typeof s=="string")return Lt.STRING;if(j(s))return Lt.NUMBER;if(typeof s=="boolean")return Lt.BOOLEAN;throw new Error("Cell value not computed")},HE=s=>j(s)?TE(s):li(s),WE=s=>{if(j(s))return NE(s)};class p{constructor(e,t,r){this.type=e,this.message=t,this.root=r}static parsingError(e){return new p(m.ERROR,`${T.ParseError}${e?" "+e:""}`)}attachRootVertex(e){return this.root===void 0?new p(this.type,this.message,e):this}}const _l=(s,e)=>({sheet:s,row:e}),YE=s=>s.row<0,Ll=(s,e)=>({sheet:s,col:e}),zE=s=>s.col<0,M=(s,e,t)=>({sheet:s,col:e,row:t}),et=s=>s.col<0||s.row<0,$E=(s,e,t,r)=>M(e,s.col+t,s.row+r),zn=s=>`${s.sheet},${s.row},${s.col}`;function ge(s){var e,t,r;return s&&(typeof s=="object"||typeof s=="function")&&typeof((e=s)===null||e===void 0?void 0:e.sheet)=="number"&&typeof((t=s)===null||t===void 0?void 0:t.col)=="number"&&typeof((r=s)===null||r===void 0?void 0:r.row)=="number"}const Ut=(s,e)=>{var t;return(t=s.sheet)!==null&&t!==void 0?t:e.sheet},ns=(s,e)=>s.sheet===e.sheet&&s.col===e.col&&s.row===e.row;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const XE="AbsoluteCellRange: Wrong range size";function ut(s){if(s&&(typeof s=="object"||typeof s=="function")){const e=s;return"start"in e&&ge(e.start)&&"end"in e&&ge(e.end)}else return!1}const Na=(s,e)=>({start:s,end:e});class U{constructor(e,t){if(e.sheet!==t.sheet)throw new es(e.sheet,t.sheet);this.start=M(e.sheet,e.col,e.row),this.end=M(t.sheet,t.col,t.row)}get sheet(){return this.start.sheet}static fromSimpleCellAddresses(e,t){if(e.sheet!==t.sheet)throw new es(e.sheet,t.sheet);const r=t.col-e.col,n=t.row-e.row;return Number.isFinite(n)&&Number.isFinite(r)?new U(e,t):Number.isFinite(n)?new ir(e.sheet,e.row,t.row):new sr(e.sheet,e.col,t.col)}static fromAst(e,t){return e.type===g.CELL_RANGE?U.fromCellRange(e,t):e.type===g.COLUMN_RANGE?sr.fromColumnRange(e,t):ir.fromRowRangeAst(e,t)}static fromAstOrUndef(e,t){try{return U.fromAst(e,t)}catch{return}}static fromCellRange(e,t){return new U(e.start.toSimpleCellAddress(t),e.end.toSimpleCellAddress(t))}static spanFrom(e,t,r){const n=U.spanFromOrUndef(e,t,r);if(n===void 0)throw new Error(XE);return n}static spanFromOrUndef(e,t,r){if(!Number.isFinite(t)&&Number.isFinite(r))return e.col!==0?void 0:new ir(e.sheet,e.row,e.row+r-1);if(!Number.isFinite(r)&&Number.isFinite(t))return e.row!==0?void 0:new sr(e.sheet,e.col,e.col+t-1);if(Number.isFinite(r)&&Number.isFinite(t))return new U(e,M(e.sheet,e.col+t-1,e.row+r-1))}static fromCoordinates(e,t,r,n,i){return new U(M(e,t,r),M(e,n,i))}isFinite(){return Number.isFinite(this.size())}doesOverlap(e){return!(this.start.sheet!=e.start.sheet||this.end.row<e.start.row||this.start.row>e.end.row||this.end.col<e.start.col||this.start.col>e.end.col)}addressInRange(e){return this.sheet!==e.sheet?!1:this.start.row<=e.row&&this.end.row>=e.row&&this.start.col<=e.col&&this.end.col>=e.col}columnInRange(e){return this.sheet!==e.sheet?!1:this.start.col<=e.col&&this.end.col>=e.col}rowInRange(e){return this.sheet!==e.sheet?!1:this.start.row<=e.row&&this.end.row>=e.row}containsRange(e){return this.addressInRange(e.start)&&this.addressInRange(e.end)}intersectionWith(e){if(this.sheet!==e.start.sheet)return;const t=Math.max(this.start.row,e.start.row),r=Math.min(this.end.row,e.end.row),n=Math.max(this.start.col,e.start.col),i=Math.min(this.end.col,e.end.col);if(!(t>r||n>i))return new U(M(this.sheet,n,t),M(this.sheet,i,r))}includesRow(e){return this.start.row<e&&this.end.row>=e}includesColumn(e){return this.start.col<e&&this.end.col>=e}shiftByRows(e){this.start.row+=e,this.end.row+=e}expandByRows(e){this.end.row+=e}shiftByColumns(e){this.start.col+=e,this.end.col+=e}shifted(e,t){return U.spanFrom(M(this.sheet,this.start.col+e,this.start.row+t),this.width(),this.height())}expandByColumns(e){this.end.col+=e}moveToSheet(e){this.start.sheet=e,this.end.sheet=e}removeSpan(e){e instanceof tt?this.removeRows(e.start,e.end):this.removeColumns(e.start,e.end)}shouldBeRemoved(){return this.width()<=0||this.height()<=0}rangeWithSameWidth(e,t){return U.spanFrom(M(this.sheet,this.start.col,e),this.width(),t)}rangeWithSameHeight(e,t){return U.spanFrom(M(this.sheet,e,this.start.row),t,this.height())}toString(){return`${this.start.sheet},${this.start.col},${this.start.row},${this.end.col},${this.end.row}`}width(){return this.end.col-this.start.col+1}height(){return this.end.row-this.start.row+1}size(){return this.height()*this.width()}arrayOfAddressesInRange(){const e=[];for(let t=0;t<this.height();++t){e[t]=[];for(let r=0;r<this.width();++r){const n=M(this.sheet,this.start.col+r,this.start.row+t);e[t].push(n)}}return e}withStart(e){return new U(e,this.end)}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}sameAs(e){return ns(this.start,e.start)&&ns(this.end,e.end)}addressesArrayMap(e,t){const r=[];let n=this.start.row;for(;n<=this.effectiveEndRow(e);){let i=this.start.col;const a=[];for(;i<=this.effectiveEndColumn(e);)a.push(t(M(this.start.sheet,i,n))),i++;r.push(a),n++}return r}addresses(e){const t=[];let r=this.start.row;const n=this.effectiveEndRow(e),i=this.effectiveEndColumn(e);for(;r<=n;){let a=this.start.col;for(;a<=i;)t.push(M(this.start.sheet,a,r)),a++;r++}return t}*addressesWithDirection(e,t,r){if(e>0)if(t>0){let n=this.effectiveEndRow(r);for(;n>=this.start.row;){let i=this.effectiveEndColumn(r);for(;i>=this.start.col;)yield M(this.start.sheet,i,n),i-=1;n-=1}}else{let n=this.start.row;for(;n<=this.effectiveEndRow(r);){let i=this.effectiveEndColumn(r);for(;i>=this.start.col;)yield M(this.start.sheet,i,n),i-=1;n+=1}}else if(t>0){let n=this.effectiveEndRow(r);for(;n>=this.start.row;){let i=this.start.col;for(;i<=this.effectiveEndColumn(r);)yield M(this.start.sheet,i,n),i+=1;n-=1}}else{let n=this.start.row;for(;n<=this.effectiveEndRow(r);){let i=this.start.col;for(;i<=this.effectiveEndColumn(r);)yield M(this.start.sheet,i,n),i+=1;n+=1}}}getAddress(e,t){if(e<0||t<0||t>this.height()-1||e>this.width()-1)throw Error("Index out of bound");return M(this.start.sheet,this.start.col+e,this.start.row+t)}exceedsSheetSizeLimits(e,t){return this.end.col>=e||this.end.row>=t}effectiveEndColumn(e){return this.end.col}effectiveEndRow(e){return this.end.row}effectiveWidth(e){return this.width()}effectiveHeight(e){return this.height()}removeRows(e,t){if(!(e>this.end.row)){if(t<this.start.row){const r=t-e+1;return this.shiftByRows(-r)}e<=this.start.row&&(this.start.row=e),this.end.row-=Math.min(t,this.end.row)-e+1}}removeColumns(e,t){if(!(e>this.end.col)){if(t<this.start.col){const r=t-e+1;return this.shiftByColumns(-r)}e<=this.start.col&&(this.start.col=e),this.end.col-=Math.min(t,this.end.col)-e+1}}}class sr extends U{constructor(e,t,r){super(M(e,t,0),M(e,r,Number.POSITIVE_INFINITY))}static fromColumnRange(e,t){const r=e.start.toSimpleColumnAddress(t),n=e.end.toSimpleColumnAddress(t);if(r.sheet!==n.sheet)throw new es(r.sheet,n.sheet);return new sr(r.sheet,r.col,n.col)}shouldBeRemoved(){return this.width()<=0}shiftByRows(e){}expandByRows(e){}shifted(e,t){return new sr(this.sheet,this.start.col+e,this.end.col+e)}rangeWithSameHeight(e,t){return new sr(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.col>=e}effectiveEndRow(e){return this.effectiveHeight(e)-1}effectiveHeight(e){return e.getSheetHeight(this.sheet)}removeRows(e,t){}}class ir extends U{constructor(e,t,r){super(M(e,0,t),M(e,Number.POSITIVE_INFINITY,r))}static fromRowRangeAst(e,t){const r=e.start.toSimpleRowAddress(t),n=e.end.toSimpleRowAddress(t);if(r.sheet!==n.sheet)throw new es(r.sheet,n.sheet);return new ir(r.sheet,r.row,n.row)}shouldBeRemoved(){return this.height()<=0}shiftByColumns(e){}expandByColumns(e){}shifted(e,t){return new ir(this.sheet,this.start.row+t,this.end.row+t)}rangeWithSameWidth(e,t){return new ir(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.row>=t}effectiveEndColumn(e){return this.effectiveWidth(e)-1}effectiveWidth(e){return e.getSheetWidth(this.sheet)}removeColumns(e,t){}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class zt{constructor(e,t,r){this.formulaAddress=e,this.arraysFlag=t,this.formulaVertex=r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function KE(s){const e=s.caseSensitive?s.accentSensitive?"variant":"case":s.accentSensitive?"accent":"base",t=s.caseFirst,r=s.ignorePunctuation;return new Intl.Collator(s.localeLang,{sensitivity:e,caseFirst:t,ignorePunctuation:r})}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const jE="i",qE=/^\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij]))\s*(([+-])\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij])))?$/;class QE{constructor(e,t,r){this.config=e,this.dateTimeHelper=t,this.numberLiteralsHelper=r,this.lt=(n,i)=>this.compare(n,i)<0,this.leq=(n,i)=>this.compare(n,i)<=0,this.gt=(n,i)=>this.compare(n,i)>0,this.geq=(n,i)=>this.compare(n,i)>=0,this.eq=(n,i)=>this.compare(n,i)===0,this.neq=(n,i)=>this.compare(n,i)!==0,this.pow=(n,i)=>Math.pow(O(n),O(i)),this.addWithEpsilonRaw=(n,i)=>{const a=n+i;return Math.abs(a)<this.actualEps*Math.abs(n)?0:a},this.addWithEpsilon=(n,i)=>{const a=uu(n,i);return this.ExtendedNumberFactory(this.addWithEpsilonRaw(O(n),O(i)),a)},this.unaryMinus=n=>so(n,-O(n)),this.unaryPlus=n=>n,this.unaryPercent=n=>new ks(O(n)/100),this.concat=(n,i)=>n.concat(i),this.nonstrictadd=(n,i)=>n instanceof p?n:i instanceof p?i:typeof n=="number"?typeof i=="number"?this.addWithEpsilonRaw(n,i):n:typeof i=="number"?i:0,this.subtract=(n,i)=>{const a=uu(n,i),o=O(n),u=O(i);let l=o-u;return Math.abs(l)<this.actualEps*Math.abs(o)&&(l=0),this.ExtendedNumberFactory(l,a)},this.divide=(n,i)=>{const a=O(n),o=O(i);if(o===0)return new p(m.DIV_BY_ZERO);{const u=hu(n,i);return this.ExtendedNumberFactory(a/o,u)}},this.multiply=(n,i)=>{const a=hu(n,i);return this.ExtendedNumberFactory(O(n)*O(i),a)},this.manyToExactComplex=n=>{const i=[];for(const a of n){if(a instanceof p)return a;if(j(a)||typeof a=="string"){const o=this.coerceScalarToComplex(a);o instanceof p||i.push(o)}}return i},this.coerceNumbersExactRanges=n=>this.manyToNumbers(n,this.manyToExactNumbers),this.coerceNumbersCoerceRangesDropNulls=n=>this.manyToNumbers(n,this.manyToCoercedNumbersDropNulls),this.manyToExactNumbers=n=>{const i=[];for(const a of n){if(a instanceof p)return a;j(a)&&i.push(O(a))}return i},this.manyToOnlyNumbersDropNulls=n=>{const i=[];for(const a of n){if(a instanceof p)return a;if(j(a))i.push(O(a));else if(a!==G)return new p(m.VALUE,T.NumberExpected)}return i},this.manyToCoercedNumbersDropNulls=n=>{const i=[];for(const a of n){if(a instanceof p)return a;if(a===G)continue;const o=this.coerceScalarToNumberOrError(a);j(o)&&i.push(O(o))}return i},this.collator=KE(e),this.actualEps=e.smartRounding?e.precisionEpsilon:0}eqMatcherFunction(e){const t=this.buildRegex(e);return r=>typeof r=="string"&&t.test(this.normalizeString(r))}neqMatcherFunction(e){const t=this.buildRegex(e);return r=>typeof r!="string"||!t.test(this.normalizeString(r))}searchString(e,t){var r;const i=this.buildRegex(e,!1).exec(t);return(r=i?.index)!==null&&r!==void 0?r:-1}requiresRegex(e){if(!this.config.useRegularExpressions&&!this.config.useWildcards)return!this.config.matchWholeCell;for(let t=0;t<e.length;t++){const r=e.charAt(t);if(ss(r)||this.config.useRegularExpressions&&is(r))return!0}return!1}floatCmp(e,t){const r=O(e),n=O(t),i=1+this.actualEps;return n>=0&&r*i>=n&&r<=n*i||n<=0&&r*i<=n&&r>=n*i?0:r>n?1:-1}coerceScalarToNumberOrError(e){var t;return e instanceof p?e:(t=this.coerceToMaybeNumber(e))!==null&&t!==void 0?t:new p(m.VALUE,T.NumberCoercion)}coerceToMaybeNumber(e){var t;return(t=this.coerceNonDateScalarToMaybeNumber(e))!==null&&t!==void 0?t:typeof e=="string"?this.dateTimeHelper.dateStringToDateNumber(e):void 0}coerceNonDateScalarToMaybeNumber(e){if(e===G)return 0;if(typeof e=="string"){if(e==="")return 0;const t=this.coerceStringToMaybePercentNumber(e);if(t!==void 0)return t;const r=this.coerceStringToMaybeCurrencyNumber(e);return r!==void 0?r:this.numberLiteralsHelper.numericStringToMaybeNumber(e.trim())}else return j(e)?e:typeof e=="boolean"?Number(e):void 0}coerceStringToMaybePercentNumber(e){const t=e.trim();if(t.endsWith("%")){const r=t.slice(0,t.length-1).trim(),n=this.numberLiteralsHelper.numericStringToMaybeNumber(r);if(n!==void 0)return new ks(n/100)}}coerceStringToMaybeCurrencyNumber(e){const t=this.currencyMatcher(e.trim());if(t!==void 0){const[r,n]=t,i=this.numberLiteralsHelper.numericStringToMaybeNumber(n);if(i!==void 0)return new Ea(i,r)}}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length).trim()];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length).trim()]}}coerceComplexExactRanges(e){const t=[];for(const n of e)if(n instanceof w)t.push(n);else if(n!==G){const i=this.coerceScalarToComplex(n);if(i instanceof p)return i;t.push(i)}const r=[];for(const n of t)if(n instanceof w){const i=this.manyToExactComplex(n.valuesFromTopLeftCorner());if(i instanceof p)return i;r.push(...i)}else r.push(n);return r}coerceScalarToComplex(e){return e instanceof p?e:e===G?[0,0]:j(e)?[O(e),0]:typeof e=="string"?this.coerceStringToComplex(e):new p(m.NUM,T.ComplexNumberExpected)}ExtendedNumberFactory(e,t){const{type:r,format:n}=t;switch(r){case L.NUMBER_RAW:return e;case L.NUMBER_CURRENCY:return new Ea(e,n??this.config.currencySymbol[0]);case L.NUMBER_DATE:return new io(e,n);case L.NUMBER_DATETIME:return new oo(e,n);case L.NUMBER_TIME:return new ao(e,n);case L.NUMBER_PERCENT:return new ks(e,n)}}buildRegex(e,t=!0){e=this.normalizeString(e);let r,n=this.config.useWildcards,i=this.config.useRegularExpressions;if(i)try{RegExp(e)}catch{i=!1,n=!1}return i?r=tR(e,this.config.caseSensitive):n?r=JE(e,this.config.caseSensitive):r=eR(e,this.config.caseSensitive),this.config.matchWholeCell&&t?RegExp("^("+r+")$"):RegExp(r)}normalizeString(e){return this.config.caseSensitive||(e=e.toLowerCase()),this.config.accentSensitive||(e=Pl(e,"nfd").replace(/[\u0300-\u036f]/g,"")),e}compare(e,t){if(typeof e=="string"||typeof t=="string"){const r=typeof e=="string"?this.dateTimeHelper.dateStringToDateNumber(e):e,n=typeof t=="string"?this.dateTimeHelper.dateStringToDateNumber(t):t;if(j(r)&&j(n))return this.floatCmp(r,n)}return e===G?e=au(t):t===G&&(t=au(e)),typeof e=="string"&&typeof t=="string"?this.stringCmp(e,t):typeof e=="boolean"&&typeof t=="boolean"?ou(Sa(e),Sa(t)):j(e)&&j(t)?this.floatCmp(e,t):e===G&&t===G?0:ou(iu(li(e)),iu(li(t)))}stringCmp(e,t){return this.collator.compare(e,t)}manyToNumbers(e,t){const r=[];for(const i of e)if(i instanceof w)r.push(i);else{const a=O(this.coerceScalarToNumberOrError(i));if(a instanceof p)return a;r.push(a)}const n=[];for(const i of r)if(i instanceof w){const a=t(i.valuesFromTopLeftCorner());if(a instanceof p)return a;n.push(...a)}else n.push(i);return n}coerceStringToComplex(e){const t=qE.exec(e);if(t===null)return new p(m.NUM,T.ComplexNumberExpected);let r;if(t[6]!==void 0?r=t[1]==="-"?[0,-1]:[0,1]:r=this.parseComplexToken(t[1]+t[3],t[5]),r instanceof p||t[8]===void 0)return r;let n;return t[14]!==void 0?n=t[9]==="-"?[0,-1]:[0,1]:n=this.parseComplexToken(t[9]+t[11],t[13]),n instanceof p?n:t[5]!==""||t[13]===""?new p(m.NUM,T.ComplexNumberExpected):t[8]==="+"?[r[0]+n[0],r[1]+n[1]]:[r[0]-n[0],r[1]-n[1]]}parseComplexToken(e,t){const r=O(this.coerceNonDateScalarToMaybeNumber(e));return r===void 0?new p(m.NUM,T.ComplexNumberExpected):t===""?[r,0]:[0,r]}}function me([s,e],t){if(!isFinite(s)||!isFinite(e))return new p(m.NUM,T.NaN);if(t=t??jE,e===0)return`${s}`;const r=`${e===-1||e===1?"":Math.abs(e)}${t}`;return s===0?`${e<0?"-":""}${r}`:`${s}${e<0?"-":"+"}${r}`}function Fl(s){return s instanceof w?s:w.fromScalar(s)}function Sa(s){return Number(s)}function au(s){return typeof s=="string"?"":j(s)?0:typeof s=="boolean"?!1:G}function Ul(s){if(s instanceof p||typeof s=="boolean")return s;if(s===G)return!1;if(j(s))return O(s)!==0;{const e=s.toUpperCase();return e==="TRUE"?!0:e==="FALSE"||e===""?!1:void 0}}function ya(s){return s instanceof p||typeof s=="string"?s:s===G?"":j(s)?O(s).toString():s?"TRUE":"FALSE"}function Ns(s){return s===G?0:s}function ou(s,e){const t=O(s),r=O(e);return t>r?1:t<r?-1:0}function bl(s){return isNaN(s)||s===1/0||s===-1/0}function xl(s){return s===0?0:s}function ss(s){return["*","?"].includes(s)}const ZE=["{","}","[","]","(",")","<",">","=",".","+","-",",","\\","$","^","!"];function is(s){return ZE.includes(s)}function JE(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);if(n==="~"){if(r==s.length-1){t+="~";continue}const i=s.charAt(r+1);ss(i)||is(i)?(t+="\\"+i,r++):(t+=i,r++)}else ss(n)?t+="."+n:is(n)?t+="\\"+n:e?t+=n:t+=n.toLowerCase()}return t}function eR(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);ss(n)||is(n)?t+="\\"+n:e?t+=n:t+=n.toLowerCase()}return t}function tR(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);ss(n)||is(n)||e?t+=n:t+=n.toLowerCase()}return t}function uu(s,e){const{type:t,format:r}=oi(s),{type:n,format:i}=oi(e);if(t===L.NUMBER_RAW)return{type:n,format:i};if(n===L.NUMBER_RAW)return{type:t,format:r};if((t===L.NUMBER_DATETIME||t===L.NUMBER_DATE)&&(n===L.NUMBER_DATETIME||n===L.NUMBER_DATE))return{type:L.NUMBER_RAW};if(t===L.NUMBER_TIME){if(n===L.NUMBER_DATE)return{type:L.NUMBER_DATETIME,format:`${i} ${r}`};if(n===L.NUMBER_DATETIME)return{type:L.NUMBER_DATETIME,format:i}}if(n===L.NUMBER_TIME){if(t===L.NUMBER_DATE)return{type:L.NUMBER_DATETIME,format:`${r} ${i}`};if(t===L.NUMBER_DATETIME)return{type:L.NUMBER_DATETIME,format:r}}return{type:t,format:r}}function hu(s,e){let{type:t,format:r}=oi(s),{type:n,format:i}=oi(e);return t===L.NUMBER_PERCENT&&(t=L.NUMBER_RAW,r=void 0),n===L.NUMBER_PERCENT&&(n=L.NUMBER_RAW,i=void 0),t===L.NUMBER_RAW?{type:n,format:i}:n===L.NUMBER_RAW?{type:t,format:r}:{type:L.NUMBER_RAW}}function $n(s){return Pl(s.toLowerCase(),"nfd").replace(/[\u0300-\u036f]/g,"")}function Ws(s,e){var t;if(s.isAdHoc())return(t=s.data[0])===null||t===void 0?void 0:t[0];const r=s.range;if(e.formulaAddress.sheet===r.sheet){if(r.width()===1){const n=e.formulaAddress.row-r.start.row;if(n>=0&&n<r.height())return s.data[n][0]}else if(r.height()===1){const n=e.formulaAddress.col-r.start.col;if(n>=0&&n<r.width())return s.data[0][n]}}}function Pl(s,e){return s.normalize(e.toUpperCase())}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var h;(function(s){s.STRING="STRING",s.NUMBER="NUMBER",s.BOOLEAN="BOOLEAN",s.SCALAR="SCALAR",s.NOERROR="NOERROR",s.RANGE="RANGE",s.INTEGER="INTEGER",s.COMPLEX="COMPLEX",s.ANY="ANY"})(h||(h={}));class V{constructor(e){this.coerceScalarToNumberOrError=t=>this.arithmeticHelper.coerceScalarToNumberOrError(t),this.runFunction=(t,r,n,i)=>{const a=this.evaluateArguments(t,r,n),o=a.map(([N,R])=>N),u=a.map(([N,R])=>R),l=this.buildMetadataForEachArgumentValue(o.length,n),c=r.arraysFlag&&!n.vectorizationForbidden;if(!this.isNumberOfArgumentValuesValid(l,o.length))return new p(m.NA,T.WrongArgNumber);const[d,f]=c?this.calculateSizeOfVectorizedResultArray(o,l):[1,1];if(d===1&&f===1){const N=this.vectorizeAndBroadcastArgumentsIfNecessary(c,o,l,0,0);return this.calculateSingleCellOfResultArray(r,N,l,u,i,n.returnNumberType)}const E=[...Array(d).keys()].map(N=>[...Array(f).keys()].map(R=>{const y=this.vectorizeAndBroadcastArgumentsIfNecessary(c,o,l,N,R),S=this.calculateSingleCellOfResultArray(r,y,l,u,i,n.returnNumberType);if(S instanceof w)throw new Error("Function returning array cannot be vectorized.");return S}));return w.onlyValues(E)},this.runFunctionWithReferenceArgument=(t,r,n,i,a,o=()=>new p(m.NA,T.CellRefExpected))=>{if(t.length===0)return this.returnNumberWrapper(i(),n.returnNumberType);if(t.length>1)return new p(m.NA,T.WrongArgNumber);let u=t[0];for(;u.type===g.PARENTHESIS;)u=u.expression;let l;if(u.type===g.CELL_REFERENCE)l=u.reference.toSimpleCellAddress(r.formulaAddress);else if(u.type===g.CELL_RANGE||u.type===g.COLUMN_RANGE||u.type===g.ROW_RANGE)try{l=U.fromAst(u,r.formulaAddress).start}catch{return new p(m.REF,T.CellRefExpected)}return l!==void 0?this.returnNumberWrapper(a(l),n.returnNumberType):this.runFunction(t,r,n,o)},this.interpreter=e,this.dependencyGraph=e.dependencyGraph,this.columnSearch=e.columnSearch,this.config=e.config,this.serialization=e.serialization,this.arraySizePredictor=e.arraySizePredictor,this.dateTimeHelper=e.dateTimeHelper,this.arithmeticHelper=e.arithmeticHelper}evaluateAst(e,t){return this.interpreter.evaluateAst(e,t)}arraySizeForAst(e,t){return this.arraySizePredictor.checkArraySizeForAst(e,t)}listOfScalarValues(e,t){const r=[];for(const n of e){const i=this.evaluateAst(n,t);if(i instanceof w)for(const a of i.valuesFromTopLeftCorner())r.push([a,!0]);else r.push([i,!1])}return r}coerceToType(e,t,r){let n;if(e instanceof w)switch(t.argumentType){case h.RANGE:case h.ANY:n=e;break;default:{const i=Ws(e,r);if(i===void 0)return;e=i}}if(!(e instanceof w))switch(t.argumentType){case h.INTEGER:case h.NUMBER:const i=this.coerceScalarToNumberOrError(e);if(!j(i)){n=i;break}const a=O(i);if(t.maxValue!==void 0&&a>t.maxValue)return new p(m.NUM,T.ValueLarge);if(t.minValue!==void 0&&a<t.minValue)return new p(m.NUM,T.ValueSmall);if(t.lessThan!==void 0&&a>=t.lessThan)return new p(m.NUM,T.ValueLarge);if(t.greaterThan!==void 0&&a<=t.greaterThan)return new p(m.NUM,T.ValueSmall);if(t.argumentType===h.INTEGER&&!Number.isInteger(a))return new p(m.NUM,T.IntegerExpected);n=i;break;case h.STRING:n=ya(e);break;case h.BOOLEAN:n=Ul(e);break;case h.SCALAR:case h.NOERROR:case h.ANY:n=e;break;case h.RANGE:if(e instanceof p)return e;n=Fl(e);break;case h.COMPLEX:return this.arithmeticHelper.coerceScalarToComplex(O(e))}return t.passSubtype||n===void 0?n:O(n)}calculateSingleCellOfResultArray(e,t,r,n,i,a){const o=this.coerceArgumentsToRequiredTypes(e,t,r,n);if(o instanceof p)return o;const u=i(...o);return this.returnNumberWrapper(u,a)}coerceArgumentsToRequiredTypes(e,t,r,n){const i=[];for(let a=0;a<r.length;a++){const o=r[a],u=t[a]!==void 0?t[a]:o?.defaultValue;if(u===void 0){i.push(void 0);continue}const l=this.coerceToType(u,o,e);if(l===void 0&&!n[a])return new p(m.VALUE,T.WrongType);if(l instanceof p&&o.argumentType!==h.SCALAR)return l;i.push(l)}return i}vectorizeAndBroadcastArgumentsIfNecessary(e,t,r,n,i){return t.map((a,o)=>e&&this.isRangePassedAsAScalarArgument(a,r[o])?this.vectorizeAndBroadcastRangeArgument(a,n,i):a)}vectorizeAndBroadcastRangeArgument(e,t,r){var n;const i=e.height()===1?0:t,a=e.width()===1?0:r;return(n=e.data[i])===null||n===void 0?void 0:n[a]}evaluateArguments(e,t,r){return r.expandRanges?this.listOfScalarValues(e,t):e.map(n=>[this.evaluateAst(n,t),!1])}buildMetadataForEachArgumentValue(e,t){const r=t.parameters?[...t.parameters]:[];if(t.repeatLastArgs!==void 0&&Number.isInteger(t.repeatLastArgs)&&t.repeatLastArgs>0)for(;e>r.length;)r.push(...r.slice(r.length-t.repeatLastArgs));return r}isNumberOfArgumentValuesValid(e,t){return t>e.length?!1:t<e.length?e.slice(t).every(i=>i?.optionalArg||i?.defaultValue!==void 0):!0}calculateSizeOfVectorizedResultArray(e,t){const r=e.filter((a,o)=>this.isRangePassedAsAScalarArgument(a,t[o])),n=Math.max(1,...r.map(a=>a.height())),i=Math.max(1,...r.map(a=>a.width()));return[n,i]}isRangePassedAsAScalarArgument(e,t){return e==null||t==null?!1:e instanceof w&&![h.RANGE,h.ANY].includes(t.argumentType)}metadata(e){const t=this.constructor.implementedFunctions[e];if(t!==void 0)return t;throw new Error(`No metadata for function ${e}.`)}returnNumberWrapper(e,t,r){return t!==void 0&&j(e)?this.arithmeticHelper.ExtendedNumberFactory(O(e),{type:t,format:r}):e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class B{constructor(e,t,r=!1){this.width=e,this.height=t,this.isRef=r}static error(){return new B(1,1,!0)}static scalar(){return new B(1,1,!1)}isScalar(){return this.width===1&&this.height===1||this.isRef}}function rR(s,e){return new B(Math.max(s.width,e.width),Math.max(s.height,e.height))}function nR(s){return new B(s.width,s.height)}class sR{constructor(e,t){this.config=e,this.functionRegistry=t}checkArraySize(e,t){return this.checkArraySizeForAst(e,{formulaAddress:t,arraysFlag:this.config.useArrayArithmetic})}checkArraySizeForAst(e,t){switch(e.type){case g.FUNCTION_CALL:return this.checkArraySizeForFunction(e,t);case g.COLUMN_RANGE:case g.ROW_RANGE:case g.CELL_RANGE:{const r=U.fromAstOrUndef(e,t.formulaAddress);return r===void 0?B.error():new B(r.width(),r.height(),!0)}case g.ARRAY:{const r=[],n=[];for(const o of e.args){const u=o.map(d=>this.checkArraySizeForAst(d,t)),l=Math.min(...u.map(d=>d.height)),c=u.reduce((d,f)=>d+f.width,0);r.push(l),n.push(c)}const i=r.reduce((o,u)=>o+u,0),a=Math.min(...n);return new B(a,i)}case g.STRING:case g.NUMBER:return B.scalar();case g.CELL_REFERENCE:return new B(1,1,!0);case g.DIV_OP:case g.CONCATENATE_OP:case g.EQUALS_OP:case g.GREATER_THAN_OP:case g.GREATER_THAN_OR_EQUAL_OP:case g.LESS_THAN_OP:case g.LESS_THAN_OR_EQUAL_OP:case g.MINUS_OP:case g.NOT_EQUAL_OP:case g.PLUS_OP:case g.POWER_OP:case g.TIMES_OP:{const r=this.checkArraySizeForAst(e.left,t),n=this.checkArraySizeForAst(e.right,t);return!t.arraysFlag&&(r.height>1||r.width>1||n.height>1||n.width>1)?B.error():rR(r,n)}case g.MINUS_UNARY_OP:case g.PLUS_UNARY_OP:case g.PERCENT_OP:{const r=this.checkArraySizeForAst(e.value,t);return!t.arraysFlag&&(r.height>1||r.width>1)?B.error():nR(r)}case g.PARENTHESIS:return this.checkArraySizeForAst(e.expression,t);case g.EMPTY:return B.error();default:return B.error()}}checkArraySizeForFunction(e,t){const r=this.functionRegistry.getArraySizeFunction(e.procedureName);if(r!==void 0)return r(e,t);const n=this.functionRegistry.getMetadata(e.procedureName);if(n===void 0||n.expandRanges||!t.arraysFlag||n.vectorizationForbidden||n.parameters===void 0)return new B(1,1);const i=e.args.map(l=>{var c;return this.checkArraySizeForAst(l,new zt(t.formulaAddress,t.arraysFlag||((c=n?.enableArrayArithmeticForArguments)!==null&&c!==void 0?c:!1)))}),a=[...n.parameters];if(n.repeatLastArgs!==void 0&&a.length<i.length&&(i.length-a.length)%n.repeatLastArgs!==0)return B.error();for(;a.length<i.length;){if(n.repeatLastArgs===void 0)return B.error();a.push(...a.slice(a.length-n.repeatLastArgs))}let o=1,u=1;for(let l=0;l<i.length;l++)a[l].argumentType!==h.RANGE&&a[l].argumentType!==h.ANY&&(u=Math.max(u,i[l].height),o=Math.max(o,i[l].width));return new B(o,u)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Dl{constructor(e,t,r){var n;this.value=t,this.address=r,this.type=e.type,this.message=(n=e.message)!==null&&n!==void 0?n:""}toString(){return this.value}valueOf(){return this.value}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function J(s,e,t){if(typeof s>"u")return dt.defaultConfig[t];if(typeof e=="string"){if(typeof s===e)return s;throw new K(e,t)}else{if(e.includes(s))return s;throw new Il(e.map(r=>`'${r}'`).join(" "),t)}}function Jr(s,e,t){if(s<t)throw new Cl(e,t)}function iR(s,e,t){if(s>t)throw new vl(e,t)}function Ss(s,e,t,r){if(e(s))return s;if(typeof s>"u")return dt.defaultConfig[r];throw new K(t,r)}function lu(...s){const e=new Map;s.forEach(r=>{const n=e.get(r.value)||[];n.push(r.name),e.set(r.value,n)});const t=[];for(const r of e.values())r.length>1&&t.push(r);if(t.length>0){t.forEach(n=>n.sort());const r=t.map(n=>`[${n}]`).join("; ");throw new Error(`Config initialization failed. Parameters in conflict: ${r}`)}}function v(s,e,t){if(typeof s!==e)throw new K(e,t)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const lo=new RegExp("^ss(\\.(s+|0+))?$"),aR=new RegExp("^[0-9/.\\-: ]+[ap]?m?$"),oR=new RegExp("\\s+"),Vl=new RegExp("[ /.-]"),Aa=":",cu=1e3,uR=Bl(cR),hR=Bl(dR);function lR(s,e,t){if(e===void 0&&t===void 0)return;let r=s.replace(oR," ").trim().toLowerCase();if(!pR(r))return;let n=r.substring(r.length-2);n==="am"||n==="pm"?r=r.substring(0,r.length-2).trim():(n=r.substring(r.length-1),n==="a"||n==="p"?r=r.substring(0,r.length-1).trim():n=void 0);const i=r.split(Vl);i.length>=2&&i[i.length-2].includes(Aa)&&(i[i.length-2]=i[i.length-2]+"."+i[i.length-1],i.pop());const a=i[i.length-1].split(Aa);if(n!==void 0&&a.push(n),i.length===1)return du(a,t);if(a.length===1)return pu(i,e);const o=pu(i.slice(0,i.length-1),e),u=du(a,t);if(o!==void 0)return u===void 0?void 0:Object.assign(Object.assign({},o),u)}function du(s,e){var t,r,n;if(e===void 0)return;const{itemsCount:i,hourItem:a,minuteItem:o,secondItem:u}=uR(e);let l;if(s[s.length-1]==="am"||s[s.length-1]==="a"?(l=!1,s.pop()):(s[s.length-1]==="pm"||s[s.length-1]==="p")&&(l=!0,s.pop()),s.length!==i)return;const c=Number((t=s[u])!==null&&t!==void 0?t:"0");if(!Number.isFinite(c))return;const d=Math.round(c*cu)/cu,f=Number((r=s[o])!==null&&r!==void 0?r:"0");if(!(Number.isFinite(f)&&Number.isInteger(f)))return;const E=Number((n=s[a])!==null&&n!==void 0?n:"0");return!(Number.isFinite(E)&&Number.isInteger(E))||l!==void 0&&(E<0||E>12)?void 0:{hours:l!==void 0?E%12+(l?12:0):E,minutes:f,seconds:d}}function pu(s,e){var t;if(e===void 0)return;const{itemsCount:r,dayItem:n,monthItem:i,shortYearItem:a,longYearItem:o}=hR(e);if(s.length!==r)return;const u=Number(s[n]);if(!(Number.isFinite(u)&&Number.isInteger(u)))return;const l=Number(s[i]);if(!(Number.isFinite(l)&&Number.isInteger(l))||s[o]&&s[a])return;const c=Number((t=s[o])!==null&&t!==void 0?t:s[a]);if(Number.isFinite(c)&&Number.isInteger(c)&&!(s[o]&&(c<1e3||c>9999))&&!(s[a]&&(c<0||c>99)))return{year:c,month:l,day:u}}function cR(s){const e=s.toLowerCase().trim(),r=(e.endsWith("am/pm")?e.substring(0,e.length-5):e.endsWith("a/p")?e.substring(0,s.length-3):e).trim().split(Aa);return{itemsCount:r.length,hourItem:r.indexOf("hh"),minuteItem:r.indexOf("mm"),secondItem:r.findIndex(n=>lo.test(n))}}function dR(s){const e=s.toLowerCase().trim().split(Vl);return{itemsCount:e.length,dayItem:e.indexOf("dd"),monthItem:e.indexOf("mm"),shortYearItem:e.indexOf("yy"),longYearItem:e.indexOf("yyyy")}}function pR(s){return aR.test(s)}function Bl(s){const e={};return t=>{const r=e[t];if(r!==void 0)return r;const n=s(t);return e[t]=n,n}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Ca=[31,28,31,30,31,30,31,31,30,31,30,31],pn=[0,31,59,90,120,151,181,212,243,273,304,334],ys=60,As=60,va=24;function Xn(s){return s&&(typeof s=="object"||typeof s=="function")?"year"in s&&typeof s.year=="number"&&"month"in s&&typeof s.month=="number"&&"day"in s&&typeof s.day=="number":!1}function kl(s){return s&&(typeof s=="object"||typeof s=="function")?"hours"in s&&typeof s.hours=="number"&&"minutes"in s&&typeof s.minutes=="number"&&"seconds"in s&&typeof s.seconds=="number":!1}const fR={year:9999,month:12,day:31};class mR{constructor(e){this.config=e,this.minDateAbsoluteValue=this.dateToNumberFromZero(e.nullDate),this.maxDateValue=this.dateToNumber(fR),this.leapYear1900=e.leapYear1900,!this.leapYear1900&&0<=this.dateToNumber({year:1900,month:2,day:28})?this.epochYearZero=this.numberToSimpleDate(2).year:this.epochYearZero=this.numberToSimpleDate(1).year,this.parseDateTime=e.parseDateTime}getWithinBounds(e){return e<=this.maxDateValue&&e>=0?e:void 0}dateStringToDateNumber(e){const{dateTime:t,dateFormat:r="",timeFormat:n=""}=this.parseDateTimeFromConfigFormats(e);if(t!==void 0)return kl(t)?Xn(t)?new oo(Rn(t)+this.dateToNumber(t),r+" "+n):new ao(Rn(t),n):Xn(t)?new io(this.dateToNumber(t),r):0}parseDateTimeFromConfigFormats(e){return this.parseDateTimeFromFormats(e,this.config.dateFormats,this.config.timeFormats)}getNullYear(){return this.config.nullYear}getEpochYearZero(){return this.epochYearZero}isValidDate(e){return isNaN(e.year)||isNaN(e.month)||isNaN(e.day)||e.day!==Math.round(e.day)||e.month!==Math.round(e.month)||e.year!==Math.round(e.year)||e.year<1582||e.month<1||e.month>12||e.day<1?!1:this.isLeapYear(e.year)&&e.month===2?e.day<=29:e.day<=Ca[e.month-1]}dateToNumber(e){return this.dateToNumberFromZero(e)-this.minDateAbsoluteValue}relativeNumberToAbsoluteNumber(e){return e+this.minDateAbsoluteValue-(this.leapYear1900?1:0)}numberToSimpleDate(e){const t=Math.floor(e)+this.minDateAbsoluteValue;let r=Math.floor(t/365.2425);this.dateToNumberFromZero({year:r+1,month:1,day:1})<=t?r++:this.dateToNumberFromZero({year:r-1,month:1,day:1})>t&&r--;const n=t-this.dateToNumberFromZero({year:r,month:1,day:1}),i=gR(n-(this.isLeapYear(r)&&n>=59?1:0)),a=n-pn[i]-(this.isLeapYear(r)&&i>1?1:0);return{year:r,month:i+1,day:a+1}}numberToSimpleDateTime(e){const t=En(e%1),r=Math.floor(t.hours/va);t.hours=t.hours%va;const n=this.numberToSimpleDate(Math.floor(e)+r);return Object.assign(Object.assign({},n),t)}leapYearsCount(e){return Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400)+(this.config.leapYear1900&&e>=1900?1:0)}daysInMonth(e,t){return this.isLeapYear(e)&&t===2?29:Ca[t-1]}endOfMonth(e){return{year:e.year,month:e.month,day:this.daysInMonth(e.year,e.month)}}toBasisUS(e,t){return e.day===31&&(e.day=30),e.day===30&&t.day===31&&(t.day=30),e.month===2&&e.day===this.daysInMonth(e.year,e.month)&&(e.day=30,t.month===2&&t.day===this.daysInMonth(t.year,t.month)&&(t.day=30)),[e,t]}yearLengthForBasis(e,t){return e.year!==t.year?e.year+1!==t.year||e.month<t.month||e.month===t.month&&e.day<t.day?(this.leapYearsCount(t.year)-this.leapYearsCount(e.year-1))/(t.year-e.year+1)+365:this.countLeapDays(t)!==this.countLeapDays({year:e.year,month:e.month,day:e.day-1})?366:365:this.isLeapYear(e.year)?366:365}parseSingleFormat(e,t,r){const n=this.parseDateTime(e,t,r);if(!(Xn(n)&&(n.year>=0&&n.year<100&&(n.year<this.getNullYear()?n.year+=2e3:n.year+=1900),!this.isValidDate(n))))return n}parseDateTimeFromFormats(e,t,r){const n=t.length===0?[void 0]:t,i=r.length===0?[void 0]:r;for(const a of n)for(const o of i){const u=this.parseSingleFormat(e,a,o);if(u!==void 0)return{dateTime:u,timeFormat:o,dateFormat:a}}return{}}countLeapDays(e){return e.month>2||e.month===2&&e.day>=29?this.leapYearsCount(e.year):this.leapYearsCount(e.year-1)}dateToNumberFromZero(e){return 365*e.year+pn[e.month-1]+e.day-1+(e.month<=2?this.leapYearsCount(e.year-1):this.leapYearsCount(e.year))}isLeapYear(e){return e%4?!1:e%100?!0:e%400?e===1900&&this.config.leapYear1900:!0}}function gR(s){let e=0;return pn[e+6]<=s&&(e+=6),pn[e+3]<=s&&(e+=3),pn[e+2]<=s?e+=2:pn[e+1]<=s&&(e+=1),e}function fu(s,e){const t=12*s.year+s.month-1+e;return{year:Math.floor(t/12),month:t%12+1,day:s.day}}function ER(s){return{year:s.year,month:s.month,day:Math.min(s.day,Ca[s.month-1])}}function ji(s){return Math.round(s*3600*24)/(3600*24)}function RR(s,e=1){return Math.round(s*e)/e}function En(s){const e=s*va*As*ys,t=RR(e%ys,1e5)%ys,r=(e-t)/ys,n=Math.round(r%As)%As,i=(r-n)/As;return{hours:Math.round(i),minutes:n,seconds:t}}function Rn(s){return((s.seconds/60+s.minutes)/60+s.hours)/24}function mu(s){return{year:s.year,month:s.month,day:Math.min(30,s.day)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class TR{call(){return BE}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const gu=/(\\.|dd|DD|d|D|mm|MM|m|M|YYYY|YY|yyyy|yy|HH|hh|H|h|ss(\.(0+|s+))?|s|AM\/PM|am\/pm|A\/P|a\/p|\[mm]|\[MM]|\[hh]|\[HH])/g,Eu=/(\\.|[#0]+(\.[#0]*)?)/g;var Yt;(function(s){s.FORMAT="FORMAT",s.FREE_TEXT="FREE_TEXT"})(Yt||(Yt={}));function Cs(s,e){return{type:s,value:e}}var ci;(function(s){s.DATE="DATE",s.NUMBER="NUMBER",s.STRING="STRING"})(ci||(ci={}));function NR(s){gu.lastIndex=0;const e=[];let t;do t=gu.exec(s),t!==null&&e.push(t);while(t);return e}function SR(s){Eu.lastIndex=0;const e=Eu.exec(s);return e!==null?[e]:[]}function Gl(s,e){const t=[];let r=0;for(let i=0;i<s.length;++i){const a=s[i];if(a.index!==r){const o=e.substr(r,a.index-r);t.push(Cs(Yt.FREE_TEXT,o))}a[0].startsWith("\\")?t.push(Cs(Yt.FREE_TEXT,a[0])):t.push(Cs(Yt.FORMAT,a[0])),r=a.index+a[0].length}const n=s[s.length-1];if(n.index+n[0].length<e.length){const i=e.substr(n.index+n[0].length,e.length);t.push(Cs(Yt.FREE_TEXT,i))}return t}function Hl(s){const e=NR(s);if(!e.every(t=>Wl(t)))return{type:ci.DATE,tokens:Gl(e,s)}}function yR(s){const e=SR(s);if(!e.every(t=>Wl(t)))return{type:ci.NUMBER,tokens:Gl(e,s)}}function Wl(s){return s[0].startsWith("\\")}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function AR(s,e,t,r){const n=t.stringifyDateTime(r.numberToSimpleDateTime(s),e);if(n!==void 0)return n;const i=t.stringifyDuration(En(s),e);if(i!==void 0)return i;const a=yR(e);return a!==void 0?vR(a.tokens,s):e}function Ze(s,e){let t=`${s}`;for(;t.length<e;)t="0"+t;return t}function CR(s,e){let t=`${s}`;for(;t.length<e;)t=t+"0";return t}function Ru(s,e){return s.split(e).length-1}function vR(s,e){let t="";for(let r=0;r<s.length;++r){const n=s[r];if(n.type===Yt.FREE_TEXT){t+=n.value;continue}const i=n.value.split("."),a=i[0],o=i[1]||"",u=i[1]?".":"",l=Number(e.toFixed(o.length)).toString().split(".");let c=l[0]||"",d=l[1]||"";if(a.length>c.length){const E=Ru(a.substr(0,a.length-c.length),"0");c=Ze(c,E+c.length)}const f=Ru(o.substr(d.length,o.length-d.length),"0");d=CR(d,f+d.length),t+=c+u+d}return t}function IR(s,e){const t=Hl(e);if(t===void 0)return;const r=t.tokens;let n="";for(const i of r){if(i.type===Yt.FREE_TEXT){n+=i.value;continue}switch(i.value.toLowerCase()){case"h":case"hh":{n+=Ze(s.hours,i.value.length),s.hours=0;break}case"[hh]":{n+=Ze(s.hours,i.value.length-2),s.hours=0;break}case"m":case"mm":{n+=Ze(s.minutes,i.value.length),s.minutes=0;break}case"[mm]":{n+=Ze(s.minutes+60*s.hours,i.value.length-2),s.minutes=0,s.hours=0;break}case"s":case"ss":{n+=Ze(Math.floor(s.seconds),i.value.length);break}default:{if(lo.test(i.value)){const a=Math.max(i.value.length-3,0);n+=`${s.seconds<10?"0":""}${Math.floor(s.seconds*Math.pow(10,a))/Math.pow(10,a)}`;continue}return}}}return n}function OR(s,e){const t=Hl(e);if(t===void 0)return;const r=t.tokens;let n="",i=!1;const a=r.some(o=>o.type===Yt.FORMAT&&(o.value==="a/p"||o.value==="A/P"||o.value==="am/pm"||o.value==="AM/PM"));for(let o=0;o<r.length;o++){const u=r[o];if(u.type===Yt.FREE_TEXT){n+=u.value;continue}switch(u.value.toLowerCase()){case"h":case"hh":{i=!0,n+=Ze(a?(s.hours+11)%12+1:s.hours,u.value.length);break}case"d":case"dd":{n+=Ze(s.day,u.value.length);break}case"s":case"ss":{n+=Ze(Math.floor(s.seconds),u.value.length);break}case"m":case"mm":{o+1<r.length&&r[o+1].value.startsWith(":")&&(i=!0),i?n+=Ze(s.minutes,u.value.length):n+=Ze(s.month,u.value.length),i=!0;break}case"yy":{n+=Ze(s.year%100,u.value.length);break}case"yyyy":{n+=s.year;break}case"am/pm":case"a/p":{const[l,c]=u.value.split("/");n+=s.hours<12?l:c;break}default:{if(lo.test(u.value)){const l=u.value.length-3;n+=`${s.seconds<10?"0":""}${Math.floor(s.seconds*Math.pow(10,l))/Math.pow(10,l)}`;continue}return}}}return n}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Ia="length",Kn=s=>parseInt(s,16),Tu=s=>parseInt(s,10),qi=s=>(s+"").replace(/\-/g,""),di=(s,e,t)=>s.substr(e,t),Ot=s=>s.codePointAt(0)-65;function MR(s){return qi(s)[Ia]===25?Kn(di(qi(s),Kn("12"),Ot("F")))/(Kn(di(qi(s),Ot("C"),Ot("Y")>>4))||(~~![][Ia]<<3)+1):0}function wR(s){if(s=(s+"").replace(/\-/g,""),s[Ia]!==Ot("Z"))return!1;let e=0;return[[0,Ot("G")+1],[Ot("H"),Ot("H")-1],[Ot("G")+Ot("H"),Ot("G")]].reduce((t,[r,n],i)=>(t|=(Tu(`${Tu(Kn(di(s,e+r-(i===0?0:2),n+(i?2:0)))+(Kn(di(s,e+r+n,2))+[]).padStart(2,"0"))}`)%97||2)>>1,e+=2,t),Ot("A"))==="1">>1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const _R={invalid:()=>"The license key for HyperFormula is invalid.",expired:({keyValidityDate:s})=>`The license key for HyperFormula expired on ${s}, and is not valid for the installed version.`,missing:()=>"The license key for HyperFormula is missing."};let Nu=!1;function LR(s){const e={template:"missing",vars:{}};if(s==="gpl-v3"||s==="internal-use-in-handsontable")e.template="valid";else if(typeof s=="string"&&wR(s)){const[t,r,n]="14/10/2025".split("/"),i=Math.floor(new Date(`${r}/${t}/${n}`).getTime()/864e5),a=MR(s);e.vars.keyValidityDate=FR(new Date((a+1)*864e5)),i>a?e.template="expired":e.template="valid"}else s!==""&&(e.template="invalid");return!Nu&&e.template!=="valid"&&(console.warn(_R[e.template](e.vars)),Nu=!0),e.template}function FR(s){const t=["January","February","March","April","May","June","July","August","September","October","November","December"][s.getMonth()],r=s.getDate(),n=s.getFullYear();return`${t} ${r}, ${n}`}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var ce;(function(s){class e{constructor(u){this.value=u,this.value=so(this.value,xl(O(this.value)))}}s.Number=e;class t{constructor(u){this.value=u}}s.String=t;class r{constructor(u){this.value=u}}s.Boolean=r;class n{static getSingletonInstance(){return n.instance||(n.instance=new n),n.instance}}s.Empty=n;class i{constructor(u){this.formula=u}}s.Formula=i;class a{constructor(u,l){this.value=new p(u,l)}}s.Error=a})(ce||(ce={}));function UR(s){return s.startsWith("=")}function bR(s){const e=s.toLowerCase();return e==="true"||e==="false"}function xR(s,e){const t=s.toUpperCase();return/#[A-Za-z0-9\/]+[?!]?/.test(t)&&Object.prototype.hasOwnProperty.call(e,t)}class PR{constructor(e,t,r){this.config=e,this.dateHelper=t,this.numberLiteralsHelper=r}parse(e){if(e==null)return ce.Empty.getSingletonInstance();if(typeof e=="number")return bl(e)?new ce.Error(m.NUM,T.ValueLarge):new ce.Number(e);if(typeof e=="boolean")return new ce.Boolean(e);if(e instanceof Date){const t=this.dateHelper.dateToNumber({day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()}),r=Rn({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()+e.getMilliseconds()/1e3}),n=t+r;return n<0?new ce.Error(m.NUM,T.DateBounds):n%1===0?new ce.Number(new io(n,"Date()")):n<1?new ce.Number(new ao(n,"Date()")):new ce.Number(new oo(n,"Date()"))}else if(typeof e=="string"){if(bR(e))return new ce.Boolean(e.toLowerCase()==="true");if(UR(e))return new ce.Formula(e);if(xR(e,this.config.errorMapping))return new ce.Error(this.config.errorMapping[e.toUpperCase()]);{let t=e.trim(),r=0,n;if(t.endsWith("%"))r=1,t=t.slice(0,t.length-1);else{const o=this.currencyMatcher(t);o!==void 0&&(r=2,[n,t]=o)}const i=this.numberLiteralsHelper.numericStringToMaybeNumber(t);if(i!==void 0){let o;return r===1?o=new ks(i/100):r===2?o=new Ea(i,n):o=i,new ce.Number(o)}const a=this.dateHelper.dateStringToDateNumber(t);return a!==void 0?new ce.Number(a):new ce.String(e.startsWith("'")?e.slice(1):e)}}else throw new Al(e)}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length)];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length)]}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Dr;(function(s){s[s.COPY=0]="COPY",s[s.CUT=1]="CUT"})(Dr||(Dr={}));var Ve;(function(s){s[s.VALUE=0]="VALUE",s[s.EMPTY=1]="EMPTY",s[s.FORMULA=2]="FORMULA",s[s.PARSING_ERROR=3]="PARSING_ERROR"})(Ve||(Ve={}));class Su{constructor(e,t,r,n,i){this.sourceLeftCorner=e,this.width=t,this.height=r,this.type=n,this.content=i}*getContent(e){if(this.content!==void 0)for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r)yield[M(e.sheet,e.col+r,e.row+t),this.content[t][r]]}}class DR{constructor(e,t,r){this.dependencyGraph=t,this.operations=r,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}cut(e,t,r){this.clipboard=new Su(e,t,r,Dr.CUT)}copy(e,t,r){const n=[];for(let i=0;i<r;++i){n[i]=[];for(let a=0;a<t;++a){const o=this.operations.getClipboardCell(M(e.sheet,e.col+a,e.row+i));n[i].push(o)}}this.clipboard=new Su(e,t,r,Dr.COPY,n)}abortCut(){this.clipboard&&this.clipboard.type===Dr.CUT&&this.clear()}clear(){this.clipboard=void 0}ensureItIsPossibleToCopyPaste(e){if(this.clipboard===void 0)return;if(et(e)||!this.dependencyGraph.sheetMapping.hasSheetWithId(e.sheet))throw new Ie("a valid target address.");const t=U.spanFrom(e,this.clipboard.width,this.clipboard.height);if(t.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new kr;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new Error("It is not possible to paste onto an array")}isCutClipboard(){return this.clipboard!==void 0&&this.clipboard.type===Dr.CUT}isCopyClipboard(){return this.clipboard!==void 0&&this.clipboard.type===Dr.COPY}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pi{constructor(e,t,r,n){this.displayName=e,this.address=t,this.added=r,this.options=n}normalizeExpressionName(){return this.displayName.toLowerCase()}copy(){return new pi(this.displayName,this.address,this.added,this.options)}}class VR{constructor(){this.mapping=new Map}has(e){return this.mapping.has(this.normalizeExpressionName(e))}isNameAvailable(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);return!(r&&r.added)}add(e){this.mapping.set(e.normalizeExpressionName(),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}getExisting(e){const t=this.mapping.get(this.normalizeExpressionName(e));if(t&&t.added)return t}remove(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);r&&(r.added=!1)}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}normalizeExpressionName(e){return e.toLowerCase()}}class yu{constructor(){this.mapping=new Map}add(e){this.mapping.set(this.normalizeExpressionName(e.displayName),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}has(e){return this.mapping.has(this.normalizeExpressionName(e))}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}isNameAvailable(e){const t=this.normalizeExpressionName(e);return!this.mapping.has(t)}remove(e){const t=this.normalizeExpressionName(e);this.mapping.get(t)&&this.mapping.delete(t)}normalizeExpressionName(e){return e.toLowerCase()}}class zr{constructor(){this.nextNamedExpressionRow=0,this.workbookStore=new VR,this.worksheetStores=new Map,this.addressCache=new Map}isNameAvailable(e,t){var r,n;return t===void 0?this.workbookStore.isNameAvailable(e):(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.isNameAvailable(e))!==null&&n!==void 0?n:!0}namedExpressionInAddress(e){const t=this.addressCache.get(e);if(t&&t.added)return t}namedExpressionForScope(e,t){var r;return t===void 0?this.workbookStore.getExisting(e):(r=this.worksheetStore(t))===null||r===void 0?void 0:r.get(e)}nearestNamedExpression(e,t){var r,n;return(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.get(e))!==null&&n!==void 0?n:this.workbookStore.getExisting(e)}isExpressionInScope(e,t){var r,n;return(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.has(e))!==null&&n!==void 0?n:!1}isNameValid(e){const t=new RegExp(`^${ih}$`),r=new RegExp(`^${ah}$`),n=new RegExp(`^${oh}$`);return t.test(e)||r.test(e)?!1:n.test(e)}addNamedExpression(e,t,r){const n=t===void 0?this.workbookStore:this.worksheetStoreOrCreate(t);let i=n.get(e);return i!==void 0?(i.added=!0,i.displayName=e,i.options=r):(i=new pi(e,this.nextAddress(),!0,r),n.add(i)),this.addressCache.set(i.address.row,i),i}restoreNamedExpression(e,t){const r=t===void 0?this.workbookStore:this.worksheetStoreOrCreate(t);return e.added=!0,r.add(e),this.addressCache.set(e.address.row,e),e}namedExpressionOrPlaceholder(e,t){var r;return(r=this.worksheetStoreOrCreate(t).get(e))!==null&&r!==void 0?r:this.workbookNamedExpressionOrPlaceholder(e)}workbookNamedExpressionOrPlaceholder(e){let t=this.workbookStore.get(e);return t===void 0&&(t=new pi(e,this.nextAddress(),!1),this.workbookStore.add(t)),t}remove(e,t){let r;t===void 0?r=this.workbookStore:r=this.worksheetStore(t);const n=r?.get(e);if(r===void 0||n===void 0||!n.added)throw Error("Named expression does not exist");r.remove(e),r instanceof yu&&r.mapping.size===0&&this.worksheetStores.delete(t),this.addressCache.delete(n.address.row)}getAllNamedExpressionsNamesInScope(e){return this.getAllNamedExpressions().filter(({scope:t})=>t===e).map(t=>t.expression.displayName)}getAllNamedExpressionsNames(){return this.getAllNamedExpressions().map(e=>e.expression.displayName)}getAllNamedExpressions(){const e=[];return this.workbookStore.getAllNamedExpressions().forEach(t=>{e.push({expression:t,scope:void 0})}),this.worksheetStores.forEach((t,r)=>{t.getAllNamedExpressions().forEach(n=>{e.push({expression:n,scope:r})})}),e}getAllNamedExpressionsForScope(e){var t,r;return e===void 0?this.workbookStore.getAllNamedExpressions():(r=(t=this.worksheetStores.get(e))===null||t===void 0?void 0:t.getAllNamedExpressions())!==null&&r!==void 0?r:[]}worksheetStoreOrCreate(e){let t=this.worksheetStores.get(e);return t||(t=new yu,this.worksheetStores.set(e,t)),t}worksheetStore(e){return this.worksheetStores.get(e)}nextAddress(){return M(zr.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}}zr.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;const gr=s=>{switch(s.type){case g.EMPTY:case g.NUMBER:case g.STRING:case g.ERROR:case g.ERROR_WITH_RAW_INPUT:return!1;case g.CELL_REFERENCE:return!s.reference.isAbsolute();case g.CELL_RANGE:case g.COLUMN_RANGE:case g.ROW_RANGE:return!s.start.isAbsolute();case g.NAMED_EXPRESSION:return!1;case g.PERCENT_OP:case g.PLUS_UNARY_OP:case g.MINUS_UNARY_OP:return gr(s.value);case g.CONCATENATE_OP:case g.EQUALS_OP:case g.NOT_EQUAL_OP:case g.LESS_THAN_OP:case g.GREATER_THAN_OP:case g.LESS_THAN_OR_EQUAL_OP:case g.GREATER_THAN_OR_EQUAL_OP:case g.MINUS_OP:case g.PLUS_OP:case g.TIMES_OP:case g.DIV_OP:case g.POWER_OP:return gr(s.left)||gr(s.right);case g.PARENTHESIS:return gr(s.expression);case g.FUNCTION_CALL:return s.args.some(e=>gr(e));case g.ARRAY:return s.args.some(e=>e.some(t=>gr(t)))}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Mr{performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[n,i]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService)),a=t.rememberNewAst(n);r.setFormula(a),r.setAddress(i)}}transformSingleAst(e,t){const r=this.transformAst(e,t),n=this.fixNodeAddress(t);return[r,n]}transformAst(e,t){switch(e.type){case g.CELL_REFERENCE:return this.transformCellReferenceAst(e,t);case g.CELL_RANGE:return this.transformCellRangeAst(e,t);case g.COLUMN_RANGE:return this.transformColumnRangeAst(e,t);case g.ROW_RANGE:return this.transformRowRangeAst(e,t);case g.EMPTY:case g.ERROR:case g.NUMBER:case g.NAMED_EXPRESSION:case g.ERROR_WITH_RAW_INPUT:case g.STRING:return e;case g.PERCENT_OP:case g.MINUS_UNARY_OP:case g.PLUS_UNARY_OP:return Object.assign(Object.assign({},e),{value:this.transformAst(e.value,t)});case g.FUNCTION_CALL:return Object.assign(Object.assign({},e),{procedureName:e.procedureName,args:e.args.map(r=>this.transformAst(r,t))});case g.PARENTHESIS:return Object.assign(Object.assign({},e),{expression:this.transformAst(e.expression,t)});case g.ARRAY:return Object.assign(Object.assign({},e),{args:e.args.map(r=>r.map(n=>this.transformAst(n,t)))});default:return Object.assign(Object.assign({},e),{left:this.transformAst(e.left,t),right:this.transformAst(e.right,t)})}}transformCellReferenceAst(e,t){const r=this.transformCellAddress(e.reference,t);return r instanceof ie?Object.assign(Object.assign({},e),{reference:r}):r===m.REF?Gt(new p(m.REF)):e}transformCellRangeAst(e,t){const r=this.transformCellRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===m.REF?Gt(new p(m.REF)):e}transformColumnRangeAst(e,t){const r=this.transformColumnRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===m.REF?Gt(new p(m.REF)):e}transformRowRangeAst(e,t){const r=this.transformRowRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===m.REF?Gt(new p(m.REF)):e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class BR extends Mr{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!1}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=Ut(e,t);if(r!==this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet)return!1;const n=e.toSimpleColumnAddress(t);return r===this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet?this.columnsSpan.columnStart<=n.col?e.shiftedByColumns(this.columnsSpan.numberOfColumns):!1:t.sheet===this.columnsSpan.sheet&&r!==this.columnsSpan.sheet?e.isColumnAbsolute()||t.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(-this.columnsSpan.numberOfColumns):e.isColumnAbsolute()?e.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(this.columnsSpan.numberOfColumns):e.toSimpleColumnAddress(t).col<this.columnsSpan.columnStart?t.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(-this.columnsSpan.numberOfColumns):t.col<this.columnsSpan.columnStart?e.shiftedByColumns(this.columnsSpan.numberOfColumns):!1}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col+this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n===m.REF||i===m.REF?m.REF:n||i?[n||e,i||t]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Oa extends Mr{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!1}transformColumnRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}transformCellAddress(e,t){const r=Ut(e,t);if(r!==this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet)return!1;const n=e.toSimpleRowAddress(t);return r===this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet?this.rowsSpan.rowStart<=n.row?e.shiftedByRows(this.rowsSpan.numberOfRows):!1:t.sheet===this.rowsSpan.sheet&&r!==this.rowsSpan.sheet?e.isRowAbsolute()||t.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(-this.rowsSpan.numberOfRows):e.isRowAbsolute()?e.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(this.rowsSpan.numberOfRows):n.row<this.rowsSpan.rowStart?t.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(-this.rowsSpan.numberOfRows):t.row<this.rowsSpan.rowStart?e.shiftedByRows(this.rowsSpan.numberOfRows):!1}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row+this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n===m.REF||i===m.REF?m.REF:n||i?[n||e,i||t]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class kR extends Mr{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return e.isInvalid(t)?m.REF:!1}transformCellRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?m.REF:!1}transformColumnRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?m.REF:!1}transformRowRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?m.REF:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class GR extends Mr{constructor(e,t,r,n){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=n,this.dependentFormulaTransformer=new HR(e,t,r,n)}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}transformSingleAst(e,t){return this.sourceRange.addressInRange(t)?[this.transformAst(e,t),this.fixNodeAddress(t)]:this.dependentFormulaTransformer.transformSingleAst(e,t)}fixNodeAddress(e){return M(this.toSheet,e.col+this.toRight,e.row+this.toBottom)}transformCellAddress(e,t){return this.transformAddress(e,t)}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformAddress(e,t){const r=this.sourceRange;if(e instanceof ie){const n=e.toSimpleCellAddress(t);if(r.addressInRange(n))return e.shiftAbsoluteDimensions(this.toRight,this.toBottom)}return e.shiftRelativeDimensions(-this.toRight,-this.toBottom)}transformRange(e,t,r){const n=this.sourceRange;if(e instanceof ie&&t instanceof ie){const i=e.toSimpleCellAddress(r),a=t.toSimpleCellAddress(r);if(n.addressInRange(i)&&n.addressInRange(a))return[e.shiftAbsoluteDimensions(this.toRight,this.toBottom),t.shiftAbsoluteDimensions(this.toRight,this.toBottom)]}return[e.shiftRelativeDimensions(-this.toRight,-this.toBottom),t.shiftRelativeDimensions(-this.toRight,-this.toBottom)]}}class HR extends Mr{constructor(e,t,r,n){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=n}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.shouldMove(e,t)?e.moved(this.toSheet,this.toRight,this.toBottom):!1}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}shouldMove(e,t){return e instanceof ie?this.sourceRange.addressInRange(e.toSimpleCellAddress(t)):e instanceof We?this.sourceRange.rowInRange(e.toSimpleRowAddress(t))&&!this.sourceRange.isFinite():this.sourceRange.columnInRange(e.toSimpleColumnAddress(t))&&!this.sourceRange.isFinite()}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n&&i?[n,i]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class WR extends Mr{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!0}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=Ut(e,t);if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet!==r)return!1;if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet===r){const n=e.toSimpleColumnAddress(t);if(n.col<this.columnsSpan.columnStart)return!1;if(n.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet!==r){if(e.isColumnAbsolute())return!1;if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet===r)if(e.isColumnAbsolute()){if(e.col<this.columnsSpan.columnStart)return!1;if(e.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}else{const n=e.toSimpleColumnAddress(t);if(n.col<this.columnsSpan.columnStart){if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}else if(n.col>this.columnsSpan.columnEnd){if(t.col<this.columnsSpan.columnStart)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns);if(t.col>this.columnsSpan.columnEnd)return!1}}return m.REF}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col-this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const n=Ut(e,r);let i=e,a=t;if(this.columnsSpan.sheet===n){const l=e.toSimpleColumnAddress(r),c=t.toSimpleColumnAddress(r);if(this.columnsSpan.columnStart<=l.col&&this.columnsSpan.columnEnd>=c.col)return m.REF;l.col>=this.columnsSpan.columnStart&&l.col<=this.columnsSpan.columnEnd&&(i=e.shiftedByColumns(this.columnsSpan.columnEnd-l.col+1)),c.col>=this.columnsSpan.columnStart&&c.col<=this.columnsSpan.columnEnd&&(a=t.shiftedByColumns(-(c.col-this.columnsSpan.columnStart+1)))}const o=this.transformCellAddress(i,r),u=this.transformCellAddress(a,r);if(o===!1&&u===!1)return[i,a];if(o===m.REF||u===m.REF)throw Error("Cannot happen");return[o||i,u||a]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ma extends Mr{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!0}transformColumnRangeAst(e,t){return e}transformCellAddress(e,t){const r=Ut(e,t);if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet!==r)return!1;if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet===r){const n=e.toSimpleRowAddress(t);if(n.row<this.rowsSpan.rowStart)return!1;if(n.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet!==r){if(e.isRowAbsolute())return!1;if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet===r)if(e.isRowAbsolute()){if(e.row<this.rowsSpan.rowStart)return!1;if(e.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}else{const n=e.toSimpleRowAddress(t);if(n.row<this.rowsSpan.rowStart){if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}else if(n.row>this.rowsSpan.rowEnd){if(t.row<this.rowsSpan.rowStart)return e.shiftedByRows(-this.rowsSpan.numberOfRows);if(t.row>this.rowsSpan.rowEnd)return!1}}return m.REF}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row-this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const n=Ut(e,r);let i=e,a=t;if(this.rowsSpan.sheet===n){const l=e.toSimpleRowAddress(r),c=t.toSimpleRowAddress(r);if(this.rowsSpan.rowStart<=l.row&&this.rowsSpan.rowEnd>=c.row)return m.REF;l.row>=this.rowsSpan.rowStart&&l.row<=this.rowsSpan.rowEnd&&(i=e.shiftedByRows(this.rowsSpan.rowEnd-l.row+1)),c.row>=this.rowsSpan.rowStart&&c.row<=this.rowsSpan.rowEnd&&(a=t.shiftedByRows(-(c.row-this.rowsSpan.rowStart+1)))}const o=this.transformCellAddress(i,r),u=this.transformCellAddress(a,r);return o===!1&&u===!1?[i,a]:o===m.REF||u===m.REF?m.REF:[o||i,u||a]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class YR extends Mr{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[n]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService));r.setFormula(n)}}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.transformAddress(e)}transformCellRange(e,t,r){return this.transformAddress(e)}transformColumnRange(e,t,r){return this.transformAddress(e)}transformRowRange(e,t,r){return this.transformAddress(e)}transformAddress(e){return e.sheet===this.sheet?m.REF:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Yl(s){if(!Array.isArray(s))throw new Ie("an array of arrays.");for(let e=0;e<s.length;e++)if(!Array.isArray(s[e]))throw new Ie("an array of arrays.")}function fi(s){let e=0,t=0,r=0;for(let i=0;i<s.length;i++){let a=0;for(let o=0;o<s[i].length;o++){const u=s[i][o];u!=null&&(a=o+1,++r)}e=Math.max(e,a),a>0&&(t=i+1)}const n=e*t;return{height:t,width:e,fill:n===0?0:r/n}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class zl{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return mi(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>tt.fromNumberOfRows(this.sheet,e[0],e[1]))}}class $l{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return gi(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>tt.fromNumberOfRows(this.sheet,e[0],e[1]))}}class Xl{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return gi(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>lt.fromNumberOfColumns(this.sheet,e[0],e[1]))}}class Kl{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return mi(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>lt.fromNumberOfColumns(this.sheet,e[0],e[1]))}}class zR{constructor(e,t,r,n,i,a,o,u,l){this.dependencyGraph=t,this.columnSearch=r,this.cellContentParser=n,this.parser=i,this.stats=a,this.lazilyTransformingAstService=o,this.namedExpressions=u,this.arraySizePredictor=l,this.changes=Sr.empty(),this.allocateNamedExpressionAddressSpace(),this.maxColumns=e.maxColumns,this.maxRows=e.maxRows}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}removeRows(e){const t=[];for(const r of e.rowsSpans()){const n=this.doRemoveRows(r);n&&t.push(n)}return t}addRows(e){for(const t of e.rowsSpans())this.doAddRows(t)}addColumns(e){for(const t of e.columnsSpans())this.doAddColumns(t)}removeColumns(e){const t=[];for(const r of e.columnsSpans()){const n=this.doRemoveColumns(r);n&&t.push(n)}return t}removeSheet(e){this.dependencyGraph.removeSheet(e);let t=0;this.stats.measure(D.TRANSFORM_ASTS,()=>{const n=new YR(e);n.performEagerTransformations(this.dependencyGraph,this.parser),t=this.lazilyTransformingAstService.addTransformation(n)}),this.sheetMapping.removeSheet(e),this.columnSearch.removeSheet(e);const r=this.namedExpressions.getAllNamedExpressionsForScope(e).map(n=>this.removeNamedExpression(n.normalizeExpressionName(),e));return{version:t,scopedNamedExpressions:r}}removeSheetByName(e){const t=this.sheetMapping.fetch(e);return this.removeSheet(t)}clearSheet(e){this.dependencyGraph.clearSheet(e),this.columnSearch.removeSheet(e)}addSheet(e){const t=this.sheetMapping.addSheet(e),r=[];return this.dependencyGraph.addressMapping.autoAddSheet(t,fi(r)),this.sheetMapping.fetchDisplayName(t)}renameSheet(e,t){return this.sheetMapping.renameSheet(e,t)}moveRows(e,t,r,n){const i=tt.fromNumberOfRows(e,n,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddRows(i),n<t&&(t+=r);const a=M(e,0,t),o=M(e,0,n);this.moveCells(a,Number.POSITIVE_INFINITY,r,o);const u=tt.fromNumberOfRows(e,t,r);return this.doRemoveRows(u),this.lazilyTransformingAstService.commitCombinedMode()}moveColumns(e,t,r,n){const i=lt.fromNumberOfColumns(e,n,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddColumns(i),n<t&&(t+=r);const a=M(e,t,0),o=M(e,n,0);this.moveCells(a,r,Number.POSITIVE_INFINITY,o);const u=lt.fromNumberOfColumns(e,t,r);return this.doRemoveColumns(u),this.lazilyTransformingAstService.commitCombinedMode()}moveCells(e,t,r,n){this.ensureItIsPossibleToMoveCells(e,t,r,n);const i=U.spanFrom(e,t,r),a=U.spanFrom(n,t,r),o=n.col-e.col,u=n.row-e.row,l=n.sheet,c=this.getRangeClipboardCells(a),d=this.dependencyGraph.rawValuesFromRange(a);this.columnSearch.removeValues(d);const f=this.dependencyGraph.rawValuesFromRange(i);this.columnSearch.moveValues(f,o,u,l);let E=0;this.stats.measure(D.TRANSFORM_ASTS,()=>{const R=new GR(i,o,u,l);R.performEagerTransformations(this.dependencyGraph,this.parser),E=this.lazilyTransformingAstService.addTransformation(R)}),this.dependencyGraph.moveCells(i,o,u,l);const N=this.updateNamedExpressionsForMovedCells(e,t,r,n);return{version:E,overwrittenCellsData:c,addedGlobalNamedExpressions:N}}setRowOrder(e,t){const r=[];let n=[];for(const[i,a]of t)if(i!==a){const o=U.spanFrom({sheet:e,col:0,row:i},1/0,1),u=this.getRangeClipboardCells(o);n=n.concat(u),r.push(u.map(([{sheet:l,col:c},d])=>[{sheet:l,col:c,row:a},d]))}return r.forEach(i=>this.restoreClipboardCells(e,i.values())),n}setColumnOrder(e,t){const r=[];let n=[];for(const[i,a]of t)if(i!==a){const o=U.spanFrom({sheet:e,col:i,row:0},1,1/0),u=this.getRangeClipboardCells(o);n=n.concat(u),r.push(u.map(([{sheet:l,col:c,row:d},f])=>[{sheet:l,col:a,row:d},f]))}return r.forEach(i=>this.restoreClipboardCells(e,i.values())),n}addNamedExpression(e,t,r,n){const i=this.namedExpressions.addNamedExpression(e,r,n);this.storeNamedExpressionInCell(i.address,t),this.adjustNamedExpressionEdges(i,e,r)}restoreNamedExpression(e,t,r){const n=e.displayName;this.restoreCell(e.address,t);const i=this.namedExpressions.restoreNamedExpression(e,r);this.adjustNamedExpressionEdges(i,n,r)}changeNamedExpressionExpression(e,t,r,n){const i=this.namedExpressions.namedExpressionForScope(e,r);if(!i)throw new ts(e);const a=i.copy();i.options=n;const o=this.getClipboardCell(i.address);return this.storeNamedExpressionInCell(i.address,t),[a,o]}removeNamedExpression(e,t){const r=this.namedExpressions.namedExpressionForScope(e,t);if(!r)throw new ts(e);this.namedExpressions.remove(r.displayName,t);const n=this.getClipboardCell(r.address);if(t!==void 0){const i=this.namedExpressions.workbookNamedExpressionOrPlaceholder(e);this.dependencyGraph.exchangeNode(r.address,i.address)}else this.dependencyGraph.setCellEmpty(r.address);return[r,n]}ensureItIsPossibleToMoveCells(e,t,r,n){if(et(e)||!(Ei(t)&&Ei(r)||$R(e,t,r))||et(n)||!this.sheetMapping.hasSheetWithId(e.sheet)||!this.sheetMapping.hasSheetWithId(n.sheet))throw new Ie("a valid range of cells to move.");const i=U.spanFrom(e,t,r),a=U.spanFrom(n,t,r);if(a.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new kr;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new dn;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(a))throw new ui}restoreClipboardCells(e,t){const r=[];for(const[n,i]of t)if(this.restoreCell(n,i),i.type===Ve.FORMULA){const{dependencies:a}=this.parser.fetchCachedResult(i.hash);r.push(...this.updateNamedExpressionsForTargetAddress(e,n,a))}return r}restoreCell(e,t){switch(t.type){case Ve.VALUE:{this.setValueToCell(t,e);break}case Ve.FORMULA:{this.setFormulaToCellFromCache(t.hash,e);break}case Ve.EMPTY:{this.setCellEmpty(e);break}case Ve.PARSING_ERROR:{this.setParsingErrorToCell(t.rawInput,t.errors,e);break}}}getOldContent(e){const t=this.dependencyGraph.getCell(e);if(t===void 0||t instanceof Rr)return[e,{type:Ve.EMPTY}];if(t instanceof yr)return[e,Object.assign({type:Ve.VALUE},t.getValues())];if(t instanceof ct)return[t.getAddress(this.lazilyTransformingAstService),{type:Ve.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))}];if(t instanceof gn)return[e,{type:Ve.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}];throw Error("Trying to copy unsupported type")}getClipboardCell(e){const t=this.dependencyGraph.getCell(e);if(t===void 0||t instanceof Rr)return{type:Ve.EMPTY};if(t instanceof yr)return Object.assign({type:Ve.VALUE},t.getValues());if(t instanceof ye){const r=t.getArrayCellValue(e);return r===G?{type:Ve.EMPTY}:{type:Ve.VALUE,parsedValue:r,rawValue:t.getArrayCellRawValue(e)}}else{if(t instanceof Wt)return{type:Ve.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))};if(t instanceof gn)return{type:Ve.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}}throw Error("Trying to copy unsupported type")}getSheetClipboardCells(e){const t=this.dependencyGraph.getSheetHeight(e),r=this.dependencyGraph.getSheetWidth(e),n=new Array(t);for(let i=0;i<t;i++){n[i]=new Array(r);for(let a=0;a<r;a++){const o=M(e,a,i);n[i][a]=this.getClipboardCell(o)}}return n}getRangeClipboardCells(e){const t=[];for(const r of e.addresses(this.dependencyGraph))t.push([r,this.getClipboardCell(r)]);return t}setCellContent(e,t){const r=this.cellContentParser.parse(t),n=this.getOldContent(e);if(r instanceof ce.Formula){const i=this.parser.parse(r.formula,e),{ast:a,errors:o}=i;if(o.length>0)this.setParsingErrorToCell(r.formula,o,e);else try{const u=this.arraySizePredictor.checkArraySize(a,e);if(u.width<=0||u.height<=0)throw Error("Incorrect array size");this.setFormulaToCell(e,u,i)}catch(u){if(!u.message)throw u;const l={type:Ee.InvalidRangeSize,message:"Invalid range size."};this.setParsingErrorToCell(r.formula,[l],e)}}else r instanceof ce.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e);return n}setSheetContent(e,t){this.clearSheet(e);for(let r=0;r<t.length;r++)for(let n=0;n<t[r].length;n++){const i=M(e,n,r);this.setCellContent(i,t[r][n])}}setParsingErrorToCell(e,t,r){const n=this.dependencyGraph.getCellValue(r),i=new gn(t,e),a=this.dependencyGraph.setParsingErrorToCell(r,i);this.columnSearch.remove(O(n),r),this.columnSearch.applyChanges(a.getChanges()),this.changes.addAll(a),this.changes.addChange(i.getCellValue(),r)}setFormulaToCell(e,t,{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}){const o=this.dependencyGraph.getCellValue(e),u=this.dependencyGraph.setFormulaToCell(e,r,Ht(a,e),t,n,i);this.columnSearch.remove(O(o),e),this.columnSearch.applyChanges(u.getChanges()),this.changes.addAll(u)}setValueToCell(e,t){const r=this.dependencyGraph.getCellValue(t),n=this.dependencyGraph.setValueToCell(t,e);this.columnSearch.change(O(r),O(e.parsedValue),t),this.columnSearch.applyChanges(n.getChanges().filter(i=>!ns(i.address,t))),this.changes.addAll(n),this.changes.addChange(e.parsedValue,t)}setCellEmpty(e){if(this.dependencyGraph.isArrayInternalCell(e))return;const t=this.dependencyGraph.getCellValue(e),r=this.dependencyGraph.setCellEmpty(e);this.columnSearch.remove(O(t),e),this.columnSearch.applyChanges(r.getChanges()),this.changes.addAll(r),this.changes.addChange(G,e)}setFormulaToCellFromCache(e,t){const{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}=this.parser.fetchCachedResult(e),o=Ht(a,t),[u]=new kR(t.sheet).transformSingleAst(r,t);this.parser.rememberNewAst(u);const l=RE(o),c=this.arraySizePredictor.checkArraySize(r,t);this.dependencyGraph.setFormulaToCell(t,u,l,c,n,i)}rowEffectivelyNotInSheet(e,t){const r=this.dependencyGraph.addressMapping.getHeight(t);return e>=r}getAndClearContentChanges(){const e=this.changes;return this.changes=Sr.empty(),e}forceApplyPostponedTransformations(){this.dependencyGraph.forceApplyPostponedTransformations()}doRemoveRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const t=[];for(const[a]of this.dependencyGraph.entriesFromRowsSpan(e))t.push({address:a,cellType:this.getClipboardCell(a)});const{affectedArrays:r,contentChanges:n}=this.dependencyGraph.removeRows(e);this.columnSearch.applyChanges(n.getChanges());let i=0;return this.stats.measure(D.TRANSFORM_ASTS,()=>{const a=new Ma(e);a.performEagerTransformations(this.dependencyGraph,this.parser),i=this.lazilyTransformingAstService.addTransformation(a)}),this.rewriteAffectedArrays(r),{version:i,removedCells:t,rowFrom:e.rowStart,rowCount:e.numberOfRows}}doRemoveColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const t=[];for(const[a]of this.dependencyGraph.entriesFromColumnsSpan(e))t.push({address:a,cellType:this.getClipboardCell(a)});const{affectedArrays:r,contentChanges:n}=this.dependencyGraph.removeColumns(e);this.columnSearch.applyChanges(n.getChanges()),this.columnSearch.removeColumns(e);let i=0;return this.stats.measure(D.TRANSFORM_ASTS,()=>{const a=new WR(e);a.performEagerTransformations(this.dependencyGraph,this.parser),i=this.lazilyTransformingAstService.addTransformation(a)}),this.rewriteAffectedArrays(r),{version:i,removedCells:t,columnFrom:e.columnStart,columnCount:e.numberOfColumns}}doAddRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const{affectedArrays:t}=this.dependencyGraph.addRows(e);this.stats.measure(D.TRANSFORM_ASTS,()=>{const r=new Oa(e);r.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(r)}),this.rewriteAffectedArrays(t)}rewriteAffectedArrays(e){for(const t of e.values()){if(t.array.size.isRef)continue;const r=t.getFormula(this.lazilyTransformingAstService),n=t.getAddress(this.lazilyTransformingAstService),i=this.parser.computeHashFromAst(r);this.setFormulaToCellFromCache(i,n)}}doAddColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const{affectedArrays:t,contentChanges:r}=this.dependencyGraph.addColumns(e);this.columnSearch.addColumns(e),this.columnSearch.applyChanges(r.getChanges()),this.stats.measure(D.TRANSFORM_ASTS,()=>{const n=new BR(e);n.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(n)}),this.rewriteAffectedArrays(t)}columnEffectivelyNotInSheet(e,t){const r=this.dependencyGraph.addressMapping.getWidth(t);return e>=r}adjustNamedExpressionEdges(e,t,r){if(r===void 0)return;const{vertex:n,id:i}=this.dependencyGraph.fetchCellOrCreateEmpty(e.address),a=i??this.dependencyGraph.graph.getNodeId(n),o=this.namedExpressions.workbookNamedExpressionOrPlaceholder(t),{vertex:u,id:l}=this.dependencyGraph.fetchCellOrCreateEmpty(o.address),c=l??this.dependencyGraph.graph.getNodeId(u);for(const d of this.dependencyGraph.graph.adjacentNodes(u))if(d instanceof Wt&&d.getAddress(this.lazilyTransformingAstService).sheet===r){const f=d.getFormula(this.lazilyTransformingAstService),E=d.getAddress(this.lazilyTransformingAstService),{dependencies:N}=this.parser.fetchCachedResultForAst(f);for(const R of Ht(N,E))R instanceof nr&&R.name.toLowerCase()===e.displayName.toLowerCase()&&(this.dependencyGraph.graph.removeEdgeIfExists(c,d),this.dependencyGraph.graph.addEdge(a,d))}}storeNamedExpressionInCell(e,t){const r=this.cellContentParser.parse(t);if(r instanceof ce.Formula){const n=this.parser.parse(r.formula,M(-1,0,0));if(gr(n.ast))throw new uo;const{ast:i,hasVolatileFunction:a,hasStructuralChangeFunction:o,dependencies:u}=n;this.dependencyGraph.setFormulaToCell(e,i,Ht(u,e),B.scalar(),a,o)}else r instanceof ce.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e)}updateNamedExpressionsForMovedCells(e,t,r,n){if(e.sheet===n.sheet)return[];const i=[],a=U.spanFrom(n,t,r);for(const o of a.addresses(this.dependencyGraph)){const u=this.addressMapping.fetchCell(o);if(u instanceof Wt&&o.sheet!==e.sheet){const l=u.getFormula(this.lazilyTransformingAstService),{dependencies:c}=this.parser.fetchCachedResultForAst(l);i.push(...this.updateNamedExpressionsForTargetAddress(e.sheet,o,c))}}return i}updateNamedExpressionsForTargetAddress(e,t,r){if(e===t.sheet)return[];const n=[],i=this.addressMapping.fetchCell(t);for(const a of Ht(r,t)){if(!(a instanceof nr))continue;const o=a.name,u=this.dependencyGraph.fetchNamedExpressionVertex(o,e).vertex,c=this.namedExpressions.isExpressionInScope(o,t.sheet)?this.dependencyGraph.fetchNamedExpressionVertex(o,t.sheet).vertex:this.copyOrFetchGlobalNamedExpressionVertex(o,u,n);c!==u&&(this.dependencyGraph.graph.removeEdgeIfExists(u,i),this.dependencyGraph.graph.addEdge(c,i))}return n}allocateNamedExpressionAddressSpace(){this.dependencyGraph.addressMapping.addSheet(zr.SHEET_FOR_WORKBOOK_EXPRESSIONS,new VE(0,0))}copyOrFetchGlobalNamedExpressionVertex(e,t,r){let n=this.namedExpressions.namedExpressionForScope(e);if(n===void 0)if(n=this.namedExpressions.addNamedExpression(e),r.push(n.normalizeExpressionName()),t instanceof Wt){const i=this.parser.fetchCachedResultForAst(t.getFormula(this.lazilyTransformingAstService)),{ast:a,hasVolatileFunction:o,hasStructuralChangeFunction:u,dependencies:l}=i;this.dependencyGraph.setFormulaToCell(n.address,a,Ht(l,n.address),B.scalar(),o,u)}else t instanceof Rr?this.setCellEmpty(n.address):t instanceof yr&&this.setValueToCell(t.getValues(),n.address);return this.dependencyGraph.fetchCellOrCreateEmpty(n.address).vertex}}function mi(s){if(s.length<=1)return s;const e=[...s].sort(([n],[i])=>n-i),t=e.reduce((n,[i,a])=>{const o=n[n.length-1],u=o[0]+o[1];return i<=u?o[1]+=Math.max(0,a-(u-i)):n.push([i,a]),n},[e[0]]);let r=0;for(let n=0;n<t.length;++n)t[n][0]-=r,r+=t[n][1];return t}function gi(s){if(s.length<=1)return s;const e=[...s].sort(([n],[i])=>n-i),t=e.reduce((n,[i,a])=>{const o=n[n.length-1];return i===o[0]?o[1]=Math.max(o[1],a):n.push([i,a]),n},[e[0]]);let r=0;for(let n=0;n<t.length;++n)t[n][0]+=r,r+=t[n][1];return t}function Ei(s){return Number.isInteger(s)&&s>0}function $R(s,e,t){return s.row===0&&Ei(e)&&t===Number.POSITIVE_INFINITY||s.col===0&&Ei(t)&&e===Number.POSITIVE_INFINITY}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Oe{}class XR extends Oe{constructor(e,t){super(),this.command=e,this.rowsRemovals=t}doUndo(e){e.undoRemoveRows(this)}doRedo(e){e.redoRemoveRows(this)}}class KR extends Oe{constructor(e,t,r,n,i,a,o){super(),this.sourceLeftCorner=e,this.width=t,this.height=r,this.destinationLeftCorner=n,this.overwrittenCellsData=i,this.addedGlobalNamedExpressions=a,this.version=o}doUndo(e){e.undoMoveCells(this)}doRedo(e){e.redoMoveCells(this)}}class jR extends Oe{constructor(e){super(),this.command=e}doUndo(e){e.undoAddRows(this)}doRedo(e){e.redoAddRows(this)}}class qR extends Oe{constructor(e,t,r){super(),this.sheetId=e,this.rowMapping=t,this.oldContent=r}doUndo(e){e.undoSetRowOrder(this)}doRedo(e){e.redoSetRowOrder(this)}}class QR extends Oe{constructor(e,t,r){super(),this.sheetId=e,this.columnMapping=t,this.oldContent=r}doUndo(e){e.undoSetColumnOrder(this)}doRedo(e){e.redoSetColumnOrder(this)}}class ZR extends Oe{constructor(e,t,r){super(),this.sheetId=e,this.oldSheetContent=t,this.newSheetContent=r}doUndo(e){e.undoSetSheetContent(this)}doRedo(e){e.redoSetSheetContent(this)}}class JR extends Oe{constructor(e,t,r,n,i){super(),this.sheet=e,this.startRow=t,this.numberOfRows=r,this.targetRow=n,this.version=i,this.undoStart=this.startRow<this.targetRow?this.targetRow-this.numberOfRows:this.targetRow,this.undoEnd=this.startRow>this.targetRow?this.startRow+this.numberOfRows:this.startRow}doUndo(e){e.undoMoveRows(this)}doRedo(e){e.redoMoveRows(this)}}class eT extends Oe{constructor(e,t,r,n,i){super(),this.sheet=e,this.startColumn=t,this.numberOfColumns=r,this.targetColumn=n,this.version=i,this.undoStart=this.startColumn<this.targetColumn?this.targetColumn-this.numberOfColumns:this.targetColumn,this.undoEnd=this.startColumn>this.targetColumn?this.startColumn+this.numberOfColumns:this.startColumn}doUndo(e){e.undoMoveColumns(this)}doRedo(e){e.redoMoveColumns(this)}}class tT extends Oe{constructor(e){super(),this.command=e}doUndo(e){e.undoAddColumns(this)}doRedo(e){e.redoAddColumns(this)}}class rT extends Oe{constructor(e,t){super(),this.command=e,this.columnsRemovals=t}doUndo(e){e.undoRemoveColumns(this)}doRedo(e){e.redoRemoveColumns(this)}}class nT extends Oe{constructor(e){super(),this.sheetName=e}doUndo(e){e.undoAddSheet(this)}doRedo(e){e.redoAddSheet(this)}}class sT extends Oe{constructor(e,t,r,n,i){super(),this.sheetName=e,this.sheetId=t,this.oldSheetContent=r,this.scopedNamedExpressions=n,this.version=i}doUndo(e){e.undoRemoveSheet(this)}doRedo(e){e.redoRemoveSheet(this)}}class iT extends Oe{constructor(e,t,r){super(),this.sheetId=e,this.oldName=t,this.newName=r}doUndo(e){e.undoRenameSheet(this)}doRedo(e){e.redoRenameSheet(this)}}class aT extends Oe{constructor(e,t){super(),this.sheetId=e,this.oldSheetContent=t}doUndo(e){e.undoClearSheet(this)}doRedo(e){e.redoClearSheet(this)}}class oT extends Oe{constructor(e){super(),this.cellContents=e}doUndo(e){e.undoSetCellContents(this)}doRedo(e){e.redoSetCellContents(this)}}class uT extends Oe{constructor(e,t,r,n){super(),this.targetLeftCorner=e,this.oldContent=t,this.newContent=r,this.addedGlobalNamedExpressions=n}doUndo(e){e.undoPaste(this)}doRedo(e){e.redoPaste(this)}}class hT extends Oe{constructor(e,t,r,n){super(),this.name=e,this.newContent=t,this.scope=r,this.options=n}doUndo(e){e.undoAddNamedExpression(this)}doRedo(e){e.redoAddNamedExpression(this)}}class lT extends Oe{constructor(e,t,r){super(),this.namedExpression=e,this.content=t,this.scope=r}doUndo(e){e.undoRemoveNamedExpression(this)}doRedo(e){e.redoRemoveNamedExpression(this)}}class cT extends Oe{constructor(e,t,r,n,i){super(),this.namedExpression=e,this.newContent=t,this.oldContent=r,this.scope=n,this.options=i}doUndo(e){e.undoChangeNamedExpression(this)}doRedo(e){e.redoChangeNamedExpression(this)}}class dT extends Oe{constructor(){super(...arguments),this.operations=[]}add(e){this.operations.push(e)}*reversedOperations(){for(let e=this.operations.length-1;e>=0;e--)yield this.operations[e]}doUndo(e){e.undoBatch(this)}doRedo(e){e.redoBatch(this)}}class pT{constructor(e,t){this.operations=t,this.oldData=new Map,this.undoStack=[],this.redoStack=[],this.undoLimit=e.undoLimit}saveOperation(e){this.batchUndoEntry!==void 0?this.batchUndoEntry.add(e):this.addUndoEntry(e)}beginBatchMode(){this.batchUndoEntry=new dT}commitBatchMode(){if(this.batchUndoEntry===void 0)throw Error("Batch mode wasn't started");this.addUndoEntry(this.batchUndoEntry),this.batchUndoEntry=void 0}storeDataForVersion(e,t,r){this.oldData.has(e)||this.oldData.set(e,[]),this.oldData.get(e).push([t,r])}clearRedoStack(){this.redoStack=[]}clearUndoStack(){this.undoStack=[]}isUndoStackEmpty(){return this.undoStack.length===0}isRedoStackEmpty(){return this.redoStack.length===0}undo(){const e=this.undoStack.pop();if(!e)throw Error("Attempted to undo without operation on stack");this.undoEntry(e),this.redoStack.push(e)}undoBatch(e){for(const t of e.reversedOperations())this.undoEntry(t)}undoRemoveRows(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},rowsRemovals:r}=e;for(let n=r.length-1;n>=0;--n){const i=r[n];this.operations.addRows(new $l(t,[[i.rowFrom,i.rowCount]]));for(const{address:a,cellType:o}of i.removedCells)this.operations.restoreCell(a,o);this.restoreOldDataFromVersion(i.version-1)}}undoRemoveColumns(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},columnsRemovals:r}=e;for(let n=r.length-1;n>=0;--n){const i=r[n];this.operations.addColumns(new Xl(t,[[i.columnFrom,i.columnCount]]));for(const{address:a,cellType:o}of i.removedCells)this.operations.restoreCell(a,o);this.restoreOldDataFromVersion(i.version-1)}}undoAddRows(e){const t=e.command.rowsSpans();for(let r=t.length-1;r>=0;--r){const n=t[r];this.operations.removeRows(new zl(e.command.sheet,[[n.rowStart,n.numberOfRows]]))}}undoAddColumns(e){const t=e.command.columnsSpans();for(let r=t.length-1;r>=0;--r){const n=t[r];this.operations.removeColumns(new Kl(e.command.sheet,[[n.columnStart,n.numberOfColumns]]))}}undoSetCellContents(e){for(const t of e.cellContents){const r=t.address,[n,i]=t.oldContent;ns(r,n)||this.operations.setCellEmpty(r),this.operations.restoreCell(n,i)}}undoPaste(e){this.restoreOperationOldContent(e.oldContent);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoMoveRows(e){const{sheet:t}=e;this.operations.moveRows(t,e.undoStart,e.numberOfRows,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveColumns(e){const{sheet:t}=e;this.operations.moveColumns(t,e.undoStart,e.numberOfColumns,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveCells(e){this.operations.forceApplyPostponedTransformations(),this.operations.moveCells(e.destinationLeftCorner,e.width,e.height,e.sourceLeftCorner),this.restoreOperationOldContent(e.overwrittenCellsData),this.restoreOldDataFromVersion(e.version-1);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoAddSheet(e){const{sheetName:t}=e;this.operations.removeSheetByName(t)}undoRemoveSheet(e){this.operations.forceApplyPostponedTransformations();const{oldSheetContent:t,sheetId:r}=e;this.operations.addSheet(e.sheetName);for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=M(r,a,n);this.operations.restoreCell(u,o)}}for(const[n,i]of e.scopedNamedExpressions)this.operations.restoreNamedExpression(n,i,r);this.restoreOldDataFromVersion(e.version-1)}undoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.oldName)}undoClearSheet(e){const{oldSheetContent:t,sheetId:r}=e;for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=M(r,a,n);this.operations.restoreCell(u,o)}}}undoSetSheetContent(e){const{oldSheetContent:t,sheetId:r}=e;this.operations.clearSheet(r);for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=M(r,a,n);this.operations.restoreCell(u,o)}}}undoAddNamedExpression(e){this.operations.removeNamedExpression(e.name,e.scope)}undoRemoveNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.content,e.scope)}undoChangeNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.oldContent,e.scope)}undoSetRowOrder(e){this.restoreOperationOldContent(e.oldContent)}undoSetColumnOrder(e){this.restoreOperationOldContent(e.oldContent)}redo(){const e=this.redoStack.pop();if(!e)throw Error("Attempted to redo without operation on stack");this.redoEntry(e),this.undoStack.push(e)}redoBatch(e){for(const t of e.operations)this.redoEntry(t)}redoRemoveRows(e){this.operations.removeRows(e.command)}redoMoveCells(e){this.operations.moveCells(e.sourceLeftCorner,e.width,e.height,e.destinationLeftCorner)}redoRemoveColumns(e){this.operations.removeColumns(e.command)}redoPaste(e){const{targetLeftCorner:t,newContent:r}=e,n=r.length,i=r[0].length;for(let a=0;a<n;++a)for(let o=0;o<i;++o){const u=M(t.sheet,t.col+o,t.row+a);this.operations.restoreCell(u,r[a][o])}}redoSetCellContents(e){for(const t of e.cellContents)this.operations.setCellContent(t.address,t.newContent)}redoAddRows(e){this.operations.addRows(e.command)}redoAddColumns(e){this.operations.addColumns(e.command)}redoRemoveSheet(e){this.operations.removeSheetByName(e.sheetName)}redoAddSheet(e){this.operations.addSheet(e.sheetName)}redoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.newName)}redoMoveRows(e){this.operations.moveRows(e.sheet,e.startRow,e.numberOfRows,e.targetRow)}redoMoveColumns(e){this.operations.moveColumns(e.sheet,e.startColumn,e.numberOfColumns,e.targetColumn)}redoClearSheet(e){this.operations.clearSheet(e.sheetId)}redoSetSheetContent(e){const{sheetId:t,newSheetContent:r}=e;this.operations.setSheetContent(t,r)}redoAddNamedExpression(e){this.operations.addNamedExpression(e.name,e.newContent,e.scope,e.options)}redoRemoveNamedExpression(e){this.operations.removeNamedExpression(e.namedExpression.displayName,e.scope)}redoChangeNamedExpression(e){this.operations.changeNamedExpressionExpression(e.namedExpression.displayName,e.newContent,e.scope,e.options)}redoSetRowOrder(e){this.operations.setRowOrder(e.sheetId,e.rowMapping)}redoSetColumnOrder(e){this.operations.setColumnOrder(e.sheetId,e.columnMapping)}addUndoEntry(e){this.undoStack.push(e),this.undoStack.splice(0,Math.max(0,this.undoStack.length-this.undoLimit))}undoEntry(e){e.doUndo(this)}restoreOperationOldContent(e){for(const[t,r]of e)this.operations.restoreCell(t,r)}redoEntry(e){e.doRedo(this)}restoreOldDataFromVersion(e){const t=this.oldData.get(e)||[];for(const r of t){const[n,i]=r;this.operations.setFormulaToCellFromCache(i,n)}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class fT{constructor(e,t,r,n,i,a,o,u,l,c){this.operations=t,this.undoRedo=r,this.clipboardOperations=n,this.dependencyGraph=i,this.columnSearch=a,this.parser=o,this.cellContentParser=u,this.lazilyTransformingAstService=l,this.namedExpressions=c,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}get sheetMapping(){return this.dependencyGraph.sheetMapping}addRows(e,...t){const r=new $l(e,t);this.ensureItIsPossibleToAddRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(r),this.undoRedo.saveOperation(new jR(r))}removeRows(e,...t){const r=new zl(e,t);this.ensureItIsPossibleToRemoveRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.removeRows(r);this.undoRedo.saveOperation(new XR(r,n))}addColumns(e,...t){const r=new Xl(e,t);this.ensureItIsPossibleToAddColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(r),this.undoRedo.saveOperation(new tT(r))}removeColumns(e,...t){const r=new Kl(e,t);this.ensureItIsPossibleToRemoveColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.removeColumns(r);this.undoRedo.saveOperation(new rT(r,n))}moveCells(e,t,r,n){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const{version:i,overwrittenCellsData:a,addedGlobalNamedExpressions:o}=this.operations.moveCells(e,t,r,n);this.undoRedo.saveOperation(new KR(e,t,r,n,a,o,i))}moveRows(e,t,r,n){this.ensureItIsPossibleToMoveRows(e,t,r,n),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const i=this.operations.moveRows(e,t,r,n);this.undoRedo.saveOperation(new JR(e,t,r,n,i))}moveColumns(e,t,r,n){this.ensureItIsPossibleToMoveColumns(e,t,r,n),this.undoRedo.clearRedoStack();const i=this.operations.moveColumns(e,t,r,n);this.undoRedo.saveOperation(new eT(e,t,r,n,i))}cut(e,t,r){this.clipboardOperations.cut(e,t,r)}ensureItIsPossibleToCopy(e,t,r){if(!en(t))throw new Ie("width to be positive integer.");if(!en(r))throw new Ie("height to be positive integer.")}copy(e,t,r){this.ensureItIsPossibleToCopy(e,t,r),this.clipboardOperations.copy(e,t,r)}paste(e){const t=this.clipboardOperations.clipboard;if(t===void 0)throw new yl;if(this.clipboardOperations.isCutClipboard())this.moveCells(t.sourceLeftCorner,t.width,t.height,e);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(e);const r=U.spanFrom(e,t.width,t.height),n=this.operations.getRangeClipboardCells(r);this.undoRedo.clearRedoStack();const i=this.operations.restoreClipboardCells(t.sourceLeftCorner.sheet,t.getContent(e));this.undoRedo.saveOperation(new uT(e,n,t.content,i))}}beginUndoRedoBatchMode(){this.undoRedo.beginBatchMode()}commitUndoRedoBatchMode(){this.undoRedo.commitBatchMode()}isClipboardEmpty(){return this.clipboardOperations.clipboard===void 0}clearClipboard(){this.clipboardOperations.clear()}addSheet(e){e!==void 0&&this.ensureItIsPossibleToAddSheet(e),this.undoRedo.clearRedoStack();const t=this.operations.addSheet(e);return this.undoRedo.saveOperation(new nT(t)),t}removeSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.sheetMapping.fetchDisplayName(e),r=this.operations.getSheetClipboardCells(e),{version:n,scopedNamedExpressions:i}=this.operations.removeSheet(e);this.undoRedo.saveOperation(new sT(t,e,r,i,n))}renameSheet(e,t){this.ensureItIsPossibleToRenameSheet(e,t);const r=this.operations.renameSheet(e,t);return r!==void 0&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new iT(e,r,t))),r}clearSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.operations.getSheetClipboardCells(e);this.operations.clearSheet(e),this.undoRedo.saveOperation(new aT(e,t))}setCellContents(e,t){if(!(t instanceof Array))t=[[t]];else for(let n=0;n<t.length;n++)if(!(t[n]instanceof Array))throw new Ie("an array of arrays or a raw cell value.");this.ensureItIsPossibleToChangeCellContents(e,t),this.undoRedo.clearRedoStack();const r=[];for(let n=0;n<t.length;n++)for(let i=0;i<t[n].length;i++){const a={sheet:e.sheet,row:e.row+n,col:e.col+i},o=t[n][i];this.clipboardOperations.abortCut();const u=this.operations.setCellContent(a,o);r.push({address:a,newContent:o,oldContent:u})}this.undoRedo.saveOperation(new oT(r))}setSheetContent(e,t){this.ensureScopeIdIsValid(e),this.ensureItIsPossibleToChangeSheetContents(e,t),Yl(t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.getSheetClipboardCells(e);this.operations.setSheetContent(e,t),this.undoRedo.saveOperation(new ZR(e,r,t))}setRowOrder(e,t){this.validateSwapRowIndexes(e,t),this.testRowOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setRowOrder(e,t);this.undoRedo.saveOperation(new qR(e,t,r))}validateSwapRowIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new pe(e);this.validateRowOrColumnMapping(e,t,"row")}testColumnOrderForArrays(e,t){for(const[r,n]of t)if(r!==n){const i=U.spanFrom({sheet:e,col:r,row:0},1,1/0);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new dn}}setColumnOrder(e,t){this.validateSwapColumnIndexes(e,t),this.testColumnOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setColumnOrder(e,t);this.undoRedo.saveOperation(new QR(e,t,r))}validateSwapColumnIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new pe(e);this.validateRowOrColumnMapping(e,t,"column")}testRowOrderForArrays(e,t){for(const[r,n]of t)if(r!==n){const i=U.spanFrom({sheet:e,col:0,row:r},1/0,1);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new dn}}mappingFromOrder(e,t,r){if(!this.sheetMapping.hasSheetWithId(e))throw new pe(e);const n=r==="row"?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e);if(t.length!==n)throw new Ie(`number of ${r}s provided to be sheet ${r==="row"?"height":"width"}.`);const i=[];for(let a=0;a<n;a++)t[a]!==a&&i.push([a,t[a]]);return i}undo(){if(this.undoRedo.isUndoStackEmpty())throw new Nl;this.clipboardOperations.abortCut(),this.undoRedo.undo()}redo(){if(this.undoRedo.isRedoStackEmpty())throw new Sl;this.clipboardOperations.abortCut(),this.undoRedo.redo()}addNamedExpression(e,t,r,n){this.ensureItIsPossibleToAddNamedExpression(e,t,r),this.operations.addNamedExpression(e,t,r,n),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new hT(e,t,r,n))}changeNamedExpressionExpression(e,t,r,n){this.ensureItIsPossibleToChangeNamedExpression(e,r,t);const[i,a]=this.operations.changeNamedExpressionExpression(e,r,t,n);this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new cT(i,r,a,t,n))}removeNamedExpression(e,t){this.ensureScopeIdIsValid(t);const[r,n]=this.operations.removeNamedExpression(e,t);return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new lT(r,n,t)),r}ensureItIsPossibleToAddNamedExpression(e,t,r){this.ensureScopeIdIsValid(r),this.ensureNamedExpressionNameIsValid(e,r),this.ensureNamedExpressionIsValid(t)}ensureItIsPossibleToChangeNamedExpression(e,t,r){if(this.ensureScopeIdIsValid(r),this.namedExpressions.namedExpressionForScope(e,r)===void 0)throw new ts(e);this.ensureNamedExpressionIsValid(t)}isItPossibleToRemoveNamedExpression(e,t){if(this.ensureScopeIdIsValid(t),this.namedExpressions.namedExpressionForScope(e,t)===void 0)throw new ts(e)}ensureItIsPossibleToAddRows(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new pe(e);const r=this.dependencyGraph.getSheetHeight(e),n=t.map(i=>i[1]).reduce((i,a)=>i+a,0);if(r+n>this.maxRows)throw new kr;for(const[i,a]of t)if(!Fr(i)||!en(a))throw new Ie("row number to be nonnegative and number of rows to add to be positive.")}ensureItIsPossibleToRemoveRows(e,...t){for(const[r,n]of t){const i=r+n-1;if(!Fr(r)||!Fr(i))throw new Ie("starting and ending row to be nonnegative.");if(i<r)throw new Ie("starting row to be smaller than the ending row.");if(!this.sheetMapping.hasSheetWithId(e))throw new pe(e)}}ensureItIsPossibleToAddColumns(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new pe(e);const r=this.dependencyGraph.getSheetWidth(e),n=t.map(i=>i[1]).reduce((i,a)=>i+a,0);if(r+n>this.maxColumns)throw new kr;for(const[i,a]of t)if(!Fr(i)||!en(a))throw new Ie("column number to be nonnegative and number of columns to add to be positive.")}ensureItIsPossibleToRemoveColumns(e,...t){for(const[r,n]of t){const i=r+n-1;if(!Fr(r)||!Fr(i))throw new Ie("starting and ending column to be nonnegative.");if(i<r)throw new Ie("starting column to be smaller than the ending column.");if(!this.sheetMapping.hasSheetWithId(e))throw new pe(e)}}ensureItIsPossibleToMoveRows(e,t,r,n){this.ensureItIsPossibleToAddRows(e,[n,r]);const i=M(e,0,t),a=M(e,0,n);if(!this.sheetMapping.hasSheetWithId(e)||et(i)||et(a)||!en(r)||n<=t+r&&n>=t)throw new Ie("a valid range of rows to move.");const o=this.dependencyGraph.getSheetWidth(e),u=U.spanFrom(i,o,r);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(u))throw new dn;if(n>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllRows(tt.fromNumberOfRows(e,n-1,2)))throw new ui}ensureItIsPossibleToMoveColumns(e,t,r,n){this.ensureItIsPossibleToAddColumns(e,[n,r]);const i=M(e,t,0),a=M(e,n,0);if(!this.sheetMapping.hasSheetWithId(e)||et(i)||et(a)||!en(r)||n<=t+r&&n>=t)throw new Ie("a valid range of columns to move.");const o=this.dependencyGraph.getSheetHeight(e),u=U.spanFrom(i,r,o);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(u))throw new dn;if(n>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllColumns(lt.fromNumberOfColumns(e,n-1,2)))throw new ui}ensureItIsPossibleToAddSheet(e){if(this.sheetMapping.hasSheetWithName(e))throw new Jn(e)}ensureItIsPossibleToRenameSheet(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new pe(e);const r=this.sheetMapping.get(t);if(r!==void 0&&r!==e)throw new Jn(t)}ensureItIsPossibleToChangeContent(e){if(et(e))throw new El(e);if(!this.sheetMapping.hasSheetWithId(e.sheet))throw new pe(e.sheet)}ensureItIsPossibleToChangeCellContents(e,t){const r=fi(t),n=U.spanFrom(e,r.width,r.height);this.ensureRangeInSizeLimits(n);for(const i of n.addresses(this.dependencyGraph))this.ensureItIsPossibleToChangeContent(i)}ensureItIsPossibleToChangeSheetContents(e,t){const r=fi(t),n=U.spanFrom(M(e,0,0),r.width,r.height);this.ensureRangeInSizeLimits(n)}ensureRangeInSizeLimits(e){if(e.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new kr}isThereSomethingToUndo(){return!this.undoRedo.isUndoStackEmpty()}isThereSomethingToRedo(){return!this.undoRedo.isRedoStackEmpty()}getAndClearContentChanges(){return this.operations.getAndClearContentChanges()}ensureScopeIdIsValid(e){if(e!==void 0&&!this.sheetMapping.hasSheetWithId(e))throw new pe(e)}validateRowOrColumnMapping(e,t,r){const n=r==="row"?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e),i=t.map(([o,u])=>o).sort((o,u)=>o-u),a=t.map(([o,u])=>u).sort((o,u)=>o-u);for(let o=0;o<i.length;o++){if(!Fr(i[o])||i[o]>=n)throw new Ie(`${r} numbers to be nonnegative integers and less than sheet ${r==="row"?"height":"width"}.`);if(i[o]===i[o+1])throw new Ie(`source ${r} numbers to be unique.`);if(i[o]!==a[o])throw new Ie(`target ${r} numbers to be permutation of source ${r} numbers.`)}}ensureNamedExpressionNameIsValid(e,t){if(!this.namedExpressions.isNameValid(e))throw new Tl(e);if(!this.namedExpressions.isNameAvailable(e,t))throw new Rl(e)}ensureNamedExpressionIsValid(e){const t=this.cellContentParser.parse(e);if(t instanceof ce.Formula){const r=this.parser.parse(t.formula,M(-1,0,0));if(gr(r.ast))throw new uo}}}function en(s){return Number.isInteger(s)&&s>0}function Fr(s){return Number.isInteger(s)&&s>=0}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mT{constructor(e,t,r,n,i,a){this.config=e,this.stats=t,this.interpreter=r,this.lazilyTransformingAstService=n,this.dependencyGraph=i,this.columnSearch=a}run(){this.stats.start(D.TOP_SORT);const{sorted:e,cycled:t}=this.dependencyGraph.topSortWithScc();this.stats.end(D.TOP_SORT),this.stats.measure(D.EVALUATION,()=>{this.recomputeFormulas(t,e)})}partialRun(e){const t=Sr.empty();return this.stats.measure(D.EVALUATION,()=>{this.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(e,r=>{if(r instanceof ct){const n=r.isComputed()?r.getCellValue():void 0,i=this.recomputeFormulaVertexValue(r);if(i!==n){const a=r.getAddress(this.lazilyTransformingAstService);return t.addChange(i,a),this.columnSearch.change(O(n),O(i),a),!0}return!1}else return r instanceof He&&r.clearCache(),!0},r=>{if(r instanceof He)r.clearCache();else if(r instanceof ct){const n=r.getAddress(this.lazilyTransformingAstService);this.columnSearch.remove(O(r.valueOrUndef()),n);const i=new p(m.CYCLE,void 0,r);r.setCellValue(i),t.addChange(i,n)}})}),t}runAndForget(e,t,r){const n=[];for(const a of Ht(r,t))if(a instanceof U){const o=a;if(this.dependencyGraph.getRange(o.start,o.end)===void 0){const u=new He(o);this.dependencyGraph.rangeMapping.setRange(u),n.push(u)}}const i=this.evaluateAstToCellValue(e,new zt(t,this.config.useArrayArithmetic));return n.forEach(a=>{this.dependencyGraph.rangeMapping.removeRange(a)}),i}recomputeFormulas(e,t){e.forEach(r=>{r instanceof ct&&r.setCellValue(new p(m.CYCLE,void 0,r))}),t.forEach(r=>{if(r instanceof ct){const n=this.recomputeFormulaVertexValue(r),i=r.getAddress(this.lazilyTransformingAstService);this.columnSearch.add(O(n),i)}else r instanceof He&&r.clearCache()})}recomputeFormulaVertexValue(e){const t=e.getAddress(this.lazilyTransformingAstService);if(e instanceof ye&&(e.array.size.isRef||!this.dependencyGraph.isThereSpaceForArray(e)))return e.setNoSpace();{const r=e.getFormula(this.lazilyTransformingAstService),n=this.evaluateAstToCellValue(r,new zt(t,this.config.useArrayArithmetic,e));return e.setCellValue(n)}}evaluateAstToCellValue(e,t){const r=this.interpreter.evaluateAst(e,t);return r instanceof w?r:r===G&&this.config.evaluateNullToZero?0:r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class wa{constructor(e,t){this.address=e,this.newValue=t}get col(){return this.address.col}get row(){return this.address.row}get sheet(){return this.address.sheet}get value(){return this.newValue}}class jl{constructor(e,t){this.name=e,this.newValue=t}}class gT{constructor(e,t,r,n){this.config=e,this.namedExpressions=t,this.sheetIndexMapping=r,this.lazilyTransformingService=n}exportChange(e){const t=e.value,r=e.address;if(r.sheet===zr.SHEET_FOR_WORKBOOK_EXPRESSIONS){const n=this.namedExpressions.namedExpressionInAddress(r.row);if(!n)throw new Error("Missing named expression");return new jl(n.displayName,this.exportScalarOrRange(t))}else if(t instanceof w){const n=[];for(const[i,a]of t.entriesFromTopLeftCorner(r))n.push(new wa(a,this.exportValue(i)));return n}else return new wa(r,this.exportValue(t))}exportValue(e){return e instanceof w?this.detailedError(new p(m.VALUE,T.ScalarExpected)):this.config.smartRounding&&j(e)?this.cellValueRounding(O(e)):e instanceof p?this.detailedError(e):e===G?null:O(e)}exportScalarOrRange(e){return e instanceof w?e.rawData().map(t=>t.map(r=>this.exportValue(r))):this.exportValue(e)}detailedError(e){var t,r;let n;const i=(t=e.root)===null||t===void 0?void 0:t.getAddress(this.lazilyTransformingService);return i!==void 0&&(i.sheet===zr.SHEET_FOR_WORKBOOK_EXPRESSIONS?n=(r=this.namedExpressions.namedExpressionInAddress(i.row))===null||r===void 0?void 0:r.displayName:n=js(this.sheetIndexMapping,i,-1)),new Dl(e,this.config.translationPackage.getErrorTranslation(e.type),n)}cellValueRounding(e){if(e===0)return e;const t=Math.floor(Math.log10(Math.abs(e))),r=Math.pow(10,this.config.precisionRounding-t);return e<0?-Math.round(-e*r)/r:Math.round(e*r)/r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ET{constructor(e,t,r,n,i,a){this.dependencyGraph=e,this.columnSearch=t,this.parser=r,this.cellContentParser=n,this.stats=i,this.arraySizePredictor=a,this.buildStrategy=new RT(e,t,r,i,n,a)}buildGraph(e,t){const r=t.measure(D.COLLECT_DEPENDENCIES,()=>this.buildStrategy.run(e));this.dependencyGraph.getAndClearContentChanges(),t.measure(D.PROCESS_DEPENDENCIES,()=>this.processDependencies(r))}processDependencies(e){e.forEach((t,r)=>{this.dependencyGraph.processCellDependencies(t,r)})}}class RT{constructor(e,t,r,n,i,a){this.dependencyGraph=e,this.columnIndex=t,this.parser=r,this.stats=n,this.cellContentParser=i,this.arraySizePredictor=a}run(e){const t=new Map;for(const r in e){const n=this.dependencyGraph.getSheetId(r),i=e[r];for(let a=0;a<i.length;++a){const o=i[a];for(let u=0;u<o.length;++u){const l=o[u],c=M(n,u,a),d=this.cellContentParser.parse(l);if(d instanceof ce.Formula){const f=this.stats.measure(D.PARSER,()=>this.parser.parse(d.formula,c));if(f.errors.length>0){this.shrinkArrayIfNeeded(c);const E=new gn(f.errors,d.formula);this.dependencyGraph.addVertex(c,E)}else{this.shrinkArrayIfNeeded(c);const E=this.arraySizePredictor.checkArraySize(f.ast,c);if(E.isScalar()){const N=new Wt(f.ast,c,0);t.set(N,Ht(f.dependencies,c)),this.dependencyGraph.addVertex(c,N),f.hasVolatileFunction&&this.dependencyGraph.markAsVolatile(N),f.hasStructuralChangeFunction&&this.dependencyGraph.markAsDependentOnStructureChange(N)}else{const N=new ye(f.ast,c,new B(E.width,E.height));t.set(N,Ht(f.dependencies,c)),this.dependencyGraph.addArrayVertex(c,N)}}}else if(!(d instanceof ce.Empty)){this.shrinkArrayIfNeeded(c);const f=new yr(d.value,l);this.columnIndex.add(O(d.value),c),this.dependencyGraph.addVertex(c,f)}}}}return t}shrinkArrayIfNeeded(e){const t=this.dependencyGraph.getCell(e);t instanceof ye&&this.dependencyGraph.shrinkArrayToCorner(t)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const vs=new Map([["gpl-v3",1],["missing",2],["invalid",3],["expired",4]]);class ql extends V{version(e,t){return this.runFunction(e.args,t,this.metadata("VERSION"),()=>{const{licenseKeyValidityState:r,licenseKey:n}=this.config;let i;return vs.has(n)?i=vs.get(n):vs.has(r)?i=vs.get(r):r==="valid"&&(i=n.slice(-5)),`HyperFormula v${Pe.version}, ${i}`})}}ql.implementedFunctions={VERSION:{method:"version",parameters:[]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Qi(s,e){var t;let r=e.implementedFunctions[s];const n=(t=e.aliases)===null||t===void 0?void 0:t[s];if(n!==void 0){if(r!==void 0)throw new CE(s,e.name);r=e.implementedFunctions[n]}if(r===void 0)throw Sn.functionNotDeclaredInPlugin(s,e.name);return r}class Me{constructor(e){if(this.config=e,this.functions=new Map,this.arraySizeFunctions=new Map,this.volatileFunctions=new Set,this.arrayFunctions=new Set,this.structuralChangeFunctions=new Set,this.functionsWhichDoesNotNeedArgumentsToBeComputed=new Set,this.functionsMetadata=new Map,this.doesFunctionNeedArgumentToBeComputed=t=>this.functionsWhichDoesNotNeedArgumentsToBeComputed.has(t),this.isFunctionVolatile=t=>this.volatileFunctions.has(t),this.isArrayFunction=t=>this.arrayFunctions.has(t),this.isFunctionDependentOnSheetStructureChange=t=>this.structuralChangeFunctions.has(t),e.functionPlugins.length>0){this.instancePlugins=new Map;for(const t of e.functionPlugins)Me.loadPluginFunctions(t,this.instancePlugins)}else this.instancePlugins=new Map(Me.plugins);for(const[t,r]of Me.protectedFunctions())Me.loadFunctionUnprotected(r,t,this.instancePlugins);for(const[t,r]of this.instancePlugins.entries())this.categorizeFunction(t,Qi(t,r))}static registerFunctionPlugin(e,t){this.loadPluginFunctions(e,this.plugins),t!==void 0&&this.loadTranslations(t)}static registerFunction(e,t,r){this.loadPluginFunction(t,e,this.plugins),r!==void 0&&this.loadTranslations(r)}static unregisterFunction(e){if(this.functionIsProtected(e))throw Gr.cannotUnregisterFunctionWithId(e);this.plugins.delete(e)}static unregisterFunctionPlugin(e){for(const t of this.protectedPlugins())if(t===e)throw Gr.cannotUnregisterProtectedPlugin();for(const[t,r]of this.plugins.entries())r===e&&this.plugins.delete(t)}static unregisterAll(){this.plugins.clear()}static getRegisteredFunctionIds(){return[...Array.from(this.plugins.keys()),...Array.from(this._protectedPlugins.keys())]}static getPlugins(){return Array.from(new Set(this.plugins.values()).values())}static getFunctionPlugin(e){if(!this.functionIsProtected(e))return this.plugins.get(e)}static functionIsProtected(e){return this._protectedPlugins.has(e)}static loadTranslations(e){const t=new Set(Pe.getRegisteredLanguagesCodes());Object.keys(e).forEach(r=>{t.has(r)&&Pe.getLanguage(r).extendFunctions(e[r])})}static loadPluginFunctions(e,t){Object.keys(e.implementedFunctions).forEach(r=>{this.loadPluginFunction(e,r,t)}),e.aliases!==void 0&&Object.keys(e.aliases).forEach(r=>{this.loadPluginFunction(e,r,t)})}static loadPluginFunction(e,t,r){if(this.functionIsProtected(t))throw Gr.cannotRegisterFunctionWithId(t);this.loadFunctionUnprotected(e,t,r)}static handleDeprecatedMetadata(e,t){t&&t.arrayFunction!==void 0&&(console.warn(`${e}: 'arrayFunction' parameter is deprecated since 3.1.0; Use 'enableArrayArithmeticForArguments' instead.`),t.enableArrayArithmeticForArguments=t.arrayFunction),t&&t.arraySizeMethod!==void 0&&(console.warn(`${e}: 'arraySizeMethod' parameter is deprecated since 3.1.0; Use 'sizeOfResultArrayMethod' instead.`),t.sizeOfResultArrayMethod=t.arraySizeMethod)}static loadFunctionUnprotected(e,t,r){const n=Qi(t,e),i=n.method;if(this.handleDeprecatedMetadata(t,n),Object.prototype.hasOwnProperty.call(e.prototype,i))r.set(t,e);else throw Sn.functionMethodNotFound(i,e.name)}static*protectedFunctions(){for(const[e,t]of this._protectedPlugins)t!==void 0&&(yield[e,t])}static*protectedPlugins(){for(const[,e]of this._protectedPlugins)e!==void 0&&(yield e)}initializePlugins(e){const t=[];for(const[r,n]of this.instancePlugins.entries()){let i=t.find(l=>l instanceof n);i===void 0&&(i=new n(e),t.push(i));const a=Qi(r,n),o=a.method;this.functions.set(r,[o,i]);const u=a.sizeOfResultArrayMethod;u!==void 0&&this.arraySizeFunctions.set(r,[u,i])}}getFunctionPlugin(e){if(!Me.functionIsProtected(e))return this.instancePlugins.get(e)}getFunction(e){const t=this.functions.get(e);if(t!==void 0&&this.config.translationPackage.isFunctionTranslated(e)){const[r,n]=t;return(i,a)=>n[r](i,a)}else return}getArraySizeFunction(e){const t=this.arraySizeFunctions.get(e);if(t!==void 0&&this.config.translationPackage.isFunctionTranslated(e)){const[r,n]=t;return(i,a)=>n[r](i,a)}else return}getMetadata(e){return this.functionsMetadata.get(e)}getPlugins(){const e=new Set;for(const[t,r]of this.instancePlugins)Me.functionIsProtected(t)||e.add(r);return Array.from(e)}getRegisteredFunctionIds(){return Array.from(this.functions.keys())}categorizeFunction(e,t){t.isVolatile&&this.volatileFunctions.add(e),t.enableArrayArithmeticForArguments&&this.arrayFunctions.add(e),t.doesNotNeedArgumentsToBeComputed&&this.functionsWhichDoesNotNeedArgumentsToBeComputed.add(e),t.isDependentOnSheetStructureChange&&this.structuralChangeFunctions.add(e),this.functionsMetadata.set(e,t)}}Me.plugins=new Map;Me._protectedPlugins=new Map([["VERSION",ql],["OFFSET",void 0]]);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Ue;(function(s){s.GREATER_THAN="GREATER_THAN",s.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",s.LESS_THAN="LESS_THAN",s.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",s.NOT_EQUAL="NOT_EQUAL",s.EQUAL="EQUAL"})(Ue||(Ue={}));const Is=(s,e)=>({operator:s,value:e});class TT{constructor(e){var t,r,n,i;this.trueString=(r=(t=e.translationPackage.getMaybeFunctionTranslation("TRUE"))===null||t===void 0?void 0:t.toLowerCase())!==null&&r!==void 0?r:"true",this.falseString=(i=(n=e.translationPackage.getMaybeFunctionTranslation("FALSE"))===null||n===void 0?void 0:n.toLowerCase())!==null&&i!==void 0?i:"false"}fromCellValue(e,t){if(typeof e!="string"&&typeof e!="boolean"&&typeof e!="number")return;const r=this.parseCriterion(e,t);if(r!==void 0)return{raw:e,lambda:yT(r,t)}}parseCriterion(e,t){if(typeof e=="number"||typeof e=="boolean")return Is(Ue.EQUAL,e);if(typeof e=="string"){const r=NT.exec(e);let n,i;r?(i=ST(r[1]),n=r[2]):(i=Ue.EQUAL,n=e);const a=t.coerceToMaybeNumber(n),o=n.toLowerCase()===this.trueString?!0:n.toLowerCase()===this.falseString?!1:void 0;if(i===void 0)return;if(n==="")return Is(i,null);if(a===void 0){if(i===Ue.EQUAL||i===Ue.NOT_EQUAL)return Is(i,o??n)}else return Is(i,O(a))}}}const NT=/([<>=]+)(.*)/;function ST(s){switch(s){case">":return Ue.GREATER_THAN;case">=":return Ue.GREATER_THAN_OR_EQUAL;case"<":return Ue.LESS_THAN;case"<=":return Ue.LESS_THAN_OR_EQUAL;case"<>":return Ue.NOT_EQUAL;case"=":return Ue.EQUAL;default:return}}const yT=(s,e)=>{switch(s.operator){case Ue.GREATER_THAN:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)>0:t=>!1;case Ue.GREATER_THAN_OR_EQUAL:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)>=0:t=>!1;case Ue.LESS_THAN:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)<0:t=>!1;case Ue.LESS_THAN_OR_EQUAL:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)<=0:t=>!1;case Ue.EQUAL:return typeof s.value=="number"?t=>{if(typeof t=="number")return e.floatCmp(t,s.value)===0;if(typeof t=="string"){if(t==="")return!1;const r=e.coerceToMaybeNumber(t);return r===void 0?!1:e.floatCmp(r,s.value)===0}else return!1}:typeof s.value=="string"?e.eqMatcherFunction(s.value):typeof s.value=="boolean"?t=>typeof t=="boolean"&&t===s.value:t=>t===G;case Ue.NOT_EQUAL:return typeof s.value=="number"?t=>{if(typeof t=="number")return e.floatCmp(t,s.value)!==0;if(typeof t=="string"){if(t==="")return!0;const r=e.coerceToMaybeNumber(t);return r===void 0?!0:e.floatCmp(r,s.value)!==0}else return!0}:typeof s.value=="string"?e.neqMatcherFunction(s.value):typeof s.value=="boolean"?t=>typeof t!="boolean"||t!==s.value:t=>t!==G}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class AT{constructor(e,t,r,n,i,a,o,u,l,c){this.config=e,this.dependencyGraph=t,this.columnSearch=r,this.stats=n,this.arithmeticHelper=i,this.functionRegistry=a,this.namedExpressions=o,this.serialization=u,this.arraySizePredictor=l,this.dateTimeHelper=c,this.equalOp=(d,f)=>Rt(this.arithmeticHelper.eq,d,f),this.notEqualOp=(d,f)=>Rt(this.arithmeticHelper.neq,d,f),this.greaterThanOp=(d,f)=>Rt(this.arithmeticHelper.gt,d,f),this.lessThanOp=(d,f)=>Rt(this.arithmeticHelper.lt,d,f),this.greaterThanOrEqualOp=(d,f)=>Rt(this.arithmeticHelper.geq,d,f),this.lessThanOrEqualOp=(d,f)=>Rt(this.arithmeticHelper.leq,d,f),this.concatOp=(d,f)=>Rt(this.arithmeticHelper.concat,ya(d),ya(f)),this.plusOp=(d,f)=>Rt(this.arithmeticHelper.addWithEpsilon,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.minusOp=(d,f)=>Rt(this.arithmeticHelper.subtract,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.timesOp=(d,f)=>Rt(this.arithmeticHelper.multiply,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.powerOp=(d,f)=>Rt(this.arithmeticHelper.pow,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.divOp=(d,f)=>Rt(this.arithmeticHelper.divide,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.unaryMinusOp=d=>Au(this.arithmeticHelper.unaryMinus,this.arithmeticHelper.coerceScalarToNumberOrError(d)),this.percentOp=d=>Au(this.arithmeticHelper.unaryPercent,this.arithmeticHelper.coerceScalarToNumberOrError(d)),this.unaryPlusOp=d=>this.arithmeticHelper.unaryPlus(d),this.functionRegistry.initializePlugins(this),this.criterionBuilder=new TT(e)}evaluateAst(e,t){let r=this.evaluateAstWithoutPostprocessing(e,t);if(j(r)){if(bl(O(r)))return new p(m.NUM,T.NaN);r=so(r,xl(O(r)))}return r instanceof w&&r.height()===1&&r.width()===1&&([[r]]=r.data),CT(r,t.formulaVertex)}evaluateAstWithoutPostprocessing(e,t){switch(e.type){case g.EMPTY:return G;case g.CELL_REFERENCE:{const r=e.reference.toSimpleCellAddress(t.formulaAddress);return et(r)?new p(m.REF,T.BadRef):this.dependencyGraph.getCellValue(r)}case g.NUMBER:case g.STRING:return e.value;case g.CONCATENATE_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.concatOp,r,n,t)}case g.EQUALS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.equalOp,r,n,t)}case g.NOT_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.notEqualOp,r,n,t)}case g.GREATER_THAN_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOp,r,n,t)}case g.LESS_THAN_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOp,r,n,t)}case g.GREATER_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOrEqualOp,r,n,t)}case g.LESS_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOrEqualOp,r,n,t)}case g.PLUS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.plusOp,r,n,t)}case g.MINUS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.minusOp,r,n,t)}case g.TIMES_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.timesOp,r,n,t)}case g.POWER_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.powerOp,r,n,t)}case g.DIV_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.divOp,r,n,t)}case g.PLUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryPlusOp,r,t)}case g.MINUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryMinusOp,r,t)}case g.PERCENT_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.percentOp,r,t)}case g.FUNCTION_CALL:{if(this.config.licenseKeyValidityState!=="valid"&&!Me.functionIsProtected(e.procedureName))return new p(m.LIC,T.LicenseKey(this.config.licenseKeyValidityState));const r=this.functionRegistry.getFunction(e.procedureName);return r!==void 0?r(e,new zt(t.formulaAddress,t.arraysFlag||this.functionRegistry.isArrayFunction(e.procedureName),t.formulaVertex)):new p(m.NAME,T.FunctionName(e.procedureName))}case g.NAMED_EXPRESSION:{const r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.formulaAddress.sheet);return r?this.dependencyGraph.getCellValue(r.address):new p(m.NAME,T.NamedExpressionName(e.expressionName))}case g.CELL_RANGE:{if(!this.rangeSpansOneSheet(e))return new p(m.REF,T.RangeManySheets);const r=U.fromCellRange(e,t.formulaAddress),n=this.dependencyGraph.getArray(r);if(n){const i=n.array;if(i instanceof Dn)throw new Error("Array should be already computed");if(i instanceof p)return i;if(i instanceof yn)return w.fromRange(i.raw(),r,this.dependencyGraph);throw new Error("Unknown array")}else return w.onlyRange(r,this.dependencyGraph)}case g.COLUMN_RANGE:{if(!this.rangeSpansOneSheet(e))return new p(m.REF,T.RangeManySheets);const r=sr.fromColumnRange(e,t.formulaAddress);return w.onlyRange(r,this.dependencyGraph)}case g.ROW_RANGE:{if(!this.rangeSpansOneSheet(e))return new p(m.REF,T.RangeManySheets);const r=ir.fromRowRangeAst(e,t.formulaAddress);return w.onlyRange(r,this.dependencyGraph)}case g.PARENTHESIS:return this.evaluateAst(e.expression,t);case g.ARRAY:{let r;const n=[];for(const i of e.args){let a;const o=[];for(const l of i){const c=Fl(this.evaluateAst(l,t)),d=c.height();if(a===void 0)a=d,o.push(...c.data);else if(a===d)for(let f=0;f<d;f++)o[f].push(...c.data[f]);else return new p(m.REF,T.SizeMismatch)}const u=o[0].length;if(r===void 0)r=u,n.push(...o);else if(r===u)n.push(...o);else return new p(m.REF,T.SizeMismatch)}return w.onlyValues(n)}case g.ERROR_WITH_RAW_INPUT:case g.ERROR:return e.error}}rangeSpansOneSheet(e){return e.start.sheet===e.end.sheet}unaryRangeWrapper(e,t,r){var n;if(t instanceof w&&!r.arraysFlag&&(t=(n=Ws(t,r))!==null&&n!==void 0?n:new p(m.VALUE,T.ScalarExpected)),t instanceof p)return t;if(t instanceof w){const i=t.data.map(a=>a.map(e));return w.onlyValues(i)}return e(t)}binaryRangeWrapper(e,t,r,n){var i,a;if(t instanceof w&&!n.arraysFlag&&(t=(i=Ws(t,n))!==null&&i!==void 0?i:new p(m.VALUE,T.ScalarExpected)),t instanceof p)return t;if(r instanceof w&&!n.arraysFlag&&(r=(a=Ws(r,n))!==null&&a!==void 0?a:new p(m.VALUE,T.ScalarExpected)),r instanceof p)return r;if(t instanceof w||r instanceof w){if(!(t instanceof w))if(r.isAdHoc()){const c=r.data;for(let d=0;d<c.length;d++)for(let f=0;f<c[0].length;f++)c[d][f]=e(t,c[d][f]);return w.onlyValues(c)}else t=w.fromScalar(t);if(!(r instanceof w))if(t.isAdHoc()){const c=t.data;for(let d=0;d<c.length;d++)for(let f=0;f<c[0].length;f++)c[d][f]=e(c[d][f],r);return w.onlyValues(c)}else r=w.fromScalar(r);if(t.width()===r.width()&&t.height()===r.height()){if(t.isAdHoc()){const c=t.data,d=r.data;for(let f=0;f<c.length;f++)for(let E=0;E<c[0].length;E++)c[f][E]=e(c[f][E],d[f][E]);return w.onlyValues(c)}if(r.isAdHoc()){const c=t.data,d=r.data;for(let f=0;f<c.length;f++)for(let E=0;E<c[0].length;E++)d[f][E]=e(c[f][E],d[f][E]);return w.onlyValues(d)}}const o=Math.max(t.width(),r.width()),u=Math.max(t.height(),r.height()),l=Array(u);for(let c=0;c<u;c++)l[c]=Array(o);for(let c=0;c<u;c++){const d=t.height()!==1?c:0,f=r.height()!==1?c:0;for(let E=0;E<o;E++){const N=t.width()!==1?E:0,R=r.width()!==1?E:0;d<t.height()&&f<r.height()&&N<t.width()&&R<r.width()?l[c][E]=e(t.data[d][N],r.data[f][R]):l[c][E]=new p(m.NA)}}return w.onlyValues(l)}return e(t,r)}}function Au(s,e){return e instanceof p?e:s(e)}function Rt(s,e,t){return e instanceof p?e:t instanceof p?t:s(e,t)}function CT(s,e){return s instanceof p&&e!==void 0?s.attachRootVertex(e):s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class vT{constructor(e){this.sheet=e,this.transformations=[]}add(e){this.transformations.push(e)}performEagerTransformations(e,t){this.transformations.forEach(r=>r.performEagerTransformations(e,t))}transformSingleAst(e,t){let[r,n]=[e,t];return this.transformations.forEach(i=>{[r,n]=i.transformSingleAst(r,n)}),[r,n]}isIrreversible(){return!0}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class IT{constructor(e){this.stats=e,this.transformations=[]}version(){return this.transformations.length}addTransformation(e){return this.combinedTransformer!==void 0?this.combinedTransformer.add(e):this.transformations.push(e),this.version()}beginCombinedMode(e){this.combinedTransformer=new vT(e)}commitCombinedMode(){if(this.combinedTransformer===void 0)throw Error("Combined mode wasn't started");return this.transformations.push(this.combinedTransformer),this.combinedTransformer=void 0,this.version()}applyTransformations(e,t,r){this.stats.start(D.TRANSFORM_ASTS_POSTPONED);for(let i=r;i<this.transformations.length;i++){const a=this.transformations[i];a.isIrreversible()&&(this.undoRedo.storeDataForVersion(i,t,this.parser.computeHashFromAst(e)),this.parser.rememberNewAst(e));const[o,u]=a.transformSingleAst(e,t);e=o,t=u}const n=this.parser.rememberNewAst(e);return this.stats.end(D.TRANSFORM_ASTS_POSTPONED),[n,t,this.transformations.length]}*getTransformationsFrom(e,t){for(let r=e;r<this.transformations.length;r++){const n=this.transformations[r];(!t||t(n))&&(yield n)}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Bt=-1;function OT(s,e,{searchCoordinate:t,orderingDirection:r,ifNoMatch:n},i){const a=e.start[t],o=t==="col"?e.effectiveEndColumn(i):e.effectiveEndRow(i),u=t==="col"?f=>O(i.getCellValue(M(e.sheet,f,e.start.row))):f=>O(i.getCellValue(M(e.sheet,e.start.col,f))),l=r==="asc"?(f,E)=>Ri(f,E):(f,E)=>-Ri(f,E),c=MT(f=>l(s,u(f))>=0,a,o),d=u(c);if(d===s)return c-a;if(n==="returnLowerBound"){if(c===Bt)return r==="asc"?Bt:0;if(typeof d!=typeof s)return Bt;if(r==="asc")return c-a;const f=c+1;return f<=o?f-a:Bt}if(n==="returnUpperBound"){if(c===Bt)return r==="asc"?0:Bt;if(typeof d!=typeof s)return Bt;if(r==="desc")return c-a;const f=c+1;return f<=o?f-a:Bt}return Bt}function MT(s,e,t){let r=e,n=t;for(;r<n;){const i=Math.ceil((r+n)/2);s(i)?r=i:n=i-1}return r===n&&s(r)?r:Bt}function Ri(s,e){return typeof s==typeof e?s===G?0:s<e?-1:s>e?1:0:s===G?-1:e===G?1:e instanceof p||typeof s=="number"&&typeof e=="string"||typeof s=="number"&&typeof e=="boolean"?-1:typeof s=="string"&&typeof e=="number"?1:typeof s=="string"&&typeof e=="boolean"?-1:1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Cu=-1;class Ql{constructor(e){this.dependencyGraph=e}advancedFind(e,t,{returnOccurrence:r}={returnOccurrence:"first"}){const n=t.range,i=n===void 0?t.valuesFromTopLeftCorner():this.dependencyGraph.computeListOfValuesInRange(n),a=r==="first"?0:i.length-1,o=r==="first"?l=>l<i.length:l=>l>=0,u=r==="first"?l=>l+1:l=>l-1;for(let l=a;o(l);l=u(l))if(e(O(i[l])))return l;return Cu}basicFind(e,t,r,{ordering:n,ifNoMatch:i,returnOccurrence:a}){const o=typeof e=="string"?$n(e):e,u=t.range;return u===void 0?this.findNormalizedValue(o,t.valuesFromTopLeftCorner(),i,a):n==="none"?this.findNormalizedValue(o,this.dependencyGraph.computeListOfValuesInRange(u),i,a):OT(o,u,{searchCoordinate:r,orderingDirection:n,ifNoMatch:i},this.dependencyGraph)}findNormalizedValue(e,t,r="returnNotFound",n="first"){const i=t.map(O).map(f=>typeof f=="string"?$n(f):f);if(r==="returnNotFound")return n==="first"?i.indexOf(e):i.lastIndexOf(e);const a=r==="returnLowerBound"?(f,E)=>Ri(f,E):(f,E)=>-Ri(f,E);let o=r==="returnLowerBound"?-1/0:1/0,u=Cu;const l=n==="first"?0:i.length-1,c=n==="first"?f=>f<i.length:f=>f>=0,d=n==="first"?f=>f+1:f=>f-1;for(let f=l;c(f);f=d(f)){const E=i[f];if(E===e)return f;a(E,e)>0||a(o,E)<0&&(o=E,u=f)}return u}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Zl extends Ql{constructor(e){super(e),this.dependencyGraph=e}add(e,t){}remove(e,t){}change(e,t,r){}applyChanges(e){}addColumns(e){}removeColumns(e){}removeSheet(e){}moveValues(e,t,r,n){}removeValues(e){}find(e,t,r){return this.basicFind(e,t,"row",r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Vr{constructor(e,t,r){this.dependencyGraph=e,this.config=t,this.stats=r,this.index=new Map,this.transformingService=this.dependencyGraph.lazilyTransformingAstService,this.binarySearchStrategy=new Zl(e)}add(e,t){if(!(e===G||e instanceof p))if(e instanceof w)for(const[r,n]of e.entriesFromTopLeftCorner(t))this.addSingleCellValue(O(r),n);else this.addSingleCellValue(e,t)}remove(e,t){if(e!==void 0)if(e instanceof w)for(const[r,n]of e.entriesFromTopLeftCorner(t))this.removeSingleValue(O(r),n);else this.removeSingleValue(e,t)}change(e,t,r){e!==t&&(this.remove(e,r),this.add(t,r))}applyChanges(e){for(const t of e)t.oldValue!==void 0&&this.change(O(t.oldValue),O(t.value),t.address)}moveValues(e,t,r,n){for(const[i,a]of e){const o=$E(a,n,t,r);this.remove(i,a),this.add(i,o)}}removeValues(e){for(const[t,r]of e)this.remove(t,r)}find(e,t,{ordering:r,ifNoMatch:n,returnOccurrence:i}){i==null&&(i=r==="none"?"first":"last");const a=this.findUsingColumnIndex(e,t,i);return a!==void 0?a:this.binarySearchStrategy.find(e,t,{ordering:r,ifNoMatch:n,returnOccurrence:i})}findUsingColumnIndex(e,t,r){const n=t.range;if(n===void 0)return;this.ensureRecentData(n.sheet,n.start.col,e);const i=this.getColumnMap(n.sheet,n.start.col);if(!i)return-1;const a=typeof e=="string"?$n(e):e,o=i.get(a);if(!o||!o.index||o.index.length===0)return;const u=Vr.findRowBelongingToRange(o,n,r);return u!==void 0?u-n.start.row:void 0}static findRowBelongingToRange(e,t,r){const n=t.start.row,i=t.end.row,a=r==="first"?Ur(n,e.index,"upperBound"):Ur(i,e.index,"lowerBound");if(a===-1)return;const o=e.index[a];return o>=n&&o<=i?o:void 0}advancedFind(e,t,r={returnOccurrence:"first"}){return this.binarySearchStrategy.advancedFind(e,t,r)}addColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,0,...Array(e.numberOfColumns))}removeColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,e.numberOfColumns)}removeSheet(e){this.index.delete(e)}getColumnMap(e,t){this.index.has(e)||this.index.set(e,[]);const r=this.index.get(e);let n=r[t];return n||(n=new Map,r[t]=n),n}getValueIndex(e,t,r){const n=this.getColumnMap(e,t);let i=this.getColumnMap(e,t).get(r);return i||(i={version:this.transformingService.version(),index:[]},n.set(r,i)),i}ensureRecentData(e,t,r){const n=this.getValueIndex(e,t,r),i=this.transformingService.version();if(n.version===i)return;const a=this.transformingService.getTransformationsFrom(n.version,o=>o.sheet===e&&(o instanceof Oa||o instanceof Ma));for(const o of a)o instanceof Oa?this.addRows(t,o.rowsSpan,r):o instanceof Ma&&this.removeRows(t,o.rowsSpan,r);n.version=i}addSingleCellValue(e,t){this.stats.measure(D.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e),typeof e=="string"&&(e=$n(e));const r=this.getValueIndex(t.sheet,t.col,e);Vr.addValue(r,t.row)})}removeSingleValue(e,t){this.stats.measure(D.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e);const r=this.getColumnMap(t.sheet,t.col);typeof e=="string"&&(e=$n(e));const n=r.get(e);if(!n)return;const i=Ur(t.row,n.index);i>-1&&n.index.splice(i,1),n.index.length===0&&r.delete(e),r.size===0&&delete this.index.get(t.sheet)[t.col]})}addRows(e,t,r){const n=this.getValueIndex(t.sheet,e,r);Vr.shiftRows(n,t.rowStart,t.numberOfRows)}removeRows(e,t,r){const n=this.getValueIndex(t.sheet,e,r);Vr.removeRowsFromValues(n,t),Vr.shiftRows(n,t.rowEnd+1,-t.numberOfRows)}static addValue(e,t){const r=Ur(t,e.index,"lowerBound");e.index[r]===t||e.index.splice(r+1,0,t)}static removeRowsFromValues(e,t){const r=Ur(t.rowStart,e.index,"upperBound"),n=Ur(t.rowEnd,e.index,"lowerBound");r>-1&&n>-1&&r<=n&&e.index[r]<=t.rowEnd&&e.index.splice(r,n-r+1)}static shiftRows(e,t,r){const n=Ur(t,e.index,"upperBound");if(n!==-1)for(let i=n;i<e.index.length;++i)e.index[i]+=r}}function Ur(s,e,t="upperBound"){let r=0,n=e.length-1;for(;r<=n;){const o=Math.floor((r+n)/2);if(s>e[o])r=o+1;else if(s<e[o])n=o-1;else return o}const i=t==="lowerBound"?n:r;return i>=0&&i<=e.length?i:-1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function wT(s,e,t){return e.useColumnIndex?new Vr(s,e,t):new Zl(s)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class _T{constructor(e){this.config=e;const t=this.config.thousandSeparator==="."?`\\${this.config.thousandSeparator}`:this.config.thousandSeparator,r=this.config.decimalSeparator==="."?`\\${this.config.decimalSeparator}`:this.config.decimalSeparator;this.numberPattern=new RegExp(`^([+-]?((${r}\\d+)|(\\d+(${t}\\d{3,})*(${r}\\d*)?)))(e[+-]?\\d+)?$`),this.allThousandSeparatorsRegex=new RegExp(`${t}`,"g")}numericStringToMaybeNumber(e){if(this.numberPattern.test(e)){const t=this.numericStringToNumber(e);return isNaN(t)?void 0:t}}numericStringToNumber(e){const t=e.replace(this.allThousandSeparatorsRegex,"").replace(this.config.decimalSeparator,".");return Number(t)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class co{constructor(e,t,r){this.dependencyGraph=e,this.unparser=t,this.exporter=r}getCellHyperlink(e){const t=this.dependencyGraph.getCell(e);if(t instanceof Wt){const r=t.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(r.procedureName==="HYPERLINK")return r.hyperlink}}getCellFormula(e,t){const r=this.dependencyGraph.getCell(e);if(r instanceof Wt){const n=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);return t=t??e,this.unparser.unparse(n,t)}else if(r instanceof ye){const n=r.getAddress(this.dependencyGraph.lazilyTransformingAstService);if(n.row!==e.row||n.col!==e.col||n.sheet!==e.sheet)return;t=t??e;const i=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(i!==void 0)return this.unparser.unparse(i,t)}else if(r instanceof gn)return r.getFormula()}getCellSerialized(e,t){var r;return(r=this.getCellFormula(e,t))!==null&&r!==void 0?r:this.getRawValue(e)}getCellValue(e){return this.exporter.exportValue(this.dependencyGraph.getScalarValue(e))}getRawValue(e){return this.dependencyGraph.getRawValue(e)}getSheetValues(e){return this.genericSheetGetter(e,t=>this.getCellValue(t))}getSheetFormulas(e){return this.genericSheetGetter(e,t=>this.getCellFormula(t))}genericSheetGetter(e,t){const r=this.dependencyGraph.getSheetHeight(e),n=this.dependencyGraph.getSheetWidth(e),i=new Array(r);for(let a=0;a<r;a++){i[a]=new Array(n);for(let o=0;o<n;o++){const u=M(e,o,a);i[a][o]=t(u)}for(let o=n-1;o>=0&&(i[a][o]===null||i[a][o]===void 0);o--)i[a].pop()}for(let a=r-1;a>=0&&i[a].length===0;a--)i.pop();return i}genericAllSheetsGetter(e){const t={};for(const r of this.dependencyGraph.sheetMapping.displayNames()){const n=this.dependencyGraph.sheetMapping.fetch(r);t[r]=e(n)}return t}getSheetSerialized(e){return this.genericSheetGetter(e,t=>this.getCellSerialized(t))}getAllSheetsValues(){return this.genericAllSheetsGetter(e=>this.getSheetValues(e))}getAllSheetsFormulas(){return this.genericAllSheetsGetter(e=>this.getSheetFormulas(e))}getAllSheetsSerialized(){return this.genericAllSheetsGetter(e=>this.getSheetSerialized(e))}getAllNamedExpressionsSerialized(){const e=[];let t=0;for(const r of this.dependencyGraph.sheetMapping.displayNames()){const n=this.dependencyGraph.sheetMapping.fetch(r);e[n]=t,t++}return this.dependencyGraph.namedExpressions.getAllNamedExpressions().map(r=>({name:r.expression.displayName,expression:this.getCellSerialized(r.expression.address),scope:r.scope!==void 0?e[r.scope]:void 0,options:r.expression.options}))}withNewConfig(e,t){const r=new dl(e,no(e),this.dependencyGraph.sheetMapping.fetchDisplayName,t);return new co(this.dependencyGraph,r,this.exporter)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Os{static buildFromSheets(e,t={},r=[]){const n=new dt(t);return this.buildEngine(n,e,r)}static buildFromSheet(e,t={},r=[]){const n=new dt(t),i=n.translationPackage.getUITranslation(rs.NEW_SHEET_PREFIX)+"1";return this.buildEngine(n,{[i]:e},r)}static buildEmpty(e={},t=[]){return this.buildEngine(new dt(e),{},t)}static rebuildWithConfig(e,t,r,n){return this.buildEngine(e,t,r,n)}static buildEngine(e,t={},r=[],n=e.useStats?new ml:new SE){n.start(D.BUILD_ENGINE_TOTAL);const i=new zr,a=new Me(e),o=new IT(n),u=ho.buildEmpty(o,e,a,i,n),l=wT(u,e,n),c=u.sheetMapping,d=u.addressMapping;for(const q in t)if(Object.prototype.hasOwnProperty.call(t,q)){const at=t[q];Yl(at);const ze=fi(at);if(ze.height>e.maxRows||ze.width>e.maxColumns)throw new kr;const gt=c.addSheet(q);d.autoAddSheet(gt,ze)}const f=new Yn(e,a,c.get);o.parser=f;const E=new dl(e,no(e),c.fetchDisplayName,i),N=new mR(e),R=new _T(e),y=new QE(e,N,R),S=new PR(e,N,R),A=new sR(e,a),C=new zR(e,u,l,S,f,n,o,i,A),I=new pT(e,C);o.undoRedo=I;const oe=new DR(e,u,C),Q=new fT(e,C,I,oe,u,l,f,S,o,i),ee=new gT(e,i,c.fetchDisplayName,o),ve=new co(u,E,ee),Te=new AT(e,u,l,n,y,a,i,ve,A,N);n.measure(D.GRAPH_BUILD,()=>{new ET(u,l,f,S,n,A).buildGraph(t,n)}),r.forEach(q=>{Q.ensureItIsPossibleToAddNamedExpression(q.name,q.expression,q.scope),Q.operations.addNamedExpression(q.name,q.expression,q.scope,q.options)});const he=new mT(e,n,Te,o,u,l);return he.run(),n.end(D.BUILD_ENGINE_TOTAL),{config:e,stats:n,dependencyGraph:u,columnSearch:l,parser:f,unparser:E,cellContentParser:S,evaluator:he,lazilyTransformingAstService:o,crudOperations:Q,exporter:ee,namedExpressions:i,serialization:ve,functionRegistry:a}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function LT(s){for(const[e,t]of Object.entries(s))t instanceof Function?s[e]=FT(t):delete s[e]}function FT(s){return()=>{throw new Error(`The "${s}" method cannot be called because this HyperFormula instance has been destroyed`)}}var Ms={exports:{}},vu;function UT(){if(vu)return Ms.exports;vu=1;function s(){}return s.prototype={on:function(e,t,r){var n=this.e||(this.e={});return(n[e]||(n[e]=[])).push({fn:t,ctx:r}),this},once:function(e,t,r){var n=this;function i(){n.off(e,i),t.apply(r,arguments)}return i._=t,this.on(e,i,r)},emit:function(e){var t=[].slice.call(arguments,1),r=((this.e||(this.e={}))[e]||[]).slice(),n=0,i=r.length;for(n;n<i;n++)r[n].fn.apply(r[n].ctx,t);return this},off:function(e,t){var r=this.e||(this.e={}),n=r[e],i=[];if(n&&t)for(var a=0,o=n.length;a<o;a++)n[a].fn!==t&&n[a].fn._!==t&&i.push(n[a]);return i.length?r[e]=i:delete r[e],this}},Ms.exports=s,Ms.exports.TinyEmitter=s,Ms.exports}var bT=UT();/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var kt;(function(s){s.SheetAdded="sheetAdded",s.SheetRemoved="sheetRemoved",s.SheetRenamed="sheetRenamed",s.NamedExpressionAdded="namedExpressionAdded",s.NamedExpressionRemoved="namedExpressionRemoved",s.ValuesUpdated="valuesUpdated",s.EvaluationSuspended="evaluationSuspended",s.EvaluationResumed="evaluationResumed"})(kt||(kt={}));class xT extends bT.TinyEmitter{emit(e,...t){return super.emit(e,...t),this}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Pe{constructor(e,t,r,n,i,a,o,u,l,c,d,f,E,N){this._config=e,this._stats=t,this._dependencyGraph=r,this._columnSearch=n,this._parser=i,this._unparser=a,this._cellContentParser=o,this._evaluator=u,this._lazilyTransformingAstService=l,this._crudOperations=c,this._exporter=d,this._namedExpressions=f,this._serialization=E,this._functionRegistry=N,this._emitter=new xT,this._evaluationSuspended=!1}static get defaultConfig(){return PT()}get graph(){return this.dependencyGraph.graph}get rangeMapping(){return this.dependencyGraph.rangeMapping}get arrayMapping(){return this.dependencyGraph.arrayMapping}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}get dependencyGraph(){return this._dependencyGraph}get evaluator(){return this._evaluator}get columnSearch(){return this._columnSearch}get lazilyTransformingAstService(){return this._lazilyTransformingAstService}get licenseKeyValidityState(){return this._config.licenseKeyValidityState}static buildFromArray(e,t={},r=[]){return this.buildFromEngineState(Os.buildFromSheet(e,t,r))}static buildFromSheets(e,t={},r=[]){return this.buildFromEngineState(Os.buildFromSheets(e,t,r))}static buildEmpty(e={},t=[]){return this.buildFromEngineState(Os.buildEmpty(e,t))}static getLanguage(e){v(e,"string","languageCode");const t=this.registeredLanguages.get(e);if(t===void 0)throw new Ra;return t}static registerLanguage(e,t){if(v(e,"string","languageCode"),this.registeredLanguages.has(e))throw new wl;this.registeredLanguages.set(e,xE(t))}static unregisterLanguage(e){if(v(e,"string","languageCode"),this.registeredLanguages.has(e))this.registeredLanguages.delete(e);else throw new Ra}static getRegisteredLanguagesCodes(){return Array.from(this.registeredLanguages.keys())}static registerFunctionPlugin(e,t){Me.registerFunctionPlugin(e,t)}static unregisterFunctionPlugin(e){Me.unregisterFunctionPlugin(e)}static registerFunction(e,t,r){v(e,"string","functionId"),Me.registerFunction(e,t,r)}static unregisterFunction(e){v(e,"string","functionId"),Me.unregisterFunction(e)}static unregisterAllFunctions(){Me.unregisterAll()}static getRegisteredFunctionNames(e){v(e,"string","code");const t=Me.getRegisteredFunctionIds();return this.getLanguage(e).getFunctionTranslations(t)}static getFunctionPlugin(e){return v(e,"string","functionId"),Me.getFunctionPlugin(e)}static getAllFunctionPlugins(){return Me.getPlugins()}static buildFromEngineState(e){return new Pe(e.config,e.stats,e.dependencyGraph,e.columnSearch,e.parser,e.unparser,e.cellContentParser,e.evaluator,e.lazilyTransformingAstService,e.crudOperations,e.exporter,e.namedExpressions,e.serialization,e.functionRegistry)}getCellValue(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellValue(e)}getCellFormula(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");return this._serialization.getCellFormula(e)}getCellHyperlink(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellHyperlink(e)}getCellSerialized(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellSerialized(e)}getSheetValues(e){return v(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetValues(e)}getSheetFormulas(e){return v(e,"number","sheetId"),this._serialization.getSheetFormulas(e)}getSheetSerialized(e){return v(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetSerialized(e)}getAllSheetsDimensions(){return this._serialization.genericAllSheetsGetter(e=>this.getSheetDimensions(e))}getSheetDimensions(e){return v(e,"number","sheetId"),{width:this.dependencyGraph.getSheetWidth(e),height:this.dependencyGraph.getSheetHeight(e)}}getAllSheetsValues(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsValues()}getAllSheetsFormulas(){return this._serialization.getAllSheetsFormulas()}getAllSheetsSerialized(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsSerialized()}updateConfig(e){Object.entries(e).every(([r,n])=>this._config[r]===n)||this.rebuildWithConfig(e)}getConfig(){return this._config.getConfig()}rebuildAndRecalculate(){this.rebuildWithConfig({})}getStats(){return this._stats.snapshot()}undo(){return this._crudOperations.undo(),this.recomputeIfDependencyGraphNeedsIt()}redo(){return this._crudOperations.redo(),this.recomputeIfDependencyGraphNeedsIt()}isThereSomethingToUndo(){return this._crudOperations.isThereSomethingToUndo()}isThereSomethingToRedo(){return this._crudOperations.isThereSomethingToRedo()}isItPossibleToSetCellContents(e){let t;if(ge(e))t=new U(e,e);else if(ut(e))t=new U(e.start,e.end);else throw new K("SimpleCellAddress | SimpleCellRange","address");try{this._crudOperations.ensureRangeInSizeLimits(t);for(const r of t.addresses(this._dependencyGraph))this._crudOperations.ensureItIsPossibleToChangeContent(r)}catch{return!1}return!0}setCellContents(e,t){return this._crudOperations.setCellContents(e,t),this.recomputeIfDependencyGraphNeedsIt()}swapRowIndexes(e,t){return v(e,"number","sheetId"),this._crudOperations.setRowOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapRowIndexes(e,t){v(e,"number","sheetId");try{return this._crudOperations.validateSwapRowIndexes(e,t),this._crudOperations.testRowOrderForArrays(e,t),!0}catch{return!1}}setRowOrder(e,t){v(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"row");return this.swapRowIndexes(e,r)}isItPossibleToSetRowOrder(e,t){v(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"row");return this._crudOperations.validateSwapRowIndexes(e,r),this._crudOperations.testRowOrderForArrays(e,r),!0}catch{return!1}}swapColumnIndexes(e,t){return v(e,"number","sheetId"),this._crudOperations.setColumnOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapColumnIndexes(e,t){v(e,"number","sheetId");try{return this._crudOperations.validateSwapColumnIndexes(e,t),this._crudOperations.testColumnOrderForArrays(e,t),!0}catch{return!1}}setColumnOrder(e,t){v(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"column");return this.swapColumnIndexes(e,r)}isItPossibleToSetColumnOrder(e,t){v(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"column");return this._crudOperations.validateSwapColumnIndexes(e,r),this._crudOperations.testColumnOrderForArrays(e,r),!0}catch{return!1}}isItPossibleToAddRows(e,...t){v(e,"number","sheetId");const r=gi(t);try{return this._crudOperations.ensureItIsPossibleToAddRows(e,...r),!0}catch{return!1}}addRows(e,...t){return v(e,"number","sheetId"),this._crudOperations.addRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveRows(e,...t){v(e,"number","sheetId");const r=mi(t);try{return this._crudOperations.ensureItIsPossibleToRemoveRows(e,...r),!0}catch{return!1}}removeRows(e,...t){return v(e,"number","sheetId"),this._crudOperations.removeRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToAddColumns(e,...t){v(e,"number","sheetId");const r=gi(t);try{return this._crudOperations.ensureItIsPossibleToAddColumns(e,...r),!0}catch{return!1}}addColumns(e,...t){return v(e,"number","sheetId"),this._crudOperations.addColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveColumns(e,...t){v(e,"number","sheetId");const r=mi(t);try{return this._crudOperations.ensureItIsPossibleToRemoveColumns(e,...r),!0}catch{return!1}}removeColumns(e,...t){return v(e,"number","sheetId"),this._crudOperations.removeColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveCells(e,t){if(!ge(t))throw new K("SimpleCellAddress","destinationLeftCorner");if(!ut(e))throw new K("SimpleCellRange","source");try{const r=new U(e.start,e.end);return this._crudOperations.operations.ensureItIsPossibleToMoveCells(r.start,r.width(),r.height(),t),!0}catch{return!1}}moveCells(e,t){if(!ge(t))throw new K("SimpleCellAddress","destinationLeftCorner");if(!ut(e))throw new K("SimpleCellRange","source");const r=new U(e.start,e.end);return this._crudOperations.moveCells(r.start,r.width(),r.height(),t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveRows(e,t,r,n){v(e,"number","sheetId"),v(t,"number","startRow"),v(r,"number","numberOfRows"),v(n,"number","targetRow");try{return this._crudOperations.ensureItIsPossibleToMoveRows(e,t,r,n),!0}catch{return!1}}moveRows(e,t,r,n){return v(e,"number","sheetId"),v(t,"number","startRow"),v(r,"number","numberOfRows"),v(n,"number","targetRow"),this._crudOperations.moveRows(e,t,r,n),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveColumns(e,t,r,n){v(e,"number","sheetId"),v(t,"number","startColumn"),v(r,"number","numberOfColumns"),v(n,"number","targetColumn");try{return this._crudOperations.ensureItIsPossibleToMoveColumns(e,t,r,n),!0}catch{return!1}}moveColumns(e,t,r,n){return v(e,"number","sheetId"),v(t,"number","startColumn"),v(r,"number","numberOfColumns"),v(n,"number","targetColumn"),this._crudOperations.moveColumns(e,t,r,n),this.recomputeIfDependencyGraphNeedsIt()}copy(e){if(!ut(e))throw new K("SimpleCellRange","source");const t=new U(e.start,e.end);return this._crudOperations.copy(t.start,t.width(),t.height()),this.getRangeValues(e)}cut(e){if(!ut(e))throw new K("SimpleCellRange","source");const t=new U(e.start,e.end);return this._crudOperations.cut(t.start,t.width(),t.height()),this.getRangeValues(e)}paste(e){if(!ge(e))throw new K("SimpleCellAddress","targetLeftCorner");return this.ensureEvaluationIsNotSuspended(),this._crudOperations.paste(e),this.recomputeIfDependencyGraphNeedsIt()}isClipboardEmpty(){return this._crudOperations.isClipboardEmpty()}clearClipboard(){this._crudOperations.clearClipboard()}clearRedoStack(){this._crudOperations.undoRedo.clearRedoStack()}clearUndoStack(){this._crudOperations.undoRedo.clearUndoStack()}getRangeValues(e){if(!ut(e))throw new K("SimpleCellRange","source");return new U(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellValue(n)))}getRangeFormulas(e){if(!ut(e))throw new K("SimpleCellRange","source");return new U(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellFormula(n)))}getRangeSerialized(e){if(!ut(e))throw new K("SimpleCellRange","source");return new U(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellSerialized(n)))}getFillRangeData(e,t,r=!1){if(!ut(e))throw new K("SimpleCellRange","source");if(!ut(t))throw new K("SimpleCellRange","target");const n=new U(e.start,e.end),i=new U(t.start,t.end);return this.ensureEvaluationIsNotSuspended(),i.arrayOfAddressesInRange().map(a=>a.map(o=>{const u=((o.row-(r?t:e).start.row)%n.height()+n.height())%n.height()+e.start.row,l=((o.col-(r?t:e).start.col)%n.width()+n.width())%n.width()+e.start.col;return this._serialization.getCellSerialized({row:u,col:l,sheet:n.sheet},o)}))}isItPossibleToAddSheet(e){v(e,"string","sheetName");try{return this._crudOperations.ensureItIsPossibleToAddSheet(e),!0}catch{return!1}}addSheet(e){e!==void 0&&v(e,"string","sheetName");const t=this._crudOperations.addSheet(e);return this._emitter.emit(kt.SheetAdded,t),t}isItPossibleToRemoveSheet(e){v(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch{return!1}}removeSheet(e){v(e,"number","sheetId");const t=this.sheetMapping.getDisplayName(e);this._crudOperations.removeSheet(e);const r=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(kt.SheetRemoved,t,r),r}isItPossibleToClearSheet(e){v(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch{return!1}}clearSheet(e){return v(e,"number","sheetId"),this._crudOperations.clearSheet(e),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToReplaceSheetContent(e,t){v(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),this._crudOperations.ensureItIsPossibleToChangeSheetContents(e,t),!0}catch{return!1}}setSheetContent(e,t){return v(e,"number","sheetId"),this._crudOperations.setSheetContent(e,t),this.recomputeIfDependencyGraphNeedsIt()}simpleCellAddressFromString(e,t){return v(e,"string","cellAddress"),v(t,"number","sheetId"),ia(this.sheetMapping.get,e,t)}simpleCellRangeFromString(e,t){return v(e,"string","cellRange"),v(t,"number","sheetId"),Tf(this.sheetMapping.get,e,t)}simpleCellAddressToString(e,t={}){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");const r=typeof t=="number"?t:t.includeSheetName?e.sheet+1:e.sheet;return js(this.sheetMapping.fetchDisplayName,e,r)}simpleCellRangeToString(e,t={}){if(!ut(e))throw new K("SimpleCellRange","cellRange");const r=typeof t=="number"?t:t.includeSheetName?e.start.sheet+e.end.sheet+1:e.start.sheet;return Nf(this.sheetMapping.fetchDisplayName,e,r)}getCellDependents(e){let t;if(ge(e))t=this._dependencyGraph.addressMapping.getCell(e);else if(ut(e))t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end);else throw new K("SimpleCellAddress | SimpleCellRange",e);return t===void 0?[]:this._dependencyGraph.getAdjacentNodesAddresses(t)}getCellPrecedents(e){let t;if(ge(e))t=this._dependencyGraph.addressMapping.getCell(e);else if(ut(e))t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end);else throw new K("SimpleCellAddress | SimpleCellRange",e);return t===void 0?[]:this._dependencyGraph.dependencyQueryAddresses(t)}getSheetName(e){return v(e,"number","sheetId"),this.sheetMapping.getDisplayName(e)}getSheetNames(){return this.sheetMapping.sheetNames()}getSheetId(e){return v(e,"string","sheetName"),this.sheetMapping.get(e)}doesSheetExist(e){return v(e,"string","sheetName"),this.sheetMapping.hasSheetWithName(e)}getCellType(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");const t=this.dependencyGraph.getCell(e);return kE(t,e)}doesCellHaveSimpleValue(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");return this.getCellType(e)===Qe.VALUE}doesCellHaveFormula(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===Qe.FORMULA||t===Qe.ARRAYFORMULA}isCellEmpty(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");return this.getCellType(e)===Qe.EMPTY}isCellPartOfArray(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===Qe.ARRAY||t===Qe.ARRAYFORMULA}getCellValueType(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return li(t)}getCellValueDetailedType(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return HE(t)}getCellValueFormat(e){if(!ge(e))throw new K("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return WE(t)}countSheets(){return this.sheetMapping.numberOfSheets()}isItPossibleToRenameSheet(e,t){v(e,"number","sheetId"),v(t,"string","newName");try{return this._crudOperations.ensureItIsPossibleToRenameSheet(e,t),!0}catch{return!1}}renameSheet(e,t){v(e,"number","sheetId"),v(t,"string","newName");const r=this._crudOperations.renameSheet(e,t);r!==void 0&&this._emitter.emit(kt.SheetRenamed,r,t)}batch(e){this.suspendEvaluation(),this._crudOperations.beginUndoRedoBatchMode();try{e()}catch(t){throw this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation(),t}return this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation()}suspendEvaluation(){this._evaluationSuspended=!0,this._emitter.emit(kt.EvaluationSuspended)}resumeEvaluation(){this._evaluationSuspended=!1;const e=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(kt.EvaluationResumed,e),e}isEvaluationSuspended(){return this._evaluationSuspended}isItPossibleToAddNamedExpression(e,t,r){v(e,"string","expressionName"),r!==void 0&&v(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToAddNamedExpression(e,t,r),!0}catch{return!1}}addNamedExpression(e,t,r,n){v(e,"string","expressionName"),r!==void 0&&v(r,"number","scope"),this._crudOperations.addNamedExpression(e,t,r,n);const i=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(kt.NamedExpressionAdded,e,i),i}getNamedExpressionValue(e,t){v(e,"string","expressionName"),t!==void 0&&v(t,"number","scope"),this.ensureEvaluationIsNotSuspended(),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);if(r)return this._serialization.getCellValue(r.address)}getNamedExpressionFormula(e,t){v(e,"string","expressionName"),t!==void 0&&v(t,"number","scope"),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);if(r!==void 0)return this._serialization.getCellFormula(r.address)}getNamedExpression(e,t){v(e,"string","expressionName"),t!==void 0&&v(t,"number","scope");const r=this._namedExpressions.namedExpressionForScope(e,t);if(r===void 0)return;const n=this._serialization.getCellFormula(r.address);return{name:e,scope:t,expression:n,options:r.options}}isItPossibleToChangeNamedExpression(e,t,r){v(e,"string","expressionName"),r!==void 0&&v(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToChangeNamedExpression(e,t,r),!0}catch{return!1}}changeNamedExpression(e,t,r,n){return v(e,"string","expressionName"),r!==void 0&&v(r,"number","scope"),this._crudOperations.changeNamedExpressionExpression(e,r,t,n),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveNamedExpression(e,t){v(e,"string","expressionName"),t!==void 0&&v(t,"number","scope");try{return this._crudOperations.isItPossibleToRemoveNamedExpression(e,t),!0}catch{return!1}}removeNamedExpression(e,t){v(e,"string","expressionName"),t!==void 0&&v(t,"number","scope");const r=this._crudOperations.removeNamedExpression(e,t);if(r){const n=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(kt.NamedExpressionRemoved,r.displayName,n),n}else return[]}listNamedExpressions(e){return e!==void 0&&v(e,"number","scope"),this._crudOperations.ensureScopeIdIsValid(e),this._namedExpressions.getAllNamedExpressionsNamesInScope(e)}getAllNamedExpressionsSerialized(){return this._serialization.getAllNamedExpressionsSerialized()}normalizeFormula(e){v(e,"string","formulaString");const{ast:t,address:r}=this.extractTemporaryFormula(e);if(t===void 0)throw new Gs;return this._unparser.unparse(t,r)}calculateFormula(e,t){v(e,"string","formulaString"),v(t,"number","sheetId"),this._crudOperations.ensureScopeIdIsValid(t);const{ast:r,address:n,dependencies:i}=this.extractTemporaryFormula(e,t);if(r===void 0)throw new Gs;const a=this.evaluator.runAndForget(r,n,i);return this._exporter.exportScalarOrRange(a)}getNamedExpressionsFromFormula(e){v(e,"string","formulaString");const{ast:t,dependencies:r}=this.extractTemporaryFormula(e);if(t===void 0)throw new Gs;const n=r.filter(a=>a instanceof nr).map(a=>a.name);return[...new Set(n)]}validateFormula(e){v(e,"string","formulaString");const{ast:t}=this.extractTemporaryFormula(e);return t!==void 0}getRegisteredFunctionNames(){return Pe.getLanguage(this._config.language).getFunctionTranslations(this._functionRegistry.getRegisteredFunctionIds())}getFunctionPlugin(e){return v(e,"string","functionId"),this._functionRegistry.getFunctionPlugin(e)}getAllFunctionPlugins(){return this._functionRegistry.getPlugins()}numberToDateTime(e){return v(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDateTime(e)}numberToDate(e){return v(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDate(e)}numberToTime(e){return v(e,"number","val"),En(e)}on(e,t){this._emitter.on(e,t)}once(e,t){this._emitter.once(e,t)}off(e,t){this._emitter.off(e,t)}destroy(){LT(this)}ensureEvaluationIsNotSuspended(){if(this._evaluationSuspended)throw new Ol}extractTemporaryFormula(e,t=1){const r=this._cellContentParser.parse(e),n={sheet:t,col:0,row:0};if(!(r instanceof ce.Formula))return{address:n,dependencies:[]};const{ast:i,errors:a,dependencies:o}=this._parser.parse(r.formula,n);return a.length>0?{address:n,dependencies:[]}:{ast:i,address:n,dependencies:o}}rebuildWithConfig(e){const t=this._config.mergeConfig(e),r=this._config.mergeConfig({language:e.language}),n=this._serialization.withNewConfig(r,this._namedExpressions).getAllSheetsSerialized(),i=this._serialization.getAllNamedExpressionsSerialized(),a=Os.rebuildWithConfig(t,n,i,this._stats);this._config=a.config,this._stats=a.stats,this._dependencyGraph=a.dependencyGraph,this._columnSearch=a.columnSearch,this._parser=a.parser,this._unparser=a.unparser,this._cellContentParser=a.cellContentParser,this._evaluator=a.evaluator,this._lazilyTransformingAstService=a.lazilyTransformingAstService,this._crudOperations=a.crudOperations,this._exporter=a.exporter,this._namedExpressions=a.namedExpressions,this._serialization=a.serialization,this._functionRegistry=a.functionRegistry}recomputeIfDependencyGraphNeedsIt(){if(this._evaluationSuspended)return[];{const e=this._crudOperations.getAndClearContentChanges(),t=this.dependencyGraph.verticesToRecompute();this.dependencyGraph.clearDirtyVertices(),t.length>0&&e.addAll(this.evaluator.partialRun(t));const r=e.exportChanges(this._exporter);return e.isEmpty()||this._emitter.emit(kt.ValuesUpdated,r),r}}}Pe.version="3.1.0";Pe.buildDate="14/10/2025 09:41:56";Pe.releaseDate="14/10/2025";Pe.languages={};Pe.registeredLanguages=new Map;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Iu=new WeakMap;class dt{constructor(e={},t=!0){const{accentSensitive:r,caseSensitive:n,caseFirst:i,chooseAddressMappingPolicy:a,context:o,currencySymbol:u,dateFormats:l,decimalSeparator:c,evaluateNullToZero:d,functionArgSeparator:f,functionPlugins:E,ignorePunctuation:N,leapYear1900:R,localeLang:y,language:S,ignoreWhiteSpace:A,licenseKey:C,matchWholeCell:I,arrayColumnSeparator:oe,arrayRowSeparator:Q,maxRows:ee,maxColumns:ve,nullYear:Te,nullDate:he,parseDateTime:q,precisionEpsilon:at,precisionRounding:ze,stringifyDateTime:gt,stringifyDuration:Ke,smartRounding:qt,timeFormats:lr,thousandSeparator:Kr,useArrayArithmetic:cr,useStats:jr,undoLimit:vn,useColumnIndex:ds,useRegularExpressions:In,useWildcards:je}=e;this.useArrayArithmetic=J(cr,"boolean","useArrayArithmetic"),this.accentSensitive=J(r,"boolean","accentSensitive"),this.caseSensitive=J(n,"boolean","caseSensitive"),this.caseFirst=J(i,["upper","lower","false"],"caseFirst"),this.ignorePunctuation=J(N,"boolean","ignorePunctuation"),this.chooseAddressMappingPolicy=a??dt.defaultConfig.chooseAddressMappingPolicy,this.dateFormats=[...Ss(l,Array.isArray,"array","dateFormats")],this.timeFormats=[...Ss(lr,Array.isArray,"array","timeFormats")],this.functionArgSeparator=J(f,"string","functionArgSeparator"),this.decimalSeparator=J(c,[".",","],"decimalSeparator"),this.language=J(S,"string","language"),this.ignoreWhiteSpace=J(A,["standard","any"],"ignoreWhiteSpace"),this.licenseKey=J(C,"string","licenseKey"),this.thousandSeparator=J(Kr,["",","," ","."],"thousandSeparator"),this.arrayColumnSeparator=J(oe,[",",";"],"arrayColumnSeparator"),this.arrayRowSeparator=J(Q,[";","|"],"arrayRowSeparator"),this.localeLang=J(y,"string","localeLang"),this.functionPlugins=[...E??dt.defaultConfig.functionPlugins],this.smartRounding=J(qt,"boolean","smartRounding"),this.evaluateNullToZero=J(d,"boolean","evaluateNullToZero"),this.nullYear=J(Te,"number","nullYear"),Jr(this.nullYear,"nullYear",0),iR(this.nullYear,"nullYear",100),this.precisionRounding=J(ze,"number","precisionRounding"),Jr(this.precisionRounding,"precisionRounding",0),this.precisionEpsilon=J(at,"number","precisionEpsilon"),Jr(this.precisionEpsilon,"precisionEpsilon",0),this.useColumnIndex=J(ds,"boolean","useColumnIndex"),this.useStats=J(jr,"boolean","useStats"),this.parseDateTime=J(q,"function","parseDateTime"),this.stringifyDateTime=J(gt,"function","stringifyDateTime"),this.stringifyDuration=J(Ke,"function","stringifyDuration"),this.translationPackage=Pe.getLanguage(this.language),this.errorMapping=this.translationPackage.buildErrorMapping(),this.nullDate=Ss(he,Xn,"IDate","nullDate"),this.leapYear1900=J(R,"boolean","leapYear1900"),this.undoLimit=J(vn,"number","undoLimit"),this.useRegularExpressions=J(In,"boolean","useRegularExpressions"),this.useWildcards=J(je,"boolean","useWildcards"),this.matchWholeCell=J(I,"boolean","matchWholeCell"),Jr(this.undoLimit,"undoLimit",0),this.maxRows=J(ee,"number","maxRows"),Jr(this.maxRows,"maxRows",1),this.maxColumns=J(ve,"number","maxColumns"),this.currencySymbol=this.setupCurrencySymbol(u),Jr(this.maxColumns,"maxColumns",1),this.context=o,Iu.set(this,{licenseKeyValidityState:LR(this.licenseKey)}),lu({value:this.decimalSeparator,name:"decimalSeparator"},{value:this.functionArgSeparator,name:"functionArgSeparator"},{value:this.thousandSeparator,name:"thousandSeparator"}),lu({value:this.arrayRowSeparator,name:"arrayRowSeparator"},{value:this.arrayColumnSeparator,name:"arrayColumnSeparator"})}setupCurrencySymbol(e){const t=[...Ss(e,Array.isArray,"array","currencySymbol")];return t.forEach(r=>{if(typeof r!="string")throw new K("string[]","currencySymbol");if(r==="")throw new AE("currencySymbol")}),t}get licenseKeyValidityState(){return Iu.get(this).licenseKeyValidityState}getConfig(){return Jl(this)}mergeConfig(e){const t=Object.assign({},this.getConfig(),e);return new dt(t,!1)}static warnDeprecatedOptions(e){}static warnDeprecatedIfUsed(e,t,r,n){e!==void 0&&console.warn(n===void 0?`${t} option is deprecated since ${r}`:`${t} option is deprecated since ${r}, please use ${n}`)}}dt.defaultConfig={accentSensitive:!1,currencySymbol:["$"],caseSensitive:!1,caseFirst:"lower",context:void 0,chooseAddressMappingPolicy:new TR,dateFormats:["DD/MM/YYYY","DD/MM/YY"],decimalSeparator:".",evaluateNullToZero:!1,functionArgSeparator:",",functionPlugins:[],ignorePunctuation:!1,language:"enGB",ignoreWhiteSpace:"standard",licenseKey:"",leapYear1900:!1,localeLang:"en",matchWholeCell:!0,arrayColumnSeparator:",",arrayRowSeparator:";",maxRows:4e4,maxColumns:18278,nullYear:30,nullDate:{year:1899,month:12,day:30},parseDateTime:lR,precisionEpsilon:1e-13,precisionRounding:10,smartRounding:!0,stringifyDateTime:OR,stringifyDuration:IR,timeFormats:["hh:mm","hh:mm:ss.sss"],thousandSeparator:"",undoLimit:20,useRegularExpressions:!1,useWildcards:!0,useColumnIndex:!1,useStats:!1,useArrayArithmetic:!1};function Jl(s){var e;const t={};for(const r in dt.defaultConfig){const n=(e=s[r])!==null&&e!==void 0?e:dt.defaultConfig[r];Array.isArray(n)?t[r]=[...n]:t[r]=n}return t}function PT(){return Jl({})}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const _a={errors:{CYCLE:"#CYCLE!",DIV_BY_ZERO:"#DIV/0!",ERROR:"#ERROR!",NA:"#N/A",NAME:"#NAME?",NUM:"#NUM!",REF:"#REF!",SPILL:"#SPILL!",VALUE:"#VALUE!"},functions:{FILTER:"FILTER",ADDRESS:"ADDRESS",ARRAY_CONSTRAIN:"ARRAY_CONSTRAIN",ARRAYFORMULA:"ARRAYFORMULA",ABS:"ABS",ACOS:"ACOS",ACOSH:"ACOSH",ACOT:"ACOT",ACOTH:"ACOTH",AND:"AND",ARABIC:"ARABIC",ASIN:"ASIN",ASINH:"ASINH",ATAN2:"ATAN2",ATAN:"ATAN",ATANH:"ATANH",AVERAGE:"AVERAGE",AVERAGEA:"AVERAGEA",AVERAGEIF:"AVERAGEIF",BASE:"BASE",BIN2DEC:"BIN2DEC",BIN2HEX:"BIN2HEX",BIN2OCT:"BIN2OCT",BITAND:"BITAND",BITLSHIFT:"BITLSHIFT",BITOR:"BITOR",BITRSHIFT:"BITRSHIFT",BITXOR:"BITXOR",CEILING:"CEILING",CHAR:"CHAR",CHOOSE:"CHOOSE",CLEAN:"CLEAN",CODE:"CODE",COLUMN:"COLUMN",COLUMNS:"COLUMNS",CONCATENATE:"CONCATENATE",CORREL:"CORREL",COS:"COS",COSH:"COSH",COT:"COT",COTH:"COTH",COUNT:"COUNT",COUNTA:"COUNTA",COUNTBLANK:"COUNTBLANK",COUNTIF:"COUNTIF",COUNTIFS:"COUNTIFS",COUNTUNIQUE:"COUNTUNIQUE",CSC:"CSC",CSCH:"CSCH",CUMIPMT:"CUMIPMT",CUMPRINC:"CUMPRINC",DATE:"DATE",DATEDIF:"DATEDIF",DATEVALUE:"DATEVALUE",DAY:"DAY",DAYS360:"DAYS360",DAYS:"DAYS",DB:"DB",DDB:"DDB",DEC2BIN:"DEC2BIN",DEC2HEX:"DEC2HEX",DEC2OCT:"DEC2OCT",DECIMAL:"DECIMAL",DEGREES:"DEGREES",DELTA:"DELTA",DOLLARDE:"DOLLARDE",DOLLARFR:"DOLLARFR",EDATE:"EDATE",EFFECT:"EFFECT",EOMONTH:"EOMONTH",ERF:"ERF",ERFC:"ERFC",EVEN:"EVEN",EXACT:"EXACT",EXP:"EXP",FALSE:"FALSE",FIND:"FIND",FORMULATEXT:"FORMULATEXT",FV:"FV",FVSCHEDULE:"FVSCHEDULE",HEX2BIN:"HEX2BIN",HEX2DEC:"HEX2DEC",HEX2OCT:"HEX2OCT",HLOOKUP:"HLOOKUP",HOUR:"HOUR",HYPERLINK:"HYPERLINK",IF:"IF",IFERROR:"IFERROR",IFNA:"IFNA",IFS:"IFS",INDEX:"INDEX",INT:"INT",INTERVAL:"INTERVAL",IPMT:"IPMT",ISBINARY:"ISBINARY",ISBLANK:"ISBLANK",ISERR:"ISERR",ISERROR:"ISERROR",ISEVEN:"ISEVEN",ISFORMULA:"ISFORMULA",ISLOGICAL:"ISLOGICAL",ISNA:"ISNA",ISNONTEXT:"ISNONTEXT",ISNUMBER:"ISNUMBER",ISODD:"ISODD",ISOWEEKNUM:"ISOWEEKNUM",ISPMT:"ISPMT",ISREF:"ISREF",ISTEXT:"ISTEXT",LEFT:"LEFT",LEN:"LEN",LN:"LN",LOG10:"LOG10",LOG:"LOG",LOWER:"LOWER",MATCH:"MATCH",MAX:"MAX",MAXA:"MAXA",MAXIFS:"MAXIFS",MAXPOOL:"MAXPOOL",MEDIAN:"MEDIAN",MEDIANPOOL:"MEDIANPOOL",MID:"MID",MIN:"MIN",MINA:"MINA",MINIFS:"MINIFS",MINUTE:"MINUTE",MIRR:"MIRR",MMULT:"MMULT",MOD:"MOD",MONTH:"MONTH",NA:"NA",NETWORKDAYS:"NETWORKDAYS","NETWORKDAYS.INTL":"NETWORKDAYS.INTL",NOMINAL:"NOMINAL",NOT:"NOT",NOW:"NOW",NPER:"NPER",NPV:"NPV",OCT2BIN:"OCT2BIN",OCT2DEC:"OCT2DEC",OCT2HEX:"OCT2HEX",ODD:"ODD",OFFSET:"OFFSET",OR:"OR",PI:"PI",PMT:"PMT",PDURATION:"PDURATION",PRODUCT:"PRODUCT",POWER:"POWER",PPMT:"PPMT",PROPER:"PROPER",PV:"PV",RADIANS:"RADIANS",RAND:"RAND",RATE:"RATE",REPLACE:"REPLACE",REPT:"REPT",RIGHT:"RIGHT",ROMAN:"ROMAN",ROUND:"ROUND",ROUNDDOWN:"ROUNDDOWN",ROUNDUP:"ROUNDUP",ROW:"ROW",ROWS:"ROWS",RRI:"RRI",SEARCH:"SEARCH",SEC:"SEC",SECH:"SECH",SECOND:"SECOND",SHEET:"SHEET",SHEETS:"SHEETS",SIN:"SIN",SINH:"SINH",SLN:"SLN",SPLIT:"SPLIT",SQRT:"SQRT",STDEVA:"STDEVA","STDEV.P":"STDEV.P",STDEVPA:"STDEVPA","STDEV.S":"STDEV.S",SUBSTITUTE:"SUBSTITUTE",SUBTOTAL:"SUBTOTAL",SUM:"SUM",SUMIF:"SUMIF",SUMIFS:"SUMIFS",SUMPRODUCT:"SUMPRODUCT",SUMSQ:"SUMSQ",SWITCH:"SWITCH",SYD:"SYD",T:"T",TAN:"TAN",TANH:"TANH",TBILLEQ:"TBILLEQ",TBILLPRICE:"TBILLPRICE",TBILLYIELD:"TBILLYIELD",TEXT:"TEXT",TIME:"TIME",TIMEVALUE:"TIMEVALUE",TODAY:"TODAY",TRANSPOSE:"TRANSPOSE",TRIM:"TRIM",TRUE:"TRUE",TRUNC:"TRUNC",UNICHAR:"UNICHAR",UNICODE:"UNICODE",UPPER:"UPPER",VARA:"VARA","VAR.P":"VAR.P",VARPA:"VARPA","VAR.S":"VAR.S",VLOOKUP:"VLOOKUP",WEEKDAY:"WEEKDAY",WEEKNUM:"WEEKNUM",WORKDAY:"WORKDAY","WORKDAY.INTL":"WORKDAY.INTL",XNPV:"XNPV",XOR:"XOR",XLOOKUP:"XLOOKUP",YEAR:"YEAR",YEARFRAC:"YEARFRAC","HF.ADD":"HF.ADD","HF.CONCAT":"HF.CONCAT","HF.DIVIDE":"HF.DIVIDE","HF.EQ":"HF.EQ","HF.GT":"HF.GT","HF.GTE":"HF.GTE","HF.LT":"HF.LT","HF.LTE":"HF.LTE","HF.MINUS":"HF.MINUS","HF.MULTIPLY":"HF.MULTIPLY","HF.NE":"HF.NE","HF.POW":"HF.POW","HF.UMINUS":"HF.UMINUS","HF.UNARY_PERCENT":"HF.UNARY_PERCENT","HF.UPLUS":"HF.UPLUS",VARP:"VARP",VAR:"VAR",STDEVP:"STDEVP",STDEV:"STDEV","EXPON.DIST":"EXPON.DIST",FISHER:"FISHER",FISHERINV:"FISHERINV",GAMMA:"GAMMA","GAMMA.DIST":"GAMMA.DIST",GAMMALN:"GAMMALN","GAMMALN.PRECISE":"GAMMALN.PRECISE","GAMMA.INV":"GAMMA.INV",GAUSS:"GAUSS",FACT:"FACT",FACTDOUBLE:"FACTDOUBLE",COMBIN:"COMBIN",COMBINA:"COMBINA",GCD:"GCD",LCM:"LCM",MROUND:"MROUND",MULTINOMIAL:"MULTINOMIAL",QUOTIENT:"QUOTIENT",RANDBETWEEN:"RANDBETWEEN",SERIESSUM:"SERIESSUM",SIGN:"SIGN",SQRTPI:"SQRTPI",SUMX2MY2:"SUMX2MY2",SUMX2PY2:"SUMX2PY2",SUMXMY2:"SUMXMY2",EXPONDIST:"EXPONDIST",GAMMADIST:"GAMMADIST",GAMMAINV:"GAMMAINV","BETA.DIST":"BETA.DIST",BETADIST:"BETADIST","BETA.INV":"BETA.INV",BETAINV:"BETAINV","BINOM.DIST":"BINOM.DIST",BINOMDIST:"BINOMDIST","BINOM.INV":"BINOM.INV",BESSELI:"BESSELI",BESSELJ:"BESSELJ",BESSELK:"BESSELK",BESSELY:"BESSELY","CHISQ.DIST":"CHISQ.DIST","CHISQ.DIST.RT":"CHISQ.DIST.RT","CHISQ.INV":"CHISQ.INV","CHISQ.INV.RT":"CHISQ.INV.RT",CHIDIST:"CHIDIST",CHIINV:"CHIINV","F.DIST":"F.DIST","F.DIST.RT":"F.DIST.RT","F.INV":"F.INV","F.INV.RT":"F.INV.RT",FDIST:"FDIST",FINV:"FINV",WEIBULL:"WEIBULL","WEIBULL.DIST":"WEIBULL.DIST",POISSON:"POISSON","POISSON.DIST":"POISSON.DIST","HYPGEOM.DIST":"HYPGEOM.DIST",HYPGEOMDIST:"HYPGEOMDIST","T.DIST":"T.DIST","T.DIST.2T":"T.DIST.2T","T.DIST.RT":"T.DIST.RT","T.INV":"T.INV","T.INV.2T":"T.INV.2T",TDIST:"TDIST",TINV:"TINV",LOGINV:"LOGINV","LOGNORM.DIST":"LOGNORM.DIST","LOGNORM.INV":"LOGNORM.INV",LOGNORMDIST:"LOGNORMDIST","NORM.DIST":"NORM.DIST","NORM.INV":"NORM.INV","NORM.S.DIST":"NORM.S.DIST","NORM.S.INV":"NORM.S.INV",NORMDIST:"NORMDIST",NORMINV:"NORMINV",NORMSDIST:"NORMSDIST",NORMSINV:"NORMSINV",PHI:"PHI","NEGBINOM.DIST":"NEGBINOM.DIST",NEGBINOMDIST:"NEGBINOMDIST",COMPLEX:"COMPLEX",IMABS:"IMABS",IMAGINARY:"IMAGINARY",IMARGUMENT:"IMARGUMENT",IMCONJUGATE:"IMCONJUGATE",IMCOS:"IMCOS",IMCOSH:"IMCOSH",IMCOT:"IMCOT",IMCSC:"IMCSC",IMCSCH:"IMCSCH",IMDIV:"IMDIV",IMEXP:"IMEXP",IMLN:"IMLN",IMLOG10:"IMLOG10",IMLOG2:"IMLOG2",IMPOWER:"IMPOWER",IMPRODUCT:"IMPRODUCT",IMREAL:"IMREAL",IMSEC:"IMSEC",IMSECH:"IMSECH",IMSIN:"IMSIN",IMSINH:"IMSINH",IMSQRT:"IMSQRT",IMSUB:"IMSUB",IMSUM:"IMSUM",IMTAN:"IMTAN",LARGE:"LARGE",SMALL:"SMALL",AVEDEV:"AVEDEV",CONFIDENCE:"CONFIDENCE","CONFIDENCE.NORM":"CONFIDENCE.NORM","CONFIDENCE.T":"CONFIDENCE.T",DEVSQ:"DEVSQ",GEOMEAN:"GEOMEAN",HARMEAN:"HARMEAN",CRITBINOM:"CRITBINOM","COVARIANCE.P":"COVARIANCE.P","COVARIANCE.S":"COVARIANCE.S",COVAR:"COVAR",PEARSON:"PEARSON",RSQ:"RSQ",STANDARDIZE:"STANDARDIZE","Z.TEST":"Z.TEST",ZTEST:"ZTEST","F.TEST":"F.TEST",FTEST:"FTEST",STEYX:"STEYX",SLOPE:"SLOPE","CHISQ.TEST":"CHISQ.TEST",CHITEST:"CHITEST","T.TEST":"T.TEST",TTEST:"TTEST",SKEW:"SKEW","SKEW.P":"SKEW.P",WEIBULLDIST:"WEIBULLDIST",VARS:"VARS",TINV2T:"TINV2T",TDISTRT:"TDISTRT",TDIST2T:"TDIST2T",STDEVS:"STDEVS",FINVRT:"FINVRT",FDISTRT:"FDISTRT",CHIDISTRT:"CHIDISTRT",CHIINVRT:"CHIINVRT",COVARIANCEP:"COVARIANCEP",COVARIANCES:"COVARIANCES",LOGNORMINV:"LOGNORMINV",POISSONDIST:"POISSONDIST",SKEWP:"SKEWP","CEILING.MATH":"CEILING.MATH",FLOOR:"FLOOR","FLOOR.MATH":"FLOOR.MATH","CEILING.PRECISE":"CEILING.PRECISE","FLOOR.PRECISE":"FLOOR.PRECISE","ISO.CEILING":"ISO.CEILING"},langCode:"enGB",ui:{NEW_SHEET_PREFIX:"Sheet"}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Er;(function(s){s[s.FullyAbsolute=1]="FullyAbsolute",s[s.RowAbsoluteColRelative=2]="RowAbsoluteColRelative",s[s.RowRelativeColAbsolute=3]="RowRelativeColAbsolute",s[s.FullyRelative=4]="FullyRelative"})(Er||(Er={}));class ec extends V{verifyAddressArguments(e,t,r,n){if(n){if(e<1||t<1)return new p(m.VALUE,T.LessThanOne)}else if(Er.FullyAbsolute==r){if(e<1||t<1)return new p(m.VALUE,T.LessThanOne)}else if(Er.RowAbsoluteColRelative==r){if(e<1)return new p(m.VALUE,T.LessThanOne)}else if(Er.RowRelativeColAbsolute==r&&t<1)return new p(m.VALUE,T.LessThanOne)}address(e,t){return this.runFunction(e.args,t,this.metadata("ADDRESS"),(r,n,i,a,o)=>{const u=this.verifyAddressArguments(r,n,i,a);if(u!==void 0)return u;const l=Si(n-1);let c="";o!=null&&(c=`${o}!`);const d=n==0?"C":`C[${n}]`,f=r==0?"R":`R[${r}]`;return Er.FullyRelative==i?a?`${c}${l}${r}`:`${c}${f}${d}`:Er.RowRelativeColAbsolute==i?a?`${c}$${l}${r}`:`${c}${f}C${n}`:Er.RowAbsoluteColRelative==i?a?`${c}${l}$${r}`:`${c}R${r}${d}`:a?`${c}$${l}$${r}`:`${c}R${r}C${n}`})}}ec.implementedFunctions={ADDRESS:{method:"address",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,defaultValue:1,minValue:1,maxValue:4},{argumentType:h.BOOLEAN,optionalArg:!0,defaultValue:!0},{argumentType:h.STRING,optionalArg:!0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class tc extends V{arrayformula(e,t){return this.runFunction(e.args,t,this.metadata("ARRAYFORMULA"),r=>r)}arrayformulaArraySize(e,t){if(e.args.length!==1)return B.error();const r=this.metadata("ARRAYFORMULA");return e.args.map(i=>{var a;return this.arraySizeForAst(i,new zt(t.formulaAddress,t.arraysFlag||((a=r?.enableArrayArithmeticForArguments)!==null&&a!==void 0?a:!1)))})[0]}arrayconstrain(e,t){return this.runFunction(e.args,t,this.metadata("ARRAY_CONSTRAIN"),(r,n,i)=>{n=Math.min(n,r.height()),i=Math.min(i,r.width());const a=r.data,o=[];for(let u=0;u<n;u++)o.push(a[u].slice(0,i));return w.onlyValues(o)})}arrayconstrainArraySize(e,t){if(e.args.length!==3)return B.error();const r=this.metadata("ARRAY_CONSTRAIN"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new zt(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))});let{height:i,width:a}=n[0];return e.args[1].type===g.NUMBER&&(i=Math.min(i,e.args[1].value)),e.args[2].type===g.NUMBER&&(a=Math.min(a,e.args[2].value)),i<1||a<1||!Number.isInteger(i)||!Number.isInteger(a)?B.error():new B(a,i)}filter(e,t){return this.runFunction(e.args,t,this.metadata("FILTER"),(r,...n)=>{for(const o of n)if(r.width()!==o.width()||r.height()!==o.height())return new p(m.NA,T.EqualLength);if(r.width()>1&&r.height()>1)return new p(m.NA,T.WrongDimension);const i=r.data,a=[];for(let o=0;o<r.height();o++){const u=[];for(let l=0;l<r.width();l++){let c=!0;for(const d of n)if(Ul(d.data[o][l])!==!0){c=!1;break}c&&u.push(i[o][l])}u.length>0&&a.push(u)}return a.length>0?w.onlyValues(a):new p(m.NA,T.EmptyRange)})}filterArraySize(e,t){if(e.args.length<=1)return B.error();const r=this.metadata("FILTER"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new zt(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))}),i=Math.max(...n.map(o=>o.width)),a=Math.max(...n.map(o=>o.height));return new B(i,a)}}tc.implementedFunctions={ARRAYFORMULA:{method:"arrayformula",sizeOfResultArrayMethod:"arrayformulaArraySize",enableArrayArithmeticForArguments:!0,parameters:[{argumentType:h.ANY}]},ARRAY_CONSTRAIN:{method:"arrayconstrain",sizeOfResultArrayMethod:"arrayconstrainArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:1}],vectorizationForbidden:!0},FILTER:{method:"filter",sizeOfResultArrayMethod:"filterArraySize",enableArrayArithmeticForArguments:!0,parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class rc extends V{abs(e,t){return this.runFunction(e.args,t,this.metadata("ABS"),Math.abs)}}rc.implementedFunctions={ABS:{method:"abs",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const DT=0xffffffffffff,Ou=-53,Mu=53;class nc extends V{bitlshift(e,t){return this.runFunction(e.args,t,this.metadata("BITLSHIFT"),sc)}bitrshift(e,t){return this.runFunction(e.args,t,this.metadata("BITRSHIFT"),ic)}}nc.implementedFunctions={BITLSHIFT:{method:"bitlshift",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:Ou,maxValue:Mu}]},BITRSHIFT:{method:"bitrshift",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:Ou,maxValue:Mu}]}};function sc(s,e){return e<0?ic(s,-e):ac(s*Math.pow(2,e))}function ic(s,e){return e<0?sc(s,-e):ac(Math.floor(s/Math.pow(2,e)))}function ac(s){return s>DT?new p(m.NUM,T.BitshiftLong):s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class oc extends V{bitand(e,t){return this.runFunction(e.args,t,this.metadata("BITAND"),(r,n)=>r&n)}bitor(e,t){return this.runFunction(e.args,t,this.metadata("BITOR"),(r,n)=>r|n)}bitxor(e,t){return this.runFunction(e.args,t,this.metadata("BITXOR"),(r,n)=>r^n)}}oc.implementedFunctions={BITAND:{method:"bitand",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0}]},BITOR:{method:"bitor",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0}]},BITXOR:{method:"bitxor",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class uc extends V{literalTrue(e,t){return this.runFunction(e.args,t,this.metadata("TRUE"),()=>!0)}literalFalse(e,t){return this.runFunction(e.args,t,this.metadata("FALSE"),()=>!1)}conditionalIf(e,t){return this.runFunction(e.args,t,this.metadata("IF"),(r,n,i)=>r?n:i)}ifs(e,t){return this.runFunction(e.args,t,this.metadata("IFS"),(...r)=>{for(let n=0;n<r.length;n+=2)if(r[n])return r[n+1];return new p(m.NA,T.NoConditionMet)})}and(e,t){return this.runFunction(e.args,t,this.metadata("AND"),(...r)=>r.filter(n=>n!==void 0).every(n=>!!n))}or(e,t){return this.runFunction(e.args,t,this.metadata("OR"),(...r)=>r.filter(n=>n!==void 0).some(n=>n))}not(e,t){return this.runFunction(e.args,t,this.metadata("NOT"),r=>!r)}xor(e,t){return this.runFunction(e.args,t,this.metadata("XOR"),(...r)=>{let n=0;return r.filter(i=>i!==void 0).forEach(i=>{i&&n++}),n%2===1})}switch(e,t){return this.runFunction(e.args,t,this.metadata("SWITCH"),(r,...n)=>{const i=n.length;let a=0;for(;a+1<i;a+=2)if(!(n[a]instanceof p)&&this.arithmeticHelper.eq(r,n[a]))return n[a+1];return a<i?n[a]:new p(m.NA,T.NoDefault)})}iferror(e,t){return this.runFunction(e.args,t,this.metadata("IFERROR"),(r,n)=>r instanceof p?n:r)}ifna(e,t){return this.runFunction(e.args,t,this.metadata("IFNA"),(r,n)=>r instanceof p&&r.type===m.NA?n:r)}choose(e,t){return this.runFunction(e.args,t,this.metadata("CHOOSE"),(r,...n)=>r>n.length?new p(m.NUM,T.Selector):n[r-1])}}uc.implementedFunctions={TRUE:{method:"literalTrue",parameters:[]},FALSE:{method:"literalFalse",parameters:[]},IF:{method:"conditionalIf",parameters:[{argumentType:h.BOOLEAN},{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,defaultValue:!1,passSubtype:!0}]},IFS:{method:"ifs",parameters:[{argumentType:h.BOOLEAN},{argumentType:h.SCALAR,passSubtype:!0}],repeatLastArgs:2},AND:{method:"and",parameters:[{argumentType:h.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},OR:{method:"or",parameters:[{argumentType:h.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},XOR:{method:"xor",parameters:[{argumentType:h.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},NOT:{method:"not",parameters:[{argumentType:h.BOOLEAN}]},SWITCH:{method:"switch",parameters:[{argumentType:h.NOERROR},{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,passSubtype:!0}],repeatLastArgs:1},IFERROR:{method:"iferror",parameters:[{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,passSubtype:!0}]},IFNA:{method:"ifna",parameters:[{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,passSubtype:!0}]},CHOOSE:{method:"choose",parameters:[{argumentType:h.INTEGER,minValue:1},{argumentType:h.SCALAR,passSubtype:!0}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class hc extends V{char(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),r=>r<1||r>=256?new p(m.VALUE,T.CharacterCodeBounds):String.fromCharCode(Math.trunc(r)))}unichar(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),r=>r<1||r>=1114112?new p(m.VALUE,T.CharacterCodeBounds):String.fromCodePoint(Math.trunc(r)))}}hc.implementedFunctions={CHAR:{method:"char",parameters:[{argumentType:h.NUMBER}]},UNICHAR:{method:"unichar",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class lc extends V{code(e,t){return this.runFunction(e.args,t,this.metadata("CODE"),r=>r.length===0?new p(m.VALUE,T.EmptyString):r.charCodeAt(0))}unicode(e,t){return this.runFunction(e.args,t,this.metadata("UNICODE"),r=>{var n;return(n=r.codePointAt(0))!==null&&n!==void 0?n:new p(m.VALUE,T.EmptyString)})}}lc.implementedFunctions={CODE:{method:"code",parameters:[{argumentType:h.STRING}]},UNICODE:{method:"unicode",parameters:[{argumentType:h.STRING}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class cc extends V{countblank(e,t){return this.runFunction(e.args,t,this.metadata("COUNTBLANK"),(...r)=>{let n=0;return r.forEach(i=>{i===G&&n++}),n})}}cc.implementedFunctions={COUNTBLANK:{method:"countblank",parameters:[{argumentType:h.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class dc extends V{countunique(e,t){return this.runFunction(e.args,t,this.metadata("COUNTUNIQUE"),(...r)=>{const n=new Set,i=new Set;for(const a of r)a instanceof p?i.add(a.type):a!==""&&n.add(a);return n.size+i.size})}}dc.implementedFunctions={COUNTUNIQUE:{method:"countunique",parameters:[{argumentType:h.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pc extends V{constructor(){super(...arguments),this.isoweeknumCore=e=>{const t=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),r=this.dateTimeHelper.numberToSimpleDate(e),n=this.dateTimeHelper.dateToNumber({year:r.year,month:1,day:1}),i=this.dateTimeHelper.relativeNumberToAbsoluteNumber(n),a=i+((4-i)%7+7)%7,o=Math.floor((t-1)/7)-Math.floor((a-1)/7)+1;return o===0?this.isoweeknumCore(e-7)+1:o},this.days360Core=(e,t,r)=>{const n=this.dateTimeHelper.numberToSimpleDate(e),i=this.dateTimeHelper.numberToSimpleDate(t);let a,o;return r?(a=mu(n),o=mu(i)):[a,o]=this.dateTimeHelper.toBasisUS(n,i),360*(o.year-a.year)+30*(o.month-a.month)+o.day-a.day}}date(e,t){return this.runFunction(e.args,t,this.metadata("DATE"),(r,n,i)=>{const a=Math.trunc(i);let o=Math.trunc(n),u=Math.trunc(r);u<this.dateTimeHelper.getEpochYearZero()&&(u+=this.dateTimeHelper.getEpochYearZero());const l=Math.floor((o-1)/12);u+=l,o-=l*12;const c={year:u,month:o,day:1};if(this.dateTimeHelper.isValidDate(c)){let d=this.dateTimeHelper.dateToNumber(c)+(a-1);return d=this.dateTimeHelper.getWithinBounds(d),d===void 0?new p(m.NUM,T.DateBounds):d}return new p(m.VALUE,T.InvalidDate)})}time(e,t){return this.runFunction(e.args,t,this.metadata("TIME"),(r,n,i)=>{const a=Rn({hours:Math.trunc(r),minutes:Math.trunc(n),seconds:Math.trunc(i)});return a<0?new p(m.NUM,T.NegativeTime):a%1})}eomonth(e,t){return this.runFunction(e.args,t,this.metadata("EOMONTH"),(r,n)=>{const i=this.dateTimeHelper.numberToSimpleDate(r);let a=this.dateTimeHelper.dateToNumber(this.dateTimeHelper.endOfMonth(fu(i,n)));return a=this.dateTimeHelper.getWithinBounds(a),a===void 0?new p(m.NUM,T.DateBounds):a})}day(e,t){return this.runFunction(e.args,t,this.metadata("DAY"),r=>this.dateTimeHelper.numberToSimpleDate(r).day)}days(e,t){return this.runFunction(e.args,t,this.metadata("DAYS"),(r,n)=>Math.trunc(r)-Math.trunc(n))}month(e,t){return this.runFunction(e.args,t,this.metadata("MONTH"),r=>this.dateTimeHelper.numberToSimpleDate(r).month)}year(e,t){return this.runFunction(e.args,t,this.metadata("YEAR"),r=>this.dateTimeHelper.numberToSimpleDate(r).year)}hour(e,t){return this.runFunction(e.args,t,this.metadata("HOUR"),r=>En(ji(r)%1).hours)}minute(e,t){return this.runFunction(e.args,t,this.metadata("MINUTE"),r=>En(ji(r)%1).minutes)}second(e,t){return this.runFunction(e.args,t,this.metadata("SECOND"),r=>En(ji(r)%1).seconds)}text(e,t){return this.runFunction(e.args,t,this.metadata("TEXT"),(r,n)=>AR(r,n,this.config,this.dateTimeHelper))}weekday(e,t){return this.runFunction(e.args,t,this.metadata("WEEKDAY"),(r,n)=>{const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(r));if(n===3)return(i-1)%7;const a=Lu.get(n);return a===void 0?new p(m.NUM,T.BadMode):(i-a)%7+1})}weeknum(e,t){return this.runFunction(e.args,t,this.metadata("WEEKNUM"),(r,n)=>{const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(r)),a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.dateToNumber({year:a.year,month:1,day:1}),u=this.dateTimeHelper.relativeNumberToAbsoluteNumber(o);if(n===21)return this.isoweeknumCore(r);const l=Lu.get(n);return l===void 0?new p(m.NUM,T.BadMode):Math.floor((i-l)/7)-Math.floor((u-l)/7)+1})}isoweeknum(e,t){return this.runFunction(e.args,t,this.metadata("ISOWEEKNUM"),this.isoweeknumCore)}datevalue(e,t){return this.runFunction(e.args,t,this.metadata("DATEVALUE"),r=>{const{dateTime:n}=this.dateTimeHelper.parseDateTimeFromConfigFormats(r);return n===void 0?new p(m.VALUE,T.IncorrectDateTime):Xn(n)?(kl(n)?Math.trunc(Rn(n)):0)+this.dateTimeHelper.dateToNumber(n):0})}timevalue(e,t){return this.runFunction(e.args,t,this.metadata("TIMEVALUE"),r=>{const n=this.dateTimeHelper.dateStringToDateNumber(r);return n===void 0?new p(m.VALUE,T.IncorrectDateTime):O(n)%1})}now(e,t){return this.runFunction(e.args,t,this.metadata("NOW"),()=>{const r=new Date(Date.now());return Rn({hours:r.getHours(),minutes:r.getMinutes(),seconds:r.getSeconds()})+this.dateTimeHelper.dateToNumber({year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()})})}today(e,t){return this.runFunction(e.args,t,this.metadata("TODAY"),()=>{const r=new Date(Date.now());return this.dateTimeHelper.dateToNumber({year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()})})}edate(e,t){return this.runFunction(e.args,t,this.metadata("EDATE"),(r,n)=>{const i=this.dateTimeHelper.numberToSimpleDate(r),a=ER(fu(i,n));let o=this.dateTimeHelper.dateToNumber(a);return o=this.dateTimeHelper.getWithinBounds(o),o===void 0?new p(m.NUM,T.DateBounds):o})}datedif(e,t){return this.runFunction(e.args,t,this.metadata("DATEDIF"),(r,n,i)=>{if(r>n)return new p(m.NUM,T.StartEndDate);if(i==="D")return Math.floor(n)-Math.floor(r);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);switch(i){case"M":return(o.year-a.year)*12+(o.month-a.month)-(o.day<a.day?1:0);case"YM":return(12+(o.month-a.month)-(o.day<a.day?1:0))%12;case"Y":return o.month>a.month||o.month===a.month&&o.day>=a.day?o.year-a.year:o.year-a.year-1;case"MD":if(o.day>=a.day)return o.day-a.day;{const u=o.month===1?12:o.month-1,l=o.month===1?o.year-1:o.year;return this.dateTimeHelper.daysInMonth(l,u)+o.day-a.day}case"YD":return o.month>a.month||o.month===a.month&&o.day>=a.day?Math.floor(n)-this.dateTimeHelper.dateToNumber({year:o.year,month:a.month,day:a.day}):Math.floor(n)-Math.floor(r)-365*(o.year-a.year-1)-this.dateTimeHelper.leapYearsCount(o.year-1)+this.dateTimeHelper.leapYearsCount(a.year);default:return new p(m.NUM,T.BadMode)}})}days360(e,t){return this.runFunction(e.args,t,this.metadata("DAYS360"),this.days360Core)}yearfrac(e,t){return this.runFunction(e.args,t,this.metadata("YEARFRAC"),(r,n,i)=>{switch(r=Math.trunc(r),n=Math.trunc(n),r>n&&([r,n]=[n,r]),i){case 0:return this.days360Core(r,n,!1)/360;case 1:return(n-r)/this.dateTimeHelper.yearLengthForBasis(this.dateTimeHelper.numberToSimpleDate(r),this.dateTimeHelper.numberToSimpleDate(n));case 2:return(n-r)/360;case 3:return(n-r)/365;case 4:return this.days360Core(r,n,!0)/360}throw new Error("Should not be reachable.")})}interval(e,t){return this.runFunction(e.args,t,this.metadata("INTERVAL"),r=>{r=Math.trunc(r);const n=r%60;r=Math.trunc(r/60);const i=r%60;r=Math.trunc(r/60);const a=r%24;r=Math.trunc(r/24);const o=r%30;r=Math.trunc(r/30);const u=r%12,l=Math.trunc(r/12);return"P"+(l>0?`${l}Y`:"")+(u>0?`${u}M`:"")+(o>0?`${o}D`:"")+"T"+(a>0?`${a}H`:"")+(i>0?`${i}M`:"")+(n>0?`${n}S`:"")})}networkdays(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS"),(r,n,i)=>this.networkdayscore(r,n,1,i))}networkdaysintl(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS.INTL"),(r,n,i,a)=>this.networkdayscore(r,n,i,a))}workday(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY"),(r,n,i)=>this.workdaycore(r,n,1,i))}workdayintl(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY.INTL"),(r,n,i,a)=>this.workdaycore(r,n,i,a))}networkdayscore(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t);let i=1;e>t&&([e,t]=[t,e],i=-1);const a=_u(r);if(a instanceof p)return a;const o=this.simpleRangeToFilteredHolidays(a,n);return o instanceof p?o:i*this.countWorkdays(e,t,a,o)}workdaycore(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t);const i=_u(r);if(i instanceof p)return i;const a=this.simpleRangeToFilteredHolidays(i,n);if(a instanceof p)return a;if(t>0){let o=1;for(;this.countWorkdays(e+1,e+o,i,a)<t;)o*=2;let u=1;for(;u+1<o;){const l=Math.trunc((u+o)/2);this.countWorkdays(e+1,e+l,i,a)<t?u=l:o=l}return e+o}else if(t<0){t*=-1;let o=1;for(;this.countWorkdays(e-o,e-1,i,a)<t;)o*=2;let u=1;for(;u+1<o;){const l=Math.trunc((u+o)/2);this.countWorkdays(e-l,e-1,i,a)<t?u=l:o=l}return e-o}else return e}countWorkdays(e,t,r,n){const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(t)),a=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e));let o=0;for(let u=0;u<7;u++)r.charAt(u)==="0"&&(o+=Math.floor((i+6-u)/7),o-=Math.floor((a-1+6-u)/7));return o-=wu(t+1,n)-wu(e,n),o}simpleRangeToFilteredHolidays(e,t){var r;const n=(r=t?.valuesFromTopLeftCorner())!==null&&r!==void 0?r:[];for(const a of n)if(a instanceof p)return a;const i=[];for(const a of n)if(a!==G)if(j(a))i.push(Math.trunc(O(a)));else return new p(m.VALUE,T.WrongType);return[...new Set(i)].sort((a,o)=>a-o).filter(a=>{const u=(this.dateTimeHelper.relativeNumberToAbsoluteNumber(a)-1)%7;return e.charAt(u)==="0"})}}pc.implementedFunctions={DATE:{method:"date",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_DATE},TIME:{method:"time",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_TIME},MONTH:{method:"month",parameters:[{argumentType:h.NUMBER,minValue:0}]},YEAR:{method:"year",parameters:[{argumentType:h.NUMBER,minValue:0}]},HOUR:{method:"hour",parameters:[{argumentType:h.NUMBER,minValue:0}]},MINUTE:{method:"minute",parameters:[{argumentType:h.NUMBER,minValue:0}]},SECOND:{method:"second",parameters:[{argumentType:h.NUMBER,minValue:0}]},TEXT:{method:"text",parameters:[{argumentType:h.NUMBER},{argumentType:h.STRING}]},EOMONTH:{method:"eomonth",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_DATE},DAY:{method:"day",parameters:[{argumentType:h.NUMBER,minValue:0}]},DAYS:{method:"days",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0}]},WEEKDAY:{method:"weekday",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,defaultValue:1}]},WEEKNUM:{method:"weeknum",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,defaultValue:1}]},ISOWEEKNUM:{method:"isoweeknum",parameters:[{argumentType:h.NUMBER,minValue:0}]},DATEVALUE:{method:"datevalue",parameters:[{argumentType:h.STRING}],returnNumberType:L.NUMBER_DATE},TIMEVALUE:{method:"timevalue",parameters:[{argumentType:h.STRING}],returnNumberType:L.NUMBER_TIME},NOW:{method:"now",parameters:[],isVolatile:!0,returnNumberType:L.NUMBER_DATETIME},TODAY:{method:"today",parameters:[],isVolatile:!0,returnNumberType:L.NUMBER_DATE},EDATE:{method:"edate",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_DATE},DAYS360:{method:"days360",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.BOOLEAN,defaultValue:!1}]},DATEDIF:{method:"datedif",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.STRING}]},YEARFRAC:{method:"yearfrac",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.INTEGER,defaultValue:0,minValue:0,maxValue:4}]},INTERVAL:{method:"interval",parameters:[{argumentType:h.NUMBER,minValue:0}]},NETWORKDAYS:{method:"networkdays",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.RANGE,optionalArg:!0}]},"NETWORKDAYS.INTL":{method:"networkdaysintl",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NOERROR,defaultValue:1},{argumentType:h.RANGE,optionalArg:!0}]},WORKDAY:{method:"workday",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER},{argumentType:h.RANGE,optionalArg:!0}]},"WORKDAY.INTL":{method:"workdayintl",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER},{argumentType:h.NOERROR,defaultValue:1},{argumentType:h.RANGE,optionalArg:!0}]}};function wu(s,e){if(e.length===0||s<=e[0])return 0;if(e[e.length-1]<s)return e.length;let t=0,r=e.length-1;for(;t+1<r;){const n=Math.floor((r+t)/2);e[n]>=s?r=n:t=n}return r}function _u(s){var e;return typeof s!="number"&&typeof s!="string"?new p(m.VALUE,T.WrongType):typeof s=="string"?s.length!==7||!/^(0|1)*$/.test(s)||s==="1111111"?new p(m.NUM,T.WeekendString):s:(e=VT.get(s))!==null&&e!==void 0?e:new p(m.NUM,T.BadMode)}const Lu=new Map([[1,0],[2,1],[11,1],[12,2],[13,3],[14,4],[15,5],[16,6],[17,0]]),VT=new Map([[1,"0000011"],[2,"1000001"],[3,"1100000"],[4,"0110000"],[5,"0011000"],[6,"0001100"],[7,"0000110"],[11,"0000001"],[12,"1000000"],[13,"0100000"],[14,"0010000"],[15,"0001000"],[16,"0000100"],[17,"0000010"]]);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class fc extends V{degrees(e,t){return this.runFunction(e.args,t,this.metadata("DEGREES"),r=>r*(180/Math.PI))}}fc.implementedFunctions={DEGREES:{method:"degrees",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mc extends V{delta(e,t){return this.runFunction(e.args,t,this.metadata("DELTA"),(r,n)=>r===n?1:0)}}mc.implementedFunctions={DELTA:{method:"delta",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class gc extends V{exp(e,t){return this.runFunction(e.args,t,this.metadata("EXP"),Math.exp)}}gc.implementedFunctions={EXP:{method:"exp",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ec extends V{pmt(e,t){return this.runFunction(e.args,t,this.metadata("PMT"),po)}ipmt(e,t){return this.runFunction(e.args,t,this.metadata("IPMT"),La)}ppmt(e,t){return this.runFunction(e.args,t,this.metadata("PPMT"),Fu)}fv(e,t){return this.runFunction(e.args,t,this.metadata("FV"),Fa)}cumipmt(e,t){return this.runFunction(e.args,t,this.metadata("CUMIPMT"),(r,n,i,a,o,u)=>{if(a>o)return new p(m.NUM,T.EndStartPeriod);let l=0;for(let c=a;c<=o;c++)l+=La(r,c,n,i,0,u);return l})}cumprinc(e,t){return this.runFunction(e.args,t,this.metadata("CUMPRINC"),(r,n,i,a,o,u)=>{if(a>o)return new p(m.NUM,T.EndStartPeriod);let l=0;for(let c=a;c<=o;c++)l+=Fu(r,c,n,i,0,u);return l})}db(e,t){return this.runFunction(e.args,t,this.metadata("DB"),(r,n,i,a,o)=>{if(o===12&&a>i||a>i+1)return new p(m.NUM,T.PeriodLong);if(n>=r)return 0;const u=Math.round((1-Math.pow(n/r,1/i))*1e3)/1e3,l=r*u*o/12;if(a===1)return l;let c=l;for(let d=0;d<a-2;d++)c+=(r-c)*u;return a===i+1?(r-c)*u*(12-o)/12:(r-c)*u})}ddb(e,t){return this.runFunction(e.args,t,this.metadata("DDB"),(r,n,i,a,o)=>{if(a>i)return new p(m.NUM);let u=o/i,l;u>=1?(u=1,a===1?l=r:l=0):l=r*Math.pow(1-u,a-1);const c=r*Math.pow(1-u,a);return Math.max(l-Math.max(n,c),0)})}dollarde(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARDE"),(r,n)=>{if(n<1)return new p(m.DIV_BY_ZERO);for(n=Math.trunc(n);n>10;)n/=10;return Math.trunc(r)+(r-Math.trunc(r))*10/n})}dollarfr(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARFR"),(r,n)=>{if(n<1)return new p(m.DIV_BY_ZERO);for(n=Math.trunc(n);n>10;)n/=10;return Math.trunc(r)+(r-Math.trunc(r))*n/10})}effect(e,t){return this.runFunction(e.args,t,this.metadata("EFFECT"),(r,n)=>(n=Math.trunc(n),Math.pow(1+r/n,n)-1))}ispmt(e,t){return this.runFunction(e.args,t,this.metadata("ISPMT"),(r,n,i,a)=>i===0?new p(m.DIV_BY_ZERO):a*r*(n/i-1))}nominal(e,t){return this.runFunction(e.args,t,this.metadata("NOMINAL"),(r,n)=>(n=Math.trunc(n),(Math.pow(r+1,1/n)-1)*n))}nper(e,t){return this.runFunction(e.args,t,this.metadata("NPER"),(r,n,i,a,o)=>r===0?n===0?new p(m.DIV_BY_ZERO):(-i-a)/n:(o&&(n*=1+r),Math.log((n-a*r)/(i*r+n))/Math.log(1+r)))}rate(e,t){return this.runFunction(e.args,t,this.metadata("RATE"),(r,n,i,a,o,u)=>{if(u<=-1)return new p(m.VALUE);const l=1e-7,c=50;let d=u;o=o?1:0;for(let f=0;f<c;f++){if(d<=-1)return new p(m.NUM);let E;if(Math.abs(d)<l)E=i*(1+r*d)+n*(1+d*o)*r+a;else{const R=Math.pow(1+d,r);E=i*R+n*(1/d+o)*(R-1)+a}if(Math.abs(E)<l)return d;let N;if(Math.abs(d)<l)N=i*r+n*o*r;else{const R=Math.pow(1+d,r),y=r*Math.pow(1+d,r-1);N=i*y+n*(1/d+o)*y+n*(-1/(d*d))*(R-1)}d-=E/N}return new p(m.NUM)})}pv(e,t){return this.runFunction(e.args,t,this.metadata("PV"),(r,n,i,a,o)=>(o=o?1:0,r===-1?n===0?new p(m.NUM):new p(m.DIV_BY_ZERO):r===0?-i*n-a:((1-Math.pow(1+r,n))*i*(1+r*o)/r-a)/Math.pow(1+r,n)))}rri(e,t){return this.runFunction(e.args,t,this.metadata("RRI"),(r,n,i)=>n===0||i<0&&n>0||i>0&&n<0?new p(m.NUM):Math.pow(i/n,1/r)-1)}sln(e,t){return this.runFunction(e.args,t,this.metadata("SLN"),(r,n,i)=>i===0?new p(m.DIV_BY_ZERO):(r-n)/i)}syd(e,t){return this.runFunction(e.args,t,this.metadata("SYD"),(r,n,i,a)=>a>i?new p(m.NUM):(r-n)*(i-a+1)*2/(i*(i+1)))}tbilleq(e,t){return this.runFunction(e.args,t,this.metadata("TBILLEQ"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new p(m.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);if(o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day))return new p(m.NUM);const u=360-i*(n-r);return u===0?0:u<0?new p(m.NUM):365*i/u})}tbillprice(e,t){return this.runFunction(e.args,t,this.metadata("TBILLPRICE"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new p(m.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);if(o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day))return new p(m.NUM);const u=360-i*(n-r);return u===0?0:u<0?new p(m.NUM):100*(1-i*(n-r)/360)})}tbillyield(e,t){return this.runFunction(e.args,t,this.metadata("TBILLYIELD"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new p(m.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);return o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day)?new p(m.NUM):(100-i)*360/(i*(n-r))})}fvschedule(e,t){return this.runFunction(e.args,t,this.metadata("FVSCHEDULE"),(r,n)=>{const i=n.valuesFromTopLeftCorner();for(const a of i)if(a instanceof p)return a;for(const a of i)if(j(a))r*=1+O(a);else if(a!==G)return new p(m.VALUE,T.NumberExpected);return r})}npv(e,t){return this.runFunction(e.args,t,this.metadata("NPV"),(r,...n)=>{const i=this.arithmeticHelper.coerceNumbersExactRanges(n);return i instanceof p?i:Zi(r,i)})}mirr(e,t){return this.runFunction(e.args,t,this.metadata("MIRR"),(r,n,i)=>{const a=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());if(a instanceof p)return a;let o=!1,u=!1;const l=[],c=[];for(const N of a)N>0?(o=!0,l.push(N),c.push(0)):N<0?(u=!0,c.push(N),l.push(0)):(c.push(0),l.push(0));if(!o||!u)return new p(m.DIV_BY_ZERO);const d=a.length,f=Zi(i,l);if(f instanceof p)return f;const E=Zi(n,c);return E instanceof p?E:Math.pow(-f*Math.pow(1+i,d)/E/(1+n),1/(d-1))-1})}pduration(e,t){return this.runFunction(e.args,t,this.metadata("PDURATION"),(r,n,i)=>(Math.log(i)-Math.log(n))/Math.log(1+r))}xnpv(e,t){return this.runFunction(e.args,t,this.metadata("XNPV"),(r,n,i)=>{const a=n.valuesFromTopLeftCorner();for(const f of a)if(typeof f!="number")return new p(m.VALUE,T.NumberExpected);const o=a,u=i.valuesFromTopLeftCorner();for(const f of u)if(typeof f!="number")return new p(m.VALUE,T.NumberExpected);const l=u;if(l.length!==o.length)return new p(m.NUM,T.EqualLength);const c=l.length;let d=0;if(l[0]<0)return new p(m.NUM,T.ValueSmall);for(let f=0;f<c;f++){if(l[f]=Math.floor(l[f]),l[f]<l[0])return new p(m.NUM,T.ValueSmall);d+=o[f]/Math.pow(1+r,(l[f]-l[0])/365)}return d})}}Ec.implementedFunctions={PMT:{method:"pmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:L.NUMBER_CURRENCY},IPMT:{method:"ipmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:L.NUMBER_CURRENCY},PPMT:{method:"ppmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:L.NUMBER_CURRENCY},FV:{method:"fv",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:L.NUMBER_CURRENCY},CUMIPMT:{method:"cumipmt",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:0,maxValue:1}],returnNumberType:L.NUMBER_CURRENCY},CUMPRINC:{method:"cumprinc",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:0,maxValue:1}],returnNumberType:L.NUMBER_CURRENCY},DB:{method:"db",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:1,maxValue:12,defaultValue:12}],returnNumberType:L.NUMBER_CURRENCY},DDB:{method:"ddb",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.INTEGER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0,defaultValue:2}],returnNumberType:L.NUMBER_CURRENCY},DOLLARDE:{method:"dollarde",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},DOLLARFR:{method:"dollarfr",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},EFFECT:{method:"effect",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1}],returnNumberType:L.NUMBER_PERCENT},ISPMT:{method:"ispmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},NOMINAL:{method:"nominal",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1}],returnNumberType:L.NUMBER_PERCENT},NPER:{method:"nper",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}]},PV:{method:"pv",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:L.NUMBER_CURRENCY},RATE:{method:"rate",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:.1}],returnNumberType:L.NUMBER_PERCENT},RRI:{method:"rri",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_PERCENT},SLN:{method:"sln",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_CURRENCY},SYD:{method:"syd",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:L.NUMBER_CURRENCY},TBILLEQ:{method:"tbilleq",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:L.NUMBER_PERCENT},TBILLPRICE:{method:"tbillprice",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:L.NUMBER_CURRENCY},TBILLYIELD:{method:"tbillyield",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:L.NUMBER_PERCENT},FVSCHEDULE:{method:"fvschedule",parameters:[{argumentType:h.NUMBER},{argumentType:h.RANGE}],returnNumberType:L.NUMBER_CURRENCY},NPV:{method:"npv",parameters:[{argumentType:h.NUMBER},{argumentType:h.ANY}],repeatLastArgs:1,returnNumberType:L.NUMBER_CURRENCY},MIRR:{method:"mirr",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:L.NUMBER_PERCENT},PDURATION:{method:"pduration",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0}]},XNPV:{method:"xnpv",parameters:[{argumentType:h.NUMBER,greaterThan:-1},{argumentType:h.RANGE},{argumentType:h.RANGE}]}};function po(s,e,t,r,n){if(s===0)return(-t-r)/e;{const i=Math.pow(1+s,e);return(r*s+t*s*i)*(n?1/(1+s):1)/(1-i)}}function La(s,e,t,r,n,i){const a=po(s,t,r,n,i);return e===1?s*(i?0:-r):s*(i?Fa(s,e-2,a,r,i)-a:Fa(s,e-1,a,r,i))}function Fa(s,e,t,r,n){if(s===0)return-r-t*e;{const i=Math.pow(1+s,e);return t*(n?1+s:1)*(1-i)/s-r*i}}function Fu(s,e,t,r,n,i){return po(s,t,r,n,i)-La(s,e,t,r,n,i)}function Zi(s,e){let t=0;for(let r=e.length-1;r>=0;r--){if(t+=e[r],s===-1){if(t===0)continue;return new p(m.DIV_BY_ZERO)}t/=1+s}return t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Rc extends V{formulatext(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("FORMULATEXT"),()=>new p(m.NA,T.WrongArgNumber),r=>{var n;return(n=this.serialization.getCellFormula(r))!==null&&n!==void 0?n:new p(m.NA,T.Formula)})}}Rc.implementedFunctions={FORMULATEXT:{method:"formulatext",parameters:[{argumentType:h.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,isDependentOnSheetStructureChange:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Tc extends V{hyperlink(e,t){return this.runFunction(e.args,t,this.metadata("HYPERLINK"),(r,n)=>(e.hyperlink=r,n??r))}}Tc.implementedFunctions={HYPERLINK:{method:"hyperlink",parameters:[{argumentType:h.STRING},{argumentType:h.STRING,optionalArg:!0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Nc extends V{isbinary(e,t){return this.runFunction(e.args,t,this.metadata("ISBINARY"),r=>/^[01]{1,10}$/.test(r))}iserr(e,t){return this.runFunction(e.args,t,this.metadata("ISERR"),r=>r instanceof p&&r.type!==m.NA)}iserror(e,t){return this.runFunction(e.args,t,this.metadata("ISERROR"),r=>r instanceof p)}isformula(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ISFORMULA"),()=>new p(m.NA,T.WrongArgNumber),r=>this.dependencyGraph.addressMapping.getCell(r)instanceof ct)}isblank(e,t){return this.runFunction(e.args,t,this.metadata("ISBLANK"),r=>r===G)}isna(e,t){return this.runFunction(e.args,t,this.metadata("ISNA"),r=>r instanceof p&&r.type==m.NA)}isnumber(e,t){return this.runFunction(e.args,t,this.metadata("ISNUMBER"),j)}islogical(e,t){return this.runFunction(e.args,t,this.metadata("ISLOGICAL"),r=>typeof r=="boolean")}isref(e,t){return this.runFunction(e.args,t,this.metadata("ISREF"),r=>r instanceof p&&(r.type==m.REF||r.type==m.CYCLE))}istext(e,t){return this.runFunction(e.args,t,this.metadata("ISTEXT"),r=>typeof r=="string")}isnontext(e,t){return this.runFunction(e.args,t,this.metadata("ISNONTEXT"),r=>typeof r!="string")}column(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("COLUMN"),()=>t.formulaAddress.col+1,r=>r.col+1)}columns(e,t){if(e.args.length!==1)return new p(m.NA,T.WrongArgNumber);if(e.args.some(n=>n.type===g.EMPTY))return new p(m.NUM,T.EmptyArg);let r=e.args[0];for(;r.type===g.PARENTHESIS;)r=r.expression;if(r.type===g.CELL_RANGE||r.type===g.COLUMN_RANGE)return r.end.col-r.start.col+1;if(r.type===g.CELL_REFERENCE)return 1;if(r.type===g.ROW_RANGE)return this.config.maxColumns;{const n=this.evaluateAst(r,t);return n instanceof w?n.width():n instanceof p?n:1}}row(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ROW"),()=>t.formulaAddress.row+1,r=>r.row+1)}rows(e,t){if(e.args.length!==1)return new p(m.NA,T.WrongArgNumber);if(e.args.some(n=>n.type===g.EMPTY))return new p(m.NUM,T.EmptyArg);let r=e.args[0];for(;r.type===g.PARENTHESIS;)r=r.expression;if(r.type===g.CELL_RANGE||r.type===g.ROW_RANGE)return r.end.row-r.start.row+1;if(r.type===g.CELL_REFERENCE)return 1;if(r.type===g.COLUMN_RANGE)return this.config.maxRows;{const n=this.evaluateAst(r,t);return n instanceof w?n.height():n instanceof p?n:1}}index(e,t){return this.runFunction(e.args,t,this.metadata("INDEX"),(r,n,i)=>{var a,o,u,l,c,d;return i<1||n<1?new p(m.VALUE,T.LessThanOne):i>r.width()||n>r.height()?new p(m.NUM,T.ValueLarge):(d=(u=(o=(a=r?.data)===null||a===void 0?void 0:a[n-1])===null||o===void 0?void 0:o[i-1])!==null&&u!==void 0?u:(c=(l=r?.data)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c[0])!==null&&d!==void 0?d:new p(m.VALUE,T.CellRangeExpected)})}na(e,t){return new p(m.NA)}sheet(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEET"),()=>t.formulaAddress.sheet+1,r=>r.sheet+1,r=>{const n=this.dependencyGraph.sheetMapping.get(r);return n!==void 0?n+1:new p(m.NA,T.SheetRef)})}sheets(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEETS"),()=>this.dependencyGraph.sheetMapping.numberOfSheets(),()=>1,()=>new p(m.VALUE,T.CellRefExpected))}}Nc.implementedFunctions={COLUMN:{method:"column",parameters:[{argumentType:h.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},COLUMNS:{method:"columns",parameters:[{argumentType:h.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISBINARY:{method:"isbinary",parameters:[{argumentType:h.STRING}]},ISERR:{method:"iserr",parameters:[{argumentType:h.SCALAR}]},ISFORMULA:{method:"isformula",parameters:[{argumentType:h.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISNA:{method:"isna",parameters:[{argumentType:h.SCALAR}]},ISREF:{method:"isref",parameters:[{argumentType:h.SCALAR}],vectorizationForbidden:!0},ISERROR:{method:"iserror",parameters:[{argumentType:h.SCALAR}]},ISBLANK:{method:"isblank",parameters:[{argumentType:h.SCALAR}]},ISNUMBER:{method:"isnumber",parameters:[{argumentType:h.SCALAR}]},ISLOGICAL:{method:"islogical",parameters:[{argumentType:h.SCALAR}]},ISTEXT:{method:"istext",parameters:[{argumentType:h.SCALAR}]},ISNONTEXT:{method:"isnontext",parameters:[{argumentType:h.SCALAR}]},INDEX:{method:"index",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1}]},NA:{method:"na",parameters:[]},ROW:{method:"row",parameters:[{argumentType:h.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ROWS:{method:"rows",parameters:[{argumentType:h.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEET:{method:"sheet",parameters:[{argumentType:h.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEETS:{method:"sheets",parameters:[{argumentType:h.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Sc extends V{iseven(e,t){return this.runFunction(e.args,t,this.metadata("ISEVEN"),r=>r%2===0)}}Sc.implementedFunctions={ISEVEN:{method:"iseven",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class yc extends V{isodd(e,t){return this.runFunction(e.args,t,this.metadata("ISODD"),r=>r%2===1)}}yc.implementedFunctions={ISODD:{method:"isodd",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ac extends V{log10(e,t){return this.runFunction(e.args,t,this.metadata("LOG10"),Math.log10)}log(e,t){return this.runFunction(e.args,t,this.metadata("LOG"),(r,n)=>Math.log(r)/Math.log(n))}ln(e,t){return this.runFunction(e.args,t,this.metadata("LN"),Math.log)}}Ac.implementedFunctions={LOG10:{method:"log10",parameters:[{argumentType:h.NUMBER}]},LOG:{method:"log",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,defaultValue:10,greaterThan:0}]},LN:{method:"ln",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Ua=parseFloat(Math.PI.toFixed(14));class Cc extends V{pi(e,t){return this.runFunction(e.args,t,this.metadata("PI"),()=>Ua)}sqrtpi(e,t){return this.runFunction(e.args,t,this.metadata("SQRTPI"),r=>Math.sqrt(Ua*r))}}Cc.implementedFunctions={PI:{method:"pi",parameters:[]},SQRTPI:{method:"sqrtpi",parameters:[{argumentType:h.NUMBER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Uu(s,e){return new B(e.width,s.height)}function Ji(s,e,t){return new B(1+(s.width-e)/t,1+(s.height-e)/t)}class vc extends V{mmult(e,t){return this.runFunction(e.args,t,this.metadata("MMULT"),(r,n)=>{if(!r.hasOnlyNumbers()||!n.hasOnlyNumbers())return new p(m.VALUE,T.NumberRange);if(n.height()!==r.width())return new p(m.VALUE,T.ArrayDimensions);const i=Uu(r.size,n.size),a=this.createKernel(function(o,u,l){let c=0;for(let d=0;d<l;++d)c+=o[this.thread.y][d]*u[d][this.thread.x];return c},i)(r.rawNumbers(),n.rawNumbers(),r.width());return w.onlyNumbers(a)})}mmultArraySize(e,t){if(e.args.length!==2)return B.error();const r=this.metadata("MMULT"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new zt(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))}),[i,a]=n;return Uu(i,a)}maxpool(e,t){return this.runFunction(e.args,t,this.metadata("MAXPOOL"),(r,n,i=n)=>{if(!r.hasOnlyNumbers())return new p(m.VALUE,T.NumberRange);const a=Ji(r.size,n,i),o=this.createKernel(function(u,l,c){const d=this.thread.x*c,f=this.thread.y*c;let E=u[f][d];for(let N=0;N<l;N++)for(let R=0;R<l;R++)E=Math.max(E,u[f+N][d+R]);return E},a)(r.rawNumbers(),n,i);return w.onlyNumbers(o)})}medianpool(e,t){return this.runFunction(e.args,t,this.metadata("MEDIANPOOL"),(r,n,i=n)=>{if(!r.hasOnlyNumbers())return new p(m.VALUE,T.NumberRange);const a=Ji(r.size,n,i),o=this.createKernel(function(u,l,c){const d=this.thread.x*c,f=this.thread.y*c;let E=u[f][d];for(let C=0;C<l;C++)for(let I=0;I<l;I++)E=Math.max(E,u[f+C][d+I]);let N=u[f][d];for(let C=0;C<l;C++)for(let I=0;I<l;I++)N=Math.min(N,u[f+C][d+I]);const R=l*l;let y=N,S=E,A=42;for(let C=0;C<32;C++){const I=(y+S)/2;let oe=0;for(let Q=0;Q<l;Q++)for(let ee=0;ee<l;ee++)u[f+Q][d+ee]>I&&oe++;if(l%2===0)if(oe===R/2){A=I;break}else oe>R/2?y=I:S=I;else if(oe===(R-1)/2){A=I;break}else oe>(R-1)/2?y=I:S=I}return A},a)(r.rawNumbers(),n,i);return w.onlyNumbers(o)})}maxpoolArraySize(e,t){if(e.args.length<2||e.args.length>3)return B.error();const r=this.metadata("MAXPOOL"),i=e.args.map(l=>{var c;return this.arraySizeForAst(l,new zt(t.formulaAddress,t.arraysFlag||((c=r?.enableArrayArithmeticForArguments)!==null&&c!==void 0?c:!1)))})[0],a=e.args[1];let o;a.type===g.NUMBER?o=a.value:o=1;let u=o;if(e.args.length===3){const l=e.args[2];l.type===g.NUMBER?u=l.value:u=1}return o>i.width||o>i.height||u>o||(i.width-o)%u!==0||(i.height-o)%u!==0?B.error():Ji(i,o,u)}medianpoolArraySize(e,t){return this.maxpoolArraySize(e,t)}transpose(e,t){return this.runFunction(e.args,t,this.metadata("TRANSPOSE"),r=>{const n=r.rawData(),i=r.size,a=[];for(let o=0;o<i.width;++o){a[o]=[];for(let u=0;u<i.height;++u)a[o][u]=n[u][o]}return w.onlyValues(a)})}transposeArraySize(e,t){if(e.args.length!==1)return B.error();const r=this.metadata("TRANSPOSE"),n=e.args.map(a=>{var o;return this.arraySizeForAst(a,new zt(t.formulaAddress,t.arraysFlag||((o=r?.enableArrayArithmeticForArguments)!==null&&o!==void 0?o:!1)))}),[i]=n;return new B(i.height,i.width)}createKernel(e,t){return function(...r){const n=[];for(let i=0;i<t.height;++i){n.push([]);for(let a=0;a<t.width;++a)n[i][a]=e.apply({thread:{x:a,y:i}},r)}return n}}}vc.implementedFunctions={MMULT:{method:"mmult",sizeOfResultArrayMethod:"mmultArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}],vectorizationForbidden:!0},TRANSPOSE:{method:"transpose",sizeOfResultArrayMethod:"transposeArraySize",parameters:[{argumentType:h.RANGE}],vectorizationForbidden:!0},MAXPOOL:{method:"maxpool",sizeOfResultArrayMethod:"maxpoolArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}],vectorizationForbidden:!0},MEDIANPOOL:{method:"medianpool",sizeOfResultArrayMethod:"medianpoolArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}],vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ic extends V{median(e,t){return this.runFunction(e.args,t,this.metadata("MEDIAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);return n instanceof p?n:n.length===0?new p(m.NUM,T.OneValue):(n.sort((i,a)=>i-a),n.length%2===0?(n[n.length/2-1]+n[n.length/2])/2:n[Math.floor(n.length/2)])})}large(e,t){return this.runFunction(e.args,t,this.metadata("LARGE"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());return i instanceof p?i:(i.sort((a,o)=>a-o),n=Math.trunc(n),n>i.length?new p(m.NUM,T.ValueLarge):i[i.length-n])})}small(e,t){return this.runFunction(e.args,t,this.metadata("SMALL"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());return i instanceof p?i:(i.sort((a,o)=>a-o),n=Math.trunc(n),n>i.length?new p(m.NUM,T.ValueLarge):i[n-1])})}}Ic.implementedFunctions={MEDIAN:{method:"median",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},LARGE:{method:"large",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER,minValue:1}]},SMALL:{method:"small",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER,minValue:1}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Oc extends V{mod(e,t){return this.runFunction(e.args,t,this.metadata("MOD"),(r,n)=>n===0?new p(m.DIV_BY_ZERO):r%n)}}Oc.implementedFunctions={MOD:{method:"mod",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function ws(s){return j(s)&&!Number.isFinite(O(s))?0:s}class _t{constructor(e,t,r){this.sumsq=e,this.sum=t,this.count=r}static single(e){return new _t(e*e,e,1)}compose(e){return new _t(this.sumsq+e.sumsq,this.sum+e.sum,this.count+e.count)}averageValue(){if(this.count>0)return this.sum/this.count}varSValue(){if(this.count>1)return(this.sumsq-this.sum*this.sum/this.count)/(this.count-1)}varPValue(){if(this.count>0)return(this.sumsq-this.sum*this.sum/this.count)/this.count}}_t.empty=new _t(0,0,0);class fo extends V{constructor(){super(...arguments),this.addWithEpsilonRaw=(e,t)=>this.arithmeticHelper.addWithEpsilonRaw(e,t)}sum(e,t){return this.doSum(e.args,t)}sumsq(e,t){return this.reduce(e.args,t,0,"SUMSQ",this.addWithEpsilonRaw,r=>Math.pow(O(r),2),tn)}max(e,t){return this.doMax(e.args,t)}maxa(e,t){const r=this.reduce(e.args,t,Number.NEGATIVE_INFINITY,"MAXA",(n,i)=>Math.max(n,i),O,_s);return ws(r)}min(e,t){return this.doMin(e.args,t)}mina(e,t){const r=this.reduce(e.args,t,Number.POSITIVE_INFINITY,"MINA",(n,i)=>Math.min(n,i),O,_s);return ws(r)}count(e,t){return this.doCount(e.args,t)}counta(e,t){return this.doCounta(e.args,t)}average(e,t){return this.doAverage(e.args,t)}averagea(e,t){var r;const n=this.reduce(e.args,t,_t.empty,"_AGGREGATE_A",(i,a)=>i.compose(a),i=>_t.single(O(i)),_s);return n instanceof p?n:(r=n.averageValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}vars(e,t){return this.doVarS(e.args,t)}varp(e,t){return this.doVarP(e.args,t)}vara(e,t){var r;const n=this.reduceAggregateA(e.args,t);return n instanceof p?n:(r=n.varSValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}varpa(e,t){var r;const n=this.reduceAggregateA(e.args,t);return n instanceof p?n:(r=n.varPValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}stdevs(e,t){return this.doStdevS(e.args,t)}stdevp(e,t){return this.doStdevP(e.args,t)}stdeva(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof p)return r;{const n=r.varSValue();return n===void 0?new p(m.DIV_BY_ZERO):Math.sqrt(n)}}stdevpa(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof p)return r;{const n=r.varPValue();return n===void 0?new p(m.DIV_BY_ZERO):Math.sqrt(n)}}product(e,t){return this.doProduct(e.args,t)}subtotal(e,t){if(e.args.length<2)return new p(m.NA,T.WrongArgNumber);const r=this.coerceToType(this.evaluateAst(e.args[0],t),{argumentType:h.NUMBER},t),n=e.args.slice(1);switch(r){case 1:case 101:return this.doAverage(n,t);case 2:case 102:return this.doCount(n,t);case 3:case 103:return this.doCounta(n,t);case 4:case 104:return this.doMax(n,t);case 5:case 105:return this.doMin(n,t);case 6:case 106:return this.doProduct(n,t);case 7:case 107:return this.doStdevS(n,t);case 8:case 108:return this.doStdevP(n,t);case 9:case 109:return this.doSum(n,t);case 10:case 110:return this.doVarS(n,t);case 11:case 111:return this.doVarP(n,t);default:return new p(m.VALUE,T.BadMode)}}reduceAggregate(e,t){return this.reduce(e,t,_t.empty,"_AGGREGATE",(r,n)=>r.compose(n),r=>_t.single(O(r)),tn)}reduceAggregateA(e,t){return this.reduce(e,t,_t.empty,"_AGGREGATE_A",(r,n)=>r.compose(n),r=>_t.single(O(r)),_s)}doAverage(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof p?n:(r=n.averageValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}doVarS(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof p?n:(r=n.varSValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}doVarP(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof p?n:(r=n.varPValue())!==null&&r!==void 0?r:new p(m.DIV_BY_ZERO)}doStdevS(e,t){const r=this.reduceAggregate(e,t);if(r instanceof p)return r;{const n=r.varSValue();return n===void 0?new p(m.DIV_BY_ZERO):Math.sqrt(n)}}doStdevP(e,t){const r=this.reduceAggregate(e,t);if(r instanceof p)return r;{const n=r.varPValue();return n===void 0?new p(m.DIV_BY_ZERO):Math.sqrt(n)}}doCount(e,t){return this.reduce(e,t,0,"COUNT",(r,n)=>r+n,O,r=>j(r)?1:0)}doCounta(e,t){return this.reduce(e,t,0,"COUNTA",(r,n)=>r+n,O,r=>r===G?0:1)}doMax(e,t){const r=this.reduce(e,t,Number.NEGATIVE_INFINITY,"MAX",(n,i)=>Math.max(n,i),O,tn);return ws(r)}doMin(e,t){const r=this.reduce(e,t,Number.POSITIVE_INFINITY,"MIN",(n,i)=>Math.min(n,i),O,tn);return ws(r)}doSum(e,t){return this.reduce(e,t,0,"SUM",this.addWithEpsilonRaw,O,tn)}doProduct(e,t){return this.reduce(e,t,1,"PRODUCT",(r,n)=>r*n,O,tn)}reduce(e,t,r,n,i,a,o){return e.length<1?new p(m.NA,T.WrongArgNumber):e.reduce((u,l)=>{if(u instanceof p)return u;if(l.type===g.CELL_RANGE||l.type===g.COLUMN_RANGE||l.type===g.ROW_RANGE){const d=this.evaluateRange(l,t,r,n,i,a,o);return d instanceof p?d:i(d,u)}let c;if(c=this.evaluateAst(l,t),c instanceof w)return Array.from(c.valuesFromTopLeftCorner()).map(o).filter(f=>f!==void 0).map(f=>f instanceof p?f:a(f)).reduce((f,E)=>f instanceof p?f:E instanceof p?E:i(f,E),u);if(l.type===g.CELL_REFERENCE){if(c=o(c),c===void 0)return u}else if(c=this.coerceScalarToNumberOrError(c),c=o(c),c===void 0)return u;return c instanceof p?c:i(u,a(c))},r)}evaluateRange(e,t,r,n,i,a,o){let u;try{u=U.fromAst(e,t.formulaAddress)}catch(d){if(d instanceof es)return new p(m.REF,T.RangeManySheets);throw d}const l=this.dependencyGraph.getRange(u.start,u.end);if(l===void 0)throw new Error("Range does not exists in graph");let c=l.getFunctionValue(n);return c===void 0&&(c=this.getRangeValues(n,u,l,a,o).reduce((f,E)=>f instanceof p?f:E instanceof p?E:i(f,E),r),l.setFunctionValue(n,c)),c}getRangeValues(e,t,r,n,i){const a=[],{smallerRangeVertex:o,restRange:u}=this.dependencyGraph.rangeMapping.findSmallerRange(t);let l;if(o!==void 0&&this.dependencyGraph.existsEdge(o,r)){const c=o.getFunctionValue(e);if(c!==void 0)a.push(c);else for(const d of o.range.addresses(this.dependencyGraph)){const f=i(this.dependencyGraph.getScalarValue(d));f instanceof p?a.push(f):f!==void 0&&a.push(n(f))}l=u}else l=t;for(const c of l.addresses(this.dependencyGraph)){const d=i(this.dependencyGraph.getScalarValue(c));d instanceof p?a.push(d):d!==void 0&&a.push(n(d))}return a}}fo.implementedFunctions={SUM:{method:"sum",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},SUMSQ:{method:"sumsq",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MAX:{method:"max",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MIN:{method:"min",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MAXA:{method:"maxa",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MINA:{method:"mina",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},COUNT:{method:"count",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},COUNTA:{method:"counta",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},AVERAGE:{method:"average",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},AVERAGEA:{method:"averagea",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},PRODUCT:{method:"product",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"VAR.S":{method:"vars",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"VAR.P":{method:"varp",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},VARA:{method:"vara",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},VARPA:{method:"varpa",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"STDEV.S":{method:"stdevs",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"STDEV.P":{method:"stdevp",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},STDEVA:{method:"stdeva",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},STDEVPA:{method:"stdevpa",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},SUBTOTAL:{method:"subtotal",parameters:[{argumentType:h.NUMBER},{argumentType:h.ANY}],repeatLastArgs:1}};fo.aliases={VAR:"VAR.S",VARP:"VAR.P",STDEV:"STDEV.S",STDEVP:"STDEV.P",VARS:"VAR.S",STDEVS:"STDEV.S"};function tn(s){if(j(s)||s instanceof p)return s}function _s(s){return typeof s=="boolean"?Sa(s):j(s)||s instanceof p?s:typeof s=="string"?0:void 0}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Mc extends V{power(e,t){return this.runFunction(e.args,t,this.metadata("POWER"),Math.pow)}}Mc.implementedFunctions={POWER:{method:"power",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class wc extends V{radians(e,t){return this.runFunction(e.args,t,this.metadata("RADIANS"),r=>r*(Math.PI/180))}}wc.implementedFunctions={RADIANS:{method:"radians",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Fe=10,_c=255,bu=2,xu=36,BT="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";class Lc extends V{dec2bin(e,t){return this.runFunction(e.args,t,this.metadata("DEC2BIN"),(r,n)=>Jt(r,2,n))}dec2oct(e,t){return this.runFunction(e.args,t,this.metadata("DEC2OCT"),(r,n)=>Jt(r,8,n))}dec2hex(e,t){return this.runFunction(e.args,t,this.metadata("DEC2HEX"),(r,n)=>Jt(r,16,n))}bin2dec(e,t){return this.runFunction(e.args,t,this.metadata("BIN2DEC"),r=>{const n=Dt(r,2,Fe);return n===void 0?new p(m.NUM,T.NotBinary):er(n,2)})}bin2oct(e,t){return this.runFunction(e.args,t,this.metadata("BIN2OCT"),(r,n)=>{const i=Dt(r,2,Fe);return i===void 0?new p(m.NUM,T.NotBinary):Jt(er(i,2),8,n)})}bin2hex(e,t){return this.runFunction(e.args,t,this.metadata("BIN2HEX"),(r,n)=>{const i=Dt(r,2,Fe);return i===void 0?new p(m.NUM,T.NotBinary):Jt(er(i,2),16,n)})}oct2dec(e,t){return this.runFunction(e.args,t,this.metadata("OCT2DEC"),r=>{const n=Dt(r,8,Fe);return n===void 0?new p(m.NUM,T.NotOctal):er(n,8)})}oct2bin(e,t){return this.runFunction(e.args,t,this.metadata("OCT2BIN"),(r,n)=>{const i=Dt(r,8,Fe);return i===void 0?new p(m.NUM,T.NotOctal):Jt(er(i,8),2,n)})}oct2hex(e,t){return this.runFunction(e.args,t,this.metadata("OCT2HEX"),(r,n)=>{const i=Dt(r,8,Fe);return i===void 0?new p(m.NUM,T.NotOctal):Jt(er(i,8),16,n)})}hex2dec(e,t){return this.runFunction(e.args,t,this.metadata("HEX2DEC"),r=>{const n=Dt(r,16,Fe);return n===void 0?new p(m.NUM,T.NotHex):er(n,16)})}hex2bin(e,t){return this.runFunction(e.args,t,this.metadata("HEX2BIN"),(r,n)=>{const i=Dt(r,16,Fe);return i===void 0?new p(m.NUM,T.NotHex):Jt(er(i,16),2,n)})}hex2oct(e,t){return this.runFunction(e.args,t,this.metadata("HEX2OCT"),(r,n)=>{const i=Dt(r,16,Fe);return i===void 0?new p(m.NUM,T.NotHex):Jt(er(i,16),8,n)})}base(e,t){return this.runFunction(e.args,t,this.metadata("BASE"),GT)}decimal(e,t){return this.runFunction(e.args,t,this.metadata("DECIMAL"),(r,n)=>{const i=Dt(r,n,_c);return i===void 0?new p(m.NUM,T.NotHex):parseInt(i,n)})}}Lc.implementedFunctions={DEC2BIN:{method:"dec2bin",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2OCT:{method:"dec2oct",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2HEX:{method:"dec2hex",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},BIN2DEC:{method:"bin2dec",parameters:[{argumentType:h.STRING}]},BIN2OCT:{method:"bin2oct",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:Fe}]},BIN2HEX:{method:"bin2hex",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:Fe}]},OCT2DEC:{method:"oct2dec",parameters:[{argumentType:h.STRING}]},OCT2BIN:{method:"oct2bin",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:Fe}]},OCT2HEX:{method:"oct2hex",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:Fe}]},HEX2DEC:{method:"hex2dec",parameters:[{argumentType:h.STRING}]},HEX2BIN:{method:"hex2bin",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:Fe}]},HEX2OCT:{method:"hex2oct",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:Fe}]},DECIMAL:{method:"decimal",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,minValue:bu,maxValue:xu}]},BASE:{method:"base",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:bu,maxValue:xu},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:_c}]}};function Dt(s,e,t){const r=BT.substr(0,e),n=new RegExp(`^[${r}]+$`);if(!(s.length>t||!n.test(s)))return s}function Jt(s,e,t){if(s>kT(e))return new p(m.NUM,T.ValueBaseLarge);if(s<Fc(e))return new p(m.NUM,T.ValueBaseSmall);const r=Uc(s,e);return t===void 0||s<0?r:r.length>t?new p(m.NUM,T.ValueBaseLong):Ze(r,t)}function Fc(s){return-Math.pow(s,Fe)/2}function kT(s){return-Fc(s)-1}function GT(s,e,t){const r=Uc(s,e);return t!==void 0&&t>r.length?Ze(r,t):r}function Uc(s,e){const t=s<0?Math.pow(e,Fe):0;return(s+t).toString(e).toUpperCase()}function er(s,e){const t=parseInt(s,e),r=Math.pow(e,Fe);return t>=r/2?t-r:t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class bc extends V{rand(e,t){return this.runFunction(e.args,t,this.metadata("RAND"),Math.random)}randbetween(e,t){return this.runFunction(e.args,t,this.metadata("RANDBETWEEN"),(r,n)=>n<r?new p(m.NUM,T.WrongOrder):(r=Math.ceil(r),n=Math.floor(n)+1,r===n&&(n+=1),r+Math.floor(Math.random()*(n-r))))}}bc.implementedFunctions={RAND:{method:"rand",parameters:[],isVolatile:!0},RANDBETWEEN:{method:"randbetween",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}],isVolatile:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Pu(s){const e=Math.ceil(s);return e%2===1?e:e+1}function Du(s){const e=Math.ceil(s);return e%2===0?e:e+1}class mo extends V{roundup(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.ceil(-r*i)/i:Math.ceil(r*i)/i})}rounddown(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.floor(-r*i)/i:Math.floor(r*i)/i})}round(e,t){return this.runFunction(e.args,t,this.metadata("ROUND"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.round(-r*i)/i:Math.round(r*i)/i})}intFunc(e,t){return this.runFunction(e.args,t,this.metadata("INT"),r=>r<0?-Math.floor(-r):Math.floor(r))}even(e,t){return this.runFunction(e.args,t,this.metadata("EVEN"),r=>r<0?-Du(-r):Du(r))}odd(e,t){return this.runFunction(e.args,t,this.metadata("ODD"),r=>r<0?-Pu(-r):Pu(r))}ceilingmath(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.MATH"),(r,n,i)=>n===0||r===0?0:(n=Math.abs(n),i===1&&r<0&&(n=-n),Math.ceil(r/n)*n))}ceiling(e,t){return this.runFunction(e.args,t,this.metadata("CEILING"),(r,n)=>r===0?0:n===0?new p(m.DIV_BY_ZERO):r>0&&n<0?new p(m.NUM,T.DistinctSigns):Math.ceil(r/n)*n)}ceilingprecise(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.PRECISE"),(r,n)=>n===0||r===0?0:(n=Math.abs(n),Math.ceil(r/n)*n))}floormath(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.MATH"),(r,n,i)=>n===0||r===0?0:(n=Math.abs(n),i===1&&r<0&&(n*=-1),Math.floor(r/n)*n))}floor(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR"),(r,n)=>r===0?0:n===0?new p(m.DIV_BY_ZERO):r>0&&n<0?new p(m.NUM,T.DistinctSigns):Math.floor(r/n)*n)}floorprecise(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.PRECISE"),(r,n)=>n===0||r===0?0:(n=Math.abs(n),Math.floor(r/n)*n))}}mo.implementedFunctions={ROUNDUP:{method:"roundup",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]},ROUNDDOWN:{method:"rounddown",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]},ROUND:{method:"round",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]},INT:{method:"intFunc",parameters:[{argumentType:h.NUMBER}]},EVEN:{method:"even",parameters:[{argumentType:h.NUMBER}]},ODD:{method:"odd",parameters:[{argumentType:h.NUMBER}]},"CEILING.MATH":{method:"ceilingmath",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1},{argumentType:h.NUMBER,defaultValue:0}]},CEILING:{method:"ceiling",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},"CEILING.PRECISE":{method:"ceilingprecise",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1}]},"FLOOR.MATH":{method:"floormath",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1},{argumentType:h.NUMBER,defaultValue:0}]},FLOOR:{method:"floor",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},"FLOOR.PRECISE":{method:"floorprecise",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1}]}};mo.aliases={"ISO.CEILING":"CEILING.PRECISE",TRUNC:"ROUNDDOWN"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class xc extends V{sqrt(e,t){return this.runFunction(e.args,t,this.metadata("SQRT"),Math.sqrt)}}xc.implementedFunctions={SQRT:{method:"sqrt",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function*HT(){}function WT(s){const e=s[Symbol.iterator](),{done:t,value:r}=e.next();return t?{rest:HT()}:{value:r,rest:e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const YT=(s,e,t)=>{if(t.end.row>t.start.row){const r=M(t.end.sheet,t.end.col,t.end.row-1),n=s.getRange(t.start,r);if(n!==void 0)return{smallerRangeVertex:n,restValuesRange:t.withStart(M(t.start.sheet,t.start.col,t.end.row)),restConditionRanges:e.map(i=>i.withStart(M(i.start.sheet,i.start.col,i.end.row)))}}return{restValuesRange:t,restConditionRanges:e}};class zT{constructor(e,t,r,n,i){this.interpreter=e,this.cacheKey=t,this.reduceInitialValue=r,this.composeFunction=n,this.mapFunction=i,this.dependencyGraph=this.interpreter.dependencyGraph}compute(e,t){for(const i of t)if(!i.conditionRange.sameDimensionsAs(e))return new p(m.VALUE,T.EqualLength);const r=this.tryToGetRangeVertexForRangeValue(e),n=t.map(i=>this.tryToGetRangeVertexForRangeValue(i.conditionRange));if(r&&n.every(i=>i!==void 0)){const i=t.map(u=>u.criterionPackage.raw).join(","),a=this.findAlreadyComputedValueInCache(r,this.cacheKey(t),i);if(a!==void 0)return this.interpreter.stats.incrementCriterionFunctionFullCacheUsed(),a;const o=this.buildNewCriterionCache(this.cacheKey(t),t.map(u=>u.conditionRange.range),e.range);return o.has(i)||o.set(i,[this.evaluateRangeValue(e,t),t.map(u=>u.criterionPackage.lambda)]),r.setCriterionFunctionValues(this.cacheKey(t),o),n.forEach(u=>{u!==void 0&&u.addDependentCacheRange(r)}),o.get(i)[0]}else return this.evaluateRangeValue(e,t)}tryToGetRangeVertexForRangeValue(e){const t=e.range;if(t!==void 0)return this.dependencyGraph.getRange(t.start,t.end)}reduceFunction(e){let t=this.reduceInitialValue;for(const r of e)t=this.composeFunction(t,r);return t}findAlreadyComputedValueInCache(e,t,r){return e.getCriterionFunctionValue(t,r)}evaluateRangeValue(e,t){const r=t.map(o=>o.criterionPackage.lambda),n=Array.from(e.valuesFromTopLeftCorner()).map(this.mapFunction)[Symbol.iterator](),i=t.map(o=>o.conditionRange.iterateValuesFromTopLeftCorner()),a=Bu(r,i,n);return this.reduceFunction(a)}buildNewCriterionCache(e,t,r){const n=this.dependencyGraph.getRange(r.start,r.end),{smallerRangeVertex:i,restConditionRanges:a,restValuesRange:o}=YT(this.dependencyGraph,t,r);let u;i!==void 0&&this.dependencyGraph.existsEdge(i,n)?u=i.getCriterionFunctionValues(e):u=new Map;const l=new Map;return u.forEach(([c,d],f)=>{const E=Bu(d,a.map(R=>Vu(this.dependencyGraph,R)),Array.from(Vu(this.dependencyGraph,o)).map(this.mapFunction)[Symbol.iterator]()),N=this.composeFunction(c,this.reduceFunction(E));this.interpreter.stats.incrementCriterionFunctionPartialCacheUsed(),l.set(f,[N,d])}),l}}class $T{constructor(e,t){this.conditionRange=e,this.criterionPackage=t}}function*Vu(s,e){for(const t of e.addresses(s))yield O(s.getScalarValue(t))}function*Bu(s,e,t){for(const r of t){const n=e.map(a=>WT(a));if(!n.every(a=>Object.prototype.hasOwnProperty.call(a,"value")))return;const i=n.map(a=>O(a.value));XT(i,s).every(([a,o])=>o(a))&&(yield r),e=n.map(a=>a.rest)}}function XT(s,e){const t=[];for(let r=0;r<Math.min(s.length,e.length);r++)t.push([s[r],e[r]]);return t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ar{constructor(e,t){this.sum=e,this.count=t}static single(e){return new Ar(e,1)}compose(e){return new Ar(this.sum+e.sum,this.count+e.count)}averageValue(){if(this.count>0)return this.sum/this.count}}Ar.empty=new Ar(0,0);function KT(s){return e=>{const t=e.map(r=>`${r.conditionRange.range.sheet},${r.conditionRange.range.start.col},${r.conditionRange.range.start.row}`);return[s,...t].join(",")}}function ku(s){return j(s)&&!Number.isFinite(O(s))?0:s}function Ls(s){if(s instanceof p)return s;if(j(s))return O(s)}class Pc extends V{sumif(e,t){const r="SUMIF",n=(i,a,o)=>this.computeConditionalAggregationFunction(o??i,[i,a],r,0,(u,l)=>this.arithmeticHelper.nonstrictadd(u,l),Ls);return this.runFunction(e.args,t,this.metadata(r),n)}sumifs(e,t){const r="SUMIFS",n=(i,...a)=>this.computeConditionalAggregationFunction(i,a,r,0,(o,u)=>this.arithmeticHelper.nonstrictadd(o,u),Ls);return this.runFunction(e.args,t,this.metadata(r),n)}averageif(e,t){const r="AVERAGEIF",n=(i,a,o)=>{const u=this.computeConditionalAggregationFunction(o??i,[i,a],r,Ar.empty,(l,c)=>l.compose(c),l=>j(l)?Ar.single(O(l)):Ar.empty);return u instanceof p?u:u.averageValue()||new p(m.DIV_BY_ZERO)};return this.runFunction(e.args,t,this.metadata(r),n)}countif(e,t){const r="COUNTIF",n=(i,a)=>this.computeConditionalAggregationFunction(i,[i,a],r,0,(o,u)=>o+u,()=>1);return this.runFunction(e.args,t,this.metadata(r),n)}countifs(e,t){const r="COUNTIFS",n=(...i)=>this.computeConditionalAggregationFunction(i[0],i,r,0,(a,o)=>a+o,()=>1);return this.runFunction(e.args,t,this.metadata(r),n)}minifs(e,t){const r="MINIFS",n=(a,o)=>o===void 0||a===void 0?o===void 0?a:o:Math.min(a,o),i=(a,...o)=>{const u=this.computeConditionalAggregationFunction(a,o,r,Number.POSITIVE_INFINITY,n,Ls);return ku(u)};return this.runFunction(e.args,t,this.metadata(r),i)}maxifs(e,t){const r="MAXIFS",n=(a,o)=>o===void 0||a===void 0?o===void 0?a:o:Math.max(a,o),i=(a,...o)=>{const u=this.computeConditionalAggregationFunction(a,o,r,Number.NEGATIVE_INFINITY,n,Ls);return ku(u)};return this.runFunction(e.args,t,this.metadata(r),i)}computeConditionalAggregationFunction(e,t,r,n,i,a){const o=[];for(let u=0;u<t.length;u+=2){const l=t[u],c=this.interpreter.criterionBuilder.fromCellValue(t[u+1],this.arithmeticHelper);if(c===void 0)return new p(m.VALUE,T.BadCriterion);o.push(new $T(l,c))}return new zT(this.interpreter,KT(r),n,i,a).compute(e,o)}}Pc.implementedFunctions={SUMIF:{method:"sumif",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR},{argumentType:h.RANGE,optionalArg:!0}]},COUNTIF:{method:"countif",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR}]},AVERAGEIF:{method:"averageif",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR},{argumentType:h.RANGE,optionalArg:!0}]},SUMIFS:{method:"sumifs",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2},COUNTIFS:{method:"countifs",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2},MINIFS:{method:"minifs",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2},MAXIFS:{method:"maxifs",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Dc extends V{sumproduct(e,t){return this.runFunction(e.args,t,this.metadata("SUMPRODUCT"),(...r)=>{const n=r[0].width(),i=r[0].height();for(const u of r)if(u.width()!==n||u.height()!==i)return new p(m.VALUE,T.EqualLength);let a=0;const o=r.map(u=>u.iterateValuesFromTopLeftCorner());for(let u=0;u<n*i;u++){let l=1;for(const c of o){const d=c.next().value;if(d instanceof p)return d;const f=this.coerceScalarToNumberOrError(d);j(f)?l*=O(f):l=0}a+=l}return a})}}Dc.implementedFunctions={SUMPRODUCT:{method:"sumproduct",parameters:[{argumentType:h.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Vc extends V{concatenate(e,t){return this.runFunction(e.args,t,this.metadata("CONCATENATE"),(...r)=>"".concat(...r))}split(e,t){return this.runFunction(e.args,t,this.metadata("SPLIT"),(r,n)=>{const i=r.split(" ");return n>=i.length||n<0?new p(m.VALUE,T.IndexBounds):i[n]})}len(e,t){return this.runFunction(e.args,t,this.metadata("LEN"),r=>r.length)}lower(e,t){return this.runFunction(e.args,t,this.metadata("LOWER"),r=>r.toLowerCase())}trim(e,t){return this.runFunction(e.args,t,this.metadata("TRIM"),r=>r.replace(/^ +/g,"").replace(/ +$/g,"").replace(/ +/g," "))}proper(e,t){return this.runFunction(e.args,t,this.metadata("PROPER"),r=>r.replace(new RegExp("\\p{L}+","gu"),n=>n.charAt(0).toUpperCase()+n.substring(1).toLowerCase()))}clean(e,t){return this.runFunction(e.args,t,this.metadata("CLEAN"),r=>r.replace(/[\u0000-\u001F]/g,""))}exact(e,t){return this.runFunction(e.args,t,this.metadata("EXACT"),(r,n)=>r===n)}rept(e,t){return this.runFunction(e.args,t,this.metadata("REPT"),(r,n)=>n<0?new p(m.VALUE,T.NegativeCount):r.repeat(n))}right(e,t){return this.runFunction(e.args,t,this.metadata("RIGHT"),(r,n)=>n<0?new p(m.VALUE,T.NegativeLength):n===0?"":r.slice(-n))}left(e,t){return this.runFunction(e.args,t,this.metadata("LEFT"),(r,n)=>n<0?new p(m.VALUE,T.NegativeLength):r.slice(0,n))}mid(e,t){return this.runFunction(e.args,t,this.metadata("MID"),(r,n,i)=>n<1?new p(m.VALUE,T.LessThanOne):i<0?new p(m.VALUE,T.NegativeLength):r.substring(n-1,n+i-1))}replace(e,t){return this.runFunction(e.args,t,this.metadata("REPLACE"),(r,n,i,a)=>n<1?new p(m.VALUE,T.LessThanOne):i<0?new p(m.VALUE,T.NegativeLength):r.substring(0,n-1)+a+r.substring(n+i-1))}search(e,t){return this.runFunction(e.args,t,this.metadata("SEARCH"),(r,n,i)=>{if(i<1||i>n.length)return new p(m.VALUE,T.LengthBounds);const a=r.toLowerCase(),o=n.substring(i-1).toLowerCase(),u=this.arithmeticHelper.requiresRegex(a)?this.arithmeticHelper.searchString(a,o):o.indexOf(a);return u>-1?u+i:new p(m.VALUE,T.PatternNotFound)})}substitute(e,t){return this.runFunction(e.args,t,this.metadata("SUBSTITUTE"),(r,n,i,a)=>{const o=this.escapeRegExpSpecialCharacters(n),u=new RegExp(o,"g");if(a===void 0)return r.replace(u,i);if(a<1)return new p(m.VALUE,T.LessThanOne);let l,c=0;for(;(l=u.exec(r))!==null;)if(a===++c)return r.substring(0,l.index)+i+r.substring(u.lastIndex);return r})}find(e,t){return this.runFunction(e.args,t,this.metadata("FIND"),(r,n,i)=>{if(i<1||i>n.length)return new p(m.VALUE,T.IndexBounds);const o=n.substring(i-1).indexOf(r)+i;return o>0?o:new p(m.VALUE,T.PatternNotFound)})}t(e,t){return this.runFunction(e.args,t,this.metadata("T"),r=>r instanceof p||typeof r=="string"?r:"")}upper(e,t){return this.runFunction(e.args,t,this.metadata("UPPER"),r=>r.toUpperCase())}escapeRegExpSpecialCharacters(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}Vc.implementedFunctions={CONCATENATE:{method:"concatenate",parameters:[{argumentType:h.STRING}],repeatLastArgs:1,expandRanges:!0},EXACT:{method:"exact",parameters:[{argumentType:h.STRING},{argumentType:h.STRING}]},SPLIT:{method:"split",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER}]},LEN:{method:"len",parameters:[{argumentType:h.STRING}]},LOWER:{method:"lower",parameters:[{argumentType:h.STRING}]},MID:{method:"mid",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},TRIM:{method:"trim",parameters:[{argumentType:h.STRING}]},T:{method:"t",parameters:[{argumentType:h.SCALAR}]},PROPER:{method:"proper",parameters:[{argumentType:h.STRING}]},CLEAN:{method:"clean",parameters:[{argumentType:h.STRING}]},REPT:{method:"rept",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER}]},RIGHT:{method:"right",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},LEFT:{method:"left",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},REPLACE:{method:"replace",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.STRING}]},SEARCH:{method:"search",parameters:[{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},SUBSTITUTE:{method:"substitute",parameters:[{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0}]},FIND:{method:"find",parameters:[{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},UPPER:{method:"upper",parameters:[{argumentType:h.STRING}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Bc extends V{acos(e,t){return this.runFunction(e.args,t,this.metadata("ACOS"),Math.acos)}asin(e,t){return this.runFunction(e.args,t,this.metadata("ASIN"),Math.asin)}cos(e,t){return this.runFunction(e.args,t,this.metadata("COS"),Math.cos)}sin(e,t){return this.runFunction(e.args,t,this.metadata("SIN"),Math.sin)}tan(e,t){return this.runFunction(e.args,t,this.metadata("TAN"),Math.tan)}atan(e,t){return this.runFunction(e.args,t,this.metadata("ATAN"),Math.atan)}atan2(e,t){return this.runFunction(e.args,t,this.metadata("ATAN2"),(r,n)=>r===0&&n===0?new p(m.DIV_BY_ZERO):Math.atan2(n,r))}cot(e,t){return this.runFunction(e.args,t,this.metadata("COT"),r=>r===0?new p(m.DIV_BY_ZERO):1/Math.tan(r))}acot(e,t){return this.runFunction(e.args,t,this.metadata("ACOT"),r=>r===0?Ua/2:Math.atan(1/r))}sec(e,t){return this.runFunction(e.args,t,this.metadata("SEC"),r=>1/Math.cos(r))}csc(e,t){return this.runFunction(e.args,t,this.metadata("CSC"),r=>r===0?new p(m.DIV_BY_ZERO):1/Math.sin(r))}sinh(e,t){return this.runFunction(e.args,t,this.metadata("SINH"),Math.sinh)}asinh(e,t){return this.runFunction(e.args,t,this.metadata("ASINH"),Math.asinh)}cosh(e,t){return this.runFunction(e.args,t,this.metadata("COSH"),Math.cosh)}acosh(e,t){return this.runFunction(e.args,t,this.metadata("ACOSH"),Math.acosh)}tanh(e,t){return this.runFunction(e.args,t,this.metadata("TANH"),Math.tanh)}atanh(e,t){return this.runFunction(e.args,t,this.metadata("ATANH"),Math.atanh)}coth(e,t){return this.runFunction(e.args,t,this.metadata("COTH"),r=>r===0?new p(m.DIV_BY_ZERO):1/Math.tanh(r))}acoth(e,t){return this.runFunction(e.args,t,this.metadata("ACOTH"),r=>r===0?new p(m.NUM,T.NonZero):Math.atanh(1/r))}sech(e,t){return this.runFunction(e.args,t,this.metadata("SECH"),r=>1/Math.cosh(r))}csch(e,t){return this.runFunction(e.args,t,this.metadata("CSCH"),r=>r===0?new p(m.DIV_BY_ZERO):1/Math.sinh(r))}}Bc.implementedFunctions={ACOS:{method:"acos",parameters:[{argumentType:h.NUMBER}]},ASIN:{method:"asin",parameters:[{argumentType:h.NUMBER}]},COS:{method:"cos",parameters:[{argumentType:h.NUMBER}]},SIN:{method:"sin",parameters:[{argumentType:h.NUMBER}]},TAN:{method:"tan",parameters:[{argumentType:h.NUMBER}]},ATAN:{method:"atan",parameters:[{argumentType:h.NUMBER}]},ATAN2:{method:"atan2",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},COT:{method:"cot",parameters:[{argumentType:h.NUMBER}]},SEC:{method:"sec",parameters:[{argumentType:h.NUMBER}]},CSC:{method:"csc",parameters:[{argumentType:h.NUMBER}]},SINH:{method:"sinh",parameters:[{argumentType:h.NUMBER}]},COSH:{method:"cosh",parameters:[{argumentType:h.NUMBER}]},TANH:{method:"tanh",parameters:[{argumentType:h.NUMBER}]},COTH:{method:"coth",parameters:[{argumentType:h.NUMBER}]},SECH:{method:"sech",parameters:[{argumentType:h.NUMBER}]},CSCH:{method:"csch",parameters:[{argumentType:h.NUMBER}]},ACOT:{method:"acot",parameters:[{argumentType:h.NUMBER}]},ASINH:{method:"asinh",parameters:[{argumentType:h.NUMBER}]},ACOSH:{method:"acosh",parameters:[{argumentType:h.NUMBER}]},ATANH:{method:"atanh",parameters:[{argumentType:h.NUMBER}]},ACOTH:{method:"acoth",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class jT extends Ql{constructor(e){super(e),this.dependencyGraph=e}find(e,t,r){return this.basicFind(e,t,"col",r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class kc extends V{constructor(){super(...arguments),this.rowSearch=new jT(this.dependencyGraph)}vlookup(e,t){return this.runFunction(e.args,t,this.metadata("VLOOKUP"),(r,n,i,a)=>{const o=n.range;if(o===void 0)return new p(m.VALUE,T.WrongType);if(i<1)return new p(m.VALUE,T.LessThanOne);if(i>o.width())return new p(m.REF,T.IndexLarge);const u={ordering:a?"asc":"none",ifNoMatch:a?"returnLowerBound":"returnNotFound"};return this.doVlookup(Ns(r),n,i-1,u)})}hlookup(e,t){return this.runFunction(e.args,t,this.metadata("HLOOKUP"),(r,n,i,a)=>{const o=n.range;if(o===void 0)return new p(m.VALUE,T.WrongType);if(i<1)return new p(m.VALUE,T.LessThanOne);if(i>o.height())return new p(m.REF,T.IndexLarge);const u={ordering:a?"asc":"none",ifNoMatch:a?"returnLowerBound":"returnNotFound"};return this.doHlookup(Ns(r),n,i-1,u)})}xlookup(e,t){return this.runFunction(e.args,t,this.metadata("XLOOKUP"),(r,n,i,a,o,u)=>{if(![0,-1,1,2].includes(o))return new p(m.VALUE,T.BadMode);if(![1,-1,2,-2].includes(u))return new p(m.VALUE,T.BadMode);const l=n instanceof w?n:w.fromScalar(n),c=i instanceof w?i:w.fromScalar(i),d=o===2,f={ordering:u===2?"asc":u===-2?"desc":"none",returnOccurrence:u===-1?"last":"first",ifNoMatch:o===-1?"returnLowerBound":o===1?"returnUpperBound":"returnNotFound"};return this.doXlookup(Ns(r),l,c,a,d,f)})}xlookupArraySize(e){var t,r;const n=(t=e?.args)===null||t===void 0?void 0:t[1],i=(r=e?.args)===null||r===void 0?void 0:r[2];if(n?.start==null||n?.end==null||i?.start==null||i?.end==null)return B.error();const a=n.end.row-n.start.row+1,o=n.end.col-n.start.col+1,u=i.end.row-i.start.row+1,l=i.end.col-i.start.col+1,c=o===1&&u===a;return!c&&!(a===1&&l===o)?B.error():c?new B(l,1):new B(1,u)}match(e,t){return this.runFunction(e.args,t,this.metadata("MATCH"),(r,n,i)=>this.doMatch(Ns(r),n,i))}searchInRange(e,t,r,n,i){return r&&typeof e=="string"&&this.arithmeticHelper.requiresRegex(e)?i.advancedFind(this.arithmeticHelper.eqMatcherFunction(e),t,{returnOccurrence:n.returnOccurrence}):i.find(e,t,n)}doVlookup(e,t,r,n){this.dependencyGraph.stats.start(D.VLOOKUP);const i=t.range;let a;i===void 0?a=w.onlyValues(t.data.map(l=>[l[0]])):a=w.onlyRange(U.spanFrom(i.start,1,i.height()),this.dependencyGraph);const o=this.searchInRange(e,a,n.ordering==="none",n,this.columnSearch);if(this.dependencyGraph.stats.end(D.VLOOKUP),o===-1)return new p(m.NA,T.ValueNotFound);let u;if(i===void 0)u=t.data[o][r];else{const l=M(i.sheet,i.start.col+r,i.start.row+o);u=this.dependencyGraph.getCellValue(l)}return u instanceof w?new p(m.VALUE,T.WrongType):u}doHlookup(e,t,r,n){const i=t.range;let a;i===void 0?a=w.onlyValues([t.data[0]]):a=w.onlyRange(U.spanFrom(i.start,i.width(),1),this.dependencyGraph);const o=this.searchInRange(e,a,n.ordering==="none",n,this.rowSearch);if(o===-1)return new p(m.NA,T.ValueNotFound);let u;if(i===void 0)u=t.data[r][o];else{const l=M(i.sheet,i.start.col+o,i.start.row+r);u=this.dependencyGraph.getCellValue(l)}return u instanceof w?new p(m.VALUE,T.WrongType):u}doXlookup(e,t,r,n,i,a){const o=t.width()===1&&r.height()===t.height(),u=t.height()===1&&r.width()===t.width();if(!o&&!u)return new p(m.VALUE,T.WrongDimension);const l=o?this.columnSearch:this.rowSearch,c=this.searchInRange(e,t,i,a,l);if(c===-1)return n==m.NA?new p(m.NA,T.ValueNotFound):n;const d=o?[r.data[c]]:r.data.map(f=>[f[c]]);return w.onlyValues(d)}doMatch(e,t,r){if(![-1,0,1].includes(r))return new p(m.VALUE,T.BadMode);if(t.width()>1&&t.height()>1)return new p(m.NA);const n=t.width()===1?this.columnSearch:this.rowSearch,i=r===0?{ordering:"none",ifNoMatch:"returnNotFound"}:{ordering:r===-1?"desc":"asc",ifNoMatch:r===-1?"returnUpperBound":"returnLowerBound"},a=n.find(e,t,i);return a===-1?new p(m.NA,T.ValueNotFound):a+1}}kc.implementedFunctions={VLOOKUP:{method:"vlookup",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.BOOLEAN,defaultValue:!0}]},HLOOKUP:{method:"hlookup",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.BOOLEAN,defaultValue:!0}]},XLOOKUP:{method:"xlookup",sizeOfResultArrayMethod:"xlookupArraySize",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.SCALAR,optionalArg:!0,defaultValue:m.NA},{argumentType:h.NUMBER,optionalArg:!0,defaultValue:0},{argumentType:h.NUMBER,optionalArg:!0,defaultValue:1}]},MATCH:{method:"match",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.NUMBER,defaultValue:1}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Gc extends V{roman(e,t){return this.runFunction(e.args,t,this.metadata("ROMAN"),(r,n)=>(r=Math.trunc(r),n===!1?n=4:n===!0&&(n=0),n=O(this.coerceScalarToNumberOrError(n)),n instanceof p?n:(n=Math.trunc(n),n<0?new p(m.VALUE,T.ValueSmall):n>4?new p(m.VALUE,T.ValueLarge):qT(r,n))))}arabic(e,t){return this.runFunction(e.args,t,this.metadata("ARABIC"),r=>{r=r.trim().toUpperCase();let n=!1;if(r.startsWith("-")&&(r=r.slice(1),n=!0,r===""))return new p(m.VALUE,T.InvalidRoman);const i={input:r,acc:0};return Vt(i,{token:"MMM",val:3e3},{token:"MM",val:2e3},{token:"M",val:1e3}),Vt(i,{token:"IM",val:999},{token:"VM",val:995},{token:"XM",val:990},{token:"LM",val:950},{token:"CM",val:900}),Vt(i,{token:"D",val:500},{token:"ID",val:499},{token:"VD",val:495},{token:"XD",val:490},{token:"LD",val:450},{token:"CD",val:400}),Vt(i,{token:"CCC",val:300},{token:"CC",val:200},{token:"C",val:100}),Vt(i,{token:"IC",val:99},{token:"VC",val:95},{token:"XC",val:90}),Vt(i,{token:"L",val:50},{token:"IL",val:49},{token:"VL",val:45},{token:"XL",val:40}),Vt(i,{token:"XXX",val:30},{token:"XX",val:20},{token:"X",val:10}),Vt(i,{token:"IX",val:9}),Vt(i,{token:"V",val:5},{token:"IV",val:4}),Vt(i,{token:"III",val:3},{token:"II",val:2},{token:"I",val:1}),i.input!==""?new p(m.VALUE,T.InvalidRoman):n?-i.acc:i.acc})}}Gc.implementedFunctions={ROMAN:{method:"roman",parameters:[{argumentType:h.NUMBER,minValue:1,lessThan:4e3},{argumentType:h.NOERROR,optionalArg:!0,defaultValue:0}]},ARABIC:{method:"arabic",parameters:[{argumentType:h.STRING}]}};function Vt(s,...e){for(const t of e)if(s.input.startsWith(t.token)){s.input=s.input.slice(t.token.length),s.acc+=t.val;break}}function qT(s,e){const t={val:s%1e3,acc:"M".repeat(Math.floor(s/1e3))};return e===4&&(Se(t,"IM",999,1e3),Se(t,"ID",499,500)),e>=3&&(Se(t,"VM",995,1e3),Se(t,"VD",495,500)),e>=2&&(Se(t,"XM",990,1e3),Se(t,"XD",490,500)),e>=1&&(Se(t,"LM",950,1e3),Se(t,"LD",450,500)),Se(t,"CM",900,1e3),Se(t,"CD",400,500),Se(t,"D",500,900),t.acc+="C".repeat(Math.floor(t.val/100)),t.val%=100,e>=2&&(Se(t,"IC",99,100),Se(t,"IL",49,50)),e>=1&&(Se(t,"VC",95,100),Se(t,"VL",45,50)),Se(t,"XC",90,100),Se(t,"XL",40,50),Se(t,"L",50,90),t.acc+="X".repeat(Math.floor(t.val/10)),t.val%=10,Se(t,"IX",9,10),Se(t,"IV",4,5),Se(t,"V",5,9),t.acc+="I".repeat(t.val),t.acc}function Se(s,e,t,r){s.val>=t&&s.val<r&&(s.val-=t,s.acc+=e)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Hc extends V{add(e,t){return this.runFunction(e.args,t,this.metadata("HF.ADD"),this.arithmeticHelper.addWithEpsilon)}concat(e,t){return this.runFunction(e.args,t,this.metadata("HF.CONCAT"),this.arithmeticHelper.concat)}divide(e,t){return this.runFunction(e.args,t,this.metadata("HF.DIVIDE"),this.arithmeticHelper.divide)}eq(e,t){return this.runFunction(e.args,t,this.metadata("HF.EQ"),this.arithmeticHelper.eq)}gt(e,t){return this.runFunction(e.args,t,this.metadata("HF.GT"),this.arithmeticHelper.gt)}gte(e,t){return this.runFunction(e.args,t,this.metadata("HF.GTE"),this.arithmeticHelper.geq)}lt(e,t){return this.runFunction(e.args,t,this.metadata("HF.LT"),this.arithmeticHelper.lt)}lte(e,t){return this.runFunction(e.args,t,this.metadata("HF.LTE"),this.arithmeticHelper.leq)}minus(e,t){return this.runFunction(e.args,t,this.metadata("HF.MINUS"),this.arithmeticHelper.subtract)}multiply(e,t){return this.runFunction(e.args,t,this.metadata("HF.MULTIPLY"),this.arithmeticHelper.multiply)}ne(e,t){return this.runFunction(e.args,t,this.metadata("HF.NE"),this.arithmeticHelper.neq)}pow(e,t){return this.runFunction(e.args,t,this.metadata("HF.POW"),this.arithmeticHelper.pow)}uminus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UMINUS"),this.arithmeticHelper.unaryMinus)}upercent(e,t){return this.runFunction(e.args,t,this.metadata("HF.UNARY_PERCENT"),this.arithmeticHelper.unaryPercent)}uplus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UPLUS"),this.arithmeticHelper.unaryPlus)}}Hc.implementedFunctions={"HF.ADD":{method:"add",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.CONCAT":{method:"concat",parameters:[{argumentType:h.STRING,passSubtype:!0},{argumentType:h.STRING,passSubtype:!0}]},"HF.DIVIDE":{method:"divide",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.EQ":{method:"eq",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.GT":{method:"gt",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.GTE":{method:"gte",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.LT":{method:"lt",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.LTE":{method:"lte",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.MINUS":{method:"minus",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.MULTIPLY":{method:"multiply",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.NE":{method:"ne",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.POW":{method:"pow",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.UMINUS":{method:"uminus",parameters:[{argumentType:h.NUMBER,passSubtype:!0}]},"HF.UNARY_PERCENT":{method:"upercent",parameters:[{argumentType:h.NUMBER,passSubtype:!0}]},"HF.UPLUS":{method:"uplus",parameters:[{argumentType:h.NUMBER,passSubtype:!0}]}};/**
 * @license
 bessel.js (C) 2013-present SheetJS -- http://sheetjs.com

 Apache License
 Version 2.0, January 2004
 http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

 "License" shall mean the terms and conditions for use, reproduction,
 and distribution as defined by Sections 1 through 9 of this document.

 "Licensor" shall mean the copyright owner or entity authorized by
 the copyright owner that is granting the License.

 "Legal Entity" shall mean the union of the acting entity and all
 other entities that control, are controlled by, or are under common
 control with that entity. For the purposes of this definition,
 "control" means (i) the power, direct or indirect, to cause the
 direction or management of such entity, whether by contract or
 otherwise, or (ii) ownership of fifty percent (50%) or more of the
 outstanding shares, or (iii) beneficial ownership of such entity.

 "You" (or "Your") shall mean an individual or Legal Entity
 exercising permissions granted by this License.

 "Source" form shall mean the preferred form for making modifications,
 including but not limited to software source code, documentation
 source, and configuration files.

 "Object" form shall mean any form resulting from mechanical
 transformation or translation of a Source form, including but
 not limited to compiled object code, generated documentation,
 and conversions to other media types.

 "Work" shall mean the work of authorship, whether in Source or
 Object form, made available under the License, as indicated by a
 copyright notice that is included in or attached to the work
 (an example is provided in the Appendix below).

 "Derivative Works" shall mean any work, whether in Source or Object
 form, that is based on (or derived from) the Work and for which the
 editorial revisions, annotations, elaborations, or other modifications
 represent, as a whole, an original work of authorship. For the purposes
 of this License, Derivative Works shall not include works that remain
 separable from, or merely link (or bind by name) to the interfaces of,
 the Work and Derivative Works thereof.

 "Contribution" shall mean any work of authorship, including
 the original version of the Work and any modifications or additions
 to that Work or Derivative Works thereof, that is intentionally
 submitted to Licensor for inclusion in the Work by the copyright owner
 or by an individual or Legal Entity authorized to submit on behalf of
 the copyright owner. For the purposes of this definition, "submitted"
 means any form of electronic, verbal, or written communication sent
 to the Licensor or its representatives, including but not limited to
 communication on electronic mailing lists, source code control systems,
 and issue tracking systems that are managed by, or on behalf of, the
 Licensor for the purpose of discussing and improving the Work, but
 excluding communication that is conspicuously marked or otherwise
 designated in writing by the copyright owner as "Not a Contribution."

 "Contributor" shall mean Licensor and any individual or Legal Entity
 on behalf of whom a Contribution has been received by Licensor and
 subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 copyright license to reproduce, prepare Derivative Works of,
 publicly display, publicly perform, sublicense, and distribute the
 Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 (except as stated in this section) patent license to make, have made,
 use, offer to sell, sell, import, and otherwise transfer the Work,
 where such license applies only to those patent claims licensable
 by such Contributor that are necessarily infringed by their
 Contribution(s) alone or by combination of their Contribution(s)
 with the Work to which such Contribution(s) was submitted. If You
 institute patent litigation against any entity (including a
 cross-claim or counterclaim in a lawsuit) alleging that the Work
 or a Contribution incorporated within the Work constitutes direct
 or contributory patent infringement, then any patent licenses
 granted to You under this License for that Work shall terminate
 as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
 Work or Derivative Works thereof in any medium, with or without
 modifications, and in Source or Object form, provided that You
 meet the following conditions:

 (a) You must give any other recipients of the Work or
 Derivative Works a copy of this License; and

 (b) You must cause any modified files to carry prominent notices
 stating that You changed the files; and

 (c) You must retain, in the Source form of any Derivative Works
 that You distribute, all copyright, patent, trademark, and
 attribution notices from the Source form of the Work,
 excluding those notices that do not pertain to any part of
 the Derivative Works; and

 (d) If the Work includes a "NOTICE" text file as part of its
 distribution, then any Derivative Works that You distribute must
 include a readable copy of the attribution notices contained
 within such NOTICE file, excluding those notices that do not
 pertain to any part of the Derivative Works, in at least one
 of the following places: within a NOTICE text file distributed
 as part of the Derivative Works; within the Source form or
 documentation, if provided along with the Derivative Works; or,
 within a display generated by the Derivative Works, if and
 wherever such third-party notices normally appear. The contents
 of the NOTICE file are for informational purposes only and
 do not modify the License. You may add Your own attribution
 notices within Derivative Works that You distribute, alongside
 or as an addendum to the NOTICE text from the Work, provided
 that such additional attribution notices cannot be construed
 as modifying the License.

 You may add Your own copyright statement to Your modifications and
 may provide additional or different license terms and conditions
 for use, reproduction, or distribution of Your modifications, or
 for any such Derivative Works as a whole, provided Your use,
 reproduction, and distribution of the Work otherwise complies with
 the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
 any Contribution intentionally submitted for inclusion in the Work
 by You to the Licensor shall be under the terms and conditions of
 this License, without any additional terms or conditions.
 Notwithstanding the above, nothing herein shall supersede or modify
 the terms of any separate license agreement you may have executed
 with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
 names, trademarks, service marks, or product names of the Licensor,
 except as required for reasonable and customary use in describing the
 origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
 agreed to in writing, Licensor provides the Work (and each
 Contributor provides its Contributions) on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 implied, including, without limitation, any warranties or conditions
 of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
 PARTICULAR PURPOSE. You are solely responsible for determining the
 appropriateness of using or redistributing the Work and assume any
 risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
 whether in tort (including negligence), contract, or otherwise,
 unless required by applicable law (such as deliberate and grossly
 negligent acts) or agreed to in writing, shall any Contributor be
 liable to You for damages, including any direct, indirect, special,
 incidental, or consequential damages of any character arising as a
 result of this License or out of the use or inability to use the
 Work (including but not limited to damages for loss of goodwill,
 work stoppage, computer failure or malfunction, or any and all
 other commercial damages or losses), even if such Contributor
 has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
 the Work or Derivative Works thereof, You may choose to offer,
 and charge a fee for, acceptance of support, warranty, indemnity,
 or other liability obligations and/or rights consistent with this
 License. However, in accepting such obligations, You may act only
 on Your own behalf and on Your sole responsibility, not on behalf
 of any other Contributor, and only if You agree to indemnify,
 defend, and hold each Contributor harmless for any liability
 incurred by, or claims asserted against, such Contributor by reason
 of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

 To apply the Apache License to your work, attach the following
 boilerplate notice, with the fields enclosed by brackets "{}"
 replaced with your own identifying information. (Don't include
 the brackets!)  The text should be enclosed in the appropriate
 comment syntax for the file format. We also recommend that a
 file or class name and description of purpose be included on the
 same "printed page" as the copyright notice for easier
 identification within third-party archives.

 Copyright (C) 2013-present   SheetJS LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 */var k=Math;function de(s,e){for(var t=0,r=0;t<s.length;++t)r=e*r+s[t];return r}function Wc(s,e,t,r,n){if(e===0)return t;if(e===1)return r;for(var i=2/s,a=r,o=1;o<e;++o)a=r*o*i+n*t,t=r,r=a;return a}function Yc(s,e,t,r,n){return function(a,o){if(r){if(a===0)return r==1?-1/0:1/0;if(a<0)return NaN}if(o===0)return s(a);if(o===1)return e(a);if(o<0)return NaN;o|=0;var u=s(a),l=e(a);return Wc(a,o,u,l,n)}}var ba=function(){var s=.636619772,e=[57568490574,-13362590354,6516196407e-1,-1121442418e-2,77392.33017,-184.9052456].reverse(),t=[57568490411,1029532985,9494680718e-3,59272.64853,267.8532712,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),n=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934935152e-16].reverse();function i(d){var f=0,E=0,N=0,R=d*d;if(d<8)E=de(e,R),N=de(t,R),f=E/N;else{var y=d-.785398164;R=64/R,E=de(r,R),N=de(n,R),f=k.sqrt(s/d)*(k.cos(y)*E-k.sin(y)*N*8/d)}return f}var a=[72362614232,-7895059235,2423968531e-1,-2972611439e-3,15704.4826,-30.16036606].reverse(),o=[144725228442,2300535178,1858330474e-2,99447.43394,376.9991397,1].reverse(),u=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function c(d){var f=0,E=0,N=0,R=d*d,y=k.abs(d)-2.356194491;return Math.abs(d)<8?(E=d*de(a,R),N=de(o,R),f=E/N):(R=64/R,E=de(u,R),N=de(l,R),f=k.sqrt(s/k.abs(d))*(k.cos(y)*E-k.sin(y)*N*8/k.abs(d)),d<0&&(f=-f)),f}return function d(f,E){if(E=Math.round(E),!isFinite(f))return isNaN(f)?f:0;if(E<0)return(E%2?-1:1)*d(f,-E);if(f<0)return(E%2?-1:1)*d(-f,E);if(E===0)return i(f);if(E===1)return c(f);if(f===0)return 0;var N=0;if(f>E)N=Wc(f,E,i(f),c(f),-1);else{for(var R=2*k.floor((E+k.floor(k.sqrt(40*E)))/2),y=!1,S=0,A=0,C=1,I=0,oe=2/f,Q=R;Q>0;Q--)I=Q*oe*C-S,S=C,C=I,k.abs(C)>1e10&&(C*=1e-10,S*=1e-10,N*=1e-10,A*=1e-10),y&&(A+=C),y=!y,Q==E&&(N=S);A=2*A-C,N/=A}return N}}(),QT=function(){var s=.636619772,e=[-2957821389,7062834065,-5123598036e-1,1087988129e-2,-86327.92757,228.4622733].reverse(),t=[40076544269,7452499648e-1,7189466438e-3,47447.2647,226.1030244,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),n=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934945152e-16].reverse();function i(d){var f=0,E=0,N=0,R=d*d,y=d-.785398164;return d<8?(E=de(e,R),N=de(t,R),f=E/N+s*ba(d,0)*k.log(d)):(R=64/R,E=de(r,R),N=de(n,R),f=k.sqrt(s/d)*(k.sin(y)*E+k.cos(y)*N*8/d)),f}var a=[-4900604943e3,127527439e4,-51534381390,7349264551e-1,-4237922726e-3,8511.937935].reverse(),o=[249958057e5,424441966400,3733650367,2245904002e-2,102042.605,354.9632885,1].reverse(),u=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function c(d){var f=0,E=0,N=0,R=d*d,y=d-2.356194491;return d<8?(E=d*de(a,R),N=de(o,R),f=E/N+s*(ba(d,1)*k.log(d)-1/d)):(R=64/R,E=de(u,R),N=de(l,R),f=k.sqrt(s/d)*(k.sin(y)*E+k.cos(y)*N*8/d)),f}return Yc(i,c,"BESSELY",1,-1)}(),xa=function(){var s=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),e=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse();function t(a){return a<=3.75?de(s,a*a/(3.75*3.75)):k.exp(k.abs(a))/k.sqrt(k.abs(a))*de(e,3.75/k.abs(a))}var r=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),n=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse();function i(a){return a<3.75?a*de(r,a*a/(3.75*3.75)):(a<0?-1:1)*k.exp(k.abs(a))/k.sqrt(k.abs(a))*de(n,3.75/k.abs(a))}return function a(o,u){if(u=Math.round(u),u===0)return t(o);if(u===1)return i(o);if(u<0)return NaN;if(k.abs(o)===0)return 0;if(o==1/0)return 1/0;var l=0,c,d=2/k.abs(o),f=0,E=1,N=0,R=2*k.round((u+k.round(k.sqrt(40*u)))/2);for(c=R;c>0;c--)N=c*d*E+f,f=E,E=N,k.abs(E)>1e10&&(E*=1e-10,f*=1e-10,l*=1e-10),c==u&&(l=f);return l*=a(o,0)/E,o<0&&u%2?-l:l}}(),ZT=function(){var s=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),e=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();function t(a){return a<=2?-k.log(a/2)*xa(a,0)+de(s,a*a/4):k.exp(-a)/k.sqrt(a)*de(e,2/a)}var r=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),n=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();function i(a){return a<=2?k.log(a/2)*xa(a,1)+1/a*de(r,a*a/4):k.exp(-a)/k.sqrt(a)*de(n,2/a)}return Yc(t,i,"BESSELK",2,1)}();/**
 * @license
 Copyright (c) 2013 jStat

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 */function Tn(s){const e=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let t=e.length-1,r=!1,n=0,i=0,a,o,u,l;if(s===0)return 0;for(s<0&&(s=-s,r=!0),a=2/(2+s),o=4*a-2;t>0;t--)u=n,n=o*n-i+e[t],i=u;return l=a*Math.exp(-s*s+.5*(e[0]+o*n)-i),r?l-1:1-l}function zc(s){return 1-Tn(s)}function $c(s){let e=0,t,r,n,i;if(s>=2)return-100;if(s<=0)return 100;for(i=s<1?s:2-s,n=Math.sqrt(-2*Math.log(i/2)),t=-.70711*((2.30753+n*.27061)/(1+n*(.99229+n*.04481))-n);e<2;e++)r=zc(t)-i,t+=r/(1.1283791670955126*Math.exp(-t*t)-t*r);return s<1?t:-t}const Gu={pdf:(s,e)=>s<0?0:e*Math.exp(-e*s),cdf:(s,e)=>s<0?0:1-Math.exp(-e*s)};function jn(s){const e=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],t=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let r=!1,n=0,i=0,a=0,o=s,u,l,c,d;if(s>171.6243769536076)return 1/0;if(o<=0)if(d=o%1,d)r=(o&1?-1:1)*Math.PI/Math.sin(Math.PI*d),o=1-o;else return 1/0;for(c=o,o<1?l=o++:l=(o-=n=(o|0)-1)-1,u=0;u<8;++u)a=(a+e[u])*l,i=i*l+t[u];if(d=a/i+1,c<o)d/=c;else if(c>o)for(u=0;u<n;++u)d*=o,o++;return r&&(d=r/d),d}const ea={pdf:function(e,t,r){return e<0?0:e===0&&t===1?1/r:Math.exp((t-1)*Math.log(e)-e/r-be(t)-t*Math.log(r))},cdf:function(e,t,r){return e<0?0:go(t,e/r)},inv:function(s,e,t){return Xc(s,e)*t}};function be(s){let e=0;const t=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let r=1.000000000190015,n,i,a;for(a=(i=n=s)+5.5,a-=(n+.5)*Math.log(a);e<6;e++)r+=t[e]/++i;return Math.log(2.5066282746310007*r/n)-a}function go(s,e){const t=be(s);let r=s,n=1/s,i=n,a=e+1-s,o=1/1e-30,u=1/a,l=u,c=1;const d=-~(Math.log(s>=1?s:1/s)*8.5+s*.4+17);let f;if(e<0||s<=0)return NaN;if(e<s+1){for(;c<=d;c++)n+=i*=e/++r;return n*Math.exp(-e+s*Math.log(e)-t)}for(;c<=d;c++)f=-c*(c-s),a+=2,u=f*u+a,o=a+f/o,u=1/u,l*=u*o;return 1-l*Math.exp(-e+s*Math.log(e)-t)}function Xc(s,e){let t=0;const r=e-1,n=1e-8,i=be(e);let a,o,u,l,c,d,f;if(s>=1)return Math.max(100,e+100*Math.sqrt(e));if(s<=0)return 0;for(e>1?(d=Math.log(r),f=Math.exp(r*(d-1)-i),c=s<.5?s:1-s,u=Math.sqrt(-2*Math.log(c)),a=(2.30753+u*.27061)/(1+u*(.99229+u*.04481))-u,s<.5&&(a=-a),a=Math.max(.001,e*Math.pow(1-1/(9*e)-a/(3*Math.sqrt(e)),3))):(u=1-e*(.253+e*.12),s<u?a=Math.pow(s/u,1/e):a=1-Math.log(1-(s-u)/(1-u)));t<12;t++){if(a<=0)return 0;if(o=go(e,a)-s,e>1?u=f*Math.exp(-(a-r)+r*(Math.log(a)-d)):u=Math.exp(-a+r*Math.log(a)-i),l=o/u,a-=u=l/(1-.5*Math.min(1,l*((e-1)/a-1))),a<=0&&(a=.5*(a+u)),Math.abs(u)<n*a)break}return a}const Mt={pdf:function(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(e-t,2)/(2*r*r))},cdf:function(e,t,r){return .5*(1+Tn((e-t)/Math.sqrt(2*r*r)))},inv:function(s,e,t){return-1.4142135623730951*t*$c(2*s)+e}},ta={pdf:function(e,t,r){return e>1||e<0?0:t==1&&r==1?1:t<512&&r<512?Math.pow(e,t-1)*Math.pow(1-e,r-1)/Eo(t,r):Math.exp((t-1)*Math.log(e)+(r-1)*Math.log(1-e)-Kc(t,r))},cdf:function(e,t,r){return e>1||e<0?+(e>1):Ui(e,t,r)},inv:function(e,t,r){return Ro(e,t,r)}};function Eo(s,e){if(!(s<=0||e<=0))return s+e>170?Math.exp(Kc(s,e)):jn(s)*jn(e)/jn(s+e)}function Kc(s,e){return be(s)+be(e)-be(s+e)}function Ro(s,e,t){var r=1e-8,n=e-1,i=t-1,a=0,o,u,l,c,d,f,E,N,R,y,S;if(s<=0)return 0;if(s>=1)return 1;for(e>=1&&t>=1?(l=s<.5?s:1-s,c=Math.sqrt(-2*Math.log(l)),E=(2.30753+c*.27061)/(1+c*(.99229+c*.04481))-c,s<.5&&(E=-E),N=(E*E-3)/6,R=2/(1/(2*e-1)+1/(2*t-1)),y=E*Math.sqrt(N+R)/R-(1/(2*t-1)-1/(2*e-1))*(N+5/6-2/(3*R)),E=e/(e+t*Math.exp(2*y))):(o=Math.log(e/(e+t)),u=Math.log(t/(e+t)),c=Math.exp(e*o)/e,d=Math.exp(t*u)/t,y=c+d,s<c/y?E=Math.pow(e*y*s,1/e):E=1-Math.pow(t*y*(1-s),1/t)),S=-be(e)-be(t)+be(e+t);a<10;a++){if(E===0||E===1)return E;if(f=Ui(E,e,t)-s,c=Math.exp(n*Math.log(E)+i*Math.log(1-E)+S),d=f/c,E-=c=d/(1-.5*Math.min(1,d*(n/E-i/(1-E)))),E<=0&&(E=.5*(E+c)),E>=1&&(E=.5*(E+c+1)),Math.abs(c)<r*E&&a>0)break}return E}function Ui(s,e,t){var r=s===0||s===1?0:Math.exp(be(e+t)-be(e)-be(t)+e*Math.log(s)+t*Math.log(1-s));return s<0||s>1?!1:s<(e+1)/(e+t+2)?r*Hu(s,e,t)/e:1-r*Hu(1-s,t,e)/t}function Hu(s,e,t){var r=1e-30,n=1,i=e+t,a=e+1,o=e-1,u=1,l=1-i*s/a,c,d,f,E;for(Math.abs(l)<r&&(l=r),l=1/l,E=l;n<=100&&(c=2*n,d=n*(t-n)*s/((o+c)*(e+c)),l=1+d*l,Math.abs(l)<r&&(l=r),u=1+d/u,Math.abs(u)<r&&(u=r),l=1/l,E*=l*u,d=-(e+n)*(i+n)*s/((e+c)*(a+c)),l=1+d*l,Math.abs(l)<r&&(l=r),u=1+d/u,Math.abs(u)<r&&(u=r),l=1/l,f=l*u,E*=f,!(Math.abs(f-1)<3e-7));n++);return E}const Ys={pdf:function(s,e,t){return t===0||t===1?e*t===s?1:0:jc(e,s)*Math.pow(t,s)*Math.pow(1-t,e-s)},cdf:function(s,e,t){var r,n=1e-10;if(s<0)return 0;if(s>=e)return 1;if(t<0||t>1||e<=0)return NaN;s=Math.floor(s);var i=t,a=s+1,o=e-s,u=a+o,l=Math.exp(be(u)-be(o)-be(a)+a*Math.log(i)+o*Math.log(1-i));return i<(a+1)/(u+2)?r=l*Wu(i,a,o,n):r=1-l*Wu(1-i,o,a,n),Math.round((1-r)*(1/n))/(1/n)}};function Wu(s,e,t,r){for(var n=0,i=1,a=1,o=1,u=0,l=0,c;Math.abs((a-l)/a)>r;)l=a,c=-(e+u)*(e+t+u)*s/(e+2*u)/(e+2*u+1),n=a+c*n,i=o+c*i,u=u+1,c=u*(t-u)*s/(e+2*u-1)/(e+2*u),a=n+c*a,o=i+c*o,n=n/o,i=i/o,a=a/o,o=1;return a/e}function jc(s,e){return s>170||e>170?Math.exp(JT(s,e)):zs(s)/zs(e)/zs(s-e)}function JT(s,e){return ra(s)-ra(e)-ra(s-e)}function ra(s){return s<0?NaN:be(s+1)}function zs(s){return s<0?NaN:jn(s+1)}const on={pdf:function(e,t){return e<0?0:e===0&&t===2?.5:Math.exp((t/2-1)*Math.log(e)-e/2-t/2*Math.log(2)-be(t/2))},cdf:function(e,t){return e<0?0:go(t/2,e/2)},inv:function(s,e){return 2*Xc(s,.5*e)}},un={pdf:function(e,t,r){var n,i,a;return e<0?0:t<=2?e===0&&t<2?1/0:e===0&&t===2?1:1/Eo(t/2,r/2)*Math.pow(t/r,t/2)*Math.pow(e,t/2-1)*Math.pow(1+t/r*e,-(t+r)/2):(n=t*e/(r+e*t),i=r/(r+e*t),a=t*i/2,a*Ys.pdf((t-2)/2,(t+r-2)/2,n))},cdf:function(e,t,r){return e<0?0:Ui(t*e/(t*e+r),t/2,r/2)},inv:function(e,t,r){return r/(t*(1/Ro(e,t/2,r/2)-1))}},Yu={pdf:function(e,t,r){return e<0||t<0||r<0?0:r/t*Math.pow(e/t,r-1)*Math.exp(-Math.pow(e/t,r))},cdf:function(e,t,r){return e<0?0:1-Math.exp(-Math.pow(e/t,r))}},Pa={pdf:function(e,t){return t<0||e%1!==0||e<0?0:Math.pow(t,e)*Math.exp(-t)/zs(e)},cdf:function(e,t){var r=0;if(e<0)return 0;for(var n=0;r<=e;r++)n+=Pa.pdf(r,t);return n}},rr={pdf:function(e,t,r,n){if(e<0||e<r-(t-n))return 0;if(e>n||e>r)return 0;if(r*2>t)return n*2>t?rr.pdf(t-r-n+e,t,t-r,t-n):rr.pdf(n-e,t,t-r,n);if(n*2>t)return rr.pdf(r-e,t,r,t-n);if(r<n)return rr.pdf(e,t,n,r);for(var i=1,a=0,o=0;o<e;o++){for(;i>1&&a<n;)i*=1-r/(t-a),a++;i*=(n-o)*(r-o)/((o+1)*(t-r-n+o+1))}for(;a<n;a++)i*=1-r/(t-a);return Math.min(1,Math.max(0,i))},cdf:function s(e,t,r,n){if(e<0||e<r-(t-n))return 0;if(e>=n||e>=r)return 1;if(r*2>t)return n*2>t?s(t-r-n+e,t,t-r,t-n):1-rr.cdf(n-e-1,t,t-r,n);if(n*2>t)return 1-rr.cdf(r-e-1,t,r,t-n);if(r<n)return rr.cdf(e,t,n,r);for(var i=1,a=1,o=0,u=0;u<e;u++){for(;i>1&&o<n;){var l=1-r/(t-o);a*=l,i*=l,o++}a*=(n-u)*(r-u)/((u+1)*(t-r-n+u+1)),i+=a}for(;o<n;o++)i*=1-r/(t-o);return Math.min(1,Math.max(0,i))}},Nt={pdf:function(e,t){return t=t>1e100?1e100:t,1/(Math.sqrt(t)*Eo(.5,t/2))*Math.pow(1+e*e/t,-((t+1)/2))},cdf:function(e,t){var r=t/2;return Ui((e+Math.sqrt(e*e+t))/(2*Math.sqrt(e*e+t)),r,r)},inv:function(s,e){var t=Ro(2*Math.min(s,1-s),.5*e,.5);return t=Math.sqrt(e*(1-t)/t),s>.5?t:-t}},na={pdf:function(e,t,r){return e<=0?0:Math.exp(-Math.log(e)-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(Math.log(e)-t,2)/(2*r*r))},cdf:function(e,t,r){return e<0?0:.5+.5*Tn((Math.log(e)-t)/Math.sqrt(2*r*r))},inv:function(s,e,t){return Math.exp(-1.4142135623730951*t*$c(2*s)+e)}},Da={pdf:function(e,t,r){return e!==e>>>0?!1:e<0?0:jc(e+t-1,t-1)*Math.pow(1-r,e)*Math.pow(r,t)},cdf:function(e,t,r){var n=0,i=0;if(e<0)return 0;for(;i<=e;i++)n+=Da.pdf(i,t,r);return n}};function qc(s){for(var e=0,t=s.length;--t>=0;)e+=s[t];return e}function Tt(s){return qc(s)/s.length}function Pr(s){for(var e=Tt(s),t=0,r=s.length,n;--r>=0;)n=s[r]-e,t+=n*n;return t}function Vn(s,e){return Pr(s)/(s.length-(e?1:0))}function Nr(s,e){return Math.sqrt(Vn(s,e))}function eN(){var s=[].slice.call(arguments),e=new Array(2),t;return s.length===4?t=Math.abs(Mt.inv(s[1]/2,0,1)*s[2]/Math.sqrt(s[3])):t=Math.abs(Mt.inv(s[1]/2,0,1)*Nr(s[2])/Math.sqrt(s[2].length)),e[0]=s[0]-t,e[1]=s[0]+t,e}function tN(){var s=[].slice.call(arguments),e=new Array(2),t;return s.length===4?t=Math.abs(Nt.inv(s[1]/2,s[3]-1)*s[2]/Math.sqrt(s[3])):t=Math.abs(Nt.inv(s[1]/2,s[2].length-1)*Nr(s[2],!0)/Math.sqrt(s[2].length)),e[0]=s[0]-t,e[1]=s[0]+t,e}function rN(s){for(var e=1,t=s.length;--t>=0;)e*=s[t];return e}function nN(s){return Math.pow(rN(s),1/s.length)}function Bn(s,e){var t=Tt(s),r=Tt(e),n=s.length,i=new Array(n),a;for(a=0;a<n;a++)i[a]=(s[a]-t)*(e[a]-r);return qc(i)/(n-1)}function zu(s,e){return Bn(s,e)/Nr(s,1)/Nr(e,1)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class To extends V{erf(e,t){return this.runFunction(e.args,t,this.metadata("ERF"),(r,n)=>n===void 0?Tn(r):Tn(n)-Tn(r))}erfc(e,t){return this.runFunction(e.args,t,this.metadata("ERFC"),zc)}expondist(e,t){return this.runFunction(e.args,t,this.metadata("EXPON.DIST"),(r,n,i)=>i?Gu.cdf(r,n):Gu.pdf(r,n))}fisher(e,t){return this.runFunction(e.args,t,this.metadata("FISHER"),r=>Math.log((1+r)/(1-r))/2)}fisherinv(e,t){return this.runFunction(e.args,t,this.metadata("FISHERINV"),r=>1-2/(Math.exp(2*r)+1))}gamma(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA"),jn)}gammadist(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.DIST"),(r,n,i,a)=>a?ea.cdf(r,n,i):ea.pdf(r,n,i))}gammaln(e,t){return this.runFunction(e.args,t,this.metadata("GAMMALN"),be)}gammainv(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.INV"),ea.inv)}gauss(e,t){return this.runFunction(e.args,t,this.metadata("GAUSS"),r=>Mt.cdf(r,0,1)-.5)}betadist(e,t){return this.runFunction(e.args,t,this.metadata("BETA.DIST"),(r,n,i,a,o,u)=>r<=o?new p(m.NUM,T.ValueSmall):r>=u?new p(m.NUM,T.ValueLarge):(r=(r-o)/(u-o),a?ta.cdf(r,n,i):ta.pdf(r,n,i)))}betainv(e,t){return this.runFunction(e.args,t,this.metadata("BETA.INV"),(r,n,i,a,o)=>a>=o?new p(m.NUM,T.WrongOrder):ta.inv(r,n,i)*(o-a)+a)}binomialdist(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.DIST"),(r,n,i,a)=>r>n?new p(m.NUM,T.WrongOrder):(r=Math.trunc(r),n=Math.trunc(n),a?Ys.cdf(r,n,i):Ys.pdf(r,n,i)))}binomialinv(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.INV"),(r,n,i)=>{r=Math.trunc(r);let a=-1,o=r;for(;o>a+1;){const u=Math.trunc((a+o)/2);Ys.cdf(u,r,n)>=i?o=u:a=u}return o})}besselifn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELI"),(r,n)=>xa(r,Math.trunc(n)))}besseljfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELJ"),(r,n)=>ba(r,Math.trunc(n)))}besselkfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELK"),(r,n)=>ZT(r,Math.trunc(n)))}besselyfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELY"),(r,n)=>QT(r,Math.trunc(n)))}chisqdist(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST"),(r,n,i)=>(n=Math.trunc(n),i?on.cdf(r,n):on.pdf(r,n)))}chisqdistrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST.RT"),(r,n)=>1-on.cdf(r,Math.trunc(n)))}chisqinv(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV"),(r,n)=>on.inv(r,Math.trunc(n)))}chisqinvrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV.RT"),(r,n)=>on.inv(1-r,Math.trunc(n)))}fdist(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST"),(r,n,i,a)=>(n=Math.trunc(n),i=Math.trunc(i),a?un.cdf(r,n,i):un.pdf(r,n,i)))}fdistrt(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST.RT"),(r,n,i)=>1-un.cdf(r,Math.trunc(n),Math.trunc(i)))}finv(e,t){return this.runFunction(e.args,t,this.metadata("F.INV"),(r,n,i)=>un.inv(r,Math.trunc(n),Math.trunc(i)))}finvrt(e,t){return this.runFunction(e.args,t,this.metadata("F.INV.RT"),(r,n,i)=>un.inv(1-r,Math.trunc(n),Math.trunc(i)))}weibulldist(e,t){return this.runFunction(e.args,t,this.metadata("WEIBULL.DIST"),(r,n,i,a)=>a?Yu.cdf(r,i,n):Yu.pdf(r,i,n))}poissondist(e,t){return this.runFunction(e.args,t,this.metadata("POISSON.DIST"),(r,n,i)=>(r=Math.trunc(r),i?Pa.cdf(r,n):Pa.pdf(r,n)))}hypgeomdist(e,t){return this.runFunction(e.args,t,this.metadata("HYPGEOM.DIST"),(r,n,i,a,o)=>r>n||r>i||n>a||i>a?new p(m.NUM,T.ValueLarge):r+a<i+n?new p(m.NUM,T.ValueLarge):(r=Math.trunc(r),n=Math.trunc(n),i=Math.trunc(i),a=Math.trunc(a),o?rr.cdf(r,a,i,n):rr.pdf(r,a,i,n)))}tdist(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST"),(r,n,i)=>(n=Math.trunc(n),i?Nt.cdf(r,n):Nt.pdf(r,n)))}tdist2t(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.2T"),(r,n)=>(1-Nt.cdf(r,Math.trunc(n)))*2)}tdistrt(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.RT"),(r,n)=>1-Nt.cdf(r,Math.trunc(n)))}tdistold(e,t){return this.runFunction(e.args,t,this.metadata("TDIST"),(r,n,i)=>i*(1-Nt.cdf(r,Math.trunc(n))))}tinv(e,t){return this.runFunction(e.args,t,this.metadata("T.INV"),(r,n)=>Nt.inv(r,Math.trunc(n)))}tinv2t(e,t){return this.runFunction(e.args,t,this.metadata("T.INV.2T"),(r,n)=>Nt.inv(1-r/2,Math.trunc(n)))}lognormdist(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.DIST"),(r,n,i,a)=>a?na.cdf(r,n,i):na.pdf(r,n,i))}lognorminv(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.INV"),(r,n,i)=>na.inv(r,n,i))}normdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.DIST"),(r,n,i,a)=>a?Mt.cdf(r,n,i):Mt.pdf(r,n,i))}norminv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.INV"),(r,n,i)=>Mt.inv(r,n,i))}normsdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.DIST"),(r,n)=>n?Mt.cdf(r,0,1):Mt.pdf(r,0,1))}normsinv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.INV"),r=>Mt.inv(r,0,1))}phi(e,t){return this.runFunction(e.args,t,this.metadata("PHI"),r=>Mt.pdf(r,0,1))}negbinomdist(e,t){return this.runFunction(e.args,t,this.metadata("NEGBINOM.DIST"),(r,n,i,a)=>(r=Math.trunc(r),n=Math.trunc(n),a?Da.cdf(r,n,i):Da.pdf(r,n,i)))}confidencenorm(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.NORM"),(r,n,i)=>eN(1,r,n,Math.trunc(i))[1]-1)}confidencet(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.T"),(r,n,i)=>(i=Math.trunc(i),i===1?new p(m.DIV_BY_ZERO):tN(1,r,n,i)[1]-1))}standardize(e,t){return this.runFunction(e.args,t,this.metadata("STANDARDIZE"),(r,n,i)=>(r-n)/i)}}To.implementedFunctions={ERF:{method:"erf",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}]},ERFC:{method:"erfc",parameters:[{argumentType:h.NUMBER}]},"EXPON.DIST":{method:"expondist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},FISHER:{method:"fisher",parameters:[{argumentType:h.NUMBER,greaterThan:-1,lessThan:1}]},FISHERINV:{method:"fisherinv",parameters:[{argumentType:h.NUMBER}]},GAMMA:{method:"gamma",parameters:[{argumentType:h.NUMBER}]},"GAMMA.DIST":{method:"gammadist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},GAMMALN:{method:"gammaln",parameters:[{argumentType:h.NUMBER,greaterThan:0}]},"GAMMA.INV":{method:"gammainv",parameters:[{argumentType:h.NUMBER,minValue:0,lessThan:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0}]},GAUSS:{method:"gauss",parameters:[{argumentType:h.NUMBER}]},"BETA.DIST":{method:"betadist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:1}]},"BETA.INV":{method:"betainv",parameters:[{argumentType:h.NUMBER,greaterThan:0,maxValue:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:1}]},"BINOM.DIST":{method:"binomialdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.BOOLEAN}]},"BINOM.INV":{method:"binomialinv",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,greaterThan:0,lessThan:1}]},BESSELI:{method:"besselifn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},BESSELJ:{method:"besseljfn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},BESSELK:{method:"besselkfn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},BESSELY:{method:"besselyfn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},"CHISQ.DIST":{method:"chisqdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1,maxValue:1e10},{argumentType:h.BOOLEAN}]},"CHISQ.DIST.RT":{method:"chisqdistrt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV":{method:"chisqinv",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV.RT":{method:"chisqinvrt",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1}]},"F.DIST":{method:"fdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1},{argumentType:h.BOOLEAN}]},"F.DIST.RT":{method:"fdistrt",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1}]},"F.INV":{method:"finv",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1}]},"F.INV.RT":{method:"finvrt",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1}]},"WEIBULL.DIST":{method:"weibulldist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"POISSON.DIST":{method:"poissondist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.BOOLEAN}]},"HYPGEOM.DIST":{method:"hypgeomdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"T.DIST":{method:"tdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1},{argumentType:h.BOOLEAN}]},"T.DIST.2T":{method:"tdist2t",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1}]},"T.DIST.RT":{method:"tdistrt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1}]},TDIST:{method:"tdistold",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.INTEGER,minValue:1,maxValue:2}]},"T.INV":{method:"tinv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER,minValue:1}]},"T.INV.2T":{method:"tinv2t",parameters:[{argumentType:h.NUMBER,greaterThan:0,maxValue:1},{argumentType:h.NUMBER,minValue:1}]},"LOGNORM.DIST":{method:"lognormdist",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"LOGNORM.INV":{method:"lognorminv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0}]},"NORM.DIST":{method:"normdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"NORM.INV":{method:"norminv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0}]},"NORM.S.DIST":{method:"normsdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.BOOLEAN}]},"NORM.S.INV":{method:"normsinv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1}]},PHI:{method:"phi",parameters:[{argumentType:h.NUMBER}]},"NEGBINOM.DIST":{method:"negbinomdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.BOOLEAN}]},"CONFIDENCE.NORM":{method:"confidencenorm",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,minValue:1}]},"CONFIDENCE.T":{method:"confidencet",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,minValue:1}]},STANDARDIZE:{method:"standardize",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0}]}};To.aliases={NEGBINOMDIST:"NEGBINOM.DIST",EXPONDIST:"EXPON.DIST",BETADIST:"BETA.DIST",NORMDIST:"NORM.DIST",NORMINV:"NORM.INV",NORMSDIST:"NORM.S.DIST",NORMSINV:"NORM.S.INV",LOGNORMDIST:"LOGNORM.DIST",LOGINV:"LOGNORM.INV",TINV:"T.INV.2T",HYPGEOMDIST:"HYPGEOM.DIST",POISSON:"POISSON.DIST",WEIBULL:"WEIBULL.DIST",FINV:"F.INV.RT",FDIST:"F.DIST.RT",CHIDIST:"CHISQ.DIST.RT",CHIINV:"CHISQ.INV.RT",GAMMADIST:"GAMMA.DIST","GAMMALN.PRECISE":"GAMMALN",GAMMAINV:"GAMMA.INV",BETAINV:"BETA.INV",BINOMDIST:"BINOM.DIST",CONFIDENCE:"CONFIDENCE.NORM",CRITBINOM:"BINOM.INV",WEIBULLDIST:"WEIBULL.DIST",TINV2T:"T.INV.2T",TDISTRT:"T.DIST.RT",TDIST2T:"T.DIST.2T",FINVRT:"F.INV.RT",FDISTRT:"F.DIST.RT",CHIDISTRT:"CHISQ.DIST.RT",CHIINVRT:"CHISQ.INV.RT",LOGNORMINV:"LOGNORM.INV",POISSONDIST:"POISSON.DIST"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Qc extends V{fact(e,t){return this.runFunction(e.args,t,this.metadata("FACT"),r=>{r=Math.trunc(r);let n=1;for(let i=1;i<=r;i++)n*=i;return n})}factdouble(e,t){return this.runFunction(e.args,t,this.metadata("FACTDOUBLE"),r=>{r=Math.trunc(r);let n=1;for(let i=r;i>=1;i-=2)n*=i;return n})}combin(e,t){return this.runFunction(e.args,t,this.metadata("COMBIN"),(r,n)=>n>r?new p(m.NUM,T.WrongOrder):(r=Math.trunc(r),n=Math.trunc(n),$u(r,n)))}combina(e,t){return this.runFunction(e.args,t,this.metadata("COMBINA"),(r,n)=>(r=Math.trunc(r),n=Math.trunc(n),r+n-1>=1030?new p(m.NUM,T.ValueLarge):r===0&&n===0?1:$u(r+n-1,n)))}gcd(e,t){return this.runFunction(e.args,t,this.metadata("GCD"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(r);if(n instanceof p)return n;let i=0;for(const a of n){if(a<0)return new p(m.NUM,T.ValueSmall);i=Zc(i,Math.trunc(a))}return i>Number.MAX_SAFE_INTEGER?new p(m.NUM,T.ValueLarge):i})}lcm(e,t){return this.runFunction(e.args,t,this.metadata("LCM"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(r);if(n instanceof p)return n;let i=1;for(const a of n){if(a<0)return new p(m.NUM,T.ValueSmall);i=sN(i,Math.trunc(a))}return i>Number.MAX_SAFE_INTEGER?new p(m.NUM,T.ValueLarge):i})}mround(e,t){return this.runFunction(e.args,t,this.metadata("MROUND"),(r,n)=>n===0?0:r>0&&n<0||r<0&&n>0?new p(m.NUM,T.DistinctSigns):Math.round(r/n)*n)}multinomial(e,t){return this.runFunction(e.args,t,this.metadata("MULTINOMIAL"),(...r)=>{let n=0,i=1;for(let a of r){if(a<0)return new p(m.NUM,T.ValueSmall);a=Math.trunc(a);for(let o=1;o<=a;o++)i*=(n+o)/o;n+=a}return Math.round(i)})}quotient(e,t){return this.runFunction(e.args,t,this.metadata("QUOTIENT"),(r,n)=>n===0?new p(m.DIV_BY_ZERO):Math.trunc(r/n))}seriessum(e,t){return this.runFunction(e.args,t,this.metadata("SERIESSUM"),(r,n,i,a)=>{const o=this.arithmeticHelper.manyToOnlyNumbersDropNulls(a.valuesFromTopLeftCorner());if(o instanceof p)return o;let u=0;o.reverse();for(const l of o)u*=Math.pow(r,i),u+=l;return u*Math.pow(r,n)})}sign(e,t){return this.runFunction(e.args,t,this.metadata("SIGN"),r=>r>0?1:r<0?-1:0)}sumx2my2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2MY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new p(m.NA,T.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const c=i[l],d=a[l];if(c instanceof p)return c;if(d instanceof p)return d;typeof c=="number"&&typeof d=="number"&&(u+=Math.pow(c,2)-Math.pow(d,2))}return u})}sumx2py2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2PY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new p(m.NA,T.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const c=i[l],d=a[l];if(c instanceof p)return c;if(d instanceof p)return d;typeof c=="number"&&typeof d=="number"&&(u+=Math.pow(c,2)+Math.pow(d,2))}return u})}sumxmy2(e,t){return this.runFunction(e.args,t,this.metadata("SUMXMY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new p(m.NA,T.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const c=i[l],d=a[l];if(c instanceof p)return c;if(d instanceof p)return d;typeof c=="number"&&typeof d=="number"&&(u+=Math.pow(c-d,2))}return u})}}Qc.implementedFunctions={FACT:{method:"fact",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:170}]},FACTDOUBLE:{method:"factdouble",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:288}]},COMBIN:{method:"combin",parameters:[{argumentType:h.NUMBER,minValue:0,lessThan:1030},{argumentType:h.NUMBER,minValue:0}]},COMBINA:{method:"combina",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0}]},GCD:{method:"gcd",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},LCM:{method:"lcm",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MROUND:{method:"mround",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},MULTINOMIAL:{method:"multinomial",parameters:[{argumentType:h.NUMBER}],repeatLastArgs:1,expandRanges:!0},QUOTIENT:{method:"quotient",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},SERIESSUM:{method:"seriessum",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.RANGE}]},SIGN:{method:"sign",parameters:[{argumentType:h.NUMBER}]},SUMX2MY2:{method:"sumx2my2",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},SUMX2PY2:{method:"sumx2py2",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},SUMXMY2:{method:"sumxmy2",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]}};function $u(s,e){2*e>s&&(e=s-e);let t=1;for(let r=1;r<=e;r++)t*=(s-e+r)/r;return Math.round(t)}function Zc(s,e){for(s<e&&([s,e]=[e,s]);e>0;)[s,e]=[e,s%e];return s}function sN(s,e){return s===0||e===0?0:s*(e/Zc(s,e))}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Jc extends V{complex(e,t){return this.runFunction(e.args,t,this.metadata("COMPLEX"),(r,n,i)=>i!=="i"&&i!=="j"?new p(m.VALUE,T.ShouldBeIorJ):me([r,n],i))}imabs(e,t){return this.runFunction(e.args,t,this.metadata("IMABS"),rd)}imaginary(e,t){return this.runFunction(e.args,t,this.metadata("IMAGINARY"),([r,n])=>n)}imreal(e,t){return this.runFunction(e.args,t,this.metadata("IMREAL"),([r,n])=>r)}imargument(e,t){return this.runFunction(e.args,t,this.metadata("IMARGUMENT"),([r,n])=>r===0&&n===0?new p(m.DIV_BY_ZERO):Math.atan2(n,r))}imconjugate(e,t){return this.runFunction(e.args,t,this.metadata("IMCONJUGATE"),([r,n])=>me([r,-n]))}imcos(e,t){return this.runFunction(e.args,t,this.metadata("IMCOS"),r=>me(Fs(r)))}imcosh(e,t){return this.runFunction(e.args,t,this.metadata("IMCOSH"),r=>me(Xu(r)))}imcot(e,t){return this.runFunction(e.args,t,this.metadata("IMCOT"),r=>me(br(Fs(r),Us(r))))}imcsc(e,t){return this.runFunction(e.args,t,this.metadata("IMCSC"),r=>me(br([1,0],Us(r))))}imcsch(e,t){return this.runFunction(e.args,t,this.metadata("IMCSCH"),r=>me(br([1,0],Ku(r))))}imsec(e,t){return this.runFunction(e.args,t,this.metadata("IMSEC"),r=>me(br([1,0],Fs(r))))}imsech(e,t){return this.runFunction(e.args,t,this.metadata("IMSECH"),r=>me(br([1,0],Xu(r))))}imsin(e,t){return this.runFunction(e.args,t,this.metadata("IMSIN"),r=>me(Us(r)))}imsinh(e,t){return this.runFunction(e.args,t,this.metadata("IMSINH"),r=>me(Ku(r)))}imtan(e,t){return this.runFunction(e.args,t,this.metadata("IMTAN"),r=>me(br(Us(r),Fs(r))))}imdiv(e,t){return this.runFunction(e.args,t,this.metadata("IMDIV"),(r,n)=>me(br(r,n)))}improduct(e,t){return this.runFunction(e.args,t,this.metadata("IMPRODUCT"),(...r)=>{const n=this.arithmeticHelper.coerceComplexExactRanges(r);if(n instanceof p)return n;let i=[1,0];for(const a of n)i=ed(i,a);return me(i)})}imsum(e,t){return this.runFunction(e.args,t,this.metadata("IMSUM"),(...r)=>{const n=this.arithmeticHelper.coerceComplexExactRanges(r);if(n instanceof p)return n;let i=[0,0];for(const a of n)i=iN(i,a);return me(i)})}imsub(e,t){return this.runFunction(e.args,t,this.metadata("IMSUB"),(r,n)=>me(aN(r,n)))}imexp(e,t){return this.runFunction(e.args,t,this.metadata("IMEXP"),r=>me(td(r)))}imln(e,t){return this.runFunction(e.args,t,this.metadata("IMLN"),r=>me($s(r)))}imlog10(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG10"),r=>{const[n,i]=$s(r),a=Math.log(10);return me([n/a,i/a])})}imlog2(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG2"),r=>{const[n,i]=$s(r),a=Math.log(2);return me([n/a,i/a])})}impower(e,t){return this.runFunction(e.args,t,this.metadata("IMPOWER"),(r,n)=>me(ju(r,n)))}imsqrt(e,t){return this.runFunction(e.args,t,this.metadata("IMSQRT"),r=>me(ju(r,.5)))}}Jc.implementedFunctions={COMPLEX:{method:"complex",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.STRING,defaultValue:"i"}]},IMABS:{method:"imabs",parameters:[{argumentType:h.COMPLEX}]},IMAGINARY:{method:"imaginary",parameters:[{argumentType:h.COMPLEX}]},IMREAL:{method:"imreal",parameters:[{argumentType:h.COMPLEX}]},IMARGUMENT:{method:"imargument",parameters:[{argumentType:h.COMPLEX}]},IMCONJUGATE:{method:"imconjugate",parameters:[{argumentType:h.COMPLEX}]},IMCOS:{method:"imcos",parameters:[{argumentType:h.COMPLEX}]},IMCOSH:{method:"imcosh",parameters:[{argumentType:h.COMPLEX}]},IMCOT:{method:"imcot",parameters:[{argumentType:h.COMPLEX}]},IMCSC:{method:"imcsc",parameters:[{argumentType:h.COMPLEX}]},IMCSCH:{method:"imcsch",parameters:[{argumentType:h.COMPLEX}]},IMSEC:{method:"imsec",parameters:[{argumentType:h.COMPLEX}]},IMSECH:{method:"imsech",parameters:[{argumentType:h.COMPLEX}]},IMSIN:{method:"imsin",parameters:[{argumentType:h.COMPLEX}]},IMSINH:{method:"imsinh",parameters:[{argumentType:h.COMPLEX}]},IMTAN:{method:"imtan",parameters:[{argumentType:h.COMPLEX}]},IMDIV:{method:"imdiv",parameters:[{argumentType:h.COMPLEX},{argumentType:h.COMPLEX}]},IMPRODUCT:{method:"improduct",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},IMSUM:{method:"imsum",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},IMSUB:{method:"imsub",parameters:[{argumentType:h.COMPLEX},{argumentType:h.COMPLEX}]},IMEXP:{method:"imexp",parameters:[{argumentType:h.COMPLEX}]},IMLN:{method:"imln",parameters:[{argumentType:h.COMPLEX}]},IMLOG10:{method:"imlog10",parameters:[{argumentType:h.COMPLEX}]},IMLOG2:{method:"imlog2",parameters:[{argumentType:h.COMPLEX}]},IMPOWER:{method:"impower",parameters:[{argumentType:h.COMPLEX},{argumentType:h.NUMBER}]},IMSQRT:{method:"imsqrt",parameters:[{argumentType:h.COMPLEX}]}};function iN([s,e],[t,r]){return[s+t,e+r]}function aN([s,e],[t,r]){return[s-t,e-r]}function ed([s,e],[t,r]){return[s*t-e*r,s*r+t*e]}function br([s,e],[t,r]){const n=Math.pow(t,2)+Math.pow(r,2),[i,a]=ed([s,e],[t,-r]);return[i/n,a/n]}function Fs([s,e]){return[Math.cos(s)*Math.cosh(e),-Math.sin(s)*Math.sinh(e)]}function Xu([s,e]){return[Math.cosh(s)*Math.cos(e),Math.sinh(s)*Math.sin(e)]}function Us([s,e]){return[Math.sin(s)*Math.cosh(e),Math.cos(s)*Math.sinh(e)]}function Ku([s,e]){return[Math.sinh(s)*Math.cos(e),Math.cosh(s)*Math.sin(e)]}function td([s,e]){return[Math.exp(s)*Math.cos(e),Math.exp(s)*Math.sin(e)]}function rd([s,e]){return Math.sqrt(s*s+e*e)}function $s([s,e]){return[Math.log(rd([s,e])),Math.atan2(e,s)]}function ju(s,e){const[t,r]=$s(s);return td([e*t,e*r])}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class No extends V{avedev(e,t){return this.runFunction(e.args,t,this.metadata("AVEDEV"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof p)return n;if(n.length===0)return new p(m.DIV_BY_ZERO);const i=Tt(n);return n.reduce((a,o)=>a+Math.abs(o-i),0)/n.length})}devsq(e,t){return this.runFunction(e.args,t,this.metadata("DEVSQ"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);return n instanceof p?n:n.length===0?0:Pr(n)})}geomean(e,t){return this.runFunction(e.args,t,this.metadata("GEOMEAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof p)return n;if(n.length===0)return new p(m.NUM,T.OneValue);for(const i of n)if(i<=0)return new p(m.NUM,T.ValueSmall);return nN(n)})}harmean(e,t){return this.runFunction(e.args,t,this.metadata("HARMEAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof p)return n;if(n.length===0)return new p(m.NUM,T.OneValue);for(const i of n)if(i<=0)return new p(m.NUM,T.ValueSmall);return n.length/n.reduce((i,a)=>i+1/a,0)})}correl(e,t){return this.runFunction(e.args,t,this.metadata("CORREL"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=xr(r,n);return i instanceof p?i:i[0].length<=1?new p(m.DIV_BY_ZERO,T.TwoValues):zu(i[0],i[1])})}rsq(e,t){return this.runFunction(e.args,t,this.metadata("RSQ"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=xr(r,n);return i instanceof p?i:i[0].length<=1?new p(m.DIV_BY_ZERO,T.TwoValues):Math.pow(zu(i[0],i[1]),2)})}covariancep(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.P"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=xr(r,n);if(i instanceof p)return i;const a=i[0].length;return a<1?new p(m.DIV_BY_ZERO,T.OneValue):a===1?0:Bn(i[0],i[1])*(a-1)/a})}covariances(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.S"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=xr(r,n);return i instanceof p?i:i[0].length<=1?new p(m.DIV_BY_ZERO,T.TwoValues):Bn(i[0],i[1])})}ztest(e,t){return this.runFunction(e.args,t,this.metadata("Z.TEST"),(r,n,i)=>{const a=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());if(a instanceof p)return a;const o=a.length;if(i===void 0){if(o<2)return new p(m.DIV_BY_ZERO,T.TwoValues);i=Nr(a,!0)}return o<1?new p(m.NA,T.OneValue):i===0?new p(m.DIV_BY_ZERO):1-Mt.cdf((Tt(a)-n)/(i/Math.sqrt(o)),0,1)})}ftest(e,t){return this.runFunction(e.args,t,this.metadata("F.TEST"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner()),a=this.arithmeticHelper.manyToExactNumbers(n.valuesFromTopLeftCorner());if(i instanceof p)return i;if(a instanceof p)return a;if(i.length<=1||a.length<=1)return new p(m.DIV_BY_ZERO);const o=Vn(i,!0),u=Vn(a,!0);if(o===0||u===0)return new p(m.DIV_BY_ZERO);const l=o/u,c=un.cdf(l,i.length-1,a.length-1);return 2*Math.min(c,1-c)})}steyx(e,t){return this.runFunction(e.args,t,this.metadata("STEYX"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=xr(r,n);if(i instanceof p)return i;const a=i[0].length;return a<=2?new p(m.DIV_BY_ZERO,T.ThreeValues):Math.sqrt((Pr(i[0])-Math.pow(Bn(i[0],i[1])*(a-1),2)/Pr(i[1]))/(a-2))})}slope(e,t){return this.runFunction(e.args,t,this.metadata("SLOPE"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new p(m.NA,T.EqualLength);const i=xr(r,n);if(i instanceof p)return i;const a=i[0].length;return a<=1?new p(m.DIV_BY_ZERO,T.TwoValues):Bn(i[0],i[1])*(a-1)/Pr(i[1])})}chisqtest(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.TEST"),(r,n)=>{const i=r.height(),a=r.width();if(n.height()!==i||n.width()!==a)return new p(m.NA,T.EqualLength);const o=xr(r,n);if(o instanceof p)return o;if(o[0].length<=1)return new p(m.DIV_BY_ZERO,T.TwoValues);let u=0;for(let l=0;l<o[0].length;l++){if(o[1][l]===0)return new p(m.DIV_BY_ZERO);u+=Math.pow(o[0][l]-o[1][l],2)/o[1][l]}return u<0?new p(m.NUM,T.NaN):1-on.cdf(u,i>1&&a>1?(i-1)*(a-1):i*a-1)})}ttest(e,t){return this.runFunction(e.args,t,this.metadata("T.TEST"),(r,n,i,a)=>{const o=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner()),u=this.arithmeticHelper.manyToExactNumbers(n.valuesFromTopLeftCorner());if(o instanceof p)return o;if(u instanceof p)return u;const l=o.length,c=u.length;if(a===1){if(c!==l)return new p(m.NA,T.EqualLength);if(l<=1)return new p(m.DIV_BY_ZERO,T.TwoValues);const d=Array(l);for(let N=0;N<l;N++)d[N]=o[N]-u[N];const f=Nr(d,!0);if(f===0)return new p(m.DIV_BY_ZERO);const E=Math.abs(Math.sqrt(l)*Tt(d)/f);return i*(1-Nt.cdf(E,l-1))}else if(a===2){if(l<=1||c<=1)return new p(m.DIV_BY_ZERO,T.TwoValues);const d=(Pr(o)+Pr(u))/(l+c-2);if(d===0)return new p(m.DIV_BY_ZERO);const f=Math.abs((Tt(o)-Tt(u))/Math.sqrt(d*(1/l+1/c)));return i*(1-Nt.cdf(f,l+c-2))}else{if(l<=1||c<=1)return new p(m.DIV_BY_ZERO,T.TwoValues);const d=Vn(o,!0),f=Vn(u,!0);if(d===0&&f===0)return new p(m.DIV_BY_ZERO);const E=Math.abs((Tt(o)-Tt(u))/Math.sqrt(d/l+f/c)),N=Math.pow(d/l+f/c,2)/(Math.pow(d/l,2)/(l-1)+Math.pow(f/c,2)/(c-1));return i*(1-Nt.cdf(E,N))}})}skew(e,t){return this.runFunction(e.args,t,this.metadata("SKEW"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof p)return n;const i=n.length;if(i<3)return new p(m.DIV_BY_ZERO,T.ThreeValues);const a=Tt(n),o=Nr(n,!0);return o===0?new p(m.DIV_BY_ZERO):n.reduce((u,l)=>u+Math.pow((l-a)/o,3),0)*i/(i-1)/(i-2)})}skewp(e,t){return this.runFunction(e.args,t,this.metadata("SKEW.P"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof p)return n;const i=n.length;if(i<3)return new p(m.DIV_BY_ZERO,T.ThreeValues);const a=Tt(n),o=Nr(n,!1);return o===0?new p(m.DIV_BY_ZERO):n.reduce((u,l)=>u+Math.pow((l-a)/o,3),0)/i})}}No.implementedFunctions={AVEDEV:{method:"avedev",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},DEVSQ:{method:"devsq",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},GEOMEAN:{method:"geomean",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},HARMEAN:{method:"harmean",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},CORREL:{method:"correl",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},RSQ:{method:"rsq",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"COVARIANCE.P":{method:"covariancep",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"COVARIANCE.S":{method:"covariances",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"Z.TEST":{method:"ztest",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}]},"F.TEST":{method:"ftest",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},STEYX:{method:"steyx",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},SLOPE:{method:"slope",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"CHISQ.TEST":{method:"chisqtest",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"T.TEST":{method:"ttest",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.INTEGER,minValue:1,maxValue:2},{argumentType:h.INTEGER,minValue:1,maxValue:3}]},SKEW:{method:"skew",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"SKEW.P":{method:"skewp",parameters:[{argumentType:h.ANY}],repeatLastArgs:1}};No.aliases={COVAR:"COVARIANCE.P",FTEST:"F.TEST",PEARSON:"CORREL",ZTEST:"Z.TEST",CHITEST:"CHISQ.TEST",TTEST:"T.TEST",COVARIANCEP:"COVARIANCE.P",COVARIANCES:"COVARIANCE.S",SKEWP:"SKEW.P"};function xr(s,e){const t=s.iterateValuesFromTopLeftCorner(),r=e.iterateValuesFromTopLeftCorner();let n,i;const a=[],o=[];for(;n=t.next(),i=r.next(),!n.done&&!i.done;){const u=n.value,l=i.value;if(u instanceof p)return u;if(l instanceof p)return l;j(u)&&j(l)&&(a.push(O(u)),o.push(O(l)))}return[a,o]}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const qu=Object.freeze(Object.defineProperty({__proto__:null,AbsPlugin:rc,AddressPlugin:ec,ArrayPlugin:tc,BitShiftPlugin:nc,BitwiseLogicOperationsPlugin:oc,BooleanPlugin:uc,CharPlugin:hc,CodePlugin:lc,ComplexPlugin:Jc,ConditionalAggregationPlugin:Pc,CountBlankPlugin:cc,CountUniquePlugin:dc,DateTimePlugin:pc,DegreesPlugin:fc,DeltaPlugin:mc,ExpPlugin:gc,FinancialPlugin:Ec,FormulaTextPlugin:Rc,HyperlinkPlugin:Tc,InformationPlugin:Nc,IsEvenPlugin:Sc,IsOddPlugin:yc,LogarithmPlugin:Ac,LookupPlugin:kc,MathConstantsPlugin:Cc,MathPlugin:Qc,MatrixPlugin:vc,MedianPlugin:Ic,ModuloPlugin:Oc,NumericAggregationPlugin:fo,PowerPlugin:Mc,RadiansPlugin:wc,RadixConversionPlugin:Lc,RandomPlugin:bc,RomanPlugin:Gc,RoundingPlugin:mo,SimpleArithmerticPlugin:Hc,SqrtPlugin:xc,StatisticalAggregationPlugin:No,StatisticalPlugin:To,SumprodPlugin:Dc,TextPlugin:Vc,TrigonometryPlugin:Bc},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class W extends Pe{}W.HyperFormula=Pe;W.ErrorType=m;W.CellError=p;W.CellType=Qe;W.CellValueType=Lt;W.CellValueDetailedType=GE;W.DetailedCellError=Dl;W.ExportedCellChange=wa;W.ExportedNamedExpressionChange=jl;W.ConfigValueTooBigError=vl;W.ConfigValueTooSmallError=Cl;W.EvaluationSuspendedError=Ol;W.ExpectedOneOfValuesError=Il;W.ExpectedValueOfTypeError=K;W.ArraySize=B;W.SimpleRangeValue=w;W.EmptyValue=G;W.FunctionPlugin=V;W.FunctionArgumentType=h;W.FunctionPluginValidationError=Sn;W.InvalidAddressError=El;W.InvalidArgumentsError=Ie;W.LanguageNotRegisteredError=Ra;W.LanguageAlreadyRegisteredError=wl;W.MissingTranslationError=sn;W.NamedExpressionDoesNotExistError=ts;W.NamedExpressionNameIsAlreadyTakenError=Rl;W.NamedExpressionNameIsInvalidError=Tl;W.NoOperationToRedoError=Sl;W.NoOperationToUndoError=Nl;W.NoRelativeAddressesAllowedError=uo;W.NoSheetWithIdError=pe;W.NoSheetWithNameError=gl;W.NotAFormulaError=Gs;W.NothingToPasteError=yl;W.ProtectedFunctionTranslationError=Ml;W.SheetNameAlreadyTakenError=Jn;W.SheetSizeLimitExceededError=kr;W.SourceLocationHasArrayError=dn;W.TargetLocationHasArrayError=ui;W.UnableToParseError=Al;const oN=dt.defaultConfig.language;Pe.registerLanguage(oN,_a);Pe.languages[_a.langCode]=_a;for(const s of Object.getOwnPropertyNames(qu))s.startsWith("_")||Pe.registerFunctionPlugin(qu[s]);qp(lf);Qu();const uN=({hotRef:s,search:e,columns:t,rowData:r,colorData:n,colorTextData:i,afterSelection:a,handleAfterColumnResize:o})=>{const{theme:u}=sa();_e.useEffect(()=>{const E=s.current?.hotInstance;if(!E||!r)return;let N=!1;n&&n.forEach((R,y)=>{R&&R.forEach((S,A)=>{const C=E.getCellMeta(y,A).backgroundColor,I=S||void 0;C!==I&&(E.setCellMeta(y,A,"backgroundColor",I),N=!0)})}),i&&i.forEach((R,y)=>{R&&R.forEach((S,A)=>{const C=E.getCellMeta(y,A).color,I=S||void 0;C!==I&&(E.setCellMeta(y,A,"color",I),N=!0)})}),N&&E.render()},[r,n,i,s]);const l=[],c=_e.useMemo(()=>{const E=[];return t.forEach((N,R)=>{N.select&&l.push({value:R,text:N.title,label:N.title}),E.push({...N,title:N.title})}),E},[t]),d=_e.useMemo(()=>c.map((E,N)=>{const{readOnly:R,...y}=E;let S={...y,theme:u,isFirstColumn:c.indexOf(E)===0,data:N,colorData:n,colorTextData:i};return E.type==="numeric"?S={...S,type:"numeric",numericFormat:{pattern:"0,0"},originalRenderer:H.renderers.NumericRenderer}:E.type==="date"?S={...S,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:lN},originalRenderer:H.renderers.DateRenderer}:E.type==="checkbox"?S={...S,type:"checkbox",className:"htCenter",originalRenderer:H.renderers.CheckboxRenderer}:S.originalRenderer=H.renderers.TextRenderer,{...S,renderer:hN}}),[c,r,u]),f=u==="dark"?"ht-theme-main-dark-auto":"ht-theme-main";return P.jsx("div",{className:"w-full",children:P.jsx(jp,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:s,data:r,themeName:f,rowHeaders:!0,language:"ko-KR",colHeaders:t.map(E=>E.title),autoWrapRow:!0,height:"auto",contextMenu:!0,search:e,observeChanges:!0,columnSorting:!0,afterSelection:a,formulas:{engine:Pe.buildEmpty({licenseKey:"gpl-v3"})},columns:d,manualColumnResize:!0,afterColumnResize:o,colWidths:t.map(E=>E.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})})},hN=(s,e,t,r,n,i,a)=>{a.originalRenderer?a.originalRenderer.apply(void 0,[s,e,t,r,n,i,a]):H.renderers.TextRenderer.apply(void 0,[s,e,t,r,n,i,a]);const o=s.getSettings().search,u=a.theme,l=s.getCellMeta(t,r),c=a.backgroundColor||l.backgroundColor,d=a.color||l.color,f=a.colorData,E=a.colorTextData;e.style.backgroundColor="",e.style.color="",o&&i&&String(i).toLowerCase().includes(o.toLowerCase())?(e.style.backgroundColor=u==="dark"?"#facc15":"yellow",e.style.color="black"):(e.style.backgroundColor=c,c||(t%2===0?e.style.backgroundColor=u==="dark"?"#101010":"#ffffff":e.style.backgroundColor=u==="dark"?"#000000":"#f8f8f8")),d&&(e.style.color=d),f?.[t]?.[r]&&(e.style.backgroundColor=f[t]?.[r]),E?.[t]?.[r]&&(e.style.color=E[t]?.[r])},lN={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(s,e){const t=s.getDate(),r=s.getMonth()+1;return`${s.getFullYear()}-${r.toString().padStart(2,"0")}-${t.toString().padStart(2,"0")}`},parse(s,e){const t=s.split("-");return new Date(t[0],t[1]-1,t[2])}},cN=({ui:s,onInsert:e,onDelete:t,onReload:r,onCsvSave:n,onSaveAll:i})=>{const{t:a}=nh();return s==="tailwind"?P.jsxs("div",{className:"my-2 flex justify-end items-center",children:[P.jsx(hn,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:i,children:a("save")}),P.jsx(hn,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:e,children:a("insert")}),P.jsx(hn,{size:"sm",variant:"outlined",color:"warning",className:"mr-1",onClick:t,children:a("delete")}),P.jsx(hn,{size:"sm",variant:"outlined",color:"brand",className:"ml-1",onClick:n,children:a("csv_save")})]}):P.jsxs("div",{className:"my-2 flex justify-end items-center gap-1",children:[P.jsx(gs,{type:"button",size:"small",variant:"outlined",color:"warning",className:"mr-2",onClick:e,children:a("insert")}),P.jsx(gs,{type:"button",size:"small",variant:"outlined",color:"error",className:"mr-2",onClick:t,children:a("delete")}),P.jsx(gs,{type:"button",size:"small",variant:"outlined",color:"success",className:"mr-2",onClick:r,children:a("reload")}),P.jsx(gs,{type:"button",size:"small",variant:"outlined",color:"success",onClick:n,children:a("csv_save")})]})},yN=({detailData:s})=>{const{user:e}=Qp(),{ui:t}=sa(),{t:r}=nh(),{sheetId:n}=Zp(),i=Jp(),[a,o]=_e.useState([]),u=_e.useRef(null),l=_e.useRef(null),c=_e.useRef(null),[d,f]=_e.useState([]),[E,N]=_e.useState(void 0),[R,y]=_e.useState(void 0),[S,A]=_e.useState(""),[C,I]=_e.useState({isOpen:!1}),[oe,Q]=_e.useState({show:!1,message:""}),[ee,ve]=_e.useState(""),[Te,he]=_e.useState(!1),[q,at]=_e.useState(""),ze=["#FFADAD","#FFD6A5","#FDFFB6","#CAFFBF","#9BF6FF","#A0C4FF","#BDB2FF","#FFC6FF"],gt=["#000000","#D00000","#AE4600","#006400","#00529B","#0018A8","#5A00A8","#A800A8"],Ke=F=>{if(!u.current?.hotInstance||!c.current)return;const{row:X,col:ne,row2:te,col2:Ne}=c.current,Z=Math.min(X,te),le=Math.max(X,te),pr=Math.min(ne,Ne),Et=Math.max(ne,Ne),qe=[...E];let Fn=!1;for(let ot=Z;ot<=le;ot++){qe[ot]||(qe[ot]=Array(a.length).fill(""));for(let Zt=pr;Zt<=Et;Zt++)qe[ot][Zt]!==F&&(qe[ot][Zt]=F,Fn=!0)}Fn&&N(qe)},qt=(F,Y)=>{F.preventDefault();const X=u.current?.hotInstance;if(!X)return;const ne=X.countRows(),te=[...E];let Ne=!1;for(let Z=0;Z<ne;Z++)if(te[Z])for(let le=0;le<te[Z].length;le++)te[Z][le]===Y&&(te[Z][le]=void 0,Ne=!0);Ne&&N(te)},lr=F=>{if(!u.current?.hotInstance||!c.current)return;const{row:X,col:ne,row2:te,col2:Ne}=c.current,Z=Math.min(X,te),le=Math.max(X,te),pr=Math.min(ne,Ne),Et=Math.max(ne,Ne),qe=[...R];let Fn=!1;for(let ot=Z;ot<=le;ot++){qe[ot]||(qe[ot]=Array(a.length).fill(void 0));for(let Zt=pr;Zt<=Et;Zt++)qe[ot][Zt]!==F&&(qe[ot][Zt]=F,Fn=!0)}Fn&&y(qe)},Kr=(F,Y)=>{F.preventDefault();const X=u.current?.hotInstance;if(!X)return;const ne=X.countRows(),te=[...R];let Ne=!1;for(let Z=0;Z<ne;Z++)if(te[Z])for(let le=0;le<te[Z].length;le++)te[Z][le]===Y&&(te[Z][le]=void 0,Ne=!0);Ne&&y(te)},{theme:cr}=sa(),{register:jr,reset:vn,control:ds,setValue:In,getValues:je,formState:{errors:bi}}=ef({mode:"submit "}),{data:dr,isLoading:xi}=tf({queryKey:["sheetData",n,e?.uid],queryFn:async()=>{if(!n||!e)return{rowData:[],colorData:[],colorTextData:[]};const F=`memo_sheet_data/${e?.uid}/${n}/data`,Y=`memo_sheet_data/${e?.uid}/${n}/color`,X=`memo_sheet_data/${e?.uid}/${n}/textColor`,[ne,te,Ne]=await Promise.all([Un(F),Un(Y),Un(X)]),Z=ne?Object.values(ne).map(Et=>typeof Et=="string"?JSON.parse(Et):Et):[],le=te?Object.values(te).map(Et=>JSON.parse(Et)):[],pr=Ne?Object.values(Ne).map(Et=>JSON.parse(Et)):[];return{rowData:Z,colorData:le,colorTextData:pr}},enabled:!!n&&!!e&&a.length>0,staleTime:1e3*60*5});_e.useEffect(()=>{dr&&(f(dr.rowData),N(dr.colorData),y(dr.colorTextData))},[dr]);function Pt(){const F=s?.scrollY?s.scrollY:0;window.scrollTo({top:F})}_e.useEffect(()=>{n&&e&&(Un(`memo_sheet/${e?.uid}/${n}/columns`).then(F=>{o(F||[{title:"title",data:"title",type:"text"}]),jr("filterField1")}),Un(`memo_sheet_data/${e?.uid}/${n}/memo`).then(F=>{ve(F||"")}),Pt())},[n,e]);const wr=async()=>{u.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:`sheet_${n}`,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})};async function On(){const F=u.current?.hotInstance;if(!F)return;let Y;c.current&&c.current.row>=0?(Y=c.current.row+1,F.alter("insert_row_below",c.current.row,1)):(Y=0,F.alter("insert_row_above",0,1)),F.selectCell(Y,0)}const{mutate:Mn}=Ao({mutationFn:async({rowsDB:F,bgColorDataToSave:Y,textColorDataToSave:X})=>{await _n(F,Y,X)},onMutate:async({rowsDB:F,bgColorDataToSave:Y,textColorDataToSave:X})=>{await i.cancelQueries({queryKey:["sheetData",n,e?.uid]});const ne=i.getQueryData(["sheetData",n,e?.uid]),te=F.map(le=>JSON.parse(le)),Ne=Y.map(le=>JSON.parse(le)),Z=X.map(le=>JSON.parse(le));return i.setQueryData(["sheetData",n,e?.uid],le=>({...le,rowData:te,colorData:Ne,colorTextData:Z})),{previousSheetData:ne}},onError:(F,Y,X)=>{X?.previousSheetData&&i.setQueryData(["sheetData",n,e?.uid],X.previousSheetData)},onSuccess:()=>{Q({show:!0,message:r("save_completed")}),setTimeout(()=>Q({show:!1,message:""}),2e3)},onSettled:()=>{i.invalidateQueries({queryKey:["sheetData",n,e?.uid]})}}),qr=async()=>{fr(`memo_sheet_data/${e?.uid}/${n}/memo`,q),ve(q),he(!1)},wn=()=>{at(ee),he(!0)},_n=(F,Y,X)=>{fr(`memo_sheet_data/${e?.uid}/${n}/data`,null),F.map((ne,te)=>{fr(`memo_sheet_data/${e?.uid}/${n}/data/${te}`,ne)}),fr(`memo_sheet_data/${e?.uid}/${n}/color`,Y),fr(`memo_sheet_data/${e?.uid}/${n}/textColor`,X),fr(`memo_sheet/${e?.uid}/${n}/createdAt`,Date.now()),fr(`memo_sheet/${e?.uid}/${n}/count`,F.length)},Qr=async(F=!0)=>{const Y=u.current?.hotInstance;if(!Y)return;const X=Y.getSourceData(),ne=[];X.forEach((Z,le)=>{Z.id=le;const pr=[];a.forEach((Et,qe)=>{pr.push(Z[qe]?Z[qe]:"")}),ne.push(JSON.stringify(pr))}),console.log("rowsDB=",ne);const te=E.map(Z=>JSON.stringify(Z||[])),Ne=R.map(Z=>JSON.stringify(Z||[]));console.log("rowData=",ne),console.log("bgColorDataToSave=",te),console.log("textColorDataToSave=",Ne),Mn({rowsDB:ne,bgColorDataToSave:te,textColorDataToSave:Ne})},ps=(F,Y,X,ne)=>{c.current={row:F,col:Y,row2:X,col2:ne}},fs=async(F,Y,X)=>{Qr(!1);const ne=u.current?.hotInstance;if(!ne)return;const te=a.map((Ne,Z)=>({...Ne,width:ne.getColWidth(Z)}));o(te),fr(`memo_sheet/${e?.uid}/${n}/columns`,te)},{mutate:_r}=Ao({mutationFn:async F=>F,onMutate:async F=>{await i.cancelQueries({queryKey:["sheetData",n,e?.uid]});const Y=i.getQueryData(["sheetData",n,e?.uid]);return i.setQueryData(["sheetData",n,e?.uid],X=>{const ne=[...X.rowData];return ne.splice(F,1),{...X,rowData:ne}}),u.current?.hotInstance.alter("remove_row",F,1),c.current=null,{previousSheetData:Y}},onError:(F,Y,X)=>{i.setQueryData(["sheetData",n,e?.uid],X.previousSheetData)},onSettled:()=>{}}),Ln=()=>{I({isOpen:!1})},De=()=>{u.current.hotInstance;const F=c.current.row;console.log("onDelete=",F),I({isOpen:!1}),_r(F)},Lr=async()=>{if(c.current&&u.current?.hotInstance){const F=r("delete_confirm_title"),Y=r("delete_confirm_message_simple");I({isOpen:!0,title:F,message:Y,color:"warning"})}else Q({show:!0,message:r("select_row_to_delete")}),setTimeout(()=>{Q({show:!1,message:""})},2e3)};if(e===void 0)return P.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:P.jsx(Di,{children:r("login_required")})});const Qt=()=>{const F=l.current.value;A(F);const Y=u.current?.hotInstance;Y&&Y.render()},Pi=F=>{F.key==="Enter"&&(F.preventDefault(),Qt())},So=()=>P.jsxs("div",{className:"pt-5",children:[P.jsx("div",{className:"mb-4 h-14 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),P.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 pb-2 items-end",children:P.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-900 rounded-md animate-shimmer relative overflow-hidden"})}),P.jsxs("div",{className:"mt-2 space-y-1",children:[P.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-900 rounded-t-md animate-shimmer relative overflow-hidden"}),[...Array(5)].map((F,Y)=>P.jsx("div",{className:"h-8 bg-gray-300 dark:bg-zinc-800 rounded animate-shimmer relative overflow-hidden"},Y))]})]});return xi?P.jsx(So,{}):d===void 0||E===void 0||R===void 0?P.jsx(So,{}):P.jsxs("div",{className:"pt-5 relative",children:[P.jsx(rf,{children:oe.show&&P.jsx(nf.div,{initial:{y:"-100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"-100%",opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"fixed top-50 left-1/2 -translate-x-1/2 z-[2000] p-3 rounded-lg shadow-lg bg-green-500 text-white font-semibold",children:oe.message})}),P.jsx(sf,{...C,onConfirm:De,onClose:Ln}),P.jsx("div",{className:"mb-4",children:Te?P.jsxs("div",{className:`${ms.card} p-4`,children:[P.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[P.jsxs("div",{children:[P.jsx(Di,{children:r("input")}),P.jsx("textarea",{className:"w-full h-64 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",value:q,onChange:F=>at(F.target.value),autoFocus:!0})]}),P.jsxs("div",{children:[P.jsx(Di,{children:r("preview")}),P.jsx("div",{className:"prose dark:prose-invert max-w-none p-2 border rounded h-64 overflow-y-auto dark:bg-gray-700 dark:border-gray-600",children:P.jsx(Co,{children:q})})]})]}),P.jsxs("div",{className:"mt-2 flex justify-end gap-2",children:[P.jsx(hn,{variant:"outlined",color:ms.button.indigo,size:"sm",onClick:()=>he(!1),children:r("cancel")}),P.jsx(hn,{color:ms.button.indigo,onClick:qr,children:r("save")})]})]}):P.jsx("div",{className:`${ms.card} p-4 min-h-[4rem] cursor-pointer prose dark:prose-invert max-w-none`,onDoubleClick:wn,children:ee?P.jsx(Co,{children:ee}):P.jsx("p",{className:"text-gray-400",children:r("double_click_to_edit_memo")})})}),P.jsxs("div",{className:"group",children:[P.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 pb-2 items-end",children:[P.jsx("div",{className:"TwInputSearch",children:P.jsx(af,{inputRef:l,onKeyDown:Pi,onSearch:Qt})}),P.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:P.jsxs("div",{className:"flex flex-col items-end",children:[P.jsx(cN,{ui:t,onInsert:On,onDelete:Lr,onCsvSave:wr,onSaveAll:Qr}),P.jsxs("div",{className:"flex items-center justify-end mt-1",children:[ze.map(F=>P.jsx("div",{onClick:()=>Ke(F),onContextMenu:Y=>qt(Y,F),className:"w-5 h-5 cursor-pointer border border-gray-400",style:{backgroundColor:F}},`bg-${F}`)),gt.map((F,Y)=>P.jsx("div",{onClick:()=>lr(F),onContextMenu:X=>Kr(X,F),className:"w-5 h-5 cursor-pointer border border-gray-400 flex items-center justify-center text-xs font-bold",style:{backgroundColor:"#fff",color:F},children:Y%2===0?"가":"A"},`text-${F}`))]})]})})]}),P.jsx(uN,{hotRef:u,search:S,columns:a,rowData:d,colorData:E,colorTextData:R,afterSelection:ps,handleAfterColumnResize:fs})]})]})};export{yN as MemoSheetGrid,yN as default};
