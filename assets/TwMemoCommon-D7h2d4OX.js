const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CmAQUu_o.js","assets/index-EsjifOpZ.js","assets/index-Bsp738v3.css","assets/SinySelect-DwmBJCmU.js","assets/Grid-Dj9cjDaU.js","assets/index-uPdfvAO1.js","assets/TextField-DTXAnxp0.js","assets/InputAdornment-_cKI5tYW.js","assets/Popper-B7qZXjyo.js","assets/Chip-CQDiZXlC.js","assets/index.esm-CyfSyXg0.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-CEZpoYYJ.js","assets/TwButton-czAUWf_m.js"])))=>i.map(i=>d[i]);
import{r as u,j as e,m as U,h as Te,z as M,p as D,D as J,A as Q,S as X,T as Z,E as _,G as De,q as ee,t as Le,v as Ie,w as te,x as se,M as ae,C as re,Q as ne,R as A,n as oe,H as ie,k as Me,V as Ee,W as Re,X as le,Y as Be,Z as _e,$ as F,a0 as R,a1 as ce,a2 as de,a4 as L,N as Fe,cJ as Ye,cL as Ae,d8 as He,a5 as Y,a6 as ze,a7 as Pe,a8 as We,a9 as qe,aa as B,ab as Oe}from"./index-EsjifOpZ.js";import{u as Ve}from"./useSuspenseQuery-D4mZiubr.js";import{T as Ge,u as me,a as ue,F as Ke,b as Ue,D as Je,l as Qe,I as Xe,s as O,d as V,e as Ze}from"./index-CmAQUu_o.js";import{E as et,C as tt}from"./ExpandMore-yhIHGPlf.js";import{F as ge}from"./Favorite-B0q8qtRd.js";import{T}from"./TwButton-czAUWf_m.js";import{D as st}from"./datetime-BDx6lZXm.js";import{u as at}from"./index.esm-CyfSyXg0.js";import"./index-CLQ_oLGC.js";import{S as rt,a as nt}from"./SinySelect-DwmBJCmU.js";import{T as ot,I as it}from"./TextField-DTXAnxp0.js";import{S as lt}from"./check-circle-CWKa5P2N.js";import"./useBaseQuery-BSBzVg_c.js";import"./Grid-Dj9cjDaU.js";import"./index-uPdfvAO1.js";import"./InputAdornment-_cKI5tYW.js";import"./Popper-B7qZXjyo.js";import"./Chip-CQDiZXlC.js";const ct=s=>u.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...s},u.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),dt=s=>u.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),mt=s=>e.jsx(U.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Te,{to:s.to,className:"text-inherit no-underline cursor-pointer",...s,children:e.jsx(Ge,{children:s.children})})});function ut({initTreeData:s}){const[a,i]=u.useState(),t=o=>i(o),d=M();if(u.useEffect(()=>{i(s)},[s]),a==null||a.length===0)return e.jsx(D,{});const l=o=>{console.log("node",o),d(`/m/${o.id}`)};return e.jsx(J,{backend:X,options:Q(),children:e.jsx(Z,{tree:a,rootId:"root",onDrop:t,render:(o,{depth:k,isOpen:c,onToggle:r})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:k*20+(o.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[o.cnt>0&&e.jsx("div",{onClick:r,children:c?e.jsx(et,{}):e.jsx(tt,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>l(o),children:o.text})]}),o.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",o.cnt,")"]})]})})})}function gt(s){const{user:a}=_(),i=M(),[t,d]=u.useState(),[l,o]=u.useState(),k=async c=>{const r=[],n=ee(te(se,`memo_tree/${c}`),Ie("bm"),Le("Y")),g=await ae(n);if(!g.exists()){console.log("getFireText.null");return}const x=g.val();for(let v in x){const h=x[v];h.id=v,h.key=v,h.text=h.title,r.push(h)}r.sort((v,h)=>v.title>h.title?1:-1),d([...r])};return u.useEffect(()=>{a!==void 0&&a!=null&&k(a?.uid)},[a]),u.useEffect(()=>{const c=async(r,n)=>{const g=[...n];if(n)for(const x of n){let v=x;for(;v.parent!=="root";){v.parent,v=await re(`memo_tree/${r}/${v.parent}`);const h={id:v.key,text:v.title,droppable:!1,parent:v.parent};g.filter(y=>y.id===h.id).length===0&&g.push(h)}}for(const x of g){const v=x.id;x.cnt=g.filter(h=>h.parent===v).length}o(g)};t&&t.length>0&&c(a?.uid,t)},[t]),a===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(De,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:t&&t.map((c,r)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{s.onSelected(c.key),i(`/m/${c.key}`)},children:e.jsx("span",{className:"text-base",children:c.title})})},r))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),l===void 0||l===null&&e.jsx(Loading,{}),l&&l.length===0?e.jsx("div",{className:"m-4 text-gray-500",children:"No BookMark"}):e.jsx(ut,{initTreeData:l,uid:a?.uid})]})}const ht=s=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(T,{size:"sm",variant:"outlined",color:"success",onClick:s.onEdit,children:"수정"}),e.jsx(T,{size:"sm",variant:"outlined",color:"warning",onClick:s.onNewMemo,children:"새글"}),e.jsx(T,{size:"sm",variant:"outlined",color:"error",onClick:s.onDelete,children:"삭제"})]}),xt=s=>{const{rootDb:a,isLoading:i,memoDetailData:t}=s,{scrollYProgress:d}=me(),l=ue(d,{stiffness:100,damping:30,restDelta:.001}),[o,k]=u.useState(!1),c=M(),r=u.useRef();r.current=s.searchWord;const{memoId:n}=ne(),x=A()?.state?.fullIndex,{user:v}=_(),h=()=>{const f=`/${a==="memo"?"m":a}/edit/${n}`;c(f,{state:{fullIndex:x}})},w=()=>{const f=`/${a==="memo"?"m":a}/insert/${n}`;c(f,{state:{fullIndex:x}})},y=async()=>{const f=a==="memo"?`${a}_txt/${v.uid}/${n}`:`${a}_txt/${n}`,p=a==="memo"?`${a}_tree/${v.uid}`:a;if(await Ue(f,p)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}s.onTreeUpdate(),c(`/${a==="memo"?"m":a}`)},N=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&y()},b=()=>{s.onBookmark()};return u.useEffect(()=>{t&&t.title!==void 0&&oe({title:t.title,description:t.title});function f(){window.scrollTo({top:0}),t&&t.html!=="N"&&document.querySelectorAll("pre").forEach(p=>{p.innerHTML=Be(p.innerHTML)})}t&&t.memo!==null&&f()},[t]),i?e.jsx(D,{}):n===""||v===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(U.div,{className:"progress-bar",style:{scaleX:l}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:t&&t.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:b,children:t&&t.bookmark==="Y"?e.jsx(ge,{className:"text-red-500"}):e.jsx(Ke,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s.memoDetailData?.path&&s.memoDetailData?.path.map((f,p)=>p===0?f.title:` > ${f.title}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(ht,{rootDb:a,onEdit:h,onNewMemo:w,onDelete:N,bookmark:t&&t.bookmark}),e.jsxs("div",{className:"my-4",children:[t&&t.html==="N"?e.jsx(ie,{postData:t&&t.memo}):t&&t.html!=="N"&&t.memo&&e.jsx(Me,{text:t.memo}),e.jsx(Ee,{imageList:t&&t.image}),!t&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Re,{})})})]})]}),e.jsx(le,{})]})},ft=({onSubmit:s,onCancel:a,isSubmitting:i,newMode:t})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(T,{variant:"outlined",color:"success",disabled:i,onClick:d=>{d.preventDefault(),s(d)},children:[t?"새글":""," 저장"]}),e.jsx(T,{variant:"outlined",color:"error",onClick:a,children:"취소"})]});u.forwardRef((s,a)=>{const{id:i,label:t,defaultValue:d,onChange:l,className:o="",...k}=s,c=r=>{l&&l(r.target.value)};return e.jsxs("div",{className:` ${o}`,children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:i,children:t}),e.jsx("input",{ref:a,type:"date",id:i,defaultValue:d,onChange:c,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...k})]})});const G=({label:s,checked:a,id:i,onChange:t,className:d="",disabled:l=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${l?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:i,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${d}`,checked:a,onChange:o=>t(o.target.checked),disabled:l}),a&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),l&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:s})]}),vt=u.forwardRef((s,a)=>{const{placeholder:i="Enter your message",rows:t=3,value:d="",onChange:l,className:o="",disabled:k=!1,error:c=!1,hint:r=""}=s,n=x=>{l&&l(x.target.value)};let g=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${o} `;return k?g+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":c?g+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":g+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:a,placeholder:i,rows:t,value:d,onChange:n,disabled:k,className:g}),r&&e.jsx("p",{className:`mt-2 text-sm ${c?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:r})]})}),kt=u.lazy(()=>de(()=>import("./index-CmAQUu_o.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));Qe.Quill.register("modules/imageDrop",Xe);ce.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const jt={syntax:{highlight:s=>ce.highlightAuto(s).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},pt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],yt=s=>{const[a,i]=u.useState(s.imageList),[t,d]=u.useState(s.htmlCheck==="Y"),[l,o]=u.useState(s.iconCheck==="Y"),[k,c]=u.useState(s.newMode?"":s.content),r=u.useRef(),n=u.useRef(),g=u.useRef(null);u.useRef(null);const x=u.useRef(null),v=s.newMode,h=u.useRef([]),{height:w}=_e(),y=st.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),N={edTitle:v?"":s.title,edGbn:s.gbn?s.gbn:"etc",edDate:v?y:s.date,content:v?"":s.content,memoTxt:v?"":s.content,htmlCheck:s.htmlCheck,iconCheck:s.iconCheck},{register:b,handleSubmit:f,trigger:p,control:$,setValue:C,getValues:S,watch:he,formState:{errors:H,isSubmitting:xe}}=at({mode:"onChange",defaultValues:N});u.useEffect(()=>{b("edDate"),b("edGbn",{required:!0}),b("htmlCheck"),b("iconCheck"),b("memoTxt")},[]),u.useEffect(()=>{h.current=[],r.current=s.content,n.current=!1},[s.content]);const z=async m=>{v?await s.onNewSubmit(m,h.current):await s.onPostSubmit(m,a,h.current)},fe=()=>{f(z)()},ve=m=>{console.log("onDelete.imageList=",m),i(m)},ke=m=>{let j=r.current;m.ext==="jpg"?j+=`<img src='${m.url}'/>`:m.ext==="mp4"&&(j+=`<video preload="auto" controls="" src='${m.url}'></video>`),r.current=j},je=m=>{r.current=m},pe=m=>{console.log("handleFileUpload",m),h.current=m};function ye(m){r.current=m,C("content",m),p("content")}function be(m,j){console.log("handleChangeDate=",m),console.log("handleChangeDate.currentDateString=",j);let I=F(m);console.log("handleChangeDate.dayjs=",I.format("YYYY-MM-DD HH:mm:ss")),C("edDate",I.format("YYYY-MM-DD")),p("edDate")}const P=(m,j)=>{console.log(`onChecked.${m}=`,j),C(m,j?"Y":"N"),m==="htmlCheck"?d(j):o(j)},we=he("content"),Ne=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Ce=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],$e=m=>{const j=g.current;if(j){const I=j.selectionStart,Se=j.selectionEnd,W=k.slice(0,I),q=k.slice(Se);c(W+m+q),C("memoTxt",W+m+q),setTimeout(()=>{j.selectionStart=j.selectionEnd=I+m.length,j.focus()},0)}},E=m=>{$e(m)};return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:f(z),style:{width:"100%",minHeight:"300px",maxHeight:{height:w},display:"flex",flexDirection:"column"},children:[e.jsx(ft,{onSubmit:m=>fe(),onCancel:s.onCancel,isSubmitting:xe,newMode:v}),e.jsx(Je,{control:$,onDelete:ve,onInsert:ke,setContent:je,onFileUpload:pe,imageList:s.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(ot,{...b("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!H.edTitle})}),e.jsx(rt,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:$,defaultValue:S("edGbn"),selectList:Ne,error:!!H.edGbn,onChange:m=>{m.preventDefault();const j=m.target.value;console.log("edGbn=",S("edGbn")),C("edGbn",j)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(nt,{id:"edDate",label:"일자",value:F(S("edDate")),...b("edDate"),defaultValue:F(S("edDate")),onChange:(m,j)=>{be(m,j)}}),e.jsx(G,{id:"html",checked:t,onChange:m=>P("htmlCheck",m),label:"HTML사용"}),e.jsx(G,{id:"icon",checked:l,onChange:m=>P("iconCheck",m),label:"Icon"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-130 overflow-y-scroll",children:e.jsx(ie,{postData:k})}),e.jsxs("div",{children:[e.jsx(vt,{ref:g,className:"",value:k,onChange:m=>{C("memoTxt",m),c(m)},rows:22}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>E("<box></box>"),children:"<Box>"}),Ce.map((m,j)=>e.jsx(R,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>E("<code>"+m+"</code>"),children:m},j)),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>E('<a href="" target="_blank"></a>'),children:"Link"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>E('<img src=""></img>'),children:"img"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"})]})]}),e.jsx(u.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(kt,{ref:x,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:we,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:jt,formats:pt,onChange:ye})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},K=s=>{const{rootDb:a,isLoading:i,memoDetailData:t}=s,{scrollYProgress:d}=me();ue(d,{stiffness:100,damping:30,restDelta:.001});const l=M(),o=u.useRef(),k=u.useRef();k.current=s.searchWord;const{memoId:c}=ne(),r=A(),{user:n}=_();o.current=r.pathname.split("/")[2]==="insert",console.log("memoDetailData=",t?.title),console.log("newMode=",o.current,", memoId=",c);const g=()=>{const h=`/${a==="memo"?"m":a}/${c==="insert"?"":c}`;l(h)},x=async(h,w)=>{console.log("onNewSubmit.values",h);const y=await O({rootDb:a,uid:n.uid,newData:o.current,key:c==="insert"?"root":c,values:h});if(await V(`${a}_txt`,a,y,w),y!==void 0){const N=`/${a==="memo"?"m":a}/${y}`;l(N,{state:{reflash:!0}})}},v=async(h,w,y)=>{const N=a==="memo"?`${a}_txt/${n.uid}/`:`${a}_txt/`,b=a==="memo"?`${a}_tree/${n.uid}/`:`${a}/`;await Ze(N,b,c,w),console.log("onPostSubmit.values",h);const f=await O({rootDb:a,uid:n.uid,newData:o.current,key:c==="insert"?"root":c,values:h});console.log("onPostSubmit.newKey=",f),console.log("onPostSubmit.files=",y);const p=await V(`${N}/`,a==="memo"?`${a}/${n.uid}/`:`${a}/`,c,y);console.log("onNewSubmit.imageResult",p),a==="memo"&&L(`memo_tree/${n.uid}/${c}/title`,h.edTitle),o.current=!1;const $=`/${a==="memo"?"m":a}/${c}`;l($,{state:{reflash:!0}})};return u.useEffect(()=>{t&&t.title!==void 0&&oe({title:t.title,description:t.title});function h(){document.querySelectorAll("pre").forEach((w,y)=>{})}t&&t.memo!==null&&h()},[t]),c===""||n===void 0?e.jsx(e.Fragment,{}):t===void 0||i?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full p-0 m-0",children:o.current===!1&&t&&(t.title===void 0||t.title===""||t.title===null)?e.jsx(D,{}):e.jsx(yt,{newMode:o.current,onPostSubmit:v,onNewSubmit:x,onCancel:g,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html:"Y",iconCheck:t?.icon?t?.icon:"Y",content:t?.memo,imageList:t?.image})}),e.jsx(le,{})]})};function bt({initTreeData:s,userId:a,onClick:i}){const[t,d]=u.useState(s),{isMoble:l,height:o,width:k}=Fe(),c=(r,n)=>{if(n.dragSource.id!==void 0&&n.dropTargetId!==void 0){const g=`memo_tree/${a}/${n.dragSource.id}/parent`;L(g,n.dropTargetId),console.log("loc=",g)}d(r)};return u.useEffect(()=>{(()=>{for(const n of s){const g=n.id;n.cnt=s.filter(x=>x.parent===g).length}d(s)})()},[s]),t==null||t.length===0?e.jsx(D,{}):e.jsx(J,{backend:X,options:Q(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:o-220-(l?56:0)+(k>1024?60:0),width:"100%"},children:e.jsx(Z,{tree:t,rootId:"root",onDrop:c,render:(r,{depth:n,isOpen:g,onToggle:x,isDragging:v,isDropTarget:h})=>e.jsxs("div",{className:`w-63 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ${v?"opacity-50":""} ${h?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"}`,style:{paddingLeft:n*20+(r.cnt===0?5:0)},children:[e.jsx("div",{className:"min-w-0",children:r.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:x,children:g?e.jsx(ct,{className:"size-6"}):e.jsx(dt,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>i(r),children:[e.jsxs("div",{className:"flex truncate pr-2",children:[r.icon,r.text]}),r.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",r.cnt,")"]})]})]})})})})}const wt=s=>{const a=u.useRef(null);function i(){s.onSearchDataBtn(a.current.value)}function t(){return s.onNewMemoBtn(),!1}function d(l){l.which===13&&i()}return e.jsxs(e.Fragment,{children:[e.jsx(it,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:a,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:d}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(T,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:t,children:"새글"}),e.jsx(T,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:i,children:"조회"})]})]})},Nt=async(s,a,i)=>{let t=new Array;for(let d in i){const l=i[d];try{if(l.key=d,l.url===void 0){const o=await Ye(Ae,`${a}/${d}.${l.ext}`),k=await He(o);l.url=k,L(`${s}/image/${d}/url`,k)}t.push(l)}catch(o){console.log("getImageList.catch",o)}}return t},Ct=async(s,a,i,t)=>{let d="",l="",o={};((r,n,g)=>{l=r==="memo"?`${r}/${n}/${g}`:`${r}/${g}`,d=r==="memo"?`${r}_txt/${n}/${g}`:`${r}_txt/${g}`})(s,a,i);async function c(){if(d===void 0)return"";if(o=await re(d),o===void 0)return console.log("No data available"),"";if(o?.fullIndex,o.image!==void 0&&o.image!==null){const r=await Nt(d,l,o.image);o.image=r,(o.imageOK===void 0||o.imageOK==="N")&&(r&&r.map(n=>{n.ext==="jpg"&&(o.memo=o.memo+`<img src='${n.url}'>`)}),L(`${d}/imageOK`,"Y"),L(`${d}/memo`,o.memo))}if(t!==void 0&&t!==""){const r=t,n=new RegExp(r,"gi"),g=o.memo.replace(n,`<span class='lightext'>${r}</span>`);o.memo=g}}return await c(),o};async function $t(s,a,i=""){if(a==null||a==="")return"";const t=s==="home"?"home_txt":i===""?`${s}_tree/${a}`:`${s}_txt/${a}`,d=ee(te(se,t)),l=await ae(d);if(!l.exists())return console.log("getTreeData.null"),null;if(!l.exists())return console.log("getTreeData.exists"),null;const o=l.val(),k=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],c=[];s==="home"&&c.push(...k);for(const r in o){const n=o[r];n.up===void 0?(n.id=r,n.fullIndex=r):(n.id=n.up,n.fullIndex=n.up);const g={id:r,key:r,text:n.title,title:n.title,droppable:!0,parent:s==="home"?n.gbn:n.parent,icon:n.bm==="Y"?e.jsx(ge,{className:"text-red-500"}):n.icon==="Y"?e.jsx(lt,{}):null};s==="home"||i===""||i===void 0||i===null?c.push(g):(n.id=r,(n.memo+"").toLowerCase().indexOf(i.toLowerCase())>-1&&c.push(g))}return c.sort((r,n)=>r.title>n.title?1:-1),c}const St=u.lazy(async()=>await de(()=>import("./TwMemoMain-CEZpoYYJ.js"),__vite__mapDeps([12,1,2,13]))),Gt=({rootDb:s})=>{const a=M(),{user:i}=_(),t=u.useRef(),d=u.useRef(!0),l=u.useRef(),o=u.useRef(),[k,c]=u.useState(),r=u.useRef(!1),n=A(),g=u.useRef(!1);g.current=n?.state?.reflash===!0;const x=Ve({queryKey:["twTreeData",i?.uid,t.current],queryFn:()=>$t(s,i?.uid,t.current)});x.data!==void 0&&x.data!==""&&!r.current&&(r.current=!0);const v=()=>{const f=k;f&&(f.bookmark=f.bookmark==="Y"?"N":"Y");const p=`memo_tree/${i.uid}/${o.current}/bm`;L(p,k.bookmark),c({...k,bookmark:f.bookmark})};u.useEffect(()=>{i!==void 0&&i!=null&&x.refetch()},[i]),u.useEffect(()=>{const f=async C=>{if(C!==""&&i){const S=await Ct(s,i?.uid,C,t.current);s==="memo"&&(S.path=Tt(x.data,C)),d.current=!1,c(S===void 0?{}:S)}},p=n.pathname.split("/"),$=p.length>2?p[p.length-1]:"";d.current=!0,f($),o.current=$},[n.pathname,i]),u.useEffect(()=>{i!==void 0&&i!=null&&x.refetch()},[g.current]);const h=f=>{r.current=!1,f!==void 0&&(t.current=f),x.refetch()},w=f=>{f.id!==o.current&&(d.current=!0,console.log("node",f),a(`/${s==="memo"?"m":s}/${f.id}`))},y=()=>{if(i==null){alert("로그인 후 이용 가능합니다.");return}const f=`/${s==="memo"?"m":s}/insert/insert`;a(f)},N=f=>{},b=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3",children:e.jsx(mt,{to:"/m",children:s==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[s==="memo"?"":e.jsx(Y,{to:"/m",children:"메모"}),e.jsx(Y,{to:"/todo",children:"TODO"}),e.jsx(Y,{to:"/tw",children:"Sheet"})]}),e.jsx(wt,{onNewMemoBtn:y,onSearchDataBtn:h}),r.current&&x.isFetched?e.jsx(bt,{expandIndex:l.current,initTreeData:x.data,userId:i?.uid,onClick:w}):i===void 0?e.jsx(e.Fragment,{}):e.jsx(D,{})]});return i&&i.uid===ze&&Pe,e.jsxs(We,{sideType:"memo",title:s==="memo"?"메모장":"홈페이지관리",sideContents:b,children:[e.jsx(u.Suspense,{fallback:e.jsx(D,{}),children:e.jsxs(qe,{children:[e.jsx(B,{path:"/edit/:memoId",element:e.jsx(K,{rootDb:s,isLoading:d.current,searchWord:t.current,memoDetailData:k})}),e.jsx(B,{path:"/insert/:memoId",element:e.jsx(K,{rootDb:s,isLoading:d.current,searchWord:t.current,memoDetailData:k})}),e.jsx(B,{path:"/:memoId",element:e.jsx(xt,{rootDb:s,isLoading:d.current,searchWord:t.current,memoDetailData:k,onTreeUpdate:h,onBookmark:v,data:x.data})}),e.jsx(B,{path:"*",element:e.jsx(St,{searchWord:t.current,data:x.data,onNewMemoBtn:y,title:s==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),s==="memo"?e.jsx(gt,{onSelected:N}):"",e.jsx(Oe,{})]})},Tt=(s,a)=>{let i=[],t=a;if(!s)return i;const d=s.find(l=>l.id===t);for(i.unshift(d),t=d?.parent;t!=null&&t!==""&&t!=="root";){const l=s.find(o=>o.id===t);t=l?.parent,i.unshift(l)}return i};export{Gt as default};
