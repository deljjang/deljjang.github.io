import{j as s,m as J,r as h,P as Q,cO as H,q as X,o as ee,n as m,am as te,O as y,t as f,Y as ne,Z as se,A as oe}from"./index-BOYjaTAS.js";import{I as le,T as W}from"./InputField-DWpFohNb.js";import{H as re,r as ae}from"./registry-D33qfS_-.js";import{D as ie}from"./datetime-BDx6lZXm.js";import{a as ce}from"./index.esm-BZG3trFU.js";import{S as ue}from"./Select-CoT3KBnA.js";import{n as de}from"./handson-DdAkNqUh.js";function C({size:n,color:r,variant:v,children:a,className:g,...w}){const D={sm:"px-2 py-1 text-sm min-w-18 min-h-8",md:"px-4 py-2 min-w-20 min-h-8",lg:"px-6 py-3 text-lg min-w-25"},b=v=="outlined"?`border rounded-${n} 
      border-${r}-500 text-${r}-500
      border-1
      hover:border-2 border-${r}-200`:`bg-${r}-500 
      text-white dark:text-black`;return s.jsx(J.div,{whileHover:{scale:1},whileTap:{scale:.9},children:s.jsx("button",{className:`
          ${b}
          ${D[n]}
          focus:outline-none
          transition-colors duration-200
          ${g}
          `,...w,children:a})})}const me=n=>s.jsxs("div",{className:"my-2 flex justify-end items-center",sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[s.jsx(C,{size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:n.onInsert,children:"추가"}),s.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"error",className:"mr-2",onClick:n.onDelete,children:"삭제"}),s.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"success",className:"mr-2",onClick:n.onReload,children:"리로드"}),s.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"blue",onClick:n.onCsvSave,children:"csv저장"})]});ae();const fe=n=>{const{userId:r,baseUrl:v}=n,a=h.useRef(null),g=h.useRef(null),[w,D]=h.useState(),[b,p]=h.useState(0),{height:$}=Q(),{settings:F,changeColWidths:z}=H(),O={edTitle:"",edDate:ie.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd")},{register:U,reset:he,control:R,setValue:S,getValues:I,formState:{errors:V}}=ce({mode:"submit ",defaultValues:O}),{theme:B}=H(),K=B==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",_=async e=>{console.log("onFunPost.data=",e.id,e);const t=`${v}/${r}/`;if(e.id===void 0){const o=ne(se(m(f),t)).key;console.log("onFunPost.newKey",o),e.id=o}return y(m(f,t+e.id+"/dv"),e.dv),y(m(f,t+e.id+"/title"),e.title),y(m(f,t+e.id+"/t1"),e.t1),y(m(f,t+e.id+"/t2"),e.t2),y(m(f,t+e.id+"/ing"),"1"),e},A=async()=>{const e=`${v}/${r}/`,t=X(m(f,e),ee("dv"));te(t,o=>{if(!o.exists())return;const i=o.val(),c=[];for(let u in i){const l=i[u];l.id=u,l.sort=`${l.dv}_${l.title}`,c.push(l)}c.sort((u,l)=>u.sort>l.sort?1:-1),D(c),p(c.length)})};h.useEffect(()=>{S("columns1",n.selectDefault)},[]),h.useEffect(()=>{r!==void 0&&A()},[r]),h.useEffect(()=>{a.current.hotInstance.addHook("afterColumnResize",function(t,o){const i=F.colWidths;i[o]=t,z(i)})},[a.current]);const M=async()=>{E()},L=async()=>{a.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:n.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},k=[],P={indicators:!0},N=[];n.columns.map((e,t)=>{e.select&&k.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&N.push(t)}),P.columns=N;const E=()=>{try{const e=a.current?.hotInstance,t=e?.getPlugin("filters");if(t){const o=I("columns1");console.log("onKeyUp.columns1=",o,"text=",I("filterField1")),n.columns.forEach((u,l)=>{t?.removeConditions(l)}),t?.addCondition(Number(o),"contains",[I("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",a.current);const c=e.getData().length;p(c)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function q(){const e=a.current.hotInstance;console.log("onInsert:",e),e.alter("insert_row_above",0,1)}const G=async(e,t)=>{if(console.log("afterChange.change=",e,", source=",t,", change.length=",e?.length),e!==null){const o=a.current?.hotInstance;if(o?.getPlugin("filters")){const c=o.getData(),u=[];e.forEach((l,j)=>{const x={};console.log("afterChange.index1=",j,", item1=",l[0]),n.columns.forEach((d,Y)=>{console.log("afterChange.filteredData=",c[l[0]],d),x[d.data]=c[l[0]][Y]}),console.log("afterChange.tmp=",x),u.push(x)}),console.log("afterChange.saveData=",u),u.forEach(async(l,j)=>{console.log("afterChange.item=",l);const x=await _(l);console.log("afterChange.result=",j,", result=",x),w.map(d=>{(d.id===void 0||d.id===null)&&(console.log("afterChange.rowData1=",d),d.id=x?.id,console.log("afterChange.rowData2=",d))})}),o.render()}}},Z=async()=>{const e=a.current.hotInstance;if(console.log("onDelete:",e),e&&g.current!==null){if(e?.getPlugin("filters")){const o=e.getData();console.log("onDelete.filteredData=",o[g.current]);const i=o[g.current][n.keyId];console.log("onDelete.deleteId=",i),window.confirm("삭제하시겠습니까?")&&y(m(f,`${n.baseUrl}/${r}/${i}`),null)}e.alter("remove_row",g.current,1)}},T=e=>{const t=e.target.value;console.log("onChange.target=",e.target.value),S(e.target.name,t)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[s.jsx(ue,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:R,className:"dark:bg-dark-900",defaultValue:n.selectDefault?n.selectDefault:"1",options:k,error:!!V.columns1,onChange:T}),s.jsx(le,{...U("filterField1"),name:"filterField1",control:R,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",onKeyUp:E,onChange:T})]}),s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[s.jsx(W,{textAlign:"left",children:"건수 : "+de(b)}),s.jsx(me,{onInsert:q,onDelete:Z,onReload:M,onCsvSave:L})]}),s.jsx("div",{style:{maxHeight:`${$}- 200`,overflow:"auto"},children:s.jsx(re,{ref:a,data:w,themeName:K,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:$-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:G,afterSelection:e=>{g.current=e},licenseKey:"non-commercial-and-evaluation",columns:n.columns,cells:(e,t)=>n.columns[t].readOnly===!0?{readOnly:!0}:{},colWidths:F.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:P})})]})};function Ie(){const{user:n}=oe(),r=[{title:"구분",data:"dv",readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"설명1",type:"text",data:"t1",select:!0},{title:"설명2",type:"text",data:"t2",select:!0},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"진행중",type:"text",data:"ing",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];return n===void 0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:s.jsx(W,{children:"로그인을 해야 이용 가능합니다."})}):s.jsx(fe,{csvFileName:"exported_sheet",baseUrl:"sheet",columns:r,selectDefault:"1",keyId:r.length-1,userId:n?.uid})}export{Ie as default};
