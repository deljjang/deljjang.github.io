import{a8 as ee,j as e,a4 as he,a5 as te,B as M,bX as O,b as i,q as xe,o as pe,r as A,f as N,a as De,a6 as H,l as Z,cZ as je,D as X,p as oe,c as ne,$ as ye,C as se,cG as q,n as be,d as le,m as Ce,k as ve}from"./index-CJrggStm.js";import{d as J}from"./MuiCard-BZkCKFdP.js";import{T as we,a as Te}from"./Tabs-DJMFT8Jt.js";import{D as Ie,S as Se,a as ke}from"./SinySelect-CC0zCXwd.js";import{D as ae}from"./datetime-BDx6lZXm.js";import{u as re,C as Fe}from"./index.esm-5hWjpj7j.js";import{A as R}from"./AniButton-BU8UzGDR.js";import{S as _}from"./SinyItem-bNaCEz6k.js";import{G as C}from"./Grid-Bh89rGOr.js";import{T as G}from"./TextField-DtQA9E8_.js";import{H as Be,r as Le}from"./registry-ByHoBBPi.js";/* empty css                */import{u as Me}from"./useWindowDimensions-DrhsGLu1.js";import{g as Re,o as Ee,t as $e,a as Q}from"./Todo-0L_fwRDP.js";import"./Card-B3ldzxIn.js";import"./CardContent-DQmG00tl.js";import"./KeyboardArrowRight-DFPg8uzf.js";import"./index-BCqxH397.js";import"./InputAdornment-DvmcGe2-.js";import"./Popper-Byllt1AY.js";import"./Button-Cf3dF736.js";import"./Chip-BINJJOUf.js";import"./TwLabel-D1unnW49.js";import"./TwDatePicker-DLJKy47H.js";import"./TwSelect-Dk8h0QAx.js";const We=ee(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),ze=ee(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),Pe=te(M)(({theme:t})=>({backgroundColor:t.palette.mode==="dark"?O.dark.backgroundColor:O.light.backgroundColor,borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",alignContent:"center",justifyContent:"center",overflowX:"auto"}));function Ue({tabValue:t,onChange:s,tabs:c}){const a=he(),r=te(we)({"&.Mui-selected":{color:a.palette.text}});return e.jsx(Pe,{index:t,style:{width:"100%"},children:e.jsx(Te,{value:t,onChange:s,variant:"scrollable",scrollButtons:!1,allowScrollButtonsMobile:!0,"aria-label":"secondary tabs example",children:c.map(d=>e.jsx(r,{label:d.label},d.id))})})}const Ye=t=>{const[s,c]=i.useState(t),[a,r]=i.useState([]),[d,h]=i.useState(),x=i.useCallback(v=>{const w=xe(A(N,v),pe("title"));De(w,k=>{if(!k.exists())return;const f=k.val(),y=[];for(let D in f){const u=f[D];u.id=D,u.sort=`${u.ing}_${u.date}_${u.title}`,(d===""||d===void 0||(u.memo+"").toLowerCase().indexOf(d.toLowerCase())>-1)&&y.push(u)}const E=y.sort((D,u)=>D.sort>u.sort?1:-1).filter(D=>D.ing==="1"),p=y.sort((D,u)=>D.sort>u.sort?-1:1).filter(D=>D.ing==="2");r([...E,...p])})},[d]);return i.useEffect(()=>{s!==""&&x(s)},[x,s,d]),[a,c,h]},He=t=>{const{userId:s}=t,[c,a]=Ye("");console.log("TodoDetail.todoList=",c);const r=ae.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),d={edTitle:"",edDate:r},{register:h,handleSubmit:x,reset:v,getValues:w,setFocus:k,formState:{errors:f,isSubmitting:y,submitCount:E}}=re({mode:"submit ",defaultValues:d}),p=i.useRef();i.useEffect(()=>{h("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:3,message:"3글자 이상 입력해주세요."}}),h("edDate",{required:!0,minLength:10})}),i.useEffect(()=>{s!==void 0&&a(`todo/${s}`)},[s]);async function D(n){console.log("onInputBtn.errors=",f),console.log("onInputBtn.isSubmitting=",y),console.log("onInputBtn.edDate=",w("edDate")),console.log("onInputBtn.edTitle=",w("edTitle")),console.log("onInputBtn.submitCount=",E),n.preventDefault(),x(U)()}const u=()=>{t.handleGoogleLogin()};if(s===void 0)return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:[e.jsx(_,{children:"로그인을 해야 이용가능합니다."}),e.jsx(R,{type:"button",size:"small",variant:"outlined",color:"success",sx:{mt:30},onClick:u,children:"로그인"})]});const $=(n,m)=>{n.preventDefault(),console.log("onEdit.item=",m),k("edTitle"),v({edTitle:m.title,edDate:m.date}),p.current=m.id,console.log("onEdit.todoId=",p.current)},P=n=>{n.preventDefault(),console.log("onCancel.item="),v({edTitle:""}),p.current=void 0},W=(n,m)=>{n.preventDefault(),window.confirm("삭제하시겠습니까?")&&setFireData(`todo/${s}/${m.id}`,null)},F=(n,m)=>{n.preventDefault(),window.confirm("완료하시겠습니까?")&&setFireData(`todo/${s}/${m.id}/ing`,"2")},K=n=>console.error(n);function U(n,m){console.log("onSubmit.data=",n),console.log("onSubmit.e=",m),console.log("onSubmit.todoId=",p.current),console.log("onSubmit.errors=",f);const g=`todo/${s}/`;if(p.current===void 0){const b=oe(ne(A(N),g)).key;console.log("onSubmit.newKey",b),p.current=b}setFireData(g+p.current+"/title",n.edTitle),setFireData(g+p.current+"/date",n.edDate),setFireData(g+p.current+"/ing","1"),p.current=void 0,v({edTitle:"",edDate:r})}return e.jsxs(e.Fragment,{children:[e.jsxs(M,{sx:{width:"100%",flexGrow:1,m:2},children:[e.jsx("div",{id:"back-to-top-anchor"}),e.jsx("form",{onSubmit:x(U,K),children:e.jsxs(C,{container:!0,spacing:2,columns:{xs:12,md:12},children:[e.jsx(C,{item:!0,xs:12,children:e.jsx(G,{type:"date",style:{paddingTop:"2px"},fullWidth:!0,placeholder:"일자",...h("edDate"),variant:"standard"})}),e.jsx(C,{item:!0,xs:9,sm:10,children:e.jsxs(M,{sx:{display:"flex",alignItems:"normal",justifyContent:"center"},children:[e.jsx(G,{fullWidth:!0,style:{paddingTop:"2px"},placeholder:"Todo Input",...h("edTitle"),variant:"standard",error:!!f.edTitle}),e.jsx(H,{style:{marginTop:"-4px"},"aria-label":"bookmark",onClick:n=>P(n),children:e.jsx(We,{sx:{color:"action.active"}})})]})}),e.jsx(C,{item:!0,xs:3,sm:2,children:e.jsx(R,{variant:"outlined",fullWidth:!0,onClick:n=>D(n),color:"success",size:"small",disabled:y,children:"입력"})}),e.jsx(C,{item:!0,xs:12,sm:12,children:f?.edTitle?e.jsx("p",{className:"error",children:f.edTitle?.message}):null})]})}),c?.map((n,m)=>e.jsxs("div",{children:[e.jsxs(M,{sx:{display:"plex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(Z,{component:"div",variant:"body2",color:"text.prime",children:n.date}),e.jsxs(M,{sx:{display:"plex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[n.ing==="1"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{"aria-label":"완료",onClick:g=>F(g,n),children:e.jsx(ze,{})}),e.jsx(H,{"aria-label":"edit",onClick:g=>$(g,n),children:e.jsx(je,{})})]}),e.jsx(H,{"aria-label":"delete",onClick:g=>W(g,n),children:e.jsx(Ie,{sx:{color:"rgba(120, 0, 0, 3)"}})})]})]}),e.jsx(Z,{component:"div",variant:"body",color:"text.prime",children:n.title}),e.jsx(X,{})]},m))]}),e.jsx(X,{})]})},Ge=t=>e.jsxs(M,{sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[e.jsx(R,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:t.onInsert,children:"입력"}),e.jsx(R,{type:"button",size:"small",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"}),e.jsx(R,{type:"button",size:"small",variant:"outlined",color:"success",onClick:t.onReload,children:"리로드"}),e.jsx(R,{type:"button",size:"small",variant:"outlined",onClick:t.onCsvSave,children:"csv저장"})]}),Ke=({name:t,label:s,control:c,defaultValue:a,placeholder:r,variant:d="filled",margin:h="none",size:x="small",xsSize:v=12,mdSize:w=6,onKeyUp:k})=>e.jsx(C,{item:!0,xs:v,md:w,children:e.jsx(Fe,{control:c,name:t,defaultValue:a,render:({field:f})=>e.jsx(G,{label:s,placeholder:r,value:f.value,inputRef:f.ref,onChange:y=>{f.onChange(y)},size:x,defaultValue:a,variant:d,margin:h,fullWidth:!0,onKeyUp:k,...f})})});Le();const Ve=t=>{const{userId:s,baseUrl:c}=t,a=i.useRef(null),r=i.useRef(null),[d,h]=i.useState(),[x,v]=i.useState(0),{height:w}=Me(),f=ye().palette.mode==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",y=ae.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),E={edTitle:"",edDate:y};i.useEffect(()=>{F("edDate",{required:!0,minLength:10}),F("filterField1"),g("columns1",t.selectDefault)},[]),i.useEffect(()=>{(async()=>{if(s!==void 0){const l=await Re(c,s);v(l?.length),h(l)}})()},[s]);const p=async()=>{W()},D=async()=>{a.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:t.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},u=[],$={indicators:!0},P=[];t.columns.map((o,l)=>{o.select&&u.push({value:l,text:o.title}),o.hidden===!0&&P.push(l)}),$.columns=P;const W=()=>{try{const o=a.current?.hotInstance,l=o?.getPlugin("filters");if(l){const j=b("columns1");console.log("onKeyUp.columns1=",j,"text=",b("filterField1")),t.columns.forEach((Y,I)=>{l?.removeConditions(I)}),l?.addCondition(Number(j),"contains",[b("filterField1")]),l?.filter(),o?.render(),console.log("filtersPlugin=",l),console.log("hotRef=",a.current);const z=o.getData().length;v(z)}}catch(o){console.error("Error:",o),console.error("Error:",o.message)}},{register:F,handleSubmit:K,trigger:U,reset:n,control:m,setValue:g,getValues:b,formState:{errors:B}}=re({mode:"submit ",defaultValues:E});async function ie(){console.log("onInputBtn.errors=",B),console.log("onInputBtn.edDate=",b("edDate")),console.log("onInputBtn.edTitle=",b("edTitle")),K(ce)()}function ce(o,l){console.log("onSubmit.data=",o),console.log("onSubmit.e=",l),console.log("onSubmit.errors=",B);const j=`${t.baseUrl}/${s}/`,T=oe(ne(A(N),j)).key;console.log("onSubmit.newKey",o.newKey),setFireData(j+T+"/title",o.edTitle),setFireData(j+T+"/date",o.edDate),setFireData(j+T+"/ing","1"),n({edTitle:"",edDate:y})}const de=async(o,l)=>{if(console.log("afterChange.change=",o,", source=",l),console.log("afterChange.change.length=",o?.length),o!==null){const j=a.current?.hotInstance;if(j?.getPlugin("filters")){const z=j.getData(),Y=[];o.forEach((I,V)=>{const L={};console.log("afterChange.index1=",V,", item1=",I[0]),t.columns.forEach((S,fe)=>{console.log("afterChange.filteredData=",z[I[0]],S),L[S.data]=z[I[0]][fe]}),console.log("afterChange.tmp=",L),Y.push(L)}),console.log("afterChange.saveData=",Y),Y.forEach(async(I,V)=>{console.log("afterChange.item=",I);const L=await Ee(I,c,s);console.log("afterChange.result=",V,", result=",L),d.map(S=>{(S.id===void 0||S.id===null)&&(console.log("afterChange.rowData1=",S),S.id=L?.id,console.log("afterChange.rowData2=",S))})}),j.render()}}},ue=async()=>{const o=a.current.hotInstance;if(console.log("onDelete:",o),o&&r.current!==null){if(o?.getPlugin("filters")){const j=o.getData();console.log("onDelete.filteredData=",j[r.current]);const T=j[r.current][t.keyId];console.log("onDelete.deleteId=",T),window.confirm("삭제하시겠습니까?")&&setFireData(`${t.baseUrl}/${s}/${T}`,null)}o.alter("remove_row",r.current,1)}};function me(o){console.log("handleChangeDate=",o);let l=q(o);l.format("YYYY-MM-DD HH:mm:ss"),console.log("handleChangeDate.dayjs=",l.format("YYYY-MM-DD HH:mm:ss")),g("edDate",l.format("YYYY-MM-DD")),U("edDate")}const ge=B?.edTitle?e.jsx(C,{item:!0,xs:12,children:e.jsx("p",{className:"error",children:B.edTitle?.message})}):"";return e.jsxs(se,{style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},sx:{mt:0},children:[e.jsxs(C,{container:!0,spacing:3,children:[e.jsx(Se,{id:"columns1",label:"조회 컬럼",mdSize:3,control:m,defaultValue:t.selectDefault?t.selectDefault:"1",selectList:u,error:!!B.columns1,onChange:o=>{o.preventDefault();const l=o.target.value;console.log("columns1=",b("columns1")),g("columns1",l),l!=""&&W()}}),e.jsx(Ke,{...F("filterField1"),name:"filterField1",control:m,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",size:"small",mdSize:9,fullWidth:!0,onKeyUp:W}),e.jsx(ke,{control:m,id:"edDate",label:"일자",mdSize:3,value:q(b("edDate")),...F("edDate"),defaultValue:q(b("edDate")),onChange:me}),e.jsx(C,{item:!0,xs:12,md:9,children:e.jsx(G,{...F("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목 입력",variant:"filled",size:"small",style:{},error:!!B.edTitle})}),ge,e.jsx(C,{item:!0,xs:12,md:3,sx:{paddingTop:["0 !important","0 !important","0.5rem !important"]},children:e.jsx(_,{textAlign:"left",children:"건수 : "+be(x)})}),e.jsx(C,{item:!0,xs:12,md:9,sx:{paddingTop:["0 !important","0 !important","0.5rem !important"]},children:e.jsx(Ge,{onInsert:ie,onDelete:ue,onReload:p,onCsvSave:D})})]}),e.jsx("div",{style:{maxHeight:`${w}- 200`,overflow:"auto"},children:e.jsx(Be,{ref:a,data:d,themeName:f,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:w-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:de,afterSelection:o=>{r.current=o},licenseKey:"non-commercial-and-evaluation",columns:t.columns,cells:(o,l)=>t.columns[l].readOnly===!0?{readOnly:!0}:{},colWidths:t.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:$})})]})},qe=()=>{const{user:t}=le();return!t||t?.uid===void 0?e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:e.jsx(_,{children:"로그인을 해야 이용가능합니다."})}):e.jsx(Ve,{csvFileName:"exported_todo",baseUrl:"todo",columns:Q,colWidths:$e,selectDefault:"1",keyId:Q.length-1,userId:t?.uid})},pt=()=>{const{user:t,handleGoogleLogin:s}=le(),[c,a]=i.useState(0),r=[{label:"그리도",id:"grid"},{label:"리스트",id:"list"}];i.useEffect(()=>{Ce({title:"Todo",description:""})},[]),i.useEffect(()=>{const h=r.findIndex(x=>`#${x.id}`===window.location.hash);a(h!==-1?h:c)},[c]);const d=(h,x)=>{window.location.hash=`#${r[x].id}`,a(x)};return e.jsxs(se,{maxWidth:"lg",sx:{mt:3},children:[e.jsx(Ue,{tabValue:c,onChange:d,tabs:r}),e.jsxs(i.Suspense,{fallback:e.jsx(ve,{}),children:[e.jsx(J,{value:c,index:0,style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},children:e.jsx(qe,{userId:t?.uid||!1,handleGoogleLogin:s})}),e.jsx(J,{value:c,index:1,style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},children:e.jsx(He,{userId:t?.uid,handleGoogleLogin:s})})]})]})};export{pt as MUITodo,pt as default};
