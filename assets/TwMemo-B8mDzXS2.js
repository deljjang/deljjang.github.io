const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CKyZ6MXZ.js","assets/index-C3KeXev-.js","assets/index-DLU66RPy.css","assets/SinySelect-DrhNr-bB.js","assets/index-B6GEtO3p.js","assets/TextField-BAxoZfjr.js","assets/InputAdornment-iKyNh3cL.js","assets/Popper-CmK0KAzR.js","assets/Chip-CvwEf2Xp.js","assets/index.esm-ByE5HQf6.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-C3wIsPER.js","assets/TwButton-BzJq9qVi.js"])))=>i.map(i=>d[i]);
import{r as g,j as e,p as De,u as I,L as D,D as G,g as U,S as J,T as Q,P as M,t as X,v as W,d as Y,w as Z,x as ee,H as te,y as Se,z as Le,C as Me,E as se,F as Ie,G as Re,J as P,K as B,N as re,_ as ae,i as Ee,q as ne,e as _e,o as Be,a as oe,f as ie,m as le,c as ce,a1 as Fe,a2 as Ye,a3 as Pe,n as q,a4 as He,Q as We,R as H,U as Ae,V as Oe,W as qe,X as F,Y as ze,$ as Ke}from"./index-C3KeXev-.js";import{T as C}from"./TwButton-BzJq9qVi.js";import{I as Ve,T as Ge}from"./TextField-BAxoZfjr.js";import{E as de,C as me}from"./ExpandMore-DEj59Ggp.js";import{T as Ue}from"./TwLayout-24P5ELVJ.js";import{F as Je}from"./Favorite-3Elct4Lm.js";import{u as ue,a as ge,F as Qe,b as Xe,D as Ze,l as et,I as tt,s as z,d as K,e as st,T as rt}from"./index-CKyZ6MXZ.js";import{D as at}from"./datetime-BDx6lZXm.js";import{u as nt}from"./index.esm-ByE5HQf6.js";import"./index-CLQ_oLGC.js";import{S as ot,a as it}from"./SinySelect-DrhNr-bB.js";import"./chevron-down-BE0cn-Mf.js";import"./index-B6GEtO3p.js";import"./InputAdornment-iKyNh3cL.js";import"./Popper-CmK0KAzR.js";import"./Chip-CvwEf2Xp.js";const lt=s=>{const r=g.useRef(null);function i(){s.onSearchDataBtn(r.current.value)}function t(){return s.onNewMemoBtn(),!1}function m(n){n.which===13&&i()}return e.jsxs(e.Fragment,{children:[e.jsx(Ve,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:r,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:m}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(C,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:t,children:"새글"}),e.jsx(C,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:i,children:"조회"})]})]})};function ct({initTreeData:s,userId:r}){const[i,t]=g.useState(s),{isMoble:m,height:n,width:o}=De(),f=(a,c)=>{if(c.dragSource.id!==void 0&&c.dropTargetId!==void 0){const x=`memo_tree/${r}/${c.dragSource.id}/parent`;M(x,c.dropTargetId),console.log("loc=",x)}t(a)},d=I();if(g.useEffect(()=>{(async()=>{const c=[];if(s)for(const x of s){const h={id:x.key,text:x.title,droppable:!0,parent:x.parent};c.push(h)}for(const x of c){const h=x.id;x.cnt=c.filter(v=>v.parent===h).length}t(c)})()},[s]),i==null||i.length===0)return e.jsx(D,{});const l=a=>{console.log("node",a),d(`/m/${a.id}`)};return e.jsx(G,{backend:J,options:U(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:n-220-(m?56:0)+(o>1024?60:0),width:"100%"},children:e.jsx(Q,{tree:i,rootId:"root",onDrop:f,render:(a,{depth:c,isOpen:x,onToggle:h,isDragging:v,isDropTarget:y})=>e.jsxs("div",{className:`w-63 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ${v?"opacity-50":""} ${y?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"}`,style:{paddingLeft:c*20+(a.cnt===0?5:0)},children:[e.jsx("div",{className:"min-w-0",children:a.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:h,children:x?e.jsx(de,{}):e.jsx(me,{})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>l(a),children:[e.jsx("div",{className:"truncate pr-2",children:a.text}),a.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",a.cnt,")"]})]})]})})})})}const dt=s=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(C,{size:"sm",variant:"outlined",color:"success",onClick:s.onEdit,children:"수정"}),e.jsx(C,{size:"sm",variant:"outlined",color:"warning",onClick:s.onNewMemo,children:"새글"}),e.jsx(C,{size:"sm",variant:"outlined",color:"error",onClick:s.onDelete,children:"삭제"})]}),mt=s=>{const{rootDb:r,isLoading:i,memoDetailData:t}=s,{scrollYProgress:m}=ue(),n=ge(m,{stiffness:100,damping:30,restDelta:.001}),[o,f]=g.useState(!1),d=I(),l=g.useRef();l.current=s.searchWord;const{memoId:a}=X(),x=W()?.state?.fullIndex,{user:h}=Y(),v=()=>{const j=`/${r==="memo"?"m":r}/edit/${a}`;d(j,{state:{fullIndex:x}})},y=()=>{const j=`/${r==="memo"?"m":r}/insert/${a}`;d(j,{state:{fullIndex:x}})},k=async()=>{const j=r==="memo"?`${r}_txt/${h.uid}/${a}`:`${r}_txt/${a}`,p=r==="memo"?`${r}_tree/${h.uid}`:r;if(await Xe(j,p)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}s.onTreeUpdate(),d(`/${r==="memo"?"m":r}`)},w=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&k()},T=()=>{s.onBookmark()};return g.useEffect(()=>{t&&t.title!==void 0&&Z({title:t.title,description:t.title});function j(){window.scrollTo({top:0}),t&&t.html!=="N"&&document.querySelectorAll("pre").forEach(p=>{p.innerHTML=Ie(p.innerHTML)})}t&&t.memo!==null&&j()},[t]),i?e.jsx(D,{}):a===""||h===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(ee.div,{className:"progress-bar",style:{scaleX:n}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:t&&t.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:T,children:t&&t.bookmark==="Y"?e.jsx(Je,{className:"text-red-500"}):e.jsx(Qe,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s.pathNm})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(dt,{rootDb:r,onEdit:v,onNewMemo:y,onDelete:w,bookmark:t&&t.bookmark}),e.jsxs("div",{className:"my-4",children:[t&&t.html==="N"?e.jsx(te,{postData:t&&t.memo}):t&&t.html!=="N"&&t.memo&&e.jsx(Se,{text:t.memo}),e.jsx(Le,{imageList:t&&t.image}),!t&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Me,{})})})]})]}),e.jsx(se,{})]})},ut=({onSubmit:s,onCancel:r,isSubmitting:i,newMode:t})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(C,{variant:"outlined",color:"success",disabled:i,onClick:m=>{m.preventDefault(),s(m)},children:[t?"새글":""," 저장"]}),e.jsx(C,{variant:"outlined",color:"error",onClick:r,children:"취소"})]});g.forwardRef((s,r)=>{const{id:i,label:t,defaultValue:m,onChange:n,className:o="",...f}=s,d=l=>{n&&n(l.target.value)};return e.jsxs("div",{className:` ${o}`,children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:i,children:t}),e.jsx("input",{ref:r,type:"date",id:i,defaultValue:m,onChange:d,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...f})]})});const gt=({label:s,checked:r,id:i,onChange:t,className:m="",disabled:n=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${n?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:i,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${m}`,checked:r,onChange:o=>t(o.target.checked),disabled:n}),r&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),n&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:s})]}),ht=g.forwardRef((s,r)=>{const{placeholder:i="Enter your message",rows:t=3,value:m="",onChange:n,className:o="",disabled:f=!1,error:d=!1,hint:l=""}=s,a=x=>{n&&n(x.target.value)};let c=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${o} `;return f?c+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":d?c+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":c+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:r,placeholder:i,rows:t,value:m,onChange:a,disabled:f,className:c}),l&&e.jsx("p",{className:`mt-2 text-sm ${d?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:l})]})}),xt=g.lazy(()=>ae(()=>import("./index-CKyZ6MXZ.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])));et.Quill.register("modules/imageDrop",tt);re.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const ft={syntax:{highlight:s=>re.highlightAuto(s).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},vt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],jt=s=>{const[r,i]=g.useState(s.imageList),[t,m]=g.useState(s.htmlCheck==="Y"),[n,o]=g.useState(s.newMode?"":s.content),f=g.useRef(),d=g.useRef(),l=g.useRef(null);g.useRef(null);const a=g.useRef(null),c=s.newMode,x=g.useRef([]),{height:h}=Re(),v=at.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),y={edTitle:c?"":s.title,edGbn:s.gbn?s.gbn:"etc",edDate:c?v:s.date,content:c?"":s.content,memoTxt:c?"":s.content,htmlCheck:s.htmlCheck},{register:k,handleSubmit:w,trigger:T,control:j,setValue:p,getValues:N,watch:S,formState:{errors:$,isSubmitting:E}}=nt({mode:"onChange",defaultValues:y});g.useEffect(()=>{k("edDate"),k("edGbn",{required:!0}),k("htmlCheck"),k("memoTxt")},[]),g.useEffect(()=>{x.current=[],f.current=s.content,d.current=!1},[s.content]);const L=async u=>{c?await s.onNewSubmit(u,x.current):await s.onPostSubmit(u,r,x.current)},xe=()=>{w(L)()},fe=u=>{console.log("onDelete.imageList=",u),i(u)},ve=u=>{let b=f.current;u.ext==="jpg"?b+=`<img src='${u.url}'/>`:u.ext==="mp4"&&(b+=`<video preload="auto" controls="" src='${u.url}'></video>`),f.current=b},je=u=>{f.current=u},ke=u=>{console.log("handleFileUpload",u),x.current=u};function pe(u){f.current=u,p("content",u),T("content")}function be(u,b){console.log("handleChangeDate=",u),console.log("handleChangeDate.currentDateString=",b);let R=P(u);console.log("handleChangeDate.dayjs=",R.format("YYYY-MM-DD HH:mm:ss")),p("edDate",R.format("YYYY-MM-DD")),T("edDate")}const ye=u=>{console.log("onChecked=",u),p("htmlCheck",u?"Y":"N"),m(u)},we=S("content"),Ne=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Te=["React","JavaScript","Bash","Java","Kotlin","CSS","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],$e=u=>{const b=l.current;if(b){const R=b.selectionStart,Ce=b.selectionEnd,A=n.slice(0,R),O=n.slice(Ce);o(A+u+O),p("memoTxt",A+u+O),setTimeout(()=>{b.selectionStart=b.selectionEnd=R+u.length,b.focus()},0)}},_=u=>{$e(u)};return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:w(L),style:{width:"100%",minHeight:"300px",maxHeight:{height:h},display:"flex",flexDirection:"column"},children:[e.jsx(ut,{onSubmit:u=>xe(),onCancel:s.onCancel,isSubmitting:E,newMode:c}),e.jsx(Ze,{control:j,onDelete:fe,onInsert:ve,setContent:je,onFileUpload:ke,imageList:s.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(Ge,{...k("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!$.edTitle})}),e.jsx(ot,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:j,defaultValue:N("edGbn"),selectList:Ne,error:!!$.edGbn,onChange:u=>{u.preventDefault();const b=u.target.value;console.log("edGbn=",N("edGbn")),p("edGbn",b)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(it,{id:"edDate",label:"일자",value:P(N("edDate")),...k("edDate"),defaultValue:P(N("edDate")),onChange:(u,b)=>{be(u,b)}}),e.jsx(gt,{id:"html",checked:t,onChange:ye,label:"HTML사용"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-130 overflow-y-scroll",children:e.jsx(te,{postData:n})}),e.jsxs("div",{children:[e.jsx(ht,{ref:l,className:"",value:n,onChange:u=>{p("memoTxt",u),o(u)},rows:22}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(B,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_("<box></box>"),children:"<Box>"}),e.jsx(B,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_("</code>"),children:"</code>"}),Te.map((u,b)=>e.jsx(B,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_("<code>"+u+"</code>"),children:u},b)),e.jsx(B,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_('<a href="" target="_blank"></a>'),children:"Link"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"})]})]}),e.jsx(g.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(xt,{ref:a,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:we,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:ft,formats:vt,onChange:pe})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},V=s=>{const{rootDb:r,isLoading:i,memoDetailData:t}=s,{scrollYProgress:m}=ue();ge(m,{stiffness:100,damping:30,restDelta:.001});const n=I(),o=g.useRef(),f=g.useRef();f.current=s.searchWord;const{memoId:d}=X(),l=W(),{user:a}=Y();o.current=l.pathname.split("/")[2]==="insert",console.log("memoDetailData=",t?.title),console.log("newMode=",o.current,", memoId=",d);const c=()=>{const v=`/${r==="memo"?"m":r}/${d==="insert"?"":d}`;n(v)},x=async(v,y)=>{console.log("onNewSubmit.values",v);const k=await z({rootDb:r,uid:a.uid,newData:o.current,key:d==="insert"?"root":d,values:v});if(await K(`${r}_txt`,r,k,y),k!==void 0){const w=`/${r==="memo"?"m":r}/${k}`;n(w,{state:{reflash:!0}})}},h=async(v,y,k)=>{const w=r==="memo"?`${r}_txt/${a.uid}/`:`${r}_txt/`,T=r==="memo"?`${r}_tree/${a.uid}/`:`${r}/`;await st(w,T,d,y),console.log("onPostSubmit.values",v);const j=await z({rootDb:r,uid:a.uid,newData:o.current,key:d==="insert"?"root":d,values:v});console.log("onPostSubmit.newKey=",j),console.log("onPostSubmit.files=",k);const p=await K(`${w}/`,r==="memo"?`${r}/${a.uid}/`:`${r}/`,d,k);console.log("onNewSubmit.imageResult",p),r==="memo"&&M(`memo_tree/${a.uid}/${d}/title`,v.edTitle),o.current=!1;const N=`/${r==="memo"?"m":r}/${d}`;n(N,{state:{reflash:!0}})};return g.useEffect(()=>{t&&t.title!==void 0&&Z({title:t.title,description:t.title});function v(){document.querySelectorAll("pre").forEach((y,k)=>{})}t&&t.memo!==null&&v()},[t]),d===""||a===void 0?e.jsx(e.Fragment,{}):t===void 0||i?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full p-0 m-0",children:o.current===!1&&t&&(t.title===void 0||t.title===""||t.title===null)?e.jsx(D,{}):e.jsx(jt,{newMode:o.current,onPostSubmit:h,onNewSubmit:x,onCancel:c,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html:"Y",content:t?.memo,imageList:t?.image})}),e.jsx(se,{})]})};function kt({initTreeData:s}){const[r,i]=g.useState(),t=o=>i(o),m=I();if(g.useEffect(()=>{i(s)},[s]),r==null||r.length===0)return e.jsx(D,{});const n=o=>{console.log("node",o),m(`/m/${o.id}`)};return e.jsx(G,{backend:J,options:U(),children:e.jsx(Q,{tree:r,rootId:"root",onDrop:t,render:(o,{depth:f,isOpen:d,onToggle:l})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:f*20+(o.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[o.cnt>0&&e.jsx("div",{onClick:l,children:d?e.jsx(de,{}):e.jsx(me,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>n(o),children:o.text})]}),o.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",o.cnt,")"]})]})})})}function pt(s){const{user:r}=Y(),i=I(),[t,m]=g.useState(),[n,o]=g.useState(),f=async d=>{const l=[],a=ne(oe(ie,`memo_tree/${d}`),Be("bm"),_e("Y")),c=await le(a);if(!c.exists()){console.log("getFireText.null");return}const x=c.val();for(let h in x){const v=x[h];v.id=h,v.key=h,v.text=v.title,l.push(v)}l.sort((h,v)=>h.title>v.title?1:-1),m([...l])};return g.useEffect(()=>{r!==void 0&&r!=null&&f(r?.uid)},[r]),g.useEffect(()=>{const d=async(l,a)=>{const c=[...a];if(a)for(const x of a){let h=x;for(;h.parent!=="root";){h.parent,h=await ce(`memo_tree/${l}/${h.parent}`);const v={id:h.key,text:h.title,droppable:!1,parent:h.parent};c.filter(k=>k.id===v.id).length===0&&c.push(v)}}for(const x of c){const h=x.id;x.cnt=c.filter(v=>v.parent===h).length}o(c)};t&&t.length>0&&d(r?.uid,t)},[t]),r===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Ee,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:t&&t.map((d,l)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{s.onSelected(d.key),i(`/m/${d.key}`)},children:e.jsx("span",{className:"text-base",children:d.title})})},l))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),n===void 0||n===null&&e.jsx(Loading,{}),n&&n.length===0?e.jsx("div",{className:"m-4 text-gray-500",children:"No BookMark"}):e.jsx(kt,{initTreeData:n,uid:r?.uid})]})}const bt=async(s,r,i)=>{let t=new Array;for(let m in i){const n=i[m];try{if(n.key=m,n.url===void 0){const o=await Fe(Ye,`${r}/${m}.${n.ext}`),f=await Pe(o);n.url=f,M(`${s}/image/${m}/url`,f)}t.push(n)}catch(o){console.log("getImageList.catch",o)}}return t},yt=async(s,r,i,t)=>{let m="",n="",o={};((l,a,c)=>{n=l==="memo"?`${l}/${a}/${c}`:`${l}/${c}`,m=l==="memo"?`${l}_txt/${a}/${c}`:`${l}_txt/${c}`})(s,r,i);async function d(){if(m===void 0)return"";if(o=await ce(m),o===void 0)return console.log("No data available"),"";if(o?.fullIndex,o.image!==void 0&&o.image!==null){const l=await bt(m,n,o.image);o.image=l,(o.imageOK===void 0||o.imageOK==="N")&&(l&&l.map(a=>{a.ext==="jpg"&&(o.memo=o.memo+`<img src='${a.url}'>`)}),M(`${m}/imageOK`,"Y"),M(`${m}/memo`,o.memo))}if(t!==void 0&&t!==""){const l=t,a=new RegExp(l,"gi"),c=o.memo.replace(a,`<span class='lightext'>${l}</span>`);o.memo=c}}return await d(),o};async function wt(s,r,i=""){if(r==null||r==="")return"";let t=i===""?`${s}_tree/${r}`:`${s}_txt/${r}`;s==="home"&&(t="home_txt");const m=ne(oe(ie,t)),n=await le(m);if(!n.exists())return console.log("getTreeData.null"),null;if(!n.exists())return console.log("getTreeData.exists"),null;const o=n.val(),f=[],d={};s==="home"&&(q.map(l=>{f.push({title:l.label,id:l.id,sub:[]})}),q.map(l=>{d[l.id]=[]}));for(const l in o){const a=o[l];a.up===void 0?(a.id=l,a.fullIndex=l):(a.id=a.up,a.fullIndex=a.up),s==="home"?a.gbn!==void 0&&d[a.gbn].push(a):i===""||i===void 0?f.push(a):(a.id=l,(a.memo+"").toLowerCase().indexOf(i.toLowerCase())>-1&&f.push(a))}return s==="home"?Object.values(d).map((l,a)=>{l.sort((c,x)=>c.title>x.title?1:-1),f[a].sub=l}):f.sort((l,a)=>l.title>a.title?1:-1),f}const Nt=s=>e.jsx(ee.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(He,{to:s.to,className:"text-inherit no-underline cursor-pointer",...s,children:e.jsx(rt,{children:s.children})})}),Tt=g.lazy(async()=>await ae(()=>import("./TwMemoMain-C3wIsPER.js"),__vite__mapDeps([11,1,2,12]))),$t=({rootDb:s})=>{const r=I(),{user:i}=Y(),t=g.useRef(),m=g.useRef(),n=g.useRef(!0),o=g.useRef(),f=g.useRef(),[d,l]=g.useState(),a=g.useRef(!1),c=W(),x=g.useRef(!1);x.current=c?.state?.reflash===!0;const h=We({queryKey:["twTreeData",i?.uid,t.current],queryFn:()=>wt(s,i?.uid,t.current)});h.data!==void 0&&h.data!==""&&!a.current&&(a.current=!0);const v=()=>{const j=d;j&&(j.bookmark=j.bookmark==="Y"?"N":"Y");const p=`memo_tree/${i.uid}/${f.current}/bm`;M(p,d.bookmark),l({...d,bookmark:j.bookmark})};g.useEffect(()=>{i!==void 0&&i!=null&&h.refetch()},[i]),g.useEffect(()=>{const j=async S=>{if(S!==""&&i){const $=await yt(s,i?.uid,S,t.current);{const E=he(h.data,{id:"",nm:""},S),L=E.id;m.current=E.nm,L!==o&&(o.current=L,Ke(i.uid,S,L))}$!==void 0&&$?.bookmark===void 0&&($.bookmark="N"),n.current=!1,l($===void 0?{}:$)}},p=c.pathname.split("/"),N=p.length>2?p[p.length-1]:"";n.current=!0,j(N),f.current=N},[c.pathname,i]),g.useEffect(()=>{i!==void 0&&i!=null&&h.refetch()},[x.current]);const y=j=>{a.current=!1,j!==void 0&&(t.current=j),h.refetch()},k=()=>{if(i==null){alert("로그인 후 이용 가능합니다.");return}const j=`/${s==="memo"?"m":s}/insert/insert`;r(j)},w=j=>{},T=e.jsxs("div",{className:"",children:[e.jsx("div",{className:"mt-3",children:e.jsx(Nt,{to:"/m",children:s==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[s==="memo"?"":e.jsx(H,{to:"/m",children:"메모"}),e.jsx(H,{to:"/todo",children:"TODO"}),e.jsx(H,{to:"/tail",children:"Sheet"})]}),e.jsx(lt,{onNewMemoBtn:k,onSearchDataBtn:y}),a.current&&h.isFetched?e.jsx(ct,{expandIndex:o.current,initTreeData:h.data,userId:i?.uid}):e.jsx(D,{})]});return i&&i.uid===Ae&&Oe,e.jsxs(Ue,{sideType:"memo",title:s==="memo"?"메모장":"홈페이지관리",sideContents:T,children:[e.jsx(g.Suspense,{fallback:e.jsx(D,{}),children:e.jsxs(qe,{children:[e.jsx(F,{path:"/edit/:memoId",element:e.jsx(V,{rootDb:s,isLoading:n.current,searchWord:t.current,memoDetailData:d})}),e.jsx(F,{path:"/insert/:memoId",element:e.jsx(V,{rootDb:s,isLoading:n.current,searchWord:t.current,memoDetailData:d})}),e.jsx(F,{path:"/:memoId",element:e.jsx(mt,{rootDb:s,isLoading:n.current,searchWord:t.current,memoDetailData:d,onTreeUpdate:y,pathNm:m.current,onBookmark:v,data:h.data})}),e.jsx(F,{path:"*",element:e.jsx(Tt,{searchWord:t.current,data:h.data,onNewMemoBtn:k,title:s==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),s==="memo"?e.jsx(pt,{onSelected:w}):"",e.jsx(ze,{})]})},he=(s,r,i)=>{let t={};if(s)for(let m=0;m<s.length;m++){const n=s[m];if(n.id===i)return t.id=r.id+n.id,t.nm=r.nm+n.title,t;if(n.sub!==null&&n.sub!==void 0){if(t.id=r.id+n.id+"/sub/",t.nm=r.nm+n.title+" > ",t=he(Object.values(n.sub),t,i),t.id&&t.id.endsWith(i))return t;t={}}}return t},Ot=()=>e.jsx($t,{rootDb:"memo"});export{Ot as default};
