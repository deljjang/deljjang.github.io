const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CMlbnrLH.js","assets/index-pfywi-4O.js","assets/index-DLU66RPy.css","assets/SinySelect-DV8gPGjg.js","assets/index-DRVdW7Nr.js","assets/TextField-CIwR95Hx.js","assets/InputAdornment-Du8H2uzt.js","assets/Popper-DTLjPz0p.js","assets/Chip-4eDFpv42.js","assets/index.esm-B-h2qpzR.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-BpYNQSCA.js","assets/TwButton-c9bsVZiN.js"])))=>i.map(i=>d[i]);
import{r as d,j as e,x as Q,a1 as Se,u as L,L as $,D as J,g as X,S as Z,T as ee,d as _,i as Le,q as te,e as Ie,o as Me,a as se,f as ae,m as ne,c as re,t as oe,v as P,w as ie,H as le,y as Ee,z as Re,C as Be,E as ce,F as _e,G as Fe,J as F,K as R,N as de,_ as me,P as S,p as Ye,a2 as Pe,a3 as He,a4 as ze,n as q,Q as Ae,R as Y,U as We,V as Oe,W as qe,X as B,Y as Ge}from"./index-pfywi-4O.js";import{T as Ke,u as ue,a as ge,F as Ve,b as Ue,D as Qe,l as Je,I as Xe,s as G,d as K,e as Ze}from"./index-CMlbnrLH.js";import{T as et}from"./TwLayout-CI-7AwHX.js";import{E as tt,C as st}from"./ExpandMore-DcXTwDT1.js";import{F as he}from"./Favorite-CalqWZwu.js";import{T as D}from"./TwButton-c9bsVZiN.js";import{D as at}from"./datetime-BDx6lZXm.js";import{u as nt}from"./index.esm-B-h2qpzR.js";import"./index-CLQ_oLGC.js";import{S as rt,a as ot}from"./SinySelect-DV8gPGjg.js";import{T as it,I as lt}from"./TextField-CIwR95Hx.js";import{S as ct}from"./check-circle-BJrb7JOf.js";import"./chevron-down-DuJq_UJP.js";import"./index-DRVdW7Nr.js";import"./InputAdornment-Du8H2uzt.js";import"./Popper-DTLjPz0p.js";import"./Chip-4eDFpv42.js";const dt=s=>d.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...s},d.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),mt=s=>d.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...s},d.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),ut=s=>e.jsx(Q.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Se,{to:s.to,className:"text-inherit no-underline cursor-pointer",...s,children:e.jsx(Ke,{children:s.children})})});function gt({initTreeData:s}){const[a,o]=d.useState(),t=i=>o(i),m=L();if(d.useEffect(()=>{o(s)},[s]),a==null||a.length===0)return e.jsx($,{});const l=i=>{console.log("node",i),m(`/m/${i.id}`)};return e.jsx(J,{backend:Z,options:X(),children:e.jsx(ee,{tree:a,rootId:"root",onDrop:t,render:(i,{depth:f,isOpen:u,onToggle:r})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:f*20+(i.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[i.cnt>0&&e.jsx("div",{onClick:r,children:u?e.jsx(tt,{}):e.jsx(st,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>l(i),children:i.text})]}),i.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",i.cnt,")"]})]})})})}function ht(s){const{user:a}=_(),o=L(),[t,m]=d.useState(),[l,i]=d.useState(),f=async u=>{const r=[],n=te(se(ae,`memo_tree/${u}`),Me("bm"),Ie("Y")),g=await ne(n);if(!g.exists()){console.log("getFireText.null");return}const h=g.val();for(let v in h){const x=h[v];x.id=v,x.key=v,x.text=x.title,r.push(x)}r.sort((v,x)=>v.title>x.title?1:-1),m([...r])};return d.useEffect(()=>{a!==void 0&&a!=null&&f(a?.uid)},[a]),d.useEffect(()=>{const u=async(r,n)=>{const g=[...n];if(n)for(const h of n){let v=h;for(;v.parent!=="root";){v.parent,v=await re(`memo_tree/${r}/${v.parent}`);const x={id:v.key,text:v.title,droppable:!1,parent:v.parent};g.filter(b=>b.id===x.id).length===0&&g.push(x)}}for(const h of g){const v=h.id;h.cnt=g.filter(x=>x.parent===v).length}i(g)};t&&t.length>0&&u(a?.uid,t)},[t]),a===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Le,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:t&&t.map((u,r)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{s.onSelected(u.key),o(`/m/${u.key}`)},children:e.jsx("span",{className:"text-base",children:u.title})})},r))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),l===void 0||l===null&&e.jsx(Loading,{}),l&&l.length===0?e.jsx("div",{className:"m-4 text-gray-500",children:"No BookMark"}):e.jsx(gt,{initTreeData:l,uid:a?.uid})]})}const xt=s=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(D,{size:"sm",variant:"outlined",color:"success",onClick:s.onEdit,children:"수정"}),e.jsx(D,{size:"sm",variant:"outlined",color:"warning",onClick:s.onNewMemo,children:"새글"}),e.jsx(D,{size:"sm",variant:"outlined",color:"error",onClick:s.onDelete,children:"삭제"})]}),ft=s=>{const{rootDb:a,isLoading:o,memoDetailData:t}=s,{scrollYProgress:m}=ue(),l=ge(m,{stiffness:100,damping:30,restDelta:.001}),[i,f]=d.useState(!1),u=L(),r=d.useRef();r.current=s.searchWord;const{memoId:n}=oe(),h=P()?.state?.fullIndex,{user:v}=_(),x=()=>{const p=`/${a==="memo"?"m":a}/edit/${n}`;u(p,{state:{fullIndex:h}})},y=()=>{const p=`/${a==="memo"?"m":a}/insert/${n}`;u(p,{state:{fullIndex:h}})},b=async()=>{const p=a==="memo"?`${a}_txt/${v.uid}/${n}`:`${a}_txt/${n}`,w=a==="memo"?`${a}_tree/${v.uid}`:a;if(await Ue(p,w)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}s.onTreeUpdate(),u(`/${a==="memo"?"m":a}`)},N=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&b()},j=()=>{s.onBookmark()};return d.useEffect(()=>{t&&t.title!==void 0&&ie({title:t.title,description:t.title});function p(){window.scrollTo({top:0}),t&&t.html!=="N"&&document.querySelectorAll("pre").forEach(w=>{w.innerHTML=_e(w.innerHTML)})}t&&t.memo!==null&&p()},[t]),o?e.jsx($,{}):n===""||v===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(Q.div,{className:"progress-bar",style:{scaleX:l}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:t&&t.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:j,children:t&&t.bookmark==="Y"?e.jsx(he,{className:"text-red-500"}):e.jsx(Ve,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s.memoDetailData?.path&&s.memoDetailData?.path.map((p,w)=>w===0?p.title:` > ${p.title}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(xt,{rootDb:a,onEdit:x,onNewMemo:y,onDelete:N,bookmark:t&&t.bookmark}),e.jsxs("div",{className:"my-4",children:[t&&t.html==="N"?e.jsx(le,{postData:t&&t.memo}):t&&t.html!=="N"&&t.memo&&e.jsx(Ee,{text:t.memo}),e.jsx(Re,{imageList:t&&t.image}),!t&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Be,{})})})]})]}),e.jsx(ce,{})]})},vt=({onSubmit:s,onCancel:a,isSubmitting:o,newMode:t})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(D,{variant:"outlined",color:"success",disabled:o,onClick:m=>{m.preventDefault(),s(m)},children:[t?"새글":""," 저장"]}),e.jsx(D,{variant:"outlined",color:"error",onClick:a,children:"취소"})]});d.forwardRef((s,a)=>{const{id:o,label:t,defaultValue:m,onChange:l,className:i="",...f}=s,u=r=>{l&&l(r.target.value)};return e.jsxs("div",{className:` ${i}`,children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:o,children:t}),e.jsx("input",{ref:a,type:"date",id:o,defaultValue:m,onChange:u,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...f})]})});const V=({label:s,checked:a,id:o,onChange:t,className:m="",disabled:l=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${l?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:o,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${m}`,checked:a,onChange:i=>t(i.target.checked),disabled:l}),a&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),l&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:s})]}),jt=d.forwardRef((s,a)=>{const{placeholder:o="Enter your message",rows:t=3,value:m="",onChange:l,className:i="",disabled:f=!1,error:u=!1,hint:r=""}=s,n=h=>{l&&l(h.target.value)};let g=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${i} `;return f?g+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":u?g+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":g+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:a,placeholder:o,rows:t,value:m,onChange:n,disabled:f,className:g}),r&&e.jsx("p",{className:`mt-2 text-sm ${u?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:r})]})}),kt=d.lazy(()=>me(()=>import("./index-CMlbnrLH.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])));Je.Quill.register("modules/imageDrop",Xe);de.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const pt={syntax:{highlight:s=>de.highlightAuto(s).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},bt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],yt=s=>{const[a,o]=d.useState(s.imageList),[t,m]=d.useState(s.htmlCheck==="Y"),[l,i]=d.useState(s.iconCheck==="Y"),[f,u]=d.useState(s.newMode?"":s.content),r=d.useRef(),n=d.useRef(),g=d.useRef(null);d.useRef(null);const h=d.useRef(null),v=s.newMode,x=d.useRef([]),{height:y}=Fe(),b=at.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),N={edTitle:v?"":s.title,edGbn:s.gbn?s.gbn:"etc",edDate:v?b:s.date,content:v?"":s.content,memoTxt:v?"":s.content,htmlCheck:s.htmlCheck,iconCheck:s.iconCheck},{register:j,handleSubmit:p,trigger:w,control:T,setValue:C,getValues:M,watch:xe,formState:{errors:H,isSubmitting:fe}}=nt({mode:"onChange",defaultValues:N});d.useEffect(()=>{j("edDate"),j("edGbn",{required:!0}),j("htmlCheck"),j("iconCheck"),j("memoTxt")},[]),d.useEffect(()=>{x.current=[],r.current=s.content,n.current=!1},[s.content]);const z=async c=>{v?await s.onNewSubmit(c,x.current):await s.onPostSubmit(c,a,x.current)},ve=()=>{p(z)()},je=c=>{console.log("onDelete.imageList=",c),o(c)},ke=c=>{let k=r.current;c.ext==="jpg"?k+=`<img src='${c.url}'/>`:c.ext==="mp4"&&(k+=`<video preload="auto" controls="" src='${c.url}'></video>`),r.current=k},pe=c=>{r.current=c},be=c=>{console.log("handleFileUpload",c),x.current=c};function ye(c){r.current=c,C("content",c),w("content")}function we(c,k){console.log("handleChangeDate=",c),console.log("handleChangeDate.currentDateString=",k);let I=F(c);console.log("handleChangeDate.dayjs=",I.format("YYYY-MM-DD HH:mm:ss")),C("edDate",I.format("YYYY-MM-DD")),w("edDate")}const A=(c,k)=>{console.log(`onChecked.${c}=`,k),C(c,k?"Y":"N"),c==="htmlCheck"?m(k):i(k)},Ne=xe("content"),Ce=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Te=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],De=c=>{const k=g.current;if(k){const I=k.selectionStart,$e=k.selectionEnd,W=f.slice(0,I),O=f.slice($e);u(W+c+O),C("memoTxt",W+c+O),setTimeout(()=>{k.selectionStart=k.selectionEnd=I+c.length,k.focus()},0)}},E=c=>{De(c)};return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:p(z),style:{width:"100%",minHeight:"300px",maxHeight:{height:y},display:"flex",flexDirection:"column"},children:[e.jsx(vt,{onSubmit:c=>ve(),onCancel:s.onCancel,isSubmitting:fe,newMode:v}),e.jsx(Qe,{control:T,onDelete:je,onInsert:ke,setContent:pe,onFileUpload:be,imageList:s.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(it,{...j("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!H.edTitle})}),e.jsx(rt,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:T,defaultValue:M("edGbn"),selectList:Ce,error:!!H.edGbn,onChange:c=>{c.preventDefault();const k=c.target.value;console.log("edGbn=",M("edGbn")),C("edGbn",k)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ot,{id:"edDate",label:"일자",value:F(M("edDate")),...j("edDate"),defaultValue:F(M("edDate")),onChange:(c,k)=>{we(c,k)}}),e.jsx(V,{id:"html",checked:t,onChange:c=>A("htmlCheck",c),label:"HTML사용"}),e.jsx(V,{id:"icon",checked:l,onChange:c=>A("iconCheck",c),label:"Icon"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-130 overflow-y-scroll",children:e.jsx(le,{postData:f})}),e.jsxs("div",{children:[e.jsx(jt,{ref:g,className:"",value:f,onChange:c=>{C("memoTxt",c),u(c)},rows:22}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>E("<box></box>"),children:"<Box>"}),Te.map((c,k)=>e.jsx(R,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>E("<code>"+c+"</code>"),children:c},k)),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>E('<a href="" target="_blank"></a>'),children:"Link"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>E('<img src=""></img>'),children:"img"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"})]})]}),e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(kt,{ref:h,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:Ne,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:pt,formats:bt,onChange:ye})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},U=s=>{const{rootDb:a,isLoading:o,memoDetailData:t}=s,{scrollYProgress:m}=ue();ge(m,{stiffness:100,damping:30,restDelta:.001});const l=L(),i=d.useRef(),f=d.useRef();f.current=s.searchWord;const{memoId:u}=oe(),r=P(),{user:n}=_();i.current=r.pathname.split("/")[2]==="insert",console.log("memoDetailData=",t?.title),console.log("newMode=",i.current,", memoId=",u);const g=()=>{const x=`/${a==="memo"?"m":a}/${u==="insert"?"":u}`;l(x)},h=async(x,y)=>{console.log("onNewSubmit.values",x);const b=await G({rootDb:a,uid:n.uid,newData:i.current,key:u==="insert"?"root":u,values:x});if(await K(`${a}_txt`,a,b,y),b!==void 0){const N=`/${a==="memo"?"m":a}/${b}`;l(N,{state:{reflash:!0}})}},v=async(x,y,b)=>{const N=a==="memo"?`${a}_txt/${n.uid}/`:`${a}_txt/`,j=a==="memo"?`${a}_tree/${n.uid}/`:`${a}/`;await Ze(N,j,u,y),console.log("onPostSubmit.values",x);const p=await G({rootDb:a,uid:n.uid,newData:i.current,key:u==="insert"?"root":u,values:x});console.log("onPostSubmit.newKey=",p),console.log("onPostSubmit.files=",b);const w=await K(`${N}/`,a==="memo"?`${a}/${n.uid}/`:`${a}/`,u,b);console.log("onNewSubmit.imageResult",w),a==="memo"&&S(`memo_tree/${n.uid}/${u}/title`,x.edTitle),i.current=!1;const T=`/${a==="memo"?"m":a}/${u}`;l(T,{state:{reflash:!0}})};return d.useEffect(()=>{t&&t.title!==void 0&&ie({title:t.title,description:t.title});function x(){document.querySelectorAll("pre").forEach((y,b)=>{})}t&&t.memo!==null&&x()},[t]),u===""||n===void 0?e.jsx(e.Fragment,{}):t===void 0||o?e.jsx($,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full p-0 m-0",children:i.current===!1&&t&&(t.title===void 0||t.title===""||t.title===null)?e.jsx($,{}):e.jsx(yt,{newMode:i.current,onPostSubmit:v,onNewSubmit:h,onCancel:g,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html:"Y",iconCheck:t?.icon?t?.icon:"Y",content:t?.memo,imageList:t?.image})}),e.jsx(ce,{})]})};function wt({initTreeData:s,userId:a}){const[o,t]=d.useState(s),{isMoble:m,height:l,width:i}=Ye(),f=(n,g)=>{if(g.dragSource.id!==void 0&&g.dropTargetId!==void 0){const h=`memo_tree/${a}/${g.dragSource.id}/parent`;S(h,g.dropTargetId),console.log("loc=",h)}t(n)},u=L();if(d.useEffect(()=>{(async()=>{const g=[];if(s)for(const h of s){const v={id:h.key,text:h.title,droppable:!0,parent:h.parent,icon:h.bm==="Y"?e.jsx(he,{className:"text-red-500"}):h.icon==="Y"?e.jsx(ct,{}):null};g.push(v)}for(const h of g){const v=h.id;h.cnt=g.filter(x=>x.parent===v).length}t(g)})()},[s]),o==null||o.length===0)return e.jsx($,{});const r=n=>{console.log("node",n),u(`/m/${n.id}`)};return e.jsx(J,{backend:Z,options:X(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:l-220-(m?56:0)+(i>1024?60:0),width:"100%"},children:e.jsx(ee,{tree:o,rootId:"root",onDrop:f,render:(n,{depth:g,isOpen:h,onToggle:v,isDragging:x,isDropTarget:y})=>e.jsxs("div",{className:`w-63 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ${x?"opacity-50":""} ${y?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"}`,style:{paddingLeft:g*20+(n.cnt===0?5:0)},children:[e.jsx("div",{className:"min-w-0",children:n.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:v,children:h?e.jsx(dt,{className:"size-6"}):e.jsx(mt,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>r(n),children:[e.jsxs("div",{className:"flex truncate pr-2",children:[n.icon,n.text]}),n.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",n.cnt,")"]})]})]})})})})}const Nt=s=>{const a=d.useRef(null);function o(){s.onSearchDataBtn(a.current.value)}function t(){return s.onNewMemoBtn(),!1}function m(l){l.which===13&&o()}return e.jsxs(e.Fragment,{children:[e.jsx(lt,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:a,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:m}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(D,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:t,children:"새글"}),e.jsx(D,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:o,children:"조회"})]})]})},Ct=async(s,a,o)=>{let t=new Array;for(let m in o){const l=o[m];try{if(l.key=m,l.url===void 0){const i=await Pe(He,`${a}/${m}.${l.ext}`),f=await ze(i);l.url=f,S(`${s}/image/${m}/url`,f)}t.push(l)}catch(i){console.log("getImageList.catch",i)}}return t},Tt=async(s,a,o,t)=>{let m="",l="",i={};((r,n,g)=>{l=r==="memo"?`${r}/${n}/${g}`:`${r}/${g}`,m=r==="memo"?`${r}_txt/${n}/${g}`:`${r}_txt/${g}`})(s,a,o);async function u(){if(m===void 0)return"";if(i=await re(m),i===void 0)return console.log("No data available"),"";if(i?.fullIndex,i.image!==void 0&&i.image!==null){const r=await Ct(m,l,i.image);i.image=r,(i.imageOK===void 0||i.imageOK==="N")&&(r&&r.map(n=>{n.ext==="jpg"&&(i.memo=i.memo+`<img src='${n.url}'>`)}),S(`${m}/imageOK`,"Y"),S(`${m}/memo`,i.memo))}if(t!==void 0&&t!==""){const r=t,n=new RegExp(r,"gi"),g=i.memo.replace(n,`<span class='lightext'>${r}</span>`);i.memo=g}}return await u(),i};async function Dt(s,a,o=""){if(a==null||a==="")return"";let t=o===""?`${s}_tree/${a}`:`${s}_txt/${a}`;s==="home"&&(t="home_txt");const m=te(se(ae,t)),l=await ne(m);if(!l.exists())return console.log("getTreeData.null"),null;if(!l.exists())return console.log("getTreeData.exists"),null;const i=l.val(),f=[],u={};s==="home"&&(q.map(r=>{f.push({title:r.label,id:r.id,sub:[]})}),q.map(r=>{u[r.id]=[]}));for(const r in i){const n=i[r];n.key==="-OZNT48PGjAjZLiXNY8F"&&console.log("i="+r,", item=",n),n.up===void 0?(n.id=r,n.fullIndex=r):(n.id=n.up,n.fullIndex=n.up),s==="home"?n.gbn!==void 0&&u[n.gbn].push(n):o===""||o===void 0?f.push(n):(n.id=r,(n.memo+"").toLowerCase().indexOf(o.toLowerCase())>-1&&f.push(n))}return s==="home"?Object.values(u).map((r,n)=>{r.sort((g,h)=>g.title>h.title?1:-1),f[n].sub=r}):f.sort((r,n)=>r.title>n.title?1:-1),f}const $t=d.lazy(async()=>await me(()=>import("./TwMemoMain-BpYNQSCA.js"),__vite__mapDeps([11,1,2,12]))),St=({rootDb:s})=>{const a=L(),{user:o}=_(),t=d.useRef(),m=d.useRef(!0),l=d.useRef(),i=d.useRef(),[f,u]=d.useState(),r=d.useRef(!1),n=P(),g=d.useRef(!1);g.current=n?.state?.reflash===!0;const h=Ae({queryKey:["twTreeData",o?.uid,t.current],queryFn:()=>Dt(s,o?.uid,t.current)});h.data!==void 0&&h.data!==""&&!r.current&&(r.current=!0);const v=()=>{const j=f;j&&(j.bookmark=j.bookmark==="Y"?"N":"Y");const p=`memo_tree/${o.uid}/${i.current}/bm`;S(p,f.bookmark),u({...f,bookmark:j.bookmark})};d.useEffect(()=>{o!==void 0&&o!=null&&h.refetch()},[o]),d.useEffect(()=>{const j=async T=>{if(T!==""&&o){const C=await Tt(s,o?.uid,T,t.current);C.path=Lt(h.data,T),m.current=!1,u(C===void 0?{}:C)}},p=n.pathname.split("/"),w=p.length>2?p[p.length-1]:"";m.current=!0,j(w),i.current=w},[n.pathname,o]),d.useEffect(()=>{o!==void 0&&o!=null&&h.refetch()},[g.current]);const x=j=>{r.current=!1,j!==void 0&&(t.current=j),h.refetch()},y=()=>{if(o==null){alert("로그인 후 이용 가능합니다.");return}const j=`/${s==="memo"?"m":s}/insert/insert`;a(j)},b=j=>{},N=e.jsxs("div",{className:"",children:[e.jsx("div",{className:"mt-3",children:e.jsx(ut,{to:"/m",children:s==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[s==="memo"?"":e.jsx(Y,{to:"/m",children:"메모"}),e.jsx(Y,{to:"/todo",children:"TODO"}),e.jsx(Y,{to:"/tail",children:"Sheet"})]}),e.jsx(Nt,{onNewMemoBtn:y,onSearchDataBtn:x}),r.current&&h.isFetched?e.jsx(wt,{expandIndex:l.current,initTreeData:h.data,userId:o?.uid}):o===void 0?e.jsx(e.Fragment,{}):e.jsx($,{})]});return o&&o.uid===We&&Oe,e.jsxs(et,{sideType:"memo",title:s==="memo"?"메모장":"홈페이지관리",sideContents:N,children:[e.jsx(d.Suspense,{fallback:e.jsx($,{}),children:e.jsxs(qe,{children:[e.jsx(B,{path:"/edit/:memoId",element:e.jsx(U,{rootDb:s,isLoading:m.current,searchWord:t.current,memoDetailData:f})}),e.jsx(B,{path:"/insert/:memoId",element:e.jsx(U,{rootDb:s,isLoading:m.current,searchWord:t.current,memoDetailData:f})}),e.jsx(B,{path:"/:memoId",element:e.jsx(ft,{rootDb:s,isLoading:m.current,searchWord:t.current,memoDetailData:f,onTreeUpdate:x,onBookmark:v,data:h.data})}),e.jsx(B,{path:"*",element:e.jsx($t,{searchWord:t.current,data:h.data,onNewMemoBtn:y,title:s==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),s==="memo"?e.jsx(ht,{onSelected:b}):"",e.jsx(Ge,{})]})},Lt=(s,a)=>{let o=[],t=a;if(!s)return o;const m=s.find(l=>l.id===t);for(o.unshift(m),t=m?.parent;t!=null&&t!==""&&t!=="root";){const l=s.find(i=>i.id===t);t=l?.parent,o.unshift(l)}return o},Vt=()=>e.jsx(St,{rootDb:"memo"});export{Vt as default};
