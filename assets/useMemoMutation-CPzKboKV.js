import{j as e,bO as M,e as $,r as m,p as R,bP as T,i as C,as as y,h as U,a as B,k as I,s as Q,bd as E,t as N}from"./index-Btvos86Q.js";import{s as K,f as _,b as H}from"./MemoComm-z5rA1VNO.js";const O=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",...t,children:e.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"})}),F=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",...t,children:e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})}),J=t=>{const{control:r}=t;M({control:r,name:"content"});const{t:g}=$(),[x,l]=m.useState(!1),[o]=m.useState(!1),[s,u]=m.useState([]),[c,n]=m.useState(t.imageList),i=m.useRef(0);m.useEffect(()=>{u([])},[]);const h=m.useCallback(a=>{a.preventDefault(),a.dataTransfer?.files&&l(!0)},[]),d=m.useCallback(a=>{a.preventDefault(),l(!1)},[]),f=m.useCallback(a=>{let v=[],p=s;a.type==="drop"?v=a.dataTransfer.files:v=a.target.files;for(const k of v){const L=URL.createObjectURL(k);p=[...p,{id:i.current++,object:k,url:L}]}t.onFileUpload(p),u(p)},[s,t]),j=m.useCallback(a=>{n(a),t.onDelete(a)},[t]),b=a=>{t.onInsert(a)},D=a=>t.onRename(a),w=m.useCallback(a=>{const v=s.filter(p=>p.id!==a);t.onFileUpload(v),u(v)},[s,t]),S=m.useCallback(a=>{a.preventDefault(),a.stopPropagation(),l(!1),f(a)},[f]);return e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsx("div",{children:e.jsxs("div",{variant:"outlined",onDragOver:h,onDragLeave:d,onDrop:S,className:`relative mb-2.5 cursor-pointer p-1.5 text-center ${x?"border-red-500 bg-gray-100 dark:bg-gray-800":"border-gray-400"}`,style:{borderStyle:"dashed",borderWidth:"1px"},children:[e.jsx("input",{type:"file",id:"fileUpload",className:"hidden",multiple:!0,onChange:f}),e.jsx("label",{htmlFor:"fileUpload",children:e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("span",{className:"inline-flex items-center justify-center p-2 text-blue-500",children:e.jsx(O,{className:"size-10"})}),e.jsx("p",{children:g("file_upload")})]})}),o&&e.jsx("div",{className:"absolute top-1/2 left-1/2 -mt-3 -ml-3",children:e.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})}),e.jsx(q,{imgList:c,onInsert:b,onRename:D,onClick:j}),s.length>0&&s.map((a,v)=>{const{id:p,object:{name:k},url:L}=a;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx("img",{src:L,alt:k,className:"w-[50px]"}),e.jsx("div",{children:k}),e.jsx("button",{type:"button","aria-label":"delete",onClick:()=>w(p),children:e.jsx(F,{className:"text-red-500"})})]},v),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 my-1"})]},v)})]})},q=t=>{const[r,g]=m.useState(t.imgList),{t:x}=$(),[l,o]=m.useState(""),s=n=>(r.map(i=>{if(i.key===n)return t.onInsert(i),!1}),!1),u=n=>(o(n),r.map(i=>{if(i.key===n)return t.onRename(i).then(d=>{d&&(i.key=d.key,i.name=d.name,g([...r]),o(""))}),!1}),!1),c=n=>{const i=r.map(h=>(h.key===n&&(h.del="Y"),h));g(i),t.onClick(i)};return r&&r.length>0&&r.map((n,i)=>{const{key:h,name:d,url:f,del:j,ext:b}=n,D=/(jpg|jpeg|png|gif|bmp|webp|svg)/i;return j!==void 0?"":e.jsxs("div",{children:[e.jsxs("div",{className:`${R.between} gap-1`,children:[b==="mp4"&&e.jsx("p",{className:"w-[50px] text-center text-sm",children:b}),D.test(b)&&e.jsx("img",{src:f,alt:d,className:"max-h-12 max-w-12"}),e.jsxs("div",{className:"flex truncate items-center",children:[l===h&&e.jsx(T,{}),e.jsx("p",{className:"truncate",children:d})]}),e.jsxs("div",{className:"flex",children:[f&&e.jsxs("div",{className:"gap-3",children:[e.jsx(C,{onClick:w=>{w.preventDefault(),u(h)},children:x("edit")}),e.jsx(C,{onClick:w=>{w.preventDefault(),s(h)},children:x("add")})]}),e.jsx("button",{type:"button","aria-label":"delete",onClick:()=>c(h),className:"p-2",children:e.jsx(F,{className:"text-red-700"})})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 my-1"})]},i)})},V=({onSubmit:t,onCancel:r,isSubmitting:g,newMode:x=!1})=>{const{t:l}=$();return e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsx(C,{variant:"outlined",color:"success",disabled:g,isLoading:g,onClick:o=>{o.preventDefault(),t(o)},children:l(x?"new":"save")}),e.jsx(C,{variant:"outlined",color:"error",onClick:o=>{o.preventDefault(),r()},children:l("cancel")})]})},z=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"];function W({onClick:t}){return e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>t(`<box>
</box>`),children:"<Box>"}),e.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>t(`<a href="/data/memo/" target="_blank" class="ahover">
</a>`),children:"Link"}),e.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>t('<img src="/data/memo/"></img>'),children:"image"}),e.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>t('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"video"}),e.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>t('<hr style="width=100%"/>'),children:"line"}),z.map((r,g)=>e.jsx(y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>t(`<code>lang="${r}" highlight=""`),children:r},g))]})}const Y=(t,r)=>{const g=U(),x=B(),{user:l}=I(),o=Q();return E({mutationFn:async({values:s,imageList:u,files:c})=>{const n=x.pathname.includes("/insert"),i=n&&r==="insert"?"root":r,h=await K({rootDb:t,uid:l.uid,newData:n,key:i,values:s}),d=n?h:r,f=t==="memo"?`${t}_txt/${l.uid}/`:`${t}_txt/`,j=t==="memo"?`${t}/${l.uid}/`:`${t}/`;return n||await _(f,j,d,u),await H(f,j,d,c),t==="memo"&&!n&&(N(`memo_tree/${l.uid}/${d}/title`,s.edTitle),N(`memo_tree/${l.uid}/${d}/text`,s.edTitle),s.rootCheck==="Y"&&N(`memo_tree/${l.uid}/${d}/parent`,"root")),t==="home"&&N("home/tree",null),{key:d,isNew:n}},onMutate:async({values:s})=>{if(x.pathname.includes("/insert"))return;const c=["memoDetail",t,l?.uid,r];await o.cancelQueries({queryKey:c});const n=o.getQueryData(c);return o.setQueryData(c,i=>({...i,title:s.edTitle,memo:s.edContent,gbn:s.edGbn,date:s.edDate,html:i?.html==="sheet"?"sheet":s.htmlCheck,icon:s.iconCheck})),{previousMemoDetail:n,queryKey:c}},onError:(s,u,c)=>{c?.previousMemoDetail&&o.setQueryData(c.queryKey,c.previousMemoDetail),console.error("Error saving memo:",s)},onSuccess:({key:s})=>{const u=`/${t==="memo"?"m":t}/${s}`;g(u,{state:{reflash:!0}})},onSettled:({key:s,isNew:u}={})=>{const c=u?s:r;o.invalidateQueries({queryKey:["twTreeData",t]}),c&&o.invalidateQueries({queryKey:["memoDetail",t,l.uid,c]})}})};export{J as D,W as H,V as T,Y as u};
