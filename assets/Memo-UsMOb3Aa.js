const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MemoMain-BdstC3jh.js","assets/index-BYAZQ8R2.js","assets/index-B7dngQuI.css","assets/AniButton-v-vsa3Ju.js","assets/Button-BYF3W_UD.js"])))=>i.map(i=>d[i]);
import{r as a,a0 as me,a1 as ue,a2 as de,E as L,F as P,a3 as fe,q as G,v as Q,j as e,i as C,a4 as xe,T as ne,a5 as ge,a6 as he,a7 as pe,a8 as ve,a9 as we,aa as ye,p as je,w as Me,y as be,z as De,t as Se,ab as ke,N as $e,m as J,ac as Ie,C as Ce,H as Be,S as Te,P as Ee,M as Ne,ad as Re,ae as Fe,D as ae,J as _e,af as Le,o as X,x as Pe,ag as qe,R as He,O as Z,ah as We,U as Ke,V as Oe,W as Ye,$ as ze,X as Ae,Y as Ge,Z as ee}from"./index-BYAZQ8R2.js";import{M as Qe,a as Ve}from"./MemoMoveModal-CyIW9wEL.js";import{S as Ue}from"./SinyTree-COe2DUrE.js";import{C as Je}from"./CommonLayout-dMzUlhbq.js";import{H as ie,f as te,a as oe,b as Xe,e as Ze,d as et,g as tt}from"./fireDetail-KKLUVBUh.js";import{F as ot}from"./Favorite-Cez_-tXE.js";import{A as _}from"./AniButton-v-vsa3Ju.js";import{c as st}from"./CodeText-Bu7hV44O.js";import{u as nt,a as at}from"./use-spring-BXU7z2xx.js";import{u as it,g as rt}from"./useTreeData-DgiE6TFT.js";import"./TextField--U8wTNcl.js";import"./Collapse-i6702K5Q.js";import"./SinyDate-BcCWOyvu.js";import"./InputAdornment-B7xLKaH2.js";import"./Popper-CBt0xfau.js";import"./Button-BYF3W_UD.js";import"./Chip-DWeJ1F_G.js";import"./index.esm-quhieT8B.js";import"./datetime-BDx6lZXm.js";import"./useBaseQuery-CBtuKhA5.js";const lt=l=>{const[o,m]=a.useState([]),f=()=>{const r=me(L(P,`memo_txt/${l}`),de("bookmark"),ue("Y"));fe(r,c=>{if(!c.exists())return;const M=c.val(),x=[];for(let p in M){const u=M[p];u.key=p,x.push(u)}x.sort((p,u)=>p.title>u.title?1:-1),m(x)})};return a.useEffect(()=>{f()},[l]),o};function ct(l){const{user:o}=G(),m=Q(),f=lt(o?.uid);return o===void 0?e.jsx(e.Fragment,{}):e.jsxs(C,{sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"100%"},children:[e.jsx(xe,{}),e.jsx(ne,{children:"BookMark"}),f&&f.map((r,c)=>e.jsx("div",{children:e.jsx(ge,{component:"button",variant:"body",onClick:()=>{l.onSelected(r.key),m(`/memo/${r.key}`)},children:e.jsx(he,{variant:"body1",children:r.title})})},c))]})}var N={},se;function mt(){if(se)return N;se=1;var l=pe();Object.defineProperty(N,"__esModule",{value:!0}),N.default=void 0;var o=l(ve()),m=we();return N.default=(0,o.default)((0,m.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder"),N}var ut=mt();const dt=ye(ut),ft=l=>e.jsxs(C,{sx:{flexGrow:1,my:2,width:"100%",display:"grid",gridTemplateColumns:"64px 64px  64px  64px ",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:[e.jsx(_,{type:"button",size:"small",variant:"outlined",color:"success",onClick:l.onEdit,children:"수정"}),e.jsx(_,{type:"button",size:"small",variant:"outlined",onClick:l.onNewMemo,children:"새글"}),e.jsx(_,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:l.onMove,children:"이동"}),e.jsx(_,{type:"button",size:"small",variant:"outlined",color:"error",onClick:l.onDelete,children:"삭제"})]}),xt=l=>{const{title:o,gbn:m,date:f,text:r,image:c,setFireId:M,bookmark:x,setBookmark:p,isLoading:u,onReload:w}=je(),{scrollYProgress:d}=nt(),q=at(d,{stiffness:100,damping:30,restDelta:.001}),[y,v]=a.useState(!1),[H,b]=a.useState(!1),R=Q(),g=a.useRef(),F=a.useRef();F.current=l.searchWord;const{memoId:s}=Me(),n=be()?.state?.fullIndex,{user:t}=G();console.log("MemoDetail.memoId:",s);const{settings:D,saveSettings:j}=De(),W=()=>{g.current=!1,u===!1&&v(!0)},K=()=>{g.current=!0,u===!1&&v(!0)},B=async()=>{console.log("handleDelete.memoId=",s);const i=`memo_txt/${t.uid}/${s}`,h=await et(i,`memo/${t.uid}`);if(console.log("handleDelete.result=",h),h===void 0){alert("삭제에 실패했습니다.[code:d02]");return}R("/memo")},S=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&B()},T=()=>{v(!1)},O=()=>{b(!0)},k=()=>{const i=x==="Y"?"N":"Y";p(i),Re(t.uid,s,i)},Y=async i=>{console.log("onMoveSubmit.memoId",s),console.log("onMoveSubmit.moveId",i);try{const h=`memo_txt/${t.uid}/${s}`,$=`memo/${t.uid}`,E=await Ze(h,$,s,i);console.log("onMoveSubmit.result=",E)}catch(h){console.log("catch",h)}finally{b(!1)}},z=async(i,h)=>{const $=`memo_txt/${t.uid}/`,E=`memo/${t.uid}/`,I=await te(void 0,$,E,n,i);console.log("onNewSubmit.newKey=",I,", homeId=",s);const A=await oe("home_txt","home",I,h);console.log("onNewSubmit.imageResult",A),I!==void 0&&R(`/memo/${I}`),g.current=!1,v(!1),w()},re=async(i,h,$)=>{const E=`memo_txt/${t.uid}`,I=`memo/${t.uid}`,A=await Xe(E,I,s,h);console.log("onPostSubmit.imageDelete",A),await te(s,`memo_txt/${t.uid}/`,`memo/${t.uid}/`,n,i),console.log("onPostSubmit.files=",$);const ce=await oe(`memo_txt/${t.uid}`,`memo/${t.uid}`,s,$);if(console.log("onNewSubmit.imageResult",ce),console.log("onPostSubmit.fullIndex",n),n===void 0){const U=await Fe(t.uid,`${s}/fullIndex`);U!==void 0&&ae(L(P,`memo/${t.uid}/${U}/title`),i.edTitle)}g.current=!1,v(!1),w()};a.useEffect(()=>{if(o.current!==void 0){const i=document.querySelector("title");i.innerHTML=`${Se.templateName} :: ${o.current}`}},[o.current]),a.useEffect(()=>{t!=null&&s!==void 0&&(console.log("useEffect.user=",t),j({...D,nodeId:s}),n!==void 0&&ke(t.uid,s,n),M(`memo_txt/${t.uid}/${s}`,`memo/${t.uid}/${s}`,F.current)),v(!1)},[s,t]);function le(){document.querySelectorAll("pre").forEach(i=>{i.innerHTML=st(i.innerHTML)})}return a.useEffect(()=>{r!==null&&(le(),console.log("useEffect.detailText=",r))},[r]),s===""||t===void 0?e.jsx(e.Fragment,{}):e.jsxs($e.Fragment,{children:[e.jsx(J.div,{className:"progress-bar",style:{scaleX:q}}),e.jsxs(ne,{style:{display:"flex",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"space-between"},children:[e.jsx("div",{}),e.jsx("div",{children:o.current}),e.jsx(J.div,{whileHover:{scale:1.1},whileTap:{scale:.8},initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:.5,ease:[0,.71,.2,1.01],scale:{type:"spring",damping:2,stiffness:100,restDelta:.001}},children:e.jsx(Ie,{"aria-label":"bookmark",onClick:k,children:x==="Y"?e.jsx(ot,{sx:{color:"red"}}):e.jsx(dt,{})})})]}),e.jsxs(Ce,{className:"container",sx:{p:0,width:"100%"},children:[!y&&e.jsx(ft,{onEdit:W,onNewMemo:K,onMove:O,onDelete:S,onBookmark:k,bookmark:x}),y&&e.jsx(ie,{newMode:g.current,onPostSubmit:re,onNewSubmit:z,onCancel:T,title:o.current,gbn:m.current,date:f.current,content:r,imageList:c}),e.jsxs(C,{sx:{my:2},children:[e.jsx(Be,{show:!y,text:r}),!y&&e.jsx(Te,{imageList:c,show:!y}),u&&e.jsx(C,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx(Ee,{sx:{mt:5}})})]}),e.jsx(Qe,{userId:t?.uid,open:H,data:l.data,onClose:()=>b(!1),onPost:Y})]}),e.jsx(Ne,{})]})},gt=220,ht=a.lazy(async()=>await We(()=>import("./MemoMain-BdstC3jh.js"),__vite__mapDeps([0,1,2,3,4]))),Lt=()=>{const l=Q(),{user:o}=G(),[m,f]=a.useState(!1),r=a.useRef(),[c,M]=a.useState(""),[x,p]=a.useState(""),u=a.useRef(),w=a.useRef(!1),d=it({queryKey:["treeMemo",r.current],queryFn:()=>rt(o?.uid,r.current)});d.data!==void 0&&d.data!==""&&!w.current&&(console.log("setMemoData.tQuery.data=",d.data),w.current=!0,M(...d.data)),console.log("Memo.user=",w.current,o?.uid,", memoData=",c,", memoId=",x,", tQuery.isFetched=",d.isPending),a.useEffect(()=>{console.log("useEffect.memoData=",c)},[c]),a.useEffect(()=>{o!==void 0&&o!=null&&(console.log("useEffect.user=",o),d.refetch())},[o]);const q=n=>{console.log("onSearchDataBtn.v=",n),w.current=!1,r.current=n,d.refetch()},y=(n,t)=>{u.current=t,p(n),l(`/memo/${n}`,{state:{fullIndex:t}})},v=()=>{if(console.log("onNewMemoBtn.fullIndex",u),o===void 0){alert("로그인 후 이용 가능합니다.");return}f(!0)},H=()=>{f(!1)},b=async(n,t)=>{const D=`memo_txt/${o.uid}/`;for(let B=0;B<t.length;B++){const S=t[B].object,T=tt(S.name);console.log("onNewSubmit.file.name",S.name,"ext=",T);const O={ext:T,name:S.name,use:"Y"},k=Ke(Oe(L(P),D+"image")).key;console.log("onNewSubmit.image.newKey",k),ae(L(P,D+`image/${k}`),O);const Y=await Ye(ze,`memo/${o.uid}/${x}/${k}.${T}`),z=await Ae(Y,S);console.log("onNewSubmit.uploadBytes",z)}const j=Ge(D),W={title:n.edTitle,date:n.edDate,gbn:n.edGbn,memo:n.content,fullIndex:j,up:j,bookmark:"N"};ee(`${D}${j}`,W);const K={gbn:"",property:"m",title:n.edTitle,up:j};ee(`memo/${o.uid}/${j}`,K),f(!1)},R=n=>{console.log("onSelected=",n),p(n)},{height:g,width:F}=_e(),s=e.jsxs(C,{className:"memoSide",sx:{minHeight:110,flexGrow:1,minWidth:100,maxHeight:g},children:[e.jsx(Le,{smHidden:!1}),e.jsx(Ve,{onNewMemoBtn:v,onSearchDataBtn:q}),e.jsx(C,{sx:{flexGrow:1,minWidth:100,minHeight:110,maxHeight:g-220,height:g-220},children:w.current&&d.isFetched?e.jsx(Ue,{data:d.data,onDetail:y,maxHeight:g-150}):e.jsx(X,{})})]}),V=o&&o.uid===Pe?e.jsx(qe,{to:"/homemng",children:" 홈페이지 관리"}):"";return e.jsxs(Je,{title:"메모장",drawerWidth:gt,width:F,sideContents:s,children:[!m&&e.jsx(a.Suspense,{fallback:e.jsx(X,{}),children:e.jsxs(He,{children:[e.jsx(Z,{path:"/:memoId",element:e.jsx(xt,{searchWord:r.current,data:c})}),e.jsx(Z,{path:"*",element:e.jsx(ht,{searchWord:r.current,data:c,onNewMemoBtn:v,title:"메모장 홈"})})]})}),m&&e.jsx(ie,{show:m,newMode:m.current,onPostSubmit:b,onNewSubmit:b,onCancel:H,title:"",content:"",imageList:[]}),e.jsx(ct,{onSelected:R}),V]})};export{Lt as default};
