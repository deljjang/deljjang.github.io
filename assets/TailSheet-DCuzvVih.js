import{j as s,i as J,r as g,P as Y,cO as W,aJ as Q,q as X,o as ee,n as m,am as te,O as x,t as f,Y as oe,Z as ne,A as se}from"./index-BTQulWNG.js";import{I as le,L as re}from"./InputField-DhXHQ7rI.js";import{H as ae,r as ie}from"./registry-xF8iEqGC.js";import{D as ce}from"./datetime-BDx6lZXm.js";import{a as ue}from"./index.esm-CCH_oCxu.js";import{S as de}from"./Select-DmfnfuSk.js";import{n as me}from"./handson-DdAkNqUh.js";import{A as v}from"./AniButton-BrIreEWS.js";import"./Button-14YbiRkg.js";const fe=o=>s.jsxs(J,{sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[s.jsx(v,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:o.onInsert,children:"추가"}),s.jsx(v,{type:"button",size:"small",variant:"outlined",color:"error",onClick:o.onDelete,children:"삭제"}),s.jsx(v,{type:"button",size:"small",variant:"outlined",color:"success",onClick:o.onReload,children:"리로드"}),s.jsx(v,{type:"button",size:"small",variant:"outlined",onClick:o.onCsvSave,children:"csv저장"})]});ie();const ge=o=>{const{userId:u,baseUrl:I}=o,i=g.useRef(null),y=g.useRef(null),[p,$]=g.useState(),[B,j]=g.useState(0),{height:b}=Y(),{settings:D,changeColWidths:H}=W();console.log("SheetGrid.settings=",D);const N={edTitle:"",edDate:ce.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd")},{register:A,reset:xe,control:S,setValue:R,getValues:C,formState:{errors:O}}=ue({mode:"submit ",defaultValues:N}),{theme:T}=W(),U=T==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",V=async e=>{console.log("onFunPost.data=",e.id,e);const t=`${I}/${u}/`;if(e.id===void 0){const n=oe(ne(m(f),t)).key;console.log("onFunPost.newKey",n),e.id=n}return x(m(f,t+e.id+"/dv"),e.dv),x(m(f,t+e.id+"/title"),e.title),x(m(f,t+e.id+"/t1"),e.t1),x(m(f,t+e.id+"/t2"),e.t2),x(m(f,t+e.id+"/ing"),"1"),e},K=async()=>{const e=`${I}/${u}/`,t=X(m(f,e),ee("dv"));te(t,n=>{if(!n.exists())return;const r=n.val(),a=[];for(let c in r){const l=r[c];l.id=c,l.sort=`${l.dv}_${l.title}`,a.push(l)}a.sort((c,l)=>c.sort>l.sort?1:-1),$(a),j(a.length)})};g.useEffect(()=>{R("columns1",o.selectDefault)},[]),g.useEffect(()=>{u!==void 0&&K()},[u]),g.useEffect(()=>{i.current.hotInstance.addHook("afterColumnResize",function(t,n){const r=D.colWidths;console.log("afterColumnResize.col=",n,", colWidths=",r[n],", width=",t),r[n]=t,console.log("afterColumnResize.colWidths=",r),H(r)})},[i.current]);const _=async()=>{z()},L=async()=>{i.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:o.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},F=[],P={indicators:!0},k=[];o.columns.map((e,t)=>{e.select&&F.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&k.push(t)}),P.columns=k;const z=()=>{try{const e=i.current?.hotInstance,t=e?.getPlugin("filters");if(t){const n=C("columns1");console.log("onKeyUp.columns1=",n,"text=",C("filterField1")),o.columns.forEach((c,l)=>{t?.removeConditions(l)}),t?.addCondition(Number(n),"contains",[C("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",i.current);const a=e.getData().length;j(a)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function M(){const e=i.current.hotInstance;console.log("onInsert:",e),e.alter("insert_row_above",0,1)}const G=async(e,t)=>{if(console.log("afterChange.change=",e,", source=",t,", change.length=",e?.length),e!==null){const n=i.current?.hotInstance;if(n?.getPlugin("filters")){const a=n.getData(),c=[];e.forEach((l,w)=>{const h={};console.log("afterChange.index1=",w,", item1=",l[0]),o.columns.forEach((d,Z)=>{console.log("afterChange.filteredData=",a[l[0]],d),h[d.data]=a[l[0]][Z]}),console.log("afterChange.tmp=",h),c.push(h)}),console.log("afterChange.saveData=",c),c.forEach(async(l,w)=>{console.log("afterChange.item=",l);const h=await V(l);console.log("afterChange.result=",w,", result=",h),p.map(d=>{(d.id===void 0||d.id===null)&&(console.log("afterChange.rowData1=",d),d.id=h?.id,console.log("afterChange.rowData2=",d))})}),n.render()}}},q=async()=>{const e=i.current.hotInstance;if(console.log("onDelete:",e),e&&y.current!==null){if(e?.getPlugin("filters")){const n=e.getData();console.log("onDelete.filteredData=",n[y.current]);const r=n[y.current][o.keyId];console.log("onDelete.deleteId=",r),window.confirm("삭제하시겠습니까?")&&x(m(f,`${o.baseUrl}/${u}/${r}`),null)}e.alter("remove_row",y.current,1)}},E=e=>{const t=e.target.value;console.log("onChange.target=",e.target.value),R(e.target.name,t)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[s.jsx(de,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",mdSize:3,control:S,className:"dark:bg-dark-900",defaultValue:o.selectDefault?o.selectDefault:"1",options:F,error:!!O.columns1,onChange:E}),s.jsx(le,{...A("filterField1"),name:"filterField1",control:S,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",size:"small",mdSize:9,fullWidth:!0,onKeyUp:z,onChange:E})]}),s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[s.jsx(Q,{textAlign:"left",children:"건수 : "+me(B)}),s.jsx(fe,{onInsert:M,onDelete:q,onReload:_,onCsvSave:L})]}),s.jsx("div",{style:{maxHeight:`${b}- 200`,overflow:"auto"},children:s.jsx(ae,{ref:i,data:p,themeName:U,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:b-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:G,afterSelection:e=>{y.current=e},licenseKey:"non-commercial-and-evaluation",columns:o.columns,cells:(e,t)=>o.columns[t].readOnly===!0?{readOnly:!0}:{},colWidths:D.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:P})})]})};function Se(){const{user:o}=se(),u=[{title:"구분",data:"dv",readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"설명1",type:"text",data:"t1",select:!0},{title:"설명2",type:"text",data:"t2",select:!0},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"진행중",type:"text",data:"ing",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];return!o||o?.uid===void 0?s.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:s.jsx(re,{children:"로그인을 해야 이용 가능합니다."})}):s.jsx(ge,{csvFileName:"exported_sheet",baseUrl:"sheet",columns:u,selectDefault:"1",keyId:u.length-1,userId:o?.uid})}export{Se as default};
