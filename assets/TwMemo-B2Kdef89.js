const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BB4k5DkR.js","assets/index-CveK3EXj.js","assets/index-DA9f9bpU.css","assets/SinySelect-DinddYlj.js","assets/TextField-o4VYhwzB.js","assets/InputAdornment-DsJbVzqg.js","assets/Popper-C1fzfSra.js","assets/Chip-k1nngnL5.js","assets/index.esm-BLkPCil9.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-B9bxqloy.js","assets/TwButton-DvJVcHnB.js"])))=>i.map(i=>d[i]);
import{r as g,j as e,p as De,u as I,L as D,D as G,g as U,S as J,T as Q,P as M,t as X,v as W,d as P,w as Z,x as ee,H as te,y as Se,z as Le,C as Me,E as se,F as Ie,G as Re,J as H,K as B,N as re,_ as ae,i as Ee,q as oe,e as _e,o as Be,a as ne,f as ie,m as le,c as ce,a1 as Fe,a2 as Ye,a3 as Pe,n as q,a4 as He,Q as We,R as F,U as Ae,V as Oe,W as qe,X as Y,Y as ze,$ as Ke}from"./index-CveK3EXj.js";import{T as C}from"./TwButton-DvJVcHnB.js";import{I as Ve,T as Ge}from"./TextField-o4VYhwzB.js";import{E as de,C as me}from"./ExpandMore-D5oADhKh.js";import{T as Ue}from"./TailLayout-Cuz5UnlZ.js";import{F as Je}from"./Favorite-dwdyu1-w.js";import{u as ue,a as ge,F as Qe,b as Xe,D as Ze,l as et,I as tt,s as z,d as K,e as st,T as rt}from"./index-BB4k5DkR.js";import{D as at}from"./datetime-BDx6lZXm.js";import{u as ot}from"./index.esm-BLkPCil9.js";import"./index-CLQ_oLGC.js";import{S as nt,a as it}from"./SinySelect-DinddYlj.js";import"./chevron-down-njps9-xg.js";import"./InputAdornment-DsJbVzqg.js";import"./Popper-C1fzfSra.js";import"./Chip-k1nngnL5.js";const lt=s=>{const r=g.useRef(null);function i(){s.onSearchDataBtn(r.current.value)}function t(){return s.onNewMemoBtn(),!1}function m(o){o.which===13&&i()}return e.jsxs(e.Fragment,{children:[e.jsx(Ve,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:r,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:m}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(C,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:t,children:"새글"}),e.jsx(C,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:i,children:"조회"})]})]})};function ct({initTreeData:s,userId:r}){const[i,t]=g.useState(s),{isMoble:m,height:o,width:n}=De(),f=(a,c)=>{if(console.log("=== Drag & Drop Event ==="),console.log("dragSource:",c.dragSource),console.log("dragSource.id:",c.dragSource.id),console.log("dropTargetId:",c.dropTargetId),console.log("========================"),c.dragSource.id!==void 0&&c.dropTargetId!==void 0){const h=`memo_tree/${r}/${c.dragSource.id}/parent`;M(h,c.dropTargetId),console.log("loc=",h)}t(a)},d=I();if(g.useEffect(()=>{(async()=>{const c=[];if(s)for(const h of s){const x={id:h.key,text:h.title,droppable:!0,parent:h.parent};c.push(x)}for(const h of c){const x=h.id;h.cnt=c.filter(v=>v.parent===x).length}t(c)})()},[s]),i==null||i.length===0)return e.jsx(D,{});const l=a=>{console.log("node",a),d(`/m/${a.id}`)};return e.jsx(G,{backend:J,options:U(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:o-220-(m?56:0)+(n>1024?60:0),width:"100%"},children:e.jsx(Q,{tree:i,rootId:"root",onDrop:f,render:(a,{depth:c,isOpen:h,onToggle:x,isDragging:v,isDropTarget:y})=>e.jsxs("div",{className:`w-63 flex items-center justify-between rounded-sm
          text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ${v?"opacity-50":""} ${y?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"}`,style:{paddingLeft:c*20+(a.cnt===0?5:0)},onClick:()=>l(a),children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[a.cnt>0&&e.jsx("div",{onClick:x,children:h?e.jsx(de,{}):e.jsx(me,{})}),e.jsx("div",{className:"truncate pr-2",children:a.text})]}),a.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",a.cnt,")"]})]})})})})}const dt=s=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(C,{size:"sm",variant:"outlined",color:"success",onClick:s.onEdit,children:"수정"}),e.jsx(C,{size:"sm",variant:"outlined",color:"warning",onClick:s.onNewMemo,children:"새글"}),e.jsx(C,{size:"sm",variant:"outlined",color:"error",onClick:s.onDelete,children:"삭제"})]}),mt=s=>{const{rootDb:r,isLoading:i,memoDetailData:t}=s,{scrollYProgress:m}=ue(),o=ge(m,{stiffness:100,damping:30,restDelta:.001}),[n,f]=g.useState(!1),d=I(),l=g.useRef();l.current=s.searchWord;const{memoId:a}=X(),h=W()?.state?.fullIndex,{user:x}=P(),v=()=>{const j=`/${r==="memo"?"m":r}/edit/${a}`;d(j,{state:{fullIndex:h}})},y=()=>{const j=`/${r==="memo"?"m":r}/insert/${a}`;d(j,{state:{fullIndex:h}})},k=async()=>{const j=r==="memo"?`${r}_txt/${x.uid}/${a}`:`${r}_txt/${a}`,p=r==="memo"?`${r}_tree/${x.uid}`:r;if(await Xe(j,p)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}s.onTreeUpdate(),d(`/${r==="memo"?"m":r}`)},w=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&k()},T=()=>{s.onBookmark()};return g.useEffect(()=>{t&&t.title!==void 0&&Z({title:t.title,description:t.title});function j(){window.scrollTo({top:0}),t&&t.html!=="N"&&document.querySelectorAll("pre").forEach(p=>{p.innerHTML=Ie(p.innerHTML)})}t&&t.memo!==null&&j()},[t]),i?e.jsx(D,{}):a===""||x===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(ee.div,{className:"progress-bar",style:{scaleX:o}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:t&&t.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:T,children:t&&t.bookmark==="Y"?e.jsx(Je,{className:"text-red-500"}):e.jsx(Qe,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s.pathNm})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(dt,{rootDb:r,onEdit:v,onNewMemo:y,onDelete:w,bookmark:t&&t.bookmark}),e.jsxs("div",{className:"my-4",children:[t&&t.html==="N"?e.jsx(te,{postData:t&&t.memo}):t&&t.html!=="N"&&t.memo&&e.jsx(Se,{text:t.memo}),e.jsx(Le,{imageList:t&&t.image}),!t&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Me,{})})})]})]}),e.jsx(se,{})]})},ut=({onSubmit:s,onCancel:r,isSubmitting:i,newMode:t})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(C,{variant:"outlined",color:"success",disabled:i,onClick:m=>{m.preventDefault(),s(m)},children:[t?"새글":""," 저장"]}),e.jsx(C,{variant:"outlined",color:"error",onClick:r,children:"취소"})]});g.forwardRef((s,r)=>{const{id:i,label:t,defaultValue:m,onChange:o,className:n="",...f}=s,d=l=>{o&&o(l.target.value)};return e.jsxs("div",{className:` ${n}`,children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:i,children:t}),e.jsx("input",{ref:r,type:"date",id:i,defaultValue:m,onChange:d,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...f})]})});const gt=({label:s,checked:r,id:i,onChange:t,className:m="",disabled:o=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${o?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:i,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${m}`,checked:r,onChange:n=>t(n.target.checked),disabled:o}),r&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),o&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:s})]}),xt=g.forwardRef((s,r)=>{const{placeholder:i="Enter your message",rows:t=3,value:m="",onChange:o,className:n="",disabled:f=!1,error:d=!1,hint:l=""}=s,a=h=>{o&&o(h.target.value)};let c=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${n} `;return f?c+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":d?c+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":c+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:r,placeholder:i,rows:t,value:m,onChange:a,disabled:f,className:c}),l&&e.jsx("p",{className:`mt-2 text-sm ${d?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:l})]})}),ht=g.lazy(()=>ae(()=>import("./index-BB4k5DkR.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])));et.Quill.register("modules/imageDrop",tt);re.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const ft={syntax:{highlight:s=>re.highlightAuto(s).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},vt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],jt=s=>{const[r,i]=g.useState(s.imageList),[t,m]=g.useState(s.htmlCheck==="Y"),[o,n]=g.useState(s.newMode?"":s.content),f=g.useRef(),d=g.useRef(),l=g.useRef(null);g.useRef(null);const a=g.useRef(null),c=s.newMode,h=g.useRef([]),{height:x}=Re(),v=at.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),y={edTitle:c?"":s.title,edGbn:s.gbn?s.gbn:"etc",edDate:c?v:s.date,content:c?"":s.content,memoTxt:c?"":s.content,htmlCheck:s.htmlCheck},{register:k,handleSubmit:w,trigger:T,control:j,setValue:p,getValues:N,watch:S,formState:{errors:$,isSubmitting:E}}=ot({mode:"onChange",defaultValues:y});g.useEffect(()=>{k("edDate"),k("edGbn",{required:!0}),k("htmlCheck"),k("memoTxt")},[]),g.useEffect(()=>{h.current=[],f.current=s.content,d.current=!1},[s.content]);const L=async u=>{c?await s.onNewSubmit(u,h.current):await s.onPostSubmit(u,r,h.current)},he=()=>{w(L)()},fe=u=>{console.log("onDelete.imageList=",u),i(u)},ve=u=>{let b=f.current;u.ext==="jpg"?b+=`<img src='${u.url}'/>`:u.ext==="mp4"&&(b+=`<video preload="auto" controls="" src='${u.url}'></video>`),f.current=b},je=u=>{f.current=u},ke=u=>{console.log("handleFileUpload",u),h.current=u};function pe(u){f.current=u,p("content",u),T("content")}function be(u,b){console.log("handleChangeDate=",u),console.log("handleChangeDate.currentDateString=",b);let R=H(u);console.log("handleChangeDate.dayjs=",R.format("YYYY-MM-DD HH:mm:ss")),p("edDate",R.format("YYYY-MM-DD")),T("edDate")}const ye=u=>{console.log("onChecked=",u),p("htmlCheck",u?"Y":"N"),m(u)},we=S("content"),Ne=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Te=["React","JavaScript","Bash","Java","Kotlin","CSS","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],$e=u=>{const b=l.current;if(b){const R=b.selectionStart,Ce=b.selectionEnd,A=o.slice(0,R),O=o.slice(Ce);n(A+u+O),p("memoTxt",A+u+O),setTimeout(()=>{b.selectionStart=b.selectionEnd=R+u.length,b.focus()},0)}},_=u=>{$e(u)};return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:w(L),style:{width:"100%",minHeight:"300px",maxHeight:{height:x},display:"flex",flexDirection:"column"},children:[e.jsx(ut,{onSubmit:u=>he(),onCancel:s.onCancel,isSubmitting:E,newMode:c}),e.jsx(Ze,{control:j,onDelete:fe,onInsert:ve,setContent:je,onFileUpload:ke,imageList:s.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(Ge,{...k("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!$.edTitle})}),e.jsx(nt,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:j,defaultValue:N("edGbn"),selectList:Ne,error:!!$.edGbn,onChange:u=>{u.preventDefault();const b=u.target.value;console.log("edGbn=",N("edGbn")),p("edGbn",b)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(it,{id:"edDate",label:"일자",value:H(N("edDate")),...k("edDate"),defaultValue:H(N("edDate")),onChange:(u,b)=>{be(u,b)}}),e.jsx(gt,{id:"html",checked:t,onChange:ye,label:"HTML사용"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-130 overflow-y-scroll",children:e.jsx(te,{postData:o})}),e.jsxs("div",{children:[e.jsx(xt,{ref:l,className:"",value:o,onChange:u=>{p("memoTxt",u),n(u)},rows:22}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(B,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_("<box></box>"),children:"<Box>"}),e.jsx(B,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_("</code>"),children:"</code>"}),Te.map((u,b)=>e.jsx(B,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_("<code>"+u+"</code>"),children:u},b)),e.jsx(B,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_('<a href="" target="_blank"></a>'),children:"Link"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"})]})]}),e.jsx(g.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(ht,{ref:a,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:we,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:ft,formats:vt,onChange:pe})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},V=s=>{const{rootDb:r,isLoading:i,memoDetailData:t}=s,{scrollYProgress:m}=ue();ge(m,{stiffness:100,damping:30,restDelta:.001});const o=I(),n=g.useRef(),f=g.useRef();f.current=s.searchWord;const{memoId:d}=X(),l=W(),{user:a}=P();n.current=l.pathname.split("/")[2]==="insert",console.log("memoDetailData=",t?.title),console.log("newMode=",n.current,", memoId=",d);const c=()=>{const v=`/${r==="memo"?"m":r}/${d==="insert"?"":d}`;o(v)},h=async(v,y)=>{console.log("onNewSubmit.values",v);const k=await z({rootDb:r,uid:a.uid,newData:n.current,key:d==="insert"?"root":d,values:v});if(await K(`${r}_txt`,r,k,y),k!==void 0){const w=`/${r==="memo"?"m":r}/${k}`;o(w,{state:{reflash:!0}})}},x=async(v,y,k)=>{const w=r==="memo"?`${r}_txt/${a.uid}/`:`${r}_txt/`,T=r==="memo"?`${r}_tree/${a.uid}/`:`${r}/`;await st(w,T,d,y),console.log("onPostSubmit.values",v);const j=await z({rootDb:r,uid:a.uid,newData:n.current,key:d==="insert"?"root":d,values:v});console.log("onPostSubmit.newKey=",j),console.log("onPostSubmit.files=",k);const p=await K(`${w}/`,r==="memo"?`${r}/${a.uid}/`:`${r}/`,d,k);console.log("onNewSubmit.imageResult",p),r==="memo"&&M(`memo_tree/${a.uid}/${d}/title`,v.edTitle),n.current=!1;const N=`/${r==="memo"?"m":r}/${d}`;o(N,{state:{reflash:!0}})};return g.useEffect(()=>{t&&t.title!==void 0&&Z({title:t.title,description:t.title});function v(){document.querySelectorAll("pre").forEach((y,k)=>{})}t&&t.memo!==null&&v()},[t]),d===""||a===void 0?e.jsx(e.Fragment,{}):t===void 0||i?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full p-0 m-0",children:n.current===!1&&t&&(t.title===void 0||t.title===""||t.title===null)?e.jsx(D,{}):e.jsx(jt,{newMode:n.current,onPostSubmit:x,onNewSubmit:h,onCancel:c,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html:"Y",content:t?.memo,imageList:t?.image})}),e.jsx(se,{})]})};function kt({initTreeData:s}){const[r,i]=g.useState(),t=n=>i(n),m=I();if(g.useEffect(()=>{i(s)},[s]),r==null||r.length===0)return e.jsx(D,{});const o=n=>{console.log("node",n),m(`/m/${n.id}`)};return e.jsx(G,{backend:J,options:U(),children:e.jsx(Q,{tree:r,rootId:"root",onDrop:t,render:(n,{depth:f,isOpen:d,onToggle:l})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:f*20+(n.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[n.cnt>0&&e.jsx("div",{onClick:l,children:d?e.jsx(de,{}):e.jsx(me,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>o(n),children:n.text})]}),n.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",n.cnt,")"]})]})})})}function pt(s){const{user:r}=P(),i=I(),[t,m]=g.useState(),[o,n]=g.useState(),f=async d=>{const l=[],a=oe(ne(ie,`memo_tree/${d}`),Be("bm"),_e("Y")),c=await le(a);if(!c.exists()){console.log("getFireText.null");return}const h=c.val();for(let x in h){const v=h[x];v.id=x,v.key=x,v.text=v.title,l.push(v)}l.sort((x,v)=>x.title>v.title?1:-1),m([...l])};return g.useEffect(()=>{r!==void 0&&r!=null&&f(r?.uid)},[r]),g.useEffect(()=>{const d=async(l,a)=>{const c=[...a];if(a)for(const h of a){let x=h;for(;x.parent!=="root";){x.parent,x=await ce(`memo_tree/${l}/${x.parent}`);const v={id:x.key,text:x.title,droppable:!1,parent:x.parent};c.filter(k=>k.id===v.id).length===0&&c.push(v)}}for(const h of c){const x=h.id;h.cnt=c.filter(v=>v.parent===x).length}n(c)};t&&t.length>0&&d(r?.uid,t)},[t]),r===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Ee,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:t&&t.map((d,l)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{s.onSelected(d.key),i(`/m/${d.key}`)},children:e.jsx("span",{className:"text-base",children:d.title})})},l))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),o===void 0||o===null&&e.jsx(Loading,{}),o&&o.length===0?e.jsx("div",{className:"m-4 text-gray-500",children:"No BookMark"}):e.jsx(kt,{initTreeData:o,uid:r?.uid})]})}const bt=async(s,r,i)=>{let t=new Array;for(let m in i){const o=i[m];try{if(o.key=m,o.url===void 0){const n=await Fe(Ye,`${r}/${m}.${o.ext}`),f=await Pe(n);o.url=f,M(`${s}/image/${m}/url`,f)}t.push(o)}catch(n){console.log("getImageList.catch",n)}}return t},yt=async(s,r,i,t)=>{let m="",o="",n={};((l,a,c)=>{o=l==="memo"?`${l}/${a}/${c}`:`${l}/${c}`,m=l==="memo"?`${l}_txt/${a}/${c}`:`${l}_txt/${c}`})(s,r,i);async function d(){if(m===void 0)return"";if(n=await ce(m),n===void 0)return console.log("No data available"),"";if(n?.fullIndex,n.image!==void 0&&n.image!==null){const l=await bt(m,o,n.image);n.image=l,(n.imageOK===void 0||n.imageOK==="N")&&(l&&l.map(a=>{a.ext==="jpg"&&(n.memo=n.memo+`<img src='${a.url}'>`)}),M(`${m}/imageOK`,"Y"),M(`${m}/memo`,n.memo))}if(t!==void 0&&t!==""){const l=t,a=new RegExp(l,"gi"),c=n.memo.replace(a,`<span class='lightext'>${l}</span>`);n.memo=c}}return await d(),n};async function wt(s,r,i=""){if(r==null||r==="")return"";let t=i===""?`${s}_tree/${r}`:`${s}_txt/${r}`;s==="home"&&(t="home_txt");const m=oe(ne(ie,t)),o=await le(m);if(!o.exists())return console.log("getTreeData.null"),null;if(!o.exists())return console.log("getTreeData.exists"),null;const n=o.val(),f=[],d={};s==="home"&&(q.map(l=>{f.push({title:l.label,id:l.id,sub:[]})}),q.map(l=>{d[l.id]=[]}));for(const l in n){const a=n[l];a.up===void 0?(a.id=l,a.fullIndex=l):(a.id=a.up,a.fullIndex=a.up),s==="home"?a.gbn!==void 0&&d[a.gbn].push(a):i===""||i===void 0?f.push(a):(a.id=l,(a.memo+"").toLowerCase().indexOf(i.toLowerCase())>-1&&f.push(a))}return s==="home"?Object.values(d).map((l,a)=>{l.sort((c,h)=>c.title>h.title?1:-1),f[a].sub=l}):f.sort((l,a)=>l.title>a.title?1:-1),f}const Nt=s=>e.jsx(ee.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(He,{to:s.to,className:"text-inherit no-underline cursor-pointer",...s,children:e.jsx(rt,{children:s.children})})}),Tt=g.lazy(async()=>await ae(()=>import("./TwMemoMain-B9bxqloy.js"),__vite__mapDeps([10,1,2,11]))),$t=({rootDb:s})=>{const r=I(),{user:i}=P(),t=g.useRef(),m=g.useRef(),o=g.useRef(!0),n=g.useRef(),f=g.useRef(),[d,l]=g.useState(),a=g.useRef(!1),c=W(),h=g.useRef(!1);h.current=c?.state?.reflash===!0;const x=We({queryKey:["twTreeData",i?.uid,t.current],queryFn:()=>wt(s,i?.uid,t.current)});x.data!==void 0&&x.data!==""&&!a.current&&(a.current=!0);const v=()=>{const j=d;j&&(j.bookmark=j.bookmark==="Y"?"N":"Y");const p=`memo_tree/${i.uid}/${f.current}/bm`;M(p,d.bookmark),l({...d,bookmark:j.bookmark})};g.useEffect(()=>{i!==void 0&&i!=null&&x.refetch()},[i]),g.useEffect(()=>{const j=async S=>{if(S!==""&&i){const $=await yt(s,i?.uid,S,t.current);{const E=xe(x.data,{id:"",nm:""},S),L=E.id;m.current=E.nm,L!==n&&(n.current=L,Ke(i.uid,S,L))}$!==void 0&&$?.bookmark===void 0&&($.bookmark="N"),o.current=!1,l($===void 0?{}:$)}},p=c.pathname.split("/"),N=p.length>2?p[p.length-1]:"";o.current=!0,j(N),f.current=N},[c.pathname,i]),g.useEffect(()=>{i!==void 0&&i!=null&&x.refetch()},[h.current]);const y=j=>{a.current=!1,j!==void 0&&(t.current=j),x.refetch()},k=()=>{if(i==null){alert("로그인 후 이용 가능합니다.");return}const j=`/${s==="memo"?"m":s}/insert/insert`;r(j)},w=j=>{},T=e.jsxs("div",{className:"",children:[e.jsx("div",{className:"mt-3",children:e.jsx(Nt,{to:"/m",children:s==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[e.jsx(F,{to:"/",children:"홈"}),s==="memo"?"":e.jsx(F,{to:"/m",children:"메모"}),e.jsx(F,{to:"/todo",children:"TODO"}),e.jsx(F,{to:"/tail",children:"Sheet"})]}),e.jsx(lt,{onNewMemoBtn:k,onSearchDataBtn:y}),a.current&&x.isFetched?e.jsx(ct,{expandIndex:n.current,initTreeData:x.data,userId:i?.uid}):e.jsx(D,{})]});return i&&i.uid===Ae&&Oe,e.jsxs(Ue,{sideType:"memo",title:s==="memo"?"메모장":"홈페이지관리",sideContents:T,children:[e.jsx(g.Suspense,{fallback:e.jsx(D,{}),children:e.jsxs(qe,{children:[e.jsx(Y,{path:"/edit/:memoId",element:e.jsx(V,{rootDb:s,isLoading:o.current,searchWord:t.current,memoDetailData:d})}),e.jsx(Y,{path:"/insert/:memoId",element:e.jsx(V,{rootDb:s,isLoading:o.current,searchWord:t.current,memoDetailData:d})}),e.jsx(Y,{path:"/:memoId",element:e.jsx(mt,{rootDb:s,isLoading:o.current,searchWord:t.current,memoDetailData:d,onTreeUpdate:y,pathNm:m.current,onBookmark:v,data:x.data})}),e.jsx(Y,{path:"*",element:e.jsx(Tt,{searchWord:t.current,data:x.data,onNewMemoBtn:k,title:s==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),s==="memo"?e.jsx(pt,{onSelected:w}):"",e.jsx(ze,{})]})},xe=(s,r,i)=>{let t={};if(s)for(let m=0;m<s.length;m++){const o=s[m];if(o.id===i)return t.id=r.id+o.id,t.nm=r.nm+o.title,t;if(o.sub!==null&&o.sub!==void 0){if(t.id=r.id+o.id+"/sub/",t.nm=r.nm+o.title+" > ",t=xe(Object.values(o.sub),t,i),t.id&&t.id.endsWith(i))return t;t={}}}return t},At=()=>e.jsx($t,{rootDb:"memo"});export{At as default};
