import{h as F,N as z,d8 as q,j as e,ci as B,bd as A,w as k,I as M,bf as f,p as H,o as R,r as g,s as U,z as D,A as E,bo as W,H as G,bp as K,bq as Y,G as _}from"./index-C4WIA6Na.js";import{T as J}from"./TwLoading-De2bPXv1.js";import{L as Q}from"./PdfFileViewer-D-4gGxod.js";import{C as X}from"./ComponentCard-T5JUoR8b.js";import{M as Z,T as O,a as ee}from"./MemoComm-aj8dP3OK.js";import"./HtmlText-DyXyezkd.js";import"./index-DggyxaIh.js";/* empty css                   */import"./HomeChartSemiDonut-DbxvGAhY.js";import"./Favorite-CJlRt2dS.js";import"./fireMemoDetail-Ry2V5SE4.js";import"./angle-right-Cr6z-2Vg.js";import"./HtmlCode-rP8WK30v.js";import"./copy-DTKBtT8u.js";import"./TwBadge-TcJMZDb_.js";import"./TwRadio-D7cP3_Jd.js";import"./toPropertyKey-DCwh5dYN.js";import"./SinyImageList-DFE5mpl4.js";import"./ImageListItem-74cznh1q.js";import"./CodeText-fQ5GqSrQ.js";/* empty css                   */import"./AniButton-C8QIRItU.js";import"./Button-B_5WrTR-.js";import"./Card-C_dJ0Fde.js";import"./CardContent-BZl4oppS.js";import"./SinySelect-BiAMtX4Y.js";import"./Grid-C72FCnIe.js";import"./index-B-Up42r9.js";import"./TextField-DEjWOrjx.js";import"./InputAdornment-CrP39zXw.js";import"./Popper-uKfB3i6Y.js";import"./Chip-BAFqrVz0.js";import"./TwCheckbox-FxYYcPR7.js";import"./TwTextArea-BF6BWSpK.js";import"./IpInfo-CLmJTyJ0.js";const te=({isOpen:C,onClose:c,onCreate:r})=>{const y={visible:{opacity:1},hidden:{opacity:0}},w={hidden:{y:"-50px",opacity:0,scale:.95},visible:{y:"0",opacity:1,scale:1,transition:{duration:.2,ease:"easeOut"}},exit:{y:"50px",opacity:0,scale:.95,transition:{duration:.15,ease:"easeIn"}}},{t:a}=F(),{register:N,control:p,handleSubmit:S,formState:{errors:v}}=z({defaultValues:{title:"",columns:[{title:"col_0",type:"text",width:100,data:"col_0"},{title:"col_1",type:"text",width:100,data:"col_1"},{title:"col_2",type:"text",width:100,data:"col_2"}]}}),{fields:u,append:j,remove:$}=q({control:p,name:"columns"}),b=[{value:"text",label:a("column_type_text")},{value:"numeric",label:a("column_type_numeric")},{value:"date",label:a("column_type_date")},{value:"checkbox",label:a("column_type_checkbox")}],L=o=>{if(!o.title||o.title.trim()===""){alert(a("sheet_title_required"));return}const h={...o,columns:o.columns.map((i,T)=>i.data&&(i.data==="id"||i.data==="title"||i.data==="description")?i:{...i,data:(i.title||"").toLowerCase().replace(/\s+/g,"_")||`col_${T}`})};r(h)};return e.jsx(B,{children:C&&e.jsx(A.div,{className:"fixed inset-0 bg-black/70 bg-opacity-50 z-180 flex justify-center items-center",variants:y,initial:"hidden",animate:"visible",exit:"hidden",children:e.jsx(A.div,{variants:w,initial:"hidden",animate:"visible",exit:"exit",onClick:o=>o.stopPropagation(),children:e.jsx(Z,{isDraggable:!0,className:"w-full max-w-sm sm:max-w-xl max-h-[61vh] overflow-y-auto",title:a("create_new_sheet"),children:e.jsxs("form",{onSubmit:S(L),children:[e.jsx("div",{className:"mb-4",children:e.jsx(O,{...N("title",{required:a("sheet_title_required")}),label:a("sheet_title"),placeholder:a("sheet_title_placeholder"),error:!!v.title,helperText:v.title?.message})}),e.jsx("h3",{className:"text-md font-semibold mb-2",children:a("columns")}),e.jsx("div",{className:"space-y-3",children:u.map((o,h)=>e.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-5 gap-2 items-center p-2 ${k.border} rounded-md`,children:[e.jsx("div",{className:"sm:col-span-2",children:e.jsx(M,{name:`columns.${h}.title`,control:p,defaultValue:o.title,render:({field:i})=>e.jsx(O,{...i,placeholder:a("column_title")})})}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(M,{name:`columns.${h}.type`,control:p,defaultValue:o.type,render:({field:i})=>e.jsx(ee,{...i,options:b,className:"dark:bg-gray-700"})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(f,{type:"button",size:"sm",color:"warning",onClick:()=>$(h),disabled:u.length<=1,children:a("delete")})})]},o.id))}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(f,{type:"button",onClick:()=>j({title:"",type:"text",data:""}),children:a("add_column")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"button",variant:"outlined",onClick:c,children:a("cancel")}),e.jsx(f,{type:"submit",children:a("create")})]})]})]})})})})})};function Ie(){const C=t=>{if(!t)return"";const s=new Date(t),d=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),x=String(s.getDate()).padStart(2,"0"),l=String(s.getHours()).padStart(2,"0"),m=String(s.getMinutes()).padStart(2,"0");return`${d}-${n}-${x} ${l}:${m}`},{user:c}=H(),{t:r}=F(),y=R(),[w,a]=g.useState(null),[N,p]=g.useState(!1),[S,v]=g.useState(null),[u,j]=g.useState(""),[$,b]=g.useState({isOpen:!1});g.useEffect(()=>{U({title:r("appSheet"),description:r("appSheet")})},[]),g.useEffect(()=>{if(c){const t=D(E,`memo_sheet/${c.uid}`),s=W(t,d=>{const n=d.val(),x=n?Object.keys(n).map(l=>{const m=n[l];return{id:l,...m}}):[];x.sort((l,m)=>(m.createdAt||0)-(l.createdAt||0)),a(x)});return()=>s()}},[c]);const L=async t=>{console.log("handleCreateSheet.sheetData=",t);const s=`memo_sheet/${c.uid}`,d=K(Y(D(E),s)).key,n={title:t.title,columns:t.columns,createdAt:Date.now()};_(`${s}/${d}`,n);const x=`memo_sheet_data/${c.uid}/${d}/data`,l={id:0,createdAt:Date.now()};t.columns.forEach(m=>{m.data!=="id"&&m.data!=="createdAt"&&(l[m.data]="")}),_(`${x}/0`,l),l.id=1,_(`${x}/1`,l),p(!1),y(`/m/sheet/${d}`)},o=t=>{y(`/m/sheet/${t}`)},h=async t=>{_(`memo_sheet/${c.uid}/${t}`,null),b({isOpen:!1}),y("/m")},i=async(t,s)=>{s.stopPropagation(),b({isOpen:!0,title:r("delete_confirm_title"),message:r("delete_confirm_message"),color:"warning",onConfirm:()=>{h(t)},onClose:()=>b({isOpen:!1})})},T=(t,s)=>{s.stopPropagation(),v(t.id),j(t.title)},I=t=>{t.stopPropagation(),v(null),j("")},P=async(t,s)=>{if(s.stopPropagation(),!u.trim()){alert(r("sheet_title_required"));return}await _(`memo_sheet/${c.uid}/${t}/title`,u),a(d=>d.map(n=>n.id===t?{...n,title:u}:n)),v(null),j("")};if(c===void 0||w==null)return e.jsx(J,{});const V=e.jsxs("div",{className:`${k.between}`,children:[e.jsx(G,{className:"text-md",children:r("memo_sheet_list")}),e.jsx(f,{variant:"ghost",onClick:()=>p(!0),children:r("create_new_sheet")})]});return e.jsxs(X,{title:V,className:"my-5",children:[e.jsx(Q,{...$}),e.jsx(te,{isOpen:N,onClose:()=>p(!1),onCreate:L}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:w.map(t=>e.jsx("div",{onClick:()=>S!==t.id&&o(t.id),className:`relative p-4 ${k.border} ${k.roundedSm} cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 group`,children:S===t.id?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:s=>j(s.target.value),onClick:s=>s.stopPropagation(),className:"border p-2 rounded-md dark:bg-gray-700",autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{size:"sm",variant:"outlined",onClick:I,children:r("cancel")}),e.jsx(f,{size:"sm",onClick:s=>P(t.id,s),children:r("save")})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative h-8",children:[" ",e.jsx("h6",{className:"absolute font-semibold pr-16 transition-transform duration-200 ease-in-out group-hover:scale-105 transform-origin-left dark:group-hover:text-lg",children:t.title})]}),e.jsxs("div",{className:"flex justify-between items-baseline mt-2 text-gray-500 dark:text-gray-400",children:[e.jsxs("p",{className:"text-sm ",children:[r("count"),": ",t.count]}),e.jsx("p",{className:"text-xs ",children:C(t.createdAt)})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:s=>T(t,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})}),e.jsx("button",{onClick:s=>i(t.id,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},t.id))})]})}export{Ie as default};
