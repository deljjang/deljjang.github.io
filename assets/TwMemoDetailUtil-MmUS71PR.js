import{r as u,h as Q,bh as W,O as X,j as t,bl as T,bk as ee,bK as te,a2 as C,G as L,o as ae,n as se,f as le,q as ne,z as oe,s as re,L as U}from"./index-JdItkxIf.js";/* empty css                   */import{T as ie}from"./TwTextArea-BWruNNvP.js";import{c as ce,d as me,e as P,h as de}from"./fireMemoDetail-DoFH4UqO.js";import{H as ue}from"./HtmlCode-CuIX5N0Y.js";import{T as ge,D as he,H as xe,u as fe}from"./useMemoMutation-DMPvhT2x.js";import{u as ve,b as pe}from"./MemoComm-D3aJC7Fz.js";import"./copy-ilyuMBci.js";import"./ComponentCard-gc_4CLHY.js";import"./TwRadio-B2Zo6k2-.js";import"./TwBadge-IwNkunCD.js";import"./HtmlCode-CF8DqKsA.js";import"./toPropertyKey-DCwh5dYN.js";import"./Delete-EsLP-Hvc.js";import"./Divider-Dk1jiNEm.js";import"./HomeChartSemiDonut-CMDpRJ5E.js";import"./Favorite-CCYa_qOD.js";import"./angle-right-C5TjQODv.js";import"./SinyImageList-bopZAfIf.js";import"./ImageListItem-BWbzdRsu.js";import"./CodeText-BaHaEabA.js";import"./MemoDetailGrid-BTSJUvnQ.js";import"./IpInfo-D6j-ISZn.js";const we=n=>{const[i,m]=u.useState(n.imageList),[s,x]=u.useState(n.content),{t:l}=Q(),[r,g]=u.useState(),h=u.useRef(),k=u.useRef(!1),y=u.useRef(null),c=u.useRef([]),{height:w}=W(),N={edTitle:n.title,edGbn:n.gbn?n.gbn:"etc",edDate:n.date,content:n.content,memoTxt:n.content,htmlCheck:"N",iconCheck:"N"},{register:_,handleSubmit:$,trigger:je,control:b,setValue:f,getValues:j,watch:ye,formState:{errors:Ce,isSubmitting:Ne}}=X({mode:"onChange",defaultValues:N});u.useEffect(()=>{_("edDate"),_("memoTxt")},[]),u.useEffect(()=>{c.current=[],h.current=n.content},[n.content]);const S=async e=>{await n.onPostSubmit(e,i,c.current)},R=()=>{$(S)()},I=e=>{m(e)},B=e=>{let a=h.current;e.ext==="jpg"||e.ext==="png"?(a+=`<img src='${e.url}'/>`,v(`<img src='${e.url}'/>
`)):e.ext==="mp4"?(a+=`<video preload="auto" controls="" src='${e.url}'></video>`,v(`<video preload="auto" controls="" src='${e.url}'></video>`)):(a+=`<a src='${e.url}'>${e.name}}</a>`,v(`${l("download_link_text")}
<a href="${e.url}" target="_blank">${e.name}</a>
`)),h.current=a},A=e=>n.onRename(e,j("edTitle")),Y=e=>{h.current=e},H=e=>{c.current=e};function M(e){v(`<img src='${e}'/>`)}function q(){let e="";i&&i.length>0&&i.map((a,o)=>{e+=`<img src="/data/memo/${a.key}.${a.ext}" style="width: 50px;"/>
`}),e!==""&&v(e)}const O=[{value:"none",label:l("none")},{value:"react",label:l("react")},{value:"css",label:l("css")},{value:"android",label:l("android")},{value:"java",label:l("java")},{value:"image",label:l("image")},{value:"etc",label:l("etc")},{value:"mui",label:l("mui")}],v=e=>{const a=y.current;if(a){const o=a.selectionStart,d=a.selectionEnd,p=s.slice(0,o),D=s.slice(d);x(p+e+D),f("memoTxt",p+e+D),setTimeout(()=>{a.selectionStart=a.selectionEnd=o+e.length,a.focus()},100)}},G=e=>{v(e)},V=e=>e?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(e)||e.includes("image")||e.includes("img"):!1,z=async()=>{await ce("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1")},J=async()=>{const e=await me("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");let a="";e.map(o=>{a+=o+`
`}),v(a)},Z=async()=>{const e=j("edFilePath");if(e===""){const a=[];let o=y.current.value;o=o.replace(/<img src="\/data\/memo\//g,""),o=o.replace(/ style="width: 50px;"/g,""),o=o.replace(/"\/>/g,""),o=o.replace(/ /g,""),o.split(`
`).forEach(async d=>{d.indexOf(".")>0&&a.push(d)}),a.length>0&&await n.onFilePathList(a)}else await n.onFilePath(e)},K=e=>new Promise((a,o)=>{const d=new Image;d.crossOrigin="anonymous",d.onload=()=>{const p=document.createElement("canvas"),D=p.getContext("2d");p.width=d.width,p.height=d.height,D.drawImage(d,0,0);try{const F=p.toDataURL("image/png");a(F)}catch(F){o(F)}},d.onerror=()=>{o(new Error("Failed to load image"))},d.src=e});return t.jsx("div",{className:"my-2 mb-[50px], w-full",children:t.jsxs("form",{onSubmit:$(S),style:{width:"100%",minHeight:"300px",maxHeight:{height:w},display:"flex",flexDirection:"column"},children:[t.jsx(ge,{onSubmit:e=>R(),onCancel:n.onCancel,isSubmitting:k.current}),t.jsx(he,{control:b,onDelete:I,onInsert:B,onRename:A,setContent:Y,onFileUpload:H,imageList:n.imageList}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx("div",{className:"w-full",children:t.jsx(T,{name:"edTitle",placeholder:l("title_placeholder"),control:b,className:"w-full",rules:{required:l("required_field"),minLength:{value:2,message:l("min_length_2")}},onChange:e=>{e.preventDefault(),f("edTitle",e.target.value)}})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(ee,{name:"edGbn",label:l("category"),control:b,rules:{required:!0},placeholder:l("category_placeholder"),options:O,className:"",allClassName:"max-w-40",onChange:e=>{e.preventDefault();const a=e.target.value;f("edGbn",a)}}),t.jsx(te,{id:"edDate",name:"edDate",placeholder:l("select_date_placeholder"),control:b,onChange:(e,a)=>{f("edDate",a)}})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(T,{name:"edUrl",placeholder:l("base64_url_placeholder"),control:b,className:"w-full",allClassName:"w-full",onChange:e=>{e.preventDefault();const a=e.target.value;f("edUrl",a),g(a)}}),t.jsx(C,{variant:"outlined",color:"success",className:"w-25 h-9",onClick:e=>{e.preventDefault(),M(j("edUrl2"))},children:l("apply")})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(T,{name:"edUrl2",placeholder:l("base64_image_data_placeholder"),className:"w-full",allClassName:"w-full",variant:"filled",size:"md",value:j("edUrl2")||""}),t.jsx(C,{variant:"outlined",color:"success",className:"w-25 h-9",onClick:e=>{e.preventDefault(),q()},children:l("add_attachment")})]}),t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx(T,{name:"edFilePath",placeholder:l("add_to_imagelist_placeholder"),className:"w-full",allClassName:"w-full",control:b,onChange:e=>{e.preventDefault();const a=e.target.value;f("edFilePath",a)}}),t.jsx(C,{size:"sm",variant:"outlined",color:"success",className:"w-25 h-9",onClick:e=>{e.preventDefault(),Z()},children:l("file_path")})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(C,{variant:"outlined",color:"success",onClick:e=>{e.preventDefault(),z()},children:l("all_files")}),t.jsx(C,{variant:"outlined",color:"success",onClick:e=>{e.preventDefault(),J()},children:l("all_files_10")})]})]}),t.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx("div",{children:t.jsx("div",{className:"max-h-100 overflow-y-scroll",children:t.jsx(ue,{postData:s})})}),t.jsx("div",{children:t.jsx(ie,{ref:y,className:"",value:s,onChange:e=>{f("memoTxt",e),x(e)},rows:20})}),j("edUrl")&&V(j("edUrl"))&&t.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:t.jsx("img",{src:r,alt:l("preview"),className:"max-w-full h-auto max-h-48 object-contain",onLoad:async e=>{try{const a=await K(r);f("edUrl2",a)}catch(a){console.error("Base64 conversion failed:",a)}},onError:e=>{e.target.style.display="none"}})})]}),t.jsx(xe,{onClick:G}),t.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},be=async(n,i,m,s,x)=>{const l=n==="memo"?`${n}/${i.uid}/`:`${n}/`,r=await de(l,s.key,x,s.ext);if(r.success){const g=n==="memo"?`memo_txt/${i.uid}/${m}/image/`:`home_txt/${m}/image/`;L(g+s.key,null);const h={...s,key:r.key,url:r.url,name:`${r.key}.${s.ext}`};return L(g+r.key,h),h}},E=async(n,i,m)=>{if(Array.isArray(m)&&m.length>0)for(const s of m)try{await P(n,i,s)}catch(x){console.error(`Error getting path for ${s}:`,x)}else typeof m=="string"&&await P(n,i,m)},Je=n=>{const{rootDb:i,isLoading:m,memoDetailData:s}=n,{scrollYProgress:x}=ve();pe(x,{stiffness:100,damping:30,restDelta:.001});const l=ae(),{memoId:r}=se();le();const{user:g}=ne();oe();const h=()=>{const c=`/${i==="memo"?"m":i}/${r==="insert"?"":r}`;l(c)},k=fe(i,r),y=(c,w,N)=>{k.mutate({values:c,imageList:w,files:N})};return u.useEffect(()=>{s&&s.title!==void 0&&re({title:s.title,description:s.title});function c(){document.querySelectorAll("pre").forEach((w,N)=>{})}s&&s.memo!==null&&c()},[s]),r===""||g===void 0?t.jsx(t.Fragment,{}):s===void 0||m?t.jsx(U,{}):t.jsx(t.Fragment,{children:t.jsx("div",{className:"w-full p-0 m-0",children:s&&(s.title===void 0||s.title===""||s.title===null)?t.jsx(U,{}):t.jsx(we,{onPostSubmit:y,onCancel:h,onRename:(c,w)=>be(i,g,r,c,w),onFilePath:c=>E(g.uid,r,c),onFilePathList:c=>E(g.uid,r,c),title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})})};export{Je as TwMemoDetailUtil,Je as default};
