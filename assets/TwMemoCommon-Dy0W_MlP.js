const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DniqvCY8.js","assets/index-CPCRhzRN.js","assets/index-CSlVTcy3.css","assets/SinySelect-D1h11yT_.js","assets/Grid-BPyD6v_e.js","assets/index-BvN8VIWf.js","assets/TextField-BRBh0eu7.js","assets/InputAdornment-Dc_Zrfqx.js","assets/Popper-C_-yVYon.js","assets/Chip-C4VAdIFe.js","assets/index.esm-Blot3QwZ.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-C90VZgZO.js","assets/TwButton-BCgBYtGb.js"])))=>i.map(i=>d[i]);
import{r as d,j as e,m as Q,h as Se,z as M,p as T,D as Z,A as X,S as ee,T as te,E as F,G as Te,q as se,t as De,v as Le,w as re,x as ne,M as ae,C as A,Q as oe,R as H,n as ie,H as le,k as Ie,V as Re,W as Ee,X as Me,Y as Be,Z as P,$ as E,a0 as ce,a1 as de,a3 as D,N as _e,cB as Fe,cD as Ye,d4 as Pe,a4 as B,a5 as Ae,a6 as He,a7 as Oe,a8 as ze,a9 as _,aa as We}from"./index-CPCRhzRN.js";import{u as qe}from"./useSuspenseQuery-DmqdKRrl.js";import{T as Ve,u as me,a as ue,F as Ge,b as Ke,D as Je,l as Ue,I as Qe,s as G,d as K,e as Ze}from"./index-DniqvCY8.js";import{E as Xe,C as et}from"./ExpandMore-CNPShkSS.js";import{F as he}from"./Favorite-Cra4qCxT.js";import{T as L}from"./TwButton-BCgBYtGb.js";import{D as tt}from"./datetime-BDx6lZXm.js";import{u as st}from"./index.esm-Blot3QwZ.js";import"./index-CLQ_oLGC.js";import{S as rt,a as nt}from"./SinySelect-D1h11yT_.js";import{T as at,I as ot}from"./TextField-BRBh0eu7.js";import{S as it}from"./check-circle-BLVUZDcK.js";import"./useBaseQuery-BQ11vBj6.js";import"./Grid-BPyD6v_e.js";import"./index-BvN8VIWf.js";import"./InputAdornment-Dc_Zrfqx.js";import"./Popper-C_-yVYon.js";import"./Chip-C4VAdIFe.js";const lt=t=>d.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...t},d.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),ct=t=>d.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),dt=t=>e.jsx(Q.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Se,{to:t.to,className:"text-inherit no-underline cursor-pointer",...t,children:e.jsx(Ve,{children:t.children})})});function mt({initTreeData:t}){const[r,a]=d.useState(),s=n=>a(n),l=M();if(d.useEffect(()=>{a(t)},[t]),r==null||r.length===0)return e.jsx(T,{});const h=n=>{console.log("node",n),l(`/m/${n.id}`)};return e.jsx(Z,{backend:ee,options:X(),children:e.jsx(te,{tree:r,rootId:"root",onDrop:s,render:(n,{depth:p,isOpen:u,onToggle:o})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:p*20+(n.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[n.cnt>0&&e.jsx("div",{onClick:o,children:u?e.jsx(Xe,{}):e.jsx(et,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>h(n),children:n.text})]}),n.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",n.cnt,")"]})]})})})}function ut(t){const{user:r}=F(),a=M(),[s,l]=d.useState(),[h,n]=d.useState(),p=async u=>{const o=[],i=se(re(ne,`memo_tree/${u}`),Le("bm"),De("Y")),g=await ae(i);if(!g.exists()){console.log("getFireData.null");return}const v=g.val();for(let f in v){const c=v[f];c.id=f,c.key=f,c.text=c.title,o.push(c)}o.sort((f,c)=>f.title>c.title?1:-1),l([...o])};return d.useEffect(()=>{r!==void 0&&r!=null&&p(r?.uid)},[r]),d.useEffect(()=>{const u=async(o,i)=>{const g=[...i];if(i)for(const v of i){let f=v;for(;f.parent!=="root";){f.parent,f=await A(`memo_tree/${o}/${f.parent}`);const c={id:f.key,text:f.title,droppable:!1,parent:f.parent};g.filter(j=>j.id===c.id).length===0&&g.push(c)}}for(const v of g){const f=v.id;v.cnt=g.filter(c=>c.parent===f).length}n(g)};s&&s.length>0&&u(r?.uid,s)},[s]),r===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Te,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((u,o)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{t.onSelected(u.key),a(`/m/${u.key}`)},children:e.jsx("span",{className:"text-base",children:u.title})})},o))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(d.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(mt,{initTreeData:h,uid:r?.uid})})]})}const ht=t=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(L,{size:"sm",variant:"outlined",color:"success",onClick:t.onEdit,children:"수정"}),e.jsx(L,{size:"sm",variant:"outlined",color:"warning",onClick:t.onNewMemo,children:"새글"}),e.jsx(L,{size:"sm",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"})]}),gt=t=>{const{rootDb:r,isLoading:a,memoDetailData:s}=t,{scrollYProgress:l}=me(),h=ue(l,{stiffness:100,damping:30,restDelta:.001}),[n,p]=d.useState(!1),u=M(),o=d.useRef();o.current=t.searchWord;const{memoId:i}=oe(),v=H()?.state?.fullIndex,{user:f}=F(),c=()=>{const x=`/${r==="memo"?"m":r}/edit/${i}`;u(x,{state:{fullIndex:v}})},k=()=>{const x=`/${r==="memo"?"m":r}/insert/${i}`;u(x,{state:{fullIndex:v}})},j=async()=>{const x=r==="memo"?`${r}_txt/${f.uid}/${i}`:`${r}_txt/${i}`,w=r==="memo"?`${r}_tree/${f.uid}`:r;if(await Ke(x,w)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}t.onTreeUpdate(),u(`/${r==="memo"?"m":r}`)},b=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&j()},N=()=>{t.onBookmark()};return d.useEffect(()=>{s&&s.title!==void 0&&ie({title:s.title,description:s.title});function x(){window.scrollTo({top:0}),s&&s.html!=="N"&&document.querySelectorAll("pre").forEach(w=>{w.innerHTML=Me(w.innerHTML)})}s&&s.memo!==null&&x()},[s]),a?e.jsx(T,{}):i===""||f===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(Q.div,{className:"progress-bar",style:{scaleX:h}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:s&&s.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:N,children:s&&s.bookmark==="Y"?e.jsx(he,{className:"text-red-500"}):e.jsx(Ge,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:t.memoDetailData?.path&&t.memoDetailData?.path.map((x,w)=>w===0?x.title:` > ${x.title}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(ht,{rootDb:r,onEdit:c,onNewMemo:k,onDelete:b,bookmark:s&&s.bookmark}),e.jsxs("div",{className:"my-4",children:[s&&s.html==="N"?e.jsx(le,{postData:s&&s.memo}):s&&s.html!=="N"&&s.memo&&e.jsx(Ie,{text:s.memo}),e.jsx(Re,{imageList:s&&s.image}),!s&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Ee,{})})})]})]})]})},xt=({onSubmit:t,onCancel:r,isSubmitting:a,newMode:s})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(L,{variant:"outlined",color:"success",disabled:a,onClick:l=>{l.preventDefault(),t(l)},children:[s?"새글":""," 저장"]}),e.jsx(L,{variant:"outlined",color:"error",onClick:r,children:"취소"})]});d.forwardRef((t,r)=>{const{id:a,label:s,defaultValue:l,onChange:h,className:n="",...p}=t,u=o=>{h&&h(o.target.value)};return e.jsxs("div",{className:` ${n}`,children:[s&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:a,children:s}),e.jsx("input",{ref:r,type:"date",id:a,defaultValue:l,onChange:u,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...p})]})});const J=({label:t,checked:r,id:a,onChange:s,className:l="",disabled:h=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${h?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:a,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${l}`,checked:r,onChange:n=>s(n.target.checked),disabled:h}),r&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),h&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),t&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:t})]}),ft=d.forwardRef((t,r)=>{const{placeholder:a="Enter your message",rows:s=3,value:l="",onChange:h,className:n="",disabled:p=!1,error:u=!1,hint:o=""}=t,i=v=>{h&&h(v.target.value)};let g=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${n} `;return p?g+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":u?g+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":g+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:r,placeholder:a,rows:s,value:l,onChange:i,disabled:p,className:g}),o&&e.jsx("p",{className:`mt-2 text-sm ${u?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:o})]})}),pt=d.lazy(()=>de(()=>import("./index-DniqvCY8.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));Ue.Quill.register("modules/imageDrop",Qe);ce.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const vt={syntax:{highlight:t=>ce.highlightAuto(t).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},kt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],jt=t=>{const[r,a]=d.useState(t.imageList),[s,l]=d.useState(t.htmlCheck==="Y"),[h,n]=d.useState(t.iconCheck==="Y"),[p,u]=d.useState(t.newMode?"":t.content),o=d.useRef(),i=d.useRef(),g=d.useRef(null);d.useRef(null);const v=d.useRef(null),f=t.newMode,c=d.useRef([]),{height:k}=Be(),j=tt.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),b={edTitle:f?"":t.title,edGbn:t.gbn?t.gbn:"etc",edDate:f?j:t.date,content:f?"":t.content,memoTxt:f?"":t.content,htmlCheck:t.htmlCheck,iconCheck:t.iconCheck},{register:N,handleSubmit:x,trigger:w,control:$,setValue:C,getValues:S,watch:ge,formState:{errors:O,isSubmitting:xe}}=st({mode:"onChange",defaultValues:b});d.useEffect(()=>{N("edDate"),N("edGbn",{required:!0}),N("htmlCheck"),N("iconCheck"),N("memoTxt")},[]),d.useEffect(()=>{c.current=[],o.current=t.content,i.current=!1},[t.content]);const z=async m=>{f?await t.onNewSubmit(m,c.current):await t.onPostSubmit(m,r,c.current)},fe=()=>{x(z)()},pe=m=>{console.log("onDelete.imageList=",m),a(m)},ve=m=>{console.log("onInsert.file",m);let y=o.current;m.ext==="jpg"?(y+=`<img src='${m.url}'/>`,Y(`<img src='${m.url}'/>`)):m.ext==="mp4"&&(y+=`<video preload="auto" controls="" src='${m.url}'></video>`,Y(`<video preload="auto" controls="" src='${m.url}'></video>`)),o.current=y},ke=m=>{o.current=m},je=m=>{console.log("handleFileUpload",m),c.current=m};function ye(m){o.current=m,C("content",m),w("content")}function we(m,y){console.log("handleChangeDate=",m),console.log("handleChangeDate.currentDateString=",y);let R=P(m);console.log("handleChangeDate.dayjs=",R.format("YYYY-MM-DD HH:mm:ss")),C("edDate",R.format("YYYY-MM-DD")),w("edDate")}const W=(m,y)=>{console.log(`onChecked.${m}=`,y),C(m,y?"Y":"N"),m==="htmlCheck"?l(y):n(y)},be=ge("content"),Ne=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Ce=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],Y=m=>{const y=g.current;if(y){const R=y.selectionStart,$e=y.selectionEnd,q=p.slice(0,R),V=p.slice($e);u(q+m+V),C("memoTxt",q+m+V),setTimeout(()=>{y.selectionStart=y.selectionEnd=R+m.length,y.focus()},0)}},I=m=>{Y(m)};return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:x(z),style:{width:"100%",minHeight:"300px",maxHeight:{height:k},display:"flex",flexDirection:"column"},children:[e.jsx(xt,{onSubmit:m=>fe(),onCancel:t.onCancel,isSubmitting:xe,newMode:f}),e.jsx(Je,{control:$,onDelete:pe,onInsert:ve,setContent:ke,onFileUpload:je,imageList:t.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(at,{...N("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!O.edTitle})}),e.jsx(rt,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:$,defaultValue:S("edGbn"),selectList:Ne,error:!!O.edGbn,onChange:m=>{m.preventDefault();const y=m.target.value;console.log("edGbn=",S("edGbn")),C("edGbn",y)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(nt,{id:"edDate",label:"일자",value:P(S("edDate")),...N("edDate"),defaultValue:P(S("edDate")),onChange:(m,y)=>{we(m,y)}}),e.jsx(J,{id:"html",checked:s,onChange:m=>W("htmlCheck",m),label:"HTML사용"}),e.jsx(J,{id:"icon",checked:h,onChange:m=>W("iconCheck",m),label:"Icon"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-130 overflow-y-scroll",children:e.jsx(le,{postData:p})}),e.jsxs("div",{children:[e.jsx(ft,{ref:g,className:"",value:p,onChange:m=>{C("memoTxt",m),u(m)},rows:22}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>I("<box></box>"),children:"<Box>"}),Ce.map((m,y)=>e.jsx(E,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>I("<code>"+m+"</code>"),children:m},y)),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>I('<a href="" target="_blank"></a>'),children:"Link"}),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>I('<img src=""></img>'),children:"img"}),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>I('<hr style="width=100%"/>'),children:"line"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"})]})]}),e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(pt,{ref:v,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:be,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:vt,formats:kt,onChange:ye})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},U=t=>{const{rootDb:r,isLoading:a,memoDetailData:s}=t,{scrollYProgress:l}=me();ue(l,{stiffness:100,damping:30,restDelta:.001});const h=M(),n=d.useRef(),p=d.useRef();p.current=t.searchWord;const{memoId:u}=oe(),o=H(),{user:i}=F();n.current=o.pathname.split("/")[2]==="insert",console.log("memoDetailData=",s?.title),console.log("newMode=",n.current,", memoId=",u);const g=()=>{const c=`/${r==="memo"?"m":r}/${u==="insert"?"":u}`;h(c)},v=async(c,k)=>{console.log("onNewSubmit.values",c);const j=await G({rootDb:r,uid:i.uid,newData:n.current,key:u==="insert"?"root":u,values:c});if(await K(`${r}_txt`,r,j,k),j!==void 0){const b=`/${r==="memo"?"m":r}/${j}`;h(b,{state:{reflash:!0}})}},f=async(c,k,j)=>{const b=r==="memo"?`${r}_txt/${i.uid}/`:`${r}_txt/`,N=r==="memo"?`${r}_tree/${i.uid}/`:`${r}/`;await Ze(b,N,u,k),console.log("onPostSubmit.values",c);const x=await G({rootDb:r,uid:i.uid,newData:n.current,key:u==="insert"?"root":u,values:c});console.log("onPostSubmit.newKey=",x),console.log("onPostSubmit.files=",j);const w=await K(`${b}/`,r==="memo"?`${r}/${i.uid}/`:`${r}/`,u,j);console.log("onNewSubmit.imageResult",w),r==="memo"&&D(`memo_tree/${i.uid}/${u}/title`,c.edTitle),n.current=!1;const $=`/${r==="memo"?"m":r}/${u}`;r==="home"&&D("home/tree",null),h($,{state:{reflash:!0}})};return d.useEffect(()=>{s&&s.title!==void 0&&ie({title:s.title,description:s.title});function c(){document.querySelectorAll("pre").forEach((k,j)=>{})}s&&s.memo!==null&&c()},[s]),u===""||i===void 0?e.jsx(e.Fragment,{}):s===void 0||a?e.jsx(T,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:n.current===!1&&s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(T,{}):e.jsx(jt,{newMode:n.current,onPostSubmit:f,onNewSubmit:v,onCancel:g,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html:"Y",iconCheck:s?.icon?s?.icon:"Y",content:s?.memo,imageList:s?.image})})})};function yt({initTreeData:t,userId:r,memoId:a,onClick:s}){const[l,h]=d.useState(t),{isMoble:n,height:p,width:u}=_e(),o=d.useRef(),i=d.useRef(),g=(c,k)=>{if(k.dragSource.id!==void 0&&k.dropTargetId!==void 0){const j=`memo_tree/${r}/${k.dragSource.id}/parent`;D(j,k.dropTargetId)}h(c)};d.useEffect(()=>{(()=>{for(const k of t){const j=k.id;k.cnt=t.filter(b=>b.parent===j).length}h(t)})()},[t]);const v=(c,k)=>{const j=[],b=N=>{const x=k.find(w=>w.id===N);if(!x)return!1;if(x.parent&&x.parent!=="root"){if(b(x.parent))return j.push(x.parent),!0}else return!0;return!1};return b(c)?j.reverse():[]},f=c=>{if(!l||!c||!i.current)return;const k=v(c,l);k.length>0&&setTimeout(()=>{i.current.open(k)},500)};return d.useEffect(()=>{o.current===void 0&&a!==void 0&&(o.current=a,f(a))},[l]),l==null||l.length===0?e.jsx(T,{}):e.jsx(Z,{backend:ee,options:X(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:p-220-(n?56:0)+(u>1024?60:0),width:"100%"},children:e.jsx(te,{ref:i,tree:l,rootId:"root",onDrop:g,render:(c,{depth:k,isOpen:j,onToggle:b,isDragging:N,isDropTarget:x})=>e.jsxs("div",{className:`w-63 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ${N?"opacity-50":""} ${x?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
              ${o.current===c.id?"menu-item-active":""}
              `,style:{paddingLeft:k*20+(c.cnt===0?5:0)},children:[e.jsx("div",{className:"min-w-0",children:c.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:b,children:j?e.jsx(lt,{className:"size-6"}):e.jsx(ct,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{o.current=c.id,console.log("nodeId.current",o.current),s(c)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[c.icon,c.text]}),c.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",c.cnt,")"]})]})]})})})})}const wt=t=>{const r=d.useRef(null);function a(){t.onSearchDataBtn(r.current.value)}function s(){return t.onNewMemoBtn(),!1}function l(h){h.which===13&&a()}return e.jsxs(e.Fragment,{children:[e.jsx(ot,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:r,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:l}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(L,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:s,children:"새글"}),e.jsx(L,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:a,children:"조회"})]})]})},bt=async(t,r,a)=>{let s=new Array;for(let l in a){const h=a[l];try{if(h.key=l,h.url===void 0){const n=await Fe(Ye,`${r}/${l}.${h.ext}`),p=await Pe(n);h.url=p,D(`${t}/image/${l}/url`,p)}s.push(h)}catch(n){console.log("getImageList.catch",n)}}return s},Nt=async(t,r,a,s)=>{let l="",h="",n={};((o,i,g)=>{h=o==="memo"?`${o}/${i}/${g}`:`${o}/${g}`,l=o==="memo"?`${o}_txt/${i}/${g}`:`${o}_txt/${g}`})(t,r,a);async function u(){if(l===void 0)return"";if(n=await A(l),n===void 0)return console.log("No data available"),"";if(n?.fullIndex,n.image!==void 0&&n.image!==null){const o=await bt(l,h,n.image);n.image=o,(n.imageOK===void 0||n.imageOK==="N")&&(o&&o.map(i=>{i.ext==="jpg"&&(n.memo=n.memo+`<img src='${i.url}'>`)}),D(`${l}/imageOK`,"Y"),D(`${l}/memo`,n.memo))}if(s!==void 0&&s!==""){const o=s,i=new RegExp(o,"gi"),g=n.memo.replace(i,`<span class='lightext'>${o}</span>`);n.memo=g}}return await u(),n};async function Ct(t,r,a=""){if(r==null||r==="")return"";if(t==="home"){const o=await A("home/tree");if(o!=null)try{return JSON.parse(o)}catch(i){console.error("Error parsing JSON data:",i)}}const s=t==="home"?"home_txt":a===""?`${t}_tree/${r}`:`${t}_txt/${r}`,l=se(re(ne,s)),h=await ae(l);if(!h.exists())return console.log("getTreeData.null"),null;if(!h.exists())return console.log("getTreeData.exists"),null;const n=h.val(),p=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],u=[];t==="home"&&u.push(...p);for(const o in n){const i=n[o];i.id=o;const g={id:o,key:o,text:i.title,parent:t==="home"?i.gbn:i.parent};t==="memo"?(g.icon=i.bm==="Y"?e.jsx(he,{className:"text-red-500"}):i.icon==="Y"?e.jsx(it,{}):null,g.droppable=!0):g.droppable=!1,!(g.parent===void 0||g.parent===null||g.parent==="")&&(t==="home"||a===""||a===void 0||a===null?u.push(g):(i.id=o,(i.memo+"").toLowerCase().indexOf(a.toLowerCase())>-1&&u.push(g)))}return u.sort((o,i)=>o.title>i.title?1:-1),t==="home"&&D("home/tree",JSON.stringify(u)),u}const $t=d.lazy(async()=>await de(()=>import("./TwMemoMain-C90VZgZO.js"),__vite__mapDeps([12,1,2,13]))),Vt=({rootDb:t})=>{const r=M(),{user:a}=F(),s=d.useRef(),l=d.useRef(!0),h=d.useRef(),n=d.useRef(),[p,u]=d.useState(),o=d.useRef(!1),i=H(),g=d.useRef(!1);g.current=i?.state?.reflash===!0;const v=qe({queryKey:["twTreeData",a?.uid,s.current],queryFn:()=>Ct(t,a?.uid,s.current)});v.data!==void 0&&v.data!==""&&!o.current&&(o.current=!0);const f=()=>{const x=p;x&&(x.bookmark=x.bookmark==="Y"?"N":"Y");const w=`memo_tree/${a.uid}/${n.current}/bm`;D(w,p.bookmark),u({...p,bookmark:x.bookmark})};d.useEffect(()=>{a!==void 0&&a!=null&&v.refetch()},[a]),d.useEffect(()=>{const x=async C=>{if(C!==""&&a){const S=await Nt(t,a?.uid,C,s.current);t==="memo"&&(S.path=St(v.data,C)),l.current=!1,u(S===void 0?{}:S)}},w=i.pathname.split("/"),$=w.length>2?w[w.length-1]:"";l.current=!0,x($),n.current=$},[i.pathname,a]),d.useEffect(()=>{a!==void 0&&a!=null&&v.refetch()},[g.current]);const c=x=>{o.current=!1,x!==void 0&&(s.current=x),v.refetch()},k=x=>{x.id!==n.current&&(l.current=!0,console.log("node",x),r(`/${t==="memo"?"m":t}/${x.id}`))},j=()=>{if(a==null){alert("로그인 후 이용 가능합니다.");return}const x=`/${t==="memo"?"m":t}/insert/insert`;r(x)},b=x=>{},N=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3",children:e.jsx(dt,{to:"/m",children:t==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[t==="memo"?"":e.jsx(B,{to:"/m",children:"메모"}),t==="memo"&&a?.uid==="I3cTgdCxwjhBBno4mtZYvnODPJu1"?e.jsx(B,{to:"/home",children:"홈관리"}):null,e.jsx(B,{to:"/todo",children:"TODO"}),e.jsx(B,{to:"/tw",children:"Sheet"})]}),e.jsx(wt,{onNewMemoBtn:j,onSearchDataBtn:c}),o.current&&v.isFetched?e.jsx(yt,{expandIndex:h.current,initTreeData:v.data,userId:a?.uid,memoId:n.current,onClick:k}):a===void 0?e.jsx(e.Fragment,{}):e.jsx(T,{})]});return a&&a.uid===Ae&&He,e.jsxs(Oe,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:N,children:[e.jsx(d.Suspense,{fallback:e.jsx(T,{}),children:e.jsxs(ze,{children:[e.jsx(_,{path:"/edit/:memoId",element:e.jsx(U,{rootDb:t,isLoading:l.current,searchWord:s.current,memoDetailData:p})}),e.jsx(_,{path:"/insert/:memoId",element:e.jsx(U,{rootDb:t,isLoading:l.current,searchWord:s.current,memoDetailData:p})}),e.jsx(_,{path:"/:memoId",element:e.jsx(gt,{rootDb:t,isLoading:l.current,searchWord:s.current,memoDetailData:p,onTreeUpdate:c,onBookmark:f,data:v.data})}),e.jsx(_,{path:"*",element:e.jsx($t,{searchWord:s.current,data:v.data,onNewMemoBtn:j,title:t==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),t==="memo"?e.jsx(ut,{onSelected:b}):"",e.jsx(We,{})]})},St=(t,r)=>{let a=[],s=r;if(!t)return a;const l=t.find(h=>h.id===s);for(a.unshift(l),s=l?.parent;s!=null&&s!==""&&s!=="root";){const h=t.find(n=>n.id===s);s=h?.parent,a.unshift(h)}return a};export{Vt as default};
