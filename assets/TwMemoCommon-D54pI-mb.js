const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CAG_AkkJ.js","assets/index-B5nT--g1.js","assets/index-Cj4RT9E7.css","assets/createSvgIcon-DZPPBzfa.js","assets/useControlled-eix3VZFE.js","assets/ownerWindow-DvT1GKkC.js","assets/isMuiElement-sqRWOPwT.js","assets/fireDatabase-C4jetsiX.js","assets/fireStorage-BSTx3rn0.js","assets/SinyDate-ZIVdqllB.js","assets/Grid-Dx0wwJgL.js","assets/useTheme-D1XSnGu8.js","assets/index-BWMeF9zH.js","assets/index-Chjiymov.js","assets/Menu-DkYVsrMC.js","assets/useSlotProps-DtEju_Dd.js","assets/resolveComponentProps-ROUE0EeA.js","assets/utils-DxSd3qJb.js","assets/IconButton-BdLUpEDQ.js","assets/TextField-Dp_qZ_qf.js","assets/InputAdornment-CHtZHik0.js","assets/Popper-D9D7ZB8Z.js","assets/Button-CAVRkE9X.js","assets/Chip-DAac7Fka.js","assets/index.esm-EunXJFlp.js","assets/TwButton-CzU9Nzup.js","assets/Loading-DhmNF301.js","assets/Container-CIu-ORg8.js","assets/styled-hopnhVU9.js","assets/CircularProgress-DaaeTxou.js","assets/Divider-C9VtL-JT.js","assets/dividerClasses-DQkGGggF.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-Cg0HjAQf.js","assets/IpInfo-DwnURSbh.js"])))=>i.map(i=>d[i]);
import{r as g,j as e,l as je,b1 as Oe,u as O,c as J,T as We,q as we,e as Ke,o as Ve,a as Ne,f as Ce,g as $e,i as ge,k as se,v as Se,H as Je,aV as Ge,n as Te,t as Le,_ as De,h as Qe,L as ee,w as Ze,x as Xe,R as et,y as W}from"./index-B5nT--g1.js";import{u as tt}from"./useSuspenseQuery-DQdGDu2t.js";import{L as B}from"./Loading-DhmNF301.js";import{T as rt}from"./Footer-C05u5RvG.js";import{T as st,u as he,a as xe,F as ot,b as at,D as Ee,l as nt,I as lt,s as te,d as re,e as Ie}from"./index-CAG_AkkJ.js";import{g as Re,s as R}from"./fireDatabase-C4jetsiX.js";import{D as Fe,g as Pe,S as Be,T as _e,H as fe}from"./HtmlCode-CIkbmWDr.js";import{E as it,C as ct}from"./ExpandMore-oR5__oWw.js";import{F as Me}from"./Favorite-Cl_IAIt8.js";import{S as dt}from"./SinyImageList-Ou_IBARR.js";import{c as mt}from"./CodeText-B2C53EQh.js";import{s as pe}from"./commonUtil-DB6xv_HR.js";import{T as E}from"./TwButton-CzU9Nzup.js";import{C as ut}from"./CircularProgress-DaaeTxou.js";import{D as gt}from"./datetime-BDx6lZXm.js";import{u as Ue}from"./index.esm-EunXJFlp.js";import{T as I}from"./TwBadge-C3jdwdK5.js";import"./SinyDate-ZIVdqllB.js";import{f as ht}from"./index-CLQ_oLGC.js";import{d as q,e as Ae,f as xt,h as ft}from"./fireStorage-BSTx3rn0.js";import{I as pt}from"./TextField-Dp_qZ_qf.js";import{f as vt}from"./fireMemoDetail-DuxDVy3U.js";import{S as bt}from"./check-circle-DpyJ43BG.js";import"./useBaseQuery-Bn53GaEy.js";import"./Container-CIu-ORg8.js";import"./styled-hopnhVU9.js";import"./Divider-C9VtL-JT.js";import"./dividerClasses-DQkGGggF.js";import"./Link-BcCWcy-i.js";import"./createSvgIcon-DZPPBzfa.js";import"./useControlled-eix3VZFE.js";import"./ownerWindow-DvT1GKkC.js";import"./isMuiElement-sqRWOPwT.js";import"./IconButton-BdLUpEDQ.js";import"./copy-Bka0jExk.js";import"./toPropertyKey-DCwh5dYN.js";import"./index-Chjiymov.js";import"./ImageListItem-CF47Hruk.js";import"./Grid-Dx0wwJgL.js";import"./useTheme-D1XSnGu8.js";import"./index-BWMeF9zH.js";import"./Menu-DkYVsrMC.js";import"./useSlotProps-DtEju_Dd.js";import"./resolveComponentProps-ROUE0EeA.js";import"./utils-DxSd3qJb.js";import"./InputAdornment-CHtZHik0.js";import"./Popper-D9D7ZB8Z.js";import"./Button-CAVRkE9X.js";import"./Chip-DAac7Fka.js";const kt=r=>g.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...r},g.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),yt=r=>g.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...r},g.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),jt=r=>e.jsx(je.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Oe,{to:r.to,className:"text-inherit no-underline cursor-pointer",...r,children:e.jsx(st,{children:r.children})})});function wt({initTreeData:r}){const[s,n]=g.useState(),t=p=>n(p),h=O();if(g.useEffect(()=>{n(r)},[r]),s==null||s.length===0)return e.jsx(B,{});const f=p=>{console.log("node",p),h(`/m/${p.id}`)};return e.jsx(Fe,{backend:Be,options:Pe(),children:e.jsx(_e,{tree:s,rootId:"root",onDrop:t,render:(p,{depth:x,isOpen:l,onToggle:m})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:x*20+(p.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[p.cnt>0&&e.jsx("div",{onClick:m,children:l?e.jsx(it,{}):e.jsx(ct,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>f(p),children:p.text})]}),p.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",p.cnt,")"]})]})})})}function Nt(r){const{user:s}=J(),n=O(),[t,h]=g.useState(),[f,p]=g.useState(),x=async l=>{const m=[],c=we(Ne(Ce,`memo_tree/${l}`),Ve("bm"),Ke("Y")),v=await $e(c);if(!v.exists()){console.log("getFireData.null");return}const N=v.val();for(let C in N){const k=N[C];k.id=C,k.key=C,k.text=k.title,m.push(k)}m.sort((C,k)=>C.title>k.title?1:-1),h([...m])};return g.useEffect(()=>{s!==void 0&&s!=null&&x(s?.uid)},[s]),g.useEffect(()=>{const l=async(m,c)=>{const v=[...c];if(c)for(const N of c){let C=N;for(;C.parent!=="root";){C.parent,C=await Re(`memo_tree/${m}/${C.parent}`);const k={id:C.key,text:C.title,droppable:!1,parent:C.parent};v.filter(y=>y.id===k.id).length===0&&v.push(k)}}for(const N of v){const C=N.id;N.cnt=v.filter(k=>k.parent===C).length}p(v)};t&&t.length>0&&l(s?.uid,t)},[t]),s===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(We,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:t&&t.map((l,m)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{r.onSelected(l.key),n(`/m/${l.key}`)},children:e.jsx("span",{className:"text-base",children:l.title})})},m))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(g.Suspense,{fallback:e.jsx(B,{}),children:e.jsx(wt,{initTreeData:f,uid:s?.uid})})]})}const Ct=r=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:`70px 70px 70px ${r.master?"70px":""}`},children:[r.master&&e.jsx(E,{size:"sm",variant:"outlined",color:"success",onClick:r.onUtil,children:"유틸"}),e.jsx(E,{size:"sm",variant:"outlined",color:"success",onClick:r.onEdit,children:"수정"}),e.jsx(E,{size:"sm",variant:"outlined",color:"warning",onClick:r.onNewMemo,children:"새글"}),e.jsx(E,{size:"sm",variant:"outlined",color:"error",onClick:r.onDelete,children:"삭제"})]}),$t=r=>{const{rootDb:s,isLoading:n,memoDetailData:t,onBookmark:h,onTreeUpdate:f,searchWord:p}=r,{scrollYProgress:x}=he(),l=xe(x,{stiffness:100,damping:30,restDelta:.001}),m=O(),{memoId:c}=ge(),N=se()?.state?.fullIndex,{user:C}=J(),k=()=>{const d=`/${s==="memo"?"m":s}/edit/${c}`;m(d,{state:{fullIndex:N}})},u=()=>{const d=`/${s==="memo"?"m":s}/util/${c}`;m(d,{state:{fullIndex:N}})},y=()=>{const d=`/${s==="memo"?"m":s}/insert/${c}`;m(d,{state:{fullIndex:N}})},i=async()=>{const d=s==="memo"?`${s}_txt/${C.uid}/${c}`:`${s}_txt/${c}`,w=s==="memo"?`${s}_tree/${C.uid}/${c}`:`${s}/${c}`;await at(d,w)!==void 0&&(f(),m(`/${s==="memo"?"m":s}`))},j=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&i()};return g.useEffect(()=>{t&&t.title!==void 0&&pe({title:t.title,description:t.title});function d(){window.scrollTo({top:0}),t&&t.html!=="N"&&document.querySelectorAll("pre").forEach(w=>{w.innerHTML=mt(w.innerHTML)})}t&&t.memo!==null&&(d(),t.image&&t.image.map((w,T)=>(console.log("image."+T+"=",w.key),w)))},[t]),n?e.jsx(B,{}):c===""||C===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(je.div,{className:"progress-bar",style:{scaleX:l}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:t&&t.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:h,children:t&&t.bookmark==="Y"?e.jsx(Me,{className:"text-red-500"}):e.jsx(ot,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:t?.path&&t?.path.map((d,w)=>w===0?d?.text:` > ${d?.text}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(Ct,{master:C?.uid===Se,rootDb:s,onEdit:k,onUtil:u,onNewMemo:y,onDelete:j,bookmark:t&&t.bookmark}),e.jsxs("div",{className:"my-4",children:[t&&t.html==="N"?e.jsx(fe,{postData:t&&t.memo,highlightWord:p}):t&&t.html!=="N"&&t.memo&&e.jsx(Je,{text:t.memo}),e.jsx(dt,{imageList:t&&t.image}),!t&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(ut,{})})})]})]})]})},Ye=({onSubmit:r,onCancel:s,isSubmitting:n,newMode:t=!1})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(E,{variant:"outlined",color:"success",disabled:n,onClick:h=>{h.preventDefault(),r(h)},children:[t?"새글":""," 저장"]}),e.jsx(E,{variant:"outlined",color:"error",onClick:h=>{h.preventDefault(),s()},children:"취소"})]}),be=({label:r,checked:s,id:n,onChange:t,className:h="",disabled:f=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${f?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:n,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${h}`,checked:s,onChange:p=>t(p.target.checked),disabled:f}),s&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),f&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),r&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:r})]}),He=g.forwardRef((r,s)=>{const{placeholder:n="Enter your message",rows:t=3,value:h="",onChange:f,className:p="",disabled:x=!1,error:l=!1,hint:m=""}=r,c=N=>{f&&f(N.target.value)};let v=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${p} `;return x?v+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":l?v+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":v+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:s,placeholder:n,rows:t,value:h,onChange:c,disabled:x,className:v}),m&&e.jsx("p",{className:`mt-2 text-sm ${l?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:m})]})}),K=({name:r,placeholder:s,value:n,onChange:t,className:h="",allClassName:f="",min:p,max:x,step:l,disabled:m=!1,success:c=!1,error:v=!1,control:N,rules:C=null,defaultValue:k="",...u})=>{const y=N?._formState?.errors?.[r],i=v||!!y,j=w=>{t&&t(w)};let d=` h-11 w-full rounded-lg border appearance-none px-4 py-2.5 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-hidden focus:ring-3  dark:bg-zinc-950 dark:text-white/90 dark:placeholder:text-white/30 ${h}`;return m?d+=" text-gray-500 border-gray-300 opacity-40 bg-gray-100 cursor-not-allowed dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700 opacity-40":i?d+="  border-red-500 focus:border-red-300 focus:ring-red-500/20 dark:text-red-400 dark:border-red-500 dark:focus:border-red-800":c?d+="  border-green-500 focus:border-green-300 focus:ring-green-500/20 dark:text-green-400 dark:border-green-500 dark:focus:border-green-800":d+=" bg-transparent text-gray-800 border-gray-300 focus:border-brand-300 focus:ring-brand-500/20 dark:border-gray-700 dark:text-white/90  dark:focus:border-brand-800",e.jsxs("div",{className:`relative ${f}`,children:[e.jsx("input",{type:"text",name:r,placeholder:s,onChange:j,min:p,max:x,step:l,disabled:m,className:d,...N?C?N.register(r,C):N.register(r):{},...u}),y&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.message})]})},ze=({name:r,options:s,rules:n,control:t,onChange:h,placeholder:f="Select Option",className:p="",allClassName:x=""})=>{const l=m=>{h(m)};return e.jsxs("div",{className:`relative ${x}`,children:[e.jsxs("select",{className:`h-11 w-full appearance-none rounded-lg border border-gray-300 
          bg-transparent px-4 py-2.5 pr-11 text-sm shadow-theme-xs placeholder:text-gray-400 
          focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 
          dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:placeholder:text-white/30 
          dark:focus:border-brand-800 dark:bg-dark-900
          ${p}`,name:r,...t?t.register(r,n):{},onChange:l,children:[e.jsx("option",{value:"",disabled:!0,className:"text-gray-700 dark:bg-zinc-950 dark:text-gray-400",children:f}),s.map(m=>e.jsx("option",{value:m.value,className:"text-gray-700 dark:bg-zinc-950 dark:text-gray-400",children:m.label},m.value))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 h-11",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})};var V={exports:{}},St=V.exports,ke;function Tt(){return ke||(ke=1,function(r,s){(function(n,t){t(s)})(St,function(n){var t=typeof window<"u"&&window.flatpickr!==void 0?window.flatpickr:{l10ns:{}},h={weekdays:{shorthand:["일","월","화","수","목","금","토"],longhand:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"]},months:{shorthand:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],longhand:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"]},ordinal:function(){return"일"},rangeSeparator:" ~ ",amPM:["오전","오후"]};t.l10ns.ko=h;var f=t.l10ns;n.Korean=h,n.default=f,Object.defineProperty(n,"__esModule",{value:!0})})}(V,V.exports)),V.exports}var Lt=Tt();function qe({id:r,name:s,mode:n,onChange:t,label:h,defaultDate:f,placeholder:p,control:x,rules:l=null,...m}){return g.useEffect(()=>{const c=ht(`#${r}`,{mode:n||"single",static:!1,monthSelectorType:"static",dateFormat:"Y-m-d",defaultDate:f,onChange:t,position:"auto",positionElement:void 0,locale:Lt.Korean});return()=>{c&&!Array.isArray(c)&&c.destroy()}},[n,t,r,f]),e.jsxs("div",{children:[h&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:r,children:h}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:r,name:s,...x?l?x.register(s,l):x.register(s):{},...m,placeholder:p,className:"h-11 w-full rounded-lg border appearance-none px-4 py-2.5 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-hidden focus:ring-3  dark:bg-zinc-950 dark:text-white/90 dark:placeholder:text-white/30  bg-transparent text-gray-800 border-gray-300 focus:border-brand-300 focus:ring-brand-500/20 dark:border-gray-700  dark:focus:border-brand-800"}),e.jsx("span",{className:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400",children:e.jsx(Ge,{className:"size-6"})})]})]})}const Dt=g.lazy(()=>De(()=>import("./index-CAG_AkkJ.js").then(r=>r.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32])));nt.Quill.register("modules/imageDrop",lt);Le.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const Et={syntax:{highlight:r=>Le.highlightAuto(r).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},It=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],Rt=r=>{const[s,n]=g.useState(r.imageList),[t,h]=g.useState(r.htmlCheck==="Y"),[f,p]=g.useState(r.iconCheck==="Y"),[x,l]=g.useState(r.newMode?"":r.content),[m,c]=g.useState(),v=g.useRef(),N=g.useRef(),C=g.useRef(null);g.useRef(null);const k=g.useRef(null),u=r.newMode,y=g.useRef([]),{height:i}=Te(),j=gt.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),d={edTitle:u?"":r.title,edGbn:r.gbn?r.gbn:"etc",edDate:u?j:r.date,content:u?"":r.content,memoTxt:u?"":r.content,htmlCheck:r.htmlCheck,iconCheck:r.iconCheck},{register:w,handleSubmit:T,trigger:F,control:D,setValue:P,getValues:Y,watch:oe,formState:{errors:ve,isSubmitting:ae}}=Ue({mode:"onChange",defaultValues:d});g.useEffect(()=>{w("edDate"),w("edGbn",{required:!0}),w("htmlCheck"),w("iconCheck"),w("memoTxt")},[]),g.useEffect(()=>{y.current=[],v.current=r.content,N.current=!1},[r.content]);const G=async a=>{u?await r.onNewSubmit(a,y.current):await r.onPostSubmit(a,s,y.current)},ne=()=>{T(G)()},le=a=>{console.log("onDelete.imageList=",a),n(a)},ie=a=>{console.log("onInsert.file",a);let $=v.current;a.ext==="jpg"||a.ext==="png"?($+=`<img src='${a.url}'/>`,b(`<img src='${a.url}'/>
`)):a.ext==="mp4"?($+=`<video preload="auto" controls="" src='${a.url}'></video>`,b(`<video preload="auto" controls="" src='${a.url}'></video>`)):($+=`<a src='${a.url}'>${a.name}}</a>`,b(`다운로드
<a href="${a.url}" target="_blank">${a.name}</a>
`)),v.current=$},_=a=>r.onRename(a,Y("edTitle")),A=a=>{v.current=a},ce=a=>{console.log("handleFileUpload",a),y.current=a};function de(a){v.current=a,P("content",a),F("content")}const Q=(a,$)=>{console.log(`onChecked.e.${a}=`,$),P(a,$?"Y":"N"),console.log(`onChecked.v.${a}=`,Y(a)),a==="htmlCheck"?h($):p($)},me=oe("content"),ue=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],o=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],b=a=>{const $=C.current;if($){const z=$.selectionStart,U=$.selectionEnd,H=x.slice(0,z),Z=x.slice(U);l(H+a+Z),P("memoTxt",H+a+Z),setTimeout(()=>{$.selectionStart=$.selectionEnd=z+a.length,$.focus()},0)}},S=a=>{b(a)},L=a=>a?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(a)||a.includes("image")||a.includes("img"):!1,M=a=>new Promise(($,z)=>{const U=new Image;U.crossOrigin="anonymous",U.onload=()=>{const H=document.createElement("canvas"),Z=H.getContext("2d");H.width=U.width,H.height=U.height,Z.drawImage(U,0,0);try{const X=H.toDataURL("image/png");console.log("convertImageToBase64.base64=",X.substring(0,30)+"..."),$(X)}catch(X){z(X)}},U.onerror=()=>{z(new Error("Failed to load image"))},U.src=a});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:T(G),style:{width:"100%",minHeight:"300px",maxHeight:{height:i},display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsx(be,{id:"htmlCheck",checked:t,onChange:a=>Q("htmlCheck",a),label:"HTML사용"}),e.jsx(be,{id:"iconCheck",checked:f,onChange:a=>Q("iconCheck",a),label:"Icon"}),e.jsx(Ye,{onSubmit:a=>ne(),onCancel:r.onCancel,isSubmitting:ae,newMode:u})]}),e.jsx(Ee,{control:D,onDelete:le,onInsert:ie,onRename:_,setContent:A,onFileUpload:ce,imageList:r.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(K,{name:"edTitle",placeholder:"제목",control:D,rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:a=>{a.preventDefault(),P("edTitle",a.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ze,{name:"edGbn",label:"구분",control:D,rules:{required:!0},placeholder:"-- 구분 --",options:ue,className:"",allClassName:"max-w-40",onChange:a=>{a.preventDefault();const $=a.target.value;console.log("edGbn=",Y("edGbn")),P("edGbn",$)}}),e.jsx(qe,{id:"edDate",name:"edDate",placeholder:"Select a date",control:D,onChange:(a,$)=>{console.log({dates:a,currentDateString:$}),P("edDate",$)}})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(fe,{postData:x})}),e.jsxs("div",{children:[e.jsx(He,{ref:C,className:"",value:x,onChange:a=>{P("memoTxt",a),l(a)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(I,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S(`<box>
</box>`),children:"<Box>"}),e.jsx(I,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(I,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(I,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(I,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<hr style="width=100%"/>'),children:"line"}),o.map((a,$)=>e.jsx(I,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>S("<code>"+a+`
</code>`),children:a},$))]})]}),Y("edUrl")&&L(Y("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:m,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async a=>{try{const $=await M(m);P("edUrl2",$)}catch($){console.error("Base64 conversion failed:",$)}},onError:a=>{a.target.style.display="none"}})})]}),t&&e.jsx(g.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(Dt,{ref:k,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:me,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:Et,formats:It,onChange:de})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},ye=r=>{const{rootDb:s,isLoading:n,memoDetailData:t}=r,{scrollYProgress:h}=he();xe(h,{stiffness:100,damping:30,restDelta:.001});const f=O(),p=g.useRef(),x=g.useRef();x.current=r.searchWord;const{memoId:l}=ge(),m=se(),{user:c}=J();p.current=m.pathname.split("/")[2]==="insert",console.log("memoDetailData=",t);const v=()=>{const i=`/${s==="memo"?"m":s}/${l==="insert"?"":l}`;f(i)},N=async i=>{await q(c.uid,l,i)},C=async i=>{if(console.log("onFilePathList.fileNm=",i),i.length>0)for(let j=0;j<i.length;j++){const d=i[j];console.log("onFilePathList.file=",d);try{const w=await q(c.uid,l,d);console.log("onFilePathList.path=",w)}catch{console.log("onFilePathList.error=",d)}}else await q(c.uid,l,i)},k=async(i,j)=>{console.log("onNewSubmit.values",i);const d=await te({rootDb:s,uid:c.uid,newData:p.current,key:l==="insert"?"root":l,values:i});if(await re(`${s}_txt`,s,d,j),d!==void 0){const w=`/${s==="memo"?"m":s}/${d}`;f(w,{state:{reflash:!0}})}},u=async(i,j)=>{const d=s==="memo"?`${s}/${c.uid}/`:`${s}/`,w=await Ae(d,i.key,j,i.ext);if(w.success){const T=s==="memo"?`${s}_txt/${c.uid}/${l}/image/`:`${s}_txt/${l}/image/`;return R(T+i.key,null),i.key=w.key,i.url=w.url,i.name=w.key+"."+i.ext,R(T+w.key,i),console.log("onRename.file",i),i}},y=async(i,j,d)=>{const w=s==="memo"?`${s}_txt/${c.uid}/`:`${s}_txt/`;s==="memo"?`${s}${c.uid}`:`${s}`,await Ie(w,s==="memo"?`${s}/${c.uid}/`:`${s}/`,l,j),console.log("onPostSubmit.values",i);const T=await te({rootDb:s,uid:c.uid,newData:p.current,key:l==="insert"?"root":l,values:i});console.log("onPostSubmit.newKey=",T),console.log("onPostSubmit.files=",d);const F=await re(`${w}`,s==="memo"?`${s}/${c.uid}/`:`${s}/`,l,d);console.log("onNewSubmit.imageResult",F),s==="memo"&&R(`memo_tree/${c.uid}/${l}/title`,i.edTitle),p.current=!1;const D=`/${s==="memo"?"m":s}/${l}`;s==="home"&&R("home/tree",null),f(D,{state:{reflash:!0}})};return g.useEffect(()=>{t&&t.title!==void 0&&pe({title:t.title,description:t.title});function i(){document.querySelectorAll("pre").forEach((j,d)=>{})}t&&t.memo!==null&&i()},[t]),l===""||c===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",n),t===void 0||n?e.jsx(B,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:p.current===!1&&t&&(t.title===void 0||t.title===""||t.title===null)?e.jsx(B,{}):e.jsx(Rt,{newMode:p.current,onPostSubmit:y,onNewSubmit:k,onCancel:v,onRename:u,onFilePath:N,onFilePathList:C,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html==="Y"?"Y":"N":"Y",iconCheck:!t?.icon==="Y"?"Y":"N",content:t?.memo,imageList:t?.image})})}))};function Ft({initTreeData:r,userId:s,memoId:n,onClick:t}){const[h,f]=g.useState(r),{isMoble:p,height:x,width:l}=Qe(),m=g.useRef(),c=g.useRef(),v=(k,u)=>{if(u.dragSource.id!==void 0&&u.dropTargetId!==void 0){const y=`memo_tree/${s}/${u.dragSource.id}/parent`;R(y,u.dropTargetId)}f(k)};g.useEffect(()=>{(()=>{for(const u of r){const y=u.id;u.cnt=r.filter(i=>i.parent===y).length}f(r)})()},[r]);const N=(k,u)=>{const y=[],i=j=>{const d=u.find(w=>w.id===j);if(!d)return!1;if(d.parent&&d.parent!=="root"){if(i(d.parent))return y.push(d.parent),!0}else return!0;return!1};return i(k)?y.reverse():[]},C=k=>{if(!h||!k||!c.current)return;const u=N(k,h);u.length>0&&setTimeout(()=>{c.current.open(u)},500)};return g.useEffect(()=>{m.current===void 0&&n!==void 0&&(m.current=n,C(n))},[h]),h==null||h===""?e.jsx(B,{}):e.jsx(Fe,{backend:Be,options:Pe(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:x-220-(p?56:0)+(l>1024?60:0),width:"100%"},children:e.jsx(_e,{ref:c,tree:h,rootId:"root",onDrop:v,render:(k,{depth:u,isOpen:y,onToggle:i,isDragging:j,isDropTarget:d})=>e.jsxs("div",{className:`w-62 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ml-1 ${j?"opacity-50":""} ${d?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
              ${m.current===k.id?"bg-gray-200 dark:bg-gray-800 rounded-r-lg border-l-4 border-blue-500":""}
              `,style:{paddingLeft:u*20+(k.cnt===0?5:0)-(m.current===k.id?4:0)},children:[e.jsx("div",{className:"min-w-0",children:k.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:i,children:y?e.jsx(kt,{className:"size-6"}):e.jsx(yt,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{m.current=k.id,t(k)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[k.icon,k.text]}),k.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",k.cnt,")"]})]})]})})})})}const Pt=r=>{const s=g.useRef(null);function n(){r.onSearchDataBtn(s.current.value)}function t(){return r.onNewMemoBtn(),!1}function h(f){f.which===13&&n()}return e.jsxs(e.Fragment,{children:[e.jsx(pt,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:s,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:h}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(E,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:t,children:"새글"}),e.jsx(E,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:n,children:"조회"})]})]})};async function Bt(r,s,n=""){if(s==null||s==="")return"";if(r==="home"){const m=await Re("home/tree");if(m!=null)try{return JSON.parse(m)}catch(c){console.error("Error parsing JSON data:",c)}}const t=r==="home"?"home_txt":n===""?`${r}_tree/${s}`:`${r}_txt/${s}`,h=we(Ne(Ce,t)),f=await $e(h);if(!f.exists())return console.log("getTreeData.null"),null;if(!f.exists())return console.log("getTreeData.exists"),null;const p=f.val(),x=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],l=[];r==="home"&&l.push(...x);for(const m in p){const c=p[m];c.id=m;const v={id:m,key:m,text:c.title,parent:r==="home"?c.gbn:c.parent};r==="memo"?(v.icon=c.bm==="Y"?e.jsx(Me,{className:"text-red-500"}):c.icon==="Y"?e.jsx(bt,{}):null,v.droppable=!0):v.droppable=!1,!((n===""||n===void 0||n===null)&&(v.parent===void 0||v.parent===null||v.parent===""))&&(r==="home"||n===""||n===void 0||n===null?l.push(v):(c.id=m,(c.memo+"").toLowerCase().indexOf(n.toLowerCase())>-1&&(v.parent="root",v.droppable=!1,l.push(v))))}return l.sort((m,c)=>m.title>c.title?1:-1),r==="home"&&R("home/tree",JSON.stringify(l)),l}const _t=r=>{const[s,n]=g.useState(r.imageList),[t,h]=g.useState(r.content),[f,p]=g.useState(),x=g.useRef(),l=g.useRef(),m=g.useRef(null),c=g.useRef([]),{height:v}=Te(),N={edTitle:r.title,edGbn:r.gbn?r.gbn:"etc",edDate:r.date,content:r.content,memoTxt:r.content,htmlCheck:"N",iconCheck:"N"},{register:C,handleSubmit:k,trigger:u,control:y,setValue:i,getValues:j,watch:d,formState:{errors:w,isSubmitting:T}}=Ue({mode:"onChange",defaultValues:N});g.useEffect(()=>{C("edDate"),C("memoTxt")},[]),g.useEffect(()=>{c.current=[],x.current=r.content,l.current=!1},[r.content]);const F=async o=>{await r.onPostSubmit(o,s,c.current)},D=()=>{k(F)()},P=o=>{console.log("onDelete.imageList=",o),n(o)},Y=o=>{console.log("onInsert.file",o);let b=x.current;o.ext==="jpg"||o.ext==="png"?(b+=`<img src='${o.url}'/>`,_(`<img src='${o.url}'/>
`)):o.ext==="mp4"?(b+=`<video preload="auto" controls="" src='${o.url}'></video>`,_(`<video preload="auto" controls="" src='${o.url}'></video>`)):(b+=`<a src='${o.url}'>${o.name}}</a>`,_(`다운로드
<a href="${o.url}" target="_blank">${o.name}</a>
`)),x.current=b},oe=o=>r.onRename(o,j("edTitle")),ve=o=>{x.current=o},ae=o=>{console.log("handleFileUpload",o),c.current=o};function G(o){_(`<img src='${o}'/>`)}function ne(){console.log("HtmlEditor.imageList=",s);let o="";s&&s.length>0&&s.map((b,S)=>{o+=`<img src="/data/memo/${b.key}.${b.ext}" style="width: 50px;"/>
`}),o!==""&&_(o)}const le=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],ie=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],_=o=>{const b=m.current;if(b){const S=b.selectionStart,L=b.selectionEnd,M=t.slice(0,S),a=t.slice(L);h(M+o+a),i("memoTxt",M+o+a),setTimeout(()=>{b.selectionStart=b.selectionEnd=S+o.length,b.focus()},100)}},A=o=>{_(o)},ce=o=>o?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(o)||o.includes("image")||o.includes("img"):!1,de=async()=>{const o=await xt("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile.result=",o)},Q=async()=>{const o=await ft("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile10.result=",o);let b="";o.map(S=>{b+=S+`
`}),_(b)},me=async()=>{const o=j("edFilePath");if(o===""){const b=[];let S=m.current.value;S=S.replace(/<img src="\/data\/memo\//g,""),S=S.replace(/ style="width: 50px;"/g,""),S=S.replace(/"\/>/g,""),S=S.replace(/ /g,""),S.split(`
`).forEach(async L=>{L.indexOf(".")>0&&(b.push(L),console.log(L))}),b.length>0&&(console.log(b),await r.onFilePathList(b))}else await r.onFilePath(o)},ue=o=>new Promise((b,S)=>{const L=new Image;L.crossOrigin="anonymous",L.onload=()=>{const M=document.createElement("canvas"),a=M.getContext("2d");M.width=L.width,M.height=L.height,a.drawImage(L,0,0);try{const $=M.toDataURL("image/png");console.log("convertImageToBase64.base64=",$.substring(0,30)+"..."),b($)}catch($){S($)}},L.onerror=()=>{S(new Error("Failed to load image"))},L.src=o});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:k(F),style:{width:"100%",minHeight:"300px",maxHeight:{height:v},display:"flex",flexDirection:"column"},children:[e.jsx(Ye,{onSubmit:o=>D(),onCancel:r.onCancel,isSubmitting:T}),e.jsx(Ee,{control:y,onDelete:P,onInsert:Y,onRename:oe,setContent:ve,onFileUpload:ae,imageList:r.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(K,{name:"edTitle",placeholder:"제목",control:y,rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:o=>{o.preventDefault(),i("edTitle",o.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ze,{name:"edGbn",label:"구분",control:y,rules:{required:!0},placeholder:"-- 구분 --",options:le,className:"",allClassName:"max-w-40",onChange:o=>{o.preventDefault();const b=o.target.value;console.log("edGbn=",j("edGbn")),i("edGbn",b)}}),e.jsx(qe,{id:"edDate",name:"edDate",placeholder:"Select a date",control:y,onChange:(o,b)=>{console.log({dates:o,currentDateString:b}),i("edDate",b)}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{name:"edUrl",placeholder:"Base64로 만들 URL",control:y,allClassName:"w-full",onChange:o=>{o.preventDefault();const b=o.target.value;console.log("edUrl=",b),i("edUrl",b),p(b)}}),e.jsx(E,{variant:"outlined",color:"success",onClick:o=>{o.preventDefault(),G(j("edUrl2"))},children:"적용"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{name:"edUrl2",placeholder:"Base64 이미지 데이터",allClassName:"w-full",variant:"filled",size:"small",value:j("edUrl2")||""}),e.jsx(E,{variant:"outlined",color:"success",onClick:o=>{o.preventDefault(),ne()},children:"첨부추가"})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(K,{name:"edFilePath",placeholder:"이미지리스트에 추가할 파일명",allClassName:"w-full",control:y,onChange:o=>{o.preventDefault();const b=o.target.value;i("edFilePath",b)}}),e.jsx(E,{variant:"outlined",color:"success",onClick:o=>{o.preventDefault(),me()},children:"파일경로"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{variant:"outlined",color:"success",onClick:o=>{o.preventDefault(),de()},children:"전체파일"}),e.jsx(E,{variant:"outlined",color:"success",onClick:o=>{o.preventDefault(),Q()},children:"전체파일10"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(fe,{postData:t})})}),e.jsxs("div",{children:[e.jsx(He,{ref:m,className:"",value:t,onChange:o=>{i("memoTxt",o),h(o)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(I,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A(`<box>
</box>`),children:"<Box>"}),e.jsx(I,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(I,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(I,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(I,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<hr style="width=100%"/>'),children:"line"}),ie.map((o,b)=>e.jsx(I,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>A("<code>"+o+`
</code>`),children:o},b))]})]}),j("edUrl")&&ce(j("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:f,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async o=>{try{const b=await ue(f);i("edUrl2",b)}catch(b){console.error("Base64 conversion failed:",b)}},onError:o=>{o.target.style.display="none"}})})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},Mt=r=>{const{rootDb:s,isLoading:n,memoDetailData:t}=r,{scrollYProgress:h}=he();xe(h,{stiffness:100,damping:30,restDelta:.001});const f=O(),p=g.useRef();p.current=r.searchWord;const{memoId:x}=ge();se();const{user:l}=J();console.log("memoDetailData=",t);const m=()=>{const u=`/${s==="memo"?"m":s}/${x==="insert"?"":x}`;f(u)},c=async u=>{await q(l.uid,x,u)},v=async u=>{if(console.log("onFilePathList.fileNm=",u),u.length>0)for(let y=0;y<u.length;y++){const i=u[y];console.log("onFilePathList.file=",i);try{const j=await q(l.uid,x,i);console.log("onFilePathList.path=",j)}catch{console.log("onFilePathList.error=",i)}}else await q(l.uid,x,u)},N=async(u,y)=>{console.log("onNewSubmit.values",u);const i=await te({rootDb:s,uid:l.uid,newData:!1,key:x,values:u});if(await re(`${s}_txt`,s,i,y),i!==void 0){const j=`/${s==="memo"?"m":s}/${i}`;f(j,{state:{reflash:!0}})}},C=async(u,y)=>{const i=s==="memo"?`${s}/${l.uid}/`:`${s}/`,j=await Ae(i,u.key,y,u.ext);if(j.success){const d=s==="memo"?`${s}_txt/${l.uid}/${x}/image/`:`${s}_txt/${x}/image/`;return R(d+u.key,null),u.key=j.key,u.url=j.url,u.name=j.key+"."+u.ext,R(d+j.key,u),console.log("onRename.file",u),u}},k=async(u,y,i)=>{const j=s==="memo"?`${s}_txt/${l.uid}/`:`${s}_txt/`;s==="memo"?`${s}${l.uid}`:`${s}`,await Ie(j,s==="memo"?`${s}/${l.uid}/`:`${s}/`,x,y),console.log("onPostSubmit.values",u);const d=await te({rootDb:s,uid:l.uid,newData:!1,key:x==="insert"?"root":x,values:u});console.log("onPostSubmit.newKey=",d),console.log("onPostSubmit.files=",i);const w=await re(`${j}`,s==="memo"?`${s}/${l.uid}/`:`${s}/`,x,i);console.log("onNewSubmit.imageResult",w),s==="memo"&&R(`memo_tree/${l.uid}/${x}/title`,u.edTitle);const T=`/${s==="memo"?"m":s}/${x}`;s==="home"&&R("home/tree",null),f(T,{state:{reflash:!0}})};return g.useEffect(()=>{t&&t.title!==void 0&&pe({title:t.title,description:t.title});function u(){document.querySelectorAll("pre").forEach((y,i)=>{})}t&&t.memo!==null&&u()},[t]),x===""||l===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",n),t===void 0||n?e.jsx(B,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:t&&(t.title===void 0||t.title===""||t.title===null)?e.jsx(B,{}):e.jsx(_t,{onPostSubmit:k,onNewSubmit:N,onCancel:m,onRename:C,onFilePath:c,onFilePathList:v,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html==="Y"?"Y":"N":"Y",iconCheck:!t?.icon==="Y"?"Y":"N",content:t?.memo,imageList:t?.image})})}))},Ut=g.lazy(async()=>await De(()=>import("./TwMemoMain-Cg0HjAQf.js"),__vite__mapDeps([33,1,2,25,34]))),Br=({rootDb:r})=>{const s=O(),{user:n}=J(),t=g.useRef(),h=g.useRef(!0),f=g.useRef(),p=g.useRef(),[x,l]=g.useState(),m=g.useRef(!1),c=se(),v=g.useRef(!1);v.current=c?.state?.reflash===!0;const N=tt({queryKey:["twTreeData",n?.uid,t.current],queryFn:()=>Bt(r,n?.uid,t.current)});N.data!==void 0&&N.data!==""&&!m.current&&(m.current=!0);const C=()=>{const d=x;d&&(d.bookmark=d.bookmark==="Y"?"N":"Y");const w=`memo_tree/${n.uid}/${p.current}/bm`;R(w,x.bookmark),l({...x,bookmark:d.bookmark})};g.useEffect(()=>{n!==void 0&&n!=null&&N.refetch()},[n]),g.useEffect(()=>{const d=async F=>{if(F!==""&&n){const D=await vt(r,n?.uid,F,t.current);r==="memo"&&(D.path=At(N.data,F)),D.code==="404"&&(D.title="No title"),h.current=!1,l(D===void 0?{}:D)}},w=c.pathname.split("/"),T=w.length>2?w[w.length-1]:"";h.current=!0,d(T),p.current=T},[c.pathname,n,v.current]),g.useEffect(()=>{console.log("useEffect.reflash=",v.current),n!==void 0&&n!=null&&N.refetch()},[v.current]);const k=d=>{m.current=!1,d!==void 0&&(t.current=d),N.refetch()},u=d=>{d.id!==p.current&&(h.current=!0,s(`/${r==="memo"?"m":r}/${d.id}`))},y=()=>{if(n==null){alert("로그인 후 이용 가능합니다.");return}const d=`/${r==="memo"?"m":r}/insert/insert`;s(d)},i=d=>{},j=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3",children:e.jsx(jt,{to:"/m",children:r==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[r==="memo"?"":e.jsx(ee,{to:"/m",children:"메모"}),r==="memo"&&n?.uid==="I3cTgdCxwjhBBno4mtZYvnODPJu1"?e.jsx(ee,{to:"/home",children:"홈관리"}):null,e.jsx(ee,{to:"/todo",children:"TODO"}),e.jsx(ee,{to:"/tw",children:"Sheet"})]}),e.jsx(Pt,{onNewMemoBtn:y,onSearchDataBtn:k}),m.current&&N.isFetched?e.jsx(Ft,{expandIndex:f.current,initTreeData:N.data,userId:n?.uid,memoId:p.current,onClick:u}):n===void 0?e.jsx(e.Fragment,{}):e.jsx(B,{})]});return n&&n.uid===Se&&Ze,e.jsxs(Xe,{sideType:"memo",title:r==="memo"?"메모장":"홈페이지관리",sideContents:j,children:[e.jsx(g.Suspense,{fallback:e.jsx(B,{}),children:e.jsxs(et,{children:[e.jsx(W,{path:"/edit/:memoId",element:e.jsx(ye,{rootDb:r,isLoading:h.current,searchWord:t.current,memoDetailData:x})}),e.jsx(W,{path:"/insert/:memoId",element:e.jsx(ye,{rootDb:r,isLoading:h.current,searchWord:t.current,memoDetailData:x})}),e.jsx(W,{path:"/util/:memoId",element:e.jsx(Mt,{rootDb:r,isLoading:h.current,searchWord:t.current,memoDetailData:x})}),e.jsx(W,{path:"/:memoId",element:e.jsx($t,{rootDb:r,isLoading:h.current,searchWord:t.current,memoDetailData:x,onTreeUpdate:k,onBookmark:C,data:N.data})}),e.jsx(W,{path:"*",element:e.jsx(Ut,{searchWord:t.current,data:N.data,onNewMemoBtn:y,title:r==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),r==="memo"?e.jsx(Nt,{onSelected:i}):"",e.jsx(rt,{})]})},At=(r,s)=>{let n=[],t=s;if(!r)return n;const h=r.find(f=>f.id===t);for(n.unshift(h),t=h?.parent;t!=null&&t!==""&&t!=="root";){const f=r.find(p=>p.id===t);t=f?.parent,n.unshift(f)}return n};export{Br as default};
