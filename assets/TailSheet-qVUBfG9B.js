import{j as o,r as m,P as ee,cO as W,q as te,o as oe,n as d,am as ne,O as g,Y as se,Z as le,t as u,A as re}from"./index-CNjKK903.js";import{I as ie,T as z}from"./InputField-BlWkTPoa.js";import{H as ae,r as ce}from"./registry-CaPVRRCW.js";import{D as de}from"./datetime-BDx6lZXm.js";import{a as ue}from"./index.esm-Ca75EsPz.js";import{S as me}from"./Select-CZeGLLku.js";import{n as fe}from"./handson-CS9Rir92.js";import{T as w}from"./TailButton-D2_HX-3Y.js";const he=r=>o.jsxs("div",{className:"my-2 flex justify-end items-center",sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[o.jsx(w,{size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:r.onInsert,children:"추가"}),o.jsx(w,{type:"button",size:"sm",variant:"outlined",color:"error",className:"mr-2",onClick:r.onDelete,children:"삭제"}),o.jsx(w,{type:"button",size:"sm",variant:"outlined",color:"success",className:"mr-2",onClick:r.onReload,children:"리로드"}),o.jsx(w,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:r.onCsvSave,children:"csv저장"})]});ce();const ge=({csvFileName:r="exported_sheet",baseUrl:f="sheet",columns:x,selectDefault:C="1",keyId:H,userId:y})=>{const i=m.useRef(null),p=m.useRef(null),[j,O]=m.useState(),[V,b]=m.useState(0),{height:I,width:xe}=ee(),{settings:R,changeColWidths:_}=W(),B={edTitle:"",edDate:de.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd")},{register:K,reset:pe,control:S,setValue:F,getValues:D,formState:{errors:A}}=ue({mode:"submit ",defaultValues:B}),{theme:M}=W(),L=M==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",q=async e=>{console.log("onFunPost.data=",e.id,e);const t=`${f}/${y}/`;if(e.id===void 0||e.id===null||e.id===""){const n=se(le(d(u),t)).key;console.log("onFunPost.newKey",n),e.id=n}return g(d(u,t+e.id+"/dv"),e.dv),g(d(u,t+e.id+"/title"),e.title),g(d(u,t+e.id+"/t1"),e.t1),g(d(u,t+e.id+"/t2"),e.t2),g(d(u,t+e.id+"/ing"),"1"),e},G=async()=>{const e=`${f}/${y}/`,t=te(d(u,e),oe("dv"));ne(t,n=>{if(!n.exists())return;const l=n.val(),a=[];for(let c in l){const s=l[c];s.id=c,s.sort=`${s.dv}_${s.title}`,a.push(s)}a.sort((c,s)=>c.sort>s.sort?1:-1),O(a),b(a.length)})};m.useEffect(()=>{K("filterField1"),F("columns1",C)},[]),m.useEffect(()=>{y!==void 0&&G()},[y]),m.useEffect(()=>{i.current.hotInstance.addHook("afterColumnResize",function(t,n){const l=R.colWidths;l[n]=t,_(l)})},[i.current]);const U=async()=>{E()},Z=async()=>{i.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:r,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},P=[],N={indicators:!0},k=[];x.map((e,t)=>{e.select&&P.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&k.push(t)}),N.columns=k;const E=()=>{try{const e=i.current?.hotInstance,t=e?.getPlugin("filters");if(t){const n=D("columns1");console.log("onKeyUp.columns1=",n,"text=",D("filterField1")),x.forEach((c,s)=>{t?.removeConditions(s)}),t?.addCondition(Number(n),"contains",[D("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",i.current);const a=e.getData().length;b(a)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function Y(){i.current.hotInstance.alter("insert_row_above",0,1)}const J=async(e,t)=>{if(e!==null){console.log("afterChange.change=",e,", source=",t,", change.length=",e?.length);const n=i.current?.hotInstance;if(n?.getPlugin("filters")){const a=n.getData(),c=[];e.forEach((s,T)=>{const v={};x.forEach((h,X)=>{v[h.data]=a[s[0]][X]}),c.push(v)}),c.forEach(async(s,T)=>{const v=await q(s);console.log("afterChange.result=",T,", result=",v),j.map(h=>{(h.id===void 0||h.id===null)&&(h.id=v?.id,console.log("afterChange.rowData2=",h))})}),n.render()}}},Q=async()=>{const e=i.current.hotInstance;if(console.log("onDelete:",e),e&&p.current!==null){if(e?.getPlugin("filters")){const n=e.getData();console.log("onDelete.filteredData=",n[p.current]);const l=n[p.current][H];console.log("onDelete.deleteId=",l),window.confirm("삭제하시겠습니까?")&&g(d(u,`${f}/${y}/${l}`),null)}e.alter("remove_row",p.current,1)}},$=e=>{const t=e.target.value;console.log("onChange.target=",e.target.value),F(e.target.name,t)};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[o.jsx(me,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:S,className:"dark:bg-dark-900",defaultValue:C||"1",options:P,error:!!A.columns1,onChange:$}),o.jsx(ie,{name:"filterField1",control:S,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",onKeyUp:E,onChange:$})]}),o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[o.jsx(z,{textAlign:"left",children:"건수 : "+fe(V)}),o.jsx(he,{onInsert:Y,onDelete:Q,onReload:U,onCsvSave:Z})]}),o.jsx("div",{className:"grid grid-cols-1",style:{maxHeight:`${I} - 210`,overflow:"auto"},children:o.jsx(ae,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:i,data:j,themeName:L,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:I-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:J,afterSelection:e=>{p.current=e},licenseKey:"non-commercial-and-evaluation",columns:x,cells:(e,t)=>x[t].readOnly===!0?{readOnly:!0}:{},colWidths:R.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:N})})]})};function Se(){const{user:r}=re(),f=[{title:"구분",data:"dv",readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"설명1",type:"text",data:"t1",select:!0},{title:"설명2",type:"text",data:"t2",select:!0},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!1}];return r===void 0?o.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:o.jsx(z,{children:"로그인을 해야 이용 가능합니다."})}):o.jsx(ge,{csvFileName:"exported_sheet",baseUrl:"sheet",columns:f,selectDefault:"1",keyId:f.length-1,userId:r?.uid})}export{Se as default};
