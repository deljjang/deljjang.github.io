import{G as N,e as S,r as m,w as B,cf as E,j as e,cg as W,M as h,x as $,ch as C,ci as O,k as v,cj as U,n as q,v as d,bk as H,s as K}from"./index-CWXZ9Iq7.js";import{T as y,a as Q,b as Y,c as _,d as D}from"./TwMemoMain-f4pI3Ut3.js";import{f as G}from"./fireMemoDetail-BduFqwbn.js";import{g as z,H as A}from"./HomeChartForm-d-P6s9-t.js";import"./TwTitleItem-DohviPhG.js";import"./SinyImageList-BNGkuYN9.js";import"./ImageListItem-CyddnCPN.js";import"./HtmlCode-CDmNEW7V.js";/* empty css                 */import"./copy-ClEKdPPf.js";import"./TwBadge-D7d4nW_h.js";import"./ComponentCard-BXZLOOkn.js";import"./TwRadio-D34cp2jy.js";import"./toPropertyKey-DCwh5dYN.js";import"./CodeText-BRVgeDAS.js";import"./commonUtil-B50YfFwa.js";import"./useWindowDimensions-CUP5TSpt.js";import"./datetime-BDx6lZXm.js";import"./index.esm-DUnqmaXe.js";import"./TwCheckbox-C9vQDU0i.js";import"./TwTextArea-BF_wguLQ.js";import"./SinyDate-CpWx5gc7.js";import"./Grid-Bx-A-J7h.js";import"./index-DuSkT2D9.js";import"./TextField-XAy3nOlk.js";import"./InputAdornment-CDjNKjRu.js";import"./Popper-CsuMSaOJ.js";import"./Button-BeXkAMi8.js";import"./Chip-Dj2J4FBL.js";import"./TwSelect-avrh6J9j.js";import"./TwDatePicker-nJc40A4s.js";import"./IpInfo-1Q595Rrq.js";import"./HomeChartSemiDonut-DsEJtQFt.js";const Re=({rootDb:t})=>{const p=N(),{user:r}=S(),s=m.useRef(),n=m.useRef(!0),o=m.useRef(),[c,x]=m.useState(),f=m.useRef(!1),j=B(),k=m.useRef(!1);k.current=j?.state?.reflash===!0;const i=E({queryKey:["twTreeData",r?.uid,s.current],queryFn:()=>z(t,r?.uid,s.current)});i.data!==void 0&&i.data!==""&&!f.current&&(f.current=!0);const L=()=>{const a=c;a&&(a.bookmark=a.bookmark==="Y"?"N":"Y"),console.log("onBookmark.memoDetailData.bookmark=",a.bookmark),console.log("onBookmark.rootDb=",t);const u=t==="memo"?`memo_tree/${r.uid}/${o.current}/bm`:`home_txt/${o.current}/bookmark`;K(u,c.bookmark),x({...c,bookmark:a.bookmark})};m.useEffect(()=>{r!==void 0&&r!=null&&i.refetch()},[r]),m.useEffect(()=>{const a=async T=>{if(T!==""&&r){const l=await G(t,r?.uid,T,s.current);t==="memo"&&(l.path=J(i.data,T)),l.code==="404"&&(l.title="No title"),n.current=!1,x(l===void 0?{}:l)}else x({})},u=j.pathname.split("/"),M=u.length>2?u[u.length-1]:"";n.current=!0,o.current=M,a(M)},[j.pathname,r,k.current]),m.useEffect(()=>{r!==void 0&&r!=null&&i.refetch()},[k.current]);const w=a=>{f.current=!1,a!==void 0&&(s.current=a),i.refetch()},I=a=>{a.id!==o.current&&(n.current=!0,p(`/${t==="memo"?"m":t}/${a.id}`))},g=()=>{if(r==null){alert("로그인 후 이용 가능합니다.");return}const a=`/${t==="memo"?"m":t}/insert/insert`;p(a)},F=a=>{},R=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3 flex items-center justify-center",children:e.jsx(W,{to:t==="memo"?"/m":"/home",children:t==="memo"?"메모장":"홈관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[t==="memo"?"":e.jsx(h,{to:"/m",children:"메모"}),t==="memo"&&r?.uid===$?e.jsx(h,{to:"/home",children:"홈관리"}):null,e.jsx(h,{to:"/todo",children:"TODO"}),e.jsx(h,{to:"/tw",children:"Sheet"})]}),r!==null&&e.jsx(C,{onNewMemoBtn:g,onSearchDataBtn:w}),f.current&&i.isFetched?e.jsx(O,{initTreeData:i.data,userId:r?.uid,memoId:o.current,onClick:I}):r===null?e.jsx(e.Fragment,{}):e.jsx(v,{})]});return e.jsxs(U,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:R,children:[e.jsx(m.Suspense,{fallback:e.jsx(v,{}),children:e.jsxs(q,{children:[e.jsx(d,{path:"/edit/:memoId",element:e.jsx(y,{rootDb:t,isLoading:n.current,searchWord:s.current,memoDetailData:c})}),e.jsx(d,{path:"/insert/:memoId",element:e.jsx(y,{rootDb:t,isLoading:n.current,searchWord:s.current,memoDetailData:c})}),e.jsx(d,{path:"/util/:memoId",element:e.jsx(Q,{rootDb:t,isLoading:n.current,searchWord:s.current,memoDetailData:c})}),e.jsx(d,{path:"/:memoId",element:e.jsx(Y,{rootDb:t,isLoading:n.current,searchWord:s.current,memoDetailData:c,onTreeUpdate:w,onBookmark:L,data:i.data})}),e.jsx(d,{path:"*",element:e.jsx(_,{searchWord:s.current,data:i.data,onNewMemoBtn:g,title:t==="memo"?"메모장":"홈페이지관리",rootDb:t})})]})}),t==="memo"?e.jsx(D,{onSelected:F}):null,o.current===""?e.jsx(A,{data:i.data}):null,e.jsx(H,{})]})},J=(t,p)=>{let r=[],s=p;if(!t)return r;const n=t.find(o=>o.id===s);for(r.unshift(n),s=n?.parent;s!=null&&s!==""&&s!=="root";){const o=t.find(c=>c.id===s);s=o?.parent,r.unshift(o)}return r};export{Re as default};
