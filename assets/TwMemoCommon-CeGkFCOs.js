const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DyFXEmrU.js","assets/index-C36cakfw.js","assets/index-BA2SFqQN.css","assets/SinySelect-1zNX8d_b.js","assets/Grid-BKn-nKAB.js","assets/index-CJgibTfm.js","assets/TextField-Bkoilq0s.js","assets/InputAdornment-BXzCSTnG.js","assets/Popper--nascY8m.js","assets/Chip-DzAPYKHg.js","assets/index.esm-E8-pDS6o.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-BLPqn-Me.js","assets/TwButton-SakzEqXm.js"])))=>i.map(i=>d[i]);
import{r as d,j as e,m as re,L as Pe,w as Y,l as I,D as ae,x as ne,S as oe,T as ie,z as W,C as _e,q as le,n as Ye,o as Ue,p as ce,t as de,G as me,y as V,K as ue,N as K,i as he,H as ge,f as He,P as ze,Q as Oe,R as Ae,U as We,V as q,W as _,X as xe,Y as fe,d1 as X,$ as M,I as qe,d2 as Ve,a0 as z,a1 as Ke,a2 as Ge,a3 as Je,a4 as Qe,a5 as O,a6 as Xe}from"./index-C36cakfw.js";import{u as Ze}from"./useSuspenseQuery-CYaRxwH1.js";import{T as et,u as pe,a as ve,F as tt,b as st,D as rt,l as at,I as nt,s as Z,d as ee,e as ot}from"./index-DyFXEmrU.js";import{E as it,C as lt}from"./ExpandMore-DHSE0g1K.js";import{F as je}from"./Favorite-DCIqfkHS.js";import{T as D}from"./TwButton-SakzEqXm.js";import{D as ct}from"./datetime-BDx6lZXm.js";import{u as dt}from"./index.esm-E8-pDS6o.js";import"./index-CLQ_oLGC.js";import{S as mt,a as ut}from"./SinySelect-1zNX8d_b.js";import{T as A,I as ht}from"./TextField-Bkoilq0s.js";import{S as gt}from"./check-circle-D3hDriUt.js";import"./useBaseQuery-BaU_WJdB.js";import"./Grid-BKn-nKAB.js";import"./index-CJgibTfm.js";import"./InputAdornment-BXzCSTnG.js";import"./Popper--nascY8m.js";import"./Chip-DzAPYKHg.js";const xt=t=>d.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...t},d.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),ft=t=>d.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),pt=t=>e.jsx(re.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Pe,{to:t.to,className:"text-inherit no-underline cursor-pointer",...t,children:e.jsx(et,{children:t.children})})});function vt({initTreeData:t}){const[a,n]=d.useState(),s=o=>n(o),u=Y();if(d.useEffect(()=>{n(t)},[t]),a==null||a.length===0)return e.jsx(I,{});const x=o=>{console.log("node",o),u(`/m/${o.id}`)};return e.jsx(ae,{backend:oe,options:ne(),children:e.jsx(ie,{tree:a,rootId:"root",onDrop:s,render:(o,{depth:j,isOpen:l,onToggle:i})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:j*20+(o.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[o.cnt>0&&e.jsx("div",{onClick:i,children:l?e.jsx(it,{}):e.jsx(lt,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>x(o),children:o.text})]}),o.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",o.cnt,")"]})]})})})}function jt(t){const{user:a}=W(),n=Y(),[s,u]=d.useState(),[x,o]=d.useState(),j=async l=>{const i=[],c=le(ce(de,`memo_tree/${l}`),Ue("bm"),Ye("Y")),m=await me(c);if(!m.exists()){console.log("getFireData.null");return}const v=m.val();for(let b in v){const f=v[b];f.id=b,f.key=b,f.text=f.title,i.push(f)}i.sort((b,f)=>b.title>f.title?1:-1),u([...i])};return d.useEffect(()=>{a!==void 0&&a!=null&&j(a?.uid)},[a]),d.useEffect(()=>{const l=async(i,c)=>{const m=[...c];if(c)for(const v of c){let b=v;for(;b.parent!=="root";){b.parent,b=await V(`memo_tree/${i}/${b.parent}`);const f={id:b.key,text:b.title,droppable:!1,parent:b.parent};m.filter(k=>k.id===f.id).length===0&&m.push(f)}}for(const v of m){const b=v.id;v.cnt=m.filter(f=>f.parent===b).length}o(m)};s&&s.length>0&&l(a?.uid,s)},[s]),a===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(_e,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((l,i)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{t.onSelected(l.key),n(`/m/${l.key}`)},children:e.jsx("span",{className:"text-base",children:l.title})})},i))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(d.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(vt,{initTreeData:x,uid:a?.uid})})]})}const kt=t=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(D,{size:"sm",variant:"outlined",color:"success",onClick:t.onEdit,children:"수정"}),e.jsx(D,{size:"sm",variant:"outlined",color:"warning",onClick:t.onNewMemo,children:"새글"}),e.jsx(D,{size:"sm",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"})]}),yt=t=>{const{rootDb:a,isLoading:n,memoDetailData:s}=t,{scrollYProgress:u}=pe(),x=ve(u,{stiffness:100,damping:30,restDelta:.001}),o=Y(),j=d.useRef();j.current=t.searchWord;const{memoId:l}=ue(),c=K()?.state?.fullIndex,{user:m}=W(),v=()=>{const p=`/${a==="memo"?"m":a}/edit/${l}`;o(p,{state:{fullIndex:c}})},b=()=>{const p=`/${a==="memo"?"m":a}/insert/${l}`;o(p,{state:{fullIndex:c}})},f=async()=>{const p=a==="memo"?`${a}_txt/${m.uid}/${l}`:`${a}_txt/${l}`,w=a==="memo"?`${a}_tree/${m.uid}`:a;if(await st(p,w)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}t.onTreeUpdate(),o(`/${a==="memo"?"m":a}`)},g=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&f()},k=()=>{t.onBookmark()};return d.useEffect(()=>{s&&s.title!==void 0&&he({title:s.title,description:s.title});function p(){window.scrollTo({top:0}),s&&s.html!=="N"&&document.querySelectorAll("pre").forEach(w=>{w.innerHTML=Ae(w.innerHTML)})}s&&s.memo!==null&&(p(),console.log("useEffect.memoDetailData=",s))},[s]),n?e.jsx(I,{}):l===""||m===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(re.div,{className:"progress-bar",style:{scaleX:x}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:s&&s.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:k,children:s&&s.bookmark==="Y"?e.jsx(je,{className:"text-red-500"}):e.jsx(tt,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:t.memoDetailData?.path&&t.memoDetailData?.path.map((p,w)=>w===0?p.text:` > ${p.text}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(kt,{rootDb:a,onEdit:v,onNewMemo:b,onDelete:g,bookmark:s&&s.bookmark}),e.jsxs("div",{className:"my-4",children:[s&&s.html==="N"?e.jsx(ge,{postData:s&&s.memo}):s&&s.html!=="N"&&s.memo&&e.jsx(He,{text:s.memo}),e.jsx(ze,{imageList:s&&s.image}),!s&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Oe,{})})})]})]})]})},bt=({onSubmit:t,onCancel:a,isSubmitting:n,newMode:s})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(D,{variant:"outlined",color:"success",disabled:n,onClick:u=>{u.preventDefault(),t(u)},children:[s?"새글":""," 저장"]}),e.jsx(D,{variant:"outlined",color:"error",onClick:a,children:"취소"})]});d.forwardRef((t,a)=>{const{id:n,label:s,defaultValue:u,onChange:x,className:o="",...j}=t,l=i=>{x&&x(i.target.value)};return e.jsxs("div",{className:` ${o}`,children:[s&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:n,children:s}),e.jsx("input",{ref:a,type:"date",id:n,defaultValue:u,onChange:l,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...j})]})});const te=({label:t,checked:a,id:n,onChange:s,className:u="",disabled:x=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${x?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:n,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${u}`,checked:a,onChange:o=>s(o.target.checked),disabled:x}),a&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),x&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),t&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:t})]}),wt=d.forwardRef((t,a)=>{const{placeholder:n="Enter your message",rows:s=3,value:u="",onChange:x,className:o="",disabled:j=!1,error:l=!1,hint:i=""}=t,c=v=>{x&&x(v.target.value)};let m=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${o} `;return j?m+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":l?m+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":m+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:a,placeholder:n,rows:s,value:u,onChange:c,disabled:j,className:m}),i&&e.jsx("p",{className:`mt-2 text-sm ${l?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:i})]})}),Ct=d.lazy(()=>fe(()=>import("./index-DyFXEmrU.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));at.Quill.register("modules/imageDrop",nt);xe.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const Nt={syntax:{highlight:t=>xe.highlightAuto(t).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},$t=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],Tt=t=>{const[a,n]=d.useState(t.imageList),[s,u]=d.useState(t.htmlCheck==="Y"),[x,o]=d.useState(t.iconCheck==="Y"),[j,l]=d.useState(t.newMode?"":t.content),[i,c]=d.useState(),m=d.useRef(),v=d.useRef(),b=d.useRef(null);d.useRef(null);const f=d.useRef(null),g=t.newMode,k=d.useRef([]),{height:p}=We(),w=ct.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),y={edTitle:g?"":t.title,edGbn:t.gbn?t.gbn:"etc",edDate:g?w:t.date,content:g?"":t.content,memoTxt:g?"":t.content,htmlCheck:t.htmlCheck,iconCheck:t.iconCheck},{register:C,handleSubmit:E,trigger:L,control:F,setValue:S,getValues:T,watch:ke,formState:{errors:G,isSubmitting:ye}}=dt({mode:"onChange",defaultValues:y});d.useEffect(()=>{C("edDate"),C("edGbn",{required:!0}),C("htmlCheck"),C("iconCheck"),C("memoTxt")},[]),d.useEffect(()=>{k.current=[],m.current=t.content,v.current=!1},[t.content]);const J=async r=>{g?await t.onNewSubmit(r,k.current):await t.onPostSubmit(r,a,k.current)},be=()=>{E(J)()},we=r=>{console.log("onDelete.imageList=",r),n(r)},Ce=r=>{console.log("onInsert.file",r);let h=m.current;r.ext==="jpg"||r.ext==="png"?(h+=`<img src='${r.url}'/>`,B(`<img src='${r.url}'/>
`)):r.ext==="mp4"?(h+=`<video preload="auto" controls="" src='${r.url}'></video>`,B(`<video preload="auto" controls="" src='${r.url}'></video>`)):(h+=`<a src='${r.url}'>${r.name}}</a>`,B(`다운로드
<a href="${r.url}" target="_blank">${r.name}</a>
`)),m.current=h},Ne=r=>{m.current=r},$e=r=>{console.log("handleFileUpload",r),k.current=r};function Te(r){B(`<img src='${r}'/>`)}function De(){console.log("HtmlEditor.imageList=",a);let r="";a&&a.length>0&&a.map((h,N)=>{r+=`<img src="/data/memo/${h.key}.${h.ext}" style="width: 50px;"/>
`}),r!==""&&B(r)}function Se(r){m.current=r,S("content",r),L("content")}function Le(r,h){console.log("handleChangeDate=",r),console.log("handleChangeDate.currentDateString=",h);let N=q(r);console.log("handleChangeDate.dayjs=",N.format("YYYY-MM-DD HH:mm:ss")),S("edDate",N.format("YYYY-MM-DD")),L("edDate")}const Q=(r,h)=>{console.log(`onChecked.e.${r}=`,h),S(r,h?"Y":"N"),console.log(`onChecked.v.${r}=`,T(r)),r==="htmlCheck"?u(h):o(h)},Ie=ke("content"),Ee=[{value:"none",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Re=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],B=r=>{const h=b.current;if(h){const N=h.selectionStart,$=h.selectionEnd,R=j.slice(0,N),U=j.slice($);l(R+r+U),S("memoTxt",R+r+U),setTimeout(()=>{h.selectionStart=h.selectionEnd=N+r.length,h.focus()},0)}},P=r=>{B(r)},Me=r=>r?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(r)||r.includes("image")||r.includes("img"):!1,Fe=async()=>{const r=T("edFilePath");if(r===""){const h=[];let N=b.current.value;N=N.replace(/<img src="\/data\/memo\//g,""),N=N.replace(/ style="width: 50px;"/g,""),N=N.replace(/"\/>/g,""),N=N.replace(/ /g,""),N.split(`
`).forEach(async $=>{$.indexOf(".")>0&&(h.push($),console.log($))}),h.length>0&&(console.log(h),await t.onFilePath(h))}else await t.onFilePath(r)},Be=r=>new Promise((h,N)=>{const $=new Image;$.crossOrigin="anonymous",$.onload=()=>{const R=document.createElement("canvas"),U=R.getContext("2d");R.width=$.width,R.height=$.height,U.drawImage($,0,0);try{const H=R.toDataURL("image/png");console.log("convertImageToBase64.base64=",H.substring(0,30)+"..."),h(H)}catch(H){N(H)}},$.onerror=()=>{N(new Error("Failed to load image"))},$.src=r});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:E(J),style:{width:"100%",minHeight:"300px",maxHeight:{height:p},display:"flex",flexDirection:"column"},children:[e.jsx(bt,{onSubmit:r=>be(),onCancel:t.onCancel,isSubmitting:ye,newMode:g}),e.jsx(rt,{control:F,onDelete:we,onInsert:Ce,setContent:Ne,onFileUpload:$e,imageList:t.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(A,{...C("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!G.edTitle})}),e.jsx(mt,{id:"edGbn",name:"edGbn",label:"구분",control:F,defaultValue:T("edGbn"),selectList:Ee,error:!!G.edGbn,onChange:r=>{r.preventDefault();const h=r.target.value;console.log("edGbn=",T("edGbn")),S("edGbn",h)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ut,{id:"edDate",label:"일자",value:q(T("edDate")),...C("edDate"),defaultValue:q(T("edDate")),onChange:(r,h)=>{Le(r,h)}}),e.jsx(te,{id:"htmlCheck",checked:s,onChange:r=>Q("htmlCheck",r),label:"HTML사용"}),e.jsx(te,{id:"iconCheck",checked:x,onChange:r=>Q("iconCheck",r),label:"Icon"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2  items-center border-t border-gray-300 dark:border-gray-600 my-2",children:[e.jsx(A,{...C("edUrl",{}),label:"URL",placeholder:"URL",variant:"filled",size:"small",onChange:r=>{r.preventDefault();const h=r.target.value;console.log("edUrl=",h),S("edUrl",h),c(h)}}),e.jsx(A,{...C("edUrl2",{}),label:"Base64",placeholder:"Base64 이미지 데이터",variant:"filled",size:"small",value:T("edUrl2")||""}),e.jsx(D,{variant:"outlined",color:"success",onClick:r=>{r.preventDefault(),Te(T("edUrl2"))},children:"적용"}),e.jsx(D,{variant:"outlined",color:"success",onClick:r=>{r.preventDefault(),De()},children:"첨부추가"}),e.jsx(A,{...C("edFilePath",{}),variant:"filled",size:"small",onChange:r=>{r.preventDefault();const h=r.target.value;S("edFilePath",h)}}),e.jsx(D,{variant:"outlined",color:"success",onClick:r=>{r.preventDefault(),Fe()},children:"파일경로"})]}),e.jsx("div",{className:"max-h-150 overflow-y-scroll",children:e.jsx(ge,{postData:j})})]}),e.jsxs("div",{children:[e.jsx(wt,{ref:b,className:"",value:j,onChange:r=>{S("memoTxt",r),l(r)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P(`<box>
</box>`),children:"<Box>"}),e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<hr style="width=100%"/>'),children:"line"}),Re.map((r,h)=>e.jsx(_,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>P("<code>"+r+`
</code>`),children:r},h))]})]}),T("edUrl")&&Me(T("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:i,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async r=>{try{const h=await Be(i);S("edUrl2",h)}catch(h){console.error("Base64 conversion failed:",h)}},onError:r=>{r.target.style.display="none"}})})]}),s&&e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(Ct,{ref:f,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:Ie,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:Nt,formats:$t,onChange:Se})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},se=t=>{const{rootDb:a,isLoading:n,memoDetailData:s}=t,{scrollYProgress:u}=pe();ve(u,{stiffness:100,damping:30,restDelta:.001});const x=Y(),o=d.useRef(),j=d.useRef();j.current=t.searchWord;const{memoId:l}=ue(),i=K(),{user:c}=W();o.current=i.pathname.split("/")[2]==="insert",console.log("memoDetailData=",s);const m=()=>{const g=`/${a==="memo"?"m":a}/${l==="insert"?"":l}`;x(g)},v=async g=>{if(g.length>0)for(let k=0;k<g.length;k++){const p=g[k];console.log("onFilePath.file=",p);try{const w=await X(c.uid,l,p);console.log("onFilePath.path=",w)}catch{console.log("onFilePath.error=",p)}}else await X(c.uid,l,g)},b=async(g,k)=>{console.log("onNewSubmit.values",g);const p=await Z({rootDb:a,uid:c.uid,newData:o.current,key:l==="insert"?"root":l,values:g});if(await ee(`${a}_txt`,a,p,k),p!==void 0){const w=`/${a==="memo"?"m":a}/${p}`;x(w,{state:{reflash:!0}})}},f=async(g,k,p)=>{const w=a==="memo"?`${a}_txt/${c.uid}/`:`${a}_txt/`,y=a==="memo"?`${a}_tree/${c.uid}/`:`${a}/`;await ot(w,y,l,k),console.log("onPostSubmit.values",g);const C=await Z({rootDb:a,uid:c.uid,newData:o.current,key:l==="insert"?"root":l,values:g});console.log("onPostSubmit.newKey=",C),console.log("onPostSubmit.files=",p);const E=await ee(`${w}/`,a==="memo"?`${a}/${c.uid}/`:`${a}/`,l,p);console.log("onNewSubmit.imageResult",E),a==="memo"&&M(`memo_tree/${c.uid}/${l}/title`,g.edTitle),o.current=!1;const L=`/${a==="memo"?"m":a}/${l}`;a==="home"&&M("home/tree",null),x(L,{state:{reflash:!0}})};return d.useEffect(()=>{s&&s.title!==void 0&&he({title:s.title,description:s.title});function g(){document.querySelectorAll("pre").forEach((k,p)=>{})}s&&s.memo!==null&&g()},[s]),l===""||c===void 0?e.jsx(e.Fragment,{}):s===void 0||n?e.jsx(I,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:o.current===!1&&s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(I,{}):e.jsx(Tt,{newMode:o.current,onPostSubmit:f,onNewSubmit:b,onCancel:m,onFilePath:v,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})})};function Dt({initTreeData:t,userId:a,memoId:n,onClick:s}){const[u,x]=d.useState(t),{isMoble:o,height:j,width:l}=qe(),i=d.useRef(),c=d.useRef(),m=(f,g)=>{if(g.dragSource.id!==void 0&&g.dropTargetId!==void 0){const k=`memo_tree/${a}/${g.dragSource.id}/parent`;M(k,g.dropTargetId)}x(f)};d.useEffect(()=>{(()=>{for(const g of t){const k=g.id;g.cnt=t.filter(p=>p.parent===k).length}x(t)})()},[t]);const v=(f,g)=>{const k=[],p=w=>{const y=g.find(C=>C.id===w);if(!y)return!1;if(y.parent&&y.parent!=="root"){if(p(y.parent))return k.push(y.parent),!0}else return!0;return!1};return p(f)?k.reverse():[]},b=f=>{if(!u||!f||!c.current)return;const g=v(f,u);g.length>0&&setTimeout(()=>{c.current.open(g)},500)};return d.useEffect(()=>{i.current===void 0&&n!==void 0&&(i.current=n,b(n))},[u]),u==null||u===""?e.jsx(I,{}):e.jsx(ae,{backend:oe,options:ne(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:j-220-(o?56:0)+(l>1024?60:0),width:"100%"},children:e.jsx(ie,{ref:c,tree:u,rootId:"root",onDrop:m,render:(f,{depth:g,isOpen:k,onToggle:p,isDragging:w,isDropTarget:y})=>e.jsxs("div",{className:`w-62 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ml-1 ${w?"opacity-50":""} ${y?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
              ${i.current===f.id?"bg-gray-200 dark:bg-gray-800 rounded-r-lg border-l-4 border-blue-500":""}
              `,style:{paddingLeft:g*20+(f.cnt===0?5:0)},children:[e.jsx("div",{className:"min-w-0",children:f.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:p,children:k?e.jsx(xt,{className:"size-6"}):e.jsx(ft,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{i.current=f.id,s(f)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[f.icon,f.text]}),f.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",f.cnt,")"]})]})]})})})})}const St=t=>{const a=d.useRef(null);function n(){t.onSearchDataBtn(a.current.value)}function s(){return t.onNewMemoBtn(),!1}function u(x){x.which===13&&n()}return e.jsxs(e.Fragment,{children:[e.jsx(ht,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:a,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:u}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(D,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:s,children:"새글"}),e.jsx(D,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:n,children:"조회"})]})]})},Lt=async(t,a,n,s)=>{let u="",x="",o={};((i,c,m)=>{x=i==="memo"?`${i}/${c}/${m}`:`${i}/${m}`,u=i==="memo"?`${i}_txt/${c}/${m}`:`${i}_txt/${m}`})(t,a,n);async function l(){if(u===void 0)return"";if(o=await V(u),o===void 0)return console.log("No data available"),"";if(o?.fullIndex,o.image!==void 0&&o.image!==null){const i=await Ve(u,x,o.image);o.image=i,(o.imageOK===void 0||o.imageOK==="N")&&(i&&i.map(c=>{c.ext==="jpg"&&(o.memo=o.memo+`<img src='${c.url}'>`)}),M(`${u}/imageOK`,"Y"),M(`${u}/memo`,o.memo))}if(s!==void 0&&s!==""){const i=s,c=new RegExp(i,"gi"),m=o.memo.replace(c,`<span class='lightext'>${i}</span>`);o.memo=m}}return await l(),o};async function It(t,a,n=""){if(a==null||a==="")return"";if(t==="home"){const i=await V("home/tree");if(i!=null)try{return JSON.parse(i)}catch(c){console.error("Error parsing JSON data:",c)}}const s=t==="home"?"home_txt":n===""?`${t}_tree/${a}`:`${t}_txt/${a}`,u=le(ce(de,s)),x=await me(u);if(!x.exists())return console.log("getTreeData.null"),null;if(!x.exists())return console.log("getTreeData.exists"),null;const o=x.val(),j=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],l=[];t==="home"&&l.push(...j);for(const i in o){const c=o[i];c.id=i;const m={id:i,key:i,text:c.title,parent:t==="home"?c.gbn:c.parent};t==="memo"?(m.icon=c.bm==="Y"?e.jsx(je,{className:"text-red-500"}):c.icon==="Y"?e.jsx(gt,{}):null,m.droppable=!0):m.droppable=!1,!((n===""||n===void 0||n===null)&&(m.parent===void 0||m.parent===null||m.parent===""))&&(t==="home"||n===""||n===void 0||n===null?l.push(m):(c.id=i,(c.memo+"").toLowerCase().indexOf(n.toLowerCase())>-1&&(m.parent="root",m.droppable=!1,l.push(m))))}return l.sort((i,c)=>i.title>c.title?1:-1),t==="home"&&M("home/tree",JSON.stringify(l)),console.log("getTreeData.temp=",l?.length),l}const Et=d.lazy(async()=>await fe(()=>import("./TwMemoMain-BLPqn-Me.js"),__vite__mapDeps([12,1,2,13]))),Xt=({rootDb:t})=>{const a=Y(),{user:n}=W(),s=d.useRef(),u=d.useRef(!0),x=d.useRef(),o=d.useRef(),[j,l]=d.useState(),i=d.useRef(!1),c=K(),m=d.useRef(!1);m.current=c?.state?.reflash===!0;const v=Ze({queryKey:["twTreeData",n?.uid,s.current],queryFn:()=>It(t,n?.uid,s.current)});v.data!==void 0&&v.data!==""&&!i.current&&(i.current=!0);const b=()=>{const y=j;y&&(y.bookmark=y.bookmark==="Y"?"N":"Y");const C=`memo_tree/${n.uid}/${o.current}/bm`;M(C,j.bookmark),l({...j,bookmark:y.bookmark})};d.useEffect(()=>{n!==void 0&&n!=null&&v.refetch()},[n]),d.useEffect(()=>{const y=async L=>{if(L!==""&&n){const F=await Lt(t,n?.uid,L,s.current);t==="memo"&&(F.path=Rt(v.data,L)),u.current=!1,l(F===void 0?{}:F)}},C=c.pathname.split("/"),E=C.length>2?C[C.length-1]:"";u.current=!0,y(E),o.current=E},[c.pathname,n]),d.useEffect(()=>{n!==void 0&&n!=null&&v.refetch()},[m.current]);const f=y=>{i.current=!1,y!==void 0&&(s.current=y),v.refetch()},g=y=>{y.id!==o.current&&(u.current=!0,a(`/${t==="memo"?"m":t}/${y.id}`))},k=()=>{if(n==null){alert("로그인 후 이용 가능합니다.");return}const y=`/${t==="memo"?"m":t}/insert/insert`;a(y)},p=y=>{},w=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3",children:e.jsx(pt,{to:"/m",children:t==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[t==="memo"?"":e.jsx(z,{to:"/m",children:"메모"}),t==="memo"&&n?.uid==="I3cTgdCxwjhBBno4mtZYvnODPJu1"?e.jsx(z,{to:"/home",children:"홈관리"}):null,e.jsx(z,{to:"/todo",children:"TODO"}),e.jsx(z,{to:"/tw",children:"Sheet"})]}),e.jsx(St,{onNewMemoBtn:k,onSearchDataBtn:f}),i.current&&v.isFetched?e.jsx(Dt,{expandIndex:x.current,initTreeData:v.data,userId:n?.uid,memoId:o.current,onClick:g}):n===void 0?e.jsx(e.Fragment,{}):e.jsx(I,{})]});return n&&n.uid===Ke&&Ge,e.jsxs(Je,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:w,children:[e.jsx(d.Suspense,{fallback:e.jsx(I,{}),children:e.jsxs(Qe,{children:[e.jsx(O,{path:"/edit/:memoId",element:e.jsx(se,{rootDb:t,isLoading:u.current,searchWord:s.current,memoDetailData:j})}),e.jsx(O,{path:"/insert/:memoId",element:e.jsx(se,{rootDb:t,isLoading:u.current,searchWord:s.current,memoDetailData:j})}),e.jsx(O,{path:"/:memoId",element:e.jsx(yt,{rootDb:t,isLoading:u.current,searchWord:s.current,memoDetailData:j,onTreeUpdate:f,onBookmark:b,data:v.data})}),e.jsx(O,{path:"*",element:e.jsx(Et,{searchWord:s.current,data:v.data,onNewMemoBtn:k,title:t==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),t==="memo"?e.jsx(jt,{onSelected:p}):"",e.jsx(Xe,{})]})},Rt=(t,a)=>{let n=[],s=a;if(!t)return n;const u=t.find(x=>x.id===s);for(n.unshift(u),s=u?.parent;s!=null&&s!==""&&s!=="root";){const x=t.find(o=>o.id===s);s=x?.parent,n.unshift(x)}return n};export{Xt as default};
