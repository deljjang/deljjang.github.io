import{bV as c,bW as i,bX as u,bY as $,bZ as f,b_ as h,b$ as y,c0 as F}from"./index-CvT5YaSg.js";import{s as w}from"./fireDatabase-V756jICp.js";function p(t){var r=t.length,o=t.lastIndexOf("."),e=t.substring(o+1,r).toLowerCase();return e}function b(t){var r=t.indexOf("."),o=t.substring(0,r);return o}const R=async(t,r,o)=>{console.log("getImagePath.userId=",t),console.log("getImagePath.id=",r),console.log("getImagePath.fileNm=",o);const e={};e.ext=p(o),e.name=o,e.key=b(o);try{const a=`memo/${t}`,l=c(i,`${a}/${o}`),s=await u(l);e.url=s,console.log("getImagePath.img=",e),w(`memo_txt/${t}/${r}/image/${e.key}`,e)}catch(a){console.log("getImageList.catch",a)}return e},P=async(t,r,o,e)=>{const a="memo/I3cTgdCxwjhBBno4mtZYvnODPJu1";console.log("getImageList.id=",t),console.log("getImageList.base=",a),console.log("getImageList.image=",o);let l=new Array;for(let s in o){const n=o[s];try{if(n.key=s,n.url===void 0||n.url===""){const g=c(i,`${a}/${s}.${n.ext}`),m=await u(g);console.log("getImageList.downUrl=",m),n.url=m,w(`${t}/image/${s}/url`,m)}}catch{}l.push(n)}return l},U=async(t,r,o,e)=>{p(e.name),console.log("setFileUpload.locate=",t),console.log("setFileUpload.file=",e);let a=c(i,`${t}/${e.name}`);try{const s=await f(a);console.log("setFileUpload: 파일이 이미 존재합니다 파일정보=",s),a=c(i,`${t}/${o}${e.name}`)}catch(s){if(s.code!=="storage/object-not-found")throw console.error("setFileUpload: 파일 확인 중 오류:",s),s}return await h(a,e)},x=async(t,r,o,e)=>{const a={success:!0,key:o,message:"파일명이 성공적으로 변경되었습니다."};try{const l=c(i,t+r+"."+e);let s=c(i,t+o+"."+e);const n=await $(l);let g=0;for(;;)try{const L=await f(s);g++;const d=o+g;a.key=d,s=c(i,t+d+"."+e)}catch{console.log("renameFile: 업로드 확인 대기중...",g);break}await h(s,n),await y(l);const m=await u(s);return a.url=m,console.log("renameFile: 파일명 변경 완료"),a}catch(l){return console.error("renameFile: 파일명 변경 중 오류:",l),{success:!1,message:"파일명 변경 실패"}}},S=async(t,r,o)=>{console.log("setFileDelete.locate=",t),console.log("setFileDelete.id=",r),console.log("setFileDelete.file=",o);try{const e=c(i,`${t}/${o.key}.${o.ext}`);y(e).then(()=>{console.log("setFileDelete.storageRef=",e)}).catch(a=>{console.log("setFileDelete.error=",a)})}catch(e){console.log("setFileDelete.catch",e)}},k=async(t="")=>{console.log("getStorageFileList.path=",t);try{const r=c(i,t),o=await F(r),e=[];for(let a=0;a<o.items.length&&a<10;a++){const l=o.items[a];try{e.push(l._location.path_.replace("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1/",""))}catch(s){console.error("파일 정보 조회 실패:",itemRef.name,s)}}return console.error("getStorageFileList10.fileList=",e),e}catch(r){return console.error("Storage 파일 목록 조회 실패:",r),{files:[],folders:[],success:!1,error:r.message}}},_=async(t="")=>{console.log("getStorageFileList.path=",t);try{const r=c(i,t),o=await F(r);console.log("getStorageFileList.listAll=",o);const e=[];for(const l of o.items)try{const s=await f(l),n=await u(l);e.push({name:l.name,fullPath:l.fullPath,size:s.size,contentType:s.contentType,timeCreated:s.timeCreated,updated:s.updated,downloadURL:n})}catch(s){console.error("파일 정보 조회 실패:",l.name,s)}const a=o.prefixes.map(l=>({name:l.name,fullPath:l.fullPath,type:"folder"}));return console.log("getStorageFileList 결과:",{files:e,folders:a}),{files:e,folders:a,success:!0}}catch(r){return console.error("Storage 파일 목록 조회 실패:",r),{files:[],folders:[],success:!1,error:r.message}}};export{p as a,b,S as c,R as d,x as e,_ as f,P as g,k as h,U as s};
