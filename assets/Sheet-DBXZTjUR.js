import{h as S,j as t,bg as D,p as G,bh as O,r as u,bi as me,bj as fe,bk as he,aM as ge,Q as xe,J as R,bl as pe,bm as ye,q as ve,S as be,bn as je,bo as we,E as V,G as K,bp as Ce,I as p,bq as ke,br as De,U as Ie,e as Ne}from"./index-D_dKYi48.js";import{A as I}from"./AniButton-h8WGYfi6.js";import"./Button-DxcmgoPZ.js";const Re=({ui:v,onInsert:m,onDelete:g,onReload:b,onCsvSave:f})=>{const{t:i}=S();return v==="tailwind"?t.jsxs("div",{className:"my-2 flex justify-end items-center",children:[t.jsx(D,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:m,children:i("input")}),t.jsx(D,{type:"button",size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:g,children:i("delete")}),t.jsx(D,{type:"button",size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:b,children:i("reload")}),t.jsx(D,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:f,children:i("csv_save")})]}):t.jsxs("div",{className:"my-2 flex justify-end items-center gap-1",children:[t.jsx(I,{type:"button",size:"small",variant:"outlined",color:"warning",className:"mr-2",onClick:m,children:i("input")}),t.jsx(I,{type:"button",size:"small",variant:"outlined",color:"error",className:"mr-2",onClick:g,children:i("delete")}),t.jsx(I,{type:"button",size:"small",variant:"outlined",color:"success",className:"mr-2",onClick:b,children:i("reload")}),t.jsx(I,{type:"button",size:"small",variant:"outlined",color:"success",onClick:f,children:i("csv_save")})]})},y=[{title:"division",data:"dv",readOnly:!1,select:!0},{title:"title",type:"text",data:"title",select:!0},{title:"description1",type:"text",data:"t1",select:!0},{title:"description2",type:"text",data:"t2",select:!0},{title:"sort",type:"text",data:"sort",select:!1,hidden:!0},{title:"id",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];Ie();const Se=({csvFileName:v="exported_sheet",baseUrl:m="sheet",selectDefault:g="1"})=>{const{user:b}=G(),f=b?.uid,{ui:i}=O(),{t:a}=S(),U=y.length-1,d=u.useRef(null),C=u.useRef(null),[_,J]=u.useState(),[Q,E]=u.useState(0),{height:F,width:z}=me(),P=u.useRef(!1),[$,Z]=fe(he),{theme:X,settings:Y,colWidths:ee,setColWidths:N}=O();ge.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:te,reset:_e,control:T,setValue:W,getValues:k,formState:{errors:se}}=xe({mode:"submit "}),ne=X==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",oe=async e=>{const s=`${m}/${f}/`;if(e.id===void 0||e.id===null||e.id===""){const n=ke(De(V(K),s)).key;e.id=n}return p(s+e.id+"/dv",e.dv),p(s+e.id+"/title",e.title),p(s+e.id+"/t1",e.t1),p(s+e.id+"/t2",e.t2),p(s+e.id+"/ing","1"),e},le=async()=>{const e=`${m}/${f}/`,s=je(V(K,e),we("dv"));Ce(s,n=>{if(!n.exists())return;const l=n.val(),r=[];for(let c in l){const o=l[c];o.id=c,o.sort=`${o.dv}_${o.title}`,r.push(o)}r.sort((c,o)=>c.sort>o.sort?1:-1),J(r),E(r.length)})};u.useEffect(()=>{te("filterField1"),W("columns1",g),console.log("SheetGrid.text=",$)},[]),u.useEffect(()=>{f!==void 0&&le()},[f]),u.useEffect(()=>{z<500&&P.current===!1&&(P.current=!0,N([100,100,100,100,100,100]))},[z]),u.useEffect(()=>{d.current.hotInstance.addHook("afterColumnResize",function(s,n){const l=ee;try{l[n]=s,N(l)}catch{N([130,300,100,100,100,100])}})},[d.current]);const re=async()=>{L()},ie=async()=>{d.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:v,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},B=[],q={indicators:!0},A=[],H=[];y.map((e,s)=>{e.select&&B.push({value:s,text:a(e.title),label:a(e.title)}),H.push({...e,title:a(e.title)}),e.hidden===!0&&A.push(s)}),q.columns=A;const L=()=>{try{const e=d.current?.hotInstance,s=e?.getPlugin("filters");if(s){const n=k("columns1");console.log("onKeyUp.columns1=",n,"text=",k("filterField1")),Z(k("filterField1")),y.forEach((c,o)=>{s?.removeConditions(o)}),s?.addCondition(Number(n),"contains",[k("filterField1")]),s?.filter(),e?.render(),console.log("filtersPlugin=",s),console.log("hotRef=",d.current);const r=e.getData().length;E(r)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function ae(){d.current.hotInstance.alter("insert_row_above",0,1)}const ce=async(e,s)=>{if(e===null)return;const n=d.current?.hotInstance,l=n?.getPlugin("filters");if(l==null)return;const r=n.getData(),c={};e.forEach(async(h,j)=>{c[h[0]]=h[0]}),console.log("afterChange.lines=",c);const o=[];Object.keys(c).map(h=>{const j=c[h];console.log("afterChange.lines.key=",h,", lines=",j);const w={};y.forEach(async(x,de)=>{w[x.data]=r[j][de]}),o.push(w)}),console.log("afterChange.saveData=",o),o.forEach(async(h,j)=>{const w=await oe(h);console.log("afterChange.result=",j,", result=",w),_.map(x=>{(x.id===void 0||x.id===null)&&(x.id=w?.id,console.log("afterChange.rowData2=",x))})}),n.render()},ue=async()=>{const e=d.current.hotInstance;if(e&&C.current!==null){if(e?.getPlugin("filters")){const l=e.getData()[C.current][U],r=a("delete_confirm_message");window.confirm(r)&&p(`${m}/${f}/${l}`,null)}e.alter("remove_row",C.current,1)}},M=e=>{const s=e.target.value;W(e.target.name,s)};return b===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:t.jsx(R,{children:a("login_required")})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx(pe,{id:"columns1",name:"columns1",placeholder:a("search_column"),control:T,className:"dark:bg-dark-900",defaultValue:g||"1",options:B,error:!!se.columns1,onChange:M}),t.jsx(ye,{name:"filterField1",control:T,label:a("search"),placeholder:a("search_placeholder"),variant:"filled",margin:"none",onKeyUp:L,onChange:M,value:$})]}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[t.jsx(R,{textAlign:"left",children:a("count")+" : "+ve(Q)}),t.jsx(Re,{ui:i,onInsert:ae,onDelete:ue,onReload:re,onCsvSave:ie})]}),t.jsx("div",{className:"w-full",style:{maxHeight:`${F} - 210`,overflow:"auto"},children:t.jsx(be,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:d,data:_,themeName:ne,rowHeaders:!0,colHeaders:y.map(e=>a(e.title)),autoWrapRow:!0,height:F-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:ce,afterSelection:e=>{C.current=e},columns:H,cells:(e,s)=>y[s].readOnly===!0?{readOnly:!0}:{},colWidths:Y.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:q,licenseKey:"non-commercial-and-evaluation"})})]})};function Pe(){const{user:v}=G(),{t:m}=S();return v===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:t.jsx(R,{children:m("login_required")})}):t.jsx(u.Suspense,{fallback:t.jsx(Ne,{}),children:t.jsx(Se,{})})}export{Pe as default};
