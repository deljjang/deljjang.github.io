import{h as F,N as B,d8 as H,j as e,ci as R,bd as M,w as S,I as T,bf as x,p as U,o as W,n as D,r as h,s as G,z as E,A as I,bo as K,H as O,bp as Y,bq as J,G as w}from"./index-atarV6A9.js";import{L as Q}from"./PdfFileViewer-DMBQdN0B.js";import{C as X}from"./ComponentCard-C7lRlQQx.js";import{M as Z,T as P,a as ee}from"./MemoComm-Tl4baEqQ.js";import"./HtmlText-M3rAXcmn.js";import"./index-_IryZKFl.js";/* empty css                   */import"./HomeChartSemiDonut-Dw_GUXm-.js";import"./Favorite-B1FNJYr_.js";import"./TwLoading-DiShoP17.js";import"./fireMemoDetail-DOuqC8mH.js";import"./angle-right-Ch3f5LNp.js";import"./HtmlCode-BGw8hSiY.js";import"./copy-C2A0kY3Z.js";import"./TwBadge-DqPee9fF.js";import"./TwRadio-DVG5mfIE.js";import"./toPropertyKey-DCwh5dYN.js";import"./SinyImageList-DpsEwO94.js";import"./ImageListItem-DyTx3CzD.js";import"./CodeText-BOVTSPVE.js";/* empty css                   */import"./AniButton-DlG1oJQ6.js";import"./Button-BPQWbjCk.js";import"./Card-CtR_RhnU.js";import"./CardContent-CdjVo7Vr.js";import"./SinySelect-DX4NaB2b.js";import"./Grid-Cbf9cFgr.js";import"./index-CFsc8Dk8.js";import"./TextField-UTYB429A.js";import"./InputAdornment-B4S-88lI.js";import"./Popper-BdTSfp4g.js";import"./Chip-Dkg7oVMc.js";import"./TwCheckbox-DV2Rk2ox.js";import"./TwTextArea-DJq1J8c9.js";import"./IpInfo-CufAkZ_j.js";const te=({isOpen:C,onClose:c,onCreate:i})=>{const j={visible:{opacity:1},hidden:{opacity:0}},A={hidden:{y:"-50px",opacity:0,scale:.95},visible:{y:"0",opacity:1,scale:1,transition:{duration:.2,ease:"easeOut"}},exit:{y:"50px",opacity:0,scale:.95,transition:{duration:.15,ease:"easeIn"}}},{t:a}=F(),{register:k,control:y,handleSubmit:b,formState:{errors:_}}=B({defaultValues:{title:"",columns:[{title:"col_0",type:"text",width:100,data:"col_0"},{title:"col_1",type:"text",width:100,data:"col_1"},{title:"col_2",type:"text",width:100,data:"col_2"}]}}),{fields:g,append:f,remove:v}=H({control:y,name:"columns"}),$=[{value:"text",label:a("column_type_text")},{value:"numeric",label:a("column_type_numeric")},{value:"date",label:a("column_type_date")},{value:"checkbox",label:a("column_type_checkbox")}],N=o=>{if(!o.title||o.title.trim()===""){alert(a("sheet_title_required"));return}const p={...o,columns:o.columns.map((r,L)=>r.data&&(r.data==="id"||r.data==="title"||r.data==="description")?r:{...r,data:(r.title||"").toLowerCase().replace(/\s+/g,"_")||`col_${L}`})};i(p)};return e.jsx(R,{children:C&&e.jsx(M.div,{className:"fixed inset-0 bg-black/70 bg-opacity-50 z-180 flex justify-center items-center",variants:j,initial:"hidden",animate:"visible",exit:"hidden",children:e.jsx(M.div,{variants:A,initial:"hidden",animate:"visible",exit:"exit",onClick:o=>o.stopPropagation(),children:e.jsx(Z,{isDraggable:!0,className:"w-full max-w-sm sm:max-w-xl max-h-[61vh] overflow-y-auto",title:a("create_new_sheet"),children:e.jsxs("form",{onSubmit:b(N),children:[e.jsx("div",{className:"mb-4",children:e.jsx(P,{...k("title",{required:a("sheet_title_required")}),label:a("sheet_title"),placeholder:a("sheet_title_placeholder"),error:!!_.title,helperText:_.title?.message})}),e.jsx("h3",{className:"text-md font-semibold mb-2",children:a("columns")}),e.jsx("div",{className:"space-y-3",children:g.map((o,p)=>e.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-5 gap-2 items-center p-2 ${S.border} rounded-md`,children:[e.jsx("div",{className:"sm:col-span-2",children:e.jsx(T,{name:`columns.${p}.title`,control:y,defaultValue:o.title,render:({field:r})=>e.jsx(P,{...r,placeholder:a("column_title")})})}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(T,{name:`columns.${p}.type`,control:y,defaultValue:o.type,render:({field:r})=>e.jsx(ee,{...r,options:$,className:"dark:bg-gray-700"})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(x,{type:"button",size:"sm",color:"warning",onClick:()=>v(p),disabled:g.length<=1,children:a("delete")})})]},o.id))}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(x,{type:"button",onClick:()=>f({title:"",type:"text",data:""}),children:a("add_column")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"button",variant:"outlined",onClick:c,children:a("cancel")}),e.jsx(x,{type:"submit",children:a("create")})]})]})]})})})})})};function Pe(){const C=t=>{if(!t)return"";const s=new Date(t),d=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),u=String(s.getDate()).padStart(2,"0"),l=String(s.getHours()).padStart(2,"0"),m=String(s.getMinutes()).padStart(2,"0");return`${d}-${n}-${u} ${l}:${m}`},{user:c}=U(),{t:i}=F(),j=W(),{sheetId:A}=D(),[a,k]=h.useState([]),[y,b]=h.useState(!1),[_,g]=h.useState(null),[f,v]=h.useState(""),[$,N]=h.useState({isOpen:!1});h.useEffect(()=>{G({title:i("appSheet"),description:i("appSheet")})},[]),h.useEffect(()=>{if(c){const t=E(I,`memo_sheet/${c.uid}`),s=K(t,d=>{const n=d.val(),u=n?Object.keys(n).map(l=>{const m=n[l];return{id:l,...m}}):[];u.sort((l,m)=>(m.createdAt||0)-(l.createdAt||0)),k(u)});return()=>s()}},[c]);const o=async t=>{console.log("handleCreateSheet.sheetData=",t);const s=`memo_sheet/${c.uid}`,d=Y(J(E(I),s)).key,n={title:t.title,columns:t.columns,createdAt:Date.now()};w(`${s}/${d}`,n);const u=`memo_sheet/${c.uid}/${d}/data`,l={id:0,createdAt:Date.now()};t.columns.forEach(m=>{m.data!=="id"&&m.data!=="createdAt"&&(l[m.data]="")}),w(`${u}/0`,l),l.id=1,w(`${u}/1`,l),b(!1),j(`/m/sheet/${d}`)},p=t=>{j(`/m/sheet/${t}`)},r=async(t,s)=>{s.stopPropagation(),N({isOpen:!0,title:i("delete_confirm_title"),message:i("delete_confirm_message"),color:"warning",onConfirm:async()=>{await w(`memo_sheet/${c.uid}/${t}`,null),t===D().sheetId&&j("/m/sheet")},onClose:()=>N({isOpen:!1})})},L=(t,s)=>{s.stopPropagation(),g(t.id),v(t.title)},V=t=>{t.stopPropagation(),g(null),v("")},q=async(t,s)=>{if(s.stopPropagation(),!f.trim()){alert(i("sheet_title_required"));return}await w(`memo_sheet/${c.uid}/${t}/title`,f),k(d=>d.map(n=>n.id===t?{...n,title:f}:n)),g(null),v("")};if(c===void 0)return e.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:e.jsx(O,{children:i("login_required")})});const z=e.jsxs("div",{className:`${S.between}`,children:[e.jsx(O,{className:"text-md",children:i("memo_sheet_list")}),e.jsx(x,{variant:"ghost",onClick:()=>b(!0),children:i("create_new_sheet")})]});return e.jsxs(X,{title:z,className:"my-5",children:[e.jsx(Q,{...$}),e.jsx(te,{isOpen:y,onClose:()=>b(!1),onCreate:o}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:a.map(t=>e.jsx("div",{onClick:()=>_!==t.id&&p(t.id),className:`relative p-4 ${S.border} ${S.roundedSm} cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 group`,children:_===t.id?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"text",value:f,onChange:s=>v(s.target.value),onClick:s=>s.stopPropagation(),className:"border p-2 rounded-md dark:bg-gray-700",autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{size:"sm",variant:"outlined",onClick:V,children:i("cancel")}),e.jsx(x,{size:"sm",onClick:s=>q(t.id,s),children:i("save")})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative h-8",children:[" ",e.jsx("h6",{className:"absolute font-semibold pr-16 transition-transform duration-200 ease-in-out group-hover:scale-105 transform-origin-left dark:group-hover:text-lg",children:t.title})]}),e.jsxs("div",{className:"flex justify-between items-baseline mt-2 text-gray-500 dark:text-gray-400",children:[e.jsxs("p",{className:"text-sm ",children:[i("count"),": ",t.count]}),e.jsx("p",{className:"text-xs ",children:C(t.createdAt)})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:s=>L(t,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})}),e.jsx("button",{onClick:s=>r(t.id,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},t.id))})]})}export{Pe as default};
