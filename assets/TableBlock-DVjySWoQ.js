import{j as o}from"./index-DUOVNbQw.js";import{r as f}from"./router-BlMcuVHC.js";import{g as Z,bw as I,bx as y,by as B,bz as U,bA as J,bB as ee,bC as te,bD as ne}from"./App-DW0ZmkNF.js";import"./vendor-CCYiWZgt.js";const ie=({id:l,block:a,onUpdateBlock:u,onDelete:oe,readOnly:j})=>{const{t:g}=Z(),N=f.useRef(null),[p,S]=f.useState(null),[w,b]=f.useState(null),[L,R]=f.useState(!1),_=f.useRef({}),W=f.useCallback((n,e,t)=>{const s=n.currentTarget.innerHTML,r=JSON.parse(JSON.stringify(a.content));!r.rows[e]||!r.rows[e][t]||(r.rows[e][t].text=s,u(l,{content:r}))},[a.content,l,u]),T=f.useCallback((n,e,t)=>{const s=n.currentTarget.innerHTML,r=JSON.parse(JSON.stringify(a.content));!r.rows[e]||!r.rows[e][t]||(r.rows[e][t].text=s,u(l,{content:r}))},[a.content,l,u]),E=f.useCallback((n,e,t)=>{const s=`${n}-${e}`,r=_.current[s];r&&r.innerHTML!==t&&(r.innerHTML=t||"")},[]),D=f.useCallback(()=>{const n=JSON.parse(JSON.stringify(a.content));let e=0;n.rows[0]&&n.rows[0].forEach(t=>{e+=t.colSpan||1}),e=e||1,n.rows.push(Array.from({length:e},()=>({text:"",backgroundColor:"",textColor:"",textAlign:"left",rowSpan:1,colSpan:1,isMerged:!1}))),u(l,{content:n})},[a.content,l,u]),A=f.useCallback(n=>{if(!(a.content.rows.length<=1)&&window.confirm(g("delete_confirm_message_simple"))){const e=JSON.parse(JSON.stringify(a.content)),t=e.rows[n];for(let r=0;r<n;r++){let i=0;for(let d=0;d<e.rows[r].length;d++){const c=e.rows[r][d];if(!c.isMerged){const h=c.rowSpan||1;r+h>n&&(c.rowSpan-=1),i+=c.colSpan||1}}}let s=0;for(let r=0;r<t.length;r++){const i=t[r];if(!i.isMerged){const d=i.rowSpan||1;if(d>1&&n+1<e.rows.length){let c=0;for(let h=0;h<e.rows[n+1].length;h++){if(c>=s){const m=e.rows[n+1][h];Object.assign(m,{...i,rowSpan:d-1,isMerged:!1});break}c+=e.rows[n+1][h].colSpan||1}}s+=i.colSpan||1}}e.rows.splice(n,1),u(l,{content:e})}},[a.content,l,u,g]),X=f.useCallback(()=>{const n=JSON.parse(JSON.stringify(a.content));n.rows.forEach((e,t)=>{let s=null;for(let r=e.length-1;r>=0;r--)if(!e[r].isMerged){s=e[r];break}s&&(s.rowSpan||1)>1&&t>0,e.push({text:"",backgroundColor:"",textColor:"",textAlign:"left",rowSpan:1,colSpan:1,isMerged:!1})}),u(l,{content:n})},[a.content,l,u]),H=f.useCallback(n=>{if(window.confirm(g("delete_confirm_message_simple"))){const e=JSON.parse(JSON.stringify(a.content));e.rows.every(t=>(t[n]?.colSpan||1)===1&&(t[n]?.rowSpan||1)===1)?e.rows.forEach(t=>{t.length>1&&t.splice(n,1)}):(e.rows.forEach((t,s)=>{const r=t[n];if(r)if(r.isMerged){let i=null,d=-1;for(let c=n;c>=0;c--)if(!t[c].isMerged){i=t[c],d=c;break}i&&d+(i.colSpan||1)>n&&(i.colSpan-=1)}else{const i=r.colSpan||1;if(i>1&&n+1<t.length){const d=t[n+1];Object.assign(d,{...r,colSpan:i-1,isMerged:!1})}}}),e.rows.forEach(t=>{t.length>1&&n<t.length&&t.splice(n,1)})),u(l,{content:e})}},[a.content,l,u,g]),P=f.useCallback(n=>{n.preventDefault(),n.stopPropagation();const e=n.clientX,t=N.current;if(!t)return;const s=t.offsetWidth,r=d=>{const c=s+(d.clientX-e);t.style.width=`${c}px`},i=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",i),u&&t&&u(l,{width:t.offsetWidth})};document.addEventListener("mousemove",r),document.addEventListener("mouseup",i)},[l,u]),F=f.useCallback((n,e)=>{n.preventDefault(),n.stopPropagation();const t=n.clientX,r=n.currentTarget.parentElement.offsetWidth,i=c=>{const h=r+(c.clientX-t);if(h>30){const m=N.current.querySelector("table");if(m){const x=m.querySelector("colgroup");x&&x.children[e]&&(x.children[e].style.width=`${h}px`)}}},d=c=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",d);const h=r+(c.clientX-t),m=[...a.content.colWidths||[]];m[e]=Math.max(h,30),u(l,{content:{...a.content,colWidths:m}})};document.addEventListener("mousemove",i),document.addEventListener("mouseup",d)},[a.content,l,u]),q=(n,e,t)=>{n.stopPropagation(),!j&&(S({rowIndex:e,cellIndex:t}),b(null))},z=n=>{if(!p)return;const{rowIndex:e,cellIndex:t}=p,s=JSON.parse(JSON.stringify(a.content));s.rows[e][t]||(s.rows[e][t]={text:""}),s.rows[e][t].backgroundColor=n,u(l,{content:s})},O=n=>{if(!p)return;const{rowIndex:e,cellIndex:t}=p,s=JSON.parse(JSON.stringify(a.content));s.rows[e][t]||(s.rows[e][t]={text:""}),s.rows[e][t].textColor=n,u(l,{content:s})},M=n=>{if(!p)return;const{rowIndex:e,cellIndex:t}=p,s=JSON.parse(JSON.stringify(a.content));s.rows[e][t]||(s.rows[e][t]={text:""}),s.rows[e][t].textAlign=n,u(l,{content:s})},K=(n,e,t)=>{R(!0),b({startRow:e,startCol:t,endRow:e,endCol:t}),S(null)},G=(n,e,t)=>{L&&(n.preventDefault(),b(s=>({...s,endRow:e,endCol:t})))},Q=()=>{R(!1)},k=()=>w?{minRow:Math.min(w.startRow,w.endRow),maxRow:Math.max(w.startRow,w.endRow),minCol:Math.min(w.startCol,w.endCol),maxCol:Math.max(w.startCol,w.endCol)}:null,V=()=>{const n=k();if(!n||n.minRow===n.maxRow&&n.minCol===n.maxCol)return;const e=JSON.parse(JSON.stringify(a.content)),{minRow:t,maxRow:s,minCol:r,maxCol:i}=n;let d=[];for(let m=t;m<=s;m++)for(let x=r;x<=i;x++){const C=e.rows[m]?.[x];if(C){if(C.isMerged||(C.rowSpan>1||C.colSpan>1)&&(m!==t||x!==r)){alert(g("alert_cannot_merge_overlapping"));return}C.text&&d.push(C.text)}}const c=s-t+1,h=i-r+1;e.rows[t][r].rowSpan=c,e.rows[t][r].colSpan=h,e.rows[t][r].text=d.join(" "),e.rows[t][r].isMerged=!1;for(let m=t;m<=s;m++)for(let x=r;x<=i;x++){if(m===t&&x===r)continue;const C=e.rows[m]?.[x];C&&(C.isMerged=!0,C.text="")}u(l,{content:e}),b(null)},Y=()=>{if(!p)return;const{rowIndex:n,cellIndex:e}=p,t=a.content.rows[n][e];if(!t||(t.rowSpan||1)<=1&&(t.colSpan||1)<=1)return;const s=JSON.parse(JSON.stringify(a.content)),{rowSpan:r,colSpan:i}=t;s.rows[n][e].rowSpan=1,s.rows[n][e].colSpan=1;for(let d=n;d<n+r;d++)for(let c=e;c<e+i;c++){if(d===n&&c===e)continue;const h=s.rows[d]?.[c];h&&(h.isMerged=!1,h.rowSpan=1,h.colSpan=1)}u(l,{content:s}),S(null)},v=k(),$=(n,e)=>v?n>=v.minRow&&n<=v.maxRow&&e>=v.minCol&&e<=v.maxCol:!1;return f.useEffect(()=>{a.content?.rows&&a.content.rows.forEach((n,e)=>{n.forEach((t,s)=>{t.isMerged||E(e,s,t.text||"")})})},[a.content,E]),f.useEffect(()=>{const n=()=>{};return document.addEventListener("click",n),()=>{document.removeEventListener("click",n)}},[]),o.jsx("div",{className:"group relative w-full my-2",children:o.jsx("div",{className:"overflow-x-auto [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden",children:o.jsx(I.Popover,{isOpen:!j&&(!!p||!!w),positions:["bottom","top","right","left"],padding:10,onClickOutside:()=>{S(null),b(null)},content:o.jsxs("div",{className:"cell-menu z-20 bg-white dark:bg-zinc-800 shadow-lg rounded-md p-1 flex flex-col gap-1 w-60",onClick:n=>n.stopPropagation(),children:[w&&(v.minRow!==v.maxRow||v.minCol!==v.maxCol)&&o.jsx("button",{onClick:V,className:"flex items-center gap-2 p-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-md w-full text-left",children:g("merge_cells")}),p&&(a.content.rows[p.rowIndex]?.[p.cellIndex]?.rowSpan>1||a.content.rows[p.rowIndex]?.[p.cellIndex]?.colSpan>1)&&o.jsx("button",{onClick:Y,className:"flex items-center gap-2 p-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-md w-full text-left",children:g("unmerge_cells")}),p&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-200 dark:border-zinc-700 my-1"}),o.jsxs("button",{onClick:()=>A(p.rowIndex),className:"flex items-center gap-2 p-2 text-sm text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50 rounded-md w-full text-left",children:[o.jsx(B,{className:"w-4 h-4"}),g("delete_row")]}),o.jsxs("button",{onClick:()=>H(p.cellIndex),className:"flex items-center gap-2 p-2 text-sm text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50 rounded-md w-full text-left",children:[o.jsx(U,{className:"w-4 h-4"}),g("delete_column")]}),o.jsx("div",{className:"border-t border-gray-200 dark:border-zinc-700 my-1"})]}),p&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"p-2",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:g("cell_background")}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"color",value:a.content.rows[p.rowIndex]?.[p.cellIndex]?.backgroundColor||"#ffffff",onChange:n=>z(n.target.value),className:"w-6 h-6 p-0 border-none rounded cursor-pointer"}),o.jsx("button",{onClick:()=>z(""),className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white","data-tooltip-id":`reset-cell-bg-color-tooltip-${l}`,"data-tooltip-content":g("tooltip_reset_cell_color"),children:o.jsx(J,{className:"w-4 h-4"})}),o.jsx(y,{id:`reset-cell-bg-color-tooltip-${l}`,place:"top"})]})]})}),o.jsx("div",{className:"p-2",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:g("cell_text_color")}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"color",value:a.content.rows[p.rowIndex]?.[p.cellIndex]?.textColor||"#000000",onChange:n=>O(n.target.value),className:"w-6 h-6 p-0 border-none rounded cursor-pointer"}),o.jsx("button",{onClick:()=>O(""),className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white","data-tooltip-id":`reset-cell-text-color-tooltip-${l}`,"data-tooltip-content":g("tooltip_reset_text_color"),children:o.jsx(J,{className:"w-4 h-4"})}),o.jsx(y,{id:`reset-cell-text-color-tooltip-${l}`,place:"top"})]})]})}),o.jsx("div",{className:"p-2",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:g("label_align")}),o.jsxs("div",{className:"flex items-center bg-gray-100 dark:bg-zinc-700 rounded-md",children:[o.jsx("button",{onClick:()=>M("left"),className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white rounded-md","data-tooltip-id":`align-left-tooltip-${l}`,"data-tooltip-content":g("tooltip_align_left"),children:o.jsx(ee,{className:"w-4 h-4"})}),o.jsx(y,{id:`align-left-tooltip-${l}`,place:"top"}),o.jsx("button",{onClick:()=>M("center"),className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white rounded-md","data-tooltip-id":`align-center-tooltip-${l}`,"data-tooltip-content":g("tooltip_align_center"),children:o.jsx(te,{className:"w-4 h-4"})}),o.jsx(y,{id:`align-center-tooltip-${l}`,place:"top"}),o.jsx("button",{onClick:()=>M("right"),className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white rounded-md","data-tooltip-id":`align-right-tooltip-${l}`,"data-tooltip-content":g("tooltip_align_right"),children:o.jsx(ne,{className:"w-4 h-4"})}),o.jsx(y,{id:`align-right-tooltip-${l}`,place:"top"})]})]})})]})]}),children:o.jsxs("div",{ref:N,className:"relative inline-block",style:{width:a.width?`${a.width}px`:"auto"},onMouseUp:Q,children:[o.jsxs("table",{className:"border-collapse border border-gray-300 dark:border-zinc-600 table-fixed",children:[o.jsx("colgroup",{children:(a.content.rows?.[0]||[]).map((n,e)=>o.jsx("col",{style:{width:a.content.colWidths?.[e]?`${a.content.colWidths[e]}px`:"auto"}},e))}),o.jsx("tbody",{children:(a.content.rows||[]).map((n,e)=>o.jsx("tr",{className:"relative group/row",children:n.map((t,s)=>t.isMerged?null:o.jsxs("td",{rowSpan:t.rowSpan||1,colSpan:t.colSpan||1,className:`relative border border-gray-300 dark:border-zinc-600 p-0 ${$(e,s)?"bg-blue-200 dark:bg-blue-800":""}`,style:{backgroundColor:t.backgroundColor||($(e,s)?void 0:"transparent")},children:[o.jsx("div",{ref:r=>{const i=`${e}-${s}`;_.current[i]=r,r&&r.innerHTML!==(t.text||"")&&(r.innerHTML=t.text||"")},contentEditable:!j,suppressContentEditableWarning:!0,onInput:r=>W(r,e,s),onBlur:r=>T(r,e,s),onClick:r=>q(r,e,s),onMouseDown:r=>K(r,e,s),onMouseOver:r=>G(r,e,s),className:"p-2 focus:outline-blue-500 overflow-hidden whitespace-nowrap",style:{color:t.textColor||"inherit",textAlign:t.textAlign||"left"}}),e===0&&!j&&o.jsx("div",{onMouseDown:r=>F(r,s),className:"absolute top-0 right-0 w-1 h-full cursor-col-resize bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",style:{zIndex:10}})]},s))},e))})]}),!j&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"absolute top-1/2 right-2.5 -translate-y-1/2 w-5 h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[o.jsx("button",{onClick:X,className:"addColumn bg-white dark:bg-zinc-800 p-1 rounded-full items-center opacity-0 group-hover:opacity-100","data-tooltip-id":`add-col-tooltip-${l}`,"data-tooltip-content":g("add_column"),children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),o.jsx(y,{id:`add-col-tooltip-${l}`,place:"right"})]}),o.jsxs("div",{className:"absolute -bottom-2.5 left-1/2 -translate-x-1/2 w-full h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[o.jsx("button",{onClick:D,className:`addRow right-6 z-9999 p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity bg-white dark:bg-zinc-800 
            hover:bg-gray-200 dark:hover:bg-zinc-700`,"data-tooltip-id":`add-row-tooltip-${l}`,"data-tooltip-content":g("add"),children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),o.jsx(y,{id:`add-row-tooltip-${l}`,place:"bottom"})]}),o.jsx("div",{onMouseDown:P,className:"table-resize-handle absolute top-0 -right-1 w-2 h-full cursor-ew-resize opacity-0 group-hover:opacity-50 transition-opacity z-10 flex items-center",children:o.jsx("div",{className:"w-1 h-8 bg-blue-500 rounded-full"})})]})]})})})})};export{ie as TableBlock};
