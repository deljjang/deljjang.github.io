import{j as A}from"./index-DvCfMAy7.js";import{e as T,bJ as S,bK as Y,I as j,bL as H,bM as L,bN as I,J as w}from"./App-D_yiCkAU.js";import{r as g}from"./router-v4BRDFYV.js";import"./vendor-CCYiWZgt.js";L(I);w();const V=({id:n,rootDb:t,memoId:r,index:a,block:o,onUpdate:m,onUpdateBlock:s,afterSelection:D,readOnly:h,showSearch:C=!0})=>{const d=g.useRef(null);g.useRef(null);const p=g.useMemo(()=>o.content.data?.map(i=>Array.isArray(i)?[...i]:i)||[],[o.content.data]),M=async(i,b,E)=>{if(h)return;const x=d.current?.hotInstance;if(!x)return;const y=o.content.columns.map((f,e)=>({...f,width:x.getColWidth(e)}));console.log("handleAfterColumnResize.newColumns=",y),s(n,{content:{...o.content,columns:y}})},k=async(i,b)=>{if(h||b==="loadData"||typeof i!="object"||!Array.isArray(i))return;console.log("typeof=",typeof i,Array.isArray(i));try{if(i[0].length!==4||i[0][2]===i[0][3])return}catch{return}const E=d.current?.hotInstance;if(E){const y=E.getSourceData().map(f=>Array.isArray(f)?[...f]:f);y.forEach((f,e)=>{Array.isArray(f)&&f.forEach((c,l)=>{c===null&&(y[e][l]="")})}),s(n,{content:{...o.content,data:y}})}};return A.jsx(A.Fragment,{children:A.jsx(z,{hotRef:d,columns:o.content.columns,rowData:p,colorData:o.content.colorData,colorTextData:o.content.colorTextData,afterChange:k,afterSelection:D,handleAfterColumnResize:M,showSearch:C,readOnly:h,isDraggable:!1})})},z=({hotRef:n,columns:t,rowData:r,colorData:a,colorTextData:o,afterChange:m,afterSelection:s,handleAfterColumnResize:D,showSearch:h,readOnly:C=!0})=>{const{theme:d}=T(e=>({theme:e.theme.mode})),p=g.useRef(null),[M,k]=g.useState("");g.useEffect(()=>{const e=n.current?.hotInstance;if(!e||!r)return;let c=!1;try{a&&a.forEach((l,R)=>{l&&l.forEach((u,N)=>{const F=e.getCellMeta(R,N).backgroundColor,v=u||void 0;F!==v&&(e.setCellMeta(R,N,"backgroundColor",v),c=!0)})})}catch{}try{o&&o.forEach((l,R)=>{l&&l.forEach((u,N)=>{const F=e.getCellMeta(R,N).color,v=u||void 0;F!==v&&(e.setCellMeta(R,N,"color",v),c=!0)})})}catch{}c&&e.render()},[r,a,o,n]);const i=[],b=g.useMemo(()=>{if(!t)return;const e=[];return t.forEach((c,l)=>{c.select&&i.push({value:l,text:c.title,label:c.title}),e.push({...c,title:c.title})}),e},[t]),E=g.useMemo(()=>b&&b.map((e,c)=>{const{readOnly:l,...R}=e;let u={...R,theme:d,isFirstColumn:b.indexOf(e)===0,data:c,colorData:a,colorTextData:o};return e.type==="numeric"?u={...u,type:"numeric",numericFormat:{pattern:"0,0.00"},originalRenderer:S.renderers.NumericRenderer}:e.type==="date"?u={...u,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:W},originalRenderer:S.renderers.DateRenderer}:e.type==="checkbox"?u={...u,type:"checkbox",className:"htCenter",originalRenderer:S.renderers.CheckboxRenderer}:u.originalRenderer=S.renderers.TextRenderer,{...u,renderer:K}}),[b,d,a,o]),x=d==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",y=e=>{e.key==="Enter"&&(e.preventDefault(),f())},f=()=>{const e=p.current.value;k(e);const c=n.current?.hotInstance;c&&c.render()};return A.jsxs("div",{className:"TwHotTable w-full",children:[h&&A.jsx(Y,{inputRef:p,onKeyDown:y,onSearch:f,className:"max-w-60"}),A.jsx(j,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:n,data:r,themeName:x,rowHeaders:!0,language:"ko-KR",colHeaders:t&&t.map(e=>e.title),autoWrapRow:!0,height:"auto",contextMenu:!C,search:M,observeChanges:!0,columnSorting:!0,afterChange:m,afterSelection:s,formulas:{engine:H.buildEmpty({licenseKey:"gpl-v3"})},columns:E,readOnly:C,manualColumnResize:!0,afterColumnResize:D,colWidths:t.map(e=>e.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})]})},K=(n,t,r,a,o,m,s)=>{typeof m=="number"&&!isNaN(m)?(m%1!==0?s.numericFormat={pattern:"0,0.00"}:s.numericFormat={pattern:"0,0"},S.renderers.NumericRenderer.apply(void 0,[n,t,r,a,o,m,s])):s.originalRenderer?s.originalRenderer.apply(void 0,[n,t,r,a,o,m,s]):S.renderers.TextRenderer.apply(void 0,[n,t,r,a,o,m,s]);const D=n.getSettings().search,h=s.theme,C=n.getCellMeta(r,a),d=s.backgroundColor||C.backgroundColor,p=s.color||C.color,M=s.colorData,k=s.colorTextData;t.style.backgroundColor="",t.style.color="",D&&m&&String(m).toLowerCase().includes(D.toLowerCase())?(t.style.backgroundColor=h==="dark"?"#facc15":"yellow",t.style.color="black"):(t.style.backgroundColor=d,d||(r%2===0?t.style.backgroundColor=h==="dark"?"#101010":"#ffffff":t.style.backgroundColor=h==="dark"?"#000000":"#f8f8f8")),p&&(t.style.color=p),M?.[r]?.[a]&&(t.style.backgroundColor=M[r]?.[a],t.classList.remove("htDimmed")),k?.[r]?.[a]&&(t.style.color=k[r]?.[a],t.classList.remove("htDimmed")),t.classList.remove("htDimmed")},W={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(n,t){const r=n.getDate(),a=n.getMonth()+1;return`${n.getFullYear()}-${a.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`},parse(n,t){const r=n.split("-");return new Date(r[0],r[1]-1,r[2])}};export{V as HandsontableBlock};
