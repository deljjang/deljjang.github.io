import{j as n,r as f,P as te,cO as z,q as ne,o as oe,n as u,am as se,O as y,Y as re,Z as le,t as d,A as ie}from"./index-DUSpVCOt.js";import{I as ae,T as H}from"./InputField-BQzjT7m-.js";import{H as ce,r as ue}from"./registry-D2VQivUs.js";import{D as de}from"./datetime-BDx6lZXm.js";import{a as me}from"./index.esm-BG3EEB-h.js";import{S as fe}from"./Select-EZx9xFd6.js";import{n as he}from"./handson-CS9Rir92.js";import{T as D}from"./TailButton-Cx1ARasu.js";const ge=a=>n.jsxs("div",{className:"my-2 flex justify-end items-center",sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[n.jsx(D,{size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:a.onInsert,children:"추가"}),n.jsx(D,{type:"button",size:"sm",variant:"outlined",color:"error",className:"mr-2",onClick:a.onDelete,children:"삭제"}),n.jsx(D,{type:"button",size:"sm",variant:"outlined",color:"success",className:"mr-2",onClick:a.onReload,children:"리로드"}),n.jsx(D,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:a.onCsvSave,children:"csv저장"})]});ue();const ye=({csvFileName:a="exported_sheet",baseUrl:h="sheet",columns:x,selectDefault:j="1",keyId:V,userId:p})=>{const c=f.useRef(null),v=f.useRef(null),[I,_]=f.useState(),[B,R]=f.useState(0),{height:S,width:xe}=te(),{settings:F,changeColWidths:N}=z(),K={edTitle:"",edDate:de.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd")},{register:A,reset:ve,control:P,setValue:k,getValues:b,formState:{errors:M}}=me({mode:"submit ",defaultValues:K}),{theme:L}=z(),q=L==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",G=async e=>{console.log("onFunPost.id=",e.id,"data=",e);const t=`${h}/${p}/`;if(e.id===void 0||e.id===null||e.id===""){const o=re(le(u(d),t)).key;console.log("onFunPost.newKey",o),e.id=o}return y(u(d,t+e.id+"/dv"),e.dv),y(u(d,t+e.id+"/title"),e.title),y(u(d,t+e.id+"/t1"),e.t1),y(u(d,t+e.id+"/t2"),e.t2),y(u(d,t+e.id+"/ing"),"1"),e},U=async()=>{const e=`${h}/${p}/`,t=ne(u(d,e),oe("dv"));se(t,o=>{if(!o.exists())return;const r=o.val(),l=[];for(let i in r){const s=r[i];s.id=i,s.sort=`${s.dv}_${s.title}`,l.push(s)}l.sort((i,s)=>i.sort>s.sort?1:-1),_(l),R(l.length)})};f.useEffect(()=>{A("filterField1"),k("columns1",j)},[]),f.useEffect(()=>{p!==void 0&&U()},[p]),f.useEffect(()=>{c.current.hotInstance.addHook("afterColumnResize",function(t,o){const r=F.colWidths;try{r[o]=t,N(r)}catch{N([130,300,100,100,100,100])}})},[c.current]);const Z=async()=>{W()},Y=async()=>{c.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:a,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},E=[],$={indicators:!0},T=[];x.map((e,t)=>{e.select&&E.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&T.push(t)}),$.columns=T;const W=()=>{try{const e=c.current?.hotInstance,t=e?.getPlugin("filters");if(t){const o=b("columns1");console.log("onKeyUp.columns1=",o,"text=",b("filterField1")),x.forEach((i,s)=>{t?.removeConditions(s)}),t?.addCondition(Number(o),"contains",[b("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",c.current);const l=e.getData().length;R(l)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function J(){c.current.hotInstance.alter("insert_row_above",0,1)}const Q=async(e,t)=>{if(e===null)return;const o=c.current?.hotInstance,r=o?.getPlugin("filters");if(r==null)return;const l=o.getData(),i={};e.forEach(async(m,w)=>{i[m[0]]=m[0]}),console.log("afterChange.lines=",i);const s=[];Object.keys(i).map(m=>{const w=i[m];console.log("afterChange.lines.key=",m,", lines=",w);const C={};x.forEach(async(g,ee)=>{C[g.data]=l[w][ee]}),s.push(C)}),console.log("afterChange.saveData=",s),s.forEach(async(m,w)=>{const C=await G(m);console.log("afterChange.result=",w,", result=",C),I.map(g=>{(g.id===void 0||g.id===null)&&(g.id=C?.id,console.log("afterChange.rowData2=",g))})}),o.render()},X=async()=>{const e=c.current.hotInstance;if(console.log("onDelete:",e),e&&v.current!==null){if(e?.getPlugin("filters")){const o=e.getData();console.log("onDelete.filteredData=",o[v.current]);const r=o[v.current][V];console.log("onDelete.deleteId=",r),window.confirm("삭제하시겠습니까?")&&y(u(d,`${h}/${p}/${r}`),null)}e.alter("remove_row",v.current,1)}},O=e=>{const t=e.target.value;console.log("onChange.target=",e.target.value),k(e.target.name,t)};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[n.jsx(fe,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:P,className:"dark:bg-dark-900",defaultValue:j||"1",options:E,error:!!M.columns1,onChange:O}),n.jsx(ae,{name:"filterField1",control:P,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",onKeyUp:W,onChange:O})]}),n.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[n.jsx(H,{textAlign:"left",children:"건수 : "+he(B)}),n.jsx(ge,{onInsert:J,onDelete:X,onReload:Z,onCsvSave:Y})]}),n.jsx("div",{className:"grid grid-cols-1",style:{maxHeight:`${S} - 210`,overflow:"auto"},children:n.jsx(ce,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:c,data:I,themeName:q,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:S-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:Q,afterSelection:e=>{v.current=e},columns:x,cells:(e,t)=>x[t].readOnly===!0?{readOnly:!0}:{},colWidths:F.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:$,licenseKey:"non-commercial-and-evaluation"})})]})};function Fe(){const{user:a}=ie(),h=[{title:"구분",data:"dv",readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"설명1",type:"text",data:"t1",select:!0},{title:"설명2",type:"text",data:"t2",select:!0},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];return a===void 0?n.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:n.jsx(H,{children:"로그인을 해야 이용 가능합니다."})}):n.jsx(ye,{csvFileName:"exported_sheet",baseUrl:"sheet",columns:h,selectDefault:"1",keyId:h.length-1,userId:a?.uid})}export{Fe as default};
