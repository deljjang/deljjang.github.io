import{d9 as s,Q as U,da as Ce,db as je,dc as _e,dd as $e,de as f,df as Re,dg as ke,dh as Ne,di as Se,dj as He,dk as De,dl as Ie,dm as Me,dn as Ee,dp as Te,dq as ze,dr as Fe,ds as Ae,dt as Le,du as J,dv as Oe,dw as Pe,dx as X,dy as _,dz as Be,dA as Ve,dB as Z,dC as Ye,dD as Ge,dE as ee,dF as We,dG as Ke,dH as se,dI as Qe,dJ as G,dK as qe,h as te,j as r,bf as w,p as Ue,bg as W,n as Je,r as m,u as Xe,bh as Ze,N as es,ca as K,H,ci as ss,bd as ts,w as Q,dL as rs,O as ns,bm as as,bn as os,z as ls,A as is,bo as ds,G as v}from"./index-Dm2paWXQ.js";import{L as cs}from"./HtmlCode-DzN-g-b-.js";import{A as j}from"./AniButton-B_sT32aK.js";import{M as q}from"./HtmlCode-gs0zW-wG.js";import"./HtmlText-CSRC21Qo.js";import"./index-li8WhkMN.js";/* empty css                   */import"./Button-BYhsbgXg.js";import"./copy-BwvW1UEc.js";import"./ComponentCard-CmggNZ1k.js";import"./TwRadio-CU2MO1rv.js";import"./TwBadge-E3mjeH7o.js";import"./toPropertyKey-DCwh5dYN.js";function us(n){const t=typeof window>"u"?!1:window.jQuery;t&&(t.fn.handsontable=function(h){const i=this.first();let a=i.data("handsontable");if(typeof h!="string"){const p=h||{};return a?a.updateSettings(p):(a=new n.Core(i[0],p),i.data("handsontable",a),a.init()),i}let d;if(a)if(typeof a[h]<"u"){for(var l=arguments.length,y=new Array(l>1?l-1:0),u=1;u<l;u++)y[u-1]=arguments[u];d=a[h].call(a,...y),h==="destroy"&&i.removeData()}else throw new Error(`Handsontable do not provide action: ${h}`);return d})}var D,I,M,E,T;U();us(s);s.__GhostTable=Ce;s._getListenersCounter=je;s._getRegisteredMapsCounter=_e;s.EventManager=$e;const ms=[Re,ke,Ne,Se,He,De,Ie,Me,Ee,Te,ze,Fe],hs=[Ae,Le];s.helper={};s.dom={};f(ms,n=>{f(Object.getOwnPropertyNames(n),t=>{t.charAt(0)!=="_"&&(s.helper[t]=n[t])})});f(hs,n=>{f(Object.getOwnPropertyNames(n),t=>{t.charAt(0)!=="_"&&(s.dom[t]=n[t])})});s.cellTypes=(D=s.cellTypes)!==null&&D!==void 0?D:{};f(Oe(),n=>{s.cellTypes[n]=J(n)});s.cellTypes.registerCellType=Pe;s.cellTypes.getCellType=J;s.editors=(I=s.editors)!==null&&I!==void 0?I:{};f(Be(),n=>{s.editors[`${_(n)}Editor`]=X(n)});s.editors.registerEditor=Ve;s.editors.getEditor=X;s.renderers=(M=s.renderers)!==null&&M!==void 0?M:{};f(Ye(),n=>{const t=Z(n);n==="base"&&(s.renderers.cellDecorator=t),s.renderers[`${_(n)}Renderer`]=t});s.renderers.registerRenderer=Ge;s.renderers.getRenderer=Z;s.validators=(E=s.validators)!==null&&E!==void 0?E:{};f(We(),n=>{s.validators[`${_(n)}Validator`]=ee(n)});s.validators.registerValidator=Ke;s.validators.getValidator=ee;s.plugins=(T=s.plugins)!==null&&T!==void 0?T:{};f(Qe(),n=>{s.plugins[n]=se(n)});s.plugins[`${_(G.PLUGIN_KEY)}Plugin`]=G;s.plugins.registerPlugin=qe;s.plugins.getPlugin=se;const gs=({ui:n,onInsert:t,onDelete:h,onReload:i,onCsvSave:a,onSaveAll:d})=>{const{t:l}=te();return n==="tailwind"?r.jsxs("div",{className:"my-2 flex justify-end items-center",children:[r.jsx(w,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:d,children:l("save")}),r.jsx(w,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:t,children:l("insert")}),r.jsx(w,{size:"sm",variant:"outlined",color:"warning",className:"mr-1",onClick:h,children:l("delete")}),r.jsx(w,{size:"sm",variant:"outlined",color:"brand",className:"ml-1",onClick:a,children:l("csv_save")})]}):r.jsxs("div",{className:"my-2 flex justify-end items-center gap-1",children:[r.jsx(j,{type:"button",size:"small",variant:"outlined",color:"warning",className:"mr-2",onClick:t,children:l("insert")}),r.jsx(j,{type:"button",size:"small",variant:"outlined",color:"error",className:"mr-2",onClick:h,children:l("delete")}),r.jsx(j,{type:"button",size:"small",variant:"outlined",color:"success",className:"mr-2",onClick:i,children:l("reload")}),r.jsx(j,{type:"button",size:"small",variant:"outlined",color:"success",onClick:a,children:l("csv_save")})]})},fs=(n,t,h,i,a,d,l)=>{l.originalRenderer?l.originalRenderer.apply(void 0,[n,t,h,i,a,d,l]):s.renderers.TextRenderer.apply(void 0,[n,t,h,i,a,d,l]);const y=n.getSettings().search,u=l.theme,p=l.isFirstColumn;t.style.backgroundColor="",t.style.color="",y&&d&&String(d).toLowerCase().includes(y.toLowerCase())?(t.style.backgroundColor=u==="dark"?"#facc15":"yellow",t.style.color="black"):(p?t.style.backgroundColor=u==="dark"?"#4b5563":"#e0e0e0":h%2===0?t.style.backgroundColor=u==="dark"?"#101010":"#ffffff":t.style.backgroundColor=u==="dark"?"#000000":"#f8f8f8",t.style.color="")};U();const zs=({detailData:n})=>{const{user:t}=Ue(),{ui:h}=W(),{t:i}=te(),{sheetId:a}=Je(),[d,l]=m.useState([]),{isMobileFooter:y}=Xe(),u=m.useRef(null);m.useRef(null);const p=m.useRef(null),b=m.useRef(null),[re,z]=m.useState(),{height:ps,width:bs}=Ze(),[ne,ae]=m.useState(""),[oe,F]=m.useState({isOpen:!1}),[A,L]=m.useState({show:!1,message:""}),[$,O]=m.useState(""),[le,R]=m.useState(!1),[C,P]=m.useState(""),{theme:k}=W(),{register:ie,reset:xs,control:ys,setValue:vs,getValues:ws,formState:{errors:Cs}}=es({mode:"submit "}),de=k==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",ce=async()=>{if(!a)return;const e=`memo_sheet_data/${t?.uid}/${a}/data`,o=as(ls(is,e),os(d.length>0?d[0].data:"title"));ds(o,g=>{if(!g.exists()){z([]);return}const c=g.val(),x=[];for(let N in c){const S=c[N];x.push(S)}z(x)})};function ue(){const e=n?.scrollY?n.scrollY:0;window.scrollTo({top:e})}m.useEffect(()=>{a&&t&&(K(`memo_sheet/${t?.uid}/${a}/columns`).then(e=>{l(e||[{title:"title",data:"title",type:"text"}]),ie("filterField1")}),K(`memo_sheet_data/${t?.uid}/${a}/memo`).then(e=>{O(e||"")}),ue())},[a,t]),m.useEffect(()=>{a&&d.length>0&&ce()},[a,d]);const me=async()=>{u.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:`sheet_${a}`,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},he=[],B=m.useMemo(()=>{const e=[];return d.forEach((o,g)=>{o.select&&he.push({value:g,text:o.title,label:o.title}),e.push({...o,title:o.title})}),e},[d]);d.map((e,o)=>{e.hidden});async function ge(){const e=u.current?.hotInstance;if(!e)return;let o;b.current!==null&&b.current>=0?(o=b.current+1,e.alter("insert_row_below",b.current,1)):(o=0,e.alter("insert_row_above",0,1)),e.selectCell(o,0)}const fe=async()=>{v(`memo_sheet_data/${t?.uid}/${a}/memo`,C),O(C),R(!1)},pe=()=>{P($),R(!0)},be=e=>(v(`memo_sheet_data/${t?.uid}/${a}/data`,e),v(`memo_sheet/${t?.uid}/${a}/createdAt`,Date.now()),v(`memo_sheet/${t?.uid}/${a}/count`,e.length),e),V=async(e=!0)=>{const o=u.current?.hotInstance;if(!o)return;const g=o.getSourceData();g.forEach((c,x)=>{c.id=x}),await be(g),e&&(L({show:!0,message:i("save_completed")}),setTimeout(()=>{L({show:!1,message:""})},2e3))},xe=async(e,o)=>{},ye=async(e,o,g)=>{V(!1);const c=u.current?.hotInstance;if(!c)return;const x=d.map((N,S)=>({...N,width:c.getColWidth(S)}));l(x),v(`memo_sheet/${t?.uid}/${a}/columns`,x)},ve=async()=>{const e=u.current.hotInstance;if(e&&b.current!==null){const o=b.current,c=e.getSourceDataAtRow(o).id;F({isOpen:!0,title:i("delete_confirm_title"),message:i("delete_confirm_message_simple"),color:"warning",onConfirm:()=>{v(`memo_sheet_data/${t?.uid}/${a}/data/${c}`,null)},onClose:()=>F({isOpen:!1})})}};if(t===void 0)return r.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:r.jsx(H,{children:i("login_required")})});const Y=()=>{const e=p.current.value;ae(e);const o=u.current?.hotInstance;o&&o.render()},we=e=>{e.key==="Enter"&&(e.preventDefault(),Y())};return r.jsxs("div",{className:"pt-5 relative",children:[r.jsx(ss,{children:A.show&&r.jsx(ts.div,{initial:{y:"-100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"-100%",opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"fixed top-50 left-1/2 -translate-x-1/2 z-[2000] p-3 rounded-lg shadow-lg bg-green-500 text-white font-semibold",children:A.message})}),r.jsx(cs,{...oe}),r.jsx("div",{className:"mb-4",children:le?r.jsxs("div",{className:`${Q.card} p-4`,children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx(H,{children:i("input")}),r.jsx("textarea",{className:"w-full h-64 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",value:C,onChange:e=>P(e.target.value),autoFocus:!0})]}),r.jsxs("div",{children:[r.jsx(H,{children:i("preview")}),r.jsx("div",{className:"prose dark:prose-invert max-w-none p-2 border rounded h-64 overflow-y-auto dark:bg-gray-700 dark:border-gray-600",children:r.jsx(q,{children:C})})]})]}),r.jsxs("div",{className:"mt-2 flex justify-end gap-2",children:[r.jsx(w,{variant:"outlined",size:"sm",onClick:()=>R(!1),children:i("cancel")}),r.jsx(w,{size:"sm",onClick:fe,children:i("save")})]})]}):r.jsx("div",{className:`${Q.card} p-4 min-h-[4rem] cursor-pointer prose dark:prose-invert max-w-none`,onDoubleClick:pe,children:$?r.jsx(q,{children:$}):r.jsx("p",{className:"text-gray-400",children:i("double_click_to_edit_memo")})})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 pb-2",children:[r.jsx(rs,{inputRef:p,onKeyDown:we,onSearch:Y}),r.jsx(gs,{ui:h,onInsert:ge,onDelete:ve,onCsvSave:me,onSaveAll:V})]}),r.jsx("div",{className:"w-full",children:r.jsx(ns,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:u,data:re,themeName:de,rowHeaders:!0,colHeaders:d.map(e=>e.title),autoWrapRow:!0,height:"auto",contextMenu:!0,search:ne,observeChanges:!0,columnSorting:!0,afterChange:xe,afterSelection:e=>{b.current=e},columns:m.useMemo(()=>B.map(e=>{const{readOnly:o,...g}=e;let c={...g,theme:k};return e.type==="numeric"?c={...c,type:"numeric",numericFormat:{pattern:"0,0"},originalRenderer:s.renderers.NumericRenderer}:e.type==="date"?c={...c,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,originalRenderer:s.renderers.DateRenderer}:e.type==="checkbox"?c={...c,type:"checkbox",className:"htCenter",originalRenderer:s.renderers.CheckboxRenderer}:c.originalRenderer=s.renderers.TextRenderer,{...c,renderer:fs}}),[B,k]),manualColumnResize:!0,afterColumnResize:ye,colWidths:d.map(e=>e.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})})]})};export{zs as MemoSheetGrid,zs as default};
