import{c7 as _,c8 as B,c9 as E,bp as K,dC as Q,i as $,r as u,j as t,B as F,P as O,a8 as N,T,w as P,z as H,dD as z,a9 as L,bM as y,p as J,f as A,t as G,D as W,cL as Y,K as b}from"./index-CEJkszmk.js";import{D as U}from"./Delete-DD-fI4XB.js";import{D as M}from"./Divider-D5ZMPGLC.js";import{s as V,f as X,b as Z}from"./MemoComm-I9l3DPo6.js";var k={},I;function ee(){if(I)return k;I=1;var e=_();Object.defineProperty(k,"__esModule",{value:!0}),k.default=void 0;var a=e(B()),m=E();return k.default=(0,a.default)((0,m.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),k}var te=ee();const se=K(te),ce=e=>{const{control:a}=e;Q({control:a,name:"content"});const{t:m}=$(),[p,l]=u.useState(!1),[c]=u.useState(!1),[s,g]=u.useState([]),[o,n]=u.useState(e.imageList),i=u.useRef(0);u.useEffect(()=>{g([])},[]);const h=u.useCallback(r=>{r.preventDefault(),r.dataTransfer?.files&&l(!0)},[]),d=u.useCallback(r=>{r.preventDefault(),l(!1)},[]),x=u.useCallback(r=>{let f=[],v=s;r.type==="drop"?f=r.dataTransfer.files:f=r.target.files;for(const w of f){const S=URL.createObjectURL(w);v=[...v,{id:i.current++,object:w,url:S}]}e.onFileUpload(v),g(v)},[s,e]),j=u.useCallback(r=>{n(r),e.onDelete(r)},[e]),C=r=>{e.onInsert(r)},R=r=>e.onRename(r),D=u.useCallback(r=>{const f=s.filter(v=>v.id!==r);e.onFileUpload(f),g(f)},[s,e]),q=u.useCallback(r=>{r.preventDefault(),r.stopPropagation(),l(!1),x(r)},[x]);return t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsx(F,{children:t.jsxs(O,{variant:"outlined",onDragOver:h,onDragLeave:d,onDrop:q,cursor:"pointer",sx:{"&:hover":{cursor:"pointer"}},style:{border:p?"1px dashed red":"1px dashed gray",paddingLeft:5,paddingRight:5,marginBottom:10,textAlign:"center",cursor:"pointer",backgroundColor:p?"secondary":"transparent",position:"relative"},children:[t.jsx("input",{type:"file",id:"fileUpload",style:{display:"none"},multiple:!0,onChange:x}),t.jsx("label",{htmlFor:"fileUpload",children:t.jsxs(F,{display:"flex",flexDirection:"row",alignItems:"center",children:[t.jsx(N,{color:"primary","aria-label":"upload picture",component:"span",children:t.jsx(se,{style:{fontSize:40}})}),t.jsx(T,{children:m("file_upload")})]})}),c&&t.jsx(P,{size:24,style:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})}),t.jsx(ae,{imgList:o,onInsert:C,onRename:R,onClick:j}),s.length>0&&s.map((r,f)=>{const{id:v,object:{name:w},url:S}=r;return t.jsxs("div",{children:[t.jsxs(F,{display:"flex",flexDirection:"row",alignItems:"center",sx:{justifyContent:"space-between"},children:[t.jsx("img",{src:S,style:{width:"50px"}}),t.jsx("div",{children:w}),t.jsx(N,{"aria-label":"delete",onClick:()=>D(v),children:t.jsx(U,{sx:{color:"red"}})})]},f),t.jsx(M,{})]},f)})]})},ae=e=>{const[a,m]=u.useState(e.imgList),{t:p}=$(),[l,c]=u.useState(""),s=n=>(a.map(i=>{if(i.key===n)return e.onInsert(i),!1}),!1),g=n=>(c(n),a.map(i=>{if(i.key===n)return e.onRename(i).then(d=>{d&&(i.key=d.key,i.name=d.name,m([...a]),c(""))}),!1}),!1),o=n=>{const i=a.map(h=>(h.key===n&&(h.del="Y"),h));m(i),e.onClick(i)};return a&&a.length>0&&a.map((n,i)=>{const{key:h,name:d,url:x,del:j,ext:C}=n,R=/(jpg|jpeg|png|gif|bmp|webp|svg)/i;return j!==void 0?"":t.jsxs("div",{children:[t.jsxs("div",{className:`${H.between} gap-1`,children:[C==="mp4"&&t.jsx(T,{style:{width:"50px",textAlign:"center"},variant:"body",children:C}),R.test(C)&&t.jsx("img",{src:x,style:{maxHeight:"50px",maxWidth:"50px"}}),t.jsxs("div",{className:"flex truncate items-center",children:[l===h&&t.jsx(z,{}),d]}),t.jsxs("div",{style:{display:"flex"},children:[x&&t.jsxs("div",{className:"gap-3",children:[t.jsx(L,{onClick:D=>{D.preventDefault(),g(h)},children:p("edit")}),t.jsx(L,{onClick:D=>{D.preventDefault(),s(h)},children:p("add")})]}),t.jsx(N,{"aria-label":"delete",onClick:()=>o(h),children:t.jsx(U,{sx:{color:"rgb(152 48 48)"}})})]})]}),t.jsx(M,{})]},i)})},de=({onSubmit:e,onCancel:a,isSubmitting:m,newMode:p=!1})=>{const{t:l}=$();return t.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[t.jsx(L,{variant:"outlined",color:"success",disabled:m,isLoading:m,onClick:c=>{c.preventDefault(),e(c)},children:l(p?"new":"save")}),t.jsx(L,{variant:"outlined",color:"error",onClick:c=>{c.preventDefault(),a()},children:l("cancel")})]})},re=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"];function ue({onClick:e}){return t.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[t.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>e(`<box>
</box>`),children:"<Box>"}),t.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>e(`<a href="/data/memo/" target="_blank" class="ahover">
</a>`),children:"Link"}),t.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>e('<img src="/data/memo/"></img>'),children:"image"}),t.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>e('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"video"}),t.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>e('<hr style="width=100%"/>'),children:"line"}),re.map((a,m)=>t.jsx(y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>e(`<code>lang="${a}" highlight=""`),children:a},m))]})}const me=(e,a)=>{const m=J(),p=A(),{user:l}=G(),c=W();return Y({mutationFn:async({values:s,imageList:g,files:o})=>{const n=p.pathname.includes("/insert"),i=n&&a==="insert"?"root":a,h=await V({rootDb:e,uid:l.uid,newData:n,key:i,values:s}),d=n?h:a,x=e==="memo"?`${e}_txt/${l.uid}/`:`${e}_txt/`,j=e==="memo"?`${e}/${l.uid}/`:`${e}/`;return n||await X(x,j,d,g),await Z(x,j,d,o),e==="memo"&&!n&&(b(`memo_tree/${l.uid}/${d}/title`,s.edTitle),b(`memo_tree/${l.uid}/${d}/text`,s.edTitle),s.rootCheck==="Y"&&b(`memo_tree/${l.uid}/${d}/parent`,"root")),e==="home"&&b("home/tree",null),{key:d,isNew:n}},onMutate:async({values:s})=>{if(p.pathname.includes("/insert"))return;const o=["memoDetail",e,l?.uid,a];await c.cancelQueries({queryKey:o});const n=c.getQueryData(o);return c.setQueryData(o,i=>({...i,title:s.edTitle,memo:s.edContent,gbn:s.edGbn,date:s.edDate,html:i?.html==="sheet"?"sheet":s.htmlCheck,icon:s.iconCheck})),{previousMemoDetail:n,queryKey:o}},onError:(s,g,o)=>{o?.previousMemoDetail&&c.setQueryData(o.queryKey,o.previousMemoDetail),console.error("Error saving memo:",s)},onSuccess:({key:s})=>{const g=`/${e==="memo"?"m":e}/${s}`;m(g,{state:{reflash:!0}})},onSettled:({key:s,isNew:g}={})=>{const o=g?s:a;c.invalidateQueries({queryKey:["twTreeData",e]}),o&&c.invalidateQueries({queryKey:["memoDetail",e,l.uid,o]})}})};export{ce as D,ue as H,de as T,me as u};
