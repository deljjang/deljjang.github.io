const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bv6v8Iqy.js","assets/index-Bz0IPAFl.js","assets/index-DLU66RPy.css","assets/SinySelect-BjyWI8XK.js","assets/index-BZvyzbNo.js","assets/TextField-Bta7E3pu.js","assets/InputAdornment-4VxYxJqL.js","assets/Popper-BtlgN6aV.js","assets/Chip-DBlM8M9f.js","assets/index.esm-D3RJoXIB.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-BOK5qBVx.js","assets/TwButton-CE6j4VmD.js"])))=>i.map(i=>d[i]);
import{j as e,x as J,a1 as Ie,r as g,u as I,L as D,D as X,g as Z,S as ee,T as te,d as Y,i as Re,q as se,e as Ee,o as Fe,a as ae,f as ne,m as re,c as oe,t as ie,v as A,w as le,H as ce,y as _e,z as Be,C as Ye,E as de,F as Pe,G as He,J as P,K as _,N as me,_ as ue,P as M,p as Ae,a2 as We,a3 as Oe,a4 as qe,n as G,Q as ze,R as H,U as Ge,V as Ke,W as Ve,X as B,Y as Ue,$ as Qe}from"./index-Bz0IPAFl.js";import{T as Je,u as ge,a as he,F as Xe,b as Ze,D as et,l as tt,I as st,s as K,d as V,e as at}from"./index-Bv6v8Iqy.js";import{T as nt}from"./TwLayout-CeMJsTlS.js";import{E as xe,C as fe}from"./ExpandMore-CEqJ4s-G.js";import{F as je}from"./Favorite-BAfiPcjA.js";import{T as S}from"./TwButton-CE6j4VmD.js";import{D as rt}from"./datetime-BDx6lZXm.js";import{u as ot}from"./index.esm-D3RJoXIB.js";import"./index-CLQ_oLGC.js";import{S as it,a as lt}from"./SinySelect-BjyWI8XK.js";import{T as ct,I as dt}from"./TextField-Bta7E3pu.js";import{S as mt}from"./check-circle-BMNlEy8K.js";import"./chevron-down-DwLWjGS-.js";import"./index-BZvyzbNo.js";import"./InputAdornment-4VxYxJqL.js";import"./Popper-BtlgN6aV.js";import"./Chip-DBlM8M9f.js";const ut=s=>e.jsx(J.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Ie,{to:s.to,className:"text-inherit no-underline cursor-pointer",...s,children:e.jsx(Je,{children:s.children})})});function gt({initTreeData:s}){const[a,r]=g.useState(),t=o=>r(o),h=I();if(g.useEffect(()=>{r(s)},[s]),a==null||a.length===0)return e.jsx(D,{});const l=o=>{console.log("node",o),h(`/m/${o.id}`)};return e.jsx(X,{backend:ee,options:Z(),children:e.jsx(te,{tree:a,rootId:"root",onDrop:t,render:(o,{depth:j,isOpen:c,onToggle:i})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:j*20+(o.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[o.cnt>0&&e.jsx("div",{onClick:i,children:c?e.jsx(xe,{}):e.jsx(fe,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>l(o),children:o.text})]}),o.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",o.cnt,")"]})]})})})}function ht(s){const{user:a}=Y(),r=I(),[t,h]=g.useState(),[l,o]=g.useState(),j=async c=>{const i=[],n=se(ae(ne,`memo_tree/${c}`),Fe("bm"),Ee("Y")),m=await re(n);if(!m.exists()){console.log("getFireText.null");return}const x=m.val();for(let u in x){const f=x[u];f.id=u,f.key=u,f.text=f.title,i.push(f)}i.sort((u,f)=>u.title>f.title?1:-1),h([...i])};return g.useEffect(()=>{a!==void 0&&a!=null&&j(a?.uid)},[a]),g.useEffect(()=>{const c=async(i,n)=>{const m=[...n];if(n)for(const x of n){let u=x;for(;u.parent!=="root";){u.parent,u=await oe(`memo_tree/${i}/${u.parent}`);const f={id:u.key,text:u.title,droppable:!1,parent:u.parent};m.filter(b=>b.id===f.id).length===0&&m.push(f)}}for(const x of m){const u=x.id;x.cnt=m.filter(f=>f.parent===u).length}o(m)};t&&t.length>0&&c(a?.uid,t)},[t]),a===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Re,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:t&&t.map((c,i)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{s.onSelected(c.key),r(`/m/${c.key}`)},children:e.jsx("span",{className:"text-base",children:c.title})})},i))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),l===void 0||l===null&&e.jsx(Loading,{}),l&&l.length===0?e.jsx("div",{className:"m-4 text-gray-500",children:"No BookMark"}):e.jsx(gt,{initTreeData:l,uid:a?.uid})]})}const xt=s=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(S,{size:"sm",variant:"outlined",color:"success",onClick:s.onEdit,children:"수정"}),e.jsx(S,{size:"sm",variant:"outlined",color:"warning",onClick:s.onNewMemo,children:"새글"}),e.jsx(S,{size:"sm",variant:"outlined",color:"error",onClick:s.onDelete,children:"삭제"})]}),ft=s=>{const{rootDb:a,isLoading:r,memoDetailData:t}=s,{scrollYProgress:h}=ge(),l=he(h,{stiffness:100,damping:30,restDelta:.001}),[o,j]=g.useState(!1),c=I(),i=g.useRef();i.current=s.searchWord;const{memoId:n}=ie(),x=A()?.state?.fullIndex,{user:u}=Y(),f=()=>{const v=`/${a==="memo"?"m":a}/edit/${n}`;c(v,{state:{fullIndex:x}})},y=()=>{const v=`/${a==="memo"?"m":a}/insert/${n}`;c(v,{state:{fullIndex:x}})},b=async()=>{const v=a==="memo"?`${a}_txt/${u.uid}/${n}`:`${a}_txt/${n}`,p=a==="memo"?`${a}_tree/${u.uid}`:a;if(await Ze(v,p)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}s.onTreeUpdate(),c(`/${a==="memo"?"m":a}`)},C=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&b()},w=()=>{s.onBookmark()};return g.useEffect(()=>{t&&t.title!==void 0&&le({title:t.title,description:t.title});function v(){window.scrollTo({top:0}),t&&t.html!=="N"&&document.querySelectorAll("pre").forEach(p=>{p.innerHTML=Pe(p.innerHTML)})}t&&t.memo!==null&&v()},[t]),r?e.jsx(D,{}):n===""||u===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(J.div,{className:"progress-bar",style:{scaleX:l}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:t&&t.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:w,children:t&&t.bookmark==="Y"?e.jsx(je,{className:"text-red-500"}):e.jsx(Xe,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s.pathNm})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(xt,{rootDb:a,onEdit:f,onNewMemo:y,onDelete:C,bookmark:t&&t.bookmark}),e.jsxs("div",{className:"my-4",children:[t&&t.html==="N"?e.jsx(ce,{postData:t&&t.memo}):t&&t.html!=="N"&&t.memo&&e.jsx(_e,{text:t.memo}),e.jsx(Be,{imageList:t&&t.image}),!t&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Ye,{})})})]})]}),e.jsx(de,{})]})},jt=({onSubmit:s,onCancel:a,isSubmitting:r,newMode:t})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(S,{variant:"outlined",color:"success",disabled:r,onClick:h=>{h.preventDefault(),s(h)},children:[t?"새글":""," 저장"]}),e.jsx(S,{variant:"outlined",color:"error",onClick:a,children:"취소"})]});g.forwardRef((s,a)=>{const{id:r,label:t,defaultValue:h,onChange:l,className:o="",...j}=s,c=i=>{l&&l(i.target.value)};return e.jsxs("div",{className:` ${o}`,children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:r,children:t}),e.jsx("input",{ref:a,type:"date",id:r,defaultValue:h,onChange:c,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...j})]})});const U=({label:s,checked:a,id:r,onChange:t,className:h="",disabled:l=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${l?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:r,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${h}`,checked:a,onChange:o=>t(o.target.checked),disabled:l}),a&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),l&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:s})]}),vt=g.forwardRef((s,a)=>{const{placeholder:r="Enter your message",rows:t=3,value:h="",onChange:l,className:o="",disabled:j=!1,error:c=!1,hint:i=""}=s,n=x=>{l&&l(x.target.value)};let m=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${o} `;return j?m+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":c?m+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":m+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:a,placeholder:r,rows:t,value:h,onChange:n,disabled:j,className:m}),i&&e.jsx("p",{className:`mt-2 text-sm ${c?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:i})]})}),kt=g.lazy(()=>ue(()=>import("./index-Bv6v8Iqy.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])));tt.Quill.register("modules/imageDrop",st);me.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const bt={syntax:{highlight:s=>me.highlightAuto(s).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},pt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],yt=s=>{const[a,r]=g.useState(s.imageList),[t,h]=g.useState(s.htmlCheck==="Y"),[l,o]=g.useState(s.iconCheck==="Y"),[j,c]=g.useState(s.newMode?"":s.content),i=g.useRef(),n=g.useRef(),m=g.useRef(null);g.useRef(null);const x=g.useRef(null),u=s.newMode,f=g.useRef([]),{height:y}=He(),b=rt.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),C={edTitle:u?"":s.title,edGbn:s.gbn?s.gbn:"etc",edDate:u?b:s.date,content:u?"":s.content,memoTxt:u?"":s.content,htmlCheck:s.htmlCheck,iconCheck:s.iconCheck},{register:w,handleSubmit:v,trigger:p,control:$,setValue:N,getValues:T,watch:E,formState:{errors:L,isSubmitting:ke}}=ot({mode:"onChange",defaultValues:C});g.useEffect(()=>{w("edDate"),w("edGbn",{required:!0}),w("htmlCheck"),w("iconCheck"),w("memoTxt")},[]),g.useEffect(()=>{f.current=[],i.current=s.content,n.current=!1},[s.content]);const W=async d=>{u?await s.onNewSubmit(d,f.current):await s.onPostSubmit(d,a,f.current)},be=()=>{v(W)()},pe=d=>{console.log("onDelete.imageList=",d),r(d)},ye=d=>{let k=i.current;d.ext==="jpg"?k+=`<img src='${d.url}'/>`:d.ext==="mp4"&&(k+=`<video preload="auto" controls="" src='${d.url}'></video>`),i.current=k},we=d=>{i.current=d},Ne=d=>{console.log("handleFileUpload",d),f.current=d};function Ce(d){i.current=d,N("content",d),p("content")}function Te(d,k){console.log("handleChangeDate=",d),console.log("handleChangeDate.currentDateString=",k);let R=P(d);console.log("handleChangeDate.dayjs=",R.format("YYYY-MM-DD HH:mm:ss")),N("edDate",R.format("YYYY-MM-DD")),p("edDate")}const O=(d,k)=>{console.log(`onChecked.${d}=`,k),N(d,k?"Y":"N"),d==="htmlCheck"?h(k):o(k)},$e=E("content"),Se=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],De=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],Le=d=>{const k=m.current;if(k){const R=k.selectionStart,Me=k.selectionEnd,q=j.slice(0,R),z=j.slice(Me);c(q+d+z),N("memoTxt",q+d+z),setTimeout(()=>{k.selectionStart=k.selectionEnd=R+d.length,k.focus()},0)}},F=d=>{Le(d)};return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:v(W),style:{width:"100%",minHeight:"300px",maxHeight:{height:y},display:"flex",flexDirection:"column"},children:[e.jsx(jt,{onSubmit:d=>be(),onCancel:s.onCancel,isSubmitting:ke,newMode:u}),e.jsx(et,{control:$,onDelete:pe,onInsert:ye,setContent:we,onFileUpload:Ne,imageList:s.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(ct,{...w("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!L.edTitle})}),e.jsx(it,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:$,defaultValue:T("edGbn"),selectList:Se,error:!!L.edGbn,onChange:d=>{d.preventDefault();const k=d.target.value;console.log("edGbn=",T("edGbn")),N("edGbn",k)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(lt,{id:"edDate",label:"일자",value:P(T("edDate")),...w("edDate"),defaultValue:P(T("edDate")),onChange:(d,k)=>{Te(d,k)}}),e.jsx(U,{id:"html",checked:t,onChange:d=>O("htmlCheck",d),label:"HTML사용"}),e.jsx(U,{id:"icon",checked:l,onChange:d=>O("iconCheck",d),label:"Icon"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-130 overflow-y-scroll",children:e.jsx(ce,{postData:j})}),e.jsxs("div",{children:[e.jsx(vt,{ref:m,className:"",value:j,onChange:d=>{N("memoTxt",d),c(d)},rows:22}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>F("<box></box>"),children:"<Box>"}),De.map((d,k)=>e.jsx(_,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>F("<code>"+d+"</code>"),children:d},k)),e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>F('<a href="" target="_blank"></a>'),children:"Link"}),e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>F('<img src=""></img>'),children:"img"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"})]})]}),e.jsx(g.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(kt,{ref:x,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:$e,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:bt,formats:pt,onChange:Ce})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},Q=s=>{const{rootDb:a,isLoading:r,memoDetailData:t}=s,{scrollYProgress:h}=ge();he(h,{stiffness:100,damping:30,restDelta:.001});const l=I(),o=g.useRef(),j=g.useRef();j.current=s.searchWord;const{memoId:c}=ie(),i=A(),{user:n}=Y();o.current=i.pathname.split("/")[2]==="insert",console.log("memoDetailData=",t?.title),console.log("newMode=",o.current,", memoId=",c);const m=()=>{const f=`/${a==="memo"?"m":a}/${c==="insert"?"":c}`;l(f)},x=async(f,y)=>{console.log("onNewSubmit.values",f);const b=await K({rootDb:a,uid:n.uid,newData:o.current,key:c==="insert"?"root":c,values:f});if(await V(`${a}_txt`,a,b,y),b!==void 0){const C=`/${a==="memo"?"m":a}/${b}`;l(C,{state:{reflash:!0}})}},u=async(f,y,b)=>{const C=a==="memo"?`${a}_txt/${n.uid}/`:`${a}_txt/`,w=a==="memo"?`${a}_tree/${n.uid}/`:`${a}/`;await at(C,w,c,y),console.log("onPostSubmit.values",f);const v=await K({rootDb:a,uid:n.uid,newData:o.current,key:c==="insert"?"root":c,values:f});console.log("onPostSubmit.newKey=",v),console.log("onPostSubmit.files=",b);const p=await V(`${C}/`,a==="memo"?`${a}/${n.uid}/`:`${a}/`,c,b);console.log("onNewSubmit.imageResult",p),a==="memo"&&M(`memo_tree/${n.uid}/${c}/title`,f.edTitle),o.current=!1;const $=`/${a==="memo"?"m":a}/${c}`;l($,{state:{reflash:!0}})};return g.useEffect(()=>{t&&t.title!==void 0&&le({title:t.title,description:t.title});function f(){document.querySelectorAll("pre").forEach((y,b)=>{})}t&&t.memo!==null&&f()},[t]),c===""||n===void 0?e.jsx(e.Fragment,{}):t===void 0||r?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full p-0 m-0",children:o.current===!1&&t&&(t.title===void 0||t.title===""||t.title===null)?e.jsx(D,{}):e.jsx(yt,{newMode:o.current,onPostSubmit:u,onNewSubmit:x,onCancel:m,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html:"Y",iconCheck:t?.icon?t?.icon:"Y",content:t?.memo,imageList:t?.image})}),e.jsx(de,{})]})};function wt({initTreeData:s,userId:a}){const[r,t]=g.useState(s),{isMoble:h,height:l,width:o}=Ae(),j=(n,m)=>{if(m.dragSource.id!==void 0&&m.dropTargetId!==void 0){const x=`memo_tree/${a}/${m.dragSource.id}/parent`;M(x,m.dropTargetId),console.log("loc=",x)}t(n)},c=I();if(g.useEffect(()=>{(async()=>{const m=[];if(s)for(const x of s){const u={id:x.key,text:x.title,droppable:!0,parent:x.parent,icon:x.bm==="Y"?e.jsx(je,{className:"text-red-500"}):x.icon==="Y"?e.jsx(mt,{}):null};m.push(u)}for(const x of m){const u=x.id;x.cnt=m.filter(f=>f.parent===u).length}t(m)})()},[s]),r==null||r.length===0)return e.jsx(D,{});const i=n=>{console.log("node",n),c(`/m/${n.id}`)};return e.jsx(X,{backend:ee,options:Z(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:l-220-(h?56:0)+(o>1024?60:0),width:"100%"},children:e.jsx(te,{tree:r,rootId:"root",onDrop:j,render:(n,{depth:m,isOpen:x,onToggle:u,isDragging:f,isDropTarget:y})=>e.jsxs("div",{className:`w-63 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ${f?"opacity-50":""} ${y?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"}`,style:{paddingLeft:m*20+(n.cnt===0?5:0)},children:[e.jsx("div",{className:"min-w-0",children:n.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:u,children:x?e.jsx(xe,{}):e.jsx(fe,{})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>i(n),children:[e.jsxs("div",{className:"flex truncate pr-2",children:[n.icon,n.text]}),n.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",n.cnt,")"]})]})]})})})})}const Nt=s=>{const a=g.useRef(null);function r(){s.onSearchDataBtn(a.current.value)}function t(){return s.onNewMemoBtn(),!1}function h(l){l.which===13&&r()}return e.jsxs(e.Fragment,{children:[e.jsx(dt,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:a,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:h}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(S,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:t,children:"새글"}),e.jsx(S,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:r,children:"조회"})]})]})},Ct=async(s,a,r)=>{let t=new Array;for(let h in r){const l=r[h];try{if(l.key=h,l.url===void 0){const o=await We(Oe,`${a}/${h}.${l.ext}`),j=await qe(o);l.url=j,M(`${s}/image/${h}/url`,j)}t.push(l)}catch(o){console.log("getImageList.catch",o)}}return t},Tt=async(s,a,r,t)=>{let h="",l="",o={};((i,n,m)=>{l=i==="memo"?`${i}/${n}/${m}`:`${i}/${m}`,h=i==="memo"?`${i}_txt/${n}/${m}`:`${i}_txt/${m}`})(s,a,r);async function c(){if(h===void 0)return"";if(o=await oe(h),o===void 0)return console.log("No data available"),"";if(o?.fullIndex,o.image!==void 0&&o.image!==null){const i=await Ct(h,l,o.image);o.image=i,(o.imageOK===void 0||o.imageOK==="N")&&(i&&i.map(n=>{n.ext==="jpg"&&(o.memo=o.memo+`<img src='${n.url}'>`)}),M(`${h}/imageOK`,"Y"),M(`${h}/memo`,o.memo))}if(t!==void 0&&t!==""){const i=t,n=new RegExp(i,"gi"),m=o.memo.replace(n,`<span class='lightext'>${i}</span>`);o.memo=m}}return await c(),o};async function $t(s,a,r=""){if(a==null||a==="")return"";let t=r===""?`${s}_tree/${a}`:`${s}_txt/${a}`;s==="home"&&(t="home_txt");const h=se(ae(ne,t)),l=await re(h);if(!l.exists())return console.log("getTreeData.null"),null;if(!l.exists())return console.log("getTreeData.exists"),null;const o=l.val(),j=[],c={};s==="home"&&(G.map(i=>{j.push({title:i.label,id:i.id,sub:[]})}),G.map(i=>{c[i.id]=[]}));for(const i in o){const n=o[i];n.key==="-OZNT48PGjAjZLiXNY8F"&&console.log("i="+i,", item=",n),n.up===void 0?(n.id=i,n.fullIndex=i):(n.id=n.up,n.fullIndex=n.up),s==="home"?n.gbn!==void 0&&c[n.gbn].push(n):r===""||r===void 0?j.push(n):(n.id=i,(n.memo+"").toLowerCase().indexOf(r.toLowerCase())>-1&&j.push(n))}return s==="home"?Object.values(c).map((i,n)=>{i.sort((m,x)=>m.title>x.title?1:-1),j[n].sub=i}):j.sort((i,n)=>i.title>n.title?1:-1),j}const St=g.lazy(async()=>await ue(()=>import("./TwMemoMain-BOK5qBVx.js"),__vite__mapDeps([11,1,2,12]))),Dt=({rootDb:s})=>{const a=I(),{user:r}=Y(),t=g.useRef(),h=g.useRef(),l=g.useRef(!0),o=g.useRef(),j=g.useRef(),[c,i]=g.useState(),n=g.useRef(!1),m=A(),x=g.useRef(!1);x.current=m?.state?.reflash===!0;const u=ze({queryKey:["twTreeData",r?.uid,t.current],queryFn:()=>$t(s,r?.uid,t.current)});u.data!==void 0&&u.data!==""&&!n.current&&(n.current=!0);const f=()=>{const v=c;v&&(v.bookmark=v.bookmark==="Y"?"N":"Y");const p=`memo_tree/${r.uid}/${j.current}/bm`;M(p,c.bookmark),i({...c,bookmark:v.bookmark})};g.useEffect(()=>{r!==void 0&&r!=null&&u.refetch()},[r]),g.useEffect(()=>{const v=async N=>{if(N!==""&&r){const T=await Tt(s,r?.uid,N,t.current);{const E=ve(u.data,{id:"",nm:""},N),L=E.id;h.current=E.nm,L!==o&&(o.current=L,Qe(r.uid,N,L))}T!==void 0&&T?.bookmark===void 0&&(T.bookmark="N"),l.current=!1,i(T===void 0?{}:T)}},p=m.pathname.split("/"),$=p.length>2?p[p.length-1]:"";l.current=!0,v($),j.current=$},[m.pathname,r]),g.useEffect(()=>{r!==void 0&&r!=null&&u.refetch()},[x.current]);const y=v=>{n.current=!1,v!==void 0&&(t.current=v),u.refetch()},b=()=>{if(r==null){alert("로그인 후 이용 가능합니다.");return}const v=`/${s==="memo"?"m":s}/insert/insert`;a(v)},C=v=>{},w=e.jsxs("div",{className:"",children:[e.jsx("div",{className:"mt-3",children:e.jsx(ut,{to:"/m",children:s==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[s==="memo"?"":e.jsx(H,{to:"/m",children:"메모"}),e.jsx(H,{to:"/todo",children:"TODO"}),e.jsx(H,{to:"/tail",children:"Sheet"})]}),e.jsx(Nt,{onNewMemoBtn:b,onSearchDataBtn:y}),n.current&&u.isFetched?e.jsx(wt,{expandIndex:o.current,initTreeData:u.data,userId:r?.uid}):r===void 0?e.jsx(e.Fragment,{}):e.jsx(D,{})]});return r&&r.uid===Ge&&Ke,e.jsxs(nt,{sideType:"memo",title:s==="memo"?"메모장":"홈페이지관리",sideContents:w,children:[e.jsx(g.Suspense,{fallback:e.jsx(D,{}),children:e.jsxs(Ve,{children:[e.jsx(B,{path:"/edit/:memoId",element:e.jsx(Q,{rootDb:s,isLoading:l.current,searchWord:t.current,memoDetailData:c})}),e.jsx(B,{path:"/insert/:memoId",element:e.jsx(Q,{rootDb:s,isLoading:l.current,searchWord:t.current,memoDetailData:c})}),e.jsx(B,{path:"/:memoId",element:e.jsx(ft,{rootDb:s,isLoading:l.current,searchWord:t.current,memoDetailData:c,onTreeUpdate:y,pathNm:h.current,onBookmark:f,data:u.data})}),e.jsx(B,{path:"*",element:e.jsx(St,{searchWord:t.current,data:u.data,onNewMemoBtn:b,title:s==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),s==="memo"?e.jsx(ht,{onSelected:C}):"",e.jsx(Ue,{})]})},ve=(s,a,r)=>{let t={};if(s)for(let h=0;h<s.length;h++){const l=s[h];if(l.id===r)return t.id=a.id+l.id,t.nm=a.nm+l.title,t;if(l.sub!==null&&l.sub!==void 0){if(t.id=a.id+l.id+"/sub/",t.nm=a.nm+l.title+" > ",t=ve(Object.values(l.sub),t,r),t.id&&t.id.endsWith(r))return t;t={}}}return t},Kt=()=>e.jsx(Dt,{rootDb:"memo"});export{Kt as default};
