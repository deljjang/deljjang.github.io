import{e as D,j as t,a1 as N,i as q,I as O,r as a,a4 as ue,a5 as he,a6 as ge,a7 as fe,J as ve,N as S,a8 as xe,a9 as ye,n as je,K as pe,aa as we,ab as be,t as A,v as K,ac as Ne,s as v,ad as ke,ae as Ce,M as Ie,V as ze}from"./index-CmP4Fnif.js";const Se=({ui:p,onInsert:u,onDelete:h,onReload:y,onCsvSave:c})=>{const{t:g}=D();return t.jsxs("div",{className:"my-2 flex justify-end items-center",children:[t.jsx(N,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:u,children:g("input")}),t.jsx(N,{type:"button",size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:h,children:g("delete")}),t.jsx(N,{type:"button",size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:y,children:g("reload")}),t.jsx(N,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:c,children:g("csv_save")})]})},x=[{title:"division",data:"dv",readOnly:!1,select:!0},{title:"title",type:"text",data:"title",select:!0},{title:"description1",type:"text",data:"t1",select:!0},{title:"description2",type:"text",data:"t2",select:!0},{title:"sort",type:"text",data:"sort",select:!1,hidden:!0},{title:"id",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];Ie();const De=({csvFileName:p="exported_sheet",baseUrl:u="sheet",selectDefault:h="1"})=>{const{user:y}=q(),c=y?.uid,{ui:g}=O(),{t:o}=D(),L=x.length-1,m=a.useRef(null),w=a.useRef(null),[k,G]=a.useState(),[J,_]=a.useState(0),{height:R,width:E}=ue(),Z=()=>t.jsxs("div",{className:"w-full pt-5",children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})]}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end mt-2",children:[t.jsx("div",{className:"h-6 bg-gray-200 dark:bg-zinc-800 rounded w-24 animate-shimmer relative overflow-hidden"}),t.jsx("div",{className:"flex justify-end h-10",children:t.jsx("div",{className:"w-32 h-full bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})})]}),t.jsxs("div",{className:"mt-2 space-y-1",children:[t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-t-md animate-shimmer relative overflow-hidden"}),[...Array(10)].map((e,s)=>t.jsx("div",{className:"h-8 bg-gray-300 dark:bg-zinc-700 rounded animate-shimmer relative overflow-hidden"},s))]})]}),F=a.useRef(!1),[Q,U]=he(ge),{theme:X,settings:Y,colWidths:ee,setColWidths:C}=O();fe.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:te,reset:_e,control:P,setValue:$,getValues:I,formState:{errors:se}}=ve({mode:"submit "}),re=X==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",ne=async e=>{const s=`${u}/${c}/`;if(e.id===void 0||e.id===null||e.id===""){const r=ke(Ce(A(K),s)).key;e.id=r}return v(s+e.id+"/dv",e.dv),v(s+e.id+"/title",e.title),v(s+e.id+"/t1",e.t1),v(s+e.id+"/t2",e.t2),v(s+e.id+"/ing","1"),e},ie=async()=>{const e=`${u}/${c}/`,s=we(A(K,e),be("dv"));Ne(s,r=>{if(!r.exists())return;const i=r.val(),l=[];for(let d in i){const n=i[d];n.id=d,n.sort=`${n.dv}_${n.title}`,l.push(n)}l.sort((d,n)=>d.sort>n.sort?1:-1),G(l),_(l.length)})};a.useEffect(()=>{te("filterField1"),$("columns1",h)},[]),a.useEffect(()=>{c!==void 0&&ie()},[c]),a.useEffect(()=>{E<500&&F.current===!1&&(F.current=!0,C([100,100,100,100,100,100]))},[E]),a.useEffect(()=>{m.current.hotInstance.addHook("afterColumnResize",function(s,r){const i=ee;try{i[r]=s,C(i)}catch{C([130,300,100,100,100,100])}})},[m.current]);const le=async()=>{B()},ae=async()=>{m.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:p,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},T=[],W={indicators:!0},M=[],V=[];x.map((e,s)=>{e.select&&T.push({value:s,text:o(e.title),label:o(e.title)}),V.push({...e,title:o(e.title)}),e.hidden===!0&&M.push(s)}),W.columns=M;const B=()=>{try{const e=m.current?.hotInstance,s=e?.getPlugin("filters");if(s){const r=I("columns1");U(I("filterField1")),x.forEach((d,n)=>{s?.removeConditions(n)}),s?.addCondition(Number(r),"contains",[I("filterField1")]),s?.filter(),e?.render();const l=e.getData().length;_(l)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function oe(){m.current.hotInstance.alter("insert_row_above",0,1)}const ce=async(e,s)=>{if(e===null)return;const r=m.current?.hotInstance,i=r?.getPlugin("filters");if(i==null)return;const l=r.getData(),d={};e.forEach(async(f,z)=>{d[f[0]]=f[0]});const n=[];Object.keys(d).map(f=>{const z=d[f],b={};x.forEach(async(j,me)=>{b[j.data]=l[z][me]}),n.push(b)}),n.forEach(async(f,z)=>{const b=await ne(f);k.map(j=>{(j.id===void 0||j.id===null)&&(j.id=b?.id)})}),r.render()},de=async()=>{const e=m.current.hotInstance;if(e&&w.current!==null){if(e?.getPlugin("filters")){const i=e.getData()[w.current][L],l=o("delete_confirm_message");window.confirm(l)&&v(`${u}/${c}/${i}`,null)}e.alter("remove_row",w.current,1)}},H=e=>{const s=e.target.value;$(e.target.name,s)};return y===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:t.jsx(S,{children:o("login_required")})}):k?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx(xe,{id:"columns1",name:"columns1",placeholder:o("search_column"),control:P,className:"dark:bg-dark-900",defaultValue:h||"1",options:T,error:!!se.columns1,onChange:H}),t.jsx(ye,{name:"filterField1",control:P,label:o("search"),placeholder:o("search_placeholder"),variant:"filled",margin:"none",onKeyUp:B,onChange:H,value:Q})]}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[t.jsx(S,{className:"align-middle pt-2 md:pt-0 text-right md:text-left",children:o("count")+" : "+je(J)}),t.jsx(Se,{ui:g,onInsert:oe,onDelete:de,onReload:le,onCsvSave:ae})]}),t.jsx("div",{className:"w-full",style:{maxHeight:`${R} - 210`,overflow:"auto"},children:t.jsx(pe,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:m,data:k,themeName:re,rowHeaders:!0,colHeaders:x.map(e=>o(e.title)),autoWrapRow:!0,height:R-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:ce,afterSelection:e=>{w.current=e},columns:V,cells:(e,s)=>x[s].readOnly===!0?{readOnly:!0}:{},colWidths:Y.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:W,licenseKey:"non-commercial-and-evaluation"})})]}):t.jsx(Z,{})};function Ee(){const{user:p}=q(),{t:u}=D();a.useEffect(()=>{ze({title:"",description:""})},[]);const h=()=>t.jsxs("div",{className:"w-full pt-5",children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})]}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end mt-2",children:[t.jsx("div",{className:"h-6 bg-gray-200 dark:bg-zinc-800 rounded w-24 animate-shimmer relative overflow-hidden"}),t.jsx("div",{className:"flex justify-end h-10",children:t.jsx("div",{className:"w-32 h-full bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})})]}),t.jsxs("div",{className:"mt-2 space-y-1",children:[t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-t-md animate-shimmer relative overflow-hidden"}),[...Array(10)].map((y,c)=>t.jsx("div",{className:"h-8 bg-gray-300 dark:bg-zinc-700 rounded animate-shimmer relative overflow-hidden"},c))]})]});return p===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:t.jsx(S,{children:u("login_required")})}):t.jsx(a.Suspense,{fallback:t.jsx(h,{}),children:t.jsx(De,{})})}export{Ee as default};
