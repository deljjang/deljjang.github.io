import{j as t}from"./index-BUTaIAh4.js";import{i as _,p as g,Q as se,k as ae,X as le,a5 as ne,a6 as re,a7 as V,a8 as E,a9 as oe,a4 as P,V as T,z as ie,R as ce,ab as m,ac as de,ad as ue,U as me,t as he}from"./App-CdriGxVX.js";import{D as fe}from"./luxon-MrBZWWSV.js";import{r as u}from"./router-BlMcuVHC.js";import{u as ge}from"./useWindowDimensions-c3RsCB5T.js";import{T as xe}from"./TwDatePicker-BWY_2iuI.js";import{T as ye}from"./TwSelect-Cl8w6Spb.js";import"./vendor-CCYiWZgt.js";const we=[130,500,100,100,100],M=[{title:"col_date",data:"date",type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,readOnly:!1,select:!0},{title:"col_title",type:"text",data:"title",select:!0},{title:"col_1",type:"text",data:"t1",select:!1},{title:"col_2",type:"text",data:"t2",select:!1},{title:"col_sort",type:"text",data:"sort",select:!1,hidden:!0},{title:"col_ing",type:"text",data:"ing",select:!1,hidden:!0},{title:"col_id",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}],De=s=>{const{t:n}=_();return t.jsxs("div",{className:"my-2 flex flex-grow items-center justify-end whitespace-nowrap pt-0",children:[t.jsx(g,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:s.onInsert,className:"mr-2",children:n("input")}),t.jsx(g,{type:"button",size:"sm",variant:"outlined",color:"warning",onClick:s.onDelete,className:"mr-2",children:n("delete")}),t.jsx(g,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:s.onReload,className:"mr-2",children:n("reload")}),t.jsx(g,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:s.onCsvSave,children:n("csv_save")})]})};me();const pe=s=>{const{userId:n,baseUrl:x}=s,d=u.useRef(null),y=u.useRef(null),[U,W]=u.useState([]),[z,w]=u.useState(0),{height:C}=ge(),{t:l}=_(),F=fe.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),O={edTitle:"",edDate:F},{register:D,handleSubmit:q,trigger:A,control:p,setValue:b,getValues:I,reset:B,formState:{errors:h}}=se({mode:"submit ",defaultValues:O}),H=ae(le)==="dark"?"ht-theme-main-dark-auto":"ht-theme-main";u.useEffect(()=>{D("edDate",{required:!0,minLength:10}),D("filterField1"),b("columns1",s.selectDefault),D("edTitle",{required:l("required_field"),minLength:{value:1,message:l("min_length_1")}})},[]),u.useEffect(()=>{if(!n)return;const e=ne(V(E,`${x}/${n}`),re("date")),a=oe(e,r=>{const o=r.val(),i=o?Object.keys(o).map(c=>({id:c,...o[c]})):[];i.sort((c,f)=>c.date>f.date?-1:1),W(i),w(i.length)});return()=>a()},[n,x]);const L=async()=>{$()},Y=async()=>{d.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:s.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},N=[],R={indicators:!0},k=[],S=new Array;s.columns.map((e,a)=>{S.push({...e,title:l(e.title)}),e.select&&N.push({value:a,text:l(e.title),label:l(e.title)}),e.hidden===!0&&k.push(a)}),R.columns=k;const $=()=>{try{const e=d.current?.hotInstance,a=e?.getPlugin("filters");if(a){const r=I("columns1");s.columns.forEach((c,f)=>{a?.removeConditions(f)}),a?.addCondition(Number(r),"contains",[I("filterField1")]),a?.filter(),e?.render();const i=e.getData().length;w(i)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function K(){q(G)()}function G(e,a){const r=`${s.baseUrl}/${n}/`,o=de(ue(V(E),r)).key;m(r+o+"/title",e.edTitle),m(r+o+"/date",e.edDate),m(r+o+"/ing","1"),B({edTitle:"",edDate:F})}const Q=async(e,a)=>{if(a==="loadData"||!e)return;const r=d.current?.hotInstance;r&&e.forEach(async o=>{const[i,c,f,ee]=o,j=r.getSourceDataAtRow(i);if(j&&j.id){const te=`${x}/${n}/${j.id}/${c}`;await m(te,ee)}})},X=async()=>{const e=d.current.hotInstance;if(e&&y.current!==null&&e?.getPlugin("filters")){const o=e.getData()[y.current][s.keyId],i=l("delete_confirm_message_simple");window.confirm(i)&&m(`${s.baseUrl}/${n}/${o}`,null)}},v=e=>{b(e.target.name,e.target.value)};function Z(e,a){b("edDate",a),A("edDate")}const J=h?.edTitle?t.jsx("div",{className:"sm:grid-cols-12 md:grid-cols-12 lg:grid-cols-12 xl:grid-cols-12",children:t.jsx("p",{className:"error",children:h.edTitle?.message})}):"";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx(ye,{id:"columns1",name:"columns1",placeholder:l("search_column"),control:p,className:"dark:bg-dark-900",defaultValue:s.selectDefault?s.selectDefault:"1",options:N,error:!!h.columns1,onChange:v}),t.jsx(P,{name:"filterField1",control:p,label:l("search"),placeholder:l("search_placeholder"),variant:"filled",margin:"none",onKeyUp:$,onChange:v}),t.jsx(xe,{control:p,id:"edDate",name:"edDate",label:l("registration_date"),placeholder:l("date_input_placeholder"),onChange:Z}),t.jsxs("div",{children:[t.jsx(T,{htmlFor:"edTitle",children:l("registration_title")}),t.jsx(P,{name:"edTitle",label:l("title"),placeholder:l("title_input_placeholder"),variant:"filled",onChange:v,error:!!h.edTitle})]})]}),J,t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2 items-end",children:[t.jsx(T,{className:"align-middle pt-2 md:pt-0 text-right md:text-left",children:l("count")+" : "+ie(z)}),t.jsx(De,{onInsert:K,onDelete:X,onReload:L,onCsvSave:Y})]}),t.jsx("div",{style:{maxHeight:`${C}- 200`,overflow:"auto"},children:t.jsx(ce,{ref:d,data:U,className:H,rowHeaders:!0,colHeaders:s.columns.map(e=>l(e.title)),autoWrapRow:!0,height:C-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:Q,afterSelection:e=>{y.current=e},afterFilter:()=>{w(d.current?.hotInstance.countRows()||0)},licenseKey:"non-commercial-and-evaluation",columns:S,cells:(e,a)=>s.columns[a].readOnly===!0?{readOnly:!0}:{},colWidths:s.colWidths,manualColumnResize:!0,filters:!0,dropdownMenu:!0,stretchH:"last",hiddenColumns:R})})]})},Re=()=>{const{user:s}=he(),{t:n}=_();return!s||s?.uid===void 0?t.jsx("div",{className:"flex flex-col items-center w-full mt-[50px] mb-[100px]",children:t.jsx(T,{children:n("login_required")})}):t.jsx(t.Fragment,{children:t.jsx(pe,{csvFileName:"exported_todo",baseUrl:"todo",columns:M,colWidths:we,selectDefault:"1",keyId:M.length-1,userId:s?.uid})})};export{Re as default};
