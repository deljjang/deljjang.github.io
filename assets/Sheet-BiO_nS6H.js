import{h as D,j as e,a4 as N,q as L,a2 as O,r as a,bj as he,bk as ge,bl as fe,aP as ve,Q as xe,J as _,bm as ye,bn as pe,t as be,S as je,bo as we,bp as Ne,A as V,E as K,bq as ke,I as x,br as Ce,bs as ze,U as Ie,s as Se}from"./index-BzuWPuiH.js";import{A as k}from"./AniButton-BJAyd9wR.js";import"./Button-BeKlVPSq.js";const _e=({ui:p,onInsert:u,onDelete:h,onReload:f,onCsvSave:o})=>{const{t:c}=D();return p==="tailwind"?e.jsxs("div",{className:"my-2 flex justify-end items-center",children:[e.jsx(N,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:u,children:c("input")}),e.jsx(N,{type:"button",size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:h,children:c("delete")}),e.jsx(N,{type:"button",size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:f,children:c("reload")}),e.jsx(N,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:o,children:c("csv_save")})]}):e.jsxs("div",{className:"my-2 flex justify-end items-center gap-1",children:[e.jsx(k,{type:"button",size:"small",variant:"outlined",color:"warning",className:"mr-2",onClick:u,children:c("input")}),e.jsx(k,{type:"button",size:"small",variant:"outlined",color:"error",className:"mr-2",onClick:h,children:c("delete")}),e.jsx(k,{type:"button",size:"small",variant:"outlined",color:"success",className:"mr-2",onClick:f,children:c("reload")}),e.jsx(k,{type:"button",size:"small",variant:"outlined",color:"success",onClick:o,children:c("csv_save")})]})},y=[{title:"division",data:"dv",readOnly:!1,select:!0},{title:"title",type:"text",data:"title",select:!0},{title:"description1",type:"text",data:"t1",select:!0},{title:"description2",type:"text",data:"t2",select:!0},{title:"sort",type:"text",data:"sort",select:!1,hidden:!0},{title:"id",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];Ie();const De=({csvFileName:p="exported_sheet",baseUrl:u="sheet",selectDefault:h="1"})=>{const{user:f}=L(),o=f?.uid,{ui:c}=O(),{t:d}=D(),G=y.length-1,g=a.useRef(null),j=a.useRef(null),[C,J]=a.useState(),[Q,E]=a.useState(0),{height:R,width:F}=he(),U=()=>e.jsxs("div",{className:"w-full pt-5",children:[e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})]}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end mt-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-zinc-800 rounded w-24 animate-shimmer relative overflow-hidden"}),e.jsx("div",{className:"flex justify-end h-10",children:e.jsx("div",{className:"w-32 h-full bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-t-md animate-shimmer relative overflow-hidden"}),[...Array(10)].map((t,s)=>e.jsx("div",{className:"h-8 bg-gray-300 dark:bg-zinc-700 rounded animate-shimmer relative overflow-hidden"},s))]})]}),P=a.useRef(!1),[Z,X]=ge(fe),{theme:Y,settings:ee,colWidths:te,setColWidths:z}=O();ve.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:se,reset:Ee,control:$,setValue:T,getValues:I,formState:{errors:re}}=xe({mode:"submit "}),ne=Y==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",ie=async t=>{const s=`${u}/${o}/`;if(t.id===void 0||t.id===null||t.id===""){const r=Ce(ze(V(K),s)).key;t.id=r}return x(s+t.id+"/dv",t.dv),x(s+t.id+"/title",t.title),x(s+t.id+"/t1",t.t1),x(s+t.id+"/t2",t.t2),x(s+t.id+"/ing","1"),t},le=async()=>{const t=`${u}/${o}/`,s=we(V(K,t),Ne("dv"));ke(s,r=>{if(!r.exists())return;const i=r.val(),l=[];for(let m in i){const n=i[m];n.id=m,n.sort=`${n.dv}_${n.title}`,l.push(n)}l.sort((m,n)=>m.sort>n.sort?1:-1),J(l),E(l.length)})};a.useEffect(()=>{se("filterField1"),T("columns1",h)},[]),a.useEffect(()=>{o!==void 0&&le()},[o]),a.useEffect(()=>{F<500&&P.current===!1&&(P.current=!0,z([100,100,100,100,100,100]))},[F]),a.useEffect(()=>{g.current.hotInstance.addHook("afterColumnResize",function(s,r){const i=te;try{i[r]=s,z(i)}catch{z([130,300,100,100,100,100])}})},[g.current]);const ae=async()=>{H()},oe=async()=>{g.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:p,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},W=[],A={indicators:!0},B=[],q=[];y.map((t,s)=>{t.select&&W.push({value:s,text:d(t.title),label:d(t.title)}),q.push({...t,title:d(t.title)}),t.hidden===!0&&B.push(s)}),A.columns=B;const H=()=>{try{const t=g.current?.hotInstance,s=t?.getPlugin("filters");if(s){const r=I("columns1");X(I("filterField1")),y.forEach((m,n)=>{s?.removeConditions(n)}),s?.addCondition(Number(r),"contains",[I("filterField1")]),s?.filter(),t?.render();const l=t.getData().length;E(l)}}catch(t){console.error("Error:",t),console.error("Error:",t.message)}};async function ce(){g.current.hotInstance.alter("insert_row_above",0,1)}const de=async(t,s)=>{if(t===null)return;const r=g.current?.hotInstance,i=r?.getPlugin("filters");if(i==null)return;const l=r.getData(),m={};t.forEach(async(v,S)=>{m[v[0]]=v[0]});const n=[];Object.keys(m).map(v=>{const S=m[v],w={};y.forEach(async(b,ue)=>{w[b.data]=l[S][ue]}),n.push(w)}),n.forEach(async(v,S)=>{const w=await ie(v);C.map(b=>{(b.id===void 0||b.id===null)&&(b.id=w?.id)})}),r.render()},me=async()=>{const t=g.current.hotInstance;if(t&&j.current!==null){if(t?.getPlugin("filters")){const i=t.getData()[j.current][G],l=d("delete_confirm_message");window.confirm(l)&&x(`${u}/${o}/${i}`,null)}t.alter("remove_row",j.current,1)}},M=t=>{const s=t.target.value;T(t.target.name,s)};return f===void 0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:e.jsx(_,{children:d("login_required")})}):C?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx(ye,{id:"columns1",name:"columns1",placeholder:d("search_column"),control:$,className:"dark:bg-dark-900",defaultValue:h||"1",options:W,error:!!re.columns1,onChange:M}),e.jsx(pe,{name:"filterField1",control:$,label:d("search"),placeholder:d("search_placeholder"),variant:"filled",margin:"none",onKeyUp:H,onChange:M,value:Z})]}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[e.jsx(_,{className:"align-middle pt-2 md:pt-0 text-right md:text-left",children:d("count")+" : "+be(Q)}),e.jsx(_e,{ui:c,onInsert:ce,onDelete:me,onReload:ae,onCsvSave:oe})]}),e.jsx("div",{className:"w-full",style:{maxHeight:`${R} - 210`,overflow:"auto"},children:e.jsx(je,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:g,data:C,themeName:ne,rowHeaders:!0,colHeaders:y.map(t=>d(t.title)),autoWrapRow:!0,height:R-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:de,afterSelection:t=>{j.current=t},columns:q,cells:(t,s)=>y[s].readOnly===!0?{readOnly:!0}:{},colWidths:ee.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:A,licenseKey:"non-commercial-and-evaluation"})})]}):e.jsx(U,{})};function $e(){const{user:p}=L(),{t:u}=D();a.useEffect(()=>{Se({title:"",description:""})},[]);const h=()=>e.jsxs("div",{className:"w-full pt-5",children:[e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})]}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end mt-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-zinc-800 rounded w-24 animate-shimmer relative overflow-hidden"}),e.jsx("div",{className:"flex justify-end h-10",children:e.jsx("div",{className:"w-32 h-full bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-t-md animate-shimmer relative overflow-hidden"}),[...Array(10)].map((f,o)=>e.jsx("div",{className:"h-8 bg-gray-300 dark:bg-zinc-700 rounded animate-shimmer relative overflow-hidden"},o))]})]});return p===void 0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:e.jsx(_,{children:u("login_required")})}):e.jsx(a.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(De,{})})}export{$e as default};
