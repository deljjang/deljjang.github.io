import{y as N,e as B,r as i,t as E,j as e,v as S,T as W,g as $,h as l}from"./index-Bq2okyO2.js";import{u as C}from"./useSuspenseQuery-BpwhCoLO.js";import{T as O}from"./Footer-Lko9pIeR.js";import{b as U,T as f}from"./TwLinkItem-B8UrJan3.js";import{L as y}from"./Loading-B2jgiSoZ.js";import{s as q}from"./fireDatabase-CYS3RlZB.js";import{T as H,a as L,b as K,c as Q,d as Y,e as _}from"./TwTreeTop-o5q6PdXa.js";import{g as z,T as A,H as G}from"./HomeChartForm-CrKT0MNu.js";import{f as J}from"./fireMemoDetail-ZMonhKoQ.js";import{g as P}from"./memoFun-DpPhML4t.js";import"./useBaseQuery-BXiiY0J8.js";import"./LinkItem-DmovyF0G.js";import"./Typography-BfnFn_Qs.js";import"./Divider-CoH0J48V.js";import"./dividerClasses-KAVeIEaH.js";import"./Link-DErjXeoJ.js";import"./Container-CEuUXhjH.js";import"./styled-DCHl2VxL.js";import"./CircularProgress-DE_ns1Ov.js";import"./TwTitleItem-CQU8MXJC.js";import"./Favorite-DRhf5tyn.js";import"./createSvgIcon-CBn5T6Tm.js";import"./useControlled-D1xcdFA9.js";import"./isMuiElement-Bvb7Om-V.js";import"./SinyImageList-CFEByq8N.js";import"./ImageListItem-DlZmjzGn.js";import"./HtmlCode-CcJgXMxz.js";/* empty css                 */import"./copy-B2H1mvTf.js";import"./TwBadge-DboCGo9m.js";import"./index-wES6wE32.js";import"./DndProvider-BV4eX6zg.js";import"./TwButton-DnBv8mIC.js";import"./ComponentCard-BPcemxZ9.js";import"./TwRadio-DMUnqq83.js";import"./toPropertyKey-DCwh5dYN.js";import"./TwInput-C6zKzPJT.js";import"./CodeText-fx9oxgjL.js";import"./commonUtil-BuOP-BrX.js";import"./useWindowDimensions-bUsLyrm4.js";import"./datetime-BDx6lZXm.js";import"./index.esm-Dv4f8xaF.js";import"./TwCheckbox-BD-L7j_8.js";import"./TwTextArea-WjZYCG9m.js";import"./SinyDate-CHZdUciK.js";import"./Grid-WFSBEAVW.js";import"./useTheme-CX-Cb1hk.js";import"./index-BmhRCdrV.js";import"./Menu-DY6WpP5T.js";import"./resolveComponentProps-B8WY-0yn.js";import"./IconButton-DHhRMkHw.js";import"./TextField-8vjJMIN2.js";import"./InputAdornment-KSIxnVbO.js";import"./Popper-BW2t4pNd.js";import"./Button-DCoXIv0f.js";import"./Chip-DFsKd4ZK.js";import"./TwSelect-2-7eLP7d.js";import"./TwDatePicker-BXgrhvrE.js";import"./IpInfo-DMnSH6rM.js";import"./right-BdMWXTWk.js";import"./check-circle-CRfLj93W.js";import"./HomeChartSemiDonut-BSoZRZ51.js";const ot=({rootDb:t})=>{const T=N(),{user:r}=B(),s=i.useRef(),a=i.useRef(!0),c=i.useRef(),[n,h]=i.useState(),d=i.useRef(!1),x=E(),j=i.useRef(!1);j.current=x?.state?.reflash===!0;const m=C({queryKey:["twTreeData",r?.uid,s.current],queryFn:()=>z(t,r?.uid,s.current)});m.data!==void 0&&m.data!==""&&!d.current&&(d.current=!0);const M=()=>{const o=n;o&&(o.bookmark=o.bookmark==="Y"?"N":"Y"),console.log("onBookmark.memoDetailData.bookmark=",o.bookmark),console.log("onBookmark.rootDb=",t);const u=t==="memo"?`memo_tree/${r.uid}/${c.current}/bm`:`home_txt/${c.current}/bookmark`;q(u,n.bookmark),h({...n,bookmark:o.bookmark})};i.useEffect(()=>{r!==void 0&&r!=null&&m.refetch()},[r]),i.useEffect(()=>{const o=async k=>{if(k!==""&&r){const p=await J(t,r?.uid,k,s.current);t==="memo"&&(p.path=P(m.data,k)),p.code==="404"&&(p.title="No title"),a.current=!1,h(p===void 0?{}:p)}else h({})},u=x.pathname.split("/"),v=u.length>2?u[u.length-1]:"";a.current=!0,c.current=v,o(v)},[x.pathname,r,j.current]),i.useEffect(()=>{r!==void 0&&r!=null&&m.refetch()},[j.current]);const g=o=>{d.current=!1,o!==void 0&&(s.current=o),m.refetch()},I=o=>{o.id!==c.current&&(a.current=!0,T(`/${t==="memo"?"m":t}/${o.id}`))},w=()=>{if(r==null){alert("로그인 후 이용 가능합니다.");return}const o=`/${t==="memo"?"m":t}/insert/insert`;T(o)},F=o=>{},R=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3 flex items-center justify-center",children:e.jsx(U,{to:t==="memo"?"/m":"/home",children:t==="memo"?"메모장":"홈관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[t==="memo"?"":e.jsx(f,{to:"/m",children:"메모"}),t==="memo"&&r?.uid===S?e.jsx(f,{to:"/home",children:"홈관리"}):null,e.jsx(f,{to:"/todo",children:"TODO"}),e.jsx(f,{to:"/tw",children:"Sheet"})]}),r!==null&&e.jsx(H,{onNewMemoBtn:w,onSearchDataBtn:g}),d.current&&m.isFetched?e.jsx(A,{initTreeData:m.data,userId:r?.uid,memoId:c.current,onClick:I}):r===null?e.jsx(e.Fragment,{}):e.jsx(y,{})]});return e.jsxs(W,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:R,children:[e.jsx(i.Suspense,{fallback:e.jsx(y,{}),children:e.jsxs($,{children:[e.jsx(l,{path:"/edit/:memoId",element:e.jsx(L,{rootDb:t,isLoading:a.current,searchWord:s.current,memoDetailData:n})}),e.jsx(l,{path:"/insert/:memoId",element:e.jsx(L,{rootDb:t,isLoading:a.current,searchWord:s.current,memoDetailData:n})}),e.jsx(l,{path:"/util/:memoId",element:e.jsx(K,{rootDb:t,isLoading:a.current,searchWord:s.current,memoDetailData:n})}),e.jsx(l,{path:"/:memoId",element:e.jsx(Q,{rootDb:t,isLoading:a.current,searchWord:s.current,memoDetailData:n,onTreeUpdate:g,onBookmark:M,data:m.data})}),e.jsx(l,{path:"*",element:e.jsx(Y,{searchWord:s.current,data:m.data,onNewMemoBtn:w,title:t==="memo"?"메모장":"홈페이지관리",rootDb:t})})]})}),t==="memo"?e.jsx(_,{onSelected:F}):null,c.current===""?e.jsx(G,{data:m.data}):null,e.jsx(O,{})]})};export{ot as default};
