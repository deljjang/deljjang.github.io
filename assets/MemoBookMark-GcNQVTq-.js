import{r as n,q as k,o as w,i as j,cd as b,j as e,aN as C,a2 as B,y as v,ck as S,bf as D,L as E,bR as T,by as $,h as z,u as R,bm as F,ce as L,bn as M,A as I,D as q,E as P}from"./index-CQnB8GtB.js";import{C as _}from"./ComponentCard-LYxILnlC.js";import{S as A}from"./folder-rXWinBUg.js";const K=t=>n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",width:"1em",height:"1em",...t},n.createElement("path",{d:"M2 6a2 2 0 012-2h5.293a1 1 0 01.707.293l1.414 1.414A1 1 0 0012 6h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})),Y=t=>n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",width:"1em",height:"1em",...t},n.createElement("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})),H=({item:t})=>{const[i,g]=n.useState(!1),{user:p}=k(),x=w(),c=n.useRef(null),[a,u]=n.useState({top:0,left:0}),{data:h,isFetching:r}=j({queryKey:["bookmarkPreview",t.id],queryFn:async()=>{let o=(await b(`memo_txt/${p.uid}/${t.key}`))?.memo||"No content available.";return o=o.replace(/<[^>]*>?/gm," ").replace(/\s+/g," ").trim(),o.substring(0,150)+(o.length>150?"...":"")},enabled:i,staleTime:1e3*60*5,placeholderData:"Loading..."});return n.useEffect(()=>{if(i&&c.current){const l=c.current.getBoundingClientRect();u({top:l.top-10,left:l.left+l.width/2})}},[i]),e.jsxs("div",{ref:c,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:[e.jsx(B,{className:`w-full ${v.buttonIndigo}`,color:"sky",variant:"outlined",size:"sm",onClick:()=>x(`/m/${t.key}`),children:t.title}),i&&C.createPortal(e.jsx(S,{children:i&&e.jsx(D.div,{initial:{opacity:0,y:0},animate:{opacity:1,y:-10},exit:{opacity:0,y:0},transition:{duration:.2},className:"fixed w-64 max-w-xs p-2 bg-gray-800 text-white text-xs rounded-md shadow-lg z-[9999] break-words max-h-48 overflow-y-auto",style:{top:a.top,left:a.left,transform:"translateX(-50%) translateY(-100%)"},children:r?"Loading...":h})}),document.body)]})};function O({initTreeData:t}){const[i,g]=n.useState(),p=a=>g(a),x=w();n.useEffect(()=>{g(t)},[t]);const c=a=>{x(`/m/${a.id}`)};return i===void 0?e.jsx(e.Fragment,{}):i===null||i.length===0?e.jsx(E,{}):e.jsx(T,{tree:i,rootId:"root",onDrop:p,canDrag:()=>!1,render:(a,{depth:u,isOpen:h,onToggle:r})=>{const l=u*20;return e.jsxs("div",{className:`w-62 ${v.between} rounded-sm text-gray-500 dark:text-gray-400 select-none min-h-8 py-1 ml-1 hover:bg-gray-300 dark:hover:bg-gray-700`,style:{paddingLeft:l},children:[e.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>c(a),children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 mr-1",children:a.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:o=>{o.stopPropagation(),r()},children:h?e.jsx($,{className:"size-6"}):e.jsx(Y,{className:"size-6"})})}),a.cnt>0?h?e.jsx(K,{className:"size-5 mr-1 text-yellow-500"}):e.jsx(A,{className:"size-5 mr-1 text-yellow-500"}):null,e.jsx("div",{children:a.text})]}),a.cnt>0&&e.jsxs("div",{className:`text-gray-500 ${v.textSm}`,children:["(",a.cnt,")"]})]})}})}function G(){const{user:t}=k(),{t:i}=z(),[g,p]=n.useState(),{isExpanded:x}=R(),{data:c,isLoading:a}=j({queryKey:["bookmarks",t?.uid],queryFn:async()=>{const r=[],l=F(I(q,`memo_tree/${t.uid}`),M("bm"),L("Y")),o=await P(l);if(!o.exists())return[];const m=o.val();for(let d in m){const s=m[d];s.id=d,s.key=d,s.text=s.title,r.push(s)}return r.sort((d,s)=>d.title>s.title?1:-1),r},enabled:!!t});n.useEffect(()=>{const r=async(l,o)=>{const m=[...o];if(o)for(const d of o){let s=d;for(;s.parent!==void 0&&s.parent!=="root";){const f=s.parent;s=await b(`memo_tree/${l}/${f}`);const y={id:s.key,text:s.title,droppable:!1,parent:s.parent};m.filter(N=>N.id===y.id).length===0&&m.push(y)}}for(const d of m){const s=d.id;d.cnt=m.filter(f=>f.parent===s).length}p(m)};c&&c.length>0&&r(t?.uid,c)},[c,t?.uid]);const u=x?"grid-cols-1 sm:grid-cols-1 md:grid-cols-1 lg:grid-cols-2":"grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",h=()=>e.jsx("div",{className:`grid ${u} gap-3 p-4`,children:[...Array(8)].map((r,l)=>e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"},l))});return t===null?e.jsx(e.Fragment,{}):e.jsx(_,{title:i("main_list"),children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"",children:e.jsx("div",{className:"p-2",children:e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"p-4 h-48 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),children:e.jsx(O,{initTreeData:g,uid:t?.uid})})})}),e.jsx("div",{className:" md:col-span-2",children:e.jsx("div",{className:"p-2",children:a?e.jsx(h,{}):e.jsx("div",{className:`grid ${u} gap-3`,children:c?.map(r=>e.jsx(H,{item:r},r.id))})})})]})})}export{G as MemoBookMark};
