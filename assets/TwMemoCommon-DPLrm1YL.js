const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-aisfwvra.js","assets/index-BIFOmCYg.js","assets/index-BhIoVaY_.css","assets/SinySelect-D7DjfTXR.js","assets/Grid-Bp7sEAih.js","assets/index-32ZhChiV.js","assets/TextField-BeG__8ei.js","assets/InputAdornment-DFkKIYDX.js","assets/Popper-DSHBPAaS.js","assets/Chip-Dr_xp6qR.js","assets/index.esm-BA79Ef45.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-K6ltKFHz.js","assets/TwButton-CLcGyrK3.js"])))=>i.map(i=>d[i]);
import{r as d,j as e,m as se,L as Me,w as U,l as I,D as re,x as ae,S as ne,T as oe,z as A,C as Be,q as ie,n as _e,o as Fe,p as le,t as ce,G as de,y as V,K as me,N as K,i as ue,H as ge,f as Ue,P as Ye,Q as Pe,R as ze,U as Oe,V as W,W as F,X as he,Y as xe,$ as R,I as He,cz as Ae,cB as We,d2 as qe,a0 as O,a1 as Ve,a2 as Ke,a3 as Ge,a4 as Je,a5 as H,a6 as Qe}from"./index-BIFOmCYg.js";import{u as Xe}from"./useSuspenseQuery-BFmMEj_5.js";import{T as Ze,u as fe,a as pe,F as et,b as tt,D as st,l as rt,I as at,s as X,d as Z,e as nt}from"./index-aisfwvra.js";import{E as ot,C as it}from"./ExpandMore-S_KG_Ftq.js";import{F as ve}from"./Favorite-wBGdwYsH.js";import{T as L}from"./TwButton-CLcGyrK3.js";import{D as lt}from"./datetime-BDx6lZXm.js";import{u as ct}from"./index.esm-BA79Ef45.js";import"./index-CLQ_oLGC.js";import{S as dt,a as mt}from"./SinySelect-D7DjfTXR.js";import{T as q,I as ut}from"./TextField-BeG__8ei.js";import{S as gt}from"./check-circle-B-wp77DT.js";import"./useBaseQuery-CpWENLrR.js";import"./Grid-Bp7sEAih.js";import"./index-32ZhChiV.js";import"./InputAdornment-DFkKIYDX.js";import"./Popper-DSHBPAaS.js";import"./Chip-Dr_xp6qR.js";const ht=t=>d.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...t},d.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),xt=t=>d.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),ft=t=>e.jsx(se.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Me,{to:t.to,className:"text-inherit no-underline cursor-pointer",...t,children:e.jsx(Ze,{children:t.children})})});function pt({initTreeData:t}){const[r,o]=d.useState(),s=n=>o(n),c=U();if(d.useEffect(()=>{o(t)},[t]),r==null||r.length===0)return e.jsx(I,{});const g=n=>{console.log("node",n),c(`/m/${n.id}`)};return e.jsx(re,{backend:ne,options:ae(),children:e.jsx(oe,{tree:r,rootId:"root",onDrop:s,render:(n,{depth:p,isOpen:m,onToggle:i})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:p*20+(n.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[n.cnt>0&&e.jsx("div",{onClick:i,children:m?e.jsx(ot,{}):e.jsx(it,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>g(n),children:n.text})]}),n.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",n.cnt,")"]})]})})})}function vt(t){const{user:r}=A(),o=U(),[s,c]=d.useState(),[g,n]=d.useState(),p=async m=>{const i=[],l=ie(le(ce,`memo_tree/${m}`),Fe("bm"),_e("Y")),h=await de(l);if(!h.exists()){console.log("getFireData.null");return}const v=h.val();for(let k in v){const u=v[k];u.id=k,u.key=k,u.text=u.title,i.push(u)}i.sort((k,u)=>k.title>u.title?1:-1),c([...i])};return d.useEffect(()=>{r!==void 0&&r!=null&&p(r?.uid)},[r]),d.useEffect(()=>{const m=async(i,l)=>{const h=[...l];if(l)for(const v of l){let k=v;for(;k.parent!=="root";){k.parent,k=await V(`memo_tree/${i}/${k.parent}`);const u={id:k.key,text:k.title,droppable:!1,parent:k.parent};h.filter(y=>y.id===u.id).length===0&&h.push(u)}}for(const v of h){const k=v.id;v.cnt=h.filter(u=>u.parent===k).length}n(h)};s&&s.length>0&&m(r?.uid,s)},[s]),r===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Be,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((m,i)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{t.onSelected(m.key),o(`/m/${m.key}`)},children:e.jsx("span",{className:"text-base",children:m.title})})},i))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(d.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(pt,{initTreeData:g,uid:r?.uid})})]})}const jt=t=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(L,{size:"sm",variant:"outlined",color:"success",onClick:t.onEdit,children:"수정"}),e.jsx(L,{size:"sm",variant:"outlined",color:"warning",onClick:t.onNewMemo,children:"새글"}),e.jsx(L,{size:"sm",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"})]}),kt=t=>{const{rootDb:r,isLoading:o,memoDetailData:s}=t,{scrollYProgress:c}=fe(),g=pe(c,{stiffness:100,damping:30,restDelta:.001}),[n,p]=d.useState(!1),m=U(),i=d.useRef();i.current=t.searchWord;const{memoId:l}=me(),v=K()?.state?.fullIndex,{user:k}=A(),u=()=>{const x=`/${r==="memo"?"m":r}/edit/${l}`;m(x,{state:{fullIndex:v}})},j=()=>{const x=`/${r==="memo"?"m":r}/insert/${l}`;m(x,{state:{fullIndex:v}})},y=async()=>{const x=r==="memo"?`${r}_txt/${k.uid}/${l}`:`${r}_txt/${l}`,w=r==="memo"?`${r}_tree/${k.uid}`:r;if(await tt(x,w)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}t.onTreeUpdate(),m(`/${r==="memo"?"m":r}`)},b=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&y()},N=()=>{t.onBookmark()};return d.useEffect(()=>{s&&s.title!==void 0&&ue({title:s.title,description:s.title});function x(){window.scrollTo({top:0}),s&&s.html!=="N"&&document.querySelectorAll("pre").forEach(w=>{w.innerHTML=ze(w.innerHTML)})}s&&s.memo!==null&&x()},[s]),o?e.jsx(I,{}):l===""||k===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(se.div,{className:"progress-bar",style:{scaleX:g}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:s&&s.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:N,children:s&&s.bookmark==="Y"?e.jsx(ve,{className:"text-red-500"}):e.jsx(et,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:t.memoDetailData?.path&&t.memoDetailData?.path.map((x,w)=>w===0?x.text:` > ${x.text}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(jt,{rootDb:r,onEdit:u,onNewMemo:j,onDelete:b,bookmark:s&&s.bookmark}),e.jsxs("div",{className:"my-4",children:[s&&s.html==="N"?e.jsx(ge,{postData:s&&s.memo}):s&&s.html!=="N"&&s.memo&&e.jsx(Ue,{text:s.memo}),e.jsx(Ye,{imageList:s&&s.image}),!s&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Pe,{})})})]})]})]})},yt=({onSubmit:t,onCancel:r,isSubmitting:o,newMode:s})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(L,{variant:"outlined",color:"success",disabled:o,onClick:c=>{c.preventDefault(),t(c)},children:[s?"새글":""," 저장"]}),e.jsx(L,{variant:"outlined",color:"error",onClick:r,children:"취소"})]});d.forwardRef((t,r)=>{const{id:o,label:s,defaultValue:c,onChange:g,className:n="",...p}=t,m=i=>{g&&g(i.target.value)};return e.jsxs("div",{className:` ${n}`,children:[s&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:o,children:s}),e.jsx("input",{ref:r,type:"date",id:o,defaultValue:c,onChange:m,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...p})]})});const ee=({label:t,checked:r,id:o,onChange:s,className:c="",disabled:g=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${g?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:o,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${c}`,checked:r,onChange:n=>s(n.target.checked),disabled:g}),r&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),g&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),t&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:t})]}),wt=d.forwardRef((t,r)=>{const{placeholder:o="Enter your message",rows:s=3,value:c="",onChange:g,className:n="",disabled:p=!1,error:m=!1,hint:i=""}=t,l=v=>{g&&g(v.target.value)};let h=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${n} `;return p?h+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":m?h+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":h+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:r,placeholder:o,rows:s,value:c,onChange:l,disabled:p,className:h}),i&&e.jsx("p",{className:`mt-2 text-sm ${m?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:i})]})}),bt=d.lazy(()=>xe(()=>import("./index-aisfwvra.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));rt.Quill.register("modules/imageDrop",at);he.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const Nt={syntax:{highlight:t=>he.highlightAuto(t).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},Ct=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],$t=t=>{const[r,o]=d.useState(t.imageList),[s,c]=d.useState(t.htmlCheck==="Y"),[g,n]=d.useState(t.iconCheck==="Y"),[p,m]=d.useState(t.newMode?"":t.content),[i,l]=d.useState(),h=d.useRef(),v=d.useRef(),k=d.useRef(null);d.useRef(null);const u=d.useRef(null),j=t.newMode,y=d.useRef([]),{height:b}=Oe(),N=lt.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),x={edTitle:j?"":t.title,edGbn:t.gbn?t.gbn:"etc",edDate:j?N:t.date,content:j?"":t.content,memoTxt:j?"":t.content,htmlCheck:t.htmlCheck,iconCheck:t.iconCheck},{register:w,handleSubmit:S,trigger:M,control:B,setValue:T,getValues:D,watch:je,formState:{errors:G,isSubmitting:ke}}=ct({mode:"onChange",defaultValues:x});d.useEffect(()=>{w("edDate"),w("edGbn",{required:!0}),w("htmlCheck"),w("iconCheck"),w("memoTxt")},[]),d.useEffect(()=>{y.current=[],h.current=t.content,v.current=!1},[t.content]);const J=async a=>{j?await t.onNewSubmit(a,y.current):await t.onPostSubmit(a,r,y.current)},ye=()=>{S(J)()},we=a=>{console.log("onDelete.imageList=",a),o(a)},be=a=>{console.log("onInsert.file",a);let f=h.current;a.ext==="jpg"?(f+=`<img src='${a.url}'/>`,Y(`<img src='${a.url}'/>`)):a.ext==="mp4"&&(f+=`<video preload="auto" controls="" src='${a.url}'></video>`,Y(`<video preload="auto" controls="" src='${a.url}'></video>`)),h.current=f},Ne=a=>{h.current=a},Ce=a=>{console.log("handleFileUpload",a),y.current=a};function $e(a){Y(`<img src='${a}'/>`)}function Se(a){h.current=a,T("content",a),M("content")}function Te(a,f){console.log("handleChangeDate=",a),console.log("handleChangeDate.currentDateString=",f);let C=W(a);console.log("handleChangeDate.dayjs=",C.format("YYYY-MM-DD HH:mm:ss")),T("edDate",C.format("YYYY-MM-DD")),M("edDate")}const Q=(a,f)=>{console.log(`onChecked.${a}=`,f),T(a,f?"Y":"N"),a==="htmlCheck"?c(f):n(f)},De=je("content"),Le=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Ie=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],Y=a=>{const f=k.current;if(f){const C=f.selectionStart,$=f.selectionEnd,E=p.slice(0,C),P=p.slice($);m(E+a+P),T("memoTxt",E+a+P),setTimeout(()=>{f.selectionStart=f.selectionEnd=C+a.length,f.focus()},0)}},_=a=>{Y(a)},Re=a=>a?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(a)||a.includes("image")||a.includes("img"):!1,Ee=a=>new Promise((f,C)=>{const $=new Image;$.crossOrigin="anonymous",$.onload=()=>{const E=document.createElement("canvas"),P=E.getContext("2d");E.width=$.width,E.height=$.height,P.drawImage($,0,0);try{const z=E.toDataURL("image/png");console.log("convertImageToBase64.base64=",z.substring(0,30)+"..."),f(z)}catch(z){C(z)}},$.onerror=()=>{C(new Error("Failed to load image"))},$.src=a});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:S(J),style:{width:"100%",minHeight:"300px",maxHeight:{height:b},display:"flex",flexDirection:"column"},children:[e.jsx(yt,{onSubmit:a=>ye(),onCancel:t.onCancel,isSubmitting:ke,newMode:j}),e.jsx(st,{control:B,onDelete:we,onInsert:be,setContent:Ne,onFileUpload:Ce,imageList:t.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(q,{...w("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!G.edTitle})}),e.jsx(dt,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:B,defaultValue:D("edGbn"),selectList:Le,error:!!G.edGbn,onChange:a=>{a.preventDefault();const f=a.target.value;console.log("edGbn=",D("edGbn")),T("edGbn",f)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(mt,{id:"edDate",label:"일자",value:W(D("edDate")),...w("edDate"),defaultValue:W(D("edDate")),onChange:(a,f)=>{Te(a,f)}}),e.jsx(ee,{id:"html",checked:s,onChange:a=>Q("htmlCheck",a),label:"HTML사용"}),e.jsx(ee,{id:"icon",checked:g,onChange:a=>Q("iconCheck",a),label:"Icon"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"max-h-130 overflow-y-scroll",children:[e.jsx(ge,{postData:p}),e.jsxs("div",{className:"flex gap-2 my-2",children:[e.jsx(q,{...w("edUrl",{}),label:"URL",placeholder:"URL",variant:"filled",size:"small",onChange:a=>{a.preventDefault();const f=a.target.value;console.log("edUrl=",f),T("edUrl",f),l(f)}}),e.jsx(q,{...w("edUrl2",{}),label:"Base64",placeholder:"Base64 이미지 데이터",variant:"filled",size:"small",multiline:!0,rows:2,value:D("edUrl2")||""}),e.jsx(L,{variant:"outlined",color:"success",onClick:a=>{a.preventDefault(),$e(D("edUrl2"))},children:"적용"})]}),D("edUrl")&&Re(D("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:i,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async a=>{try{const f=await Ee(i);T("edUrl2",f)}catch(f){console.error("Base64 conversion failed:",f)}},onError:a=>{a.target.style.display="none"}})})]}),e.jsxs("div",{children:[e.jsx(wt,{ref:k,className:"",value:p,onChange:a=>{T("memoTxt",a),m(a)},rows:22}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(F,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_(`<box>
</box>`),children:"<Box>"}),Ie.map((a,f)=>e.jsx(F,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_("<code>"+a+`
</code>`),children:a},f)),e.jsx(F,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<a href="/data/" target="_blank"></a>'),children:"Link"}),e.jsx(F,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<img src="/data/"></img>'),children:"img"}),e.jsx(F,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<video preload="auto" controls="" src="/data/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(F,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<hr style="width=100%"/>'),children:"line"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"})]})]}),s&&e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(bt,{ref:u,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:De,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:Nt,formats:Ct,onChange:Se})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},te=t=>{const{rootDb:r,isLoading:o,memoDetailData:s}=t,{scrollYProgress:c}=fe();pe(c,{stiffness:100,damping:30,restDelta:.001});const g=U(),n=d.useRef(),p=d.useRef();p.current=t.searchWord;const{memoId:m}=me(),i=K(),{user:l}=A();n.current=i.pathname.split("/")[2]==="insert",console.log("memoDetailData=",s?.title),console.log("newMode=",n.current,", memoId=",m);const h=()=>{const u=`/${r==="memo"?"m":r}/${m==="insert"?"":m}`;g(u)},v=async(u,j)=>{console.log("onNewSubmit.values",u);const y=await X({rootDb:r,uid:l.uid,newData:n.current,key:m==="insert"?"root":m,values:u});if(await Z(`${r}_txt`,r,y,j),y!==void 0){const b=`/${r==="memo"?"m":r}/${y}`;g(b,{state:{reflash:!0}})}},k=async(u,j,y)=>{const b=r==="memo"?`${r}_txt/${l.uid}/`:`${r}_txt/`,N=r==="memo"?`${r}_tree/${l.uid}/`:`${r}/`;await nt(b,N,m,j),console.log("onPostSubmit.values",u);const x=await X({rootDb:r,uid:l.uid,newData:n.current,key:m==="insert"?"root":m,values:u});console.log("onPostSubmit.newKey=",x),console.log("onPostSubmit.files=",y);const w=await Z(`${b}/`,r==="memo"?`${r}/${l.uid}/`:`${r}/`,m,y);console.log("onNewSubmit.imageResult",w),r==="memo"&&R(`memo_tree/${l.uid}/${m}/title`,u.edTitle),n.current=!1;const S=`/${r==="memo"?"m":r}/${m}`;r==="home"&&R("home/tree",null),g(S,{state:{reflash:!0}})};return d.useEffect(()=>{s&&s.title!==void 0&&ue({title:s.title,description:s.title});function u(){document.querySelectorAll("pre").forEach((j,y)=>{})}s&&s.memo!==null&&u()},[s]),m===""||l===void 0?e.jsx(e.Fragment,{}):s===void 0||o?e.jsx(I,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:n.current===!1&&s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(I,{}):e.jsx($t,{newMode:n.current,onPostSubmit:k,onNewSubmit:v,onCancel:h,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html:"Y",iconCheck:s?.icon?s?.icon:"Y",content:s?.memo,imageList:s?.image})})})};function St({initTreeData:t,userId:r,memoId:o,onClick:s}){const[c,g]=d.useState(t),{isMoble:n,height:p,width:m}=He(),i=d.useRef(),l=d.useRef(),h=(u,j)=>{if(j.dragSource.id!==void 0&&j.dropTargetId!==void 0){const y=`memo_tree/${r}/${j.dragSource.id}/parent`;R(y,j.dropTargetId)}g(u)};d.useEffect(()=>{(()=>{for(const j of t){const y=j.id;j.cnt=t.filter(b=>b.parent===y).length}g(t)})()},[t]);const v=(u,j)=>{const y=[],b=N=>{const x=j.find(w=>w.id===N);if(!x)return!1;if(x.parent&&x.parent!=="root"){if(b(x.parent))return y.push(x.parent),!0}else return!0;return!1};return b(u)?y.reverse():[]},k=u=>{if(!c||!u||!l.current)return;const j=v(u,c);j.length>0&&setTimeout(()=>{l.current.open(j)},500)};return d.useEffect(()=>{i.current===void 0&&o!==void 0&&(i.current=o,k(o))},[c]),c==null||c.length===0?e.jsx(I,{}):e.jsx(re,{backend:ne,options:ae(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:p-220-(n?56:0)+(m>1024?60:0),width:"100%"},children:e.jsx(oe,{ref:l,tree:c,rootId:"root",onDrop:h,render:(u,{depth:j,isOpen:y,onToggle:b,isDragging:N,isDropTarget:x})=>e.jsxs("div",{className:`w-63 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ${N?"opacity-50":""} ${x?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
              ${i.current===u.id?"menu-item-active":""}
              `,style:{paddingLeft:j*20+(u.cnt===0?5:0)},children:[e.jsx("div",{className:"min-w-0",children:u.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:b,children:y?e.jsx(ht,{className:"size-6"}):e.jsx(xt,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{i.current=u.id,console.log("nodeId.current",i.current),s(u)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[u.icon,u.text]}),u.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",u.cnt,")"]})]})]})})})})}const Tt=t=>{const r=d.useRef(null);function o(){t.onSearchDataBtn(r.current.value)}function s(){return t.onNewMemoBtn(),!1}function c(g){g.which===13&&o()}return e.jsxs(e.Fragment,{children:[e.jsx(ut,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:r,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:c}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(L,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:s,children:"새글"}),e.jsx(L,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:o,children:"조회"})]})]})},Dt=async(t,r,o)=>{let s=new Array;for(let c in o){const g=o[c];try{if(g.key=c,g.url===void 0){const n=await Ae(We,`${r}/${c}.${g.ext}`),p=await qe(n);g.url=p,R(`${t}/image/${c}/url`,p)}s.push(g)}catch(n){console.log("getImageList.catch",n)}}return s},Lt=async(t,r,o,s)=>{let c="",g="",n={};((i,l,h)=>{g=i==="memo"?`${i}/${l}/${h}`:`${i}/${h}`,c=i==="memo"?`${i}_txt/${l}/${h}`:`${i}_txt/${h}`})(t,r,o);async function m(){if(c===void 0)return"";if(n=await V(c),n===void 0)return console.log("No data available"),"";if(n?.fullIndex,n.image!==void 0&&n.image!==null){const i=await Dt(c,g,n.image);n.image=i,(n.imageOK===void 0||n.imageOK==="N")&&(i&&i.map(l=>{l.ext==="jpg"&&(n.memo=n.memo+`<img src='${l.url}'>`)}),R(`${c}/imageOK`,"Y"),R(`${c}/memo`,n.memo))}if(s!==void 0&&s!==""){const i=s,l=new RegExp(i,"gi"),h=n.memo.replace(l,`<span class='lightext'>${i}</span>`);n.memo=h}}return await m(),n};async function It(t,r,o=""){if(r==null||r==="")return"";if(t==="home"){const i=await V("home/tree");if(i!=null)try{return JSON.parse(i)}catch(l){console.error("Error parsing JSON data:",l)}}const s=t==="home"?"home_txt":o===""?`${t}_tree/${r}`:`${t}_txt/${r}`,c=ie(le(ce,s)),g=await de(c);if(!g.exists())return console.log("getTreeData.null"),null;if(!g.exists())return console.log("getTreeData.exists"),null;const n=g.val(),p=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],m=[];t==="home"&&m.push(...p);for(const i in n){const l=n[i];l.id=i;const h={id:i,key:i,text:l.title,parent:t==="home"?l.gbn:l.parent};t==="memo"?(h.icon=l.bm==="Y"?e.jsx(ve,{className:"text-red-500"}):l.icon==="Y"?e.jsx(gt,{}):null,h.droppable=!0):h.droppable=!1,!(h.parent===void 0||h.parent===null||h.parent==="")&&(t==="home"||o===""||o===void 0||o===null?m.push(h):(l.id=i,(l.memo+"").toLowerCase().indexOf(o.toLowerCase())>-1&&m.push(h)))}return m.sort((i,l)=>i.title>l.title?1:-1),t==="home"&&R("home/tree",JSON.stringify(m)),m}const Rt=d.lazy(async()=>await xe(()=>import("./TwMemoMain-K6ltKFHz.js"),__vite__mapDeps([12,1,2,13]))),Xt=({rootDb:t})=>{const r=U(),{user:o}=A(),s=d.useRef(),c=d.useRef(!0),g=d.useRef(),n=d.useRef(),[p,m]=d.useState(),i=d.useRef(!1),l=K(),h=d.useRef(!1);h.current=l?.state?.reflash===!0;const v=Xe({queryKey:["twTreeData",o?.uid,s.current],queryFn:()=>It(t,o?.uid,s.current)});v.data!==void 0&&v.data!==""&&!i.current&&(i.current=!0);const k=()=>{const x=p;x&&(x.bookmark=x.bookmark==="Y"?"N":"Y");const w=`memo_tree/${o.uid}/${n.current}/bm`;R(w,p.bookmark),m({...p,bookmark:x.bookmark})};d.useEffect(()=>{o!==void 0&&o!=null&&v.refetch()},[o]),d.useEffect(()=>{const x=async M=>{if(M!==""&&o){const B=await Lt(t,o?.uid,M,s.current);t==="memo"&&(B.path=Et(v.data,M)),c.current=!1,m(B===void 0?{}:B)}},w=l.pathname.split("/"),S=w.length>2?w[w.length-1]:"";c.current=!0,x(S),n.current=S},[l.pathname,o]),d.useEffect(()=>{o!==void 0&&o!=null&&v.refetch()},[h.current]);const u=x=>{i.current=!1,x!==void 0&&(s.current=x),v.refetch()},j=x=>{x.id!==n.current&&(c.current=!0,r(`/${t==="memo"?"m":t}/${x.id}`))},y=()=>{if(o==null){alert("로그인 후 이용 가능합니다.");return}const x=`/${t==="memo"?"m":t}/insert/insert`;r(x)},b=x=>{},N=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3",children:e.jsx(ft,{to:"/m",children:t==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[t==="memo"?"":e.jsx(O,{to:"/m",children:"메모"}),t==="memo"&&o?.uid==="I3cTgdCxwjhBBno4mtZYvnODPJu1"?e.jsx(O,{to:"/home",children:"홈관리"}):null,e.jsx(O,{to:"/todo",children:"TODO"}),e.jsx(O,{to:"/tw",children:"Sheet"})]}),e.jsx(Tt,{onNewMemoBtn:y,onSearchDataBtn:u}),i.current&&v.isFetched?e.jsx(St,{expandIndex:g.current,initTreeData:v.data,userId:o?.uid,memoId:n.current,onClick:j}):o===void 0?e.jsx(e.Fragment,{}):e.jsx(I,{})]});return o&&o.uid===Ve&&Ke,e.jsxs(Ge,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:N,children:[e.jsx(d.Suspense,{fallback:e.jsx(I,{}),children:e.jsxs(Je,{children:[e.jsx(H,{path:"/edit/:memoId",element:e.jsx(te,{rootDb:t,isLoading:c.current,searchWord:s.current,memoDetailData:p})}),e.jsx(H,{path:"/insert/:memoId",element:e.jsx(te,{rootDb:t,isLoading:c.current,searchWord:s.current,memoDetailData:p})}),e.jsx(H,{path:"/:memoId",element:e.jsx(kt,{rootDb:t,isLoading:c.current,searchWord:s.current,memoDetailData:p,onTreeUpdate:u,onBookmark:k,data:v.data})}),e.jsx(H,{path:"*",element:e.jsx(Rt,{searchWord:s.current,data:v.data,onNewMemoBtn:y,title:t==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),t==="memo"?e.jsx(vt,{onSelected:b}):"",e.jsx(Qe,{})]})},Et=(t,r)=>{let o=[],s=r;if(!t)return o;const c=t.find(g=>g.id===s);for(o.unshift(c),s=c?.parent;s!=null&&s!==""&&s!=="root";){const g=t.find(n=>n.id===s);s=g?.parent,o.unshift(g)}return o};export{Xt as default};
