import{j as E}from"./index-bDGh9GBK.js";import{j as T,t as Y,k as j,bu as x,bv as A,R as L,bw as z,bx as K,by as W,U as J}from"./App-CqT6n7eP.js";import{r as y}from"./router-BlMcuVHC.js";import"./vendor-CCYiWZgt.js";K(W);J();const Z=({id:r,rootDb:t,memoId:o,index:c,block:n,onUpdate:m,onUpdateBlock:a,onUpdateCellBlock:S,afterSelection:R,readOnly:h,showSearch:M=!0})=>{const C=y.useRef(null);y.useRef(null);const p=y.useMemo(()=>n.content.data?JSON.parse(JSON.stringify(n.content.data)):[],[n.content.data]);T();const{user:D}=Y(),N=async(l,d,g)=>{if(h)return;const u=C.current?.hotInstance;if(!u)return;const e=n.content.columns.map((s,i)=>({...s,width:u.getColWidth(i)}));a(r,{content:{...n.content,columns:e}})},H=(l,d,g)=>{if(h||g==="loadData")return;const u=C.current?.hotInstance;if(!u)return;console.log(`행 추가: ${d}개, 인덱스: ${l}, 소스: ${g}`);const e=u.getSourceData();a(r,{content:{...n.content,data:e}})},I=(l,d)=>{if(h)return;const g=C.current?.hotInstance;if(!g)return;console.log(`행 삭제: ${d}개, 인덱스: ${l}`);const u=g.getSourceData();a(r,{content:{...n.content,data:u}})},$=(l,d)=>{if(h)return;const g=C.current?.hotInstance;if(!g)return;console.log(`열 삭제: ${d}개, 인덱스: ${l}`);const u=g.getSourceData(),e=n.content.columns.slice(0,l).concat(n.content.columns.slice(l+d)),s=e.map(i=>i.title);a(r,{content:{...n.content,data:u,columns:e,colHeaders:s}})},w=(l,d)=>{h||d==="loadData"||!l||typeof l!="object"||!Array.isArray(l)||S(r,l)};return E.jsx(V,{hotRef:C,columns:n.content.columns,rowData:p,colorData:n.content.colorData,colorTextData:n.content.colorTextData,afterChange:w,afterSelection:R,afterCreateRow:H,afterRemoveRow:I,afterRemoveCol:$,handleAfterColumnResize:N,showSearch:M,readOnly:h,isDraggable:!1})},V=({hotRef:r,columns:t,rowData:o,colorData:c,colorTextData:n,afterChange:m,afterSelection:a,afterCreateRow:S,afterRemoveRow:R,afterRemoveCol:h,handleAfterColumnResize:M,showSearch:C,readOnly:p=!0})=>{const{theme:D}=j(e=>({theme:e.theme.mode})),N=y.useRef(null),[H,I]=y.useState("");y.useEffect(()=>{const e=r.current?.hotInstance;if(!e||!o)return;let s=!1;try{c&&c.forEach((i,b)=>{i&&i.forEach((f,k)=>{const F=e.getCellMeta(b,k).backgroundColor,v=f||void 0;F!==v&&(e.setCellMeta(b,k,"backgroundColor",v),s=!0)})})}catch{}try{n&&n.forEach((i,b)=>{i&&i.forEach((f,k)=>{const F=e.getCellMeta(b,k).color,v=f||void 0;F!==v&&(e.setCellMeta(b,k,"color",v),s=!0)})})}catch{}s&&e.render()},[o,c,n,r]);const $=[],w=y.useMemo(()=>{if(!t)return;const e=[];return t.forEach((s,i)=>{s.select&&$.push({value:i,text:s.title,label:s.title}),e.push({...s,title:s.title})}),e},[t]),l=y.useMemo(()=>w&&w.map((e,s)=>{const{readOnly:i,...b}=e;let f={...b,theme:D,isFirstColumn:w.indexOf(e)===0,data:s,colorData:c,colorTextData:n};return e.type==="numeric"?f={...f,type:"numeric",numericFormat:{pattern:"0,0.00"},originalRenderer:x.renderers.NumericRenderer}:e.type==="date"?f={...f,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:G},originalRenderer:x.renderers.DateRenderer}:e.type==="checkbox"?f={...f,type:"checkbox",className:"htCenter",originalRenderer:x.renderers.CheckboxRenderer}:f.originalRenderer=x.renderers.TextRenderer,{...f,renderer:q}}),[w,D,c,n]),d=D==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",g=e=>{e.key==="Enter"&&(e.preventDefault(),u())},u=()=>{const e=N.current.value;I(e);const s=r.current?.hotInstance;s&&s.render()};return E.jsxs("div",{className:"TwHotTable w-full",children:[C&&E.jsx(A,{inputRef:N,onKeyDown:g,onSearch:u,className:"max-w-60"}),E.jsx(L,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:r,data:o,themeName:d,rowHeaders:!0,language:"ko-KR",colHeaders:t&&t.map(e=>e.title),autoWrapRow:!0,height:"auto",contextMenu:!p,search:H,observeChanges:!0,columnSorting:!0,afterChange:m,afterSelection:a,afterCreateRow:S,afterRemoveRow:R,afterRemoveCol:h,formulas:{engine:z.buildEmpty({licenseKey:"gpl-v3"})},columns:l,readOnly:p,manualColumnResize:!0,afterColumnResize:M,colWidths:t.map(e=>e.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})]})},q=(r,t,o,c,n,m,a)=>{typeof m=="number"&&!isNaN(m)?(m%1!==0?a.numericFormat={pattern:"0,0.00"}:a.numericFormat={pattern:"0,0"},x.renderers.NumericRenderer.apply(void 0,[r,t,o,c,n,m,a])):a.originalRenderer?a.originalRenderer.apply(void 0,[r,t,o,c,n,m,a]):x.renderers.TextRenderer.apply(void 0,[r,t,o,c,n,m,a]);const S=r.getSettings().search,R=a.theme,h=r.getCellMeta(o,c),M=a.backgroundColor||h.backgroundColor,C=a.color||h.color,p=a.colorData,D=a.colorTextData;t.style.backgroundColor="",t.style.color="",S&&m&&String(m).toLowerCase().includes(S.toLowerCase())?(t.style.backgroundColor=R==="dark"?"#facc15":"yellow",t.style.color="black"):(t.style.backgroundColor=M,M||(o%2===0?t.style.backgroundColor=R==="dark"?"#101010":"#ffffff":t.style.backgroundColor=R==="dark"?"#000000":"#f8f8f8")),C&&(t.style.color=C),p?.[o]?.[c]&&(t.style.backgroundColor=p[o]?.[c],t.classList.remove("htDimmed")),D?.[o]?.[c]&&(t.style.color=D[o]?.[c],t.classList.remove("htDimmed")),t.classList.remove("htDimmed")},G={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(r,t){const o=r.getDate(),c=r.getMonth()+1;return`${r.getFullYear()}-${c.toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}`},parse(r,t){const o=r.split("-");return new Date(o[0],o[1]-1,o[2])}};export{Z as HandsontableBlock};
