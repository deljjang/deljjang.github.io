const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BKNo1wj0.js","assets/index-CszwbD_H.js","assets/index-BwOtu1b3.css","assets/SinySelect-BuBxySi_.js","assets/Grid-CGr0kvai.js","assets/index-B2H9cPrn.js","assets/TextField-DSQKkKZz.js","assets/InputAdornment-CwRwc7YP.js","assets/Popper-CB5Cz4_m.js","assets/Chip-CWvvx7LR.js","assets/index.esm-B8P4STDE.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-Bk1kWm7x.js","assets/TwButton-h_O67RZS.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,m as U,h as Te,z as M,p as T,D as Q,A as J,S as X,T as Z,E as _,G as De,q as ee,t as Le,v as Ie,w as te,x as se,M as ae,C as re,Q as ne,R as A,n as oe,H as ie,k as Me,V as Ee,W as Re,X as le,Y as Be,Z as _e,$ as F,a0 as R,a1 as ce,a2 as de,a4 as L,N as Fe,cC as Ye,cE as Ae,d5 as He,a5 as Y,a6 as ze,a7 as Pe,a8 as We,a9 as qe,aa as B,ab as Oe}from"./index-CszwbD_H.js";import{u as Ve}from"./useSuspenseQuery-BVY3Tg9W.js";import{T as Ge,u as me,a as ue,F as Ke,b as Ue,D as Qe,l as Je,I as Xe,s as O,d as V,e as Ze}from"./index-BKNo1wj0.js";import{E as et,C as tt}from"./ExpandMore-tk6xnC8H.js";import{F as ge}from"./Favorite-BvWOpbb9.js";import{T as D}from"./TwButton-h_O67RZS.js";import{D as st}from"./datetime-BDx6lZXm.js";import{u as at}from"./index.esm-B8P4STDE.js";import"./index-CLQ_oLGC.js";import{S as rt,a as nt}from"./SinySelect-BuBxySi_.js";import{T as ot,I as it}from"./TextField-DSQKkKZz.js";import{S as lt}from"./check-circle-CzGqxLUj.js";import"./useBaseQuery-BI-QPz3s.js";import"./Grid-CGr0kvai.js";import"./index-B2H9cPrn.js";import"./InputAdornment-CwRwc7YP.js";import"./Popper-CB5Cz4_m.js";import"./Chip-CWvvx7LR.js";const ct=s=>c.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...s},c.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),dt=s=>c.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),mt=s=>e.jsx(U.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Te,{to:s.to,className:"text-inherit no-underline cursor-pointer",...s,children:e.jsx(Ge,{children:s.children})})});function ut({initTreeData:s}){const[a,o]=c.useState(),t=n=>o(n),d=M();if(c.useEffect(()=>{o(s)},[s]),a==null||a.length===0)return e.jsx(T,{});const u=n=>{console.log("node",n),d(`/m/${n.id}`)};return e.jsx(Q,{backend:X,options:J(),children:e.jsx(Z,{tree:a,rootId:"root",onDrop:t,render:(n,{depth:k,isOpen:l,onToggle:i})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:k*20+(n.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[n.cnt>0&&e.jsx("div",{onClick:i,children:l?e.jsx(et,{}):e.jsx(tt,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>u(n),children:n.text})]}),n.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",n.cnt,")"]})]})})})}function gt(s){const{user:a}=_(),o=M(),[t,d]=c.useState(),[u,n]=c.useState(),k=async l=>{const i=[],r=ee(te(se,`memo_tree/${l}`),Ie("bm"),Le("Y")),g=await ae(r);if(!g.exists()){console.log("getFireText.null");return}const h=g.val();for(let f in h){const x=h[f];x.id=f,x.key=f,x.text=x.title,i.push(x)}i.sort((f,x)=>f.title>x.title?1:-1),d([...i])};return c.useEffect(()=>{a!==void 0&&a!=null&&k(a?.uid)},[a]),c.useEffect(()=>{const l=async(i,r)=>{const g=[...r];if(r)for(const h of r){let f=h;for(;f.parent!=="root";){f.parent,f=await re(`memo_tree/${i}/${f.parent}`);const x={id:f.key,text:f.title,droppable:!1,parent:f.parent};g.filter(y=>y.id===x.id).length===0&&g.push(x)}}for(const h of g){const f=h.id;h.cnt=g.filter(x=>x.parent===f).length}n(g)};t&&t.length>0&&l(a?.uid,t)},[t]),a===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(De,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:t&&t.map((l,i)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{s.onSelected(l.key),o(`/m/${l.key}`)},children:e.jsx("span",{className:"text-base",children:l.title})})},i))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(c.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(ut,{initTreeData:u,uid:a?.uid})})]})}const ht=s=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(D,{size:"sm",variant:"outlined",color:"success",onClick:s.onEdit,children:"수정"}),e.jsx(D,{size:"sm",variant:"outlined",color:"warning",onClick:s.onNewMemo,children:"새글"}),e.jsx(D,{size:"sm",variant:"outlined",color:"error",onClick:s.onDelete,children:"삭제"})]}),xt=s=>{const{rootDb:a,isLoading:o,memoDetailData:t}=s,{scrollYProgress:d}=me(),u=ue(d,{stiffness:100,damping:30,restDelta:.001}),[n,k]=c.useState(!1),l=M(),i=c.useRef();i.current=s.searchWord;const{memoId:r}=ne(),h=A()?.state?.fullIndex,{user:f}=_(),x=()=>{const v=`/${a==="memo"?"m":a}/edit/${r}`;l(v,{state:{fullIndex:h}})},b=()=>{const v=`/${a==="memo"?"m":a}/insert/${r}`;l(v,{state:{fullIndex:h}})},y=async()=>{const v=a==="memo"?`${a}_txt/${f.uid}/${r}`:`${a}_txt/${r}`,j=a==="memo"?`${a}_tree/${f.uid}`:a;if(await Ue(v,j)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}s.onTreeUpdate(),l(`/${a==="memo"?"m":a}`)},N=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&y()},w=()=>{s.onBookmark()};return c.useEffect(()=>{t&&t.title!==void 0&&oe({title:t.title,description:t.title});function v(){window.scrollTo({top:0}),t&&t.html!=="N"&&document.querySelectorAll("pre").forEach(j=>{j.innerHTML=Be(j.innerHTML)})}t&&t.memo!==null&&v()},[t]),o?e.jsx(T,{}):r===""||f===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(U.div,{className:"progress-bar",style:{scaleX:u}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:t&&t.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:w,children:t&&t.bookmark==="Y"?e.jsx(ge,{className:"text-red-500"}):e.jsx(Ke,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s.memoDetailData?.path&&s.memoDetailData?.path.map((v,j)=>j===0?v.title:` > ${v.title}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(ht,{rootDb:a,onEdit:x,onNewMemo:b,onDelete:N,bookmark:t&&t.bookmark}),e.jsxs("div",{className:"my-4",children:[t&&t.html==="N"?e.jsx(ie,{postData:t&&t.memo}):t&&t.html!=="N"&&t.memo&&e.jsx(Me,{text:t.memo}),e.jsx(Ee,{imageList:t&&t.image}),!t&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Re,{})})})]})]}),e.jsx(le,{})]})},ft=({onSubmit:s,onCancel:a,isSubmitting:o,newMode:t})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(D,{variant:"outlined",color:"success",disabled:o,onClick:d=>{d.preventDefault(),s(d)},children:[t?"새글":""," 저장"]}),e.jsx(D,{variant:"outlined",color:"error",onClick:a,children:"취소"})]});c.forwardRef((s,a)=>{const{id:o,label:t,defaultValue:d,onChange:u,className:n="",...k}=s,l=i=>{u&&u(i.target.value)};return e.jsxs("div",{className:` ${n}`,children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:o,children:t}),e.jsx("input",{ref:a,type:"date",id:o,defaultValue:d,onChange:l,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...k})]})});const G=({label:s,checked:a,id:o,onChange:t,className:d="",disabled:u=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${u?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:o,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${d}`,checked:a,onChange:n=>t(n.target.checked),disabled:u}),a&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),u&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:s})]}),vt=c.forwardRef((s,a)=>{const{placeholder:o="Enter your message",rows:t=3,value:d="",onChange:u,className:n="",disabled:k=!1,error:l=!1,hint:i=""}=s,r=h=>{u&&u(h.target.value)};let g=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${n} `;return k?g+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":l?g+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":g+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:a,placeholder:o,rows:t,value:d,onChange:r,disabled:k,className:g}),i&&e.jsx("p",{className:`mt-2 text-sm ${l?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:i})]})}),kt=c.lazy(()=>de(()=>import("./index-BKNo1wj0.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));Je.Quill.register("modules/imageDrop",Xe);ce.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const pt={syntax:{highlight:s=>ce.highlightAuto(s).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},jt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],yt=s=>{const[a,o]=c.useState(s.imageList),[t,d]=c.useState(s.htmlCheck==="Y"),[u,n]=c.useState(s.iconCheck==="Y"),[k,l]=c.useState(s.newMode?"":s.content),i=c.useRef(),r=c.useRef(),g=c.useRef(null);c.useRef(null);const h=c.useRef(null),f=s.newMode,x=c.useRef([]),{height:b}=_e(),y=st.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),N={edTitle:f?"":s.title,edGbn:s.gbn?s.gbn:"etc",edDate:f?y:s.date,content:f?"":s.content,memoTxt:f?"":s.content,htmlCheck:s.htmlCheck,iconCheck:s.iconCheck},{register:w,handleSubmit:v,trigger:j,control:$,setValue:C,getValues:S,watch:he,formState:{errors:H,isSubmitting:xe}}=at({mode:"onChange",defaultValues:N});c.useEffect(()=>{w("edDate"),w("edGbn",{required:!0}),w("htmlCheck"),w("iconCheck"),w("memoTxt")},[]),c.useEffect(()=>{x.current=[],i.current=s.content,r.current=!1},[s.content]);const z=async m=>{f?await s.onNewSubmit(m,x.current):await s.onPostSubmit(m,a,x.current)},fe=()=>{v(z)()},ve=m=>{console.log("onDelete.imageList=",m),o(m)},ke=m=>{let p=i.current;m.ext==="jpg"?p+=`<img src='${m.url}'/>`:m.ext==="mp4"&&(p+=`<video preload="auto" controls="" src='${m.url}'></video>`),i.current=p},pe=m=>{i.current=m},je=m=>{console.log("handleFileUpload",m),x.current=m};function ye(m){i.current=m,C("content",m),j("content")}function be(m,p){console.log("handleChangeDate=",m),console.log("handleChangeDate.currentDateString=",p);let I=F(m);console.log("handleChangeDate.dayjs=",I.format("YYYY-MM-DD HH:mm:ss")),C("edDate",I.format("YYYY-MM-DD")),j("edDate")}const P=(m,p)=>{console.log(`onChecked.${m}=`,p),C(m,p?"Y":"N"),m==="htmlCheck"?d(p):n(p)},we=he("content"),Ne=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Ce=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],$e=m=>{const p=g.current;if(p){const I=p.selectionStart,Se=p.selectionEnd,W=k.slice(0,I),q=k.slice(Se);l(W+m+q),C("memoTxt",W+m+q),setTimeout(()=>{p.selectionStart=p.selectionEnd=I+m.length,p.focus()},0)}},E=m=>{$e(m)};return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:v(z),style:{width:"100%",minHeight:"300px",maxHeight:{height:b},display:"flex",flexDirection:"column"},children:[e.jsx(ft,{onSubmit:m=>fe(),onCancel:s.onCancel,isSubmitting:xe,newMode:f}),e.jsx(Qe,{control:$,onDelete:ve,onInsert:ke,setContent:pe,onFileUpload:je,imageList:s.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(ot,{...w("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!H.edTitle})}),e.jsx(rt,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:$,defaultValue:S("edGbn"),selectList:Ne,error:!!H.edGbn,onChange:m=>{m.preventDefault();const p=m.target.value;console.log("edGbn=",S("edGbn")),C("edGbn",p)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(nt,{id:"edDate",label:"일자",value:F(S("edDate")),...w("edDate"),defaultValue:F(S("edDate")),onChange:(m,p)=>{be(m,p)}}),e.jsx(G,{id:"html",checked:t,onChange:m=>P("htmlCheck",m),label:"HTML사용"}),e.jsx(G,{id:"icon",checked:u,onChange:m=>P("iconCheck",m),label:"Icon"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-130 overflow-y-scroll",children:e.jsx(ie,{postData:k})}),e.jsxs("div",{children:[e.jsx(vt,{ref:g,className:"",value:k,onChange:m=>{C("memoTxt",m),l(m)},rows:22}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>E("<box></box>"),children:"<Box>"}),Ce.map((m,p)=>e.jsx(R,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>E("<code>"+m+"</code>"),children:m},p)),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>E('<a href="" target="_blank"></a>'),children:"Link"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>E('<img src=""></img>'),children:"img"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"})]})]}),e.jsx(c.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(kt,{ref:h,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:we,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:pt,formats:jt,onChange:ye})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},K=s=>{const{rootDb:a,isLoading:o,memoDetailData:t}=s,{scrollYProgress:d}=me();ue(d,{stiffness:100,damping:30,restDelta:.001});const u=M(),n=c.useRef(),k=c.useRef();k.current=s.searchWord;const{memoId:l}=ne(),i=A(),{user:r}=_();n.current=i.pathname.split("/")[2]==="insert",console.log("memoDetailData=",t?.title),console.log("newMode=",n.current,", memoId=",l);const g=()=>{const x=`/${a==="memo"?"m":a}/${l==="insert"?"":l}`;u(x)},h=async(x,b)=>{console.log("onNewSubmit.values",x);const y=await O({rootDb:a,uid:r.uid,newData:n.current,key:l==="insert"?"root":l,values:x});if(await V(`${a}_txt`,a,y,b),y!==void 0){const N=`/${a==="memo"?"m":a}/${y}`;u(N,{state:{reflash:!0}})}},f=async(x,b,y)=>{const N=a==="memo"?`${a}_txt/${r.uid}/`:`${a}_txt/`,w=a==="memo"?`${a}_tree/${r.uid}/`:`${a}/`;await Ze(N,w,l,b),console.log("onPostSubmit.values",x);const v=await O({rootDb:a,uid:r.uid,newData:n.current,key:l==="insert"?"root":l,values:x});console.log("onPostSubmit.newKey=",v),console.log("onPostSubmit.files=",y);const j=await V(`${N}/`,a==="memo"?`${a}/${r.uid}/`:`${a}/`,l,y);console.log("onNewSubmit.imageResult",j),a==="memo"&&L(`memo_tree/${r.uid}/${l}/title`,x.edTitle),n.current=!1;const $=`/${a==="memo"?"m":a}/${l}`;u($,{state:{reflash:!0}})};return c.useEffect(()=>{t&&t.title!==void 0&&oe({title:t.title,description:t.title});function x(){document.querySelectorAll("pre").forEach((b,y)=>{})}t&&t.memo!==null&&x()},[t]),l===""||r===void 0?e.jsx(e.Fragment,{}):t===void 0||o?e.jsx(T,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full p-0 m-0",children:n.current===!1&&t&&(t.title===void 0||t.title===""||t.title===null)?e.jsx(T,{}):e.jsx(yt,{newMode:n.current,onPostSubmit:f,onNewSubmit:h,onCancel:g,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html:"Y",iconCheck:t?.icon?t?.icon:"Y",content:t?.memo,imageList:t?.image})}),e.jsx(le,{})]})};function bt({initTreeData:s,userId:a,onClick:o}){const[t,d]=c.useState(s),{isMoble:u,height:n,width:k}=Fe(),l=c.useRef(),i=(r,g)=>{if(g.dragSource.id!==void 0&&g.dropTargetId!==void 0){const h=`memo_tree/${a}/${g.dragSource.id}/parent`;L(h,g.dropTargetId)}d(r)};return c.useEffect(()=>{(()=>{for(const g of s){const h=g.id;g.cnt=s.filter(f=>f.parent===h).length}d(s)})()},[s]),t==null||t.length===0?e.jsx(T,{}):e.jsx(Q,{backend:X,options:J(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:n-220-(u?56:0)+(k>1024?60:0),width:"100%"},children:e.jsx(Z,{tree:t,rootId:"root",onDrop:i,render:(r,{depth:g,isOpen:h,onToggle:f,isDragging:x,isDropTarget:b})=>e.jsxs("div",{className:`w-63 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ${x?"opacity-50":""} ${b?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} ${l.current===r.id?"bg-gray-200 dark:bg-blue-900":""}
              `,style:{paddingLeft:g*20+(r.cnt===0?5:0)},children:[e.jsx("div",{className:"min-w-0",children:r.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:f,children:h?e.jsx(ct,{className:"size-6"}):e.jsx(dt,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{l.current=r.id,console.log("nodeId.current",l.current),o(r)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[r.icon,r.text]}),r.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",r.cnt,")"]})]})]})})})})}const wt=s=>{const a=c.useRef(null);function o(){s.onSearchDataBtn(a.current.value)}function t(){return s.onNewMemoBtn(),!1}function d(u){u.which===13&&o()}return e.jsxs(e.Fragment,{children:[e.jsx(it,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:a,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:d}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(D,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:t,children:"새글"}),e.jsx(D,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:o,children:"조회"})]})]})},Nt=async(s,a,o)=>{let t=new Array;for(let d in o){const u=o[d];try{if(u.key=d,u.url===void 0){const n=await Ye(Ae,`${a}/${d}.${u.ext}`),k=await He(n);u.url=k,L(`${s}/image/${d}/url`,k)}t.push(u)}catch(n){console.log("getImageList.catch",n)}}return t},Ct=async(s,a,o,t)=>{let d="",u="",n={};((i,r,g)=>{u=i==="memo"?`${i}/${r}/${g}`:`${i}/${g}`,d=i==="memo"?`${i}_txt/${r}/${g}`:`${i}_txt/${g}`})(s,a,o);async function l(){if(d===void 0)return"";if(n=await re(d),n===void 0)return console.log("No data available"),"";if(n?.fullIndex,n.image!==void 0&&n.image!==null){const i=await Nt(d,u,n.image);n.image=i,(n.imageOK===void 0||n.imageOK==="N")&&(i&&i.map(r=>{r.ext==="jpg"&&(n.memo=n.memo+`<img src='${r.url}'>`)}),L(`${d}/imageOK`,"Y"),L(`${d}/memo`,n.memo))}if(t!==void 0&&t!==""){const i=t,r=new RegExp(i,"gi"),g=n.memo.replace(r,`<span class='lightext'>${i}</span>`);n.memo=g}}return await l(),n};async function $t(s,a,o=""){if(a==null||a==="")return"";const t=s==="home"?"home_txt":o===""?`${s}_tree/${a}`:`${s}_txt/${a}`,d=ee(te(se,t)),u=await ae(d);if(!u.exists())return console.log("getTreeData.null"),null;if(!u.exists())return console.log("getTreeData.exists"),null;const n=u.val(),k=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],l=[];s==="home"&&l.push(...k);for(const i in n){const r=n[i];r.up===void 0?(r.id=i,r.fullIndex=i):(r.id=r.up,r.fullIndex=r.up);const g={id:i,key:i,text:r.title,title:r.title,droppable:!0,parent:s==="home"?r.gbn:r.parent,icon:r.bm==="Y"?e.jsx(ge,{className:"text-red-500"}):r.icon==="Y"?e.jsx(lt,{}):null};s==="home"||o===""||o===void 0||o===null?l.push(g):(r.id=i,(r.memo+"").toLowerCase().indexOf(o.toLowerCase())>-1&&l.push(g))}return l.sort((i,r)=>i.title>r.title?1:-1),l}const St=c.lazy(async()=>await de(()=>import("./TwMemoMain-Bk1kWm7x.js"),__vite__mapDeps([12,1,2,13]))),Gt=({rootDb:s})=>{const a=M(),{user:o}=_(),t=c.useRef(),d=c.useRef(!0),u=c.useRef(),n=c.useRef(),[k,l]=c.useState(),i=c.useRef(!1),r=A(),g=c.useRef(!1);g.current=r?.state?.reflash===!0;const h=Ve({queryKey:["twTreeData",o?.uid,t.current],queryFn:()=>$t(s,o?.uid,t.current)});h.data!==void 0&&h.data!==""&&!i.current&&(i.current=!0);const f=()=>{const v=k;v&&(v.bookmark=v.bookmark==="Y"?"N":"Y");const j=`memo_tree/${o.uid}/${n.current}/bm`;L(j,k.bookmark),l({...k,bookmark:v.bookmark})};c.useEffect(()=>{o!==void 0&&o!=null&&h.refetch()},[o]),c.useEffect(()=>{const v=async C=>{if(C!==""&&o){const S=await Ct(s,o?.uid,C,t.current);s==="memo"&&(S.path=Tt(h.data,C)),d.current=!1,l(S===void 0?{}:S)}},j=r.pathname.split("/"),$=j.length>2?j[j.length-1]:"";d.current=!0,v($),n.current=$},[r.pathname,o]),c.useEffect(()=>{o!==void 0&&o!=null&&h.refetch()},[g.current]);const x=v=>{i.current=!1,v!==void 0&&(t.current=v),h.refetch()},b=v=>{v.id!==n.current&&(d.current=!0,console.log("node",v),a(`/${s==="memo"?"m":s}/${v.id}`))},y=()=>{if(o==null){alert("로그인 후 이용 가능합니다.");return}const v=`/${s==="memo"?"m":s}/insert/insert`;a(v)},N=v=>{},w=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3",children:e.jsx(mt,{to:"/m",children:s==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[s==="memo"?"":e.jsx(Y,{to:"/m",children:"메모"}),e.jsx(Y,{to:"/todo",children:"TODO"}),e.jsx(Y,{to:"/tw",children:"Sheet"})]}),e.jsx(wt,{onNewMemoBtn:y,onSearchDataBtn:x}),i.current&&h.isFetched?e.jsx(bt,{expandIndex:u.current,initTreeData:h.data,userId:o?.uid,onClick:b}):o===void 0?e.jsx(e.Fragment,{}):e.jsx(T,{})]});return o&&o.uid===ze&&Pe,e.jsxs(We,{sideType:"memo",title:s==="memo"?"메모장":"홈페이지관리",sideContents:w,children:[e.jsx(c.Suspense,{fallback:e.jsx(T,{}),children:e.jsxs(qe,{children:[e.jsx(B,{path:"/edit/:memoId",element:e.jsx(K,{rootDb:s,isLoading:d.current,searchWord:t.current,memoDetailData:k})}),e.jsx(B,{path:"/insert/:memoId",element:e.jsx(K,{rootDb:s,isLoading:d.current,searchWord:t.current,memoDetailData:k})}),e.jsx(B,{path:"/:memoId",element:e.jsx(xt,{rootDb:s,isLoading:d.current,searchWord:t.current,memoDetailData:k,onTreeUpdate:x,onBookmark:f,data:h.data})}),e.jsx(B,{path:"*",element:e.jsx(St,{searchWord:t.current,data:h.data,onNewMemoBtn:y,title:s==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),s==="memo"?e.jsx(gt,{onSelected:N}):"",e.jsx(Oe,{})]})},Tt=(s,a)=>{let o=[],t=a;if(!s)return o;const d=s.find(u=>u.id===t);for(o.unshift(d),t=d?.parent;t!=null&&t!==""&&t!=="root";){const u=s.find(n=>n.id===t);t=u?.parent,o.unshift(u)}return o};export{Gt as default};
