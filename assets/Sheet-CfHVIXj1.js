import{j as t,bk as b,d as M,u as L,b as l,bl as de,bm as me,T as fe,n as he,q as ge,o as xe,r as A,f as O,a as pe,s as g,p as ye,c as ve,e as je,L as V}from"./index-CJrggStm.js";import{T as I}from"./TwLabel-D1unnW49.js";import{H as we,r as Ce}from"./registry-ByHoBBPi.js";import{D as be}from"./datetime-BDx6lZXm.js";import{u as De}from"./index.esm-5hWjpj7j.js";/* empty css                */import{u as ke}from"./useWindowDimensions-DrhsGLu1.js";import{T as Ie}from"./TwSelect-Dk8h0QAx.js";import{A as D}from"./AniButton-BU8UzGDR.js";import"./Button-Cf3dF736.js";const Ne=({ui:p,onInsert:u,onDelete:f,onReload:y,onCsvSave:d})=>p==="tailwind"?t.jsxs("div",{className:"my-2 flex justify-end items-center",children:[t.jsx(b,{size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:u,children:"추가"}),t.jsx(b,{type:"button",size:"sm",variant:"outlined",color:"error",className:"mr-2",onClick:f,children:"삭제"}),t.jsx(b,{type:"button",size:"sm",variant:"outlined",color:"success",className:"mr-2",onClick:y,children:"리로드"}),t.jsx(b,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:d,children:"csv저장"})]}):t.jsxs("div",{className:"my-2 flex justify-end items-center gap-1",children:[t.jsx(D,{type:"button",size:"small",variant:"outlined",color:"warning",className:"mr-2",onClick:u,children:"추가"}),t.jsx(D,{type:"button",size:"small",variant:"outlined",color:"error",className:"mr-2",onClick:f,children:"삭제"}),t.jsx(D,{type:"button",size:"small",variant:"outlined",color:"success",className:"mr-2",onClick:y,children:"리로드"}),t.jsx(D,{type:"button",size:"small",variant:"outlined",color:"success",onClick:d,children:"csv저장"})]}),x=[{title:"구분",data:"dv",readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"설명1",type:"text",data:"t1",select:!0},{title:"설명2",type:"text",data:"t2",select:!0},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];Ce();const K=({csvFileName:p="exported_sheet",baseUrl:u="sheet",selectDefault:f="1"})=>{const{user:y}=M(),d=y?.uid,{ui:q}=L(),G=x.length-1,a=l.useRef(null),w=l.useRef(null),[N,U]=l.useState(),[Z,S]=l.useState(0),{height:R,width:F}=ke(),E=l.useRef(!1),[z,J]=de(me),{theme:Q,settings:X,colWidths:Y,setColWidths:k}=L();be.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:ee,reset:Se,control:T,setValue:$,getValues:C,formState:{errors:te}}=De({mode:"submit "}),se=Q==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",ne=async e=>{const s=`${u}/${d}/`;if(e.id===void 0||e.id===null||e.id===""){const n=ye(ve(A(O),s)).key;e.id=n}return g(s+e.id+"/dv",e.dv),g(s+e.id+"/title",e.title),g(s+e.id+"/t1",e.t1),g(s+e.id+"/t2",e.t2),g(s+e.id+"/ing","1"),e},oe=async()=>{const e=`${u}/${d}/`,s=ge(A(O,e),xe("dv"));pe(s,n=>{if(!n.exists())return;const r=n.val(),i=[];for(let c in r){const o=r[c];o.id=c,o.sort=`${o.dv}_${o.title}`,i.push(o)}i.sort((c,o)=>c.sort>o.sort?1:-1),U(i),S(i.length)})};l.useEffect(()=>{ee("filterField1"),$("columns1",f),console.log("SheetGrid.text=",z)},[]),l.useEffect(()=>{d!==void 0&&oe()},[d]),l.useEffect(()=>{F<500&&E.current===!1&&(E.current=!0,k([100,100,100,100,100,100]))},[F]),l.useEffect(()=>{a.current.hotInstance.addHook("afterColumnResize",function(s,n){const r=Y;try{r[n]=s,k(r)}catch{k([130,300,100,100,100,100])}})},[a.current]);const re=async()=>{B()},le=async()=>{a.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:p,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},P=[],W={indicators:!0},_=[];x.map((e,s)=>{e.select&&P.push({value:s,text:e.title,label:e.title}),e.hidden===!0&&_.push(s)}),W.columns=_;const B=()=>{try{const e=a.current?.hotInstance,s=e?.getPlugin("filters");if(s){const n=C("columns1");console.log("onKeyUp.columns1=",n,"text=",C("filterField1")),J(C("filterField1")),x.forEach((c,o)=>{s?.removeConditions(o)}),s?.addCondition(Number(n),"contains",[C("filterField1")]),s?.filter(),e?.render(),console.log("filtersPlugin=",s),console.log("hotRef=",a.current);const i=e.getData().length;S(i)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function ie(){a.current.hotInstance.alter("insert_row_above",0,1)}const ce=async(e,s)=>{if(e===null)return;const n=a.current?.hotInstance,r=n?.getPlugin("filters");if(r==null)return;const i=n.getData(),c={};e.forEach(async(m,v)=>{c[m[0]]=m[0]}),console.log("afterChange.lines=",c);const o=[];Object.keys(c).map(m=>{const v=c[m];console.log("afterChange.lines.key=",m,", lines=",v);const j={};x.forEach(async(h,ue)=>{j[h.data]=i[v][ue]}),o.push(j)}),console.log("afterChange.saveData=",o),o.forEach(async(m,v)=>{const j=await ne(m);console.log("afterChange.result=",v,", result=",j),N.map(h=>{(h.id===void 0||h.id===null)&&(h.id=j?.id,console.log("afterChange.rowData2=",h))})}),n.render()},ae=async()=>{const e=a.current.hotInstance;if(e&&w.current!==null){if(e?.getPlugin("filters")){const r=e.getData()[w.current][G];window.confirm("삭제하시겠습니까?")&&g(`${u}/${d}/${r}`,null)}e.alter("remove_row",w.current,1)}},H=e=>{const s=e.target.value;$(e.target.name,s)};return y===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:t.jsx(I,{children:"로그인을 해야 이용 가능합니다."})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx(Ie,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:T,className:"dark:bg-dark-900",defaultValue:f||"1",options:P,error:!!te.columns1,onChange:H}),t.jsx(fe,{name:"filterField1",control:T,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",onKeyUp:B,onChange:H,value:z})]}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[t.jsx(I,{textAlign:"left",children:"건수 : "+he(Z)}),t.jsx(Ne,{ui:q,onInsert:ie,onDelete:ae,onReload:re,onCsvSave:le})]}),t.jsx("div",{className:"w-full",style:{maxHeight:`${R} - 210`,overflow:"auto"},children:t.jsx(we,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:a,data:N,themeName:se,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:R-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:ce,afterSelection:e=>{w.current=e},columns:x,cells:(e,s)=>x[s].readOnly===!0?{readOnly:!0}:{},colWidths:X.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:W,licenseKey:"non-commercial-and-evaluation"})})]})};function He(){const{user:p}=M(),{ui:u}=je();return p===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:t.jsx(I,{children:"로그인을 해야 이용 가능합니다."})}):u==="tailwind"?t.jsx(l.Suspense,{fallback:t.jsx(V,{}),children:t.jsx(K,{})}):t.jsx(l.Suspense,{fallback:t.jsx(V,{}),children:t.jsx(K,{})})}export{He as default};
