import{r as C,j as x,I as T,bz as k,bA as Y,K as j,bB as A,bC as H,bD as I,M as v}from"./index-CmP4Fnif.js";H(I);v();const W=({id:r,rootDb:t,memoId:n,index:c,block:a,onUpdate:f,onUpdateBlock:o,afterSelection:b,readOnly:p,showSearch:m=!0})=>{const d=C.useRef(null);C.useRef(null);const R=l=>{o(r,{content:l})},D=async(l,F,S)=>{const h=d.current?.hotInstance;if(!h)return;const g=a.content.columns.map((e,s)=>({...e,width:h.getColWidth(s)}));console.log("handleAfterColumnResize.newColumns=",g),o(r,{content:{...a.content,columns:g}})},M=async(l,F)=>{if(F==="loadData"||typeof l!="object"||!Array.isArray(l))return;try{if(l[0].length!==4||l[0][2]===l[0][3])return}catch{return}const S=d.current?.hotInstance;if(S){const h=S.getSourceData();h.forEach((g,e)=>{Array.isArray(g)&&g.forEach((s,i)=>{s===null&&(h[e][i]="")})}),o(r,{content:{...a.content,data:h}})}};return x.jsx(x.Fragment,{children:x.jsx(z,{hotRef:d,columns:a.content.columns,rowData:a.content.data,colorData:a.content.colorData,colorTextData:a.content.colorTextData,gridData:a.content,onGridDataChange:R,afterChange:M,afterSelection:b,handleAfterColumnResize:D,showSearch:m,isDraggable:!1})})},z=({hotRef:r,columns:t,rowData:n,colorData:c,colorTextData:a,afterChange:f,afterSelection:o,handleAfterColumnResize:b,showSearch:p})=>{const{theme:m}=T(),d=C.useRef(null),[R,D]=C.useState("");C.useEffect(()=>{const e=r.current?.hotInstance;if(!e||!n)return;let s=!1;try{c&&c.forEach((i,y)=>{i&&i.forEach((u,E)=>{const N=e.getCellMeta(y,E).backgroundColor,w=u||void 0;N!==w&&(e.setCellMeta(y,E,"backgroundColor",w),s=!0)})})}catch{}try{a&&a.forEach((i,y)=>{i&&i.forEach((u,E)=>{const N=e.getCellMeta(y,E).color,w=u||void 0;N!==w&&(e.setCellMeta(y,E,"color",w),s=!0)})})}catch{}s&&e.render()},[n,c,a,r]);const M=[],l=C.useMemo(()=>{if(!t)return;const e=[];return t.forEach((s,i)=>{s.select&&M.push({value:i,text:s.title,label:s.title}),e.push({...s,title:s.title})}),e},[t]),F=C.useMemo(()=>l&&l.map((e,s)=>{const{readOnly:i,...y}=e;let u={...y,theme:m,isFirstColumn:l.indexOf(e)===0,data:s,colorData:c,colorTextData:a};return e.type==="numeric"?u={...u,type:"numeric",numericFormat:{pattern:"0,0.00"},originalRenderer:k.renderers.NumericRenderer}:e.type==="date"?u={...u,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:L},originalRenderer:k.renderers.DateRenderer}:e.type==="checkbox"?u={...u,type:"checkbox",className:"htCenter",originalRenderer:k.renderers.CheckboxRenderer}:u.originalRenderer=k.renderers.TextRenderer,{...u,renderer:K}}),[l,m,c,a]),S=m==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",h=e=>{e.key==="Enter"&&(e.preventDefault(),g())},g=()=>{const e=d.current.value;D(e);const s=r.current?.hotInstance;s&&s.render()};return x.jsxs("div",{className:"TwHotTable w-full",children:[p&&x.jsx(Y,{inputRef:d,onKeyDown:h,onSearch:g,className:"max-w-60"}),x.jsx(j,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:r,data:n,themeName:S,rowHeaders:!0,language:"ko-KR",colHeaders:t&&t.map(e=>e.title),autoWrapRow:!0,height:"auto",contextMenu:!0,search:R,observeChanges:!0,columnSorting:!0,afterChange:f,afterSelection:o,formulas:{engine:A.buildEmpty({licenseKey:"gpl-v3"})},columns:F,manualColumnResize:!0,afterColumnResize:b,colWidths:t.map(e=>e.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})]})},K=(r,t,n,c,a,f,o)=>{typeof f=="number"&&!isNaN(f)?(f%1!==0?o.numericFormat={pattern:"0,0.00"}:o.numericFormat={pattern:"0,0"},k.renderers.NumericRenderer.apply(void 0,[r,t,n,c,a,f,o])):o.originalRenderer?o.originalRenderer.apply(void 0,[r,t,n,c,a,f,o]):k.renderers.TextRenderer.apply(void 0,[r,t,n,c,a,f,o]);const b=r.getSettings().search,p=o.theme,m=r.getCellMeta(n,c),d=o.backgroundColor||m.backgroundColor,R=o.color||m.color,D=o.colorData,M=o.colorTextData;t.style.backgroundColor="",t.style.color="",b&&f&&String(f).toLowerCase().includes(b.toLowerCase())?(t.style.backgroundColor=p==="dark"?"#facc15":"yellow",t.style.color="black"):(t.style.backgroundColor=d,d||(n%2===0?t.style.backgroundColor=p==="dark"?"#101010":"#ffffff":t.style.backgroundColor=p==="dark"?"#000000":"#f8f8f8")),R&&(t.style.color=R),D?.[n]?.[c]&&(t.style.backgroundColor=D[n]?.[c]),M?.[n]?.[c]&&(t.style.color=M[n]?.[c])},L={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(r,t){const n=r.getDate(),c=r.getMonth()+1;return`${r.getFullYear()}-${c.toString().padStart(2,"0")}-${n.toString().padStart(2,"0")}`},parse(r,t){const n=r.split("-");return new Date(n[0],n[1]-1,n[2])}};export{W as HandsontableBlock};
