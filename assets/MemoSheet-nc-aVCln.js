import{h as P,N as U,da as W,j as e,ch as G,bf as M,w as k,I as D,a2 as g,p as K,o as Y,n as J,r as x,s as Q,H as X,db as Z,z as I,A as O,bo as ee,bp as te,bq as se,G as y,cI as E,dc as ae}from"./index-nRj4nPYT.js";import{T as ie}from"./TwLoading-DOEmB_Nt.js";import{L as re}from"./HtmlCode-BmtPEIoK.js";import{C as oe}from"./ComponentCard-Caj8iLns.js";import{M as ne,T as F,a as le}from"./MemoComm-DmqKaVvV.js";import"./HtmlText-Dx_N05EM.js";import"./index-C-g3HcFl.js";/* empty css                   */import"./HomeChartSemiDonut-yehLNnST.js";import"./Favorite-Bs2tQQvi.js";import"./fireMemoDetail-BUYTtsN4.js";import"./angle-right-BH-XgiAP.js";import"./HtmlCode-CLVKqXwK.js";import"./copy-CVF6MkCk.js";import"./TwRadio-DunHlsJl.js";import"./TwBadge-KD8AGwFX.js";import"./toPropertyKey-DCwh5dYN.js";import"./SinyImageList-Bxb9DwJG.js";import"./ImageListItem-BVi5W1KD.js";import"./CodeText-DyVh3zGM.js";/* empty css                   */import"./AniButton-DzvTQMHJ.js";import"./Button-DS7pCVEn.js";import"./SinySelect-DrzkPLyL.js";import"./Grid-r3HsE2Qf.js";import"./index-HOK9UU5O.js";import"./TextField-CnEWdIqS.js";import"./InputAdornment-Dm-lwJr-.js";import"./Popper-BPruNmAE.js";import"./Chip-B_qNkuwM.js";import"./Card-Cmy9gVfP.js";import"./CardContent-CF5KCopp.js";import"./TwCheckbox-Djrt5M9e.js";import"./TwTextArea-CTqQPU7z.js";import"./IpInfo-6qP_zB5_.js";const ce=({isOpen:N,onClose:C,onCreate:o})=>{const n={visible:{opacity:1},hidden:{opacity:0}},b={hidden:{y:"-50px",opacity:0,scale:.95},visible:{y:"0",opacity:1,scale:1,transition:{duration:.2,ease:"easeOut"}},exit:{y:"50px",opacity:0,scale:.95,transition:{duration:.15,ease:"easeIn"}}},{t:a}=P(),{register:w,control:h,handleSubmit:$,formState:{errors:f}}=U({defaultValues:{title:"",columns:[{title:"col_0",type:"text",width:100,data:"col_0"},{title:"col_1",type:"text",width:100,data:"col_1"},{title:"col_2",type:"text",width:100,data:"col_2"}]}}),{fields:_,append:S,remove:v}=W({control:h,name:"columns"}),j=[{value:"text",label:a("column_type_text")},{value:"numeric",label:a("column_type_numeric")},{value:"date",label:a("column_type_date")},{value:"checkbox",label:a("column_type_checkbox")}],L=i=>{if(!i.title||i.title.trim()===""){alert(a("sheet_title_required"));return}const l={...i,columns:i.columns.map((r,T)=>r.data&&(r.data==="id"||r.data==="title"||r.data==="description")?r:{...r,data:(r.title||"").toLowerCase().replace(/\s+/g,"_")||`col_${T}`})};o(l)};return e.jsx(G,{children:N&&e.jsx(M.div,{className:"fixed inset-0 bg-black/70 bg-opacity-50 z-180 flex justify-center items-center",variants:n,initial:"hidden",animate:"visible",exit:"hidden",children:e.jsx(M.div,{variants:b,initial:"hidden",animate:"visible",exit:"exit",onClick:i=>i.stopPropagation(),children:e.jsx(ne,{isDraggable:!0,className:"w-full max-w-sm sm:max-w-xl max-h-[61vh] overflow-y-auto",title:a("create_new_sheet"),children:e.jsxs("form",{onSubmit:$(L),children:[e.jsx("div",{className:"mb-4",children:e.jsx(F,{...w("title",{required:a("sheet_title_required")}),label:a("sheet_title"),placeholder:a("sheet_title_placeholder"),error:!!f.title,helperText:f.title?.message})}),e.jsx("h3",{className:"text-md font-semibold mb-2",children:a("columns")}),e.jsx("div",{className:"space-y-3",children:_.map((i,l)=>e.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-5 gap-2 items-center p-2 ${k.border} rounded-md`,children:[e.jsx("div",{className:"sm:col-span-2",children:e.jsx(D,{name:`columns.${l}.title`,control:h,defaultValue:i.title,render:({field:r})=>e.jsx(F,{...r,placeholder:a("column_title")})})}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(D,{name:`columns.${l}.type`,control:h,defaultValue:i.type,render:({field:r})=>e.jsx(le,{...r,options:j,className:"dark:bg-gray-700"})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(g,{type:"button",size:"sm",color:"warning",onClick:()=>v(l),disabled:_.length<=1,children:a("delete")})})]},i.id))}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(g,{type:"button",onClick:()=>S({title:"",type:"text",data:""}),children:a("add_column")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{type:"button",variant:"outlined",onClick:C,children:a("cancel")}),e.jsx(g,{type:"submit",children:a("create")})]})]})]})})})})})};function Ue({onDeleteTab:N}){const C=t=>{if(!t)return"";const s=new Date(t),m=s.getFullYear(),p=String(s.getMonth()+1).padStart(2,"0"),u=String(s.getDate()).padStart(2,"0"),c=String(s.getHours()).padStart(2,"0"),d=String(s.getMinutes()).padStart(2,"0");return`${m}-${p}-${u} ${c}:${d}`},{user:o}=K(),{t:n}=P(),b=Y(),a=J().sheetId,[w,h]=x.useState(null),[$,f]=x.useState(!1),[_,S]=x.useState(null),[v,j]=x.useState(""),[L,i]=x.useState({isOpen:!1});x.useEffect(()=>{Q({title:n("appSheet"),description:n("appSheet")})},[]);const l=(t=!0)=>{if(o)if(t){const s=Z();h(s)}else{const s=I(O,`memo_sheet/${o.uid}`),m=ee(s,p=>{const u=p.val(),c=u?Object.keys(u).map(d=>{const A=u[d];return{id:d,...A}}):[];c.sort((d,A)=>(A.createdAt||0)-(d.createdAt||0)),ae(c),h(c)});return()=>m()}};x.useEffect(()=>{l(!0)},[o]);const r=async t=>{const s=`memo_sheet/${o.uid}`,m=te(se(I(O),s)).key,p={title:t.title,columns:t.columns,createdAt:Date.now()};y(`${s}/${m}`,p);const u=`memo_sheet_data/${o.uid}/${m}/data`,c={id:0,createdAt:Date.now()};t.columns.forEach(d=>{d.data!=="id"&&d.data!=="createdAt"&&(c[d.data]="")}),y(`${u}/0`,c),c.id=1,y(`${u}/1`,c),f(!1),l(!1),b(`/m/sheet/${m}`)},T=t=>{b(`/m/sheet/${t}`)},V=async t=>{y(`memo_sheet/${o.uid}/${t}`,null),y(`memo_sheet_data/${o.uid}/${t}`,null),i({isOpen:!1}),N(t),t===a&&b("/m")},z=async(t,s)=>{s.stopPropagation(),i({isOpen:!0,title:n("delete_confirm_title"),message:n("delete_confirm_message"),color:"warning",onConfirm:()=>{V(t),E(),l(!1)},onClose:()=>i({isOpen:!1})})},q=(t,s)=>{s.stopPropagation(),S(t.id),j(t.title)},B=t=>{t.stopPropagation(),S(null),j("")},H=async(t,s)=>{if(s.stopPropagation(),!v.trim()){alert(n("sheet_title_required"));return}await y(`memo_sheet/${o.uid}/${t}/title`,v),h(m=>m.map(p=>p.id===t?{...p,title:v}:p)),S(null),j(""),E(),l(!1)};if(o===void 0||w==null)return e.jsx(ie,{});const R=e.jsxs("div",{className:`${k.between}`,children:[e.jsx(X,{className:"text-md",children:n("memo_sheet_list")}),e.jsx(g,{variant:"ghost",color:"sky",onClick:()=>f(!0),children:n("create_new_sheet")})]});return e.jsxs(oe,{title:R,className:"my-5",children:[e.jsx(re,{...L}),e.jsx(ce,{isOpen:$,onClose:()=>f(!1),onCreate:r}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:w.map(t=>e.jsx("div",{onClick:()=>_!==t.id&&T(t.id),className:`relative p-4 ${k.border} ${k.roundedSm} cursor-pointer hover:bg-gray-100 dark:hover:border-sky-500 dark:hover:bg-indigo-900/50 group`,children:_===t.id?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"text",value:v,onChange:s=>j(s.target.value),onClick:s=>s.stopPropagation(),className:"border p-2 rounded-md dark:bg-gray-700",autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{size:"sm",variant:"outlined",onClick:B,children:n("cancel")}),e.jsx(g,{size:"sm",onClick:s=>H(t.id,s),children:n("save")})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex h-8",children:[" ",e.jsx("h6",{className:" font-semibold pr-16 transition-transform duration-200 ease-in-out group-hover:scale-105 transform-origin-left dark:group-hover:text-lg",children:t.title})]}),e.jsxs("div",{className:"flex justify-between items-baseline mt-2 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"text-xs ",children:C(t.createdAt)}),e.jsxs("p",{className:"text-sm ",children:["(",t.count,")"]})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:s=>q(t,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})}),e.jsx("button",{onClick:s=>z(t.id,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},t.id))})]})}export{Ue as default};
