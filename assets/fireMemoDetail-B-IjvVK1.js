import{c2 as i,c3 as g,c4 as h,G as d,c5 as L,c6 as y,c7 as $,c8 as p,c9 as w,ca as x}from"./index-D-tzgtCF.js";function F(o){var l=o.length,s=o.lastIndexOf("."),t=o.substring(s+1,l).toLowerCase();return t}function v(o){var l=o.indexOf("."),s=o.substring(0,l);return s}const P=async(o,l,s)=>{console.log("getImagePath.userId=",o),console.log("getImagePath.id=",l),console.log("getImagePath.fileNm=",s);const t={};t.ext=F(s),t.name=s,t.key=v(s);try{const a=`memo/${o}`,r=i(g,`${a}/${s}`),e=await h(r);t.url=e,console.log("getImagePath.img=",t),d(`memo_txt/${o}/${l}/image/${t.key}`,t)}catch(a){console.log("getImageList.catch",a)}return t},D=async(o,l,s,t)=>{const a="memo/I3cTgdCxwjhBBno4mtZYvnODPJu1";console.log("getImageList.id=",o),console.log("getImageList.base=",a),console.log("getImageList.image=",s);let r=new Array;for(let e in s){const c=s[e];try{if(c.key=e,c.url===void 0||c.url===""){const u=i(g,`${a}/${e}.${c.ext}`),n=await h(u);console.log("getImageList.downUrl=",n),c.url=n,d(`${o}/image/${e}/url`,n)}}catch{}r.push(c)}return r},U=async(o,l,s,t)=>{F(t.name),console.log("setFileUpload.locate=",o),console.log("setFileUpload.file=",t);let a=i(g,`${o}/${t.name}`);try{const e=await y(a);console.log("setFileUpload: 파일이 이미 존재합니다 파일정보=",e),a=i(g,`${o}/${s}${t.name}`)}catch(e){if(e.code!=="storage/object-not-found")throw console.error("setFileUpload: 파일 확인 중 오류:",e),e}return await $(a,t)},S=async(o,l,s,t)=>{const a={success:!0,key:s,message:"파일명이 성공적으로 변경되었습니다."};try{const r=i(g,o+l+"."+t);let e=i(g,o+s+"."+t);const c=await L(r);let u=0;for(;;)try{const m=await y(e);u++;const f=s+u;a.key=f,e=i(g,o+f+"."+t)}catch{console.log("renameFile: 업로드 확인 대기중...",u);break}await $(e,c),await p(r);const n=await h(e);return a.url=n,console.log("renameFile: 파일명 변경 완료"),a}catch(r){return console.error("renameFile: 파일명 변경 중 오류:",r),{success:!1,message:"파일명 변경 실패"}}},_=async(o,l,s)=>{console.log("setFileDelete.locate=",o),console.log("setFileDelete.id=",l),console.log("setFileDelete.file=",s);try{const t=i(g,`${o}/${s.key}.${s.ext}`);p(t).then(()=>{console.log("setFileDelete.storageRef=",t)}).catch(a=>{console.log("setFileDelete.error=",a)})}catch(t){console.log("setFileDelete.catch",t)}},k=async(o="")=>{console.log("getStorageFileList.path=",o);try{const l=i(g,o),s=await w(l),t=[];for(let a=0;a<s.items.length&&a<10;a++){const r=s.items[a];try{t.push(r._location.path_.replace("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1/",""))}catch(e){console.error("파일 정보 조회 실패:",itemRef.name,e)}}return console.error("getStorageFileList10.fileList=",t),t}catch(l){return console.error("Storage 파일 목록 조회 실패:",l),{files:[],folders:[],success:!1,error:l.message}}},O=async(o="")=>{console.log("getStorageFileList.path=",o);try{const l=i(g,o),s=await w(l);console.log("getStorageFileList.listAll=",s);const t=[];for(const r of s.items)try{const e=await y(r),c=await h(r);t.push({name:r.name,fullPath:r.fullPath,size:e.size,contentType:e.contentType,timeCreated:e.timeCreated,updated:e.updated,downloadURL:c})}catch(e){console.error("파일 정보 조회 실패:",r.name,e)}const a=s.prefixes.map(r=>({name:r.name,fullPath:r.fullPath,type:"folder"}));return console.log("getStorageFileList 결과:",{files:t,folders:a}),{files:t,folders:a,success:!0}}catch(l){return console.error("Storage 파일 목록 조회 실패:",l),{files:[],folders:[],success:!1,error:l.message}}},b=async(o,l,s,t)=>{let a="",r="",e={};((n,m,f)=>{r=n==="memo"?`${n}/${m}/${f}`:`${n}/${f}`,a=n==="memo"?`${n}_txt/${m}/${f}`:`${n}_txt/${f}`})(o,l,s);async function u(){if(a===void 0)return"";if(e=await x(a),e===void 0){console.log("No data available"),e={code:"404",msg:"No data available"};return}if(e?.fullIndex,e.image!==void 0&&e.image!==null){const n=await D(a,r,e.image);e.image=n,(e.imageOK===void 0||e.imageOK==="N")&&(n&&n.map(m=>{m.ext==="jpg"&&(e.memo=e.memo+`<img src='${m.url}'>`)}),d(`${a}/imageOK`,"Y"),d(`${a}/memo`,e.memo))}if(e.html!=="N"&&t!==void 0&&t!==""){console.log("fireMemoDetail.html=",e.html),console.log("fireMemoDetail.searchWord=",t);const n=new RegExp(t,"gi"),m=e.memo.replace(n,`<span class='lightext'>${t}</span>`);e.memo=m}}return await u(),e};export{v as a,_ as b,P as c,S as d,O as e,b as f,F as g,k as h,U as s};
