const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DW3eK4jt.js","assets/index-DM1iZTPq.js","assets/index-CDMyZAy5.css","assets/createSvgIcon-BqpJDeTN.js","assets/useControlled-CroFzyq2.js","assets/ownerWindow-DvT1GKkC.js","assets/isMuiElement-CVP_6nCw.js","assets/fireDatabase-p21Gmfrk.js","assets/fireStorage-BcndKC9W.js","assets/SinyDate-DyqopQYr.js","assets/Grid-DoLZDLBd.js","assets/useTheme-MXaPPUfs.js","assets/index-BUVqKFi-.js","assets/index-Chjiymov.js","assets/Typography-oEPrgN9t.js","assets/Menu-D4UpYUzb.js","assets/useSlotProps-BfIDkrBa.js","assets/resolveComponentProps-CHpzwSQW.js","assets/utils-Byy2SSv5.js","assets/IconButton-tkTxVkoM.js","assets/TextField-g1OlwQzW.js","assets/InputAdornment-CRuMp-It.js","assets/Popper-Cz1QYxMF.js","assets/Button-Cv0I8qBM.js","assets/Chip-BzfYwn5_.js","assets/index.esm-DSRKldM8.js","assets/TwButton-ukIXDGZ2.js","assets/Loading-CiYFJLLu.js","assets/Container-BeifmoFp.js","assets/styled-BDepcmTt.js","assets/CircularProgress-Da9OOWcb.js","assets/Divider-CCTv9Vim.js","assets/dividerClasses-CR2heZrU.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-BzYZY--C.js","assets/IpInfo-C8xcitIC.js"])))=>i.map(i=>d[i]);
import{r as l,u as q,j as e,c as V,T as Ue,q as he,e as Ye,o as Ae,a as xe,f as fe,g as pe,h as ae,i as oe,k as He,t as We,H as qe,l as ve,p as je,_ as ke,d as Oe,v as ze,R as Ve,w as z}from"./index-DM1iZTPq.js";import{u as Ke}from"./useSuspenseQuery-Dj5yRHPh.js";import{L as I}from"./Loading-CiYFJLLu.js";import{T as Je}from"./Footer-DwkszFnv.js";import{a as Ge,T as X}from"./TwLinkItem-MqPx7I1k.js";import{g as we,s as D}from"./fireDatabase-p21Gmfrk.js";import{D as ye,g as be,S as $e,T as Ce,H as ie}from"./HtmlCode-yCxz2phK.js";import{E as Qe,C as Ze}from"./ExpandMore-xrdTicZo.js";import{F as Ne}from"./Favorite-hoOXdWza.js";import{u as le,a as ce,F as Xe,b as et,D as Te,l as tt,I as ot,s as ee,d as te,e as Se}from"./index-DW3eK4jt.js";import{S as st}from"./SinyImageList-DjqEFm0v.js";import{c as nt}from"./CodeText-RTRFzVS6.js";import{s as me}from"./commonUtil-DB1p0nOq.js";import{T as _}from"./TwButton-ukIXDGZ2.js";import{C as rt}from"./CircularProgress-Da9OOWcb.js";import{D as at}from"./datetime-BDx6lZXm.js";import{u as De}from"./index.esm-DSRKldM8.js";import{T as ue}from"./TwCheckbox-Cczy94OR.js";import{T as Le}from"./TwTextArea-y5tO5FUD.js";import{T as P}from"./TwBadge-D8gIShjP.js";import"./SinyDate-DyqopQYr.js";import{T as Ie}from"./TwInput-BHewyM0A.js";import{T as it}from"./TwSelect-9VJ-is5J.js";import{T as lt}from"./TwDatePicker-BykBsgGw.js";import{d as W,e as Re}from"./fireStorage-BcndKC9W.js";import{f as ct}from"./fireMemoDetail-B7qbEyYa.js";import{S as mt}from"./check-circle-3_enoCGQ.js";import"./useBaseQuery-CG2bgbSt.js";import"./Container-BeifmoFp.js";import"./styled-BDepcmTt.js";import"./LinkItem-BhQSB4lk.js";import"./Typography-oEPrgN9t.js";import"./Divider-CCTv9Vim.js";import"./dividerClasses-CR2heZrU.js";import"./Link-BTT4zD_k.js";import"./copy-DwII0VIZ.js";import"./toPropertyKey-DCwh5dYN.js";import"./createSvgIcon-BqpJDeTN.js";import"./useControlled-CroFzyq2.js";import"./ownerWindow-DvT1GKkC.js";import"./isMuiElement-CVP_6nCw.js";import"./IconButton-tkTxVkoM.js";import"./index-Chjiymov.js";import"./ImageListItem-C8uV5ehP.js";import"./Grid-DoLZDLBd.js";import"./useTheme-MXaPPUfs.js";import"./index-BUVqKFi-.js";import"./Menu-D4UpYUzb.js";import"./useSlotProps-BfIDkrBa.js";import"./resolveComponentProps-CHpzwSQW.js";import"./utils-Byy2SSv5.js";import"./TextField-g1OlwQzW.js";import"./InputAdornment-CRuMp-It.js";import"./Popper-Cz1QYxMF.js";import"./Button-Cv0I8qBM.js";import"./Chip-BzfYwn5_.js";const dt=s=>l.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...s},l.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),ut=s=>l.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...s},l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"}));function gt({initTreeData:s}){const[t,m]=l.useState(),o=f=>m(f),h=q();if(l.useEffect(()=>{m(s)},[s]),t==null||t.length===0)return e.jsx(I,{});const k=f=>{console.log("node",f),h(`/m/${f.id}`)};return e.jsx(ye,{backend:$e,options:be(),children:e.jsx(Ce,{tree:t,rootId:"root",onDrop:o,render:(f,{depth:p,isOpen:a,onToggle:d})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:p*20+(f.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[f.cnt>0&&e.jsx("div",{onClick:d,children:a?e.jsx(Qe,{}):e.jsx(Ze,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>k(f),children:f.text})]}),f.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",f.cnt,")"]})]})})})}function ht(s){const{user:t}=V(),m=q(),[o,h]=l.useState(),[k,f]=l.useState(),p=async a=>{const d=[],c=he(xe(fe,`memo_tree/${a}`),Ae("bm"),Ye("Y")),g=await pe(c);if(!g.exists()){console.log("getFireData.null");return}const C=g.val();for(let y in C){const x=C[y];x.id=y,x.key=y,x.text=x.title,d.push(x)}d.sort((y,x)=>y.title>x.title?1:-1),h([...d])};return l.useEffect(()=>{t!==void 0&&t!=null&&p(t?.uid)},[t]),l.useEffect(()=>{const a=async(d,c)=>{const g=[...c];if(c)for(const C of c){let y=C;for(;y.parent!=="root";){y.parent,y=await we(`memo_tree/${d}/${y.parent}`);const x={id:y.key,text:y.title,droppable:!1,parent:y.parent};g.filter(w=>w.id===x.id).length===0&&g.push(x)}}for(const C of g){const y=C.id;C.cnt=g.filter(x=>x.parent===y).length}f(g)};o&&o.length>0&&a(t?.uid,o)},[o]),t===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Ue,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:o&&o.map((a,d)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{s.onSelected(a.key),m(`/m/${a.key}`)},children:e.jsx("span",{className:"text-base",children:a.title})})},d))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(l.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(gt,{initTreeData:k,uid:t?.uid})})]})}const xt=s=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:`70px 70px 70px ${s.master?"70px":""}`},children:[s.master&&e.jsx(_,{size:"sm",variant:"outlined",color:"success",onClick:s.onUtil,children:"유틸"}),e.jsx(_,{size:"sm",variant:"outlined",color:"success",onClick:s.onEdit,children:"수정"}),e.jsx(_,{size:"sm",variant:"outlined",color:"warning",onClick:s.onNewMemo,children:"새글"}),e.jsx(_,{size:"sm",variant:"outlined",color:"error",onClick:s.onDelete,children:"삭제"})]}),ft=s=>{const{rootDb:t,isLoading:m,memoDetailData:o,onBookmark:h,onTreeUpdate:k,searchWord:f}=s,{scrollYProgress:p}=le(),a=ce(p,{stiffness:100,damping:30,restDelta:.001}),d=q(),{memoId:c}=ae(),C=oe()?.state?.fullIndex,{user:y}=V(),x=()=>{const u=`/${t==="memo"?"m":t}/edit/${c}`;d(u,{state:{fullIndex:C}})},i=()=>{const u=`/${t==="memo"?"m":t}/util/${c}`;d(u,{state:{fullIndex:C}})},w=()=>{const u=`/${t==="memo"?"m":t}/insert/${c}`;d(u,{state:{fullIndex:C}})},n=async()=>{const u=t==="memo"?`${t}_txt/${y.uid}/${c}`:`${t}_txt/${c}`,v=t==="memo"?`${t}_tree/${y.uid}/${c}`:`${t}/${c}`;await et(u,v)!==void 0&&(k(),d(`/${t==="memo"?"m":t}`))},j=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&n()};return l.useEffect(()=>{o&&o.title!==void 0&&me({title:o.title,description:o.title});function u(){window.scrollTo({top:0}),o&&o.html!=="N"&&document.querySelectorAll("pre").forEach(v=>{v.innerHTML=nt(v.innerHTML)})}o&&o.memo!==null&&(u(),o.image&&o.image.map((v,T)=>(console.log("image."+T+"=",v.key),v)))},[o]),m?e.jsx(I,{}):c===""||y===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(He.div,{className:"progress-bar",style:{scaleX:a}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:o&&o.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:h,children:o&&o.bookmark==="Y"?e.jsx(Ne,{className:"text-red-500"}):e.jsx(Xe,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:o?.path&&o?.path.map((u,v)=>v===0?u?.text:` > ${u?.text}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(xt,{master:y?.uid===We,rootDb:t,onEdit:x,onUtil:i,onNewMemo:w,onDelete:j,bookmark:o&&o.bookmark}),e.jsxs("div",{className:"my-4",children:[o&&o.html==="N"?e.jsx(ie,{postData:o&&o.memo,highlightWord:f}):o&&o.html!=="N"&&o.memo&&e.jsx(qe,{text:o.memo}),e.jsx(st,{imageList:o&&o.image}),!o&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(rt,{})})})]})]})]})},Ee=({onSubmit:s,onCancel:t,isSubmitting:m,newMode:o=!1})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(_,{variant:"outlined",color:"success",disabled:m,onClick:h=>{h.preventDefault(),s(h)},children:[o?"새글":""," 저장"]}),e.jsx(_,{variant:"outlined",color:"error",onClick:h=>{h.preventDefault(),t()},children:"취소"})]}),pt=l.lazy(()=>ke(()=>import("./index-DW3eK4jt.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33])));tt.Quill.register("modules/imageDrop",ot);je.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const vt={syntax:{highlight:s=>je.highlightAuto(s).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},jt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],kt=s=>{const[t,m]=l.useState(s.imageList),[o,h]=l.useState(s.htmlCheck==="Y"),[k,f]=l.useState(s.iconCheck==="Y"),[p,a]=l.useState(s.newMode?"":s.content),[d,c]=l.useState(),g=l.useRef(),C=l.useRef(),y=l.useRef(null);l.useRef(null);const x=l.useRef(null),i=s.newMode,w=l.useRef([]),{height:n}=ve(),j=at.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),u={edTitle:i?"":s.title,edGbn:s.gbn?s.gbn:"etc",edDate:i?j:s.date,content:i?"":s.content,memoTxt:i?"":s.content,htmlCheck:s.htmlCheck,iconCheck:s.iconCheck},{register:v,handleSubmit:T,trigger:O,control:F,setValue:L,getValues:B,watch:K,formState:{errors:se,isSubmitting:ne}}=De({mode:"onChange",defaultValues:u});l.useEffect(()=>{v("edDate"),v("edGbn",{required:!0}),v("htmlCheck"),v("iconCheck"),v("memoTxt")},[]),l.useEffect(()=>{w.current=[],g.current=s.content,C.current=!1},[s.content]);const J=async r=>{i?await s.onNewSubmit(r,w.current):await s.onPostSubmit(r,t,w.current)},b=()=>{T(J)()},N=r=>{console.log("onDelete.imageList=",r),m(r)},M=r=>{console.log("onInsert.file",r);let $=g.current;r.ext==="jpg"||r.ext==="png"?($+=`<img src='${r.url}'/>`,G(`<img src='${r.url}'/>
`)):r.ext==="mp4"?($+=`<video preload="auto" controls="" src='${r.url}'></video>`,G(`<video preload="auto" controls="" src='${r.url}'></video>`)):($+=`<a src='${r.url}'>${r.name}}</a>`,G(`다운로드
<a href="${r.url}" target="_blank">${r.name}</a>
`)),g.current=$},S=r=>s.onRename(r,B("edTitle")),R=r=>{g.current=r},re=r=>{console.log("handleFileUpload",r),w.current=r};function Y(r){g.current=r,L("content",r),O("content")}const de=(r,$)=>{console.log(`onChecked.e.${r}=`,$),L(r,$?"Y":"N"),console.log(`onChecked.v.${r}=`,B(r)),r==="htmlCheck"?h($):f($)},Fe=K("content"),Pe=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],_e=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],G=r=>{const $=y.current;if($){const H=$.selectionStart,E=$.selectionEnd,U=p.slice(0,H),Q=p.slice(E);a(U+r+Q),L("memoTxt",U+r+Q),setTimeout(()=>{$.selectionStart=$.selectionEnd=H+r.length,$.focus()},0)}},A=r=>{G(r)},Be=r=>r?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(r)||r.includes("image")||r.includes("img"):!1,Me=r=>new Promise(($,H)=>{const E=new Image;E.crossOrigin="anonymous",E.onload=()=>{const U=document.createElement("canvas"),Q=U.getContext("2d");U.width=E.width,U.height=E.height,Q.drawImage(E,0,0);try{const Z=U.toDataURL("image/png");console.log("convertImageToBase64.base64=",Z.substring(0,30)+"..."),$(Z)}catch(Z){H(Z)}},E.onerror=()=>{H(new Error("Failed to load image"))},E.src=r});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:T(J),style:{width:"100%",minHeight:"300px",maxHeight:{height:n},display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsx(ue,{id:"htmlCheck",checked:o,onChange:r=>de("htmlCheck",r),label:"HTML사용"}),e.jsx(ue,{id:"iconCheck",checked:k,onChange:r=>de("iconCheck",r),label:"Icon"}),e.jsx(Ee,{onSubmit:r=>b(),onCancel:s.onCancel,isSubmitting:ne,newMode:i})]}),e.jsx(Te,{control:F,onDelete:N,onInsert:M,onRename:S,setContent:R,onFileUpload:re,imageList:s.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(Ie,{name:"edTitle",placeholder:"제목",control:F,rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:r=>{r.preventDefault(),L("edTitle",r.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(it,{name:"edGbn",label:"구분",control:F,rules:{required:!0},placeholder:"-- 구분 --",options:Pe,className:"",allClassName:"max-w-40",onChange:r=>{r.preventDefault();const $=r.target.value;console.log("edGbn=",B("edGbn")),L("edGbn",$)}}),e.jsx(lt,{id:"edDate",name:"edDate",placeholder:"Select a date",control:F,onChange:(r,$)=>{console.log({dates:r,currentDateString:$}),L("edDate",$)}})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(ie,{postData:p})}),e.jsxs("div",{children:[e.jsx(Le,{ref:y,className:"",value:p,onChange:r=>{L("memoTxt",r),a(r)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A(`<box>
</box>`),children:"<Box>"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<hr style="width=100%"/>'),children:"line"}),_e.map((r,$)=>e.jsx(P,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>A("<code>"+r+`
</code>`),children:r},$))]})]}),B("edUrl")&&Be(B("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:d,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async r=>{try{const $=await Me(d);L("edUrl2",$)}catch($){console.error("Base64 conversion failed:",$)}},onError:r=>{r.target.style.display="none"}})})]}),o&&e.jsx(l.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(pt,{ref:x,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:Fe,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:vt,formats:jt,onChange:Y})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},ge=s=>{const{rootDb:t,isLoading:m,memoDetailData:o}=s,{scrollYProgress:h}=le();ce(h,{stiffness:100,damping:30,restDelta:.001});const k=q(),f=l.useRef(),p=l.useRef();p.current=s.searchWord;const{memoId:a}=ae(),d=oe(),{user:c}=V();f.current=d.pathname.split("/")[2]==="insert",console.log("memoDetailData=",o);const g=()=>{const n=`/${t==="memo"?"m":t}/${a==="insert"?"":a}`;k(n)},C=async n=>{await W(c.uid,a,n)},y=async n=>{if(console.log("onFilePathList.fileNm=",n),n.length>0)for(let j=0;j<n.length;j++){const u=n[j];console.log("onFilePathList.file=",u);try{const v=await W(c.uid,a,u);console.log("onFilePathList.path=",v)}catch{console.log("onFilePathList.error=",u)}}else await W(c.uid,a,n)},x=async(n,j)=>{console.log("onNewSubmit.values",n);const u=await ee({rootDb:t,uid:c.uid,newData:f.current,key:a==="insert"?"root":a,values:n});if(await te(`${t}_txt`,t,u,j),u!==void 0){const v=`/${t==="memo"?"m":t}/${u}`;k(v,{state:{reflash:!0}})}},i=async(n,j)=>{const u=t==="memo"?`${t}/${c.uid}/`:`${t}/`,v=await Re(u,n.key,j,n.ext);if(v.success){const T=t==="memo"?`${t}_txt/${c.uid}/${a}/image/`:`${t}_txt/${a}/image/`;return D(T+n.key,null),n.key=v.key,n.url=v.url,n.name=v.key+"."+n.ext,D(T+v.key,n),console.log("onRename.file",n),n}},w=async(n,j,u)=>{const v=t==="memo"?`${t}_txt/${c.uid}/`:`${t}_txt/`;t==="memo"?`${t}${c.uid}`:`${t}`,await Se(v,t==="memo"?`${t}/${c.uid}/`:`${t}/`,a,j),console.log("onPostSubmit.values",n);const T=await ee({rootDb:t,uid:c.uid,newData:f.current,key:a==="insert"?"root":a,values:n});console.log("onPostSubmit.newKey=",T),console.log("onPostSubmit.files=",u);const O=await te(`${v}`,t==="memo"?`${t}/${c.uid}/`:`${t}/`,a,u);console.log("onNewSubmit.imageResult",O),t==="memo"&&D(`memo_tree/${c.uid}/${a}/title`,n.edTitle),f.current=!1;const F=`/${t==="memo"?"m":t}/${a}`;t==="home"&&D("home/tree",null),k(F,{state:{reflash:!0}})};return l.useEffect(()=>{o&&o.title!==void 0&&me({title:o.title,description:o.title});function n(){document.querySelectorAll("pre").forEach((j,u)=>{})}o&&o.memo!==null&&n()},[o]),a===""||c===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",m),o===void 0||m?e.jsx(I,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:f.current===!1&&o&&(o.title===void 0||o.title===""||o.title===null)?e.jsx(I,{}):e.jsx(kt,{newMode:f.current,onPostSubmit:w,onNewSubmit:x,onCancel:g,onRename:i,onFilePath:C,onFilePathList:y,title:o?.title,gbn:o?.gbn,date:o?.date,htmlCheck:o?.html?o?.html==="Y"?"Y":"N":"Y",iconCheck:!o?.icon==="Y"?"Y":"N",content:o?.memo,imageList:o?.image})})}))},wt=s=>{const[t,m]=l.useState(s.imageList),[o,h]=l.useState(s.content),[k,f]=l.useState(),p=l.useRef(),a=l.useRef(null),d=l.useRef([]),{height:c}=ve(),g={edTitle:s.title,edGbn:s.gbn?s.gbn:"etc",edDate:s.date,content:s.content,memoTxt:s.content,htmlCheck:"N",iconCheck:"N"},{register:C,handleSubmit:y,trigger:x,control:i,setValue:w,getValues:n,formState:{errors:j,isSubmitting:u}}=De({mode:"onChange",defaultValues:g});l.useEffect(()=>{C("edDate"),C("memoTxt")},[]),l.useEffect(()=>{d.current=[],p.current=s.content},[s.content]);const v=async b=>{await s.onPostSubmit(b,t,d.current)},T=()=>{y(v)()},O=b=>{m(b)},F=b=>{let N="";b.ext==="jpg"||b.ext==="png"?N=`<img src='${b.url}'/>
`:b.ext==="pdf"?N=`<PDF>${b.url}</PDF>`:b.ext==="mp4"?N=`<video preload="auto" controls="" src='${b.url}'></video>`:N=`다운로드
<a href="${b.url}" target="_blank">${b.name}</a>
`,K(N)},L=b=>s.onRename(b,n("edTitle")),B=b=>{d.current=b},K=b=>{const N=a.current;if(N){const M=N.selectionStart,S=N.selectionEnd,R=o.slice(0,M)+b+o.slice(S);h(R),w("memoTxt",R),setTimeout(()=>{N.selectionStart=N.selectionEnd=M+b.length,N.focus()},100)}},se=b=>{K(b)},ne=b=>new Promise((N,M)=>{const S=new Image;S.crossOrigin="anonymous",S.onload=()=>{const R=document.createElement("canvas"),re=R.getContext("2d");R.width=S.width,R.height=S.height,re.drawImage(S,0,0);try{const Y=R.toDataURL("image/png");console.log("convertImageToBase64.base64=",Y.substring(0,30)+"..."),N(Y)}catch(Y){M(Y)}},S.onerror=()=>{M(new Error("Failed to load image"))},S.src=b}),J=["React","JavaScript"];return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:y(v),style:{width:"100%"},children:[e.jsx(Ee,{onSubmit:T,onCancel:s.onCancel,isSubmitting:u}),e.jsx(Te,{control:i,onDelete:O,onInsert:F,onRename:L,onFileUpload:B,imageList:s.imageList}),e.jsx("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2"}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(ie,{postData:o})})}),e.jsxs("div",{children:[e.jsx(Le,{ref:a,value:o,onChange:b=>{w("memoTxt",b),h(b)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>se(`<box>
</box>`),children:"Box"}),J.map((b,N)=>e.jsx(P,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>se("<code>"+b+`
</code>`),children:b},N))]})]}),n("edUrl")&&isImageUrl(n("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:k,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async b=>{try{const N=await ne(k);w("edUrl2",N)}catch(N){console.error("Base64 conversion failed:",N)}},onError:b=>{b.target.style.display="none"}})})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},yt=s=>{const{rootDb:t,isLoading:m,memoDetailData:o}=s,{scrollYProgress:h}=le();ce(h,{stiffness:100,damping:30,restDelta:.001});const k=q(),f=l.useRef();f.current=s.searchWord;const{memoId:p}=ae();oe();const{user:a}=V();console.log("memoDetailData=",o);const d=()=>{const i=`/${t==="memo"?"m":t}/${p==="insert"?"":p}`;k(i)},c=async i=>{await W(a.uid,p,i)},g=async i=>{if(console.log("onFilePathList.fileNm=",i),i.length>0)for(let w=0;w<i.length;w++){const n=i[w];console.log("onFilePathList.file=",n);try{const j=await W(a.uid,p,n);console.log("onFilePathList.path=",j)}catch{console.log("onFilePathList.error=",n)}}else await W(a.uid,p,i)},C=async(i,w)=>{console.log("onNewSubmit.values",i);const n=await ee({rootDb:t,uid:a.uid,newData:!1,key:p,values:i});if(await te(`${t}_txt`,t,n,w),n!==void 0){const j=`/${t==="memo"?"m":t}/${n}`;k(j,{state:{reflash:!0}})}},y=async(i,w)=>{const n=t==="memo"?`${t}/${a.uid}/`:`${t}/`,j=await Re(n,i.key,w,i.ext);if(j.success){const u=t==="memo"?`${t}_txt/${a.uid}/${p}/image/`:`${t}_txt/${p}/image/`;return D(u+i.key,null),i.key=j.key,i.url=j.url,i.name=j.key+"."+i.ext,D(u+j.key,i),console.log("onRename.file",i),i}},x=async(i,w,n)=>{const j=t==="memo"?`${t}_txt/${a.uid}/`:`${t}_txt/`;t==="memo"?`${t}${a.uid}`:`${t}`,await Se(j,t==="memo"?`${t}/${a.uid}/`:`${t}/`,p,w),console.log("onPostSubmit.values",i);const u=await ee({rootDb:t,uid:a.uid,newData:!1,key:p==="insert"?"root":p,values:i});console.log("onPostSubmit.newKey=",u),console.log("onPostSubmit.files=",n);const v=await te(`${j}`,t==="memo"?`${t}/${a.uid}/`:`${t}/`,p,n);console.log("onNewSubmit.imageResult",v),t==="memo"&&D(`memo_tree/${a.uid}/${p}/title`,i.edTitle);const T=`/${t==="memo"?"m":t}/${p}`;t==="home"&&D("home/tree",null),k(T,{state:{reflash:!0}})};return l.useEffect(()=>{o&&o.title!==void 0&&me({title:o.title,description:o.title});function i(){document.querySelectorAll("pre").forEach((w,n)=>{})}o&&o.memo!==null&&i()},[o]),p===""||a===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",m),o===void 0||m?e.jsx(I,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:o&&(o.title===void 0||o.title===""||o.title===null)?e.jsx(I,{}):e.jsx(wt,{onPostSubmit:x,onNewSubmit:C,onCancel:d,onRename:y,onFilePath:c,onFilePathList:g,title:o?.title,gbn:o?.gbn,date:o?.date,htmlCheck:o?.html?o?.html==="Y"?"Y":"N":"Y",iconCheck:!o?.icon==="Y"?"Y":"N",content:o?.memo,imageList:o?.image})})}))};function bt({initTreeData:s,userId:t,memoId:m,onClick:o}){const[h,k]=l.useState(s),{isMoble:f,height:p,width:a}=Oe(),d=l.useRef(),c=l.useRef(),g=(x,i)=>{if(i.dragSource.id!==void 0&&i.dropTargetId!==void 0){const w=`memo_tree/${t}/${i.dragSource.id}/parent`;D(w,i.dropTargetId)}k(x)};l.useEffect(()=>{(()=>{for(const i of s){const w=i.id;i.cnt=s.filter(n=>n.parent===w).length}k(s)})()},[s]);const C=(x,i)=>{const w=[],n=j=>{const u=i.find(v=>v.id===j);if(!u)return!1;if(u.parent&&u.parent!=="root"){if(n(u.parent))return w.push(u.parent),!0}else return!0;return!1};return n(x)?w.reverse():[]},y=x=>{if(!h||!x||!c.current)return;const i=C(x,h);i.length>0&&setTimeout(()=>{c.current.open(i)},500)};return l.useEffect(()=>{d.current===void 0&&m!==void 0&&(d.current=m,y(m))},[h]),h==null||h===""?e.jsx(I,{}):e.jsx(ye,{backend:$e,options:be(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:p-235-(f?56:0)+(a>1024?60:0),width:"100%"},children:e.jsx(Ce,{ref:c,tree:h,rootId:"root",onDrop:g,render:(x,{depth:i,isOpen:w,onToggle:n,isDragging:j,isDropTarget:u})=>e.jsxs("div",{className:`w-62 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ml-1 ${j?"opacity-50":""} ${u?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
              ${d.current===x.id?"bg-gray-200 dark:bg-gray-800 rounded-r-lg border-l-4 border-blue-500":""}
              `,style:{paddingLeft:i*20+(x.cnt===0?5:0)-(d.current===x.id?4:0)},children:[e.jsx("div",{className:"min-w-0",children:x.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:n,children:w?e.jsx(dt,{className:"size-6"}):e.jsx(ut,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{d.current=x.id,o(x)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[x.icon,x.text]}),x.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",x.cnt,")"]})]})]})})})})}const $t=s=>{const t=l.useRef(null);function m(){s.onSearchDataBtn(t.current.value)}function o(){return s.onNewMemoBtn(),!1}function h(k){k.which===13&&m()}return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:t,className:"w-full ",allClassName:"px-3 py-2",placeholder:"Enter Search...",fullWidth:!0,onKeyDownCapture:h}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(_,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:o,children:"새글"}),e.jsx(_,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:m,children:"조회"})]})]})};async function Ct(s,t,m=""){if(t==null||t==="")return"";if(s==="home"){const d=await we("home/tree");if(d!=null)try{return JSON.parse(d)}catch(c){console.error("Error parsing JSON data:",c)}}const o=s==="home"?"home_txt":m===""?`${s}_tree/${t}`:`${s}_txt/${t}`,h=he(xe(fe,o)),k=await pe(h);if(!k.exists())return console.log("getTreeData.null"),null;if(!k.exists())return console.log("getTreeData.exists"),null;const f=k.val(),p=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],a=[];s==="home"&&a.push(...p);for(const d in f){const c=f[d];c.id=d;const g={id:d,key:d,text:c.title,parent:s==="home"?c.gbn:c.parent};s==="memo"?(g.icon=c.bm==="Y"?e.jsx(Ne,{className:"text-red-500"}):c.icon==="Y"?e.jsx(mt,{}):null,g.droppable=!0):g.droppable=!1,!((m===""||m===void 0||m===null)&&(g.parent===void 0||g.parent===null||g.parent===""))&&(s==="home"||m===""||m===void 0||m===null?a.push(g):(c.id=d,(c.memo+"").toLowerCase().indexOf(m.toLowerCase())>-1&&(g.parent="root",g.droppable=!1,a.push(g))))}return a.sort((d,c)=>d.title>c.title?1:-1),s==="home"&&D("home/tree",JSON.stringify(a)),a}const Nt=l.lazy(()=>ke(()=>import("./TwMemoMain-BzYZY--C.js"),__vite__mapDeps([34,1,2,26,35]))),Io=({rootDb:s})=>{const t=q(),{user:m}=V(),o=oe(),h=l.useRef(),k=l.useRef(!0),f=l.useRef(),p=l.useRef(!1),a=l.useRef(!1);a.current=o?.state?.reflash===!0;const[d,c]=l.useState(),g=Ke({queryKey:["twTreeData",m?.uid,h.current],queryFn:()=>Ct(s,m?.uid,h.current)});g.data&&(p.current=!0);const C=()=>{const n={...d};if(n){n.bookmark=n.bookmark==="Y"?"N":"Y";const j=`memo_tree/${m.uid}/${f.current}/bm`;D(j,n.bookmark),c(n)}};l.useEffect(()=>{m&&g.refetch()},[m]),l.useEffect(()=>{const n=async v=>{if(v&&m){const T=await ct(s,m?.uid,v,h.current);s==="memo"&&(T.path=Tt(g.data,v)),T.code==="404"&&(T.title="No title"),k.current=!1,c(T||{})}},j=o.pathname.split("/"),u=j.length>2?j[j.length-1]:"";k.current=!0,n(u),f.current=u},[o.pathname,m,a.current]),l.useEffect(()=>{m&&g.refetch()},[a.current]);const y=n=>{p.current=!1,n!==void 0&&(h.current=n),g.refetch()},x=n=>{n.id!==f.current&&(k.current=!0,t(`/${s==="memo"?"m":s}/${n.id}`))},i=()=>{if(!m){alert("로그인 후 이용 가능합니다.");return}const n=`/${s==="memo"?"m":s}/insert/insert`;t(n)},w=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3 flex items-center justify-center",children:e.jsx(Ge,{to:"/m",children:s==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[s==="memo"?"":e.jsx(X,{to:"/m",children:"메모"}),s==="memo"&&m?.uid==="I3cTgdCxwjhBBno4mtZYvnODPJu1"?e.jsx(X,{to:"/home",children:"홈관리"}):null,e.jsx(X,{to:"/todo",children:"TODO"}),e.jsx(X,{to:"/tw",children:"Sheet"})]}),e.jsx($t,{onNewMemoBtn:i,onSearchDataBtn:y}),p.current&&g.isFetched?e.jsx(bt,{initTreeData:g.data,userId:m?.uid,memoId:f.current,onClick:x}):m?e.jsx(I,{}):e.jsx(e.Fragment,{})]});return e.jsxs(ze,{sideType:"memo",title:s==="memo"?"메모장":"홈페이지관리",sideContents:w,children:[e.jsx(l.Suspense,{fallback:e.jsx(I,{}),children:e.jsxs(Ve,{children:[e.jsx(z,{path:"/edit/:memoId",element:e.jsx(ge,{rootDb:s,isLoading:k.current,searchWord:h.current,memoDetailData:d})}),e.jsx(z,{path:"/insert/:memoId",element:e.jsx(ge,{rootDb:s,isLoading:k.current,searchWord:h.current,memoDetailData:d})}),e.jsx(z,{path:"/util/:memoId",element:e.jsx(yt,{rootDb:s,isLoading:k.current,searchWord:h.current,memoDetailData:d})}),e.jsx(z,{path:"/:memoId",element:e.jsx(ft,{rootDb:s,isLoading:k.current,searchWord:h.current,memoDetailData:d,onTreeUpdate:y,onBookmark:C,data:g.data})}),e.jsx(z,{path:"*",element:e.jsx(Nt,{searchWord:h.current,data:g.data,onNewMemoBtn:i,title:s==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),s==="memo"?e.jsx(ht,{onSelected:x}):"",e.jsx(Je,{})]})},Tt=(s,t)=>{let m=[],o=t;if(!s)return m;const h=k=>{const f=s.find(p=>p.id===k);return f?(m.unshift(f),f.parent):null};for(o=h(o);o&&o!=="root";)o=h(o);return m};export{Io as default};
