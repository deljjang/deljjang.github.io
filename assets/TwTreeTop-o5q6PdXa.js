const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomeChartForm-CrKT0MNu.js","assets/index-Bq2okyO2.js","assets/index-CNTHOsEM.css","assets/index-wES6wE32.js","assets/Loading-B2jgiSoZ.js","assets/Container-CEuUXhjH.js","assets/styled-DCHl2VxL.js","assets/CircularProgress-DE_ns1Ov.js","assets/right-BdMWXTWk.js","assets/DndProvider-BV4eX6zg.js","assets/createSvgIcon-CBn5T6Tm.js","assets/useControlled-D1xcdFA9.js","assets/isMuiElement-Bvb7Om-V.js","assets/fireDatabase-CYS3RlZB.js","assets/fireMemoDetail-ZMonhKoQ.js","assets/SinyDate-CHZdUciK.js","assets/Grid-WFSBEAVW.js","assets/useTheme-CX-Cb1hk.js","assets/index-BmhRCdrV.js","assets/Typography-BfnFn_Qs.js","assets/Menu-DY6WpP5T.js","assets/resolveComponentProps-B8WY-0yn.js","assets/IconButton-DHhRMkHw.js","assets/TextField-8vjJMIN2.js","assets/InputAdornment-KSIxnVbO.js","assets/Popper-BW2t4pNd.js","assets/Button-DCoXIv0f.js","assets/Chip-DFsKd4ZK.js","assets/index.esm-Dv4f8xaF.js","assets/TwButton-DnBv8mIC.js","assets/Divider-CoH0J48V.js","assets/dividerClasses-KAVeIEaH.js","assets/Favorite-DRhf5tyn.js","assets/check-circle-CRfLj93W.js","assets/TwTitleItem-CQU8MXJC.js","assets/HomeChartSemiDonut-BSoZRZ51.js","assets/HomeChartForm-DlNaLvKe.css"])))=>i.map(i=>d[i]);
import{e as Q,y as se,r as d,j as e,q as Te,bT as Le,o as Fe,b as Ie,f as Pe,C as Re,x as ue,t as ge,aF as Ee,v as Be,z as Ue,H as we,_ as _e}from"./index-Bq2okyO2.js";import{g as Me,s as _}from"./fireDatabase-CYS3RlZB.js";import{a as Ae,u as he,b as xe,F as He,f as Ye,D as je,l as qe,I as Ge,s as te,c as oe,d as ke}from"./HomeChartForm-CrKT0MNu.js";import{L as J}from"./Loading-B2jgiSoZ.js";import{a as Ve}from"./TwTitleItem-CQU8MXJC.js";import{F as ze}from"./Favorite-DRhf5tyn.js";import{S as Ke}from"./SinyImageList-CFEByq8N.js";import{L as We,H as fe}from"./HtmlCode-CcJgXMxz.js";import{c as Je}from"./CodeText-fx9oxgjL.js";import{s as ve}from"./commonUtil-BuOP-BrX.js";import{T as I}from"./TwButton-DnBv8mIC.js";import{C as Oe}from"./CircularProgress-DE_ns1Ov.js";import{u as pe}from"./useWindowDimensions-bUsLyrm4.js";import{D as Qe}from"./datetime-BDx6lZXm.js";import{u as ye}from"./index.esm-Dv4f8xaF.js";import{T as de}from"./TwCheckbox-BD-L7j_8.js";import{T as Ce}from"./TwTextArea-WjZYCG9m.js";import{T as R}from"./TwBadge-DboCGo9m.js";import"./SinyDate-CHZdUciK.js";import{T as K}from"./TwInput-C6zKzPJT.js";import{T as Ne}from"./TwSelect-2-7eLP7d.js";import{T as $e}from"./TwDatePicker-BXgrhvrE.js";import{g as W,s as De,a as Ze,b as Xe}from"./fireMemoDetail-ZMonhKoQ.js";import{I as et}from"./IpInfo-DMnSH6rM.js";function Ft({onSelected:n}){const{user:t}=Q(),N=se(),[o,y]=d.useState(),[D,T]=d.useState(),x=async r=>{const k=[],u=Te(Ie(Pe,`memo_tree/${r}`),Fe("bm"),Le("Y")),p=await Re(u);if(!p.exists())return console.log("getBookmark.getFireData.null"),null;const b=p.val();for(let h in b){const f=b[h];f.id=h,f.key=h,f.text=f.title,k.push(f)}k.sort((h,f)=>h.title>f.title?1:-1),y([...k])};return d.useEffect(()=>{t!==void 0&&t!=null&&x(t?.uid)},[t]),d.useEffect(()=>{const r=async(k,u)=>{const p=[...u];if(u)for(const b of u){let h=b;for(;h.parent!==void 0&&h.parent!=="root";){const f=h.parent;h=await Me(`memo_tree/${k}/${f}`);const c={id:h.key,text:h.title,droppable:!1,parent:h.parent};p.filter(l=>l.id===c.id).length===0&&p.push(c)}}for(const b of p){const h=b.id;b.cnt=p.filter(f=>f.parent===h).length}T(p)};o&&o.length>0&&r(t?.uid,o)},[o]),t===null?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Ve,{children:"주요 목록"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:o&&o.map((r,k)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{n(r.key),N(`/m/${r.key}`)},children:e.jsx("span",{className:"text-base",children:r.title})})},k))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-3"}),e.jsx(d.Suspense,{fallback:e.jsx(J,{}),children:e.jsx(Ae,{initTreeData:D,uid:t?.uid})})]})}const tt=n=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:`70px 70px 70px ${n.master?"70px":""}`},children:[n.master&&e.jsx(I,{size:"sm",variant:"outlined",color:"brand",onClick:n.onUtil,children:"유틸"}),e.jsx(I,{size:"sm",variant:"outlined",color:"blue",onClick:n.onEdit,children:"수정"}),e.jsx(I,{size:"sm",variant:"outlined",color:"warning",onClick:n.onNewMemo,children:"새글"}),e.jsx(I,{size:"sm",variant:"outlined",color:"error",onClick:n.onDelete,children:"삭제"})]}),It=n=>{const{rootDb:t,isLoading:N,memoDetailData:o,onBookmark:y,onTreeUpdate:D,searchWord:T}=n,[x,r]=d.useState(!1),{scrollYProgress:k}=he(),u=xe(k,{stiffness:100,damping:30,restDelta:.001}),p=se(),{memoId:b}=ue(),f=ge()?.state?.fullIndex,{user:c}=Q(),v=()=>{const j=`/${t==="memo"?"m":t}/edit/${b}`;p(j,{state:{fullIndex:f}})},l=()=>{const j=`/${t==="memo"?"m":t}/util/${b}`;p(j,{state:{fullIndex:f}})},m=()=>{const j=`/${t==="memo"?"m":t}/insert/${b}`;p(j,{state:{fullIndex:f}})},w=async()=>{const j=t==="memo"?`${t}_txt/${c.uid}/${b}`:`${t}_txt/${b}`,L=t==="memo"?`${t}_tree/${c.uid}/${b}`:`${t}/${b}`;await Ye(j,L)!==void 0&&(D(),p(`/${t==="memo"?"m":t}`))},$=()=>{r(!0)},P=()=>{r(!1),w()};return d.useEffect(()=>{o&&o.title!==void 0&&ve({title:o.title,description:o.title});function j(){window.scrollTo({top:0}),o&&o.html!=="N"&&document.querySelectorAll("pre").forEach(L=>{L.innerHTML=Je(L.innerHTML)})}o&&o.memo!==null&&(j(),o.image&&o.image.map((L,Y)=>(console.log("image."+Y+"=",L.key),L)))},[o]),N?e.jsx(J,{}):b===""||c===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(Ee.div,{className:"progress-bar",style:{scaleX:u}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:o&&o.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:y,children:o&&o.bookmark==="Y"?e.jsx(ze,{className:"text-red-500"}):e.jsx(He,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:o?.path&&o?.path.map((j,L)=>L===0?j?.text:` > ${j?.text}`)})]})]}),e.jsx(We,{isOpen:x,size:"sm",color:"warning",title:"삭제 확인",message:`하위 자료가 있는 경우 같이 삭제됩니다.
<br/>삭제하시겠습니까?`,onClose:()=>r(!1),onConfirm:()=>{P()}}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(tt,{master:c?.uid===Be,rootDb:t,onEdit:v,onUtil:l,onNewMemo:m,onDelete:$,bookmark:o&&o.bookmark}),e.jsxs("div",{className:"my-4",children:[o&&o.html==="N"?e.jsx(fe,{postData:o&&o.memo,highlightWord:T}):o&&o.html!=="N"&&o.memo&&e.jsx(Ue,{text:o.memo}),e.jsx(Ke,{imageList:o&&o.image}),!o&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Oe,{})})})]})]})]})},Se=({onSubmit:n,onCancel:t,isSubmitting:N,newMode:o=!1})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(I,{variant:"outlined",color:"success",disabled:N,onClick:y=>{y.preventDefault(),n(y)},children:[o?"새글":""," 저장"]}),e.jsx(I,{variant:"outlined",color:"error",onClick:y=>{y.preventDefault(),t()},children:"취소"})]}),ot=d.lazy(()=>_e(()=>import("./HomeChartForm-CrKT0MNu.js").then(n=>n.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36])));qe.Quill.register("modules/imageDrop",Ge);we.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const st={syntax:{highlight:n=>we.highlightAuto(n).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},at=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],nt=n=>{const[t,N]=d.useState(n.imageList),[o,y]=d.useState(n.htmlCheck==="Y"),[D,T]=d.useState(n.iconCheck==="Y"),[x,r]=d.useState(!1),[k,u]=d.useState(n.newMode?"":n.content),[p,b]=d.useState(),h=d.useRef(),f=d.useRef(),c=d.useRef(null);d.useRef(null);const v=d.useRef(null),l=n.newMode,m=d.useRef([]),{height:w}=pe(),$=Qe.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),P={edTitle:l?"":n.title,edGbn:n.gbn?n.gbn:"etc",edDate:l?$:n.date,content:l?"":n.content,memoTxt:l?"":n.content,htmlCheck:n.htmlCheck,iconCheck:n.iconCheck},{register:j,handleSubmit:L,trigger:Y,control:q,setValue:E,getValues:A,watch:ae,formState:{errors:be,isSubmitting:ne}}=ye({mode:"onChange",defaultValues:P});d.useEffect(()=>{j("edDate"),j("edGbn",{required:!0}),j("htmlCheck"),j("iconCheck"),j("memoTxt")},[]),d.useEffect(()=>{m.current=[],h.current=n.content,f.current=!1},[n.content]);const Z=async a=>{l?await n.onNewSubmit(a,m.current):await n.onPostSubmit(a,t,m.current)},le=()=>{L(Z)()},B=a=>{console.log("onDelete.imageList=",a),N(a)},M=a=>{console.log("onInsert.file",a);let g=h.current;a.ext==="jpg"||a.ext==="png"?(g+=`<img src='${a.url}'/>`,S(`<img src='${a.url}'/>
`)):a.ext==="mp4"?(g+=`<video preload="auto" controls="" src='${a.url}'></video>`,S(`<video preload="auto" controls="" src='${a.url}'></video>`)):(g+=`<a src='${a.url}'>${a.name}}</a>`,S(`다운로드
<a href="${a.url}" target="_blank">${a.name}</a>
`)),h.current=g},re=a=>n.onRename(a,A("edTitle")),ie=a=>{h.current=a},ce=a=>{console.log("handleFileUpload",a),m.current=a};function me(a){h.current=a,E("content",a),Y("content")}const O=(a,g)=>{console.log(`onChecked.e.${a}=`,g),E(a,g?"Y":"N"),console.log(`onChecked.v.${a}=`,A(a)),a==="htmlCheck"?y(g):a==="rootCheck"?r(g):T(g)},s=ae("content"),i=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],C=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],S=a=>{const g=c.current;if(g){const z=g.selectionStart,U=g.selectionEnd,H=k.slice(0,z),X=k.slice(U);u(H+a+X),E("memoTxt",H+a+X),setTimeout(()=>{g.selectionStart=g.selectionEnd=z+a.length,g.focus()},0)}},F=a=>{S(a)},G=a=>a?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(a)||a.includes("image")||a.includes("img"):!1,V=a=>new Promise((g,z)=>{const U=new Image;U.crossOrigin="anonymous",U.onload=()=>{const H=document.createElement("canvas"),X=H.getContext("2d");H.width=U.width,H.height=U.height,X.drawImage(U,0,0);try{const ee=H.toDataURL("image/png");console.log("convertImageToBase64.base64=",ee.substring(0,30)+"..."),g(ee)}catch(ee){z(ee)}},U.onerror=()=>{z(new Error("Failed to load image"))},U.src=a});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:L(Z),style:{width:"100%",minHeight:"300px",maxHeight:{height:w},display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsx(de,{id:"rootCheck",checked:x,onChange:a=>O("rootCheck",a),label:"root로 이동"}),e.jsx(de,{id:"htmlCheck",checked:o,onChange:a=>O("htmlCheck",a),label:"HTML사용"}),e.jsx(de,{id:"iconCheck",checked:D,onChange:a=>O("iconCheck",a),label:"Icon"}),e.jsx(Se,{onSubmit:a=>le(),onCancel:n.onCancel,isSubmitting:ne,newMode:l})]}),e.jsx(je,{control:q,onDelete:B,onInsert:M,onRename:re,setContent:ie,onFileUpload:ce,imageList:n.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(K,{name:"edTitle",placeholder:"제목",control:q,rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:a=>{a.preventDefault(),E("edTitle",a.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ne,{name:"edGbn",label:"구분",control:q,rules:{required:!0},placeholder:"-- 구분 --",options:i,className:"",allClassName:"max-w-40",onChange:a=>{a.preventDefault();const g=a.target.value;console.log("edGbn=",A("edGbn")),E("edGbn",g)}}),e.jsx($e,{id:"edDate",name:"edDate",placeholder:"Select a date",control:q,onChange:(a,g)=>{console.log({dates:a,currentDateString:g}),E("edDate",g)}})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(fe,{postData:k})}),e.jsxs("div",{children:[e.jsx(Ce,{ref:c,className:"",value:k,onChange:a=>{E("memoTxt",a),u(a)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>F(`<box>
</box>`),children:"<Box>"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>F('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>F('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>F('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>F('<hr style="width=100%"/>'),children:"line"}),C.map((a,g)=>e.jsx(R,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>F("<code>"+a+`
</code>`),children:a},g))]})]}),A("edUrl")&&G(A("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:p,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async a=>{try{const g=await V(p);E("edUrl2",g)}catch(g){console.error("Base64 conversion failed:",g)}},onError:a=>{a.target.style.display="none"}})})]}),o&&e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(ot,{ref:v,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:s,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:st,formats:at,onChange:me})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},Pt=n=>{const{rootDb:t,isLoading:N,memoDetailData:o}=n,{scrollYProgress:y}=he();xe(y,{stiffness:100,damping:30,restDelta:.001});const D=se(),T=d.useRef(),x=d.useRef();x.current=n.searchWord;const{memoId:r}=ue(),k=ge(),{user:u}=Q();T.current=k.pathname.split("/")[2]==="insert",console.log("memoDetailData=",o);const p=()=>{const l=`/${t==="memo"?"m":t}/${r==="insert"?"":r}`;D(l)},b=async l=>{await W(u.uid,r,l)},h=async l=>{if(console.log("onFilePathList.fileNm=",l),l.length>0)for(let m=0;m<l.length;m++){const w=l[m];console.log("onFilePathList.file=",w);try{const $=await W(u.uid,r,w);console.log("onFilePathList.path=",$)}catch{console.log("onFilePathList.error=",w)}}else await W(u.uid,r,l)},f=async(l,m)=>{console.log("onNewSubmit.values",l);const w=await te({rootDb:t,uid:u.uid,newData:T.current,key:r==="insert"?"root":r,values:l});if(await oe(`${t}_txt`,t,w,m),w!==void 0){const $=`/${t==="memo"?"m":t}/${w}`;D($,{state:{reflash:!0}})}},c=async(l,m)=>{const w=t==="memo"?`${t}/${u.uid}/`:`${t}/`,$=await De(w,l.key,m,l.ext);if($.success){const P=t==="memo"?`${t}_txt/${u.uid}/${r}/image/`:`${t}_txt/${r}/image/`;return _(P+l.key,null),l.key=$.key,l.url=$.url,l.name=$.key+"."+l.ext,_(P+$.key,l),console.log("onRename.file",l),l}},v=async(l,m,w)=>{const $=t==="memo"?`${t}_txt/${u.uid}/`:`${t}_txt/`;t==="memo"?`${t}${u.uid}`:`${t}`,await ke($,t==="memo"?`${t}/${u.uid}/`:`${t}/`,r,m),console.log("onPostSubmit.values",l);const P=await te({rootDb:t,uid:u.uid,newData:T.current,key:r==="insert"?"root":r,values:l});console.log("onPostSubmit.newKey=",P),console.log("onPostSubmit.files=",w);const j=await oe(`${$}`,t==="memo"?`${t}/${u.uid}/`:`${t}/`,r,w);console.log("onNewSubmit.imageResult",j),t==="memo"&&(_(`memo_tree/${u.uid}/${r}/title`,l.edTitle),l.rootCheck==="Y"&&_(`memo_tree/${u.uid}/${r}/parent`,"root")),T.current=!1;const L=`/${t==="memo"?"m":t}/${r}`;t==="home"&&_("home/tree",null),D(L,{state:{reflash:!0}})};return d.useEffect(()=>{o&&o.title!==void 0&&ve({title:o.title,description:o.title});function l(){document.querySelectorAll("pre").forEach((m,w)=>{})}o&&o.memo!==null&&l()},[o]),r===""||u===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",N),o===void 0||N?e.jsx(J,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:T.current===!1&&o&&(o.title===void 0||o.title===""||o.title===null)?e.jsx(J,{}):e.jsx(nt,{newMode:T.current,onPostSubmit:v,onNewSubmit:f,onCancel:p,onRename:c,onFilePath:b,onFilePathList:h,title:o?.title,gbn:o?.gbn,date:o?.date,htmlCheck:o?.html?o?.html==="Y"?"Y":"N":"Y",iconCheck:!o?.icon==="Y"?"Y":"N",content:o?.memo,imageList:o?.image})})}))},lt=n=>{const[t,N]=d.useState(n.imageList),[o,y]=d.useState(n.content),[D,T]=d.useState(),x=d.useRef(),r=d.useRef(),k=d.useRef(null),u=d.useRef([]),{height:p}=pe(),b={edTitle:n.title,edGbn:n.gbn?n.gbn:"etc",edDate:n.date,content:n.content,memoTxt:n.content,htmlCheck:"N",iconCheck:"N"},{register:h,handleSubmit:f,trigger:c,control:v,setValue:l,getValues:m,watch:w,formState:{errors:$,isSubmitting:P}}=ye({mode:"onChange",defaultValues:b});d.useEffect(()=>{h("edDate"),h("memoTxt")},[]),d.useEffect(()=>{u.current=[],x.current=n.content,r.current=!1},[n.content]);const j=async s=>{await n.onPostSubmit(s,t,u.current)},L=()=>{f(j)()},Y=s=>{console.log("onDelete.imageList=",s),N(s)},q=s=>{console.log("onInsert.file",s);let i=x.current;s.ext==="jpg"||s.ext==="png"?(i+=`<img src='${s.url}'/>`,B(`<img src='${s.url}'/>
`)):s.ext==="pdf"?(i+=`<PDF>${s.url}</PDF>`,B(`<PDF>${s.url}</PDF>`)):s.ext==="mp4"?(i+=`<video preload="auto" controls="" src='${s.url}'></video>`,B(`<video preload="auto" controls="" src='${s.url}'></video>`)):(i+=`<a src='${s.url}'>${s.name}}</a>`,B(`다운로드
<a href="${s.url}" target="_blank">${s.name}</a>
`)),x.current=i},E=s=>n.onRename(s,m("edTitle")),A=s=>{x.current=s},ae=s=>{console.log("handleFileUpload",s),u.current=s};function be(s){B(`<img src='${s}'/>`)}function ne(){console.log("HtmlEditor.imageList=",t);let s="";t&&t.length>0&&t.map((i,C)=>{s+=`<img src="/data/memo/${i.key}.${i.ext}" style="width: 50px;"/>
`}),s!==""&&B(s)}const Z=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],le=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],B=s=>{const i=k.current;if(i){const C=i.selectionStart,S=i.selectionEnd,F=o.slice(0,C),G=o.slice(S);y(F+s+G),l("memoTxt",F+s+G),setTimeout(()=>{i.selectionStart=i.selectionEnd=C+s.length,i.focus()},100)}},M=s=>{B(s)},re=s=>s?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(s)||s.includes("image")||s.includes("img"):!1,ie=async()=>{const s=await Ze("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile.result=",s)},ce=async()=>{const s=await Xe("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile10.result=",s);let i="";s.map(C=>{i+=C+`
`}),B(i)},me=async()=>{const s=m("edFilePath");if(s===""){const i=[];let C=k.current.value;C=C.replace(/<img src="\/data\/memo\//g,""),C=C.replace(/ style="width: 50px;"/g,""),C=C.replace(/"\/>/g,""),C=C.replace(/ /g,""),C.split(`
`).forEach(async S=>{S.indexOf(".")>0&&(i.push(S),console.log(S))}),i.length>0&&(console.log(i),await n.onFilePathList(i))}else await n.onFilePath(s)},O=s=>new Promise((i,C)=>{const S=new Image;S.crossOrigin="anonymous",S.onload=()=>{const F=document.createElement("canvas"),G=F.getContext("2d");F.width=S.width,F.height=S.height,G.drawImage(S,0,0);try{const V=F.toDataURL("image/png");console.log("convertImageToBase64.base64=",V.substring(0,30)+"..."),i(V)}catch(V){C(V)}},S.onerror=()=>{C(new Error("Failed to load image"))},S.src=s});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:f(j),style:{width:"100%",minHeight:"300px",maxHeight:{height:p},display:"flex",flexDirection:"column"},children:[e.jsx(Se,{onSubmit:s=>L(),onCancel:n.onCancel,isSubmitting:P}),e.jsx(je,{control:v,onDelete:Y,onInsert:q,onRename:E,setContent:A,onFileUpload:ae,imageList:n.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(K,{name:"edTitle",placeholder:"제목",control:v,className:"w-full",rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:s=>{s.preventDefault(),l("edTitle",s.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ne,{name:"edGbn",label:"구분",control:v,rules:{required:!0},placeholder:"-- 구분 --",options:Z,className:"",allClassName:"max-w-40",onChange:s=>{s.preventDefault();const i=s.target.value;console.log("edGbn=",m("edGbn")),l("edGbn",i)}}),e.jsx($e,{id:"edDate",name:"edDate",placeholder:"Select a date",control:v,onChange:(s,i)=>{console.log({dates:s,currentDateString:i}),l("edDate",i)}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{name:"edUrl",placeholder:"Base64로 만들 URL",control:v,className:"w-full",allClassName:"w-full",onChange:s=>{s.preventDefault();const i=s.target.value;console.log("edUrl=",i),l("edUrl",i),T(i)}}),e.jsx(I,{variant:"outlined",color:"success",className:"w-25 h-9",onClick:s=>{s.preventDefault(),be(m("edUrl2"))},children:"적용"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{name:"edUrl2",placeholder:"Base64 이미지 데이터",className:"w-full",allClassName:"w-full",variant:"filled",size:"md",value:m("edUrl2")||""}),e.jsx(I,{variant:"outlined",color:"success",className:"w-25 h-9",onClick:s=>{s.preventDefault(),ne()},children:"첨부추가"})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(K,{name:"edFilePath",placeholder:"이미지리스트에 추가할 파일명",className:"w-full",allClassName:"w-full",control:v,onChange:s=>{s.preventDefault();const i=s.target.value;l("edFilePath",i)}}),e.jsx(I,{size:"sm",variant:"outlined",color:"success",className:"w-25 h-9",onClick:s=>{s.preventDefault(),me()},children:"파일경로"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"outlined",color:"success",onClick:s=>{s.preventDefault(),ie()},children:"전체파일"}),e.jsx(I,{variant:"outlined",color:"success",onClick:s=>{s.preventDefault(),ce()},children:"전체파일10"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(fe,{postData:o})})}),e.jsxs("div",{children:[e.jsx(Ce,{ref:k,className:"",value:o,onChange:s=>{l("memoTxt",s),y(s)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>M(`<box>
</box>`),children:"<Box>"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>M('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>M('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>M('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>M('<hr style="width=100%"/>'),children:"line"}),le.map((s,i)=>e.jsx(R,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>M("<code>"+s+`
</code>`),children:s},i))]})]}),m("edUrl")&&re(m("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:D,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async s=>{try{const i=await O(D);l("edUrl2",i)}catch(i){console.error("Base64 conversion failed:",i)}},onError:s=>{s.target.style.display="none"}})})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},Rt=n=>{const{rootDb:t,isLoading:N,memoDetailData:o}=n,{scrollYProgress:y}=he();xe(y,{stiffness:100,damping:30,restDelta:.001});const D=se(),T=d.useRef();T.current=n.searchWord;const{memoId:x}=ue();ge();const{user:r}=Q();console.log("memoDetailData=",o);const k=()=>{const c=`/${t==="memo"?"m":t}/${x==="insert"?"":x}`;D(c)},u=async c=>{await W(r.uid,x,c)},p=async c=>{if(console.log("onFilePathList.fileNm=",c),c.length>0)for(let v=0;v<c.length;v++){const l=c[v];console.log("onFilePathList.file=",l);try{const m=await W(r.uid,x,l);console.log("onFilePathList.path=",m)}catch{console.log("onFilePathList.error=",l)}}else await W(r.uid,x,c)},b=async(c,v)=>{console.log("onNewSubmit.values",c);const l=await te({rootDb:t,uid:r.uid,newData:!1,key:x,values:c});if(await oe(`${t}_txt`,t,l,v),l!==void 0){const m=`/${t==="memo"?"m":t}/${l}`;D(m,{state:{reflash:!0}})}},h=async(c,v)=>{const l=t==="memo"?`${t}/${r.uid}/`:`${t}/`,m=await De(l,c.key,v,c.ext);if(m.success){const w=t==="memo"?`${t}_txt/${r.uid}/${x}/image/`:`${t}_txt/${x}/image/`;return _(w+c.key,null),c.key=m.key,c.url=m.url,c.name=m.key+"."+c.ext,_(w+m.key,c),console.log("onRename.file",c),c}},f=async(c,v,l)=>{const m=t==="memo"?`${t}_txt/${r.uid}/`:`${t}_txt/`;t==="memo"?`${t}${r.uid}`:`${t}`,await ke(m,t==="memo"?`${t}/${r.uid}/`:`${t}/`,x,v),console.log("onPostSubmit.values",c);const w=await te({rootDb:t,uid:r.uid,newData:!1,key:x==="insert"?"root":x,values:c});console.log("onPostSubmit.newKey=",w),console.log("onPostSubmit.files=",l);const $=await oe(`${m}`,t==="memo"?`${t}/${r.uid}/`:`${t}/`,x,l);console.log("onNewSubmit.imageResult",$),t==="memo"&&_(`memo_tree/${r.uid}/${x}/title`,c.edTitle);const P=`/${t==="memo"?"m":t}/${x}`;t==="home"&&_("home/tree",null),D(P,{state:{reflash:!0}})};return d.useEffect(()=>{o&&o.title!==void 0&&ve({title:o.title,description:o.title});function c(){document.querySelectorAll("pre").forEach((v,l)=>{})}o&&o.memo!==null&&c()},[o]),x===""||r===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",N),o===void 0||N?e.jsx(J,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:o&&(o.title===void 0||o.title===""||o.title===null)?e.jsx(J,{}):e.jsx(lt,{onPostSubmit:f,onNewSubmit:b,onCancel:k,onRename:h,onFilePath:u,onFilePathList:p,title:o?.title,gbn:o?.gbn,date:o?.date,htmlCheck:o?.html?o?.html==="Y"?"Y":"N":"Y",iconCheck:!o?.icon==="Y"?"Y":"N",content:o?.memo,imageList:o?.image})})}))},Et=({data:n,onNewMemoBtn:t,title:N,rootDb:o})=>{const{user:y}=Q();return e.jsx("div",{className:"justify-items-center space-y-6",children:e.jsxs("div",{className:"text-center mt-5 mb-7 p-8 bg-white dark:bg-gray-900 rounded-xl shadow-lg",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-3",children:N}),e.jsxs("div",{className:"grid gird-cols-1 md:grid-cols-5 items-center gap-3",children:[y===null?e.jsx("p",{className:"text-red-500 font-semibold text-lg text-left md:col-span-3",children:"로그인해야 이용 가능합니다."}):e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-left md:col-span-3",children:["좌측 사이드 메뉴에서 '새글' 버튼을 사용해 메모를 작성하거나, ",e.jsx("br",{}),"기존 메모를 선택하여 확인하세요."]}),e.jsx("div",{className:"w-full items-center justify-center md:col-span-2",children:e.jsx(et,{})})]})]})})},Bt=n=>{const t=d.useRef(null);function N(){n.onSearchDataBtn(t.current.value)}function o(){return n.onNewMemoBtn(),!1}function y(D){D.which===13&&N()}return e.jsxs(e.Fragment,{children:[e.jsx(K,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:t,className:"w-full ",allClassName:"px-3 py-2",placeholder:"Enter Search...",fullWidth:!0,onKeyDownCapture:y}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(I,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:o,children:"새글"}),e.jsx(I,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:D=>N(),children:"조회"})]})]})};export{Bt as T,Pt as a,Rt as b,It as c,Et as d,Ft as e};
