const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DDcfrIrO.js","assets/index-DJRzwKtZ.js","assets/index-Cj4RT9E7.css","assets/createSvgIcon-Cv-mY9Mn.js","assets/useControlled-DlXemOZM.js","assets/ownerWindow-DvT1GKkC.js","assets/isMuiElement-BS5huZNu.js","assets/fireDatabase-ZLuG_CUe.js","assets/fireStorage-CrrVYCxn.js","assets/SinyDate-BiSBT4hh.js","assets/Grid-CzIggGSM.js","assets/useTheme-CzoYZslH.js","assets/index-IMAKV9xk.js","assets/index-Chjiymov.js","assets/Menu-_Lz2OwGS.js","assets/useSlotProps-Dol2lYr2.js","assets/resolveComponentProps-C2YMIMU0.js","assets/utils-FOjFRgzZ.js","assets/IconButton-DNVNS5x2.js","assets/TextField-BVtkrz7Z.js","assets/InputAdornment-Coh0BlIi.js","assets/Popper-Auo9oIct.js","assets/Button-BvHEjv_M.js","assets/Chip-CLBEy6Qd.js","assets/index.esm-HMsTMje0.js","assets/TwButton-G2eQbQwV.js","assets/Loading-fOI9ILhK.js","assets/Container-kmCQ6Q6N.js","assets/styled-B_GLhfSf.js","assets/CircularProgress-DlXv06BI.js","assets/Divider-BmyTAB4F.js","assets/dividerClasses-CE4nnZvi.js","assets/index-Cmdt2tIm.css","assets/MemoMain-DP0cHfAW.js"])))=>i.map(i=>d[i]);
import{r as u,q as te,e as $e,o as Le,a as oe,f as ne,b as Ne,u as _,j as e,c as G,T as Re,d as E,g as Ee,m as Q,h as Be,s as ie,B as T,i as se,k as q,l as We,H as _e,n as Fe,p as A,t as le,_ as ae,L as P,v as Pe,w as He,x as Ye,R as Oe,y as H}from"./index-DJRzwKtZ.js";import{u as Ge}from"./useSuspenseQuery-BMucWF7Z.js";import{L as B}from"./Loading-fOI9ILhK.js";import{D as Ae,g as qe,S as ze,T as Ve,H as re}from"./HtmlCode-CInata_M.js";import{g as Ke,a as Ue,s as Je,b as Qe,c as Xe}from"./fireDatabase-ZLuG_CUe.js";import{E as z,C as V}from"./ExpandMore-r9ca8Egu.js";import{D as L}from"./Divider-BmyTAB4F.js";import{L as Ze}from"./Link-Cy0xilnH.js";import{T as O}from"./TwButton-G2eQbQwV.js";import{I as et,T as tt}from"./TextField-BVtkrz7Z.js";import{T as ot}from"./Footer-DkCTTVxv.js";import{u as ce,a as de,F as nt,f as it,b as st,D as lt,l as at,I as rt,c as X,d as Z,e as ct,T as dt}from"./index-DDcfrIrO.js";import{T as me,a as ue,t as M}from"./TreeView-CQkKNR5k.js";import{F as mt}from"./Favorite-CUlbnYts.js";import{A as R}from"./AniButton-DvslaN_A.js";import{M as ut}from"./Menu-_Lz2OwGS.js";import{S as xt}from"./SinyImageList-i0R-lYQT.js";import{c as ft}from"./CodeText-Dat7EcKf.js";import{s as xe}from"./commonUtil-B0F3HKqD.js";import{I as ht}from"./IconButton-DNVNS5x2.js";import{C as gt}from"./CircularProgress-DlXv06BI.js";import{D as pt}from"./datetime-BDx6lZXm.js";import{u as bt}from"./index.esm-HMsTMje0.js";import{S as jt}from"./SinyDate-BiSBT4hh.js";import{S as vt}from"./SinySelect-CwVPnqlN.js";import{C as kt}from"./Checkbox-TwP3nEAB.js";import{T as yt}from"./TextArea-vgw2oGp-.js";import{T as Y}from"./TwBadge-D4-FOZnr.js";import{f as It}from"./fireMemoDetail-qOQafGhn.js";import"./useBaseQuery-CHzRW9EN.js";import"./Container-kmCQ6Q6N.js";import"./styled-B_GLhfSf.js";import"./copy-CO-mNU8v.js";import"./toPropertyKey-DCwh5dYN.js";import"./createSvgIcon-Cv-mY9Mn.js";import"./useControlled-DlXemOZM.js";import"./ownerWindow-DvT1GKkC.js";import"./isMuiElement-BS5huZNu.js";import"./dividerClasses-CE4nnZvi.js";import"./resolveComponentProps-C2YMIMU0.js";import"./fireStorage-CrrVYCxn.js";import"./Collapse-CPJb5J2O.js";import"./utils-FOjFRgzZ.js";import"./useTheme-CzoYZslH.js";import"./useSlotProps-Dol2lYr2.js";import"./Button-BvHEjv_M.js";import"./index-Chjiymov.js";import"./ImageListItem-CjRw2EIj.js";import"./Grid-CzIggGSM.js";import"./index-IMAKV9xk.js";import"./InputAdornment-Coh0BlIi.js";import"./Popper-Auo9oIct.js";import"./Chip-CLBEy6Qd.js";import"./MenuItem-DVD16vS5.js";const wt=t=>{const[n,s]=u.useState([]),o=()=>{const a=te(oe(ne,`memo_txt/${t}`),Le("bookmark"),$e("Y"));Ne(a,i=>{if(!i.exists())return;const m=i.val(),l=[];for(let r in m){const d=m[r];d.key=r,l.push(d)}l.sort((r,d)=>r.title>d.title?1:-1),s(l)})};return u.useEffect(()=>{o()},[t]),n};function Dt({initTreeData:t,uid:n}){const[s,o]=u.useState(),a=l=>o(l),i=_();if(u.useEffect(()=>{(async()=>{const r=[];if(t)for(const d of t){const c=d.fullIndex.split("/");let f="root";if(c.length>1)for(let D=0;D<c.length;D++){const p=c[D];if(p!=="sub"&&c.length>D){const k=await Ke(`memo_txt/${n}/${p}/title`),w={id:p,text:k,droppable:!1,parent:f};f=p,r.filter(y=>y.id===p).length===0&&r.push(w)}}const g={id:d.key,text:d.title,droppable:!1,parent:f};r.filter(D=>D.id===g.id).length===0&&r.push(g)}for(const d of r){const c=d.id;d.cnt=r.filter(f=>f.parent===c).length}o(r)})()},[t]),s==null||s.length===0)return e.jsx(B,{});const m=l=>{console.log("node",l),i(`/memo/${l.id}`)};return e.jsx(Ae,{backend:ze,options:qe(),children:e.jsx(Ve,{tree:s,rootId:"root",onDrop:a,render:(l,{depth:r,isOpen:d,onToggle:c})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:r*20+(l.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[l.cnt>0&&e.jsx("div",{onClick:c,children:d?e.jsx(z,{}):e.jsx(V,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>m(l),children:l.text})]}),l.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",l.cnt,")"]})]})})})}function St(t){const{user:n}=G(),s=_(),o=wt(n?.uid);return n===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center",sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"100%"},children:[e.jsx(L,{}),e.jsx(Re,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:o&&o.map((a,i)=>e.jsx("div",{children:e.jsx(Ze,{component:"button",variant:"body",onClick:()=>{t.onSelected(a.key),s(`/memo/${a.key}`)},children:e.jsx(E,{variant:"body1",children:a.title})})},i))}),e.jsx(L,{}),e.jsx(Dt,{initTreeData:o,uid:n?.uid})]})}const Ct=t=>{const n=u.useRef(null);function s(){t.onSearchDataBtn(n.current.value)}function o(){return t.onNewMemoBtn(),!1}function a(i){i.which===13&&s()}return e.jsxs(e.Fragment,{children:[e.jsx(et,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:n,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:a}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(O,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:o,children:"새글"}),e.jsx(O,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:s,children:"조회"})]})]})};async function Tt(t,n,s=""){if(n==null||n==="")return"";let o=s===""?`${t}/${n}`:`${t}_txt/${n}`;t==="home"&&(o="home_txt");const a=te(oe(ne,o)),i=await Ee(a);if(!i.exists())return console.log("getTreeData.null"),null;if(!i.exists())return console.log("getTreeData.exists"),null;const m=i.val(),l=[],r={};t==="home"&&(Q.map(d=>{l.push({title:d.label,id:d.id,sub:[]})}),Q.map(d=>{r[d.id]=[]}));for(const d in m){const c=m[d];c.up===void 0?(c.id=d,c.fullIndex=d):(c.id=c.up,c.fullIndex=c.up),t==="home"?c.gbn!==void 0&&r[c.gbn].push(c):s===""||s===void 0?(c.sub!==null&&(c.children=fe(c,c.up)),l.push(c)):(c.id=d,(c.memo+"").toLowerCase().indexOf(s.toLowerCase())>-1&&l.push(c))}return t==="home"?Object.values(r).map((d,c)=>{d.sort((f,g)=>f.title>g.title?1:-1),l[c].sub=d}):l.sort((d,c)=>d.title>c.title?1:-1),l}function fe(t,n,s,o){const a=[];if(console.log("dbChildren.data=",t.id,t.title,t),t===void 0||t.sub===void 0)return a;for(let i in t.sub){let m=t.sub[i];m.id=i,m.key=i}return Object.values(t.sub).sort((i,m)=>m.title-i.title).map(i=>{i.id=i.key,i.fullIndex=n+"/sub/"+i.key,i.sub!==null&&(i.children=fe(i,i.fullIndex)),a.push(i)}),a}const Mt=ie(ue)(({theme:t})=>({color:t.palette.text.secondary,[`& .${M.content}`]:{color:t.palette.text.secondary,borderTopRightRadius:t.spacing(2),borderBottomRightRadius:t.spacing(2),paddingRight:t.spacing(1),fontWeight:t.typography.fontWeightMedium,"&.MuiTreeItem-content":{paddingLeft:"3px",paddingRight:"3px"},".MuiTreeItem-label":{paddingLeft:"0px"},".MuiTreeItem-iconContainer":{marginRight:"0px"},"&.Mui-expanded":{fontWeight:t.typography.fontWeightRegular},"&:hover":{backgroundColor:t.palette.action.hover},"&.Mui-selected":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},[`& .${M.label}`]:{fontWeight:"inherit",color:"inherit"}},[`& .${M.group}`]:{marginLeft:0,[`& .${M.content}`]:{paddingLeft:t.spacing(1)}}})),$t=u.forwardRef(function(n,s){const{labelIcon:o,labelInfo:a,labelText:i,pl:m,...l}=n;return e.jsx(Mt,{label:e.jsxs(T,{sx:{display:"flex",alignItems:"center",p:.5,pr:2,pl:{pl:m}},children:[e.jsx(T,{component:o,color:"inherit",sx:{mr:1,pl:{pl:m}}}),e.jsx(E,{sx:{fontWeight:"inherit",flexGrow:1},component:"div",children:i}),e.jsx(E,{variant:"caption",color:"inherit",children:a})]}),...l,ref:s})}),he=t=>{const{id:n,fullIndex:s,title:o,sub:a}=t.item;if(n===void 0)return console.log("SubTreeItem.item.undefined=",t.item),e.jsx(e.Fragment,{});const i=a&&Object.values(a).length>0?Object.values(a).length+"":"";return e.jsx($t,{onClick:()=>t.onDetail(n,s),nodeId:n,labelText:o,labelInfo:i,pl:t.pl,children:a!=null?Object.values(a).sort((m,l)=>m.title>l.title?1:-1).map((m,l)=>e.jsx("div",{style:{paddingLeft:t.pl+5},children:e.jsx(he,{onDetail:t.onDetail,item:m,pl:t.pl+5})},l+"")):""})};function Lt(t){const[n,s]=u.useState([]),[o,a]=u.useState([]),{isMoble:i,height:m,width:l}=Be(),r=(f,g)=>{t.onDetail(f,g)};u.useEffect(()=>{if(t.expandIndex!==void 0){let f=t.expandIndex.split("/");f=f.filter(g=>g!=="sub"),t.expandIndex.indexOf("undefined")<0&&(s(f),a(f[f.length-1]))}},[t.expandIndex]);const d=(f,g)=>{},c=(f,g)=>{s(g)};return e.jsx("div",{style:{height:m-220-(i?56:0)+(l>1024?60:0),width:"100%",overflowY:"auto",overflowX:"hidden"},children:e.jsx(me,{"aria-label":"icon expansion",defaultCollapseIcon:e.jsx(z,{}),defaultExpandIcon:e.jsx(V,{}),expanded:n,onNodeSelect:d,selected:o,onNodeToggle:c,sx:{flexGrow:1},children:t.data&&t.data.map((f,g)=>e.jsx(he,{onDetail:r,item:f,parentIndex:g+1,pl:5},g+1))})})}const Nt=ie(ue)(({theme:t})=>({color:t.palette.text.secondary,[`& .${M.content}`]:{color:t.palette.text.secondary,borderTopRightRadius:t.spacing(2),borderBottomRightRadius:t.spacing(2),paddingRight:t.spacing(1),fontWeight:t.typography.fontWeightMedium,"&.MuiTreeItem-content":{paddingLeft:"3px",paddingRight:"3px"},".MuiTreeItem-label":{paddingLeft:"0px"},".MuiTreeItem-iconContainer":{marginRight:"0px"},"&.Mui-expanded":{fontWeight:t.typography.fontWeightRegular},"&:hover":{backgroundColor:t.palette.action.hover},"&.Mui-selected":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},[`& .${M.label}`]:{fontWeight:"inherit",color:"inherit"}},[`& .${M.group}`]:{marginLeft:0,[`& .${M.content}`]:{paddingLeft:t.spacing(1)}}})),Rt=u.forwardRef(function(n,s){const{labelIcon:o,labelInfo:a,labelText:i,pl:m,...l}=n;return e.jsx(Nt,{label:e.jsxs(T,{sx:{display:"flex",alignItems:"center",p:.5,pr:2,pl:{pl:m}},children:[e.jsx(T,{component:o,color:"inherit",sx:{mr:1,pl:{pl:m}}}),e.jsx(E,{sx:{fontWeight:"inherit",flexGrow:1},component:"div",children:i}),e.jsx(E,{variant:"caption",color:"inherit",children:a})]}),...l,ref:s})}),ge=t=>{const{id:n,fullIndex:s,title:o,sub:a}=t.item;if(n===void 0)return console.log("SubTreeItem.item.undefined=",t.item),e.jsx(e.Fragment,{});const i=a&&Object.values(a).length>0?Object.values(a).length+"":"";return e.jsx(Rt,{onClick:()=>t.onDetail(n,s),nodeId:n,labelText:o,labelInfo:i,pl:t.pl,children:a!=null?Object.values(a).sort((m,l)=>m.title>l.title?1:-1).map((m,l)=>e.jsx("div",{style:{paddingLeft:t.pl+5},children:e.jsx(ge,{onDetail:t.onDetail,item:m,pl:t.pl+5})},l+"")):""})};function Et(t){const[n,s]=u.useState([]),[o,a]=u.useState([]),i=(r,d)=>{t.onDetail(r,d)};u.useEffect(()=>{if(t.expandIndex!==void 0){let r=t.expandIndex.split("/");r=r.filter(d=>d!=="sub"),t.expandIndex.indexOf("undefined")<0&&(s(r),a(r[r.length-1]))}},[t.expandIndex]);const m=(r,d)=>{},l=(r,d)=>{s(d)};return e.jsx(T,{sx:{minHeight:180,flexGrow:1,display:"flex",flexDirection:"column",height:t.maxHeight,overflow:"hidden",overflowY:"auto",width:"100%"},children:e.jsx(me,{"aria-label":"icon expansion",defaultCollapseIcon:e.jsx(z,{}),defaultExpandIcon:e.jsx(V,{}),expanded:n,onNodeSelect:m,selected:o,onNodeToggle:l,sx:{flexGrow:1,overflow:"hidden",overflowY:"auto"},children:t.data&&t.data.map((r,d)=>e.jsx(ge,{onDetail:i,item:r,parentIndex:d+1,pl:5},d+1))})})}const Bt={position:"absolute",top:"50%",left:"50%",display:"flex",flexDirection:"column",alignItems:"center",transform:"translate(-50%, -50%)",width:250,maxHeight:"400px",bgcolor:"background.paper",border:"1px solid #000",boxShadow:24,boxSizing:"border-box",p:4},Wt=t=>e.jsxs(T,{sx:{my:2,mt:3,display:"flex"},children:[e.jsx(R,{type:"submit",variant:"outlined",color:"success",onClick:t.onPost,children:"확인"}),e.jsx(R,{type:"button",variant:"outlined",onClick:t.onClose,children:"취소"})]}),_t=t=>{const[n,s]=u.useState(t.open),[o,a]=u.useState(),i=()=>{s(!1),a(void 0),t.onClose()};u.useEffect(()=>{s(t.open)},[t.open]);const m=r=>{a(r)},l=()=>{if(o===void 0){alert("이동할 메모장을 선택해 주세요");return}t.onPost(o)};return e.jsx("div",{children:e.jsx(ut,{open:n,onClose:i,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(T,{sx:Bt,children:[e.jsx(E,{id:"modal-modal-title",variant:"h6",component:"h2",children:"이동할 메모장 선택"}),e.jsx(L,{}),e.jsx(T,{sx:{width:"100%",minHeight:110,maxHeight:200,flexGrow:1,minWidth:100,overflow:"hidden"},children:e.jsx(Et,{data:t.data,onDetail:m,maxHeight:200})}),e.jsx(Wt,{onPost:l,onClose:i})]})})})},Ft=t=>e.jsxs(T,{sx:{flexGrow:1,my:2,width:"100%",display:"grid",gridTemplateColumns:"64px 64px  64px  64px ",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:[e.jsx(R,{type:"button",size:"small",variant:"outlined",color:"success",onClick:t.onEdit,children:"수정"}),e.jsx(R,{type:"button",size:"small",variant:"outlined",onClick:t.onNewMemo,children:"새글"}),t.rootDb==="memo"?e.jsx(R,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:t.onMove,children:"이동"}):"",e.jsx(R,{type:"button",size:"small",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"})]}),Pt=t=>{const{rootDb:n,isLoading:s,memoDetailData:o}=t;console.log("MemoDetail.memoDetailData.title=",o?.title,", bookmark=",o?.bookmark);const{scrollYProgress:a}=ce(),i=de(a,{stiffness:100,damping:30,restDelta:.001}),[m,l]=u.useState(!1),r=_(),d=u.useRef();d.current=t.searchWord;const{memoId:c}=se(),g=q()?.state?.fullIndex,{user:b}=G(),D=()=>{const j=`/${n}/edit/${c}`;r(j,{state:{fullIndex:g}})},p=()=>{const j=`/${n}/insert/${c}`;r(j,{state:{fullIndex:g}})},k=async()=>{const j=n==="memo"?`${n}_txt/${b.uid}/${c}`:`${n}_txt/${c}`,I=n==="memo"?`${n}/${b.uid}`:n;if(await st(j,I)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}t.onTreeUpdate(),r(`/${n}`)},w=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&k()},S=()=>{l(!0)},y=()=>{t.onBookmark()},h=async j=>{try{const I=n==="memo"?`${n}_txt/${b.uid}`:`${n}_txt`,C=n==="memo"?`memo/${b.uid}`:n,$=await it(I,C,c,j);t.onTreeUpdate()}catch(I){console.log("catch",I)}finally{l(!1)}};return u.useEffect(()=>{o&&o.title!==void 0&&xe({title:o.title,description:o.title});function j(){window.scrollTo({top:0}),o&&o.html!=="N"&&document.querySelectorAll("pre").forEach(I=>{I.innerHTML=ft(I.innerHTML)})}o&&o.memo!==null&&j()},[o]),s?e.jsx(B,{}):c===""||b===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(We.div,{className:"progress-bar",style:{scaleX:i}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:o&&o.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx(ht,{"aria-label":"bookmark",onClick:y,children:o&&o.bookmark==="Y"?e.jsx(mt,{sx:{color:"red"}}):e.jsx(nt,{})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:t.pathNm})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(Ft,{rootDb:n,onEdit:D,onNewMemo:p,onMove:S,onDelete:w,onBookmark:y,bookmark:o&&o.bookmark}),e.jsxs(T,{sx:{my:2},children:[o&&o.html==="N"?e.jsx(re,{postData:o&&o.memo}):o&&o.html!=="N"&&o.memo&&e.jsx(_e,{text:o.memo}),e.jsx(xt,{imageList:o&&o.image}),!o&&e.jsx(T,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx(gt,{sx:{mt:5}})})]}),e.jsx(_t,{userId:b?.uid,open:m,data:t.data,onClose:()=>l(!1),onPost:h})]})]})},Ht=({onSubmit:t,onCancel:n,isSubmitting:s,newMode:o})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(O,{variant:"outlined",color:"success",disabled:s,onClick:a=>{a.preventDefault(),t(a)},children:[o?"새글":""," 저장"]}),e.jsx(O,{variant:"outlined",color:"error",onClick:n,children:"취소"})]}),Yt=u.lazy(()=>ae(()=>import("./index-DDcfrIrO.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32])));at.Quill.register("modules/imageDrop",rt);le.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const Ot={syntax:{highlight:t=>le.highlightAuto(t).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},Gt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],At=t=>{const[n,s]=u.useState(t.imageList),[o,a]=u.useState(t.htmlCheck==="Y"),[i,m]=u.useState(t.newMode?"":t.content),l=u.useRef(),r=u.useRef(),d=u.useRef(null),c=u.useRef(null),f=t.newMode,g=u.useRef([]),{height:b}=Fe(),D=pt.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),p={edTitle:f?"":t.title,edGbn:t.gbn?t.gbn:"etc",edDate:f?D:t.date,content:f?"":t.content,memoTxt:f?"":t.content,htmlCheck:t.htmlCheck},{register:k,handleSubmit:w,trigger:S,control:y,setValue:h,getValues:j,watch:I,formState:{errors:C,isSubmitting:$}}=bt({mode:"onChange",defaultValues:p});u.useEffect(()=>{k("edDate",{required:!0,minLength:10}),k("edGbn",{required:!0}),k("htmlCheck"),k("memoTxt")},[]),u.useEffect(()=>{g.current=[],l.current=t.content,r.current=!1},[t.content]);const W=async x=>{f?await t.onNewSubmit(x,g.current):await t.onPostSubmit(x,n,g.current)},N=()=>{w(W)()},be=x=>{console.log("onDelete.imageList=",x),s(x)},je=x=>{let v=l.current;x.ext==="jpg"?v+=`<img src='${x.url}'/>`:x.ext==="mp4"&&(v+=`<video preload="auto" controls="" src='${x.url}'></video>`),l.current=v},ve=x=>{l.current=x},ke=x=>{console.log("handleFileUpload",x),g.current=x};function ye(x){l.current=x,h("content",x),S("content")}function Ie(x){console.log("handleChangeDate=",x);let v=A(x);v.format("YYYY-MM-DD HH:mm:ss"),console.log("handleChangeDate.dayjs=",v.format("YYYY-MM-DD HH:mm:ss")),h("edDate",v.format("YYYY-MM-DD")),S("edDate")}const we=x=>{console.log("onChecked=",x),h("htmlCheck",x?"Y":"N"),a(x)},De=I("content"),Se=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Ce=["React","JavaScript","Bash","Java","Kotlin","CSS","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],Te=x=>{const v=d.current;if(v){const K=v.selectionStart,Me=v.selectionEnd,U=i.slice(0,K),J=i.slice(Me);m(U+x+J),h("memoTxt",U+x+J),setTimeout(()=>{v.selectionStart=v.selectionEnd=K+x.length,v.focus()},0)}},F=x=>{Te(x)};return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:w(W),style:{width:"100%",minHeight:"300px",maxHeight:{height:b},display:"flex",flexDirection:"column"},children:[e.jsx(Ht,{onSubmit:x=>N(),onCancel:t.onCancel,isSubmitting:$,newMode:f}),e.jsx(lt,{control:y,onDelete:be,onInsert:je,setContent:ve,onFileUpload:ke,imageList:t.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx(tt,{...k("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!C.edTitle}),e.jsx(vt,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:y,defaultValue:j("edGbn"),selectList:Se,error:!!C.edGbn,onChange:x=>{x.preventDefault();const v=x.target.value;console.log("edGbn=",j("edGbn")),h("edGbn",v)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(jt,{id:"edDate",label:"일자",mdSize:6,value:A(j("edDate")),...k("edDate"),defaultValue:A(j("edDate")),onChange:Ie}),e.jsx(kt,{id:"html",checked:o,onChange:we,label:"HTML사용"})]})]}),e.jsx(L,{}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-130 overflow-y-scroll",children:e.jsx(re,{postData:i})}),e.jsxs("div",{children:[e.jsx(yt,{ref:d,className:"",value:i,onChange:x=>{h("memoTxt",x),m(x)},rows:22}),e.jsx(L,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(Y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>F("<box></box>"),children:"<Box>"}),e.jsx(Y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>F("</code>"),children:"</code>"}),Ce.map((x,v)=>e.jsx(Y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>F("<code>"+x+"</code>"),children:x},v)),e.jsx(Y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>F('<a href="" target="_blank"></a>'),children:"Link"})]}),e.jsx(L,{})]})]}),e.jsx(u.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(Yt,{ref:c,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:De,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:Ot,formats:Gt,onChange:ye})}),e.jsx(L,{})]})})},ee=t=>{const{rootDb:n,isLoading:s,memoDetailData:o}=t,{scrollYProgress:a}=ce();de(a,{stiffness:100,damping:30,restDelta:.001});const i=_(),m=u.useRef(),l=u.useRef();l.current=t.searchWord;const{memoId:r}=se(),d=q(),c=o?.fullIndex,{user:f}=G();m.current=d.pathname.split("/")[2]==="insert",console.log("MemoDetailEdit.memoDetailData=",o?.title),console.log("MemoDetailEdit.newMode=",m.current);const g=()=>{const p=`/${n}/${r==="insert"?"":r}`;i(p,{state:{fullIndex:c}})},b=async(p,k)=>{console.log("onNewSubmit.values",p),console.log("onNewSubmit.fullIndex",c);const w=n==="memo"?`${n}_txt/${f.uid}/`:`${n}_txt/`,S=n==="memo"?`${n}/${f.uid}/`:`${n}/`;console.log("onNewSubmit.txtLocate",w),console.log("onNewSubmit.locate",S);const y=await X(void 0,w,S,c,p);if(await Z(`${n}_txt`,n,y,k),y!==void 0){const h=`/${n}/${y}`;i(h,{state:{reflash:!0}})}},D=async(p,k,w)=>{const S=n==="memo"?`${n}_txt/${f.uid}`:`${n}_txt`,y=n==="memo"?`${n}/${f.uid}`:n;await ct(S,y,r,k),console.log("onPostSubmit.values",p);const h=await X(m.current?void 0:r,`${S}/`,`${y}/`,c,p);console.log("onPostSubmit.newKey=",h),console.log("onPostSubmit.files=",w);const j=await Z(`${S}/`,`${y}/`,r,w);if(console.log("onNewSubmit.imageResult",j),console.log("onPostSubmit.fullIndex",c),n==="memo"&&c===void 0){const C=await Ue(f.uid,`${r}/fullIndex`);console.log("onPostSubmit.fullPath",C),C!==void 0&&Je(`memo/${f.uid}/${C}/title`,p.edTitle)}m.current=!1;const I=`/${n}/${r}`;i(I,{state:{fullIndex:c,reflash:!0}})};return u.useEffect(()=>{o&&o.title!==void 0&&xe({title:o.title,description:o.title});function p(){document.querySelectorAll("pre").forEach((k,w)=>{})}o&&o.memo!==null&&p()},[o]),r===""||f===void 0?e.jsx(e.Fragment,{}):(console.log("MemoDetailEdit.isLoading=",s),o===void 0||s?e.jsx(B,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:m.current===!1&&o&&(o.title===void 0||o.title===""||o.title===null)?e.jsx(B,{}):e.jsx(At,{newMode:m.current,onPostSubmit:D,onNewSubmit:b,onCancel:g,title:o?.title,gbn:o?.gbn,date:o?.date,htmlCheck:o?.html?o?.html:"Y",content:o?.memo,imageList:o?.image})})}))},qt=u.lazy(async()=>await ae(()=>import("./MemoMain-DP0cHfAW.js"),__vite__mapDeps([33,1,2,25]))),zt=({rootDb:t})=>{const n=_(),{user:s}=G(),o=u.useRef(),a=u.useRef(),i=u.useRef(!0),m=u.useRef(),l=u.useRef(),[r,d]=u.useState(),c=u.useRef(!1),f=q(),g=u.useRef(!1);g.current=f?.state?.reflash===!0;const b=Ge({queryKey:["treeMemo",s?.uid,o.current],queryFn:()=>Tt(t,s?.uid,o.current)});b.data!==void 0&&b.data!==""&&!c.current&&(c.current=!0);const D=()=>{const h=r;h&&(h.bookmark=h.bookmark==="Y"?"N":"Y"),Xe(s.uid,l.current,r.bookmark),d({...r,bookmark:h.bookmark})};u.useEffect(()=>{s!==void 0&&s!=null&&b.refetch()},[s]),u.useEffect(()=>{const h=async C=>{if(C!==""&&s){const $=await It(t,s?.uid,C,o.current);{const W=pe(b.data,{id:"",nm:""},C),N=W.id;a.current=W.nm,$.fullIndex=N,N!==m&&(m.current=N,Qe(s.uid,C,N))}$.bookmark===void 0&&($.bookmark="N"),d($),i.current=!1}},j=f.pathname.split("/"),I=j.length>2?j[j.length-1]:"";i.current=!0,h(I),l.current=I},[f.pathname,s]),u.useEffect(()=>{s!==void 0&&s!=null&&b.refetch()},[g.current]);const p=h=>{c.current=!1,h!==void 0&&(o.current=h),b.refetch()},k=(h,j)=>{if(h===l.current)return;i.current=!0;const I=`/${t}/${h}`;n(I,{state:{fullIndex:m.current}})},w=()=>{if(s==null){alert("로그인 후 이용 가능합니다.");return}const h=`/${t}/insert/insert`;n(h)},S=h=>{},y=e.jsxs("div",{className:"",children:[e.jsx(dt,{className:"mt-3 ",children:t==="memo"?"메모장":"홈페이지관리"}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[e.jsx(P,{to:"/",children:"홈"}),t==="memo"?"":e.jsx(P,{to:"/memo",children:"메모"}),e.jsx(P,{to:"/todo",children:"TODO"}),e.jsx(P,{to:"/tw",children:"Sheet"})]}),e.jsx(Ct,{onNewMemoBtn:w,onSearchDataBtn:p}),c.current&&b.isFetched?e.jsx(Lt,{expandIndex:m.current,data:b.data,onDetail:k}):e.jsx(B,{})]});return s&&s.uid===Pe&&He,e.jsxs(Ye,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:y,children:[e.jsx(u.Suspense,{fallback:e.jsx(B,{}),children:e.jsxs(Oe,{children:[e.jsx(H,{path:"/edit/:memoId",element:e.jsx(ee,{rootDb:t,isLoading:i.current,searchWord:o.current,memoDetailData:r})}),e.jsx(H,{path:"/insert/:memoId",element:e.jsx(ee,{rootDb:t,isLoading:i.current,searchWord:o.current,memoDetailData:r})}),e.jsx(H,{path:"/:memoId",element:e.jsx(Pt,{rootDb:t,isLoading:i.current,searchWord:o.current,memoDetailData:r,onTreeUpdate:p,pathNm:a.current,onBookmark:D,data:b.data})}),e.jsx(H,{path:"*",element:e.jsx(qt,{searchWord:o.current,data:b.data,onNewMemoBtn:w,title:t==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),t==="memo"?e.jsx(St,{onSelected:S}):"",e.jsx(ot,{})]})},pe=(t,n,s)=>{let o={};if(t)for(let a=0;a<t.length;a++){const i=t[a];if(i.id===s)return o.id=n.id+i.id,o.nm=n.nm+i.title,o;if(i.sub!==null&&i.sub!==void 0){if(o.id=n.id+i.id+"/sub/",o.nm=n.nm+i.title+" > ",o=pe(Object.values(i.sub),o,s),o.id&&o.id.endsWith(s))return o;o={}}}return o},Ko=()=>e.jsx(zt,{rootDb:"memo"});export{Ko as default};
