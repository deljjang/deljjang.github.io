import{j as e,i as S,z as J,r as n,C as O,D as Q,A as V,K as ee,T as te,F as oe,H as se,S as ne,W as ae,y as X,N as ie,X as re,O as Y,n as k,t as P,P as ce,E as le,R as me,V as K,Y as de,Z as ue,$ as xe,a0 as fe,a1 as he,a2 as z,a3 as ge}from"./index-C6qQzj93.js";import{M as we,a as pe}from"./MemoMoveModal-Bp_dCVsp.js";import{L as je}from"./LoginDisplay-C3AqWsRm.js";import{H as q,f as A,a as G,b as Me,c as ye,d as De,g as be}from"./fireDetail-BXhsY33X.js";import{u as Se,S as Ie}from"./useTreeData-B9nFmo6N.js";import{C as ve}from"./CommonLayout-C-TGue9f.js";import{MemoMain as He}from"./MemoMain-BowOht87.js";import{A as C}from"./AniButton-ChngYaBu.js";import{c as $e}from"./CodeText-BX8_9mBs.js";import"./TextField-B8WPLf9N.js";import"./Button-D6Ete9Yx.js";import"./SinyDate-CPxfe00Y.js";import"./InputAdornment-f5y3mn9X.js";import"./Popper-D1ahJpI4.js";import"./Chip-BH6zRfnW.js";import"./index.esm-aVFiiBfF.js";import"./datetime-BDx6lZXm.js";import"./useSuspenseQuery-C3AJQOX2.js";import"./useBaseQuery-DxghvTCq.js";import"./Collapse-RbwpYdDf.js";const Ne=a=>e.jsxs(S,{sx:{flexGrow:1,my:2,width:"100%",display:"flex",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"center",textAlign:"center"},children:[e.jsx(C,{type:"button",size:"small",variant:"outlined",color:"success",onClick:a.onEdit,children:"수정"}),e.jsx(C,{type:"button",size:"small",variant:"outlined",onClick:a.onNewMemo,children:"새글"}),e.jsx(C,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:a.onMove,children:"이동"}),e.jsx(C,{type:"button",size:"small",variant:"outlined",color:"error",onClick:a.onDelete,children:"삭제"})]}),Te=a=>{const{title:u,gbn:l,date:p,text:m,image:h,setFireId:L,isLoading:j,onReload:I}=J(),[g,r]=n.useState(!1),[E,M]=n.useState(!1),y=O(),i=n.useRef(),v=n.useRef();v.current=a.searchWord;const{homeId:t}=Q(),o=`${l.current}/sub/${t}`;console.log("HomeMngDetail.fullIndex=",o);const{user:c}=V(),{settings:w,saveSettings:x}=ee(),R=()=>{i.current=!1,j===!1&&r(!0)},F=()=>{i.current=!0,j===!1&&r(!0)},D=async()=>{console.log("handleDelete.homeId=",t);const s=`home_txt/${t}`,d=await De(s,"home");if(console.log("handleDelete.result=",d),d===void 0){alert("삭제에 실패했습니다.[code:d02]");return}y("/homemng")},b=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&D()},H=()=>{r(!1)},W=()=>{M(!0)},$=async s=>{try{const N=await ye("home",l.current,t,s);console.log("onMoveSubmit.result=",N)}catch{}finally{M(!1)}},B=async(s,d)=>{const f=await A(void 0,"home_txt/","home/",s.edGbn,s);console.log("onNewSubmit.newKey=",f,", homeId=",t);const T=await G("home_txt","home",f,d);console.log("onNewSubmit.imageResult",T),f!==void 0&&y(`/homemng/${f}`),i.current=!1,r(!1),I()},U=async(s,d,N)=>{const _="home_txt",f="home";if(await Me(_,f,t,d),await A(t,"home_txt/","home/",o,s),await G("home_txt","home",t,N),o===void 0){const T=await re(`${f}fullIndex`);T!==void 0&&await Y(k(P,`home/${T}/title`),s.edTitle)}i.current=!1,r(!1),I()};n.useEffect(()=>{x({...w,nodeId:t}),r(!1),L(`home_txt/${t}`,`home/${t}`,v.current)},[t,c]);function Z(){document.querySelectorAll("pre").forEach(s=>{s.innerHTML=$e(s.innerHTML)})}return n.useEffect(()=>{m!==null&&Z()},[m]),t===""||c===void 0?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(te,{children:u.current}),e.jsx(n.Suspense,{fallback:e.jsx(X,{}),children:e.jsxs(oe,{className:"container",sx:{p:0,width:"100%"},children:[!g&&e.jsx(Ne,{onEdit:R,onNewMemo:F,onMove:W,onDelete:b}),g&&e.jsx(q,{newMode:i.current,onPostSubmit:U,onNewSubmit:B,onCancel:H,title:u.current,gbn:l.current,date:p.current,content:m,imageList:h}),e.jsxs(S,{sx:{my:2,overflow:"hidden",overflowX:"auto"},children:[l.current,e.jsx(se,{show:!g,text:m}),!g&&e.jsx(ne,{imageList:h}),j&&e.jsx(S,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx(ae,{sx:{mt:5}})})]}),e.jsx(we,{userId:c.uid,open:E,data:a.data,onClose:()=>M(!1),onPost:$})]})}),e.jsx(ie,{})]})},Ce=320,Je=()=>{const a=O(),{user:u}=V(),[l,p]=n.useState(!1),m=n.useRef(),[h]=Se("home"),[L,j]=n.useState(""),I=n.useRef();n.useEffect(()=>{},[u]);const g=(o,c)=>{I.current=c,j(o),a(`/homemng/${o}`,{state:{fullIndex:c}})},r=()=>{p(!0)},E=o=>{m.current=o},M=()=>{p(!1)},y=async(o,c)=>{const w=`home_txt/${u.uid}/`;for(let D=0;D<c.length;D++){const b=c[D].object,H=be(b.name),W={ext:H,name:b.name,use:"Y"},$=de(ue(k(P),w+"image")).key;Y(k(P,w+`image/${$}`),W);const B=await xe(ge,`home/${L}/${$}.${H}`);await fe(B,b)}const x=he(w),R={title:o.edTitle,date:o.edDate,gbn:o.edGbn,memo:o.content,fullIndex:x,up:x,bookmark:"N"};z(`${w}${x}`,R);const F={gbn:"",property:"m",title:o.title,up:x};z(`home/${x}`,F),p(!1)},{height:i,width:v}=ce();if(!u)return e.jsx(e.Fragment,{});u.uid!==le&&a("/");const t=e.jsxs(S,{sx:{minHeight:110,flexGrow:1,minWidth:100,maxHeight:i},children:[e.jsx(je,{}),e.jsx(pe,{onNewMemoBtn:r,onSearchDataBtn:E}),e.jsx(S,{sx:{flexGrow:1,minWidth:100,minHeight:110,maxHeight:i-220,height:i-220},children:e.jsx(n.Suspense,{fallback:e.jsx(X,{}),children:e.jsx(Ie,{data:h,onDetail:g,maxHeight:i-150})})})]});return e.jsxs(ve,{title:"홈 관리",drawerWidth:Ce,width:v,sideContents:t,children:[e.jsxs(me,{children:[e.jsx(K,{path:"/",element:e.jsx(He,{searchWord:m.current,data:h,onNewMemoBtn:r,title:"홈페이지 관리"})}),e.jsx(K,{path:"/:homeId",element:e.jsx(Te,{searchWord:m.current,data:h})})]}),l&&e.jsx(q,{show:l,newMode:l.current,onPostSubmit:y,onNewSubmit:y,onCancel:M,title:"",content:"",imageList:[]})]})};export{Je as default};
