import{y as N,e as B,r as n,t as E,j as e,v as S,T as W,g as $,h as p}from"./index-Bq2okyO2.js";import{u as C}from"./useSuspenseQuery-BpwhCoLO.js";import{T as O}from"./Footer-Lko9pIeR.js";import{b as U,T as h}from"./TwLinkItem-B8UrJan3.js";import{L as y}from"./Loading-B2jgiSoZ.js";import{s as q}from"./fireDatabase-CYS3RlZB.js";import{T as H,a as L,b as K,c as Q,d as Y,e as _}from"./TwTreeTop-o5q6PdXa.js";import{g as D,T as z,H as A}from"./HomeChartForm-CrKT0MNu.js";import{f as G}from"./fireMemoDetail-ZMonhKoQ.js";import"./useBaseQuery-BXiiY0J8.js";import"./LinkItem-DmovyF0G.js";import"./Typography-BfnFn_Qs.js";import"./Divider-CoH0J48V.js";import"./dividerClasses-KAVeIEaH.js";import"./Link-DErjXeoJ.js";import"./Container-CEuUXhjH.js";import"./styled-DCHl2VxL.js";import"./CircularProgress-DE_ns1Ov.js";import"./TwTitleItem-CQU8MXJC.js";import"./Favorite-DRhf5tyn.js";import"./createSvgIcon-CBn5T6Tm.js";import"./useControlled-D1xcdFA9.js";import"./isMuiElement-Bvb7Om-V.js";import"./SinyImageList-CFEByq8N.js";import"./ImageListItem-DlZmjzGn.js";import"./HtmlCode-CcJgXMxz.js";/* empty css                 */import"./copy-B2H1mvTf.js";import"./TwBadge-DboCGo9m.js";import"./index-wES6wE32.js";import"./DndProvider-BV4eX6zg.js";import"./TwButton-DnBv8mIC.js";import"./ComponentCard-BPcemxZ9.js";import"./TwRadio-DMUnqq83.js";import"./toPropertyKey-DCwh5dYN.js";import"./TwInput-C6zKzPJT.js";import"./CodeText-fx9oxgjL.js";import"./commonUtil-BuOP-BrX.js";import"./useWindowDimensions-bUsLyrm4.js";import"./datetime-BDx6lZXm.js";import"./index.esm-Dv4f8xaF.js";import"./TwCheckbox-BD-L7j_8.js";import"./TwTextArea-WjZYCG9m.js";import"./SinyDate-CHZdUciK.js";import"./Grid-WFSBEAVW.js";import"./useTheme-CX-Cb1hk.js";import"./index-BmhRCdrV.js";import"./Menu-DY6WpP5T.js";import"./resolveComponentProps-B8WY-0yn.js";import"./IconButton-DHhRMkHw.js";import"./TextField-8vjJMIN2.js";import"./InputAdornment-KSIxnVbO.js";import"./Popper-BW2t4pNd.js";import"./Button-DCoXIv0f.js";import"./Chip-DFsKd4ZK.js";import"./TwSelect-2-7eLP7d.js";import"./TwDatePicker-BXgrhvrE.js";import"./IpInfo-DMnSH6rM.js";import"./right-BdMWXTWk.js";import"./check-circle-CRfLj93W.js";import"./HomeChartSemiDonut-BSoZRZ51.js";const rt=({rootDb:t})=>{const d=N(),{user:r}=B(),o=n.useRef(),a=n.useRef(!0),m=n.useRef(),[c,x]=n.useState(),f=n.useRef(!1),j=E(),k=n.useRef(!1);k.current=j?.state?.reflash===!0;const s=C({queryKey:["twTreeData",r?.uid,o.current],queryFn:()=>D(t,r?.uid,o.current)});s.data!==void 0&&s.data!==""&&!f.current&&(f.current=!0);const M=()=>{const i=c;i&&(i.bookmark=i.bookmark==="Y"?"N":"Y"),console.log("onBookmark.memoDetailData.bookmark=",i.bookmark),console.log("onBookmark.rootDb=",t);const u=t==="memo"?`memo_tree/${r.uid}/${m.current}/bm`:`home_txt/${m.current}/bookmark`;q(u,c.bookmark),x({...c,bookmark:i.bookmark})};n.useEffect(()=>{r!==void 0&&r!=null&&s.refetch()},[r]),n.useEffect(()=>{const i=async T=>{if(T!==""&&r){const l=await G(t,r?.uid,T,o.current);t==="memo"&&(l.path=J(s.data,T)),l.code==="404"&&(l.title="No title"),a.current=!1,x(l===void 0?{}:l)}else x({})},u=j.pathname.split("/"),v=u.length>2?u[u.length-1]:"";a.current=!0,m.current=v,i(v)},[j.pathname,r,k.current]),n.useEffect(()=>{r!==void 0&&r!=null&&s.refetch()},[k.current]);const g=i=>{f.current=!1,i!==void 0&&(o.current=i),s.refetch()},I=i=>{i.id!==m.current&&(a.current=!0,d(`/${t==="memo"?"m":t}/${i.id}`))},w=()=>{if(r==null){alert("로그인 후 이용 가능합니다.");return}const i=`/${t==="memo"?"m":t}/insert/insert`;d(i)},F=i=>{},R=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3 flex items-center justify-center",children:e.jsx(U,{to:t==="memo"?"/m":"/home",children:t==="memo"?"메모장":"홈관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[t==="memo"?"":e.jsx(h,{to:"/m",children:"메모"}),t==="memo"&&r?.uid===S?e.jsx(h,{to:"/home",children:"홈관리"}):null,e.jsx(h,{to:"/todo",children:"TODO"}),e.jsx(h,{to:"/tw",children:"Sheet"})]}),r!==null&&e.jsx(H,{onNewMemoBtn:w,onSearchDataBtn:g}),f.current&&s.isFetched?e.jsx(z,{initTreeData:s.data,userId:r?.uid,memoId:m.current,onClick:I}):r===null?e.jsx(e.Fragment,{}):e.jsx(y,{})]});return e.jsxs(W,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:R,children:[e.jsx(n.Suspense,{fallback:e.jsx(y,{}),children:e.jsxs($,{children:[e.jsx(p,{path:"/edit/:memoId",element:e.jsx(L,{rootDb:t,isLoading:a.current,searchWord:o.current,memoDetailData:c})}),e.jsx(p,{path:"/insert/:memoId",element:e.jsx(L,{rootDb:t,isLoading:a.current,searchWord:o.current,memoDetailData:c})}),e.jsx(p,{path:"/util/:memoId",element:e.jsx(K,{rootDb:t,isLoading:a.current,searchWord:o.current,memoDetailData:c})}),e.jsx(p,{path:"/:memoId",element:e.jsx(Q,{rootDb:t,isLoading:a.current,searchWord:o.current,memoDetailData:c,onTreeUpdate:g,onBookmark:M,data:s.data})}),e.jsx(p,{path:"*",element:e.jsx(Y,{searchWord:o.current,data:s.data,onNewMemoBtn:w,title:t==="memo"?"메모장":"홈페이지관리",rootDb:t})})]})}),t==="memo"?e.jsx(_,{onSelected:F}):null,m.current===""?e.jsx(A,{data:s.data}):null,e.jsx(O,{})]})},J=(t,d)=>{let r=[],o=d;if(!t)return r;const a=t.find(m=>m.id===o);for(r.unshift(a),o=a?.parent;o!=null&&o!==""&&o!=="root";){const m=t.find(c=>c.id===o);o=m?.parent,r.unshift(m)}return r};export{rt as default};
