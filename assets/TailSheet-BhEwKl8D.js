import{j as s,r as u,ag as se,cm as B,av as ne,aw as oe,a9 as re,ac as le,a5 as d,ad as ae,a4 as x,an as ie,ao as ce,a6 as f,q as ue,aJ as de}from"./index-D1g6WeXe.js";import{I as fe,T as O}from"./InputField-BNobTA0u.js";import{H as me,r as he}from"./registry-877_O3Ya.js";import{S as ge}from"./Select-Ct88H8jJ.js";import{n as xe}from"./handson-CS9Rir92.js";import{T as j}from"./TailButton-BZr8PMJj.js";const ye=i=>s.jsxs("div",{className:"my-2 flex justify-end items-center",sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[s.jsx(j,{size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:i.onInsert,children:"추가"}),s.jsx(j,{type:"button",size:"sm",variant:"outlined",color:"error",className:"mr-2",onClick:i.onDelete,children:"삭제"}),s.jsx(j,{type:"button",size:"sm",variant:"outlined",color:"success",className:"mr-2",onClick:i.onReload,children:"리로드"}),s.jsx(j,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:i.onCsvSave,children:"csv저장"})]});he();const ve=({csvFileName:i="exported_sheet",baseUrl:h="sheet",columns:y,selectDefault:D="1",keyId:V,userId:v})=>{const c=u.useRef(null),C=u.useRef(null),[R,K]=u.useState(),[M,S]=u.useState(0),{height:F,width:N}=se(),k=u.useRef(!1),{settings:E,changeColWidths:b}=B();ne.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:A,reset:pe,control:P,setValue:$,getValues:I,formState:{errors:L}}=oe({mode:"submit "}),{theme:q}=B(),G=q==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",U=async e=>{const t=`${h}/${v}/`;if(e.id===void 0||e.id===null||e.id===""){const n=ie(ce(d(f),t)).key;e.id=n}return x(d(f,t+e.id+"/dv"),e.dv),x(d(f,t+e.id+"/title"),e.title),x(d(f,t+e.id+"/t1"),e.t1),x(d(f,t+e.id+"/t2"),e.t2),x(d(f,t+e.id+"/ing"),"1"),e},J=async()=>{const e=`${h}/${v}/`,t=re(d(f,e),le("dv"));ae(t,n=>{if(!n.exists())return;const r=n.val(),l=[];for(let a in r){const o=r[a];o.id=a,o.sort=`${o.dv}_${o.title}`,l.push(o)}l.sort((a,o)=>a.sort>o.sort?1:-1),K(l),S(l.length)})};u.useEffect(()=>{A("filterField1"),$("columns1",D)},[]),u.useEffect(()=>{v!==void 0&&J()},[v]),u.useEffect(()=>{N<500&&k.current===!1&&(k.current=!0,b([100,100,100,100,100,100]))},[N]),u.useEffect(()=>{c.current.hotInstance.addHook("afterColumnResize",function(t,n){const r=E.colWidths;try{r[n]=t,b(r)}catch{b([130,300,100,100,100,100])}})},[c.current]);const Z=async()=>{H()},Q=async()=>{c.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:i,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},T=[],W={indicators:!0},z=[];y.map((e,t)=>{e.select&&T.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&z.push(t)}),W.columns=z;const H=()=>{try{const e=c.current?.hotInstance,t=e?.getPlugin("filters");if(t){const n=I("columns1");console.log("onKeyUp.columns1=",n,"text=",I("filterField1")),y.forEach((a,o)=>{t?.removeConditions(o)}),t?.addCondition(Number(n),"contains",[I("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",c.current);const l=e.getData().length;S(l)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function X(){c.current.hotInstance.alter("insert_row_above",0,1)}const Y=async(e,t)=>{if(e===null)return;const n=c.current?.hotInstance,r=n?.getPlugin("filters");if(r==null)return;const l=n.getData(),a={};e.forEach(async(m,p)=>{a[m[0]]=m[0]}),console.log("afterChange.lines=",a);const o=[];Object.keys(a).map(m=>{const p=a[m];console.log("afterChange.lines.key=",m,", lines=",p);const w={};y.forEach(async(g,te)=>{w[g.data]=l[p][te]}),o.push(w)}),console.log("afterChange.saveData=",o),o.forEach(async(m,p)=>{const w=await U(m);console.log("afterChange.result=",p,", result=",w),R.map(g=>{(g.id===void 0||g.id===null)&&(g.id=w?.id,console.log("afterChange.rowData2=",g))})}),n.render()},ee=async()=>{const e=c.current.hotInstance;if(e&&C.current!==null){if(e?.getPlugin("filters")){const r=e.getData()[C.current][V];window.confirm("삭제하시겠습니까?")&&x(d(f,`${h}/${v}/${r}`),null)}e.alter("remove_row",C.current,1)}},_=e=>{const t=e.target.value;$(e.target.name,t)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[s.jsx(ge,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:P,className:"dark:bg-dark-900",defaultValue:D||"1",options:T,error:!!L.columns1,onChange:_}),s.jsx(fe,{name:"filterField1",control:P,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",onKeyUp:H,onChange:_})]}),s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[s.jsx(O,{textAlign:"left",children:"건수 : "+xe(M)}),s.jsx(ye,{onInsert:X,onDelete:ee,onReload:Z,onCsvSave:Q})]}),s.jsx("div",{className:"grid grid-cols-1",style:{maxHeight:`${F} - 210`,overflow:"auto"},children:s.jsx(me,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:c,data:R,themeName:G,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:F-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:Y,afterSelection:e=>{C.current=e},columns:y,cells:(e,t)=>y[t].readOnly===!0?{readOnly:!0}:{},colWidths:E.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:W,licenseKey:"non-commercial-and-evaluation"})})]})};function Re(){const{user:i}=ue(),h=[{title:"구분",data:"dv",readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"설명1",type:"text",data:"t1",select:!0},{title:"설명2",type:"text",data:"t2",select:!0},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];return i===void 0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:s.jsx(O,{children:"로그인을 해야 이용 가능합니다."})}):s.jsxs(s.Fragment,{children:[s.jsx(ve,{csvFileName:"exported_sheet",baseUrl:"sheet",columns:h,selectDefault:"1",keyId:h.length-1,userId:i?.uid}),s.jsx(de,{})]})}export{Re as default};
