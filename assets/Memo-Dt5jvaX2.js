const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DhfptILa.js","assets/index-BH1tI84G.js","assets/index-BeUX8CFf.css","assets/createSvgIcon-96mSyWZs.js","assets/useControlled-DauyLZuE.js","assets/ownerWindow-DvT1GKkC.js","assets/isMuiElement-BiVUYafV.js","assets/fireDatabase-CC-X6seW.js","assets/fireStorage-DOdsAQzx.js","assets/SinyDate-8iaBBJGk.js","assets/Grid-D4lU8LoG.js","assets/useTheme-BDGva-Z0.js","assets/index-Dolzkns3.js","assets/index-Chjiymov.js","assets/Menu-CaiGhL9X.js","assets/useSlotProps-DXJeNroY.js","assets/resolveComponentProps-BokKTWWp.js","assets/utils-CTQNJy8e.js","assets/IconButton-CUm6OPPq.js","assets/TextField-CnVQwGIJ.js","assets/InputAdornment-46OfskLB.js","assets/Popper-BuVO-dEd.js","assets/Button-ZhHB92lW.js","assets/Chip-C7eZZHyU.js","assets/index.esm-C_o8p0A_.js","assets/TwButton-BOOygRYx.js","assets/Loading-gw_dSdSE.js","assets/Container-BQdTcffS.js","assets/styled-BBEArGbq.js","assets/CircularProgress-DOqzH0BJ.js","assets/Divider-CX7F09o-.js","assets/dividerClasses-B3rRPCnK.js","assets/index-Cmdt2tIm.css","assets/MemoMain-nJM9xr-P.js"])))=>i.map(i=>d[i]);
import{r as u,q as te,e as $e,o as Le,a as oe,f as ne,b as Ne,u as _,j as e,c as G,T as Re,d as E,g as Ee,m as Q,h as Be,s as ie,B as C,i as se,k as q,l as We,H as _e,n as Fe,p as A,t as le,_ as ae,L as P,v as Pe,w as He,x as Ye,R as Oe,y as H}from"./index-BH1tI84G.js";import{u as Ge}from"./useSuspenseQuery-D21SUTF3.js";import{L as B}from"./Loading-gw_dSdSE.js";import{D as Ae,g as qe,S as ze,T as Ve,H as re}from"./HtmlCode-D-KUAvUI.js";import{g as Ke,a as Ue,s as Je,b as Qe,c as Xe}from"./fireDatabase-CC-X6seW.js";import{E as z,C as V}from"./ExpandMore-DzjNlXN7.js";import{D as L}from"./Divider-CX7F09o-.js";import{L as Ze}from"./Link-CLMIBZY1.js";import{T as O}from"./TwButton-BOOygRYx.js";import{T as et}from"./Footer-BzCdt4xI.js";import{u as ce,a as de,F as tt,f as ot,b as nt,D as it,l as st,I as lt,c as X,d as Z,e as at,T as rt}from"./index-DhfptILa.js";import{T as me,a as ue,t as M}from"./TreeView-CrYYHx2C.js";import{F as ct}from"./Favorite-DHOVkVlW.js";import{A as R}from"./AniButton-C7GeuW7R.js";import{M as dt}from"./Menu-CaiGhL9X.js";import{S as mt}from"./SinyImageList-Bmk_mwsK.js";import{c as ut}from"./CodeText-DNJ79K4X.js";import{s as xe}from"./commonUtil-BpBg--lF.js";import{I as xt}from"./IconButton-CUm6OPPq.js";import{C as ft}from"./CircularProgress-DOqzH0BJ.js";import{D as ht}from"./datetime-BDx6lZXm.js";import{u as gt}from"./index.esm-C_o8p0A_.js";import{S as pt}from"./SinyDate-8iaBBJGk.js";import{S as bt}from"./SinySelect-Dhi476gH.js";import{T as Y}from"./TwBadge-BV58sdkb.js";import{T as jt}from"./TwCheckbox-ksynRcXQ.js";import{T as vt}from"./TwTextArea-DOtTbUEn.js";import{T as kt}from"./TextField-CnVQwGIJ.js";import{f as yt}from"./fireMemoDetail-C4WoUemN.js";import"./useBaseQuery-C8l4AgkW.js";import"./Container-BQdTcffS.js";import"./styled-BBEArGbq.js";import"./copy-BUFC5U-2.js";import"./toPropertyKey-DCwh5dYN.js";import"./createSvgIcon-96mSyWZs.js";import"./useControlled-DauyLZuE.js";import"./ownerWindow-DvT1GKkC.js";import"./isMuiElement-BiVUYafV.js";import"./dividerClasses-B3rRPCnK.js";import"./fireStorage-DOdsAQzx.js";import"./Collapse-DCY9ttTo.js";import"./utils-CTQNJy8e.js";import"./useTheme-BDGva-Z0.js";import"./useSlotProps-DXJeNroY.js";import"./resolveComponentProps-BokKTWWp.js";import"./Button-ZhHB92lW.js";import"./index-Chjiymov.js";import"./ImageListItem-nOIlUe3p.js";import"./Grid-D4lU8LoG.js";import"./index-Dolzkns3.js";import"./InputAdornment-46OfskLB.js";import"./Popper-BuVO-dEd.js";import"./Chip-C7eZZHyU.js";import"./MenuItem-CP8YMQQq.js";const wt=t=>{const[n,s]=u.useState([]),o=()=>{const a=te(oe(ne,`memo_txt/${t}`),Le("bookmark"),$e("Y"));Ne(a,i=>{if(!i.exists())return;const m=i.val(),l=[];for(let r in m){const d=m[r];d.key=r,l.push(d)}l.sort((r,d)=>r.title>d.title?1:-1),s(l)})};return u.useEffect(()=>{o()},[t]),n};function It({initTreeData:t,uid:n}){const[s,o]=u.useState(),a=l=>o(l),i=_();if(u.useEffect(()=>{(async()=>{const r=[];if(t)for(const d of t){const c=d.fullIndex.split("/");let f="root";if(c.length>1)for(let D=0;D<c.length;D++){const p=c[D];if(p!=="sub"&&c.length>D){const k=await Ke(`memo_txt/${n}/${p}/title`),I={id:p,text:k,droppable:!1,parent:f};f=p,r.filter(y=>y.id===p).length===0&&r.push(I)}}const g={id:d.key,text:d.title,droppable:!1,parent:f};r.filter(D=>D.id===g.id).length===0&&r.push(g)}for(const d of r){const c=d.id;d.cnt=r.filter(f=>f.parent===c).length}o(r)})()},[t]),s==null||s.length===0)return e.jsx(B,{});const m=l=>{console.log("node",l),i(`/memo/${l.id}`)};return e.jsx(Ae,{backend:ze,options:qe(),children:e.jsx(Ve,{tree:s,rootId:"root",onDrop:a,render:(l,{depth:r,isOpen:d,onToggle:c})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:r*20+(l.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[l.cnt>0&&e.jsx("div",{onClick:c,children:d?e.jsx(z,{}):e.jsx(V,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>m(l),children:l.text})]}),l.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",l.cnt,")"]})]})})})}function Dt(t){const{user:n}=G(),s=_(),o=wt(n?.uid);return n===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center",sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"100%"},children:[e.jsx(L,{}),e.jsx(Re,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:o&&o.map((a,i)=>e.jsx("div",{children:e.jsx(Ze,{component:"button",variant:"body",onClick:()=>{t.onSelected(a.key),s(`/memo/${a.key}`)},children:e.jsx(E,{variant:"body1",children:a.title})})},i))}),e.jsx(L,{}),e.jsx(It,{initTreeData:o,uid:n?.uid})]})}const St=t=>{const n=u.useRef(null);function s(){t.onSearchDataBtn(n.current.value)}function o(){return t.onNewMemoBtn(),!1}function a(i){i.which===13&&s()}return e.jsxs(e.Fragment,{children:[e.jsx(TwInput,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:n,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:a}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(O,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:o,children:"새글"}),e.jsx(O,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:s,children:"조회"})]})]})};async function Tt(t,n,s=""){if(n==null||n==="")return"";let o=s===""?`${t}/${n}`:`${t}_txt/${n}`;t==="home"&&(o="home_txt");const a=te(oe(ne,o)),i=await Ee(a);if(!i.exists())return console.log("getTreeData.null"),null;if(!i.exists())return console.log("getTreeData.exists"),null;const m=i.val(),l=[],r={};t==="home"&&(Q.map(d=>{l.push({title:d.label,id:d.id,sub:[]})}),Q.map(d=>{r[d.id]=[]}));for(const d in m){const c=m[d];c.up===void 0?(c.id=d,c.fullIndex=d):(c.id=c.up,c.fullIndex=c.up),t==="home"?c.gbn!==void 0&&r[c.gbn].push(c):s===""||s===void 0?(c.sub!==null&&(c.children=fe(c,c.up)),l.push(c)):(c.id=d,(c.memo+"").toLowerCase().indexOf(s.toLowerCase())>-1&&l.push(c))}return t==="home"?Object.values(r).map((d,c)=>{d.sort((f,g)=>f.title>g.title?1:-1),l[c].sub=d}):l.sort((d,c)=>d.title>c.title?1:-1),l}function fe(t,n,s,o){const a=[];if(console.log("dbChildren.data=",t.id,t.title,t),t===void 0||t.sub===void 0)return a;for(let i in t.sub){let m=t.sub[i];m.id=i,m.key=i}return Object.values(t.sub).sort((i,m)=>m.title-i.title).map(i=>{i.id=i.key,i.fullIndex=n+"/sub/"+i.key,i.sub!==null&&(i.children=fe(i,i.fullIndex)),a.push(i)}),a}const Ct=ie(ue)(({theme:t})=>({color:t.palette.text.secondary,[`& .${M.content}`]:{color:t.palette.text.secondary,borderTopRightRadius:t.spacing(2),borderBottomRightRadius:t.spacing(2),paddingRight:t.spacing(1),fontWeight:t.typography.fontWeightMedium,"&.MuiTreeItem-content":{paddingLeft:"3px",paddingRight:"3px"},".MuiTreeItem-label":{paddingLeft:"0px"},".MuiTreeItem-iconContainer":{marginRight:"0px"},"&.Mui-expanded":{fontWeight:t.typography.fontWeightRegular},"&:hover":{backgroundColor:t.palette.action.hover},"&.Mui-selected":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},[`& .${M.label}`]:{fontWeight:"inherit",color:"inherit"}},[`& .${M.group}`]:{marginLeft:0,[`& .${M.content}`]:{paddingLeft:t.spacing(1)}}})),Mt=u.forwardRef(function(n,s){const{labelIcon:o,labelInfo:a,labelText:i,pl:m,...l}=n;return e.jsx(Ct,{label:e.jsxs(C,{sx:{display:"flex",alignItems:"center",p:.5,pr:2,pl:{pl:m}},children:[e.jsx(C,{component:o,color:"inherit",sx:{mr:1,pl:{pl:m}}}),e.jsx(E,{sx:{fontWeight:"inherit",flexGrow:1},component:"div",children:i}),e.jsx(E,{variant:"caption",color:"inherit",children:a})]}),...l,ref:s})}),he=t=>{const{id:n,fullIndex:s,title:o,sub:a}=t.item;if(n===void 0)return console.log("SubTreeItem.item.undefined=",t.item),e.jsx(e.Fragment,{});const i=a&&Object.values(a).length>0?Object.values(a).length+"":"";return e.jsx(Mt,{onClick:()=>t.onDetail(n,s),nodeId:n,labelText:o,labelInfo:i,pl:t.pl,children:a!=null?Object.values(a).sort((m,l)=>m.title>l.title?1:-1).map((m,l)=>e.jsx("div",{style:{paddingLeft:t.pl+5},children:e.jsx(he,{onDetail:t.onDetail,item:m,pl:t.pl+5})},l+"")):""})};function $t(t){const[n,s]=u.useState([]),[o,a]=u.useState([]),{isMoble:i,height:m,width:l}=Be(),r=(f,g)=>{t.onDetail(f,g)};u.useEffect(()=>{if(t.expandIndex!==void 0){let f=t.expandIndex.split("/");f=f.filter(g=>g!=="sub"),t.expandIndex.indexOf("undefined")<0&&(s(f),a(f[f.length-1]))}},[t.expandIndex]);const d=(f,g)=>{},c=(f,g)=>{s(g)};return e.jsx("div",{style:{height:m-220-(i?56:0)+(l>1024?60:0),width:"100%",overflowY:"auto",overflowX:"hidden"},children:e.jsx(me,{"aria-label":"icon expansion",defaultCollapseIcon:e.jsx(z,{}),defaultExpandIcon:e.jsx(V,{}),expanded:n,onNodeSelect:d,selected:o,onNodeToggle:c,sx:{flexGrow:1},children:t.data&&t.data.map((f,g)=>e.jsx(he,{onDetail:r,item:f,parentIndex:g+1,pl:5},g+1))})})}const Lt=ie(ue)(({theme:t})=>({color:t.palette.text.secondary,[`& .${M.content}`]:{color:t.palette.text.secondary,borderTopRightRadius:t.spacing(2),borderBottomRightRadius:t.spacing(2),paddingRight:t.spacing(1),fontWeight:t.typography.fontWeightMedium,"&.MuiTreeItem-content":{paddingLeft:"3px",paddingRight:"3px"},".MuiTreeItem-label":{paddingLeft:"0px"},".MuiTreeItem-iconContainer":{marginRight:"0px"},"&.Mui-expanded":{fontWeight:t.typography.fontWeightRegular},"&:hover":{backgroundColor:t.palette.action.hover},"&.Mui-selected":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},[`& .${M.label}`]:{fontWeight:"inherit",color:"inherit"}},[`& .${M.group}`]:{marginLeft:0,[`& .${M.content}`]:{paddingLeft:t.spacing(1)}}})),Nt=u.forwardRef(function(n,s){const{labelIcon:o,labelInfo:a,labelText:i,pl:m,...l}=n;return e.jsx(Lt,{label:e.jsxs(C,{sx:{display:"flex",alignItems:"center",p:.5,pr:2,pl:{pl:m}},children:[e.jsx(C,{component:o,color:"inherit",sx:{mr:1,pl:{pl:m}}}),e.jsx(E,{sx:{fontWeight:"inherit",flexGrow:1},component:"div",children:i}),e.jsx(E,{variant:"caption",color:"inherit",children:a})]}),...l,ref:s})}),ge=t=>{const{id:n,fullIndex:s,title:o,sub:a}=t.item;if(n===void 0)return console.log("SubTreeItem.item.undefined=",t.item),e.jsx(e.Fragment,{});const i=a&&Object.values(a).length>0?Object.values(a).length+"":"";return e.jsx(Nt,{onClick:()=>t.onDetail(n,s),nodeId:n,labelText:o,labelInfo:i,pl:t.pl,children:a!=null?Object.values(a).sort((m,l)=>m.title>l.title?1:-1).map((m,l)=>e.jsx("div",{style:{paddingLeft:t.pl+5},children:e.jsx(ge,{onDetail:t.onDetail,item:m,pl:t.pl+5})},l+"")):""})};function Rt(t){const[n,s]=u.useState([]),[o,a]=u.useState([]),i=(r,d)=>{t.onDetail(r,d)};u.useEffect(()=>{if(t.expandIndex!==void 0){let r=t.expandIndex.split("/");r=r.filter(d=>d!=="sub"),t.expandIndex.indexOf("undefined")<0&&(s(r),a(r[r.length-1]))}},[t.expandIndex]);const m=(r,d)=>{},l=(r,d)=>{s(d)};return e.jsx(C,{sx:{minHeight:180,flexGrow:1,display:"flex",flexDirection:"column",height:t.maxHeight,overflow:"hidden",overflowY:"auto",width:"100%"},children:e.jsx(me,{"aria-label":"icon expansion",defaultCollapseIcon:e.jsx(z,{}),defaultExpandIcon:e.jsx(V,{}),expanded:n,onNodeSelect:m,selected:o,onNodeToggle:l,sx:{flexGrow:1,overflow:"hidden",overflowY:"auto"},children:t.data&&t.data.map((r,d)=>e.jsx(ge,{onDetail:i,item:r,parentIndex:d+1,pl:5},d+1))})})}const Et={position:"absolute",top:"50%",left:"50%",display:"flex",flexDirection:"column",alignItems:"center",transform:"translate(-50%, -50%)",width:250,maxHeight:"400px",bgcolor:"background.paper",border:"1px solid #000",boxShadow:24,boxSizing:"border-box",p:4},Bt=t=>e.jsxs(C,{sx:{my:2,mt:3,display:"flex"},children:[e.jsx(R,{type:"submit",variant:"outlined",color:"success",onClick:t.onPost,children:"확인"}),e.jsx(R,{type:"button",variant:"outlined",onClick:t.onClose,children:"취소"})]}),Wt=t=>{const[n,s]=u.useState(t.open),[o,a]=u.useState(),i=()=>{s(!1),a(void 0),t.onClose()};u.useEffect(()=>{s(t.open)},[t.open]);const m=r=>{a(r)},l=()=>{if(o===void 0){alert("이동할 메모장을 선택해 주세요");return}t.onPost(o)};return e.jsx("div",{children:e.jsx(dt,{open:n,onClose:i,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(C,{sx:Et,children:[e.jsx(E,{id:"modal-modal-title",variant:"h6",component:"h2",children:"이동할 메모장 선택"}),e.jsx(L,{}),e.jsx(C,{sx:{width:"100%",minHeight:110,maxHeight:200,flexGrow:1,minWidth:100,overflow:"hidden"},children:e.jsx(Rt,{data:t.data,onDetail:m,maxHeight:200})}),e.jsx(Bt,{onPost:l,onClose:i})]})})})},_t=t=>e.jsxs(C,{sx:{flexGrow:1,my:2,width:"100%",display:"grid",gridTemplateColumns:"64px 64px  64px  64px ",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:[e.jsx(R,{type:"button",size:"small",variant:"outlined",color:"success",onClick:t.onEdit,children:"수정"}),e.jsx(R,{type:"button",size:"small",variant:"outlined",onClick:t.onNewMemo,children:"새글"}),t.rootDb==="memo"?e.jsx(R,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:t.onMove,children:"이동"}):"",e.jsx(R,{type:"button",size:"small",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"})]}),Ft=t=>{const{rootDb:n,isLoading:s,memoDetailData:o}=t;console.log("MemoDetail.memoDetailData.title=",o?.title,", bookmark=",o?.bookmark);const{scrollYProgress:a}=ce(),i=de(a,{stiffness:100,damping:30,restDelta:.001}),[m,l]=u.useState(!1),r=_(),d=u.useRef();d.current=t.searchWord;const{memoId:c}=se(),g=q()?.state?.fullIndex,{user:b}=G(),D=()=>{const j=`/${n}/edit/${c}`;r(j,{state:{fullIndex:g}})},p=()=>{const j=`/${n}/insert/${c}`;r(j,{state:{fullIndex:g}})},k=async()=>{const j=n==="memo"?`${n}_txt/${b.uid}/${c}`:`${n}_txt/${c}`,w=n==="memo"?`${n}/${b.uid}`:n;if(await nt(j,w)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}t.onTreeUpdate(),r(`/${n}`)},I=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&k()},S=()=>{l(!0)},y=()=>{t.onBookmark()},h=async j=>{try{const w=n==="memo"?`${n}_txt/${b.uid}`:`${n}_txt`,T=n==="memo"?`memo/${b.uid}`:n,$=await ot(w,T,c,j);t.onTreeUpdate()}catch(w){console.log("catch",w)}finally{l(!1)}};return u.useEffect(()=>{o&&o.title!==void 0&&xe({title:o.title,description:o.title});function j(){window.scrollTo({top:0}),o&&o.html!=="N"&&document.querySelectorAll("pre").forEach(w=>{w.innerHTML=ut(w.innerHTML)})}o&&o.memo!==null&&j()},[o]),s?e.jsx(B,{}):c===""||b===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(We.div,{className:"progress-bar",style:{scaleX:i}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:o&&o.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx(xt,{"aria-label":"bookmark",onClick:y,children:o&&o.bookmark==="Y"?e.jsx(ct,{sx:{color:"red"}}):e.jsx(tt,{})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:t.pathNm})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(_t,{rootDb:n,onEdit:D,onNewMemo:p,onMove:S,onDelete:I,onBookmark:y,bookmark:o&&o.bookmark}),e.jsxs(C,{sx:{my:2},children:[o&&o.html==="N"?e.jsx(re,{postData:o&&o.memo}):o&&o.html!=="N"&&o.memo&&e.jsx(_e,{text:o.memo}),e.jsx(mt,{imageList:o&&o.image}),!o&&e.jsx(C,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx(ft,{sx:{mt:5}})})]}),e.jsx(Wt,{userId:b?.uid,open:m,data:t.data,onClose:()=>l(!1),onPost:h})]})]})},Pt=({onSubmit:t,onCancel:n,isSubmitting:s,newMode:o})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(O,{variant:"outlined",color:"success",disabled:s,onClick:a=>{a.preventDefault(),t(a)},children:[o?"새글":""," 저장"]}),e.jsx(O,{variant:"outlined",color:"error",onClick:n,children:"취소"})]}),Ht=u.lazy(()=>ae(()=>import("./index-DhfptILa.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32])));st.Quill.register("modules/imageDrop",lt);le.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const Yt={syntax:{highlight:t=>le.highlightAuto(t).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},Ot=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],Gt=t=>{const[n,s]=u.useState(t.imageList),[o,a]=u.useState(t.htmlCheck==="Y"),[i,m]=u.useState(t.newMode?"":t.content),l=u.useRef(),r=u.useRef(),d=u.useRef(null),c=u.useRef(null),f=t.newMode,g=u.useRef([]),{height:b}=Fe(),D=ht.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),p={edTitle:f?"":t.title,edGbn:t.gbn?t.gbn:"etc",edDate:f?D:t.date,content:f?"":t.content,memoTxt:f?"":t.content,htmlCheck:t.htmlCheck},{register:k,handleSubmit:I,trigger:S,control:y,setValue:h,getValues:j,watch:w,formState:{errors:T,isSubmitting:$}}=gt({mode:"onChange",defaultValues:p});u.useEffect(()=>{k("edDate",{required:!0,minLength:10}),k("edGbn",{required:!0}),k("htmlCheck"),k("memoTxt")},[]),u.useEffect(()=>{g.current=[],l.current=t.content,r.current=!1},[t.content]);const W=async x=>{f?await t.onNewSubmit(x,g.current):await t.onPostSubmit(x,n,g.current)},N=()=>{I(W)()},be=x=>{console.log("onDelete.imageList=",x),s(x)},je=x=>{let v=l.current;x.ext==="jpg"?v+=`<img src='${x.url}'/>`:x.ext==="mp4"&&(v+=`<video preload="auto" controls="" src='${x.url}'></video>`),l.current=v},ve=x=>{l.current=x},ke=x=>{console.log("handleFileUpload",x),g.current=x};function ye(x){l.current=x,h("content",x),S("content")}function we(x){console.log("handleChangeDate=",x);let v=A(x);v.format("YYYY-MM-DD HH:mm:ss"),console.log("handleChangeDate.dayjs=",v.format("YYYY-MM-DD HH:mm:ss")),h("edDate",v.format("YYYY-MM-DD")),S("edDate")}const Ie=x=>{console.log("onChecked=",x),h("htmlCheck",x?"Y":"N"),a(x)},De=w("content"),Se=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Te=["React","JavaScript","Bash","Java","Kotlin","CSS","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],Ce=x=>{const v=d.current;if(v){const K=v.selectionStart,Me=v.selectionEnd,U=i.slice(0,K),J=i.slice(Me);m(U+x+J),h("memoTxt",U+x+J),setTimeout(()=>{v.selectionStart=v.selectionEnd=K+x.length,v.focus()},0)}},F=x=>{Ce(x)};return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:I(W),style:{width:"100%",minHeight:"300px",maxHeight:{height:b},display:"flex",flexDirection:"column"},children:[e.jsx(Pt,{onSubmit:x=>N(),onCancel:t.onCancel,isSubmitting:$,newMode:f}),e.jsx(it,{control:y,onDelete:be,onInsert:je,setContent:ve,onFileUpload:ke,imageList:t.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx(kt,{...k("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!T.edTitle}),e.jsx(bt,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:y,defaultValue:j("edGbn"),selectList:Se,error:!!T.edGbn,onChange:x=>{x.preventDefault();const v=x.target.value;console.log("edGbn=",j("edGbn")),h("edGbn",v)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(pt,{id:"edDate",label:"일자",mdSize:6,value:A(j("edDate")),...k("edDate"),defaultValue:A(j("edDate")),onChange:we}),e.jsx(jt,{id:"html",checked:o,onChange:Ie,label:"HTML사용"})]})]}),e.jsx(L,{}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-130 overflow-y-scroll",children:e.jsx(re,{postData:i})}),e.jsxs("div",{children:[e.jsx(vt,{ref:d,className:"",value:i,onChange:x=>{h("memoTxt",x),m(x)},rows:22}),e.jsx(L,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(Y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>F("<box></box>"),children:"<Box>"}),e.jsx(Y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>F("</code>"),children:"</code>"}),Te.map((x,v)=>e.jsx(Y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>F("<code>"+x+"</code>"),children:x},v)),e.jsx(Y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>F('<a href="" target="_blank"></a>'),children:"Link"})]}),e.jsx(L,{})]})]}),e.jsx(u.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(Ht,{ref:c,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:De,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:Yt,formats:Ot,onChange:ye})}),e.jsx(L,{})]})})},ee=t=>{const{rootDb:n,isLoading:s,memoDetailData:o}=t,{scrollYProgress:a}=ce();de(a,{stiffness:100,damping:30,restDelta:.001});const i=_(),m=u.useRef(),l=u.useRef();l.current=t.searchWord;const{memoId:r}=se(),d=q(),c=o?.fullIndex,{user:f}=G();m.current=d.pathname.split("/")[2]==="insert",console.log("MemoDetailEdit.memoDetailData=",o?.title),console.log("MemoDetailEdit.newMode=",m.current);const g=()=>{const p=`/${n}/${r==="insert"?"":r}`;i(p,{state:{fullIndex:c}})},b=async(p,k)=>{console.log("onNewSubmit.values",p),console.log("onNewSubmit.fullIndex",c);const I=n==="memo"?`${n}_txt/${f.uid}/`:`${n}_txt/`,S=n==="memo"?`${n}/${f.uid}/`:`${n}/`;console.log("onNewSubmit.txtLocate",I),console.log("onNewSubmit.locate",S);const y=await X(void 0,I,S,c,p);if(await Z(`${n}_txt`,n,y,k),y!==void 0){const h=`/${n}/${y}`;i(h,{state:{reflash:!0}})}},D=async(p,k,I)=>{const S=n==="memo"?`${n}_txt/${f.uid}`:`${n}_txt`,y=n==="memo"?`${n}/${f.uid}`:n;await at(S,y,r,k),console.log("onPostSubmit.values",p);const h=await X(m.current?void 0:r,`${S}/`,`${y}/`,c,p);console.log("onPostSubmit.newKey=",h),console.log("onPostSubmit.files=",I);const j=await Z(`${S}/`,`${y}/`,r,I);if(console.log("onNewSubmit.imageResult",j),console.log("onPostSubmit.fullIndex",c),n==="memo"&&c===void 0){const T=await Ue(f.uid,`${r}/fullIndex`);console.log("onPostSubmit.fullPath",T),T!==void 0&&Je(`memo/${f.uid}/${T}/title`,p.edTitle)}m.current=!1;const w=`/${n}/${r}`;i(w,{state:{fullIndex:c,reflash:!0}})};return u.useEffect(()=>{o&&o.title!==void 0&&xe({title:o.title,description:o.title});function p(){document.querySelectorAll("pre").forEach((k,I)=>{})}o&&o.memo!==null&&p()},[o]),r===""||f===void 0?e.jsx(e.Fragment,{}):(console.log("MemoDetailEdit.isLoading=",s),o===void 0||s?e.jsx(B,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:m.current===!1&&o&&(o.title===void 0||o.title===""||o.title===null)?e.jsx(B,{}):e.jsx(Gt,{newMode:m.current,onPostSubmit:D,onNewSubmit:b,onCancel:g,title:o?.title,gbn:o?.gbn,date:o?.date,htmlCheck:o?.html?o?.html:"Y",content:o?.memo,imageList:o?.image})})}))},At=u.lazy(async()=>await ae(()=>import("./MemoMain-nJM9xr-P.js"),__vite__mapDeps([33,1,2,25]))),qt=({rootDb:t})=>{const n=_(),{user:s}=G(),o=u.useRef(),a=u.useRef(),i=u.useRef(!0),m=u.useRef(),l=u.useRef(),[r,d]=u.useState(),c=u.useRef(!1),f=q(),g=u.useRef(!1);g.current=f?.state?.reflash===!0;const b=Ge({queryKey:["treeMemo",s?.uid,o.current],queryFn:()=>Tt(t,s?.uid,o.current)});b.data!==void 0&&b.data!==""&&!c.current&&(c.current=!0);const D=()=>{const h=r;h&&(h.bookmark=h.bookmark==="Y"?"N":"Y"),Xe(s.uid,l.current,r.bookmark),d({...r,bookmark:h.bookmark})};u.useEffect(()=>{s!==void 0&&s!=null&&b.refetch()},[s]),u.useEffect(()=>{const h=async T=>{if(T!==""&&s){const $=await yt(t,s?.uid,T,o.current);{const W=pe(b.data,{id:"",nm:""},T),N=W.id;a.current=W.nm,$.fullIndex=N,N!==m&&(m.current=N,Qe(s.uid,T,N))}$.bookmark===void 0&&($.bookmark="N"),d($),i.current=!1}},j=f.pathname.split("/"),w=j.length>2?j[j.length-1]:"";i.current=!0,h(w),l.current=w},[f.pathname,s]),u.useEffect(()=>{s!==void 0&&s!=null&&b.refetch()},[g.current]);const p=h=>{c.current=!1,h!==void 0&&(o.current=h),b.refetch()},k=(h,j)=>{if(h===l.current)return;i.current=!0;const w=`/${t}/${h}`;n(w,{state:{fullIndex:m.current}})},I=()=>{if(s==null){alert("로그인 후 이용 가능합니다.");return}const h=`/${t}/insert/insert`;n(h)},S=h=>{},y=e.jsxs("div",{className:"",children:[e.jsx(rt,{className:"mt-3 ",children:t==="memo"?"메모장":"홈페이지관리"}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[e.jsx(P,{to:"/",children:"홈"}),t==="memo"?"":e.jsx(P,{to:"/memo",children:"메모"}),e.jsx(P,{to:"/todo",children:"TODO"}),e.jsx(P,{to:"/tw",children:"Sheet"})]}),e.jsx(St,{onNewMemoBtn:I,onSearchDataBtn:p}),c.current&&b.isFetched?e.jsx($t,{expandIndex:m.current,data:b.data,onDetail:k}):e.jsx(B,{})]});return s&&s.uid===Pe&&He,e.jsxs(Ye,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:y,children:[e.jsx(u.Suspense,{fallback:e.jsx(B,{}),children:e.jsxs(Oe,{children:[e.jsx(H,{path:"/edit/:memoId",element:e.jsx(ee,{rootDb:t,isLoading:i.current,searchWord:o.current,memoDetailData:r})}),e.jsx(H,{path:"/insert/:memoId",element:e.jsx(ee,{rootDb:t,isLoading:i.current,searchWord:o.current,memoDetailData:r})}),e.jsx(H,{path:"/:memoId",element:e.jsx(Ft,{rootDb:t,isLoading:i.current,searchWord:o.current,memoDetailData:r,onTreeUpdate:p,pathNm:a.current,onBookmark:D,data:b.data})}),e.jsx(H,{path:"*",element:e.jsx(At,{searchWord:o.current,data:b.data,onNewMemoBtn:I,title:t==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),t==="memo"?e.jsx(Dt,{onSelected:S}):"",e.jsx(et,{})]})},pe=(t,n,s)=>{let o={};if(t)for(let a=0;a<t.length;a++){const i=t[a];if(i.id===s)return o.id=n.id+i.id,o.nm=n.nm+i.title,o;if(i.sub!==null&&i.sub!==void 0){if(o.id=n.id+i.id+"/sub/",o.nm=n.nm+i.title+" > ",o=pe(Object.values(i.sub),o,s),o.id&&o.id.endsWith(s))return o;o={}}}return o},Vo=()=>e.jsx(qt,{rootDb:"memo"});export{Vo as default};
