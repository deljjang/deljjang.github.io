import{$ as fe,x as ee,j as e,B as k,bZ as _,aj as q,r as i,bm as ge,bn as pe,A as N,D as K,bo as je,aM as te,O as ne,a1 as V,T as Z,bp as se,bq as oe,J as ye,bh as be,V as De,C as ae,ex as Y,t as ve,Q as Ce,ey as Te,ez as we,S as Ie,q as ie,eA as Se,eB as J,s as ke,L as Fe}from"./index-D7hKsLfU.js";import{b as Q}from"./MuiCard-Dgud3yuj.js";import{T as Le}from"./Tab-CG8UtR5a.js";import{T as Me}from"./Tabs-BRFwgoHF.js";import{D as Be}from"./Delete-lHKP4_gh.js";import{A as F}from"./AniButton-DF9eEPPZ.js";import{S as O}from"./SinyItem-DT8EBVgS.js";import{G as D}from"./Grid-yxh0XiYD.js";import{T as G}from"./TextField-D2_SMvHd.js";import{D as X}from"./Divider-OntW7A_2.js";import{S as Re,a as $e}from"./SinySelect-Ctl2AZU8.js";import"./muiBackground-EwbA7iah.js";import"./Card-CdkPm0Rj.js";import"./CardContent-BbDkZpPt.js";import"./KeyboardArrowRight-BY9qhslC.js";import"./Button-CLyIDGSz.js";import"./index-DGzM_iM7.js";import"./InputAdornment-DqPeZ9Y-.js";import"./Popper-OV_XIfVF.js";import"./Chip-80WgbgTB.js";const Ee=ee(k)(({theme:t})=>({backgroundColor:t.palette.mode==="dark"?_.dark.backgroundColor:_.light.backgroundColor,borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",alignContent:"center",justifyContent:"center",overflowX:"auto"}));function We({tabValue:t,onChange:o,tabs:u}){const r=fe(),l=ee(Le)({"&.Mui-selected":{color:r.palette.text}});return e.jsx(Ee,{index:t,style:{width:"100%"},children:e.jsx(Me,{value:t,onChange:o,variant:"scrollable",scrollButtons:!1,allowScrollButtonsMobile:!0,"aria-label":"secondary tabs example",children:u.map(d=>e.jsx(l,{label:d.label},d.id))})})}const ze=q(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),Pe=q(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),Ue=q(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),Ve=t=>{const[o,u]=i.useState(t),[r,l]=i.useState([]),[d,x]=i.useState(),h=i.useCallback(v=>{const C=ge(N(K,v),pe("title"));je(C,T=>{if(!T.exists())return;const p=T.val(),y=[];for(let f in p){const c=p[f];c.id=f,c.sort=`${c.ing}_${c.date}_${c.title}`,(d===""||d===void 0||(c.memo+"").toLowerCase().indexOf(d.toLowerCase())>-1)&&y.push(c)}const $=y.sort((f,c)=>f.sort>c.sort?1:-1).filter(f=>f.ing==="1"),j=y.sort((f,c)=>f.sort>c.sort?-1:1).filter(f=>f.ing==="2");l([...$,...j])})},[d]);return i.useEffect(()=>{o!==""&&h(o)},[h,o,d]),[r,u,x]},Ge=t=>{const{userId:o}=t,[u,r]=Ve(""),l=te.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),d={edTitle:"",edDate:l},{register:x,handleSubmit:h,reset:v,getValues:C,setFocus:T,formState:{errors:p,isSubmitting:y,submitCount:$}}=ne({mode:"submit ",defaultValues:d}),j=i.useRef();i.useEffect(()=>{x("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:3,message:"3글자 이상 입력해주세요."}}),x("edDate",{required:!0,minLength:10})}),i.useEffect(()=>{o!==void 0&&r(`todo/${o}`)},[o]);async function f(s){s.preventDefault(),h(W)()}const c=()=>{t.handleGoogleLogin()};if(o===void 0)return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:[e.jsx(O,{children:"로그인을 해야 이용가능합니다."}),e.jsx(F,{type:"button",size:"small",variant:"outlined",color:"success",sx:{mt:30},onClick:c,children:"로그인"})]});const L=(s,g)=>{s.preventDefault(),T("edTitle"),v({edTitle:g.title,edDate:g.date}),j.current=g.id},E=s=>{s.preventDefault(),v({edTitle:""}),j.current=void 0},M=(s,g)=>{s.preventDefault(),window.confirm("삭제하시겠습니까?")&&setFireData(`todo/${o}/${g.id}`,null)},w=(s,g)=>{s.preventDefault(),window.confirm("완료하시겠습니까?")&&setFireData(`todo/${o}/${g.id}/ing`,"2")},A=s=>console.error(s);function W(s,g){const m=`todo/${o}/`;if(j.current===void 0){const S=se(oe(N(K),m)).key;j.current=S}setFireData(m+j.current+"/title",s.edTitle),setFireData(m+j.current+"/date",s.edDate),setFireData(m+j.current+"/ing","1"),j.current=void 0,v({edTitle:"",edDate:l})}return e.jsxs(e.Fragment,{children:[e.jsxs(k,{sx:{width:"100%",flexGrow:1,m:2},children:[e.jsx("div",{id:"back-to-top-anchor"}),e.jsx("form",{onSubmit:h(W,A),children:e.jsxs(D,{container:!0,spacing:2,columns:{xs:12,md:12},children:[e.jsx(D,{item:!0,xs:12,children:e.jsx(G,{type:"date",style:{paddingTop:"2px"},fullWidth:!0,placeholder:"일자",...x("edDate"),variant:"standard"})}),e.jsx(D,{item:!0,xs:9,sm:10,children:e.jsxs(k,{sx:{display:"flex",alignItems:"normal",justifyContent:"center"},children:[e.jsx(G,{fullWidth:!0,style:{paddingTop:"2px"},placeholder:"Todo Input",...x("edTitle"),variant:"standard",error:!!p.edTitle}),e.jsx(V,{style:{marginTop:"-4px"},"aria-label":"bookmark",onClick:s=>E(s),children:e.jsx(ze,{sx:{color:"action.active"}})})]})}),e.jsx(D,{item:!0,xs:3,sm:2,children:e.jsx(F,{variant:"outlined",fullWidth:!0,onClick:s=>f(s),color:"success",size:"small",disabled:y,children:"입력"})}),e.jsx(D,{item:!0,xs:12,sm:12,children:p?.edTitle?e.jsx("p",{className:"error",children:p.edTitle?.message}):null})]})}),u?.map((s,g)=>e.jsxs("div",{children:[e.jsxs(k,{sx:{display:"plex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(Z,{component:"div",variant:"body2",color:"text.prime",children:s.date}),e.jsxs(k,{sx:{display:"plex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[s.ing==="1"&&e.jsxs(e.Fragment,{children:[e.jsx(V,{"aria-label":"완료",onClick:m=>w(m,s),children:e.jsx(Pe,{})}),e.jsx(V,{"aria-label":"edit",onClick:m=>L(m,s),children:e.jsx(Ue,{})})]}),e.jsx(V,{"aria-label":"delete",onClick:m=>M(m,s),children:e.jsx(Be,{sx:{color:"rgba(120, 0, 0, 3)"}})})]})]}),e.jsx(Z,{component:"div",variant:"body",color:"text.prime",children:s.title}),e.jsx(X,{})]},g))]}),e.jsx(X,{})]})},Ae=t=>e.jsxs(k,{sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[e.jsx(F,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:t.onInsert,children:"입력"}),e.jsx(F,{type:"button",size:"small",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"}),e.jsx(F,{type:"button",size:"small",variant:"outlined",color:"success",onClick:t.onReload,children:"리로드"}),e.jsx(F,{type:"button",size:"small",variant:"outlined",onClick:t.onCsvSave,children:"csv저장"})]}),He=({name:t,label:o,control:u,defaultValue:r,placeholder:l,variant:d="filled",margin:x="none",size:h="small",xsSize:v=12,mdSize:C=6,onKeyUp:T})=>e.jsx(D,{item:!0,xs:v,md:C,children:e.jsx(ye,{control:u,name:t,defaultValue:r,render:({field:p})=>e.jsx(G,{label:o,placeholder:l,value:p.value,inputRef:p.ref,onChange:y=>{p.onChange(y)},size:h,defaultValue:r,variant:d,margin:x,fullWidth:!0,onKeyUp:T,...p})})});Ie();const Ye=t=>{const{userId:o,baseUrl:u}=t,r=i.useRef(null),l=i.useRef(null),[d,x]=i.useState(),[h,v]=i.useState(0),{height:C}=be(),p=De().palette.mode==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",y=te.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),$={edTitle:"",edDate:y};i.useEffect(()=>{w("edDate",{required:!0,minLength:10}),w("filterField1"),m("columns1",t.selectDefault)},[]),i.useEffect(()=>{(async()=>{if(o!==void 0){const a=await Te(u,o);v(a?.length),x(a)}})()},[o]);const j=async()=>{M()},f=async()=>{r.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:t.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},c=[],L={indicators:!0},E=[];t.columns.map((n,a)=>{n.select&&c.push({value:a,text:n.title}),n.hidden===!0&&E.push(a)}),L.columns=E;const M=()=>{try{const n=r.current?.hotInstance,a=n?.getPlugin("filters");if(a){const b=S("columns1");t.columns.forEach((H,B)=>{a?.removeConditions(B)}),a?.addCondition(Number(b),"contains",[S("filterField1")]),a?.filter(),n?.render();const P=n.getData().length;v(P)}}catch(n){console.error("Error:",n),console.error("Error:",n.message)}},{register:w,handleSubmit:A,trigger:W,reset:s,control:g,setValue:m,getValues:S,formState:{errors:z}}=ne({mode:"submit ",defaultValues:$});async function re(){A(le)()}function le(n,a){const b=`${t.baseUrl}/${o}/`,I=se(oe(N(K),b)).key;setFireData(b+I+"/title",n.edTitle),setFireData(b+I+"/date",n.edDate),setFireData(b+I+"/ing","1"),s({edTitle:"",edDate:y})}const de=async(n,a)=>{if(n!==null){const b=r.current?.hotInstance;if(b?.getPlugin("filters")){const P=b.getData(),H=[];n.forEach((B,xe)=>{const U={};t.columns.forEach((R,he)=>{U[R.data]=P[B[0]][he]}),H.push(U)}),H.forEach(async(B,xe)=>{const U=await we(B,u,o);d.map(R=>{(R.id===void 0||R.id===null)&&(R.id=U?.id)})}),b.render()}}},ce=async()=>{const n=r.current.hotInstance;if(n&&l.current!==null){if(n?.getPlugin("filters")){const I=n.getData()[l.current][t.keyId];window.confirm("삭제하시겠습니까?")&&setFireData(`${t.baseUrl}/${o}/${I}`,null)}n.alter("remove_row",l.current,1)}};function ue(n){let a=Y(n);a.format("YYYY-MM-DD HH:mm:ss"),m("edDate",a.format("YYYY-MM-DD")),W("edDate")}const me=z?.edTitle?e.jsx(D,{item:!0,xs:12,children:e.jsx("p",{className:"error",children:z.edTitle?.message})}):"";return e.jsxs(ae,{style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},sx:{mt:0},children:[e.jsxs(D,{container:!0,spacing:3,children:[e.jsx(Re,{id:"columns1",label:"조회 컬럼",mdSize:3,control:g,defaultValue:t.selectDefault?t.selectDefault:"1",selectList:c,error:!!z.columns1,onChange:n=>{n.preventDefault();const a=n.target.value;m("columns1",a),a!=""&&M()}}),e.jsx(He,{...w("filterField1"),name:"filterField1",control:g,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",size:"small",mdSize:9,fullWidth:!0,onKeyUp:M}),e.jsx($e,{control:g,id:"edDate",label:"일자",mdSize:3,value:Y(S("edDate")),...w("edDate"),defaultValue:Y(S("edDate")),onChange:ue}),e.jsx(D,{item:!0,xs:12,md:9,children:e.jsx(G,{...w("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목 입력",variant:"filled",size:"small",style:{},error:!!z.edTitle})}),me,e.jsx(D,{item:!0,xs:12,md:3,sx:{paddingTop:["0 !important","0 !important","0.5rem !important"]},children:e.jsx(O,{textAlign:"left",children:"건수 : "+ve(h)})}),e.jsx(D,{item:!0,xs:12,md:9,sx:{paddingTop:["0 !important","0 !important","0.5rem !important"]},children:e.jsx(Ae,{onInsert:re,onDelete:ce,onReload:j,onCsvSave:f})})]}),e.jsx("div",{style:{maxHeight:`${C}- 200`,overflow:"auto"},children:e.jsx(Ce,{ref:r,data:d,themeName:p,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:C-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:de,afterSelection:n=>{l.current=n},licenseKey:"non-commercial-and-evaluation",columns:t.columns,cells:(n,a)=>t.columns[a].readOnly===!0?{readOnly:!0}:{},colWidths:t.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:L})})]})},qe=()=>{const{user:t}=ie();return!t||t?.uid===void 0?e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:e.jsx(O,{children:"로그인을 해야 이용가능합니다."})}):e.jsx(Ye,{csvFileName:"exported_todo",baseUrl:"todo",columns:J,colWidths:Se,selectDefault:"1",keyId:J.length-1,userId:t?.uid})},mt=()=>{const{user:t,handleGoogleLogin:o}=ie(),[u,r]=i.useState(0),l=[{label:"그리도",id:"grid"},{label:"리스트",id:"list"}];i.useEffect(()=>{ke({title:"Todo",description:""})},[]),i.useEffect(()=>{const x=l.findIndex(h=>`#${h.id}`===window.location.hash);r(x!==-1?x:u)},[u]);const d=(x,h)=>{window.location.hash=`#${l[h].id}`,r(h)};return e.jsxs(ae,{maxWidth:"lg",sx:{mt:3},children:[e.jsx(We,{tabValue:u,onChange:d,tabs:l}),e.jsxs(i.Suspense,{fallback:e.jsx(Fe,{}),children:[e.jsx(Q,{value:u,index:0,style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},children:e.jsx(qe,{userId:t?.uid||!1,handleGoogleLogin:o})}),e.jsx(Q,{value:u,index:1,style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},children:e.jsx(Ge,{userId:t?.uid,handleGoogleLogin:o})})]})]})};export{mt as MUITodo,mt as default};
