const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MemoSheet-CSZTn7pc.js","assets/index-CmP4Fnif.js","assets/index-C_imuCsO.css","assets/TwToast-B-8gxw_h.js","assets/MemoSheetGrid-ToZg--0Q.js","assets/MemoDetailEdit-B8cXO4eJ.js","assets/useMemoMutation-Dkd0TxpF.js","assets/TwCheckbox-DNHmB9jh.js","assets/TwTextArea-CPyXDiCH.js","assets/angle-right-hER8KhSE.js","assets/MemoDetailEdit-Cmdt2tIm.css","assets/MemoDetailUtil-CbCFFCUf.js","assets/HomeChartVisitors-DCYsEQ9i.js"])))=>i.map(i=>d[i]);
import{aR as F,aS as Me,aT as nt,aU as at,aV as rt,aW as it,aX as ot,aY as lt,aZ as _e,a_ as ct,a$ as dt,b0 as Le,b1 as q,b2 as ze,r as g,b3 as ut,b4 as Be,b5 as pe,b6 as mt,b7 as Oe,j as t,aF as ie,b8 as _,aa as Re,t as U,v as J,w as We,s as b,i as B,a5 as Fe,b9 as ht,e as H,o as x,ba as ft,bb as gt,ad as He,ae as Ae,bc as pt,bd as xt,be as vt,bf as yt,a1 as z,bg as wt,h as Z,g as jt,a as D,q as oe,bh as Y,k as M,bi as ne,R as O,m as ae,bj as kt,N as xe,a2 as ve,H as bt,am as Nt,bk as $t,aL as ye,al as Pe,bl as Ct,f as le,bm as St,ab as Tt,bn as Ve,ai as Et,aj as W,_ as A,bo as Mt,bp as _t,bq as Lt,br as zt,bs as Bt,bt as Ot,bu as Rt,ak as Wt,P as Ft,bv as Ht,bw as At}from"./index-CmP4Fnif.js";import{S as qe,a as Pt,b as Vt}from"./angle-right-hER8KhSE.js";function Ye(e,s){let a;const r=()=>{const{currentTime:n}=s,l=(n===null?0:n.value)/100;a!==l&&e(l),a=l};return F.update(r,!0),()=>Me(r)}const X=new WeakMap;let L;function qt(e,s){if(s){const{inlineSize:a,blockSize:r}=s[0];return{width:a,height:r}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function Yt({target:e,contentRect:s,borderBoxSize:a}){var r;(r=X.get(e))===null||r===void 0||r.forEach(n=>{n({target:e,contentSize:s,get size(){return qt(e,a)}})})}function Kt(e){e.forEach(Yt)}function Qt(){typeof ResizeObserver>"u"||(L=new ResizeObserver(Kt))}function It(e,s){L||Qt();const a=nt(e);return a.forEach(r=>{let n=X.get(r);n||(n=new Set,X.set(r,n)),n.add(s),L?.observe(r)}),()=>{a.forEach(r=>{const n=X.get(r);n?.delete(s),n?.size||L?.unobserve(r)})}}const G=new Set;let K;function Xt(){K=()=>{const e={width:window.innerWidth,height:window.innerHeight},s={target:window,size:e,contentSize:e};G.forEach(a=>a(s))},window.addEventListener("resize",K)}function Gt(e){return G.add(e),K||Xt(),()=>{G.delete(e),!G.size&&K&&(K=void 0)}}function Ut(e,s){return typeof e=="function"?Gt(e):It(e,s)}const Jt=50,we=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Zt=()=>({time:0,x:we(),y:we()}),Dt={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function je(e,s,a,r){const n=a[s],{length:i,position:l}=Dt[s],c=n.current,u=a.time;n.current=e[`scroll${l}`],n.scrollLength=e[`scroll${i}`]-e[`client${i}`],n.offset.length=0,n.offset[0]=0,n.offset[1]=n.scrollLength,n.progress=at(0,n.scrollLength,n.current);const o=r-u;n.velocity=o>Jt?0:rt(n.current-c,o)}function es(e,s,a){je(e,"x",s,a),je(e,"y",s,a),s.time=a}function ts(e,s){const a={x:0,y:0};let r=e;for(;r&&r!==s;)if(r instanceof HTMLElement)a.x+=r.offsetLeft,a.y+=r.offsetTop,r=r.offsetParent;else if(r.tagName==="svg"){const n=r.getBoundingClientRect();r=r.parentElement;const i=r.getBoundingClientRect();a.x+=n.left-i.left,a.y+=n.top-i.top}else if(r instanceof SVGGraphicsElement){const{x:n,y:i}=r.getBBox();a.x+=n,a.y+=i;let l=null,c=r.parentNode;for(;!l;)c.tagName==="svg"&&(l=c),c=r.parentNode;r=l}else break;return a}const re={start:0,center:.5,end:1};function ke(e,s,a=0){let r=0;if(e in re&&(e=re[e]),typeof e=="string"){const n=parseFloat(e);e.endsWith("px")?r=n:e.endsWith("%")?e=n/100:e.endsWith("vw")?r=n/100*document.documentElement.clientWidth:e.endsWith("vh")?r=n/100*document.documentElement.clientHeight:e=n}return typeof e=="number"&&(r=s*e),a+r}const ss=[0,0];function ns(e,s,a,r){let n=Array.isArray(e)?e:ss,i=0,l=0;return typeof e=="number"?n=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?n=e.split(" "):n=[e,re[e]?e:"0"]),i=ke(n[0],a,r),l=ke(n[1],s),i-l}const as={All:[[0,0],[1,1]]},rs={x:0,y:0};function is(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function os(e,s,a){const{offset:r=as.All}=a,{target:n=e,axis:i="y"}=a,l=i==="y"?"height":"width",c=n!==e?ts(n,e):rs,u=n===e?{width:e.scrollWidth,height:e.scrollHeight}:is(n),o={width:e.clientWidth,height:e.clientHeight};s[i].offset.length=0;let d=!s[i].interpolate;const m=r.length;for(let v=0;v<m;v++){const j=ns(r[v],o[l],u[l],c[i]);!d&&j!==s[i].interpolatorOffsets[v]&&(d=!0),s[i].offset[v]=j}d&&(s[i].interpolate=it(s[i].offset,ot(r),{clamp:!1}),s[i].interpolatorOffsets=[...s[i].offset]),s[i].progress=lt(0,1,s[i].interpolate(s[i].current))}function ls(e,s=e,a){if(a.x.targetOffset=0,a.y.targetOffset=0,s!==e){let r=s;for(;r&&r!==e;)a.x.targetOffset+=r.offsetLeft,a.y.targetOffset+=r.offsetTop,r=r.offsetParent}a.x.targetLength=s===e?s.scrollWidth:s.clientWidth,a.y.targetLength=s===e?s.scrollHeight:s.clientHeight,a.x.containerLength=e.clientWidth,a.y.containerLength=e.clientHeight}function cs(e,s,a,r={}){return{measure:()=>ls(e,r.target,a),update:n=>{es(e,a,n),(r.offset||r.target)&&os(e,a,r)},notify:()=>s(a)}}const V=new WeakMap,be=new WeakMap,te=new WeakMap,Ne=e=>e===document.documentElement?window:e;function ce(e,{container:s=document.documentElement,...a}={}){let r=te.get(s);r||(r=new Set,te.set(s,r));const n=Zt(),i=cs(s,e,n,a);if(r.add(i),!V.has(s)){const c=()=>{for(const v of r)v.measure()},u=()=>{for(const v of r)v.update(_e.timestamp)},o=()=>{for(const v of r)v.notify()},d=()=>{F.read(c,!1,!0),F.read(u,!1,!0),F.update(o,!1,!0)};V.set(s,d);const m=Ne(s);window.addEventListener("resize",d,{passive:!0}),s!==document.documentElement&&be.set(s,Ut(s,d)),m.addEventListener("scroll",d,{passive:!0})}const l=V.get(s);return F.read(l,!1,!0),()=>{var c;Me(l);const u=te.get(s);if(!u||(u.delete(i),u.size))return;const o=V.get(s);V.delete(s),o&&(Ne(s).removeEventListener("scroll",o),(c=be.get(s))===null||c===void 0||c(),window.removeEventListener("resize",o))}}function ds({source:e,container:s,axis:a="y"}){e&&(s=e);const r={value:0},n=ce(i=>{r.value=i[a].progress*100},{container:s,axis:a});return{currentTime:r,cancel:n}}const se=new Map;function Ke({source:e,container:s=document.documentElement,axis:a="y"}={}){e&&(s=e),se.has(s)||se.set(s,{});const r=se.get(s);return r[a]||(r[a]=dt()?new ScrollTimeline({source:s,axis:a}):ds({source:s,axis:a})),r[a]}function us(e){return e.length===2}function Qe(e){return e&&(e.target||e.offset)}function ms(e,s){return us(e)||Qe(s)?ce(a=>{e(a[s.axis].progress,a)},s):Ye(e,Ke(s))}function hs(e,s){if(e.flatten(),Qe(s))return e.pause(),ce(a=>{e.time=e.duration*a[s.axis].progress},s);{const a=Ke(s);return e.attachTimeline?e.attachTimeline(a,r=>(r.pause(),Ye(n=>{r.time=r.duration*n},a))):ct}}function fs(e,{axis:s="y",...a}={}){const r={axis:s,...a};return typeof e=="function"?ms(e,r):hs(e,r)}function $e(e,s){ut(!!(!s||s.current))}const gs=()=>({scrollX:q(0),scrollY:q(0),scrollXProgress:q(0),scrollYProgress:q(0)});function ps({container:e,target:s,layoutEffect:a=!0,...r}={}){const n=Le(gs);return(a?ze:g.useEffect)(()=>($e("target",s),$e("container",e),fs((l,{x:c,y:u})=>{n.scrollX.set(c.current),n.scrollXProgress.set(c.progress),n.scrollY.set(u.current),n.scrollYProgress.set(u.progress)},{...r,container:e?.current||void 0,target:s?.current||void 0})),[e,s,JSON.stringify(r.offset)]),n}function xs(e){const s=Le(()=>q(e)),{isStatic:a}=g.useContext(Be);if(a){const[,r]=g.useState(e);g.useEffect(()=>s.on("change",r),[])}return s}function Ce(e){return typeof e=="number"?e:parseFloat(e)}function vs(e,s={}){const{isStatic:a}=g.useContext(Be),r=g.useRef(null),n=xs(pe(e)?Ce(e.get()):e),i=g.useRef(n.get()),l=g.useRef(()=>{}),c=()=>{const o=r.current;o&&o.time===0&&o.sample(_e.delta),u(),r.current=mt({keyframes:[n.get(),i.current],velocity:n.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...s,onUpdate:l.current})},u=()=>{r.current&&r.current.stop()};return g.useInsertionEffect(()=>n.attach((o,d)=>a?d(o):(i.current=o,l.current=d,F.update(c),n.get()),u),[JSON.stringify(s)]),ze(()=>{if(pe(e))return e.on("change",o=>n.set(Ce(o)))},[n]),n}function ys({series:e,labels:s}){const[a,r]=g.useState({labels:[],colors:Oe,dataLabels:{style:{colors:["#333"]}},responsive:[{breakpoint:480,options:{chart:{width:"100%"},legend:{position:"bottom"}}}]});return g.useEffect(()=>{r(n=>({...n,labels:s}))},[s]),t.jsx("div",{className:"bg-amber-50 dark:bg-gray-900 shadow-md rounded-sm p-2",children:e&&e.length>0?t.jsx(ie,{type:"donut",series:e,options:a}):t.jsx("div",{className:"text-center text-gray-500 py-10",children:"표시할 데이터가 없습니다."})})}function ws({series:e,labels:s}){const[a,r]=g.useState({chart:{type:"radar"},colors:["#008FFB"],dataLabels:{enabled:!1},xaxis:{categories:[]},yaxis:{show:!1}});return g.useEffect(()=>{r(n=>({...n,xaxis:{...n.xaxis,categories:s}}))},[s]),t.jsx("div",{className:"bg-white dark:bg-black shadow-md rounded-sm p-2",children:e&&e.length>0&&e[0].data.length>0?t.jsx(ie,{type:"radar",series:e,options:a}):t.jsx("div",{className:"text-center text-gray-500 py-10",children:"표시할 데이터가 없습니다."})})}function js({series:e,labels:s}){const[a,r]=g.useState({labels:[],colors:Oe,plotOptions:{pie:{startAngle:-90,endAngle:90,offsetY:10}},grid:{padding:{bottom:-80}},dataLabels:{style:{colors:["#333"]}},responsive:[{breakpoint:480,options:{chart:{width:"100%"},legend:{position:"bottom"}}}]});return g.useEffect(()=>{r(n=>({...n,labels:s}))},[s]),t.jsx("div",{className:"bg-amber-50 dark:bg-gray-900 shadow-md rounded-sm p-2",children:e&&e.length>0&&t.jsx(ie,{type:"donut",series:e,options:a})})}const ks=({className:e})=>t.jsx("svg",{className:e,fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"})}),bs=({className:e})=>t.jsx("svg",{className:e,fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})});async function Ns(e,s,a=""){if(s==null||s==="")return"";if(e==="home"){const o=await _("home/tree");if(o!=null)try{return JSON.parse(o)}catch(d){console.error("Error parsing JSON data:",d)}}const r=e==="home"?"home_txt":a===""?`${e}_tree/${s}`:`${e}_txt/${s}`,n=Re(U(J,r)),i=await We(n);if(!i.exists()||!i.exists())return null;const l=i.val(),c=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],u=[];e==="home"&&u.push(...c);for(const o in l){const d=l[o];d.id=o;const m={id:o,key:o,text:d.title,parent:e==="home"?d.gbn:d.parent};e==="memo"?(m.icon=d.bm==="Y"?t.jsx(ks,{className:"w-4 h-4 text-red-500"}):d.icon==="Y"?t.jsx(bs,{className:"w-4 h-4 text-green-500"}):null,m.droppable=!0):m.droppable=!1,!((a===""||a===void 0||a===null)&&(m.parent===void 0||m.parent===null||m.parent===""))&&(e==="home"||a===""||a===void 0||a===null?u.push(m):(d.id=o,(d.memo+"").toLowerCase().indexOf(a.toLowerCase())>-1&&(m.parent="root",m.droppable=!1,u.push(m))))}return u.sort((o,d)=>o.title>d.title?1:-1),e==="home"&&b("home/tree",JSON.stringify(u)),u}const $s=({rootDb:e})=>{const{user:s}=B(),[a,r]=Fe(ht(e)),{t:n}=H(),[i,l]=g.useState({labels:[],series:[]}),c=["#6366f1","#3b82f6","#22c55e","#ef4444","#f97316","#eab308","#8b5cf6","#d946ef","#14b8a6","#a855f7"],u=async()=>{const m=await Ns(e==="sheet"?"memo":e,s?.uid);o(m)};g.useEffect(()=>{a&&a.labels&&a.labels.length>0?l(a):u()},[e,s,a,r]);const o=m=>{if(m&&m.length>0){const v=m.filter(p=>p.parent==="root").sort((p,y)=>p.text.localeCompare(y.text)),j=(p,y)=>{const T=y.filter(E=>E.parent===p);let $=T.length;for(const E of T)$+=j(E.id,y);return $},N=v.map(p=>p.text),k=v.map(p=>j(p.id,m)),f={labels:N,series:k};l(f),r(f)}},d=()=>{u()};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`HomeChartForm ${x.between} bg-[#f1f1f1] dark:bg-[#181818] p-2`,children:[t.jsx("div",{className:"px-6 py-5",children:t.jsx(ft,{title:n("count_stats")})}),t.jsx("button",{onClick:d,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors mr-2","aria-label":n("reload_chart"),children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-600 dark:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h5M20 20v-5h-5M4 4l1.5 1.5A9 9 0 0121.5 12M20 20l-1.5-1.5A9 9 0 012.5 12"})})})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 w-full gap-2 justify-center",children:[t.jsx(ys,{series:i.series,labels:i.labels,colors:c}),t.jsx(gt,{series:[{name:n("count"),data:i.series}],labels:i.labels,colors:c}),t.jsx(ws,{series:[{name:n("count"),data:i.series}],labels:i.labels,colors:c}),t.jsx(js,{series:i.series,labels:i.labels,colors:c})]})]})},Cs=async(e,s)=>(await _(e)===void 0||b(e,null),b(s,null),"OK"),Qs=async({rootDb:e,uid:s,newData:a=!1,key:r,values:n})=>{const i=e==="memo"?`${e}_txt/${s}/`:`${e}_txt/`,l=e==="memo"?`${e}_tree/${s}/`:`${e}/`;let c=r;a&&(c=He(Ae(U(J),l)).key),console.log("setFireDetailData.values=",n);const u=i+c;return b(u+"/title",n.edTitle),n.htmlCheck==="N"||n.htmlCheck==="sheet"?b(u+"/memo",n.memoTxt):b(u+"/memo",n.content),b(u+"/date",n.edDate),b(u+"/gbn",n.edGbn),b(u+"/html",n.htmlCheck),a&&e!=="home"&&(b(`${l}/${c}/key`,c),b(`${l}/${c}/parent`,r)),e!=="home"&&(b(`${l}${c}/title`,n.edTitle),b(`${l}${c}/icon`,n.iconCheck)),c},Is=async(e,s,a,r)=>{if(r!==void 0)for(let n=0;n<r.length;n++){const i=r[n];i.del==="Y"&&(b(`${e}/${a}/image/${i.key}`,null),pt(s,a,i))}},Xs=async(e,s,a,r)=>{for(let n=0;n<r.length;n++){const i=r[n].object,c={ext:xt(i.name),name:i.name,use:"Y",sever:""},u=He(Ae(U(J),e+"/image")).key,o=await vt(s,a,u,i);c.sever=yt(o.metadata.name);const d=`${e}${a}/image/${c.sever}`;b(d,c)}},Se=e=>{const{t:s}=H();return t.jsxs("div",{className:"mx-auto grid w-full max-w-lg grid-cols-5 items-center justify-center gap-2 px-4 py-2 text-center",children:[e.master&&t.jsx(z,{size:"sm",variant:"outlined",color:"brand",onClick:e.onUtil,className:"gap-1.5",children:t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),t.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),t.jsx("span",{className:"ml-2 whitespace-nowrap",children:s("util")})]})}),t.jsx(z,{size:"sm",variant:"outlined",color:"brand",onClick:e.onEdit,className:"gap-1.5",children:t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),t.jsx("path",{d:"m15 5 4 4"})]}),t.jsx("span",{className:"ml-2 whitespace-nowrap",children:s("edit")})]})}),t.jsx(z,{size:"sm",variant:"outlined",color:"brand",onClick:e.onNewMemo,className:"gap-1.5",children:t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M5 12h14"}),t.jsx("path",{d:"M12 5v14"})]}),t.jsx("span",{className:"ml-2 whitespace-nowrap",children:s("new")})]})}),t.jsx(z,{size:"sm",variant:"outlined",color:"error",onClick:e.onDelete,className:"gap-1.5",children:t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M3 6h18"}),t.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),t.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),t.jsx("span",{className:"ml-2 whitespace-nowrap",children:s("delete")})]})}),e.onCopy&&t.jsx(z,{size:"sm",variant:"outlined",color:"secondary",onClick:e.onCopy,className:"gap-1.5",children:t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}),t.jsx("span",{className:"ml-2 whitespace-nowrap",children:s("public")})]})})]})},Ss=({rootDb:e,memoDetailData:s,onBookmark:a,searchWord:r,onDeleteTab:n})=>{const[i,l]=g.useState(!1),{alertInfo:c,setAlertInfo:u,resetAlertInfo:o}=wt(),[d,m]=g.useState(!1),[v,j]=g.useState(""),[N,k]=g.useState(!1),[f,p]=g.useState(""),[y,T]=g.useState(!1),{t:$}=H(),{scrollYProgress:E}=ps(),P=vs(E,{stiffness:100,damping:30,restDelta:.001}),Q=Z(),{memoId:w}=jt(),ee=D()?.state?.fullIndex,{user:S}=B(),R=oe(),Ie=Y({mutationFn:async()=>{const h=e==="memo"?`${e}_txt/${S.uid}/${w}`:`${e}_txt/${w}`,C=e==="memo"?`${e}_tree/${S.uid}/${w}`:`${e}/${w}`;return await Cs(h,C)},onSuccess:()=>{R.invalidateQueries({queryKey:["twTreeData",e]}),n&&n(w),Q(`/${e==="memo"?"m":e}`)},onError:h=>{console.error("삭제 중 오류 발생:",h)}}),Xe=Y({mutationFn:async()=>{if(!S||!w||e!=="memo")throw new Error("Only private memos can be copied.");`${S.uid}${w}`;const h=s;if(!h)throw new Error("Memo data not found.");const C=`home_txt/${w}`;await b(C,h);const I=`memo_tree/${S.uid}/${w}`,st=`home/${w}`;await b(`${I}/public`,"Y"),await b(st,{...h,key:w,text:h.title})},onSuccess:()=>{u({isOpen:!0,title:$("complete"),message:$("copy_completed"),color:"success",onConfirm:o,onClose:o}),R.invalidateQueries({queryKey:["memoDetail","home",S?.uid,w]})},onError:h=>{console.error("Copy failed:",h);const C=`${$("copy_failed")} ${h.message?`: ${h.message}`:""}`;u({isOpen:!0,title:$("error"),message:C,color:"error",onConfirm:o,onClose:o})}}),de=Y({mutationFn:async h=>{const C=e==="memo"?`memo_txt/${S.uid}/${w}/title`:`home_txt/${w}/title`,I=e==="memo"?`memo_tree/${S.uid}/${w}/title`:`home/${w}/title`;return await b(C,h),await b(I,h),h},onSuccess:h=>{R.setQueryData(["memoDetail",e,S?.uid,w],C=>({...C,title:h})),R.invalidateQueries({queryKey:["twTreeData",e]}),R.invalidateQueries({queryKey:["tabTitle",e,S?.uid,w]}),k(!1)},onError:h=>{console.error("제목 업데이트 중 오류 발생:",h),k(!1)}}),Ge=Y({mutationFn:async h=>{const C=e==="memo"?`memo_txt/${S.uid}/${w}/memo`:`home_txt/${w}/memo`;return await b(C,h),h},onSuccess:h=>{R.setQueryData(["memoDetail",e,S?.uid,w],C=>({...C,memo:h})),m(!1)},onError:h=>{console.error("메모 저장 중 오류 발생:",h)}}),Ue=()=>{Ge.mutate(v)},Je=()=>{j(s?.memo||""),m(!0)},Ze=()=>{p(s?.title||""),k(!0)},De=h=>{p(h.target.value)},et=h=>{h.key==="Enter"?de.mutate(f):h.key==="Escape"&&k(!1)},ue=()=>{const h=`/${e==="memo"?"m":e}/edit/${w}`;Q(h,{state:{fullIndex:ee}})},me=()=>{const h=`/${e==="memo"?"m":e}/util/${w}`;Q(h,{state:{fullIndex:ee}})},he=()=>{const h=`/${e==="memo"?"m":e}/insert/${w}`;Q(h,{state:{fullIndex:ee}})},fe=()=>{l(!0)},ge=()=>{Xe.mutate()},tt=()=>{l(!1),Ie.mutate()};return g.useEffect(()=>{function h(){const C=s.scrollY?s.scrollY:0;window.scrollTo({top:C})}s&&s.memo!==null&&(h(),s.image&&s.image.map((C,I)=>C))},[s]),w===""||S===void 0?t.jsx(t.Fragment,{}):t.jsxs("div",{className:"MemoDetail py-2 relative rounded-t-md",children:[t.jsx(M.div,{className:`progress-bar sticky ${y?"top-28":"top-16"} z-10`,style:{scaleX:P}}),t.jsxs("div",{className:"MemoDetail_body rounded-t-md overflow-hidden ",children:[t.jsxs("div",{className:"sticky top-0 z-20 bg-white/80 dark:bg-zinc-900/80 backdrop-blur-sm",children:[t.jsxs("div",{className:"p-3 sm:p-4",children:[t.jsxs("div",{className:x.between,children:[t.jsxs("p",{className:`${x.truncate} ${x.textXs} ${x.textGray500DarkZinc400}`,children:[t.jsx(ne,{to:e==="memo"?"/m":"/hmoe",className:`${x.navLinkHoverText}`,children:e==="memo"?"MEMO":"HOME"}),s?.path?.map((h,C)=>s.path.length===C+1?` > ${h?.title}`:t.jsxs(O.Fragment,{children:[" "," > ",t.jsx(ne,{to:e==="memo"?`/m/${h.id}`:`/home/${h.id}`,className:`${x.navLinkHoverText}`,children:h?.title})]},C))]}),t.jsx(M.button,{whileTap:{scale:.8},className:`${x.flexShrink0} ${x.roundedFull} p-2 ${x.buttonHoverGrayLight}`,"aria-label":$("bookmark"),onClick:a,children:s?.bookmark==="Y"?t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`${x.h5W5} ${x.textRed500}`,fill:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}):t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`${x.h5W5} ${x.textGray500}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})})]}),N?t.jsx("input",{type:"text",value:f,onChange:De,onKeyDown:et,onBlur:()=>de.mutate(f),className:`w-full bg-transparent border-b-2 border-blue-500 focus:outline-none 
													${x.heading2XlBoldSm3Xl} ${x.textGray900}`,autoFocus:!0}):t.jsx("div",{onDoubleClick:Ze,className:`MemoDetail_Title text-left ${x.heading2XlBoldSm3Xl} ${x.textGray900} cursor-pointer`,children:s?.title}),t.jsx("button",{onClick:()=>T(!y),className:`${x.floatingActionButton} absolute top-11 sm:top-14 right-2 sm:right-3`,children:t.jsx(M.div,{animate:{rotate:y?135:0},children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})})]}),!y&&t.jsx("div",{className:`${x.line}`}),t.jsx(M.div,{initial:!1,animate:{height:y?"auto":0,opacity:y?1:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:t.jsx("div",{className:`${x.line}`,children:t.jsx(Se,{master:S?.uid===ae,rootDb:e,onEdit:ue,onUtil:me,onNewMemo:he,onDelete:fe,onCopy:e==="memo"?ge:null})})})]}),s&&s.html==="sheet"&&t.jsx(kt,{rootDb:e,detailData:s}),t.jsxs("div",{className:`MemoDetail_Content ${s?.memo?.length>0?"p-2 sm:p-4":"p-1"}`,onDoubleClick:Je,children:[d?t.jsxs("div",{className:`${x.card} p-4`,children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(xe,{children:$("input")}),t.jsx("textarea",{className:"w-full h-64 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",value:v,onChange:h=>j(h.target.value),autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx(xe,{children:$("preview")}),t.jsx("div",{className:"prose dark:prose-invert max-w-none p-2 border rounded h-64 overflow-y-auto dark:bg-gray-700 dark:border-gray-600",children:t.jsx(ve,{postData:v,highlightWord:""})})]})]}),t.jsxs("div",{className:"mt-2 flex justify-end gap-2",children:[t.jsx(z,{variant:"outlined",color:x.button.indigo,size:"sm",onClick:()=>m(!1),children:$("cancel")}),t.jsx(z,{color:x.button.indigo,onClick:Ue,children:$("save")})]})]}):s&&s.html!=="sheet"?s?.html==="N"?t.jsx(ve,{postData:s?.memo,highlightWord:r}):s?.html!=="N"&&s?.memo&&t.jsx(bt,{text:s.memo}):"",t.jsx(Nt,{imageList:s?.image}),!s&&t.jsx("div",{className:"flex justify-center py-12",children:t.jsx("div",{className:`${x.flexCenter} py-12`})})]})]}),t.jsx($t,{rootDb:e,memoId:w,readOnly:!1}),t.jsx(M.div,{initial:!1,animate:{height:y?"auto":0,opacity:y?1:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:t.jsx("div",{className:`${x.line}`,children:t.jsx(Se,{master:S?.uid===ae,rootDb:e,onEdit:ue,onUtil:me,onNewMemo:he,onDelete:fe,onCopy:e==="memo"?ge:null})})}),t.jsx(ye,{isOpen:i,size:"sm",color:"warning",title:$("delete_confirm_title"),message:$("delete_confirm_message"),onClose:()=>l(!1),onConfirm:tt}),t.jsx(ye,{...c})]})},Ts=({rootDb:e})=>{const{user:s}=B(),{t:a}=H(),r=a(e==="memo"?"appMemo":"home_mng"),n=t.jsx("div",{className:`displayTitle text-center  ${x.text3Xl} ${x.textIndigo}`,children:r});return t.jsx(t.Fragment,{children:t.jsx(Pe,{title:n,className:"MemoMain mt-3 mb-5",children:t.jsxs("div",{className:"grid gird-cols-1 md:grid-cols-5 items-center gap-3",children:[s===null?t.jsx("p",{className:`${x.textRed500} ${x.textLgFontSemiboldLeft} ${x.mdColSpan3}`,children:a("login_used")}):t.jsx("p",{className:`${x.textGray600DarkZinc400} text-left ${x.mdColSpan3}`,dangerouslySetInnerHTML:{__html:a("memo_main_guide").replace(`
`,"<br/>")}}),t.jsx("div",{className:`w-full ${x.flexCenter} md:col-span-2`,children:t.jsx(Ct,{})})]})})})},Es=({item:e})=>{const{user:s}=B(),a=Z();return t.jsx("div",{onClick:()=>a(`/m/${e.key}`),className:`${x.roundedXl} border border-gray-200 
      bg-white dark:border-gray-800 dark:bg-white/[0.03] 
      overflow-hidden cursor-pointer hover:shadow-md transition-shadow h-full flex flex-col`,children:t.jsx("div",{className:"px-4 py-3",children:t.jsx("h3",{className:"text-base font-medium text-gray-800 dark:text-white/90 truncate",children:e.title})})})};function Ms(){const{user:e}=B(),{t:s}=H(),{data:a,isLoading:r}=le({queryKey:["bookmarks",e?.uid],queryFn:async()=>{const l=[],c=Re(U(J,`memo_tree/${e.uid}`),Tt("bm"),St("Y")),u=await We(c);if(!u.exists())return[];const o=u.val();for(let d in o){const m=o[d];m.id=d,m.key=d,m.text=m.title,l.push(m)}return l.sort((d,m)=>d.title>m.title?1:-1),l},enabled:!!e}),n="grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4",i=()=>t.jsx("div",{className:`grid ${n} gap-3 p-4`,children:[...Array(8)].map((l,c)=>t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"},c))});return e===null?t.jsx(t.Fragment,{}):t.jsx(Pe,{title:s("main_list"),children:t.jsx("div",{className:"p-2",children:r?t.jsx(i,{}):t.jsx("div",{className:`grid ${n} gap-3`,children:a?.map(l=>t.jsx(Es,{item:l},l.id))})})})}const Te=()=>t.jsxs("div",{className:"MemoDetail py-2 relative",children:[t.jsxs("div",{className:"overflow-hidden",children:[t.jsxs("div",{className:"p-2 sm:p-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded-md w-1/2 animate-shimmer relative overflow-hidden"}),t.jsx("div",{className:"h-6 w-6 bg-gray-300 dark:bg-zinc-700 rounded-full animate-shimmer relative overflow-hidden"})]}),t.jsx("div",{className:"mt-3 h-8 bg-gray-300 dark:bg-zinc-700 rounded-md w-3/4 animate-shimmer relative overflow-hidden"})]}),t.jsx("div",{className:`${x.line} my-2`}),t.jsxs("div",{className:"p-2 sm:p-4 space-y-6 animate-shimmer relative overflow-hidden",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-full "}),t.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-5/6 "}),t.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-full "})]}),t.jsx("div",{className:"h-48 bg-gray-300 dark:bg-zinc-700 rounded-lg "}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-4/6 "}),t.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-full "})]})]})]}),t.jsx("div",{className:`NotionStyleEditor ${x.card} mt-1 py-4 border-gray-200 dark:border-zinc-700`,children:t.jsxs("div",{className:"mb-4 space-y-4 p-2 ",children:[t.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),t.jsx("div",{className:"h-20 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"})]})})]});O.lazy(()=>A(()=>import("./MemoSheet-CSZTn7pc.js"),__vite__mapDeps([0,1,2,3])));const _s=O.lazy(()=>A(()=>import("./MemoSheetGrid-ToZg--0Q.js"),__vite__mapDeps([4,1,2,3]))),Ee=O.lazy(()=>A(()=>import("./MemoDetailEdit-B8cXO4eJ.js"),__vite__mapDeps([5,1,2,6,7,8,9,10]))),Ls=O.lazy(()=>A(()=>import("./MemoDetailUtil-CbCFFCUf.js"),__vite__mapDeps([11,1,2,8,6,9]))),zs=O.lazy(()=>A(()=>import("./index-CmP4Fnif.js").then(e=>e.bV),__vite__mapDeps([1,2]))),Bs=O.lazy(()=>A(()=>import("./HomeChartVisitors-DCYsEQ9i.js"),__vite__mapDeps([12,1,2]))),Os=({rootDb:e,user:s,memoId:a,memoDetailData:r,isLoading:n,onBookmark:i,handleCloseTab:l})=>{const c=D();return t.jsxs(g.Suspense,{fallback:t.jsx(Te,{}),children:[t.jsx(Ve,{children:t.jsxs(Et,{location:c,children:[t.jsx(W,{path:"todo",element:t.jsx(M.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:t.jsx(zs,{})})}),t.jsx(W,{path:"sheet/:sheetId?",element:t.jsx(M.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:t.jsx(_s,{detailData:r})})}),t.jsx(W,{path:"edit/:memoId",element:t.jsx(M.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:t.jsx(Ee,{rootDb:e,isLoading:n,memoDetailData:r})})}),t.jsx(W,{path:"insert/:memoId",element:t.jsx(M.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:t.jsx(Ee,{rootDb:e,isLoading:n,memoDetailData:r})})}),t.jsx(W,{path:"util/:memoId",element:t.jsx(M.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:t.jsx(Ls,{rootDb:e,isLoading:n,memoDetailData:r})})}),t.jsx(W,{path:":memoId",element:t.jsx(t.Fragment,{children:n?t.jsx(Te,{}):t.jsx(Ss,{rootDb:e,memoDetailData:r,onBookmark:i,onDeleteTab:()=>l(null,{id:a})})})})]},c.pathname)}),c.pathname==="/m"&&t.jsx(Ts,{rootDb:e}),(e==="memo"||e==="sheet")&&t.jsx(Ms,{}),(a===""||a==="m")&&s?.uid===ae&&t.jsxs(t.Fragment,{children:[t.jsx(Bs,{}),t.jsx("div",{className:`mt-5 ${x.card}`,children:t.jsx($s,{rootDb:e})})]})]})},Rs=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",...e,children:t.jsx("path",{fillRule:"evenodd",d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM6 20V4h7v5h5v11H6zM8 12h3v3H8v-3zm0 4h3v3H8v-3zm4-4h3v3h-3v-3zm0 4h3v3h-3v-3z",clipRule:"evenodd"})}),Ws=({tabInfo:e,handleCloseTab:s,isActive:a})=>{const{t:r}=H(),{user:n}=B(),{attributes:i,listeners:l,setNodeRef:c,transform:u,transition:o,isDragging:d}=Mt({id:e.id}),m={transform:_t.Transform?.toString(u),transition:o,zIndex:d?1:"auto"},{data:v}=le({queryKey:["tabTitle",e.rootDb,n?.uid,e.id],queryFn:async()=>e.rootDb==="sheet"?await _(`memo_sheet/${n?.uid}/${e.id}/title`):e.rootDb==="memo"?await _(`${e.rootDb}_txt/${n?.uid}/${e.id}/title`):e.rootDb==="home"?await _(`${e.rootDb}_txt/${e.id}/title`):e.title,enabled:!!n&&!!e.id,staleTime:1/0,placeholderData:e.title});return t.jsxs(ne,{ref:c,style:m,...i,...l,"data-tab-id":e.id,to:e.path,title:v,end:!0,className:({isActive:j})=>`SortableTab group relative flex flex-shrink-0 items-center pl-3 pr-2 py-1.5 text-sm rounded-t-md transition-colors duration-200 min-w-28 max-w-48 border-b-2
				${j?"bg-gray-200 dark:bg-zinc-700 border-blue-500 text-gray-800 dark:text-gray-100":"border-transparent text-secondary hover:bg-gray-200/70 dark:hover:bg-zinc-700/70"}
				${d?"opacity-50 shadow-lg":""}`,children:[e.rootDb==="memo"?t.jsx(Lt,{className:`w-5 h-5 mr-1 flex-shrink-0 transition-transform duration-200 ${a?"scale-110":""}`,fill:"currentColor"}):e.rootDb==="sheet"?t.jsx(Rs,{className:`w-5 h-5 mr-1 flex-shrink-0 transition-transform duration-200 ${a?"scale-110":""}`}):null,t.jsx("span",{className:"truncate pr-1",style:{fontFamily:"sans-serif"},children:v||r("loading")}),t.jsx("button",{onClick:j=>s(j,e),className:`ml-auto flex-shrink-0 p-1 rounded-full transition-opacity duration-200 opacity-0 group-hover:opacity-100
					text-gray-500 dark:text-gray-400 
					hover:bg-gray-300/50 dark:hover:bg-gray-600/50 hover:text-gray-700 dark:hover:text-white
				`,children:t.jsx(qe,{className:"w-3 h-3"})})]})},Fs=({openTabs:e,setOpenTabs:s,handleCloseTab:a,handleCloseAllTabs:r,activeId:n})=>{const i=g.useRef(null),[l,c]=g.useState({left:!1,right:!1}),[u,o]=g.useState({left:0,width:0}),[d,m]=g.useState(!0),v=g.useRef(0),j=g.useCallback(()=>{const f=i.current;if(f){const p=f.scrollWidth>f.clientWidth,y=f.scrollLeft===0,T=f.scrollLeft+f.clientWidth>=f.scrollWidth-1;c($=>{const E={left:p&&!y,right:p&&!T};return $.left===E.left&&$.right===E.right?$:E})}},[]);g.useEffect(()=>{const f=()=>{const p=window.pageYOffset||document.documentElement.scrollTop;p>v.current?m(!1):m(!0),v.current=p<=0?0:p};return window.addEventListener("scroll",f),()=>{window.removeEventListener("scroll",f)}},[]);const N=f=>{i.current?.scrollBy({left:f==="left"?-200:200,behavior:"smooth"})},k=f=>{const{active:p,over:y}=f;console.log("active=",p,"over=",y),p.id!==y.id&&s(T=>{const $=T.findIndex(P=>P.id===p.id),E=T.findIndex(P=>P.id===y.id);return Rt(T,$,E)})};return g.useEffect(()=>{j();const f=i.current;return f?.addEventListener("scroll",j),window.addEventListener("resize",j),()=>{f?.removeEventListener("scroll",j),window.removeEventListener("resize",j)}},[e,j]),g.useEffect(()=>{const f=setTimeout(()=>{const p=i.current?.querySelector(`[data-tab-id="${n}"]`);if(p){const{offsetLeft:y,offsetWidth:T}=p;o({left:y,width:T})}},0);return()=>clearTimeout(f)},[n,e]),t.jsx("div",{className:`MemoTabs sticky ${d?"top-18":"top-1"} z-1000 rounded-t-md bg-gray-50/70 dark:bg-zinc-800/70 backdrop-blur-sm shadow-sm`,children:t.jsxs("div",{className:"relative flex items-center justify-between ",children:[l.left&&t.jsx("button",{onClick:()=>N("left"),className:"absolute left-0 z-10 p-1 border border-gray-200 dark:border-gray-700 text-gray-500 dark:text-gray-400 bg-white dark:bg-zinc-900 dark:hover:!text-white hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full group",children:t.jsx(Pt,{className:"w-5 h-5 fill-current"})}),t.jsx(zt,{id:"memo-tabs",onDragEnd:k,children:t.jsx("div",{ref:i,className:"MemoTabs relative flex items-center overflow-x-scroll scrollbar-hide whitespace-nowrap",children:t.jsx(Bt,{items:e.map(f=>f.id),strategy:Ot,children:t.jsx(Ve,{children:e.map(f=>t.jsx(M.div,{layout:!0,initial:{opacity:0,scale:.8},transition:{type:"spring",stiffness:350,damping:30},animate:{opacity:1,scale:1},exit:{opacity:0,width:0,paddingLeft:0,paddingRight:0,transition:{duration:.3}},children:t.jsx(Ws,{tabInfo:f,handleCloseTab:a,isActive:f.id===n})},f.id))})})})}),t.jsxs("div",{className:"flex items-center",children:[l.right&&t.jsx("button",{onClick:()=>N("right"),className:"z-10 p-1 border border-gray-200 dark:border-gray-700 text-gray-500 dark:text-gray-400 bg-white dark:bg-zinc-900 dark:hover:!text-white hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full group",children:t.jsx(Vt,{className:"w-5 h-5 fill-current"})}),e.length>0&&t.jsx("button",{onClick:r,className:"ml-2 mr-2 p-1.5 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md",title:"Close all tabs",children:t.jsx(qe,{className:"w-4 h-4"})})]})]})})},Hs=async(e,s)=>{const a=[];let r=s;if(!e||!r)return a;for(;r&&r!=="root";){const n=await _(`memo_tree/${e}/${r}`);if(!n)break;a.unshift({id:r,...n}),r=n.parent}return a};function As(e,s,a,r){const n=oe(),{data:i,isLoading:l}=le({queryKey:["memoDetail",e,s?.uid,a],queryFn:async()=>{if(!a||!s||a==="insert")return{};if(e==="memo"||e==="home"){const o=await Wt(e,s.uid,a);if(o&&e==="memo"){o.path=await Hs(s?.uid,a);const d=await _(`memo_tree/${s.uid}/${a}/bm`);o.bookmark=d==="Y"?"Y":"N"}return o||{}}else if(e==="sheet")return{title:await _(`memo_sheet/${s.uid}/${a}/title`)}},enabled:!!s&&!!a,staleTime:1e3*60*5}),{mutate:c}=Y({mutationFn:async o=>{const d=e==="memo"?`memo_tree/${s.uid}/${a}/bm`:`home_txt/${a}/bookmark`;await b(d,o)},onMutate:async o=>{await n.cancelQueries({queryKey:["memoDetail",e,s?.uid,a]});const d=n.getQueryData(["memoDetail",e,s?.uid,a]);return n.setQueryData(["memoDetail",e,s?.uid,a],m=>({...m,bookmark:o})),{previousMemoDetail:d}},onError:(o,d,m)=>{n.setQueryData(["memoDetail",e,s?.uid,a],m.previousMemoDetail)},onSettled:()=>{n.invalidateQueries({queryKey:["memoDetail",e,s?.uid,a],refetchType:"all"}),n.invalidateQueries({queryKey:["twTreeData",e],refetchType:"all"}),n.invalidateQueries({queryKey:["bookmarks",s?.uid],refetchType:"all"}),r(!0)}});return{memoDetailData:i,isLoading:l,onBookmark:()=>{if(!i)return;const o=i.bookmark==="Y"?"N":"Y";c(o)}}}function Ps(e,s,a,r,n){const i=a?.uid,[l,c]=g.useState(()=>{try{const N=localStorage.getItem(`openTabs_${i}`);return N?JSON.parse(N):[]}catch(N){return console.error("Failed to parse openTabs from localStorage",N),[]}}),u=g.useRef(),o=D(),d=Z(),m=g.useCallback(async N=>{if(e&&r&&r!=="insert"&&o.pathname!=="/m"&&o.pathname!=="/home"){const k={id:r,path:o.pathname,icon:null,rootDb:s,title:N?.title};if(o.pathname.startsWith("/m/sheet/")){const f=await _(`memo_sheet/${a?.uid}/${r}/title`);k.title=f}else r==="sheet"&&(k.title="Main Sheet");!l.some(f=>f.id===k.id)&&u.current!==r?(u.current=r,c(f=>[...f,k])):(u.current="",c(f=>f.map(p=>p.id===k.id?{...p,title:k.title||p.title}:p)))}},[n,e]);g.useEffect(()=>{n&&m(n)},[n,e]),g.useEffect(()=>{if(i)try{localStorage.setItem(`openTabs_${i}`,JSON.stringify(l))}catch(N){console.error("Failed to save openTabs to localStorage",N)}},[l,i]);const v=g.useCallback((N,k)=>{N?.preventDefault(),N?.stopPropagation(),u.current="";const f=l.findIndex(y=>y.id===k.id),p=l.filter(y=>y.id!==k.id);if(c(p),o.pathname.includes(k.id)){const y=p.length>0?p[Math.max(0,f-1)].path:`/${s==="memo"||s==="sheet"?"m":s}`;d(y,{relative:"path"})}},[l,o.pathname,s,d]),j=g.useCallback(()=>{u.current="",c([]),d(`/${s==="memo"||s==="sheet"?"m":s}`)},[s,d]);return{openTabs:l,setOpenTabs:c,handleCloseTab:v,handleCloseAllTabs:j}}const Vs=()=>{const e=Z(),{user:s}=B(),a=Ft(Ht),r=D(),{rootDb:n,memoId:i}=g.useMemo(()=>{const p=r.pathname,y=p.startsWith("/m/sheet")?"sheet":p.startsWith("/m")?"memo":p.startsWith("/home")?"home":p.startsWith("/bible")?"bible":"default",T=p.split("/").pop()||"";return{rootDb:y,memoId:T}},[r.pathname]),l=r?.state?.reflash===!0,c=oe(),[u,o]=Fe(At),{memoDetailData:d,isLoading:m,onBookmark:v}=As(n,s,i,o),{openTabs:j,setOpenTabs:N,handleCloseTab:k,handleCloseAllTabs:f}=Ps(a,n,s,i,d);return g.useEffect(()=>{l&&c.invalidateQueries({queryKey:["memoDetail",n,s?.uid,i]})},[l,r.pathname,c,n,s?.uid,i]),g.useEffect(()=>{s===null&&r.pathname!=="/m"&&e("/m")},[s]),t.jsxs(t.Fragment,{children:[a&&t.jsx(Fs,{openTabs:j,setOpenTabs:N,handleCloseTab:k,handleCloseAllTabs:f,activeId:i}),t.jsx(Os,{rootDb:n,user:s,memoId:i,memoDetailData:d,isLoading:m,onBookmark:v,handleCloseTab:k})]})},Gs=Object.freeze(Object.defineProperty({__proto__:null,default:Vs},Symbol.toStringTag,{value:"Module"}));export{Gs as M,vs as a,Xs as b,Is as f,Qs as s,ps as u};
