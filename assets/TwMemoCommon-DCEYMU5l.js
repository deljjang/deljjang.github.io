const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CpxYBBTV.js","assets/index-DTGiKBHu.js","assets/index-BfTIv8j4.css","assets/SinyDate-Dhwqfnn5.js","assets/Grid-BsSPwgEU.js","assets/index-CBAoxdkT.js","assets/TextField-CqSNzfkv.js","assets/InputAdornment-mdcmjdpu.js","assets/Popper-B3WjklO_.js","assets/Chip-RaxRoktX.js","assets/index.esm-BeL0tiw-.js","assets/TwButton-Do1v6-Kl.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-CYnIB_DL.js","assets/IpInfo-CHVa8-Jn.js"])))=>i.map(i=>d[i]);
import{r as g,j as e,m as we,L as Ke,w as K,l as B,D as Ne,x as $e,S as Ce,T as Se,z as G,C as qe,q as Te,n as We,o as Ve,p as Le,t as De,G as Ie,y as ge,K as he,N as ae,i as xe,a1 as Re,H as fe,f as Ge,P as Je,Q as Qe,R as Ze,bO as Xe,U as Ee,W as E,X as Fe,Y as Pe,d3 as H,d4 as Be,$ as R,I as et,d5 as tt,d6 as st,d7 as at,a0 as ee,a2 as rt,a3 as nt,a4 as ot,a5 as q,a6 as lt}from"./index-DTGiKBHu.js";import{u as it}from"./useSuspenseQuery-CWruymj3.js";import{T as ct,u as ve,a as pe,F as dt,b as mt,D as Me,l as ut,I as gt,s as te,d as se,e as _e}from"./index-CpxYBBTV.js";import{E as ht,C as xt}from"./ExpandMore-J5q3_MxM.js";import{F as Ue}from"./Favorite-B1rA6-kZ.js";import{T as I}from"./TwButton-Do1v6-Kl.js";import{D as ft}from"./datetime-BDx6lZXm.js";import{u as Ae}from"./index.esm-BeL0tiw-.js";import"./SinyDate-Dhwqfnn5.js";import{f as vt}from"./index-CLQ_oLGC.js";import{I as pt}from"./TextField-CqSNzfkv.js";import{S as kt}from"./check-circle-BFUWBHqi.js";import"./useBaseQuery-CfKMiNPJ.js";import"./Grid-BsSPwgEU.js";import"./index-CBAoxdkT.js";import"./InputAdornment-mdcmjdpu.js";import"./Popper-B3WjklO_.js";import"./Chip-RaxRoktX.js";const bt=s=>g.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...s},g.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),yt=s=>g.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...s},g.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),jt=s=>e.jsx(we.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Ke,{to:s.to,className:"text-inherit no-underline cursor-pointer",...s,children:e.jsx(ct,{children:s.children})})});function wt({initTreeData:s}){const[a,o]=g.useState(),t=i=>o(i),u=K();if(g.useEffect(()=>{o(s)},[s]),a==null||a.length===0)return e.jsx(B,{});const k=i=>{console.log("node",i),u(`/m/${i.id}`)};return e.jsx(Ne,{backend:Ce,options:$e(),children:e.jsx(Se,{tree:a,rootId:"root",onDrop:t,render:(i,{depth:f,isOpen:n,onToggle:c})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:f*20+(i.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[i.cnt>0&&e.jsx("div",{onClick:c,children:n?e.jsx(ht,{}):e.jsx(xt,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>k(i),children:i.text})]}),i.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",i.cnt,")"]})]})})})}function Nt(s){const{user:a}=G(),o=K(),[t,u]=g.useState(),[k,i]=g.useState(),f=async n=>{const c=[],d=Te(Le(De,`memo_tree/${n}`),Ve("bm"),We("Y")),v=await Ie(d);if(!v.exists()){console.log("getFireData.null");return}const w=v.val();for(let C in w){const y=w[C];y.id=C,y.key=C,y.text=y.title,c.push(y)}c.sort((C,y)=>C.title>y.title?1:-1),u([...c])};return g.useEffect(()=>{a!==void 0&&a!=null&&f(a?.uid)},[a]),g.useEffect(()=>{const n=async(c,d)=>{const v=[...d];if(d)for(const w of d){let C=w;for(;C.parent!=="root";){C.parent,C=await ge(`memo_tree/${c}/${C.parent}`);const y={id:C.key,text:C.title,droppable:!1,parent:C.parent};v.filter(j=>j.id===y.id).length===0&&v.push(y)}}for(const w of v){const C=w.id;w.cnt=v.filter(y=>y.parent===C).length}i(v)};t&&t.length>0&&n(a?.uid,t)},[t]),a===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(qe,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:t&&t.map((n,c)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{s.onSelected(n.key),o(`/m/${n.key}`)},children:e.jsx("span",{className:"text-base",children:n.title})})},c))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(g.Suspense,{fallback:e.jsx(B,{}),children:e.jsx(wt,{initTreeData:k,uid:a?.uid})})]})}const $t=s=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:`70px 70px 70px ${s.master?"70px":""}`},children:[s.master&&e.jsx(I,{size:"sm",variant:"outlined",color:"success",onClick:s.onUtil,children:"유틸"}),e.jsx(I,{size:"sm",variant:"outlined",color:"success",onClick:s.onEdit,children:"수정"}),e.jsx(I,{size:"sm",variant:"outlined",color:"warning",onClick:s.onNewMemo,children:"새글"}),e.jsx(I,{size:"sm",variant:"outlined",color:"error",onClick:s.onDelete,children:"삭제"})]}),Ct=s=>{const{rootDb:a,isLoading:o,memoDetailData:t}=s,{scrollYProgress:u}=ve(),k=pe(u,{stiffness:100,damping:30,restDelta:.001}),i=K(),f=g.useRef();f.current=s.searchWord;const{memoId:n}=he(),d=ae()?.state?.fullIndex,{user:v}=G(),w=()=>{const p=`/${a==="memo"?"m":a}/edit/${n}`;i(p,{state:{fullIndex:d}})},C=()=>{const p=`/${a==="memo"?"m":a}/util/${n}`;i(p,{state:{fullIndex:d}})},y=()=>{const p=`/${a==="memo"?"m":a}/insert/${n}`;i(p,{state:{fullIndex:d}})},h=async()=>{const p=a==="memo"?`${a}_txt/${v.uid}/${n}`:`${a}_txt/${n}`,x=a==="memo"?`${a}_tree/${v.uid}/${n}`:`${a}/${n}`;await mt(p,x)!==void 0&&(s.onTreeUpdate(),i(`/${a==="memo"?"m":a}`))},j=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&h()},m=()=>{s.onBookmark()};return g.useEffect(()=>{t&&t.title!==void 0&&xe({title:t.title,description:t.title});function p(){window.scrollTo({top:0}),t&&t.html!=="N"&&document.querySelectorAll("pre").forEach(x=>{x.innerHTML=Ze(x.innerHTML)})}t&&t.memo!==null&&(p(),t.image&&t.image.map((x,N)=>(console.log("image."+N+"=",x.key),x)))},[t]),o?e.jsx(B,{}):n===""||v===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(we.div,{className:"progress-bar",style:{scaleX:k}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:t&&t.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:m,children:t&&t.bookmark==="Y"?e.jsx(Ue,{className:"text-red-500"}):e.jsx(dt,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s.memoDetailData?.path&&s.memoDetailData?.path.map((p,x)=>x===0?p?.text:` > ${p?.text}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx($t,{master:v?.uid===Re,rootDb:a,onEdit:w,onUtil:C,onNewMemo:y,onDelete:j,bookmark:t&&t.bookmark}),e.jsxs("div",{className:"my-4",children:[t&&t.html==="N"?e.jsx(fe,{postData:t&&t.memo,highlightWord:f.current}):t&&t.html!=="N"&&t.memo&&e.jsx(Ge,{text:t.memo}),e.jsx(Je,{imageList:t&&t.image}),!t&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Qe,{})})})]})]})]})},Ye=({onSubmit:s,onCancel:a,isSubmitting:o,newMode:t=!1})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(I,{variant:"outlined",color:"success",disabled:o,onClick:u=>{u.preventDefault(),s(u)},children:[t?"새글":""," 저장"]}),e.jsx(I,{variant:"outlined",color:"error",onClick:u=>{u.preventDefault(),a()},children:"취소"})]}),be=({label:s,checked:a,id:o,onChange:t,className:u="",disabled:k=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${k?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:o,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${u}`,checked:a,onChange:i=>t(i.target.checked),disabled:k}),a&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),k&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:s})]}),Oe=g.forwardRef((s,a)=>{const{placeholder:o="Enter your message",rows:t=3,value:u="",onChange:k,className:i="",disabled:f=!1,error:n=!1,hint:c=""}=s,d=w=>{k&&k(w.target.value)};let v=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${i} `;return f?v+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":n?v+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":v+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:a,placeholder:o,rows:t,value:u,onChange:d,disabled:f,className:v}),c&&e.jsx("p",{className:`mt-2 text-sm ${n?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:c})]})}),W=({name:s,placeholder:a,value:o,onChange:t,className:u="",allClassName:k="",min:i,max:f,step:n,disabled:c=!1,success:d=!1,error:v=!1,control:w,rules:C=null,defaultValue:y="",...h})=>{const j=w?._formState?.errors?.[s],m=v||!!j,p=N=>{t&&t(N)};let x=` h-11 w-full rounded-lg border appearance-none px-4 py-2.5 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-hidden focus:ring-3  dark:bg-zinc-950 dark:text-white/90 dark:placeholder:text-white/30 ${u}`;return c?x+=" text-gray-500 border-gray-300 opacity-40 bg-gray-100 cursor-not-allowed dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700 opacity-40":m?x+="  border-red-500 focus:border-red-300 focus:ring-red-500/20 dark:text-red-400 dark:border-red-500 dark:focus:border-red-800":d?x+="  border-green-500 focus:border-green-300 focus:ring-green-500/20 dark:text-green-400 dark:border-green-500 dark:focus:border-green-800":x+=" bg-transparent text-gray-800 border-gray-300 focus:border-brand-300 focus:ring-brand-500/20 dark:border-gray-700 dark:text-white/90  dark:focus:border-brand-800",e.jsxs("div",{className:`relative ${k}`,children:[e.jsx("input",{type:"text",name:s,placeholder:a,onChange:p,min:i,max:f,step:n,disabled:c,className:x,...w?C?w.register(s,C):w.register(s):{},...h}),j&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:j.message})]})},ze=({name:s,options:a,rules:o,control:t,onChange:u,placeholder:k="Select Option",className:i="",allClassName:f=""})=>{const n=c=>{u(c)};return e.jsxs("div",{className:`relative ${f}`,children:[e.jsxs("select",{className:`h-11 w-full appearance-none rounded-lg border border-gray-300 
          bg-transparent px-4 py-2.5 pr-11 text-sm shadow-theme-xs placeholder:text-gray-400 
          focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 
          dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:placeholder:text-white/30 
          dark:focus:border-brand-800 dark:bg-dark-900
          ${i}`,name:s,...t?t.register(s,o):{},onChange:n,children:[e.jsx("option",{value:"",disabled:!0,className:"text-gray-700 dark:bg-zinc-950 dark:text-gray-400",children:k}),a.map(c=>e.jsx("option",{value:c.value,className:"text-gray-700 dark:bg-zinc-950 dark:text-gray-400",children:c.label},c.value))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 h-11",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})};var V={exports:{}},St=V.exports,ye;function Tt(){return ye||(ye=1,function(s,a){(function(o,t){t(a)})(St,function(o){var t=typeof window<"u"&&window.flatpickr!==void 0?window.flatpickr:{l10ns:{}},u={weekdays:{shorthand:["일","월","화","수","목","금","토"],longhand:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"]},months:{shorthand:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],longhand:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"]},ordinal:function(){return"일"},rangeSeparator:" ~ ",amPM:["오전","오후"]};t.l10ns.ko=u;var k=t.l10ns;o.Korean=u,o.default=k,Object.defineProperty(o,"__esModule",{value:!0})})}(V,V.exports)),V.exports}var Lt=Tt();function He({id:s,name:a,mode:o,onChange:t,label:u,defaultDate:k,placeholder:i,control:f,rules:n=null,...c}){return g.useEffect(()=>{const d=vt(`#${s}`,{mode:o||"single",static:!1,monthSelectorType:"static",dateFormat:"Y-m-d",defaultDate:k,onChange:t,position:"auto",positionElement:void 0,locale:Lt.Korean});return()=>{d&&!Array.isArray(d)&&d.destroy()}},[o,t,s,k]),e.jsxs("div",{children:[u&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:s,children:u}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:s,name:a,...f?n?f.register(a,n):f.register(a):{},...c,placeholder:i,className:"h-11 w-full rounded-lg border appearance-none px-4 py-2.5 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-hidden focus:ring-3  dark:bg-zinc-950 dark:text-white/90 dark:placeholder:text-white/30  bg-transparent text-gray-800 border-gray-300 focus:border-brand-300 focus:ring-brand-500/20 dark:border-gray-700  dark:focus:border-brand-800"}),e.jsx("span",{className:"absolute text-gray-500 -translate-y-1/2 pointer-events-none right-3 top-1/2 dark:text-gray-400",children:e.jsx(Xe,{className:"size-6"})})]})]})}const Dt=g.lazy(()=>Pe(()=>import("./index-CpxYBBTV.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])));ut.Quill.register("modules/imageDrop",gt);Fe.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const It={syntax:{highlight:s=>Fe.highlightAuto(s).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},Rt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],Et=s=>{const[a,o]=g.useState(s.imageList),[t,u]=g.useState(s.htmlCheck==="Y"),[k,i]=g.useState(s.iconCheck==="Y"),[f,n]=g.useState(s.newMode?"":s.content),[c,d]=g.useState(),v=g.useRef(),w=g.useRef(),C=g.useRef(null);g.useRef(null);const y=g.useRef(null),h=s.newMode,j=g.useRef([]),{height:m}=Ee(),p=ft.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),x={edTitle:h?"":s.title,edGbn:s.gbn?s.gbn:"etc",edDate:h?p:s.date,content:h?"":s.content,memoTxt:h?"":s.content,htmlCheck:s.htmlCheck,iconCheck:s.iconCheck},{register:N,handleSubmit:L,trigger:F,control:D,setValue:P,getValues:Y,watch:re,formState:{errors:ke,isSubmitting:ne}}=Ae({mode:"onChange",defaultValues:x});g.useEffect(()=>{N("edDate"),N("edGbn",{required:!0}),N("htmlCheck"),N("iconCheck"),N("memoTxt")},[]),g.useEffect(()=>{j.current=[],v.current=s.content,w.current=!1},[s.content]);const J=async l=>{h?await s.onNewSubmit(l,j.current):await s.onPostSubmit(l,a,j.current)},oe=()=>{L(J)()},le=l=>{console.log("onDelete.imageList=",l),o(l)},ie=l=>{console.log("onInsert.file",l);let $=v.current;l.ext==="jpg"||l.ext==="png"?($+=`<img src='${l.url}'/>`,b(`<img src='${l.url}'/>
`)):l.ext==="mp4"?($+=`<video preload="auto" controls="" src='${l.url}'></video>`,b(`<video preload="auto" controls="" src='${l.url}'></video>`)):($+=`<a src='${l.url}'>${l.name}}</a>`,b(`다운로드
<a href="${l.url}" target="_blank">${l.name}</a>
`)),v.current=$},M=l=>s.onRename(l,Y("edTitle")),A=l=>{v.current=l},ce=l=>{console.log("handleFileUpload",l),j.current=l};function de(l){v.current=l,P("content",l),F("content")}const Q=(l,$)=>{console.log(`onChecked.e.${l}=`,$),P(l,$?"Y":"N"),console.log(`onChecked.v.${l}=`,Y(l)),l==="htmlCheck"?u($):i($)},me=re("content"),ue=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],r=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],b=l=>{const $=C.current;if($){const z=$.selectionStart,U=$.selectionEnd,O=f.slice(0,z),Z=f.slice(U);n(O+l+Z),P("memoTxt",O+l+Z),setTimeout(()=>{$.selectionStart=$.selectionEnd=z+l.length,$.focus()},0)}},S=l=>{b(l)},T=l=>l?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(l)||l.includes("image")||l.includes("img"):!1,_=l=>new Promise(($,z)=>{const U=new Image;U.crossOrigin="anonymous",U.onload=()=>{const O=document.createElement("canvas"),Z=O.getContext("2d");O.width=U.width,O.height=U.height,Z.drawImage(U,0,0);try{const X=O.toDataURL("image/png");console.log("convertImageToBase64.base64=",X.substring(0,30)+"..."),$(X)}catch(X){z(X)}},U.onerror=()=>{z(new Error("Failed to load image"))},U.src=l});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:L(J),style:{width:"100%",minHeight:"300px",maxHeight:{height:m},display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsx(be,{id:"htmlCheck",checked:t,onChange:l=>Q("htmlCheck",l),label:"HTML사용"}),e.jsx(be,{id:"iconCheck",checked:k,onChange:l=>Q("iconCheck",l),label:"Icon"}),e.jsx(Ye,{onSubmit:l=>oe(),onCancel:s.onCancel,isSubmitting:ne,newMode:h})]}),e.jsx(Me,{control:D,onDelete:le,onInsert:ie,onRename:M,setContent:A,onFileUpload:ce,imageList:s.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(W,{name:"edTitle",placeholder:"제목",control:D,rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:l=>{l.preventDefault(),P("edTitle",l.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ze,{name:"edGbn",label:"구분",control:D,rules:{required:!0},placeholder:"-- 구분 --",options:ue,className:"",allClassName:"max-w-40",onChange:l=>{l.preventDefault();const $=l.target.value;console.log("edGbn=",Y("edGbn")),P("edGbn",$)}}),e.jsx(He,{id:"edDate",name:"edDate",placeholder:"Select a date",control:D,onChange:(l,$)=>{console.log({dates:l,currentDateString:$}),P("edDate",$)}})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(fe,{postData:f})}),e.jsxs("div",{children:[e.jsx(Oe,{ref:C,className:"",value:f,onChange:l=>{P("memoTxt",l),n(l)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S(`<box>
</box>`),children:"<Box>"}),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<hr style="width=100%"/>'),children:"line"}),r.map((l,$)=>e.jsx(E,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>S("<code>"+l+`
</code>`),children:l},$))]})]}),Y("edUrl")&&T(Y("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:c,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async l=>{try{const $=await _(c);P("edUrl2",$)}catch($){console.error("Base64 conversion failed:",$)}},onError:l=>{l.target.style.display="none"}})})]}),t&&e.jsx(g.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(Dt,{ref:y,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:me,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:It,formats:Rt,onChange:de})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},je=s=>{const{rootDb:a,isLoading:o,memoDetailData:t}=s,{scrollYProgress:u}=ve();pe(u,{stiffness:100,damping:30,restDelta:.001});const k=K(),i=g.useRef(),f=g.useRef();f.current=s.searchWord;const{memoId:n}=he(),c=ae(),{user:d}=G();i.current=c.pathname.split("/")[2]==="insert",console.log("memoDetailData=",t);const v=()=>{const m=`/${a==="memo"?"m":a}/${n==="insert"?"":n}`;k(m)},w=async m=>{await H(d.uid,n,m)},C=async m=>{if(console.log("onFilePathList.fileNm=",m),m.length>0)for(let p=0;p<m.length;p++){const x=m[p];console.log("onFilePathList.file=",x);try{const N=await H(d.uid,n,x);console.log("onFilePathList.path=",N)}catch{console.log("onFilePathList.error=",x)}}else await H(d.uid,n,m)},y=async(m,p)=>{console.log("onNewSubmit.values",m);const x=await te({rootDb:a,uid:d.uid,newData:i.current,key:n==="insert"?"root":n,values:m});if(await se(`${a}_txt`,a,x,p),x!==void 0){const N=`/${a==="memo"?"m":a}/${x}`;k(N,{state:{reflash:!0}})}},h=async(m,p)=>{const x=a==="memo"?`${a}/${d.uid}/`:`${a}/`,N=await Be(x,m.key,p,m.ext);if(N.success){const L=a==="memo"?`${a}_txt/${d.uid}/${n}/image/`:`${a}_txt/${n}/image/`;return R(L+m.key,null),m.key=N.key,m.url=N.url,m.name=N.key+"."+m.ext,R(L+N.key,m),console.log("onRename.file",m),m}},j=async(m,p,x)=>{const N=a==="memo"?`${a}_txt/${d.uid}/`:`${a}_txt/`;a==="memo"?`${a}${d.uid}`:`${a}`,await _e(N,a==="memo"?`${a}/${d.uid}/`:`${a}/`,n,p),console.log("onPostSubmit.values",m);const L=await te({rootDb:a,uid:d.uid,newData:i.current,key:n==="insert"?"root":n,values:m});console.log("onPostSubmit.newKey=",L),console.log("onPostSubmit.files=",x);const F=await se(`${N}`,a==="memo"?`${a}/${d.uid}/`:`${a}/`,n,x);console.log("onNewSubmit.imageResult",F),a==="memo"&&R(`memo_tree/${d.uid}/${n}/title`,m.edTitle),i.current=!1;const D=`/${a==="memo"?"m":a}/${n}`;a==="home"&&R("home/tree",null),k(D,{state:{reflash:!0}})};return g.useEffect(()=>{t&&t.title!==void 0&&xe({title:t.title,description:t.title});function m(){document.querySelectorAll("pre").forEach((p,x)=>{})}t&&t.memo!==null&&m()},[t]),n===""||d===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",o),t===void 0||o?e.jsx(B,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:i.current===!1&&t&&(t.title===void 0||t.title===""||t.title===null)?e.jsx(B,{}):e.jsx(Et,{newMode:i.current,onPostSubmit:j,onNewSubmit:y,onCancel:v,onRename:h,onFilePath:w,onFilePathList:C,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html==="Y"?"Y":"N":"Y",iconCheck:!t?.icon==="Y"?"Y":"N",content:t?.memo,imageList:t?.image})})}))};function Ft({initTreeData:s,userId:a,memoId:o,onClick:t}){const[u,k]=g.useState(s),{isMoble:i,height:f,width:n}=et(),c=g.useRef(),d=g.useRef(),v=(y,h)=>{if(h.dragSource.id!==void 0&&h.dropTargetId!==void 0){const j=`memo_tree/${a}/${h.dragSource.id}/parent`;R(j,h.dropTargetId)}k(y)};g.useEffect(()=>{(()=>{for(const h of s){const j=h.id;h.cnt=s.filter(m=>m.parent===j).length}k(s)})()},[s]);const w=(y,h)=>{const j=[],m=p=>{const x=h.find(N=>N.id===p);if(!x)return!1;if(x.parent&&x.parent!=="root"){if(m(x.parent))return j.push(x.parent),!0}else return!0;return!1};return m(y)?j.reverse():[]},C=y=>{if(!u||!y||!d.current)return;const h=w(y,u);h.length>0&&setTimeout(()=>{d.current.open(h)},500)};return g.useEffect(()=>{c.current===void 0&&o!==void 0&&(c.current=o,C(o))},[u]),u==null||u===""?e.jsx(B,{}):e.jsx(Ne,{backend:Ce,options:$e(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:f-220-(i?56:0)+(n>1024?60:0),width:"100%"},children:e.jsx(Se,{ref:d,tree:u,rootId:"root",onDrop:v,render:(y,{depth:h,isOpen:j,onToggle:m,isDragging:p,isDropTarget:x})=>e.jsxs("div",{className:`w-62 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ml-1 ${p?"opacity-50":""} ${x?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
              ${c.current===y.id?"bg-gray-200 dark:bg-gray-800 rounded-r-lg border-l-4 border-blue-500":""}
              `,style:{paddingLeft:h*20+(y.cnt===0?5:0)-(c.current===y.id?4:0)},children:[e.jsx("div",{className:"min-w-0",children:y.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:m,children:j?e.jsx(bt,{className:"size-6"}):e.jsx(yt,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{c.current=y.id,t(y)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[y.icon,y.text]}),y.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",y.cnt,")"]})]})]})})})})}const Pt=s=>{const a=g.useRef(null);function o(){s.onSearchDataBtn(a.current.value)}function t(){return s.onNewMemoBtn(),!1}function u(k){k.which===13&&o()}return e.jsxs(e.Fragment,{children:[e.jsx(pt,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:a,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:u}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(I,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:t,children:"새글"}),e.jsx(I,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:o,children:"조회"})]})]})},Bt=async(s,a,o,t)=>{let u="",k="",i={};((c,d,v)=>{k=c==="memo"?`${c}/${d}/${v}`:`${c}/${v}`,u=c==="memo"?`${c}_txt/${d}/${v}`:`${c}_txt/${v}`})(s,a,o);async function n(){if(u===void 0)return"";if(i=await ge(u),i===void 0){console.log("No data available"),i={code:"404",msg:"No data available"};return}if(i?.fullIndex,i.image!==void 0&&i.image!==null){const c=await tt(u,k,i.image);i.image=c,(i.imageOK===void 0||i.imageOK==="N")&&(c&&c.map(d=>{d.ext==="jpg"&&(i.memo=i.memo+`<img src='${d.url}'>`)}),R(`${u}/imageOK`,"Y"),R(`${u}/memo`,i.memo))}if(i.html!=="N"&&t!==void 0&&t!==""){console.log("fireMemoDetail.html=",i.html),console.log("fireMemoDetail.searchWord=",t);const c=new RegExp(t,"gi"),d=i.memo.replace(c,`<span class='lightext'>${t}</span>`);i.memo=d}}return await n(),i};async function Mt(s,a,o=""){if(a==null||a==="")return"";if(s==="home"){const c=await ge("home/tree");if(c!=null)try{return JSON.parse(c)}catch(d){console.error("Error parsing JSON data:",d)}}const t=s==="home"?"home_txt":o===""?`${s}_tree/${a}`:`${s}_txt/${a}`,u=Te(Le(De,t)),k=await Ie(u);if(!k.exists())return console.log("getTreeData.null"),null;if(!k.exists())return console.log("getTreeData.exists"),null;const i=k.val(),f=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],n=[];s==="home"&&n.push(...f);for(const c in i){const d=i[c];d.id=c;const v={id:c,key:c,text:d.title,parent:s==="home"?d.gbn:d.parent};s==="memo"?(v.icon=d.bm==="Y"?e.jsx(Ue,{className:"text-red-500"}):d.icon==="Y"?e.jsx(kt,{}):null,v.droppable=!0):v.droppable=!1,!((o===""||o===void 0||o===null)&&(v.parent===void 0||v.parent===null||v.parent===""))&&(s==="home"||o===""||o===void 0||o===null?n.push(v):(d.id=c,(d.memo+"").toLowerCase().indexOf(o.toLowerCase())>-1&&(v.parent="root",v.droppable=!1,n.push(v))))}return n.sort((c,d)=>c.title>d.title?1:-1),s==="home"&&R("home/tree",JSON.stringify(n)),n}const _t=s=>{const[a,o]=g.useState(s.imageList),[t,u]=g.useState(s.content),[k,i]=g.useState(),f=g.useRef(),n=g.useRef(),c=g.useRef(null),d=g.useRef([]),{height:v}=Ee(),w={edTitle:s.title,edGbn:s.gbn?s.gbn:"etc",edDate:s.date,content:s.content,memoTxt:s.content,htmlCheck:"N",iconCheck:"N"},{register:C,handleSubmit:y,trigger:h,control:j,setValue:m,getValues:p,watch:x,formState:{errors:N,isSubmitting:L}}=Ae({mode:"onChange",defaultValues:w});g.useEffect(()=>{C("edDate"),C("memoTxt")},[]),g.useEffect(()=>{d.current=[],f.current=s.content,n.current=!1},[s.content]);const F=async r=>{await s.onPostSubmit(r,a,d.current)},D=()=>{y(F)()},P=r=>{console.log("onDelete.imageList=",r),o(r)},Y=r=>{console.log("onInsert.file",r);let b=f.current;r.ext==="jpg"||r.ext==="png"?(b+=`<img src='${r.url}'/>`,M(`<img src='${r.url}'/>
`)):r.ext==="mp4"?(b+=`<video preload="auto" controls="" src='${r.url}'></video>`,M(`<video preload="auto" controls="" src='${r.url}'></video>`)):(b+=`<a src='${r.url}'>${r.name}}</a>`,M(`다운로드
<a href="${r.url}" target="_blank">${r.name}</a>
`)),f.current=b},re=r=>s.onRename(r,p("edTitle")),ke=r=>{f.current=r},ne=r=>{console.log("handleFileUpload",r),d.current=r};function J(r){M(`<img src='${r}'/>`)}function oe(){console.log("HtmlEditor.imageList=",a);let r="";a&&a.length>0&&a.map((b,S)=>{r+=`<img src="/data/memo/${b.key}.${b.ext}" style="width: 50px;"/>
`}),r!==""&&M(r)}const le=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],ie=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],M=r=>{const b=c.current;if(b){const S=b.selectionStart,T=b.selectionEnd,_=t.slice(0,S),l=t.slice(T);u(_+r+l),m("memoTxt",_+r+l),setTimeout(()=>{b.selectionStart=b.selectionEnd=S+r.length,b.focus()},100)}},A=r=>{M(r)},ce=r=>r?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(r)||r.includes("image")||r.includes("img"):!1,de=async()=>{const r=await st("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile.result=",r)},Q=async()=>{const r=await at("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile10.result=",r);let b="";r.map(S=>{b+=S+`
`}),M(b)},me=async()=>{const r=p("edFilePath");if(r===""){const b=[];let S=c.current.value;S=S.replace(/<img src="\/data\/memo\//g,""),S=S.replace(/ style="width: 50px;"/g,""),S=S.replace(/"\/>/g,""),S=S.replace(/ /g,""),S.split(`
`).forEach(async T=>{T.indexOf(".")>0&&(b.push(T),console.log(T))}),b.length>0&&(console.log(b),await s.onFilePathList(b))}else await s.onFilePath(r)},ue=r=>new Promise((b,S)=>{const T=new Image;T.crossOrigin="anonymous",T.onload=()=>{const _=document.createElement("canvas"),l=_.getContext("2d");_.width=T.width,_.height=T.height,l.drawImage(T,0,0);try{const $=_.toDataURL("image/png");console.log("convertImageToBase64.base64=",$.substring(0,30)+"..."),b($)}catch($){S($)}},T.onerror=()=>{S(new Error("Failed to load image"))},T.src=r});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:y(F),style:{width:"100%",minHeight:"300px",maxHeight:{height:v},display:"flex",flexDirection:"column"},children:[e.jsx(Ye,{onSubmit:r=>D(),onCancel:s.onCancel,isSubmitting:L}),e.jsx(Me,{control:j,onDelete:P,onInsert:Y,onRename:re,setContent:ke,onFileUpload:ne,imageList:s.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(W,{name:"edTitle",placeholder:"제목",control:j,rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:r=>{r.preventDefault(),m("edTitle",r.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ze,{name:"edGbn",label:"구분",control:j,rules:{required:!0},placeholder:"-- 구분 --",options:le,className:"",allClassName:"max-w-40",onChange:r=>{r.preventDefault();const b=r.target.value;console.log("edGbn=",p("edGbn")),m("edGbn",b)}}),e.jsx(He,{id:"edDate",name:"edDate",placeholder:"Select a date",control:j,onChange:(r,b)=>{console.log({dates:r,currentDateString:b}),m("edDate",b)}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{name:"edUrl",placeholder:"Base64로 만들 URL",control:j,allClassName:"w-full",onChange:r=>{r.preventDefault();const b=r.target.value;console.log("edUrl=",b),m("edUrl",b),i(b)}}),e.jsx(I,{variant:"outlined",color:"success",onClick:r=>{r.preventDefault(),J(p("edUrl2"))},children:"적용"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{name:"edUrl2",placeholder:"Base64 이미지 데이터",allClassName:"w-full",variant:"filled",size:"small",value:p("edUrl2")||""}),e.jsx(I,{variant:"outlined",color:"success",onClick:r=>{r.preventDefault(),oe()},children:"첨부추가"})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(W,{name:"edFilePath",placeholder:"이미지리스트에 추가할 파일명",allClassName:"w-full",control:j,onChange:r=>{r.preventDefault();const b=r.target.value;m("edFilePath",b)}}),e.jsx(I,{variant:"outlined",color:"success",onClick:r=>{r.preventDefault(),me()},children:"파일경로"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"outlined",color:"success",onClick:r=>{r.preventDefault(),de()},children:"전체파일"}),e.jsx(I,{variant:"outlined",color:"success",onClick:r=>{r.preventDefault(),Q()},children:"전체파일10"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(fe,{postData:t})})}),e.jsxs("div",{children:[e.jsx(Oe,{ref:c,className:"",value:t,onChange:r=>{m("memoTxt",r),u(r)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A(`<box>
</box>`),children:"<Box>"}),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(E,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<hr style="width=100%"/>'),children:"line"}),ie.map((r,b)=>e.jsx(E,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>A("<code>"+r+`
</code>`),children:r},b))]})]}),p("edUrl")&&ce(p("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:k,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async r=>{try{const b=await ue(k);m("edUrl2",b)}catch(b){console.error("Base64 conversion failed:",b)}},onError:r=>{r.target.style.display="none"}})})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},Ut=s=>{const{rootDb:a,isLoading:o,memoDetailData:t}=s,{scrollYProgress:u}=ve();pe(u,{stiffness:100,damping:30,restDelta:.001});const k=K(),i=g.useRef();i.current=s.searchWord;const{memoId:f}=he();ae();const{user:n}=G();console.log("memoDetailData=",t);const c=()=>{const h=`/${a==="memo"?"m":a}/${f==="insert"?"":f}`;k(h)},d=async h=>{await H(n.uid,f,h)},v=async h=>{if(console.log("onFilePathList.fileNm=",h),h.length>0)for(let j=0;j<h.length;j++){const m=h[j];console.log("onFilePathList.file=",m);try{const p=await H(n.uid,f,m);console.log("onFilePathList.path=",p)}catch{console.log("onFilePathList.error=",m)}}else await H(n.uid,f,h)},w=async(h,j)=>{console.log("onNewSubmit.values",h);const m=await te({rootDb:a,uid:n.uid,newData:!1,key:f,values:h});if(await se(`${a}_txt`,a,m,j),m!==void 0){const p=`/${a==="memo"?"m":a}/${m}`;k(p,{state:{reflash:!0}})}},C=async(h,j)=>{const m=a==="memo"?`${a}/${n.uid}/`:`${a}/`,p=await Be(m,h.key,j,h.ext);if(p.success){const x=a==="memo"?`${a}_txt/${n.uid}/${f}/image/`:`${a}_txt/${f}/image/`;return R(x+h.key,null),h.key=p.key,h.url=p.url,h.name=p.key+"."+h.ext,R(x+p.key,h),console.log("onRename.file",h),h}},y=async(h,j,m)=>{const p=a==="memo"?`${a}_txt/${n.uid}/`:`${a}_txt/`;a==="memo"?`${a}${n.uid}`:`${a}`,await _e(p,a==="memo"?`${a}/${n.uid}/`:`${a}/`,f,j),console.log("onPostSubmit.values",h);const x=await te({rootDb:a,uid:n.uid,newData:!1,key:f==="insert"?"root":f,values:h});console.log("onPostSubmit.newKey=",x),console.log("onPostSubmit.files=",m);const N=await se(`${p}`,a==="memo"?`${a}/${n.uid}/`:`${a}/`,f,m);console.log("onNewSubmit.imageResult",N),a==="memo"&&R(`memo_tree/${n.uid}/${f}/title`,h.edTitle);const L=`/${a==="memo"?"m":a}/${f}`;a==="home"&&R("home/tree",null),k(L,{state:{reflash:!0}})};return g.useEffect(()=>{t&&t.title!==void 0&&xe({title:t.title,description:t.title});function h(){document.querySelectorAll("pre").forEach((j,m)=>{})}t&&t.memo!==null&&h()},[t]),f===""||n===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",o),t===void 0||o?e.jsx(B,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:t&&(t.title===void 0||t.title===""||t.title===null)?e.jsx(B,{}):e.jsx(_t,{onPostSubmit:y,onNewSubmit:w,onCancel:c,onRename:C,onFilePath:d,onFilePathList:v,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html==="Y"?"Y":"N":"Y",iconCheck:!t?.icon==="Y"?"Y":"N",content:t?.memo,imageList:t?.image})})}))},At=g.lazy(async()=>await Pe(()=>import("./TwMemoMain-CYnIB_DL.js"),__vite__mapDeps([13,1,2,11,14]))),os=({rootDb:s})=>{const a=K(),{user:o}=G(),t=g.useRef(),u=g.useRef(!0),k=g.useRef(),i=g.useRef(),[f,n]=g.useState(),c=g.useRef(!1),d=ae(),v=g.useRef(!1);v.current=d?.state?.reflash===!0;const w=it({queryKey:["twTreeData",o?.uid,t.current],queryFn:()=>Mt(s,o?.uid,t.current)});w.data!==void 0&&w.data!==""&&!c.current&&(c.current=!0);const C=()=>{const x=f;x&&(x.bookmark=x.bookmark==="Y"?"N":"Y");const N=`memo_tree/${o.uid}/${i.current}/bm`;R(N,f.bookmark),n({...f,bookmark:x.bookmark})};g.useEffect(()=>{o!==void 0&&o!=null&&w.refetch()},[o]),g.useEffect(()=>{const x=async F=>{if(F!==""&&o){const D=await Bt(s,o?.uid,F,t.current);s==="memo"&&(D.path=Yt(w.data,F)),D.code==="404"&&(D.title="No title"),u.current=!1,n(D===void 0?{}:D)}},N=d.pathname.split("/"),L=N.length>2?N[N.length-1]:"";u.current=!0,x(L),i.current=L},[d.pathname,o,v.current]),g.useEffect(()=>{console.log("useEffect.reflash=",v.current),o!==void 0&&o!=null&&w.refetch()},[v.current]);const y=x=>{c.current=!1,x!==void 0&&(t.current=x),w.refetch()},h=x=>{x.id!==i.current&&(u.current=!0,a(`/${s==="memo"?"m":s}/${x.id}`))},j=()=>{if(o==null){alert("로그인 후 이용 가능합니다.");return}const x=`/${s==="memo"?"m":s}/insert/insert`;a(x)},m=x=>{},p=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3",children:e.jsx(jt,{to:"/m",children:s==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[s==="memo"?"":e.jsx(ee,{to:"/m",children:"메모"}),s==="memo"&&o?.uid==="I3cTgdCxwjhBBno4mtZYvnODPJu1"?e.jsx(ee,{to:"/home",children:"홈관리"}):null,e.jsx(ee,{to:"/todo",children:"TODO"}),e.jsx(ee,{to:"/tw",children:"Sheet"})]}),e.jsx(Pt,{onNewMemoBtn:j,onSearchDataBtn:y}),c.current&&w.isFetched?e.jsx(Ft,{expandIndex:k.current,initTreeData:w.data,userId:o?.uid,memoId:i.current,onClick:h}):o===void 0?e.jsx(e.Fragment,{}):e.jsx(B,{})]});return o&&o.uid===Re&&rt,e.jsxs(nt,{sideType:"memo",title:s==="memo"?"메모장":"홈페이지관리",sideContents:p,children:[e.jsx(g.Suspense,{fallback:e.jsx(B,{}),children:e.jsxs(ot,{children:[e.jsx(q,{path:"/edit/:memoId",element:e.jsx(je,{rootDb:s,isLoading:u.current,searchWord:t.current,memoDetailData:f})}),e.jsx(q,{path:"/insert/:memoId",element:e.jsx(je,{rootDb:s,isLoading:u.current,searchWord:t.current,memoDetailData:f})}),e.jsx(q,{path:"/util/:memoId",element:e.jsx(Ut,{rootDb:s,isLoading:u.current,searchWord:t.current,memoDetailData:f})}),e.jsx(q,{path:"/:memoId",element:e.jsx(Ct,{rootDb:s,isLoading:u.current,searchWord:t.current,memoDetailData:f,onTreeUpdate:y,onBookmark:C,data:w.data})}),e.jsx(q,{path:"*",element:e.jsx(At,{searchWord:t.current,data:w.data,onNewMemoBtn:j,title:s==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),s==="memo"?e.jsx(Nt,{onSelected:m}):"",e.jsx(lt,{})]})},Yt=(s,a)=>{let o=[],t=a;if(!s)return o;const u=s.find(k=>k.id===t);for(o.unshift(u),t=u?.parent;t!=null&&t!==""&&t!=="root";){const k=s.find(i=>i.id===t);t=k?.parent,o.unshift(k)}return o};export{os as default};
