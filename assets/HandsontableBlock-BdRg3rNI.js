import{j as N}from"./index-BUTaIAh4.js";import{j as F,t as T,k as Y,bw as w,bx as j,R as L,by as B,bz as z,bA as K,bB as U,bC as W,U as J}from"./App-CdriGxVX.js";import{r as b}from"./router-BlMcuVHC.js";import"./vendor-CCYiWZgt.js";U(W);J();const _=({id:o,rootDb:t,memoId:r,index:l,block:n,afterSelection:i,readOnly:a,showSearch:S=!0})=>{const h=b.useRef(null);b.useRef(null);const M=b.useMemo(()=>n.content.data?JSON.parse(JSON.stringify(n.content.data)):[],[n.content.data]),k=F(),{user:D}=T(),y=(s,u)=>{console.log("onUpdateBlock.blockId=",s,u),k(K({rootDb:t,userId:D.uid,memoId:r,blockId:l,content:u}))},R=async(s,u,g)=>{if(a)return;const C=h.current?.hotInstance;if(!C)return;const f=n.content.columns.map((e,c)=>({...e,width:C.getColWidth(c)}));y(o,{...n.content,columns:f})},I=(s,u,g)=>{if(a||g==="loadData")return;const C=h.current?.hotInstance;if(!C)return;console.log(`행 추가: ${u}개, 인덱스: ${s}, 소스: ${g}`);const f=C.getSourceData();f.map((e,c)=>{e.map((m,p)=>{m===null&&(f[c][p]="")})}),console.log("handleAfterCreateRow=",f),y(o,{...n.content,data:f})},H=(s,u)=>{if(a)return;const g=h.current?.hotInstance;if(!g)return;console.log(`행 삭제: ${u}개, 인덱스: ${s}`);const C=g.getSourceData();y(o,{...n.content,data:C})},A=(s,u)=>{if(a)return;const g=h.current?.hotInstance;if(!g)return;console.log(`열 삭제: ${u}개, 인덱스: ${s}`);const C=g.getSourceData(),f=n.content.columns.slice(0,s).concat(n.content.columns.slice(s+u)),e=f.map(c=>c.title);y(o,{...n.content,data:C,columns:f,colHeaders:e})},E=(s,u)=>{a||u==="loadData"||!s||typeof s!="object"||!Array.isArray(s)||k(z({rootDb:t,userId:D.uid,memoId:r,blockId:l,changes:s}))};return N.jsx(V,{hotRef:h,columns:n.content.columns,rowData:M,colorData:n.content.colorData,colorTextData:n.content.colorTextData,afterChange:E,afterSelection:i,afterCreateRow:I,afterRemoveRow:H,afterRemoveCol:A,handleAfterColumnResize:R,showSearch:S,readOnly:a,isDraggable:!1})},V=({hotRef:o,columns:t,rowData:r,colorData:l,colorTextData:n,afterChange:i,afterSelection:a,afterCreateRow:S,afterRemoveRow:h,afterRemoveCol:M,handleAfterColumnResize:k,showSearch:D,readOnly:y=!0})=>{const{theme:R}=Y(e=>({theme:e.theme.mode})),I=b.useRef(null),[H,A]=b.useState("");b.useEffect(()=>{const e=o.current?.hotInstance;if(!e||!r)return;let c=!1;try{l&&l.forEach((m,p)=>{m&&m.forEach((d,v)=>{const $=e.getCellMeta(p,v).backgroundColor,x=d||void 0;$!==x&&(e.setCellMeta(p,v,"backgroundColor",x),c=!0)})})}catch{}try{n&&n.forEach((m,p)=>{m&&m.forEach((d,v)=>{const $=e.getCellMeta(p,v).color,x=d||void 0;$!==x&&(e.setCellMeta(p,v,"color",x),c=!0)})})}catch{}c&&e.render()},[r,l,n,o]);const E=[],s=b.useMemo(()=>{if(!t)return;const e=[];return t.forEach((c,m)=>{c.select&&E.push({value:m,text:c.title,label:c.title}),e.push({...c,title:c.title})}),e},[t]),u=b.useMemo(()=>s&&s.map((e,c)=>{const{readOnly:m,...p}=e;let d={...p,theme:R,isFirstColumn:s.indexOf(e)===0,data:c,colorData:l,colorTextData:n};return e.type==="numeric"?d={...d,type:"numeric",numericFormat:{pattern:"0,0.00"},originalRenderer:w.renderers.NumericRenderer}:e.type==="date"?d={...d,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:G},originalRenderer:w.renderers.DateRenderer}:e.type==="checkbox"?d={...d,type:"checkbox",className:"htCenter",originalRenderer:w.renderers.CheckboxRenderer}:d.originalRenderer=w.renderers.TextRenderer,{...d,renderer:q}}),[s,R,l,n]),g=R==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",C=e=>{e.key==="Enter"&&(e.preventDefault(),f())},f=()=>{const e=I.current.value;A(e);const c=o.current?.hotInstance;c&&c.render()};return N.jsxs("div",{className:"TwHotTable w-full",children:[D&&N.jsx(j,{inputRef:I,onKeyDown:C,onSearch:f,className:"max-w-60"}),N.jsx(L,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:o,data:r,themeName:g,rowHeaders:!0,language:"ko-KR",colHeaders:t&&t.map(e=>e.title),autoWrapRow:!0,height:"auto",contextMenu:!y,search:H,observeChanges:!0,columnSorting:!0,afterChange:i,afterSelection:a,afterCreateRow:S,afterRemoveRow:h,afterRemoveCol:M,formulas:{engine:B.buildEmpty({licenseKey:"gpl-v3"})},columns:u,readOnly:y,manualColumnResize:!0,afterColumnResize:k,colWidths:t.map(e=>e.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})]})},q=(o,t,r,l,n,i,a)=>{typeof i=="number"&&!isNaN(i)?(i%1!==0?a.numericFormat={pattern:"0,0.00"}:a.numericFormat={pattern:"0,0"},w.renderers.NumericRenderer.apply(void 0,[o,t,r,l,n,i,a])):a.originalRenderer?a.originalRenderer.apply(void 0,[o,t,r,l,n,i,a]):w.renderers.TextRenderer.apply(void 0,[o,t,r,l,n,i,a]);const S=o.getSettings().search,h=a.theme,M=o.getCellMeta(r,l),k=a.backgroundColor||M.backgroundColor,D=a.color||M.color,y=a.colorData,R=a.colorTextData;t.style.backgroundColor="",t.style.color="",S&&i&&String(i).toLowerCase().includes(S.toLowerCase())?(t.style.backgroundColor=h==="dark"?"#facc15":"yellow",t.style.color="black"):(t.style.backgroundColor=k,k||(r%2===0?t.style.backgroundColor=h==="dark"?"#101010":"#ffffff":t.style.backgroundColor=h==="dark"?"#000000":"#f8f8f8")),D&&(t.style.color=D),y?.[r]?.[l]&&(t.style.backgroundColor=y[r]?.[l],t.classList.remove("htDimmed")),R?.[r]?.[l]&&(t.style.color=R[r]?.[l],t.classList.remove("htDimmed")),t.classList.remove("htDimmed")},G={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(o,t){const r=o.getDate(),l=o.getMonth()+1;return`${o.getFullYear()}-${l.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`},parse(o,t){const r=o.split("-");return new Date(r[0],r[1]-1,r[2])}};export{_ as HandsontableBlock};
