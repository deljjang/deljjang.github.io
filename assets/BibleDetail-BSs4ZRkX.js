import{j as t,m as C,r as x,w as R,P as H,q as Y,v as q,U as G,T as J,C as U,i as h,Y as O,G as d,b3 as D,Z as V,J as v,ai as W,b2 as Z,H as z,a5 as K,a6 as Q,aa as X}from"./index-ByiTqD5i.js";import{F as tt}from"./Favorite-ByO_SfvZ.js";import{u as et,B as nt}from"./BibleBookmarkText-x29aaj8S.js";import{b as st}from"./bibleJson-DmvV-gyR.js";import"./useQuery-DU1Gjau5.js";import"./useBaseQuery-Cn7Dt39z.js";function k({children:e,type:l}){switch(l){case"rotate":return t.jsx(C.div,{initial:{scale:0},animate:{rotate:180,scale:1},transition:{type:"spring",stiffness:260,damping:20,duration:2},children:e});case"slide":case"scale":default:return t.jsx(C.div,{whileHover:{scale:1},whileTap:{scale:.9},children:e})}}k.defaultProps={type:"scale"};const at=e=>{const l=new Array;if(e.data===void 0||e.data===null)return;const u=e.bibleId.split("_");for(let n=1;n<=e.data.cd3;n++){const c={nm:`${e.data.nm2}${n}장`,key:e.data.key};l.push(c)}return u&&u.length===3?t.jsxs(v,{variant:"h6",sx:{display:"flex",alignItems:"center",flexDirection:"column",mb:4},children:[e.nm," ",u[2]," 장"]}):t.jsxs(t.Fragment,{children:[t.jsx(v,{variant:"h6",sx:{display:"flex",alignItems:"center",flexDirection:"column",mb:4},children:e.nm}),t.jsx(d,{container:!0,spacing:2,columns:{xs:4,sm:6,md:10,lg:12},children:l.map((n,c)=>t.jsx(d,{item:!0,xs:1,md:1,children:t.jsx(W,{to:`/bible/${n.key}_${c+1}`,children:n.nm})},c))})]})},it=e=>{const l=e.dataText;if(e.data===void 0||e.data===null||l==null)return;const u=e.bibleId.split("_");return e.bibleId&&u.length!==3?t.jsx(t.Fragment,{}):t.jsxs(t.Fragment,{children:[t.jsx(v,{variant:"h6",sx:{display:"flex",alignItems:"center",flexDirection:"column",mb:4},children:e.nm}),l.map((n,c)=>{n.bm!==void 0&&console.log("item",e.cd4,n);let f="text.primary";e.cd4+""===n.cd4&&(f="warning.main");const i=e.bookmark?.data?.filter(s=>s.cd1===n.cd1&&s.cd2===n.cd2&&s.cd3===n.cd3&&s.cd4===n.cd4&&s.bookmark==="Y");return i&&i.length>0&&(n.bookmark="Y"),t.jsxs(d,{container:!0,spacing:2,columns:{xs:5,sm:6,md:10,lg:12},id:`id_${c+1}`,children:[t.jsx(d,{item:!0,xs:1,md:1,children:t.jsxs(h,{sx:{color:f,display:"flex"},children:[t.jsx(Z,{sx:{alignItems:"center",textAlign:"top"},onClick:()=>e.onBookmark(n),children:n.nm}),i&&i.length>0&&t.jsx(tt,{sx:{color:"red"}})]})}),t.jsx(d,{item:!0,xs:4,sm:5,md:9,lg:11,children:t.jsx(h,{sx:{color:f},children:t.jsx(z,{text:n.text})})})]},c)})]})},xt=()=>{const[e,l]=x.useState(null),[u,n]=x.useState(!0),{query:c,setBibleBookmark:f}=et(),i=x.useRef(),{bibleId:s}=R(),p=H(),[y,B]=x.useState(!1),[T,I]=x.useState(!1),{user:F}=Y(),g=p?.state?.word,b=p?.state?.cd4,E=q();x.useEffect(()=>{if(s!==void 0){(async()=>{const r=await N(s,g);l(r),n(!1)})(),B(!1),I(!0);const a=s.split("_");if(a.length===3){const r=i.current.cd3;B(Number(a[2])!==1),I(a[2]<r)}}},[s,g]),x.useEffect(()=>{b!==void 0&&setTimeout(()=>{A("","id_"+b)},1500)},[e,b]);const A=(o,a)=>{const r=document.getElementById(a);r&&r.scrollIntoView({block:"center",behavior:"smooth"})},M=o=>{F!==void 0&&f(o)},N=async(o,a)=>{if(o===""||o===void 0)return"";const r=o.split("_");if(!(r.length<1)&&(i.current=st[r[0]][r[1]],console.log("bibleTitle=",i),r.length===3)){const S=K(Q,`bible_${r[0]}/${r[1]}/${r[2]}`),w=await X(S);if(w.exists()){const L=w.val(),_=new Array;return Object.values(L).map(m=>{if(m===void 0)return;let j=m.txt;if(a!==void 0){const P=new RegExp(a,"gi");j=j.replace(P,`<span class='lightext'>${a}</span>`)}m.nm=`${i.current.nm2}${r[2]}:${m.cd4}`,m.text=j,_.push(m)}),_}else return}};if(s==="")return t.jsx(t.Fragment,{});const $=o=>{console.log("onMove",o);let a=s.split("_");a[2]=Number(a[2])+o,console.log("onMove.tmp",a),E(`/bible/${a[0]}_${a[1]}_${a[2]}`)};return t.jsxs(G.Fragment,{children:[t.jsx("div",{id:"back-to-top-anchor"}),t.jsx(nt,{}),t.jsx(J,{children:i.current!==null&&i.current!==void 0&&i.current.nm!==null?i.current.nm:""}),t.jsx(at,{data:i.current,bibleId:s}),t.jsx(it,{dataText:e,data:i.current,searchWord:g,bibleId:s,cd4:b,bookmark:c,onBookmark:M}),t.jsxs(U,{sx:{p:0},children:[u&&t.jsx(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:t.jsx(O,{sx:{mt:5}})}),s&&s.split("_").length===3?t.jsx(h,{sx:{display:"flex",justifyContent:"space-between",mt:5},children:t.jsxs(d,{container:!0,spacing:1,children:[y?t.jsx(d,{item:!0,xs:T?6:12,children:t.jsx(k,{children:t.jsx(D,{type:"button",variant:"outlined",onClick:()=>$(-1),fullWidth:!0,children:"< 이전"})})}):"",T?t.jsx(d,{item:!0,xs:y?6:12,children:t.jsx(k,{children:t.jsx(D,{type:"button",variant:"outlined",onClick:()=>$(1),fullWidth:!0,children:"다음 >"})})}):""]})}):""]}),t.jsx(V,{})]})};export{xt as BibleDetail,xt as default};
