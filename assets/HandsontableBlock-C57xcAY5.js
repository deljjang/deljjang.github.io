import{j as N}from"./index-6nPoEYnd.js";import{j as T,t as Y,k as j,bv as w,bw as L,R as z,bx as B,by as K,bz as U,bA as W,bB as $,U as J}from"./App-gfyO5pOu.js";import{r as b}from"./router-BlMcuVHC.js";import"./vendor-CCYiWZgt.js";W($);J();const _=({id:o,rootDb:t,memoId:r,index:c,block:n,afterSelection:i,readOnly:a,showSearch:S=!0})=>{const m=b.useRef(null);b.useRef(null);const M=b.useMemo(()=>n.content.data?JSON.parse(JSON.stringify(n.content.data)):[],[n.content.data]),D=T(),{user:k}=Y(),g=(u,C)=>{D(U({rootDb:t,userId:k.uid,memoId:r,blockId:c,content:C}))},R=async(u,C,y)=>{if(a)return;const d=m.current?.hotInstance;if(!d)return;const h=n.content.columns.map((e,s)=>({...e,width:d.getColWidth(s)}));g(o,{...n.content,columns:h})},I=(u,C,y)=>{if(a||y==="loadData")return;const d=m.current?.hotInstance;if(!d)return;const h=d.getSourceData();h.map((e,s)=>{e.map((l,p)=>{l===null&&(h[s][p]="")})}),g(o,{...n.content,data:h})},H=(u,C)=>{if(a)return;const y=m.current?.hotInstance;if(!y)return;const d=y.getSourceData();g(o,{...n.content,data:d})},E=(u,C)=>{if(a)return;const y=m.current?.hotInstance;if(!y)return;const d=y.getSourceData(),h=n.content.columns.slice(0,u).concat(n.content.columns.slice(u+C)),e=h.map(s=>s.title);g(o,{...n.content,data:d,columns:h,colHeaders:e})},A=(u,C)=>{a||C==="loadData"||!u||typeof u!="object"||!Array.isArray(u)||D(K({rootDb:t,userId:k.uid,memoId:r,blockId:c,changes:u}))};return N.jsx(V,{hotRef:m,columns:n.content.columns,rowData:M,colorData:n.content.colorData,colorTextData:n.content.colorTextData,afterChange:A,afterSelection:i,afterCreateRow:I,afterRemoveRow:H,afterRemoveCol:E,handleAfterColumnResize:R,showSearch:S,readOnly:a,isDraggable:!1})},V=({hotRef:o,columns:t,rowData:r,colorData:c,colorTextData:n,afterChange:i,afterSelection:a,afterCreateRow:S,afterRemoveRow:m,afterRemoveCol:M,handleAfterColumnResize:D,showSearch:k,readOnly:g=!0})=>{const{theme:R}=j(e=>({theme:e.theme.mode})),I=b.useRef(null),[H,E]=b.useState("");b.useEffect(()=>{const e=o.current?.hotInstance;if(!e||!r)return;let s=!1;try{c&&c.forEach((l,p)=>{l&&l.forEach((f,x)=>{const F=e.getCellMeta(p,x).backgroundColor,v=f||void 0;F!==v&&(e.setCellMeta(p,x,"backgroundColor",v),s=!0)})})}catch{}try{n&&n.forEach((l,p)=>{l&&l.forEach((f,x)=>{const F=e.getCellMeta(p,x).color,v=f||void 0;F!==v&&(e.setCellMeta(p,x,"color",v),s=!0)})})}catch{}s&&e.render()},[r,c,n,o]);const A=[],u=b.useMemo(()=>{if(!t)return;const e=[];return t.forEach((s,l)=>{s.select&&A.push({value:l,text:s.title,label:s.title}),e.push({...s,title:s.title})}),e},[t]),C=b.useMemo(()=>u&&u.map((e,s)=>{const{readOnly:l,...p}=e;let f={...p,theme:R,isFirstColumn:u.indexOf(e)===0,data:s,colorData:c,colorTextData:n};return e.type==="numeric"?f={...f,type:"numeric",numericFormat:{pattern:"0,0.00"},originalRenderer:w.renderers.NumericRenderer}:e.type==="date"?f={...f,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:G},originalRenderer:w.renderers.DateRenderer}:e.type==="checkbox"?f={...f,type:"checkbox",className:"htCenter",originalRenderer:w.renderers.CheckboxRenderer}:f.originalRenderer=w.renderers.TextRenderer,{...f,renderer:q}}),[u,R,c,n]),y=R==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",d=e=>{e.key==="Enter"&&(e.preventDefault(),h())},h=()=>{const e=I.current.value;E(e);const s=o.current?.hotInstance;s&&s.render()};return N.jsxs("div",{className:"TwHotTable w-full",children:[k&&N.jsx(L,{inputRef:I,onKeyDown:d,onSearch:h,className:"max-w-60"}),N.jsx(z,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:o,data:r,themeName:y,rowHeaders:!0,language:"ko-KR",colHeaders:t&&t.map(e=>e.title),autoWrapRow:!0,height:"auto",contextMenu:!g,search:H,observeChanges:!0,columnSorting:!0,afterChange:i,afterSelection:a,afterCreateRow:S,afterRemoveRow:m,afterRemoveCol:M,formulas:{engine:B.buildEmpty({licenseKey:"gpl-v3"})},columns:C,readOnly:g,manualColumnResize:!0,afterColumnResize:D,colWidths:t.map(e=>e.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})]})},q=(o,t,r,c,n,i,a)=>{typeof i=="number"&&!isNaN(i)?(i%1!==0?a.numericFormat={pattern:"0,0.00"}:a.numericFormat={pattern:"0,0"},w.renderers.NumericRenderer.apply(void 0,[o,t,r,c,n,i,a])):a.originalRenderer?a.originalRenderer.apply(void 0,[o,t,r,c,n,i,a]):w.renderers.TextRenderer.apply(void 0,[o,t,r,c,n,i,a]);const S=o.getSettings().search,m=a.theme,M=o.getCellMeta(r,c),D=a.backgroundColor||M.backgroundColor,k=a.color||M.color,g=a.colorData,R=a.colorTextData;t.style.backgroundColor="",t.style.color="",S&&i&&String(i).toLowerCase().includes(S.toLowerCase())?(t.style.backgroundColor=m==="dark"?"#facc15":"yellow",t.style.color="black"):(t.style.backgroundColor=D,D||(r%2===0?t.style.backgroundColor=m==="dark"?"#101010":"#ffffff":t.style.backgroundColor=m==="dark"?"#000000":"#f8f8f8")),k&&(t.style.color=k),g?.[r]?.[c]&&(t.style.backgroundColor=g[r]?.[c],t.classList.remove("htDimmed")),R?.[r]?.[c]&&(t.style.color=R[r]?.[c],t.classList.remove("htDimmed")),t.classList.remove("htDimmed")},G={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(o,t){const r=o.getDate(),c=o.getMonth()+1;return`${o.getFullYear()}-${c.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`},parse(o,t){const r=o.split("-");return new Date(r[0],r[1]-1,r[2])}};export{_ as HandsontableBlock};
