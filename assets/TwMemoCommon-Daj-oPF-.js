import{G as N,e as B,r as m,w as E,cf as S,j as e,cg as W,M as h,x as $,ch as C,ci as O,k as M,cj as U,n as q,v as d,bk as H,s as K}from"./index-Dlo5qAfl.js";import{T as y,a as Q,b as Y,c as _,d as D}from"./TwMemoMain-CtGz23_3.js";import{f as G}from"./fireMemoDetail-DupTvcft.js";import{g as z,H as A}from"./HomeChartForm-D2xM7G9T.js";import"./TwTitleItem-BNWZ9GOM.js";import"./SinyImageList-nRMRVb2p.js";import"./ImageListItem-CwrH3-4m.js";import"./HtmlCode-rMC-Snn1.js";/* empty css                 */import"./copy-L5q-H5_2.js";import"./TwBadge-ebvrhaJy.js";import"./ComponentCard-D48S9Twc.js";import"./TwRadio-DOQD7TFc.js";import"./toPropertyKey-DCwh5dYN.js";import"./CodeText-CcKt_NMF.js";import"./commonUtil-D6sNiGcV.js";import"./useWindowDimensions-DIlp-qYM.js";import"./datetime-BDx6lZXm.js";import"./index.esm-CVkuEgIk.js";import"./TwCheckbox-Dlrwv6U0.js";import"./TwTextArea-DaBplPdm.js";import"./SinyDate-B2UnZu6-.js";import"./Grid-BZTQCb5O.js";import"./index-CTtl7xg0.js";import"./TextField-BJwzc22I.js";import"./InputAdornment-BKz_AKED.js";import"./Popper-BgVt-nsZ.js";import"./Button-FMDonRCy.js";import"./Chip-BYp4Kq0g.js";import"./TwSelect-B--Vprlm.js";import"./TwDatePicker-2DZhglEn.js";import"./IpInfo-BISogSUG.js";import"./HomeChartSemiDonut-C-TMZc-Z.js";const Re=({rootDb:t})=>{const p=N(),{user:r}=B(),s=m.useRef(),i=m.useRef(!0),o=m.useRef(),[c,x]=m.useState(),f=m.useRef(!1),j=E(),k=m.useRef(!1);k.current=j?.state?.reflash===!0;const n=S({queryKey:["twTreeData",r?.uid,s.current],queryFn:()=>z(t,r?.uid,s.current)});n.data!==void 0&&n.data!==""&&!f.current&&(f.current=!0);const L=()=>{const a=c;a&&(a.bookmark=a.bookmark==="Y"?"N":"Y"),console.log("onBookmark.memoDetailData.bookmark=",a.bookmark),console.log("onBookmark.rootDb=",t);const u=t==="memo"?`memo_tree/${r.uid}/${o.current}/bm`:`home_txt/${o.current}/bookmark`;K(u,c.bookmark),x({...c,bookmark:a.bookmark})};m.useEffect(()=>{r!==void 0&&r!=null&&n.refetch()},[r]),m.useEffect(()=>{const a=async T=>{if(T!==""&&r){const l=await G(t,r?.uid,T,s.current);t==="memo"&&(l.path=J(n.data,T)),l.code==="404"&&(l.title="No title"),i.current=!1,x(l===void 0?{}:l)}else x({})},u=j.pathname.split("/"),v=u.length>2?u[u.length-1]:"";i.current=!0,o.current=v,a(v)},[j.pathname,r,k.current]),m.useEffect(()=>{r!==void 0&&r!=null&&n.refetch()},[k.current]);const w=a=>{f.current=!1,a!==void 0&&(s.current=a),n.refetch()},I=a=>{a.id!==o.current&&(i.current=!0,p(`/${t==="memo"?"m":t}/${a.id}`))},g=()=>{if(r==null){alert("로그인 후 이용 가능합니다.");return}const a=`/${t==="memo"?"m":t}/insert/insert`;p(a)},F=a=>{},R=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3 flex items-center justify-center",children:e.jsx(W,{to:t==="memo"?"/m":"/home",children:t==="memo"?"메모장":"홈관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[t==="memo"?"":e.jsx(h,{to:"/m",children:"메모"}),t==="memo"&&r?.uid===$?e.jsx(h,{to:"/home",children:"홈관리"}):null,e.jsx(h,{to:"/todo",children:"TODO"}),e.jsx(h,{to:"/tw",children:"Sheet"})]}),r!==null&&e.jsx(C,{onNewMemoBtn:g,onSearchDataBtn:w}),f.current&&n.isFetched?e.jsx(O,{initTreeData:n.data,userId:r?.uid,memoId:o.current,onClick:I}):r===null?e.jsx(e.Fragment,{}):e.jsx(M,{})]});return e.jsxs(U,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:R,children:[e.jsx(m.Suspense,{fallback:e.jsx(M,{}),children:e.jsxs(q,{children:[e.jsx(d,{path:"/edit/:memoId",element:e.jsx(y,{rootDb:t,isLoading:i.current,searchWord:s.current,memoDetailData:c})}),e.jsx(d,{path:"/insert/:memoId",element:e.jsx(y,{rootDb:t,isLoading:i.current,searchWord:s.current,memoDetailData:c})}),e.jsx(d,{path:"/util/:memoId",element:e.jsx(Q,{rootDb:t,isLoading:i.current,searchWord:s.current,memoDetailData:c})}),e.jsx(d,{path:"/:memoId",element:e.jsx(Y,{rootDb:t,isLoading:i.current,searchWord:s.current,memoDetailData:c,onTreeUpdate:w,onBookmark:L,data:n.data})}),e.jsx(d,{path:"*",element:e.jsx(_,{searchWord:s.current,data:n.data,onNewMemoBtn:g,title:t==="memo"?"메모장":"홈페이지관리",rootDb:t})})]})}),t==="memo"?e.jsx(D,{onSelected:F}):null,o.current===""?e.jsx(A,{data:n.data}):null,e.jsx(H,{})]})},J=(t,p)=>{let r=[],s=p;if(!t)return r;const i=t.find(o=>o.id===s);for(r.unshift(i),s=i?.parent;s!=null&&s!==""&&s!=="root";){const o=t.find(c=>c.id===s);s=o?.parent,r.unshift(o)}return r};export{Re as default};
