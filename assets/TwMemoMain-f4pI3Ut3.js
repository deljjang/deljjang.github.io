const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomeChartForm-d-P6s9-t.js","assets/index-CWXZ9Iq7.js","assets/index-D5pUttOI.css","assets/fireMemoDetail-BduFqwbn.js","assets/SinyDate-CpWx5gc7.js","assets/Grid-Bx-A-J7h.js","assets/index-DuSkT2D9.js","assets/TextField-XAy3nOlk.js","assets/InputAdornment-CDjNKjRu.js","assets/Popper-CsuMSaOJ.js","assets/Button-BeXkAMi8.js","assets/Chip-Dj2J4FBL.js","assets/index.esm-DUnqmaXe.js","assets/TwTitleItem-DohviPhG.js","assets/HomeChartSemiDonut-DsEJtQFt.js","assets/HomeChartForm-DlNaLvKe.css"])))=>i.map(i=>d[i]);
import{e as Q,G as oe,r as m,j as e,k as K,q as Te,c8 as Le,o as Ie,a as Fe,f as Pe,S as Re,c7 as Ee,bf as R,E as ue,w as ge,bd as Ue,N as Be,x as _e,I as Me,K as Ae,T as O,H as we,_ as He,s as _}from"./index-CWXZ9Iq7.js";import{T as Ye,u as he,a as xe,F as qe,f as Ge,D as je,l as Ve,I as ze,s as te,b as se,c as ke}from"./HomeChartForm-d-P6s9-t.js";import{a as Je}from"./TwTitleItem-DohviPhG.js";import{S as Ke}from"./SinyImageList-BNGkuYN9.js";import{L as We,H as fe}from"./HtmlCode-CDmNEW7V.js";import{c as Oe}from"./CodeText-BRVgeDAS.js";import{s as ve}from"./commonUtil-B50YfFwa.js";import{u as ye}from"./useWindowDimensions-CUP5TSpt.js";import{D as Qe}from"./datetime-BDx6lZXm.js";import{u as pe}from"./index.esm-DUnqmaXe.js";import{T as me}from"./TwCheckbox-C9vQDU0i.js";import{T as Ce}from"./TwTextArea-BF_wguLQ.js";import{T as P}from"./TwBadge-D7d4nW_h.js";import"./SinyDate-CpWx5gc7.js";import{T as $e}from"./TwSelect-avrh6J9j.js";import{T as Ne}from"./TwDatePicker-nJc40A4s.js";import{g as J,s as De,a as Ze,b as Xe}from"./fireMemoDetail-BduFqwbn.js";import{I as et}from"./IpInfo-1Q595Rrq.js";function $t({onSelected:l}){const{user:t}=Q(),D=oe(),[s,$]=m.useState(),[S,T]=m.useState(),x=async r=>{const k=[],u=Te(Fe(Pe,`memo_tree/${r}`),Ie("bm"),Le("Y")),y=await Re(u);if(!y.exists())return console.log("getBookmark.getFireData.null"),null;const b=y.val();for(let h in b){const f=b[h];f.id=h,f.key=h,f.text=f.title,k.push(f)}k.sort((h,f)=>h.title>f.title?1:-1),$([...k])};return m.useEffect(()=>{t!==void 0&&t!=null&&x(t?.uid)},[t]),m.useEffect(()=>{const r=async(k,u)=>{const y=[...u];if(u)for(const b of u){let h=b;for(;h.parent!==void 0&&h.parent!=="root";){const f=h.parent;h=await Ee(`memo_tree/${k}/${f}`);const c={id:h.key,text:h.title,droppable:!1,parent:h.parent};y.filter(n=>n.id===c.id).length===0&&y.push(c)}}for(const b of y){const h=b.id;b.cnt=y.filter(f=>f.parent===h).length}T(y)};s&&s.length>0&&r(t?.uid,s)},[s]),t===null?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Je,{children:"주요 목록"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((r,k)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{l(r.key),D(`/m/${r.key}`)},children:e.jsx("span",{className:"text-base",children:r.title})})},k))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-3"}),e.jsx(m.Suspense,{fallback:e.jsx(K,{}),children:e.jsx(Ye,{initTreeData:S,uid:t?.uid})})]})}const tt=l=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:`70px 70px 70px ${l.master?"70px":""}`},children:[l.master&&e.jsx(R,{size:"sm",variant:"outlined",color:"brand",onClick:l.onUtil,children:"유틸"}),e.jsx(R,{size:"sm",variant:"outlined",color:"blue",onClick:l.onEdit,children:"수정"}),e.jsx(R,{size:"sm",variant:"outlined",color:"warning",onClick:l.onNewMemo,children:"새글"}),e.jsx(R,{size:"sm",variant:"outlined",color:"error",onClick:l.onDelete,children:"삭제"})]}),Nt=l=>{const{rootDb:t,isLoading:D,memoDetailData:s,onBookmark:$,onTreeUpdate:S,searchWord:T}=l,[x,r]=m.useState(!1),{scrollYProgress:k}=he(),u=xe(k,{stiffness:100,damping:30,restDelta:.001}),y=oe(),{memoId:b}=ue(),f=ge()?.state?.fullIndex,{user:c}=Q(),v=()=>{const j=`/${t==="memo"?"m":t}/edit/${b}`;y(j,{state:{fullIndex:f}})},n=()=>{const j=`/${t==="memo"?"m":t}/util/${b}`;y(j,{state:{fullIndex:f}})},d=()=>{const j=`/${t==="memo"?"m":t}/insert/${b}`;y(j,{state:{fullIndex:f}})},w=async()=>{const j=t==="memo"?`${t}_txt/${c.uid}/${b}`:`${t}_txt/${b}`,L=t==="memo"?`${t}_tree/${c.uid}/${b}`:`${t}/${b}`;await Ge(j,L)!==void 0&&(S(),y(`/${t==="memo"?"m":t}`))},C=()=>{r(!0)},F=()=>{r(!1),w()};return m.useEffect(()=>{s&&s.title!==void 0&&ve({title:s.title,description:s.title});function j(){window.scrollTo({top:0}),s&&s.html!=="N"&&document.querySelectorAll("pre").forEach(L=>{L.innerHTML=Oe(L.innerHTML)})}s&&s.memo!==null&&(j(),s.image&&s.image.map((L,Y)=>(console.log("image."+Y+"=",L.key),L)))},[s]),D?e.jsx(K,{}):b===""||c===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(Ue.div,{className:"progress-bar",style:{scaleX:u}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:s&&s.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:$,children:s&&s.bookmark==="Y"?e.jsx(Be,{className:"text-red-500"}):e.jsx(qe,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s?.path&&s?.path.map((j,L)=>L===0?j?.title:` > ${j?.title}`)})]})]}),e.jsx(We,{isOpen:x,size:"sm",color:"warning",title:"삭제 확인",message:`하위 자료가 있는 경우 같이 삭제됩니다.
<br/>삭제하시겠습니까?`,onClose:()=>r(!1),onConfirm:()=>{F()}}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(tt,{master:c?.uid===_e,rootDb:t,onEdit:v,onUtil:n,onNewMemo:d,onDelete:C,bookmark:s&&s.bookmark}),e.jsxs("div",{className:"my-4",children:[s&&s.html==="N"?e.jsx(fe,{postData:s&&s.memo,highlightWord:T}):s&&s.html!=="N"&&s.memo&&e.jsx(Me,{text:s.memo}),e.jsx(Ke,{imageList:s&&s.image}),!s&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Ae,{})})})]})]})]})},Se=({onSubmit:l,onCancel:t,isSubmitting:D,newMode:s=!1})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(R,{variant:"outlined",color:"success",disabled:D,onClick:$=>{$.preventDefault(),l($)},children:[s?"새글":""," 저장"]}),e.jsx(R,{variant:"outlined",color:"error",onClick:$=>{$.preventDefault(),t()},children:"취소"})]}),st=m.lazy(()=>He(()=>import("./HomeChartForm-d-P6s9-t.js").then(l=>l.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])));Ve.Quill.register("modules/imageDrop",ze);we.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const ot={syntax:{highlight:l=>we.highlightAuto(l).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},at=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],nt=l=>{const[t,D]=m.useState(l.imageList),[s,$]=m.useState(l.htmlCheck==="Y"),[S,T]=m.useState(l.iconCheck==="Y"),[x,r]=m.useState(!1),[k,u]=m.useState(l.newMode?"":l.content),[y,b]=m.useState(),h=m.useRef(),f=m.useRef(),c=m.useRef(null);m.useRef(null);const v=m.useRef(null),n=l.newMode,d=m.useRef([]),{height:w}=ye(),C=Qe.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),F={edTitle:n?"":l.title,edGbn:l.gbn?l.gbn:"etc",edDate:n?C:l.date,content:n?"":l.content,memoTxt:n?"":l.content,htmlCheck:l.htmlCheck,iconCheck:l.iconCheck},{register:j,handleSubmit:L,trigger:Y,control:q,setValue:E,getValues:A,watch:ae,formState:{errors:be,isSubmitting:ne}}=pe({mode:"onChange",defaultValues:F});m.useEffect(()=>{j("edDate"),j("edGbn",{required:!0}),j("htmlCheck"),j("iconCheck"),j("memoTxt")},[]),m.useEffect(()=>{d.current=[],h.current=l.content,f.current=!1},[l.content]);const Z=async a=>{n?await l.onNewSubmit(a,d.current):await l.onPostSubmit(a,t,d.current)},le=()=>{L(Z)()},U=a=>{console.log("onDelete.imageList=",a),D(a)},M=a=>{console.log("onInsert.file",a);let g=h.current;a.ext==="jpg"||a.ext==="png"?(g+=`<img src='${a.url}'/>`,N(`<img src='${a.url}'/>
`)):a.ext==="mp4"?(g+=`<video preload="auto" controls="" src='${a.url}'></video>`,N(`<video preload="auto" controls="" src='${a.url}'></video>`)):(g+=`<a src='${a.url}'>${a.name}}</a>`,N(`다운로드
<a href="${a.url}" target="_blank">${a.name}</a>
`)),h.current=g},re=a=>l.onRename(a,A("edTitle")),ie=a=>{h.current=a},ce=a=>{console.log("handleFileUpload",a),d.current=a};function de(a){h.current=a,E("content",a),Y("content")}const W=(a,g)=>{console.log(`onChecked.e.${a}=`,g),E(a,g?"Y":"N"),console.log(`onChecked.v.${a}=`,A(a)),a==="htmlCheck"?$(g):a==="rootCheck"?r(g):T(g)},o=ae("content"),i=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],p=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],N=a=>{const g=c.current;if(g){const z=g.selectionStart,B=g.selectionEnd,H=k.slice(0,z),X=k.slice(B);u(H+a+X),E("memoTxt",H+a+X),setTimeout(()=>{g.selectionStart=g.selectionEnd=z+a.length,g.focus()},0)}},I=a=>{N(a)},G=a=>a?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(a)||a.includes("image")||a.includes("img"):!1,V=a=>new Promise((g,z)=>{const B=new Image;B.crossOrigin="anonymous",B.onload=()=>{const H=document.createElement("canvas"),X=H.getContext("2d");H.width=B.width,H.height=B.height,X.drawImage(B,0,0);try{const ee=H.toDataURL("image/png");console.log("convertImageToBase64.base64=",ee.substring(0,30)+"..."),g(ee)}catch(ee){z(ee)}},B.onerror=()=>{z(new Error("Failed to load image"))},B.src=a});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:L(Z),style:{width:"100%",minHeight:"300px",maxHeight:{height:w},display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsx(me,{id:"rootCheck",checked:x,onChange:a=>W("rootCheck",a),label:"root로 이동"}),e.jsx(me,{id:"htmlCheck",checked:s,onChange:a=>W("htmlCheck",a),label:"HTML사용"}),e.jsx(me,{id:"iconCheck",checked:S,onChange:a=>W("iconCheck",a),label:"Icon"}),e.jsx(Se,{onSubmit:a=>le(),onCancel:l.onCancel,isSubmitting:ne,newMode:n})]}),e.jsx(je,{control:q,onDelete:U,onInsert:M,onRename:re,setContent:ie,onFileUpload:ce,imageList:l.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(O,{name:"edTitle",placeholder:"제목",control:q,rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:a=>{a.preventDefault(),E("edTitle",a.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($e,{name:"edGbn",label:"구분",control:q,rules:{required:!0},placeholder:"-- 구분 --",options:i,className:"",allClassName:"max-w-40",onChange:a=>{a.preventDefault();const g=a.target.value;console.log("edGbn=",A("edGbn")),E("edGbn",g)}}),e.jsx(Ne,{id:"edDate",name:"edDate",placeholder:"Select a date",control:q,onChange:(a,g)=>{console.log({dates:a,currentDateString:g}),E("edDate",g)}})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(fe,{postData:k})}),e.jsxs("div",{children:[e.jsx(Ce,{ref:c,className:"",value:k,onChange:a=>{E("memoTxt",a),u(a)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>I(`<box>
</box>`),children:"<Box>"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>I('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>I('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>I('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>I('<hr style="width=100%"/>'),children:"line"}),p.map((a,g)=>e.jsx(P,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>I("<code>"+a+`
</code>`),children:a},g))]})]}),A("edUrl")&&G(A("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:y,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async a=>{try{const g=await V(y);E("edUrl2",g)}catch(g){console.error("Base64 conversion failed:",g)}},onError:a=>{a.target.style.display="none"}})})]}),s&&e.jsx(m.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(st,{ref:v,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:o,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:ot,formats:at,onChange:de})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},Dt=l=>{const{rootDb:t,isLoading:D,memoDetailData:s}=l,{scrollYProgress:$}=he();xe($,{stiffness:100,damping:30,restDelta:.001});const S=oe(),T=m.useRef(),x=m.useRef();x.current=l.searchWord;const{memoId:r}=ue(),k=ge(),{user:u}=Q();T.current=k.pathname.split("/")[2]==="insert",console.log("memoDetailData=",s);const y=()=>{const n=`/${t==="memo"?"m":t}/${r==="insert"?"":r}`;S(n)},b=async n=>{await J(u.uid,r,n)},h=async n=>{if(console.log("onFilePathList.fileNm=",n),n.length>0)for(let d=0;d<n.length;d++){const w=n[d];console.log("onFilePathList.file=",w);try{const C=await J(u.uid,r,w);console.log("onFilePathList.path=",C)}catch{console.log("onFilePathList.error=",w)}}else await J(u.uid,r,n)},f=async(n,d)=>{console.log("onNewSubmit.values",n);const w=await te({rootDb:t,uid:u.uid,newData:T.current,key:r==="insert"?"root":r,values:n});if(await se(`${t}_txt`,t,w,d),w!==void 0){const C=`/${t==="memo"?"m":t}/${w}`;S(C,{state:{reflash:!0}})}},c=async(n,d)=>{const w=t==="memo"?`${t}/${u.uid}/`:`${t}/`,C=await De(w,n.key,d,n.ext);if(C.success){const F=t==="memo"?`${t}_txt/${u.uid}/${r}/image/`:`${t}_txt/${r}/image/`;return _(F+n.key,null),n.key=C.key,n.url=C.url,n.name=C.key+"."+n.ext,_(F+C.key,n),console.log("onRename.file",n),n}},v=async(n,d,w)=>{const C=t==="memo"?`${t}_txt/${u.uid}/`:`${t}_txt/`;t==="memo"?`${t}${u.uid}`:`${t}`,await ke(C,t==="memo"?`${t}/${u.uid}/`:`${t}/`,r,d),console.log("onPostSubmit.values",n);const F=await te({rootDb:t,uid:u.uid,newData:T.current,key:r==="insert"?"root":r,values:n});console.log("onPostSubmit.newKey=",F),console.log("onPostSubmit.files=",w);const j=await se(`${C}`,t==="memo"?`${t}/${u.uid}/`:`${t}/`,r,w);console.log("onNewSubmit.imageResult",j),t==="memo"&&(_(`memo_tree/${u.uid}/${r}/title`,n.edTitle),n.rootCheck==="Y"&&_(`memo_tree/${u.uid}/${r}/parent`,"root")),T.current=!1;const L=`/${t==="memo"?"m":t}/${r}`;t==="home"&&_("home/tree",null),S(L,{state:{reflash:!0}})};return m.useEffect(()=>{s&&s.title!==void 0&&ve({title:s.title,description:s.title});function n(){document.querySelectorAll("pre").forEach((d,w)=>{})}s&&s.memo!==null&&n()},[s]),r===""||u===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",D),s===void 0||D?e.jsx(K,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:T.current===!1&&s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(K,{}):e.jsx(nt,{newMode:T.current,onPostSubmit:v,onNewSubmit:f,onCancel:y,onRename:c,onFilePath:b,onFilePathList:h,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})}))},lt=l=>{const[t,D]=m.useState(l.imageList),[s,$]=m.useState(l.content),[S,T]=m.useState(),x=m.useRef(),r=m.useRef(),k=m.useRef(null),u=m.useRef([]),{height:y}=ye(),b={edTitle:l.title,edGbn:l.gbn?l.gbn:"etc",edDate:l.date,content:l.content,memoTxt:l.content,htmlCheck:"N",iconCheck:"N"},{register:h,handleSubmit:f,trigger:c,control:v,setValue:n,getValues:d,watch:w,formState:{errors:C,isSubmitting:F}}=pe({mode:"onChange",defaultValues:b});m.useEffect(()=>{h("edDate"),h("memoTxt")},[]),m.useEffect(()=>{u.current=[],x.current=l.content,r.current=!1},[l.content]);const j=async o=>{await l.onPostSubmit(o,t,u.current)},L=()=>{f(j)()},Y=o=>{console.log("onDelete.imageList=",o),D(o)},q=o=>{console.log("onInsert.file",o);let i=x.current;o.ext==="jpg"||o.ext==="png"?(i+=`<img src='${o.url}'/>`,U(`<img src='${o.url}'/>
`)):o.ext==="pdf"?(i+=`<PDF>${o.url}</PDF>`,U(`<PDF>${o.url}</PDF>`)):o.ext==="mp4"?(i+=`<video preload="auto" controls="" src='${o.url}'></video>`,U(`<video preload="auto" controls="" src='${o.url}'></video>`)):(i+=`<a src='${o.url}'>${o.name}}</a>`,U(`다운로드
<a href="${o.url}" target="_blank">${o.name}</a>
`)),x.current=i},E=o=>l.onRename(o,d("edTitle")),A=o=>{x.current=o},ae=o=>{console.log("handleFileUpload",o),u.current=o};function be(o){U(`<img src='${o}'/>`)}function ne(){console.log("HtmlEditor.imageList=",t);let o="";t&&t.length>0&&t.map((i,p)=>{o+=`<img src="/data/memo/${i.key}.${i.ext}" style="width: 50px;"/>
`}),o!==""&&U(o)}const Z=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],le=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],U=o=>{const i=k.current;if(i){const p=i.selectionStart,N=i.selectionEnd,I=s.slice(0,p),G=s.slice(N);$(I+o+G),n("memoTxt",I+o+G),setTimeout(()=>{i.selectionStart=i.selectionEnd=p+o.length,i.focus()},100)}},M=o=>{U(o)},re=o=>o?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(o)||o.includes("image")||o.includes("img"):!1,ie=async()=>{const o=await Ze("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile.result=",o)},ce=async()=>{const o=await Xe("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile10.result=",o);let i="";o.map(p=>{i+=p+`
`}),U(i)},de=async()=>{const o=d("edFilePath");if(o===""){const i=[];let p=k.current.value;p=p.replace(/<img src="\/data\/memo\//g,""),p=p.replace(/ style="width: 50px;"/g,""),p=p.replace(/"\/>/g,""),p=p.replace(/ /g,""),p.split(`
`).forEach(async N=>{N.indexOf(".")>0&&(i.push(N),console.log(N))}),i.length>0&&(console.log(i),await l.onFilePathList(i))}else await l.onFilePath(o)},W=o=>new Promise((i,p)=>{const N=new Image;N.crossOrigin="anonymous",N.onload=()=>{const I=document.createElement("canvas"),G=I.getContext("2d");I.width=N.width,I.height=N.height,G.drawImage(N,0,0);try{const V=I.toDataURL("image/png");console.log("convertImageToBase64.base64=",V.substring(0,30)+"..."),i(V)}catch(V){p(V)}},N.onerror=()=>{p(new Error("Failed to load image"))},N.src=o});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:f(j),style:{width:"100%",minHeight:"300px",maxHeight:{height:y},display:"flex",flexDirection:"column"},children:[e.jsx(Se,{onSubmit:o=>L(),onCancel:l.onCancel,isSubmitting:F}),e.jsx(je,{control:v,onDelete:Y,onInsert:q,onRename:E,setContent:A,onFileUpload:ae,imageList:l.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(O,{name:"edTitle",placeholder:"제목",control:v,className:"w-full",rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:o=>{o.preventDefault(),n("edTitle",o.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($e,{name:"edGbn",label:"구분",control:v,rules:{required:!0},placeholder:"-- 구분 --",options:Z,className:"",allClassName:"max-w-40",onChange:o=>{o.preventDefault();const i=o.target.value;console.log("edGbn=",d("edGbn")),n("edGbn",i)}}),e.jsx(Ne,{id:"edDate",name:"edDate",placeholder:"Select a date",control:v,onChange:(o,i)=>{console.log({dates:o,currentDateString:i}),n("edDate",i)}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{name:"edUrl",placeholder:"Base64로 만들 URL",control:v,className:"w-full",allClassName:"w-full",onChange:o=>{o.preventDefault();const i=o.target.value;console.log("edUrl=",i),n("edUrl",i),T(i)}}),e.jsx(R,{variant:"outlined",color:"success",className:"w-25 h-9",onClick:o=>{o.preventDefault(),be(d("edUrl2"))},children:"적용"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{name:"edUrl2",placeholder:"Base64 이미지 데이터",className:"w-full",allClassName:"w-full",variant:"filled",size:"md",value:d("edUrl2")||""}),e.jsx(R,{variant:"outlined",color:"success",className:"w-25 h-9",onClick:o=>{o.preventDefault(),ne()},children:"첨부추가"})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(O,{name:"edFilePath",placeholder:"이미지리스트에 추가할 파일명",className:"w-full",allClassName:"w-full",control:v,onChange:o=>{o.preventDefault();const i=o.target.value;n("edFilePath",i)}}),e.jsx(R,{size:"sm",variant:"outlined",color:"success",className:"w-25 h-9",onClick:o=>{o.preventDefault(),de()},children:"파일경로"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{variant:"outlined",color:"success",onClick:o=>{o.preventDefault(),ie()},children:"전체파일"}),e.jsx(R,{variant:"outlined",color:"success",onClick:o=>{o.preventDefault(),ce()},children:"전체파일10"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(fe,{postData:s})})}),e.jsxs("div",{children:[e.jsx(Ce,{ref:k,className:"",value:s,onChange:o=>{n("memoTxt",o),$(o)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>M(`<box>
</box>`),children:"<Box>"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>M('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>M('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>M('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>M('<hr style="width=100%"/>'),children:"line"}),le.map((o,i)=>e.jsx(P,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>M("<code>"+o+`
</code>`),children:o},i))]})]}),d("edUrl")&&re(d("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:S,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async o=>{try{const i=await W(S);n("edUrl2",i)}catch(i){console.error("Base64 conversion failed:",i)}},onError:o=>{o.target.style.display="none"}})})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},St=l=>{const{rootDb:t,isLoading:D,memoDetailData:s}=l,{scrollYProgress:$}=he();xe($,{stiffness:100,damping:30,restDelta:.001});const S=oe(),T=m.useRef();T.current=l.searchWord;const{memoId:x}=ue();ge();const{user:r}=Q();console.log("memoDetailData=",s);const k=()=>{const c=`/${t==="memo"?"m":t}/${x==="insert"?"":x}`;S(c)},u=async c=>{await J(r.uid,x,c)},y=async c=>{if(console.log("onFilePathList.fileNm=",c),c.length>0)for(let v=0;v<c.length;v++){const n=c[v];console.log("onFilePathList.file=",n);try{const d=await J(r.uid,x,n);console.log("onFilePathList.path=",d)}catch{console.log("onFilePathList.error=",n)}}else await J(r.uid,x,c)},b=async(c,v)=>{console.log("onNewSubmit.values",c);const n=await te({rootDb:t,uid:r.uid,newData:!1,key:x,values:c});if(await se(`${t}_txt`,t,n,v),n!==void 0){const d=`/${t==="memo"?"m":t}/${n}`;S(d,{state:{reflash:!0}})}},h=async(c,v)=>{const n=t==="memo"?`${t}/${r.uid}/`:`${t}/`,d=await De(n,c.key,v,c.ext);if(d.success){const w=t==="memo"?`${t}_txt/${r.uid}/${x}/image/`:`${t}_txt/${x}/image/`;return _(w+c.key,null),c.key=d.key,c.url=d.url,c.name=d.key+"."+c.ext,_(w+d.key,c),console.log("onRename.file",c),c}},f=async(c,v,n)=>{const d=t==="memo"?`${t}_txt/${r.uid}/`:`${t}_txt/`;t==="memo"?`${t}${r.uid}`:`${t}`,await ke(d,t==="memo"?`${t}/${r.uid}/`:`${t}/`,x,v),console.log("onPostSubmit.values",c);const w=await te({rootDb:t,uid:r.uid,newData:!1,key:x==="insert"?"root":x,values:c});console.log("onPostSubmit.newKey=",w),console.log("onPostSubmit.files=",n);const C=await se(`${d}`,t==="memo"?`${t}/${r.uid}/`:`${t}/`,x,n);console.log("onNewSubmit.imageResult",C),t==="memo"&&_(`memo_tree/${r.uid}/${x}/title`,c.edTitle);const F=`/${t==="memo"?"m":t}/${x}`;t==="home"&&_("home/tree",null),S(F,{state:{reflash:!0}})};return m.useEffect(()=>{s&&s.title!==void 0&&ve({title:s.title,description:s.title});function c(){document.querySelectorAll("pre").forEach((v,n)=>{})}s&&s.memo!==null&&c()},[s]),x===""||r===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",D),s===void 0||D?e.jsx(K,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(K,{}):e.jsx(lt,{onPostSubmit:f,onNewSubmit:b,onCancel:k,onRename:h,onFilePath:u,onFilePathList:y,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})}))},Tt=({data:l,onNewMemoBtn:t,title:D,rootDb:s})=>{const{user:$}=Q();return e.jsx("div",{className:"justify-items-center space-y-6",children:e.jsxs("div",{className:"text-center mt-5 mb-7 p-8 bg-white dark:bg-gray-900 rounded-xl shadow-lg",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-3",children:D}),e.jsxs("div",{className:"grid gird-cols-1 md:grid-cols-5 items-center gap-3",children:[$===null?e.jsx("p",{className:"text-red-500 font-semibold text-lg text-left md:col-span-3",children:"로그인해야 이용 가능합니다."}):e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-left md:col-span-3",children:["좌측 사이드 메뉴에서 '새글' 버튼을 사용해 메모를 작성하거나, ",e.jsx("br",{}),"기존 메모를 선택하여 확인하세요."]}),e.jsx("div",{className:"w-full items-center justify-center md:col-span-2",children:e.jsx(et,{})})]})]})})};export{Dt as T,St as a,Nt as b,Tt as c,$t as d};
