const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BvTnFNny.js","assets/index-CiwQKD9P.js","assets/index-BA2SFqQN.css","assets/SinySelect-CBR8v6tX.js","assets/Grid-CLsQLbuN.js","assets/index-CTZaw2qb.js","assets/TextField-CHTkO-dw.js","assets/InputAdornment-FQ5e23IQ.js","assets/Popper-CrCV8MMV.js","assets/Chip-DFXC-xgE.js","assets/index.esm-C-m6GTFs.js","assets/TwButton-Byf-WtO8.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-DiM6cxQW.js","assets/IpInfo-Dxl76A7Z.js"])))=>i.map(i=>d[i]);
import{r as m,j as e,m as se,L as _e,w as Y,l as R,D as ae,x as re,S as ne,T as oe,z as W,C as Pe,q as ie,n as Ye,o as Ue,p as le,t as ce,G as de,y as V,K as me,N as K,i as ue,H as ge,f as He,P as ze,Q as Oe,R as Ae,U as We,V as q,W as P,X as he,Y as xe,d2 as qe,d3 as Ve,$ as E,I as Ke,d4 as Ge,a0 as z,a1 as Je,a2 as Qe,a3 as Xe,a4 as Ze,a5 as O,a6 as et}from"./index-CiwQKD9P.js";import{u as tt}from"./useSuspenseQuery-Bm1dhH4n.js";import{T as st,u as fe,a as pe,F as at,b as rt,D as nt,l as ot,I as it,s as X,d as Z,e as lt}from"./index-BvTnFNny.js";import{E as ct,C as dt}from"./ExpandMore-D2s41XX4.js";import{F as ve}from"./Favorite-CFlVWdH_.js";import{T}from"./TwButton-Byf-WtO8.js";import{D as mt}from"./datetime-BDx6lZXm.js";import{u as ut}from"./index.esm-C-m6GTFs.js";import"./index-CLQ_oLGC.js";import{S as gt,a as ht}from"./SinySelect-CBR8v6tX.js";import{T as A,I as xt}from"./TextField-CHTkO-dw.js";import{S as ft}from"./check-circle-B57P7WM8.js";import"./useBaseQuery-prUOtTS7.js";import"./Grid-CLsQLbuN.js";import"./index-CTZaw2qb.js";import"./InputAdornment-FQ5e23IQ.js";import"./Popper-CrCV8MMV.js";import"./Chip-DFXC-xgE.js";const pt=t=>m.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...t},m.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),vt=t=>m.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...t},m.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),kt=t=>e.jsx(se.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(_e,{to:t.to,className:"text-inherit no-underline cursor-pointer",...t,children:e.jsx(st,{children:t.children})})});function jt({initTreeData:t}){const[r,n]=m.useState(),s=o=>n(o),u=Y();if(m.useEffect(()=>{n(t)},[t]),r==null||r.length===0)return e.jsx(R,{});const x=o=>{console.log("node",o),u(`/m/${o.id}`)};return e.jsx(ae,{backend:ne,options:re(),children:e.jsx(oe,{tree:r,rootId:"root",onDrop:s,render:(o,{depth:k,isOpen:l,onToggle:i})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:k*20+(o.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[o.cnt>0&&e.jsx("div",{onClick:i,children:l?e.jsx(ct,{}):e.jsx(dt,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>x(o),children:o.text})]}),o.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",o.cnt,")"]})]})})})}function yt(t){const{user:r}=W(),n=Y(),[s,u]=m.useState(),[x,o]=m.useState(),k=async l=>{const i=[],c=ie(le(ce,`memo_tree/${l}`),Ue("bm"),Ye("Y")),d=await de(c);if(!d.exists()){console.log("getFireData.null");return}const v=d.val();for(let b in v){const f=v[b];f.id=b,f.key=b,f.text=f.title,i.push(f)}i.sort((b,f)=>b.title>f.title?1:-1),u([...i])};return m.useEffect(()=>{r!==void 0&&r!=null&&k(r?.uid)},[r]),m.useEffect(()=>{const l=async(i,c)=>{const d=[...c];if(c)for(const v of c){let b=v;for(;b.parent!=="root";){b.parent,b=await V(`memo_tree/${i}/${b.parent}`);const f={id:b.key,text:b.title,droppable:!1,parent:b.parent};d.filter(h=>h.id===f.id).length===0&&d.push(f)}}for(const v of d){const b=v.id;v.cnt=d.filter(f=>f.parent===b).length}o(d)};s&&s.length>0&&l(r?.uid,s)},[s]),r===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Pe,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((l,i)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{t.onSelected(l.key),n(`/m/${l.key}`)},children:e.jsx("span",{className:"text-base",children:l.title})})},i))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(m.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(jt,{initTreeData:x,uid:r?.uid})})]})}const bt=t=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(T,{size:"sm",variant:"outlined",color:"success",onClick:t.onEdit,children:"수정"}),e.jsx(T,{size:"sm",variant:"outlined",color:"warning",onClick:t.onNewMemo,children:"새글"}),e.jsx(T,{size:"sm",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"})]}),wt=t=>{const{rootDb:r,isLoading:n,memoDetailData:s}=t,{scrollYProgress:u}=fe(),x=pe(u,{stiffness:100,damping:30,restDelta:.001}),o=Y(),k=m.useRef();k.current=t.searchWord;const{memoId:l}=me(),c=K()?.state?.fullIndex,{user:d}=W(),v=()=>{const j=`/${r==="memo"?"m":r}/edit/${l}`;o(j,{state:{fullIndex:c}})},b=()=>{const j=`/${r==="memo"?"m":r}/insert/${l}`;o(j,{state:{fullIndex:c}})},f=async()=>{const j=r==="memo"?`${r}_txt/${d.uid}/${l}`:`${r}_txt/${l}`,w=r==="memo"?`${r}_tree/${d.uid}`:r;if(await rt(j,w)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}t.onTreeUpdate(),o(`/${r==="memo"?"m":r}`)},y=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&f()},h=()=>{t.onBookmark()};return m.useEffect(()=>{s&&s.title!==void 0&&ue({title:s.title,description:s.title});function j(){window.scrollTo({top:0}),s&&s.html!=="N"&&document.querySelectorAll("pre").forEach(w=>{w.innerHTML=Ae(w.innerHTML)})}s&&s.memo!==null&&(j(),console.log("useEffect.memoDetailData=",s))},[s]),n?e.jsx(R,{}):l===""||d===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(se.div,{className:"progress-bar",style:{scaleX:x}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:s&&s.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:h,children:s&&s.bookmark==="Y"?e.jsx(ve,{className:"text-red-500"}):e.jsx(at,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:t.memoDetailData?.path&&t.memoDetailData?.path.map((j,w)=>w===0?j?.text:` > ${j?.text}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(bt,{rootDb:r,onEdit:v,onNewMemo:b,onDelete:y,bookmark:s&&s.bookmark}),e.jsxs("div",{className:"my-4",children:[s&&s.html==="N"?e.jsx(ge,{postData:s&&s.memo}):s&&s.html!=="N"&&s.memo&&e.jsx(He,{text:s.memo}),e.jsx(ze,{imageList:s&&s.image}),!s&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Oe,{})})})]})]})]})},Ct=({onSubmit:t,onCancel:r,isSubmitting:n,newMode:s})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(T,{variant:"outlined",color:"success",disabled:n,onClick:u=>{u.preventDefault(),t(u)},children:[s?"새글":""," 저장"]}),e.jsx(T,{variant:"outlined",color:"error",onClick:u=>{u.preventDefault(),r()},children:"취소"})]});m.forwardRef((t,r)=>{const{id:n,label:s,defaultValue:u,onChange:x,className:o="",...k}=t,l=i=>{x&&x(i.target.value)};return e.jsxs("div",{className:` ${o}`,children:[s&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:n,children:s}),e.jsx("input",{ref:r,type:"date",id:n,defaultValue:u,onChange:l,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...k})]})});const ee=({label:t,checked:r,id:n,onChange:s,className:u="",disabled:x=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${x?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:n,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${u}`,checked:r,onChange:o=>s(o.target.checked),disabled:x}),r&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),x&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),t&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:t})]}),Nt=m.forwardRef((t,r)=>{const{placeholder:n="Enter your message",rows:s=3,value:u="",onChange:x,className:o="",disabled:k=!1,error:l=!1,hint:i=""}=t,c=v=>{x&&x(v.target.value)};let d=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${o} `;return k?d+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":l?d+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":d+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:r,placeholder:n,rows:s,value:u,onChange:c,disabled:k,className:d}),i&&e.jsx("p",{className:`mt-2 text-sm ${l?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:i})]})}),$t=m.lazy(()=>xe(()=>import("./index-BvTnFNny.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])));ot.Quill.register("modules/imageDrop",it);he.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const Dt={syntax:{highlight:t=>he.highlightAuto(t).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},Tt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],St=t=>{const[r,n]=m.useState(t.imageList),[s,u]=m.useState(t.htmlCheck==="Y"),[x,o]=m.useState(t.iconCheck==="Y"),[k,l]=m.useState(t.newMode?"":t.content),[i,c]=m.useState(),d=m.useRef(),v=m.useRef(),b=m.useRef(null);m.useRef(null);const f=m.useRef(null),y=t.newMode,h=m.useRef([]),{height:j}=We(),w=mt.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),p={edTitle:y?"":t.title,edGbn:t.gbn?t.gbn:"etc",edDate:y?w:t.date,content:y?"":t.content,memoTxt:y?"":t.content,htmlCheck:t.htmlCheck,iconCheck:t.iconCheck},{register:C,handleSubmit:M,trigger:S,control:L,setValue:I,getValues:D,watch:ke,formState:{errors:G,isSubmitting:je}}=ut({mode:"onChange",defaultValues:p});m.useEffect(()=>{C("edDate"),C("edGbn",{required:!0}),C("htmlCheck"),C("iconCheck"),C("memoTxt")},[]),m.useEffect(()=>{h.current=[],d.current=t.content,v.current=!1},[t.content]);const J=async a=>{y?await t.onNewSubmit(a,h.current):await t.onPostSubmit(a,r,h.current)},ye=()=>{M(J)()},be=a=>{console.log("onDelete.imageList=",a),n(a)},we=a=>{console.log("onInsert.file",a);let g=d.current;a.ext==="jpg"||a.ext==="png"?(g+=`<img src='${a.url}'/>`,F(`<img src='${a.url}'/>
`)):a.ext==="mp4"?(g+=`<video preload="auto" controls="" src='${a.url}'></video>`,F(`<video preload="auto" controls="" src='${a.url}'></video>`)):(g+=`<a src='${a.url}'>${a.name}}</a>`,F(`다운로드
<a href="${a.url}" target="_blank">${a.name}</a>
`)),d.current=g},Ce=a=>t.onRename(a,D("edTitle")),Ne=a=>{d.current=a},$e=a=>{console.log("handleFileUpload",a),h.current=a};function De(a){F(`<img src='${a}'/>`)}function Te(){console.log("HtmlEditor.imageList=",r);let a="";r&&r.length>0&&r.map((g,N)=>{a+=`<img src="/data/memo/${g.key}.${g.ext}" style="width: 50px;"/>
`}),a!==""&&F(a)}function Se(a){d.current=a,I("content",a),S("content")}function Le(a,g){console.log("handleChangeDate=",a),console.log("handleChangeDate.currentDateString=",g);let N=q(a);console.log("handleChangeDate.dayjs=",N.format("YYYY-MM-DD HH:mm:ss")),I("edDate",N.format("YYYY-MM-DD")),S("edDate")}const Q=(a,g)=>{console.log(`onChecked.e.${a}=`,g),I(a,g?"Y":"N"),console.log(`onChecked.v.${a}=`,D(a)),a==="htmlCheck"?u(g):o(g)},Ie=ke("content"),Ee=[{value:"none",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Re=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],F=a=>{const g=b.current;if(g){const N=g.selectionStart,$=g.selectionEnd,B=k.slice(0,N),U=k.slice($);l(B+a+U),I("memoTxt",B+a+U),setTimeout(()=>{g.selectionStart=g.selectionEnd=N+a.length,g.focus()},0)}},_=a=>{F(a)},Me=a=>a?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(a)||a.includes("image")||a.includes("img"):!1,Be=async()=>{const a=D("edFilePath");if(a===""){const g=[];let N=b.current.value;N=N.replace(/<img src="\/data\/memo\//g,""),N=N.replace(/ style="width: 50px;"/g,""),N=N.replace(/"\/>/g,""),N=N.replace(/ /g,""),N.split(`
`).forEach(async $=>{$.indexOf(".")>0&&(g.push($),console.log($))}),g.length>0&&(console.log(g),await t.onFilePath(g))}else await t.onFilePath(a)},Fe=a=>new Promise((g,N)=>{const $=new Image;$.crossOrigin="anonymous",$.onload=()=>{const B=document.createElement("canvas"),U=B.getContext("2d");B.width=$.width,B.height=$.height,U.drawImage($,0,0);try{const H=B.toDataURL("image/png");console.log("convertImageToBase64.base64=",H.substring(0,30)+"..."),g(H)}catch(H){N(H)}},$.onerror=()=>{N(new Error("Failed to load image"))},$.src=a});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:M(J),style:{width:"100%",minHeight:"300px",maxHeight:{height:j},display:"flex",flexDirection:"column"},children:[e.jsx(Ct,{onSubmit:a=>ye(),onCancel:t.onCancel,isSubmitting:je,newMode:y}),e.jsx(nt,{control:L,onDelete:be,onInsert:we,onRename:Ce,setContent:Ne,onFileUpload:$e,imageList:t.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(A,{...C("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!G.edTitle})}),e.jsx(gt,{id:"edGbn",name:"edGbn",label:"구분",control:L,defaultValue:D("edGbn"),selectList:Ee,error:!!G.edGbn,onChange:a=>{a.preventDefault();const g=a.target.value;console.log("edGbn=",D("edGbn")),I("edGbn",g)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ht,{id:"edDate",label:"일자",value:q(D("edDate")),...C("edDate"),defaultValue:q(D("edDate")),onChange:(a,g)=>{Le(a,g)}}),e.jsx(ee,{id:"htmlCheck",checked:s,onChange:a=>Q("htmlCheck",a),label:"HTML사용"}),e.jsx(ee,{id:"iconCheck",checked:x,onChange:a=>Q("iconCheck",a),label:"Icon"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2  items-center border-t border-gray-300 dark:border-gray-600 my-2",children:[e.jsx(A,{...C("edUrl",{}),label:"URL",placeholder:"URL",variant:"filled",size:"small",onChange:a=>{a.preventDefault();const g=a.target.value;console.log("edUrl=",g),I("edUrl",g),c(g)}}),e.jsx(A,{...C("edUrl2",{}),label:"Base64",placeholder:"Base64 이미지 데이터",variant:"filled",size:"small",value:D("edUrl2")||""}),e.jsx(T,{variant:"outlined",color:"success",onClick:a=>{a.preventDefault(),De(D("edUrl2"))},children:"적용"}),e.jsx(T,{variant:"outlined",color:"success",onClick:a=>{a.preventDefault(),Te()},children:"첨부추가"}),e.jsx(A,{...C("edFilePath",{}),variant:"filled",size:"small",onChange:a=>{a.preventDefault();const g=a.target.value;I("edFilePath",g)}}),e.jsx(T,{variant:"outlined",color:"success",onClick:a=>{a.preventDefault(),Be()},children:"파일경로"})]}),e.jsx("div",{className:"max-h-150 overflow-y-scroll",children:e.jsx(ge,{postData:k})})]}),e.jsxs("div",{children:[e.jsx(Nt,{ref:b,className:"",value:k,onChange:a=>{I("memoTxt",a),l(a)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_(`<box>
</box>`),children:"<Box>"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(P,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<hr style="width=100%"/>'),children:"line"}),Re.map((a,g)=>e.jsx(P,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_("<code>"+a+`
</code>`),children:a},g))]})]}),D("edUrl")&&Me(D("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:i,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async a=>{try{const g=await Fe(i);I("edUrl2",g)}catch(g){console.error("Base64 conversion failed:",g)}},onError:a=>{a.target.style.display="none"}})})]}),s&&e.jsx(m.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx($t,{ref:f,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:Ie,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:Dt,formats:Tt,onChange:Se})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},te=t=>{const{rootDb:r,isLoading:n,memoDetailData:s}=t,{scrollYProgress:u}=fe();pe(u,{stiffness:100,damping:30,restDelta:.001});const x=Y(),o=m.useRef(),k=m.useRef();k.current=t.searchWord;const{memoId:l}=me(),i=K(),{user:c}=W();o.current=i.pathname.split("/")[2]==="insert",console.log("memoDetailData=",s);const d=()=>{console.log("onCancel");const h=`/${r==="memo"?"m":r}/${l==="insert"?"":l}`;x(h)},v=async h=>{await qe(c.uid,l,h)},b=async(h,j)=>{console.log("onNewSubmit.values",h);const w=await X({rootDb:r,uid:c.uid,newData:o.current,key:l==="insert"?"root":l,values:h});if(await Z(`${r}_txt`,r,w,j),w!==void 0){const p=`/${r==="memo"?"m":r}/${w}`;x(p,{state:{reflash:!0}})}},f=async(h,j)=>{const w=r==="memo"?`${r}/${c.uid}/`:`${r}/`,p=await Ve(w,h.key,j,h.ext);if(p.success){const C=r==="memo"?`${r}_txt/${c.uid}/${l}/image/`:`${r}_txt/${l}/image/`;return E(C+h.key,null),h.key=p.key,h.url="",h.name=p.key+"."+h.ext,E(C+p.key,h),console.log("onRename.file",h),h}},y=async(h,j,w)=>{const p=r==="memo"?`${r}_txt/${c.uid}/`:`${r}_txt/`,C=r==="memo"?`${r}_tree/${c.uid}/`:`${r}/`;await lt(p,C,l,j),console.log("onPostSubmit.values",h);const M=await X({rootDb:r,uid:c.uid,newData:o.current,key:l==="insert"?"root":l,values:h});console.log("onPostSubmit.newKey=",M),console.log("onPostSubmit.files=",w);const S=await Z(`${p}`,r==="memo"?`${r}/${c.uid}/`:`${r}/`,l,w);console.log("onNewSubmit.imageResult",S),r==="memo"&&E(`memo_tree/${c.uid}/${l}/title`,h.edTitle),o.current=!1;const L=`/${r==="memo"?"m":r}/${l}`;r==="home"&&E("home/tree",null),x(L,{state:{reflash:!0}})};return m.useEffect(()=>{s&&s.title!==void 0&&ue({title:s.title,description:s.title});function h(){document.querySelectorAll("pre").forEach((j,w)=>{})}s&&s.memo!==null&&h()},[s]),l===""||c===void 0?e.jsx(e.Fragment,{}):s===void 0||n?e.jsx(R,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:o.current===!1&&s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(R,{}):e.jsx(St,{newMode:o.current,onPostSubmit:y,onNewSubmit:b,onCancel:d,onRename:f,onFilePath:v,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})})};function Lt({initTreeData:t,userId:r,memoId:n,onClick:s}){const[u,x]=m.useState(t),{isMoble:o,height:k,width:l}=Ke(),i=m.useRef(),c=m.useRef(),d=(f,y)=>{if(y.dragSource.id!==void 0&&y.dropTargetId!==void 0){const h=`memo_tree/${r}/${y.dragSource.id}/parent`;E(h,y.dropTargetId)}x(f)};m.useEffect(()=>{(()=>{for(const y of t){const h=y.id;y.cnt=t.filter(j=>j.parent===h).length}x(t)})()},[t]);const v=(f,y)=>{const h=[],j=w=>{const p=y.find(C=>C.id===w);if(!p)return!1;if(p.parent&&p.parent!=="root"){if(j(p.parent))return h.push(p.parent),!0}else return!0;return!1};return j(f)?h.reverse():[]},b=f=>{if(!u||!f||!c.current)return;const y=v(f,u);y.length>0&&setTimeout(()=>{c.current.open(y)},500)};return m.useEffect(()=>{i.current===void 0&&n!==void 0&&(i.current=n,b(n))},[u]),u==null||u===""?e.jsx(R,{}):e.jsx(ae,{backend:ne,options:re(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:k-220-(o?56:0)+(l>1024?60:0),width:"100%"},children:e.jsx(oe,{ref:c,tree:u,rootId:"root",onDrop:d,render:(f,{depth:y,isOpen:h,onToggle:j,isDragging:w,isDropTarget:p})=>e.jsxs("div",{className:`w-62 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ml-1 ${w?"opacity-50":""} ${p?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
              ${i.current===f.id?"bg-gray-200 dark:bg-gray-800 rounded-r-lg border-l-4 border-blue-500":""}
              `,style:{paddingLeft:y*20+(f.cnt===0?5:0)-(i.current===f.id?4:0)},children:[e.jsx("div",{className:"min-w-0",children:f.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:j,children:h?e.jsx(pt,{className:"size-6"}):e.jsx(vt,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{i.current=f.id,s(f)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[f.icon,f.text]}),f.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",f.cnt,")"]})]})]})})})})}const It=t=>{const r=m.useRef(null);function n(){t.onSearchDataBtn(r.current.value)}function s(){return t.onNewMemoBtn(),!1}function u(x){x.which===13&&n()}return e.jsxs(e.Fragment,{children:[e.jsx(xt,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:r,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:u}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(T,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:s,children:"새글"}),e.jsx(T,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:n,children:"조회"})]})]})},Et=async(t,r,n,s)=>{let u="",x="",o={};((i,c,d)=>{x=i==="memo"?`${i}/${c}/${d}`:`${i}/${d}`,u=i==="memo"?`${i}_txt/${c}/${d}`:`${i}_txt/${d}`})(t,r,n);async function l(){if(u===void 0)return"";if(o=await V(u),o===void 0){console.log("No data available"),o={msg:"No data available"};return}if(o?.fullIndex,o.image!==void 0&&o.image!==null){const i=await Ge(u,x,o.image);o.image=i,(o.imageOK===void 0||o.imageOK==="N")&&(i&&i.map(c=>{c.ext==="jpg"&&(o.memo=o.memo+`<img src='${c.url}'>`)}),E(`${u}/imageOK`,"Y"),E(`${u}/memo`,o.memo))}if(s!==void 0&&s!==""){const i=s,c=new RegExp(i,"gi"),d=o.memo.replace(c,`<span class='lightext'>${i}</span>`);o.memo=d}}return await l(),o};async function Rt(t,r,n=""){if(r==null||r==="")return"";if(t==="home"){const i=await V("home/tree");if(i!=null)try{return JSON.parse(i)}catch(c){console.error("Error parsing JSON data:",c)}}const s=t==="home"?"home_txt":n===""?`${t}_tree/${r}`:`${t}_txt/${r}`,u=ie(le(ce,s)),x=await de(u);if(!x.exists())return console.log("getTreeData.null"),null;if(!x.exists())return console.log("getTreeData.exists"),null;const o=x.val(),k=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],l=[];t==="home"&&l.push(...k);for(const i in o){const c=o[i];c.id=i;const d={id:i,key:i,text:c.title,parent:t==="home"?c.gbn:c.parent};t==="memo"?(d.icon=c.bm==="Y"?e.jsx(ve,{className:"text-red-500"}):c.icon==="Y"?e.jsx(ft,{}):null,d.droppable=!0):d.droppable=!1,!((n===""||n===void 0||n===null)&&(d.parent===void 0||d.parent===null||d.parent===""))&&(t==="home"||n===""||n===void 0||n===null?l.push(d):(c.id=i,(c.memo+"").toLowerCase().indexOf(n.toLowerCase())>-1&&(d.parent="root",d.droppable=!1,l.push(d))))}return l.sort((i,c)=>i.title>c.title?1:-1),t==="home"&&E("home/tree",JSON.stringify(l)),console.log("getTreeData.temp=",l?.length),l}const Mt=m.lazy(async()=>await xe(()=>import("./TwMemoMain-DiM6cxQW.js"),__vite__mapDeps([13,1,2,11,14]))),es=({rootDb:t})=>{const r=Y(),{user:n}=W(),s=m.useRef(),u=m.useRef(!0),x=m.useRef(),o=m.useRef(),[k,l]=m.useState(),i=m.useRef(!1),c=K(),d=m.useRef(!1);d.current=c?.state?.reflash===!0;const v=tt({queryKey:["twTreeData",n?.uid,s.current],queryFn:()=>Rt(t,n?.uid,s.current)});v.data!==void 0&&v.data!==""&&!i.current&&(i.current=!0);const b=()=>{const p=k;p&&(p.bookmark=p.bookmark==="Y"?"N":"Y");const C=`memo_tree/${n.uid}/${o.current}/bm`;E(C,k.bookmark),l({...k,bookmark:p.bookmark})};m.useEffect(()=>{n!==void 0&&n!=null&&v.refetch()},[n]),m.useEffect(()=>{const p=async S=>{if(S!==""&&n){const L=await Et(t,n?.uid,S,s.current);console.log("TwMemoCommon.getMemoDetailData.memoId=",S,"data=",L),t==="memo"&&(L.path=Bt(v.data,S)),u.current=!1,l(L===void 0?{}:L)}},C=c.pathname.split("/"),M=C.length>2?C[C.length-1]:"";u.current=!0,p(M),o.current=M},[c.pathname,n,d.current]),m.useEffect(()=>{console.log("useEffect.reflash=",d.current),n!==void 0&&n!=null&&v.refetch()},[d.current]);const f=p=>{i.current=!1,p!==void 0&&(s.current=p),v.refetch()},y=p=>{p.id!==o.current&&(u.current=!0,r(`/${t==="memo"?"m":t}/${p.id}`))},h=()=>{if(n==null){alert("로그인 후 이용 가능합니다.");return}const p=`/${t==="memo"?"m":t}/insert/insert`;r(p)},j=p=>{},w=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3",children:e.jsx(kt,{to:"/m",children:t==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[t==="memo"?"":e.jsx(z,{to:"/m",children:"메모"}),t==="memo"&&n?.uid==="I3cTgdCxwjhBBno4mtZYvnODPJu1"?e.jsx(z,{to:"/home",children:"홈관리"}):null,e.jsx(z,{to:"/todo",children:"TODO"}),e.jsx(z,{to:"/tw",children:"Sheet"})]}),e.jsx(It,{onNewMemoBtn:h,onSearchDataBtn:f}),i.current&&v.isFetched?e.jsx(Lt,{expandIndex:x.current,initTreeData:v.data,userId:n?.uid,memoId:o.current,onClick:y}):n===void 0?e.jsx(e.Fragment,{}):e.jsx(R,{})]});return n&&n.uid===Je&&Qe,e.jsxs(Xe,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:w,children:[e.jsx(m.Suspense,{fallback:e.jsx(R,{}),children:e.jsxs(Ze,{children:[e.jsx(O,{path:"/edit/:memoId",element:e.jsx(te,{rootDb:t,isLoading:u.current,searchWord:s.current,memoDetailData:k})}),e.jsx(O,{path:"/insert/:memoId",element:e.jsx(te,{rootDb:t,isLoading:u.current,searchWord:s.current,memoDetailData:k})}),e.jsx(O,{path:"/:memoId",element:e.jsx(wt,{rootDb:t,isLoading:u.current,searchWord:s.current,memoDetailData:k,onTreeUpdate:f,onBookmark:b,data:v.data})}),e.jsx(O,{path:"*",element:e.jsx(Mt,{searchWord:s.current,data:v.data,onNewMemoBtn:h,title:t==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),t==="memo"?e.jsx(yt,{onSelected:j}):"",e.jsx(et,{})]})},Bt=(t,r)=>{let n=[],s=r;if(!t)return n;const u=t.find(x=>x.id===s);for(n.unshift(u),s=u?.parent;s!=null&&s!==""&&s!=="root";){const x=t.find(o=>o.id===s);s=x?.parent,n.unshift(x)}return n};export{es as default};
