const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BbearoLc.js","assets/index-CeshW4c0.js","assets/index-CgZ_ufHP.css","assets/SinySelect-BKOa2JXK.js","assets/Grid-CHzmsupp.js","assets/index-DbRjgDQH.js","assets/TextField-mtyRnTaT.js","assets/InputAdornment-CtG84-LD.js","assets/Popper-DcO1DZef.js","assets/Chip-DZ_gmiI4.js","assets/index.esm-DnWJ2Tl3.js","assets/TwButton-BEUWBxxi.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-Bqu2mxX5.js","assets/IpInfo-CJ2zhH0Y.js"])))=>i.map(i=>d[i]);
import{r as u,j as e,m as ne,L as Ue,w as Y,l as F,D as ae,x as re,S as oe,T as ie,z as W,C as He,q as le,n as Ae,o as Oe,p as ce,t as de,G as me,y as K,K as ue,N as G,i as ge,H as he,f as ze,P as We,Q as qe,R as Ve,U as Ke,V as q,W as _,X as xe,d3 as Ge,d4 as Je,Y as fe,d5 as V,d6 as Qe,$ as R,I as Ze,d7 as Xe,a0 as A,a1 as et,a2 as tt,a3 as st,a4 as nt,a5 as O,a6 as at}from"./index-CeshW4c0.js";import{u as rt}from"./useSuspenseQuery-vkNP1ZfK.js";import{T as ot,u as pe,a as ve,F as it,b as lt,D as ct,l as dt,I as mt,s as X,d as ee,e as ut}from"./index-BbearoLc.js";import{E as gt,C as ht}from"./ExpandMore-BLz7AkgE.js";import{F as ke}from"./Favorite-OjGAk7no.js";import{T}from"./TwButton-BEUWBxxi.js";import{D as xt}from"./datetime-BDx6lZXm.js";import{u as ft}from"./index.esm-DnWJ2Tl3.js";import"./index-CLQ_oLGC.js";import{S as pt,a as vt}from"./SinySelect-BKOa2JXK.js";import{T as z,I as kt}from"./TextField-mtyRnTaT.js";import{S as jt}from"./check-circle-DVq06sC9.js";import"./useBaseQuery-DmjjdEVV.js";import"./Grid-CHzmsupp.js";import"./index-DbRjgDQH.js";import"./InputAdornment-CtG84-LD.js";import"./Popper-DcO1DZef.js";import"./Chip-DZ_gmiI4.js";const yt=t=>u.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...t},u.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),wt=t=>u.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),bt=t=>e.jsx(ne.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Ue,{to:t.to,className:"text-inherit no-underline cursor-pointer",...t,children:e.jsx(ot,{children:t.children})})});function Ct({initTreeData:t}){const[a,r]=u.useState(),s=o=>r(o),g=Y();if(u.useEffect(()=>{r(t)},[t]),a==null||a.length===0)return e.jsx(F,{});const f=o=>{console.log("node",o),g(`/m/${o.id}`)};return e.jsx(ae,{backend:oe,options:re(),children:e.jsx(ie,{tree:a,rootId:"root",onDrop:s,render:(o,{depth:j,isOpen:i,onToggle:l})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:j*20+(o.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[o.cnt>0&&e.jsx("div",{onClick:l,children:i?e.jsx(gt,{}):e.jsx(ht,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>f(o),children:o.text})]}),o.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",o.cnt,")"]})]})})})}function Nt(t){const{user:a}=W(),r=Y(),[s,g]=u.useState(),[f,o]=u.useState(),j=async i=>{const l=[],c=le(ce(de,`memo_tree/${i}`),Oe("bm"),Ae("Y")),m=await me(c);if(!m.exists()){console.log("getFireData.null");return}const k=m.val();for(let b in k){const p=k[b];p.id=b,p.key=b,p.text=p.title,l.push(p)}l.sort((b,p)=>b.title>p.title?1:-1),g([...l])};return u.useEffect(()=>{a!==void 0&&a!=null&&j(a?.uid)},[a]),u.useEffect(()=>{const i=async(l,c)=>{const m=[...c];if(c)for(const k of c){let b=k;for(;b.parent!=="root";){b.parent,b=await K(`memo_tree/${l}/${b.parent}`);const p={id:b.key,text:b.title,droppable:!1,parent:b.parent};m.filter(C=>C.id===p.id).length===0&&m.push(p)}}for(const k of m){const b=k.id;k.cnt=m.filter(p=>p.parent===b).length}o(m)};s&&s.length>0&&i(a?.uid,s)},[s]),a===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(He,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((i,l)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{t.onSelected(i.key),r(`/m/${i.key}`)},children:e.jsx("span",{className:"text-base",children:i.title})})},l))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(u.Suspense,{fallback:e.jsx(F,{}),children:e.jsx(Ct,{initTreeData:f,uid:a?.uid})})]})}const $t=t=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(T,{size:"sm",variant:"outlined",color:"success",onClick:t.onEdit,children:"수정"}),e.jsx(T,{size:"sm",variant:"outlined",color:"warning",onClick:t.onNewMemo,children:"새글"}),e.jsx(T,{size:"sm",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"})]}),Tt=t=>{const{rootDb:a,isLoading:r,memoDetailData:s}=t,{scrollYProgress:g}=pe(),f=ve(g,{stiffness:100,damping:30,restDelta:.001}),o=Y(),j=u.useRef();j.current=t.searchWord;const{memoId:i}=ue(),c=G()?.state?.fullIndex,{user:m}=W(),k=()=>{const d=`/${a==="memo"?"m":a}/edit/${i}`;o(d,{state:{fullIndex:c}})},b=()=>{const d=`/${a==="memo"?"m":a}/insert/${i}`;o(d,{state:{fullIndex:c}})},p=async()=>{const d=a==="memo"?`${a}_txt/${m.uid}/${i}`:`${a}_txt/${i}`,w=a==="memo"?`${a}_tree/${m.uid}/${i}`:`${a}/${i}`;await lt(d,w)!==void 0&&(t.onTreeUpdate(),o(`/${a==="memo"?"m":a}`))},y=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&p()},C=()=>{t.onBookmark()};return u.useEffect(()=>{s&&s.title!==void 0&&ge({title:s.title,description:s.title});function d(){window.scrollTo({top:0}),s&&s.html!=="N"&&document.querySelectorAll("pre").forEach(w=>{w.innerHTML=Ve(w.innerHTML)})}s&&s.memo!==null&&(d(),s.image&&s.image.map((w,x)=>(console.log("image."+x+"=",w.key),w)))},[s]),r?e.jsx(F,{}):i===""||m===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(ne.div,{className:"progress-bar",style:{scaleX:f}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:s&&s.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:C,children:s&&s.bookmark==="Y"?e.jsx(ke,{className:"text-red-500"}):e.jsx(it,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:t.memoDetailData?.path&&t.memoDetailData?.path.map((d,w)=>w===0?d?.text:` > ${d?.text}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx($t,{rootDb:a,onEdit:k,onNewMemo:b,onDelete:y,bookmark:s&&s.bookmark}),e.jsxs("div",{className:"my-4",children:[s&&s.html==="N"?e.jsx(he,{postData:s&&s.memo}):s&&s.html!=="N"&&s.memo&&e.jsx(ze,{text:s.memo}),e.jsx(We,{imageList:s&&s.image}),!s&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(qe,{})})})]})]})]})},Dt=({onSubmit:t,onCancel:a,isSubmitting:r,newMode:s})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(T,{variant:"outlined",color:"success",disabled:r,onClick:g=>{g.preventDefault(),t(g)},children:[s?"새글":""," 저장"]}),e.jsx(T,{variant:"outlined",color:"error",onClick:g=>{g.preventDefault(),a()},children:"취소"})]});u.forwardRef((t,a)=>{const{id:r,label:s,defaultValue:g,onChange:f,className:o="",...j}=t,i=l=>{f&&f(l.target.value)};return e.jsxs("div",{className:` ${o}`,children:[s&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:r,children:s}),e.jsx("input",{ref:a,type:"date",id:r,defaultValue:g,onChange:i,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...j})]})});const te=({label:t,checked:a,id:r,onChange:s,className:g="",disabled:f=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${f?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:r,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${g}`,checked:a,onChange:o=>s(o.target.checked),disabled:f}),a&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),f&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),t&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:t})]}),St=u.forwardRef((t,a)=>{const{placeholder:r="Enter your message",rows:s=3,value:g="",onChange:f,className:o="",disabled:j=!1,error:i=!1,hint:l=""}=t,c=k=>{f&&f(k.target.value)};let m=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${o} `;return j?m+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":i?m+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":m+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:a,placeholder:r,rows:s,value:g,onChange:c,disabled:j,className:m}),l&&e.jsx("p",{className:`mt-2 text-sm ${i?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:l})]})}),Lt=u.lazy(()=>fe(()=>import("./index-BbearoLc.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])));dt.Quill.register("modules/imageDrop",mt);xe.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const It={syntax:{highlight:t=>xe.highlightAuto(t).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},Rt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],Et=t=>{const[a,r]=u.useState(t.imageList),[s,g]=u.useState(t.htmlCheck==="Y"),[f,o]=u.useState(t.iconCheck==="Y"),[j,i]=u.useState(t.newMode?"":t.content),[l,c]=u.useState(),m=u.useRef(),k=u.useRef(),b=u.useRef(null);u.useRef(null);const p=u.useRef(null),y=t.newMode,C=u.useRef([]),{height:d}=Ke(),w=xt.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),x={edTitle:y?"":t.title,edGbn:t.gbn?t.gbn:"etc",edDate:y?w:t.date,content:y?"":t.content,memoTxt:y?"":t.content,htmlCheck:t.htmlCheck,iconCheck:t.iconCheck},{register:v,handleSubmit:S,trigger:E,control:L,setValue:I,getValues:D,watch:je,formState:{errors:J,isSubmitting:ye}}=ft({mode:"onChange",defaultValues:x});u.useEffect(()=>{v("edDate"),v("edGbn",{required:!0}),v("htmlCheck"),v("iconCheck"),v("memoTxt")},[]),u.useEffect(()=>{C.current=[],m.current=t.content,k.current=!1},[t.content]);const Q=async n=>{y?await t.onNewSubmit(n,C.current):await t.onPostSubmit(n,a,C.current)},we=()=>{S(Q)()},be=n=>{console.log("onDelete.imageList=",n),r(n)},Ce=n=>{console.log("onInsert.file",n);let h=m.current;n.ext==="jpg"||n.ext==="png"?(h+=`<img src='${n.url}'/>`,B(`<img src='${n.url}'/>
`)):n.ext==="mp4"?(h+=`<video preload="auto" controls="" src='${n.url}'></video>`,B(`<video preload="auto" controls="" src='${n.url}'></video>`)):(h+=`<a src='${n.url}'>${n.name}}</a>`,B(`다운로드
<a href="${n.url}" target="_blank">${n.name}</a>
`)),m.current=h},Ne=n=>t.onRename(n,D("edTitle")),$e=n=>{m.current=n},Te=n=>{console.log("handleFileUpload",n),C.current=n};function De(n){B(`<img src='${n}'/>`)}function Se(){console.log("HtmlEditor.imageList=",a);let n="";a&&a.length>0&&a.map((h,N)=>{n+=`<img src="/data/memo/${h.key}.${h.ext}" style="width: 50px;"/>
`}),n!==""&&B(n)}function Le(n){m.current=n,I("content",n),E("content")}function Ie(n,h){console.log("handleChangeDate=",n),console.log("handleChangeDate.currentDateString=",h);let N=q(n);console.log("handleChangeDate.dayjs=",N.format("YYYY-MM-DD HH:mm:ss")),I("edDate",N.format("YYYY-MM-DD")),E("edDate")}const Z=(n,h)=>{console.log(`onChecked.e.${n}=`,h),I(n,h?"Y":"N"),console.log(`onChecked.v.${n}=`,D(n)),n==="htmlCheck"?g(h):o(h)},Re=je("content"),Ee=[{value:"none",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Fe=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],B=n=>{const h=b.current;if(h){const N=h.selectionStart,$=h.selectionEnd,M=j.slice(0,N),U=j.slice($);i(M+n+U),I("memoTxt",M+n+U),setTimeout(()=>{h.selectionStart=h.selectionEnd=N+n.length,h.focus()},0)}},P=n=>{B(n)},Be=n=>n?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(n)||n.includes("image")||n.includes("img"):!1,Me=async()=>{const n=await Ge("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile.result=",n)},Pe=async()=>{const n=await Je("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile10.result=",n);let h="";n.map(N=>{h+=N+`
`}),B(h)},_e=async()=>{const n=D("edFilePath");if(n===""){const h=[];let N=b.current.value;N=N.replace(/<img src="\/data\/memo\//g,""),N=N.replace(/ style="width: 50px;"/g,""),N=N.replace(/"\/>/g,""),N=N.replace(/ /g,""),N.split(`
`).forEach(async $=>{$.indexOf(".")>0&&(h.push($),console.log($))}),h.length>0&&(console.log(h),await t.onFilePathList(h))}else await t.onFilePath(n)},Ye=n=>new Promise((h,N)=>{const $=new Image;$.crossOrigin="anonymous",$.onload=()=>{const M=document.createElement("canvas"),U=M.getContext("2d");M.width=$.width,M.height=$.height,U.drawImage($,0,0);try{const H=M.toDataURL("image/png");console.log("convertImageToBase64.base64=",H.substring(0,30)+"..."),h(H)}catch(H){N(H)}},$.onerror=()=>{N(new Error("Failed to load image"))},$.src=n});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:S(Q),style:{width:"100%",minHeight:"300px",maxHeight:{height:d},display:"flex",flexDirection:"column"},children:[e.jsx(Dt,{onSubmit:n=>we(),onCancel:t.onCancel,isSubmitting:ye,newMode:y}),e.jsx(ct,{control:L,onDelete:be,onInsert:Ce,onRename:Ne,setContent:$e,onFileUpload:Te,imageList:t.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(z,{...v("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!J.edTitle})}),e.jsx(pt,{id:"edGbn",name:"edGbn",label:"구분",control:L,defaultValue:D("edGbn"),selectList:Ee,error:!!J.edGbn,onChange:n=>{n.preventDefault();const h=n.target.value;console.log("edGbn=",D("edGbn")),I("edGbn",h)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(vt,{id:"edDate",label:"일자",value:q(D("edDate")),...v("edDate"),defaultValue:q(D("edDate")),onChange:(n,h)=>{Ie(n,h)}}),e.jsx(te,{id:"htmlCheck",checked:s,onChange:n=>Z("htmlCheck",n),label:"HTML사용"}),e.jsx(te,{id:"iconCheck",checked:f,onChange:n=>Z("iconCheck",n),label:"Icon"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2  items-center border-t border-gray-300 dark:border-gray-600 my-2",children:[e.jsx(z,{...v("edUrl",{}),label:"URL",placeholder:"URL",variant:"filled",size:"small",onChange:n=>{n.preventDefault();const h=n.target.value;console.log("edUrl=",h),I("edUrl",h),c(h)}}),e.jsx(z,{...v("edUrl2",{}),label:"Base64",placeholder:"Base64 이미지 데이터",variant:"filled",size:"small",value:D("edUrl2")||""}),e.jsx(T,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),De(D("edUrl2"))},children:"적용"}),e.jsx(T,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),Se()},children:"첨부추가"}),e.jsx(z,{...v("edFilePath",{}),variant:"filled",size:"small",onChange:n=>{n.preventDefault();const h=n.target.value;I("edFilePath",h)}}),e.jsx(T,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),_e()},children:"파일경로"}),e.jsx(T,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),Me()},children:"전체파일"}),e.jsx(T,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),Pe()},children:"전체파일10"})]}),e.jsx("div",{className:"max-h-150 overflow-y-scroll",children:e.jsx(he,{postData:j})})]}),e.jsxs("div",{children:[e.jsx(St,{ref:b,className:"",value:j,onChange:n=>{I("memoTxt",n),i(n)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P(`<box>
</box>`),children:"<Box>"}),e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(_,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<hr style="width=100%"/>'),children:"line"}),Fe.map((n,h)=>e.jsx(_,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>P("<code>"+n+`
</code>`),children:n},h))]})]}),D("edUrl")&&Be(D("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:l,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async n=>{try{const h=await Ye(l);I("edUrl2",h)}catch(h){console.error("Base64 conversion failed:",h)}},onError:n=>{n.target.style.display="none"}})})]}),s&&e.jsx(u.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(Lt,{ref:p,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:Re,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:It,formats:Rt,onChange:Le})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},se=t=>{const{rootDb:a,isLoading:r,memoDetailData:s}=t,{scrollYProgress:g}=pe();ve(g,{stiffness:100,damping:30,restDelta:.001});const f=Y(),o=u.useRef(),j=u.useRef();j.current=t.searchWord;const{memoId:i}=ue(),l=G(),{user:c}=W();o.current=l.pathname.split("/")[2]==="insert",console.log("memoDetailData=",s);const m=()=>{const d=`/${a==="memo"?"m":a}/${i==="insert"?"":i}`;f(d)},k=async d=>{await V(c.uid,i,d)},b=async d=>{if(console.log("onFilePathList.fileNm=",d),d.length>0)for(let w=0;w<d.length;w++){const x=d[w];console.log("onFilePathList.file=",x);try{const v=await V(c.uid,i,x);console.log("onFilePathList.path=",v)}catch{console.log("onFilePathList.error=",x)}}else await V(c.uid,i,d)},p=async(d,w)=>{console.log("onNewSubmit.values",d);const x=await X({rootDb:a,uid:c.uid,newData:o.current,key:i==="insert"?"root":i,values:d});if(await ee(`${a}_txt`,a,x,w),x!==void 0){const v=`/${a==="memo"?"m":a}/${x}`;f(v,{state:{reflash:!0}})}},y=async(d,w)=>{const x=a==="memo"?`${a}/${c.uid}/`:`${a}/`,v=await Qe(x,d.key,w,d.ext);if(v.success){const S=a==="memo"?`${a}_txt/${c.uid}/${i}/image/`:`${a}_txt/${i}/image/`;return R(S+d.key,null),d.key=v.key,d.url=v.url,d.name=v.key+"."+d.ext,R(S+v.key,d),console.log("onRename.file",d),d}},C=async(d,w,x)=>{const v=a==="memo"?`${a}_txt/${c.uid}/`:`${a}_txt/`;a==="memo"?`${a}${c.uid}`:`${a}`,await ut(v,a==="memo"?`${a}/${c.uid}/`:`${a}/`,i,w),console.log("onPostSubmit.values",d);const S=await X({rootDb:a,uid:c.uid,newData:o.current,key:i==="insert"?"root":i,values:d});console.log("onPostSubmit.newKey=",S),console.log("onPostSubmit.files=",x);const E=await ee(`${v}`,a==="memo"?`${a}/${c.uid}/`:`${a}/`,i,x);console.log("onNewSubmit.imageResult",E),a==="memo"&&R(`memo_tree/${c.uid}/${i}/title`,d.edTitle),o.current=!1;const L=`/${a==="memo"?"m":a}/${i}`;a==="home"&&R("home/tree",null),f(L,{state:{reflash:!0}})};return u.useEffect(()=>{s&&s.title!==void 0&&ge({title:s.title,description:s.title});function d(){document.querySelectorAll("pre").forEach((w,x)=>{})}s&&s.memo!==null&&d()},[s]),i===""||c===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",r),s===void 0||r?e.jsx(F,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:o.current===!1&&s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(F,{}):e.jsx(Et,{newMode:o.current,onPostSubmit:C,onNewSubmit:p,onCancel:m,onRename:y,onFilePath:k,onFilePathList:b,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})}))};function Ft({initTreeData:t,userId:a,memoId:r,onClick:s}){const[g,f]=u.useState(t),{isMoble:o,height:j,width:i}=Ze(),l=u.useRef(),c=u.useRef(),m=(p,y)=>{if(y.dragSource.id!==void 0&&y.dropTargetId!==void 0){const C=`memo_tree/${a}/${y.dragSource.id}/parent`;R(C,y.dropTargetId)}f(p)};u.useEffect(()=>{(()=>{for(const y of t){const C=y.id;y.cnt=t.filter(d=>d.parent===C).length}f(t)})()},[t]);const k=(p,y)=>{const C=[],d=w=>{const x=y.find(v=>v.id===w);if(!x)return!1;if(x.parent&&x.parent!=="root"){if(d(x.parent))return C.push(x.parent),!0}else return!0;return!1};return d(p)?C.reverse():[]},b=p=>{if(!g||!p||!c.current)return;const y=k(p,g);y.length>0&&setTimeout(()=>{c.current.open(y)},500)};return u.useEffect(()=>{l.current===void 0&&r!==void 0&&(l.current=r,b(r))},[g]),g==null||g===""?e.jsx(F,{}):e.jsx(ae,{backend:oe,options:re(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:j-220-(o?56:0)+(i>1024?60:0),width:"100%"},children:e.jsx(ie,{ref:c,tree:g,rootId:"root",onDrop:m,render:(p,{depth:y,isOpen:C,onToggle:d,isDragging:w,isDropTarget:x})=>e.jsxs("div",{className:`w-62 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ml-1 ${w?"opacity-50":""} ${x?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
              ${l.current===p.id?"bg-gray-200 dark:bg-gray-800 rounded-r-lg border-l-4 border-blue-500":""}
              `,style:{paddingLeft:y*20+(p.cnt===0?5:0)-(l.current===p.id?4:0)},children:[e.jsx("div",{className:"min-w-0",children:p.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:d,children:C?e.jsx(yt,{className:"size-6"}):e.jsx(wt,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{l.current=p.id,s(p)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[p.icon,p.text]}),p.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",p.cnt,")"]})]})]})})})})}const Bt=t=>{const a=u.useRef(null);function r(){t.onSearchDataBtn(a.current.value)}function s(){return t.onNewMemoBtn(),!1}function g(f){f.which===13&&r()}return e.jsxs(e.Fragment,{children:[e.jsx(kt,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:a,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:g}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(T,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:s,children:"새글"}),e.jsx(T,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:r,children:"조회"})]})]})},Mt=async(t,a,r,s)=>{let g="",f="",o={};((l,c,m)=>{f=l==="memo"?`${l}/${c}/${m}`:`${l}/${m}`,g=l==="memo"?`${l}_txt/${c}/${m}`:`${l}_txt/${m}`})(t,a,r);async function i(){if(g===void 0)return"";if(o=await K(g),o===void 0){console.log("No data available"),o={code:"404",msg:"No data available"};return}if(o?.fullIndex,o.image!==void 0&&o.image!==null){const l=await Xe(g,f,o.image);o.image=l,(o.imageOK===void 0||o.imageOK==="N")&&(l&&l.map(c=>{c.ext==="jpg"&&(o.memo=o.memo+`<img src='${c.url}'>`)}),R(`${g}/imageOK`,"Y"),R(`${g}/memo`,o.memo))}if(s!==void 0&&s!==""){const l=s,c=new RegExp(l,"gi"),m=o.memo.replace(c,`<span class='lightext'>${l}</span>`);o.memo=m}}return await i(),o};async function Pt(t,a,r=""){if(a==null||a==="")return"";if(t==="home"){const l=await K("home/tree");if(l!=null)try{return JSON.parse(l)}catch(c){console.error("Error parsing JSON data:",c)}}const s=t==="home"?"home_txt":r===""?`${t}_tree/${a}`:`${t}_txt/${a}`,g=le(ce(de,s)),f=await me(g);if(!f.exists())return console.log("getTreeData.null"),null;if(!f.exists())return console.log("getTreeData.exists"),null;const o=f.val(),j=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],i=[];t==="home"&&i.push(...j);for(const l in o){const c=o[l];c.id=l;const m={id:l,key:l,text:c.title,parent:t==="home"?c.gbn:c.parent};t==="memo"?(m.icon=c.bm==="Y"?e.jsx(ke,{className:"text-red-500"}):c.icon==="Y"?e.jsx(jt,{}):null,m.droppable=!0):m.droppable=!1,!((r===""||r===void 0||r===null)&&(m.parent===void 0||m.parent===null||m.parent===""))&&(t==="home"||r===""||r===void 0||r===null?i.push(m):(c.id=l,(c.memo+"").toLowerCase().indexOf(r.toLowerCase())>-1&&(m.parent="root",m.droppable=!1,i.push(m))))}return i.sort((l,c)=>l.title>c.title?1:-1),t==="home"&&R("home/tree",JSON.stringify(i)),i}const _t=u.lazy(async()=>await fe(()=>import("./TwMemoMain-Bqu2mxX5.js"),__vite__mapDeps([13,1,2,11,14]))),as=({rootDb:t})=>{const a=Y(),{user:r}=W(),s=u.useRef(),g=u.useRef(!0),f=u.useRef(),o=u.useRef(),[j,i]=u.useState(),l=u.useRef(!1),c=G(),m=u.useRef(!1);m.current=c?.state?.reflash===!0;const k=rt({queryKey:["twTreeData",r?.uid,s.current],queryFn:()=>Pt(t,r?.uid,s.current)});k.data!==void 0&&k.data!==""&&!l.current&&(l.current=!0);const b=()=>{const x=j;x&&(x.bookmark=x.bookmark==="Y"?"N":"Y");const v=`memo_tree/${r.uid}/${o.current}/bm`;R(v,j.bookmark),i({...j,bookmark:x.bookmark})};u.useEffect(()=>{r!==void 0&&r!=null&&k.refetch()},[r]),u.useEffect(()=>{const x=async E=>{if(E!==""&&r){const L=await Mt(t,r?.uid,E,s.current);t==="memo"&&(L.path=Yt(k.data,E)),L.code==="404"&&(L.title="No title"),g.current=!1,i(L===void 0?{}:L)}},v=c.pathname.split("/"),S=v.length>2?v[v.length-1]:"";g.current=!0,x(S),o.current=S},[c.pathname,r,m.current]),u.useEffect(()=>{console.log("useEffect.reflash=",m.current),r!==void 0&&r!=null&&k.refetch()},[m.current]);const p=x=>{l.current=!1,x!==void 0&&(s.current=x),k.refetch()},y=x=>{x.id!==o.current&&(g.current=!0,a(`/${t==="memo"?"m":t}/${x.id}`))},C=()=>{if(r==null){alert("로그인 후 이용 가능합니다.");return}const x=`/${t==="memo"?"m":t}/insert/insert`;a(x)},d=x=>{},w=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3",children:e.jsx(bt,{to:"/m",children:t==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[t==="memo"?"":e.jsx(A,{to:"/m",children:"메모"}),t==="memo"&&r?.uid==="I3cTgdCxwjhBBno4mtZYvnODPJu1"?e.jsx(A,{to:"/home",children:"홈관리"}):null,e.jsx(A,{to:"/todo",children:"TODO"}),e.jsx(A,{to:"/tw",children:"Sheet"})]}),e.jsx(Bt,{onNewMemoBtn:C,onSearchDataBtn:p}),l.current&&k.isFetched?e.jsx(Ft,{expandIndex:f.current,initTreeData:k.data,userId:r?.uid,memoId:o.current,onClick:y}):r===void 0?e.jsx(e.Fragment,{}):e.jsx(F,{})]});return r&&r.uid===et&&tt,e.jsxs(st,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:w,children:[e.jsx(u.Suspense,{fallback:e.jsx(F,{}),children:e.jsxs(nt,{children:[e.jsx(O,{path:"/edit/:memoId",element:e.jsx(se,{rootDb:t,isLoading:g.current,searchWord:s.current,memoDetailData:j})}),e.jsx(O,{path:"/insert/:memoId",element:e.jsx(se,{rootDb:t,isLoading:g.current,searchWord:s.current,memoDetailData:j})}),e.jsx(O,{path:"/:memoId",element:e.jsx(Tt,{rootDb:t,isLoading:g.current,searchWord:s.current,memoDetailData:j,onTreeUpdate:p,onBookmark:b,data:k.data})}),e.jsx(O,{path:"*",element:e.jsx(_t,{searchWord:s.current,data:k.data,onNewMemoBtn:C,title:t==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),t==="memo"?e.jsx(Nt,{onSelected:d}):"",e.jsx(at,{})]})},Yt=(t,a)=>{let r=[],s=a;if(!t)return r;const g=t.find(f=>f.id===s);for(r.unshift(g),s=g?.parent;s!=null&&s!==""&&s!=="root";){const f=t.find(o=>o.id===s);s=f?.parent,r.unshift(f)}return r};export{as as default};
