const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B94BYDmb.js","assets/index-LOQAwg0L.js","assets/index-twIN5572.css","assets/createSvgIcon-CqvoKJmi.js","assets/useControlled-DjS2YtnO.js","assets/ownerWindow-DvT1GKkC.js","assets/isMuiElement-D3TT8HXg.js","assets/fireDatabase-DpAIoJuO.js","assets/fireStorage-JCx0r4IH.js","assets/SinyDate-DododDKu.js","assets/Grid-Bz0Xjg5Y.js","assets/useTheme-36GxGCmH.js","assets/index-C2HANitj.js","assets/Typography-B2LqM6rC.js","assets/Menu-CfJlI2eo.js","assets/useSlotProps-Ch0itXTG.js","assets/resolveComponentProps-DpvZJ71N.js","assets/IconButton-s3y1W3P5.js","assets/TextField-CUyL8BV9.js","assets/InputAdornment-DTEtQOAB.js","assets/Popper-CXGEPDgh.js","assets/Button-thPfpKtS.js","assets/Chip-T4fVZf0K.js","assets/index.esm-B572D79s.js","assets/TwButton-B10xoOy3.js","assets/Loading-DTaH1fF_.js","assets/Container-CV418Mg7.js","assets/styled-BYcVyRMu.js","assets/CircularProgress-B1tNOaPY.js","assets/Divider-BznROXQJ.js","assets/dividerClasses-BrV9Qz6C.js","assets/index-Cmdt2tIm.css"])))=>i.map(i=>d[i]);
import{b as c,u as Q,j as e,h as Z,q as we,e as We,o as Ge,c as ye,f as Ce,i as Ne,D as xe,E as le,F as Je,L as $e,H as Ke,G as Se,J as Te,K as Ve,B as Qe,cl as De,M as Ze,R as Xe,N as ee}from"./index-LOQAwg0L.js";import{u as et}from"./useSuspenseQuery-I_r7Fg_9.js";import{T as tt}from"./Footer-Bf8STuCP.js";import{b as st,T as ne}from"./TwLinkItem-D3UDvagG.js";import{L as A}from"./Loading-DTaH1fF_.js";import{g as Le,s as _}from"./fireDatabase-DpAIoJuO.js";import{g as Re,S as Fe,T as Ie}from"./index-Bkkm5bWN.js";import{S as Ee,a as Pe}from"./right-Dtdc8p8w.js";import{D as Be}from"./DndProvider-Cr1eqqz-.js";import{a as ot,T as nt}from"./TwTitleItem-C-xfQWxG.js";import{F as Ue}from"./Favorite-Cme6V4A8.js";import{u as fe,a as pe,F as at,b as rt,D as _e,l as lt,I as it,s as ae,d as re,e as Me}from"./index-B94BYDmb.js";import{S as ct}from"./SinyImageList-BPmjUyIf.js";import{L as mt,H as ve}from"./HtmlCode-BbEesJIU.js";import{c as dt}from"./CodeText-gK7AMmlm.js";import{s as je}from"./commonUtil-CeCzortn.js";import{T as B}from"./TwButton-B10xoOy3.js";import{C as ut}from"./CircularProgress-B1tNOaPY.js";import{D as gt}from"./datetime-BDx6lZXm.js";import{u as He}from"./index.esm-B572D79s.js";import{T as he}from"./TwCheckbox-BQ05nFet.js";import{T as Ae}from"./TwTextArea-Beiwyp0B.js";import{T as U}from"./TwBadge-C9c7iSPo.js";import"./SinyDate-DododDKu.js";import{T as K}from"./TwInput-Bs-cmxzt.js";import{T as Ye}from"./TwSelect-C225I_rH.js";import{T as Oe}from"./TwDatePicker-DKMz4QqT.js";import{d as V,e as qe,f as ht,h as xt}from"./fireStorage-JCx0r4IH.js";import{I as ft}from"./IpInfo-CvJkhUea.js";import{f as pt}from"./fireMemoDetail-D3ZUcoOI.js";import{S as vt}from"./check-circle-v3UI6HPS.js";import{H as jt,a as bt,b as kt}from"./HomeChartSemiDonut-CAy6TbLp.js";import"./useBaseQuery-B4t_Nw9s.js";import"./LinkItem-icX41xpf.js";import"./Typography-B2LqM6rC.js";import"./Divider-BznROXQJ.js";import"./dividerClasses-BrV9Qz6C.js";import"./Link-BfeZwlwS.js";import"./Container-CV418Mg7.js";import"./styled-BYcVyRMu.js";import"./createSvgIcon-CqvoKJmi.js";import"./useControlled-DjS2YtnO.js";import"./ownerWindow-DvT1GKkC.js";import"./isMuiElement-D3TT8HXg.js";import"./IconButton-s3y1W3P5.js";import"./ImageListItem-siIcZcZq.js";/* empty css                 */import"./copy-DC0puQkH.js";import"./ComponentCard-C33xUGK7.js";import"./TwRadio-DZZ7BoXh.js";import"./toPropertyKey-DCwh5dYN.js";import"./Grid-Bz0Xjg5Y.js";import"./useTheme-36GxGCmH.js";import"./index-C2HANitj.js";import"./Menu-CfJlI2eo.js";import"./useSlotProps-Ch0itXTG.js";import"./resolveComponentProps-DpvZJ71N.js";import"./TextField-CUyL8BV9.js";import"./InputAdornment-DTEtQOAB.js";import"./Popper-CXGEPDgh.js";import"./Button-thPfpKtS.js";import"./Chip-T4fVZf0K.js";function wt({initTreeData:o}){const[t,i]=c.useState(),s=v=>i(v),p=Q();c.useEffect(()=>{i(o)},[o]);const b=v=>{console.log("node",v),p(`/m/${v.id}`)};return t===void 0?e.jsx(e.Fragment,{}):t===null||t.length===0?e.jsx(A,{}):e.jsx(Be,{backend:Fe,options:Re(),children:e.jsx(Ie,{tree:t,rootId:"root",onDrop:s,canDrag:()=>!1,render:(v,{depth:x,isOpen:r,onToggle:h})=>e.jsxs("div",{className:`w-62 flex items-center rounded-sm
          text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ml-1
          hover:bg-gray-300 dark:hover:bg-gray-700`,style:{paddingLeft:x*20+(v.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[v.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:h,children:r?e.jsx(Ee,{className:"size-6"}):e.jsx(Pe,{className:"size-6"})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>b(v),children:v.text})]}),v.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",v.cnt,")"]})]})})})}function yt(o){const{user:t}=Z(),i=Q(),[s,p]=c.useState(),[b,v]=c.useState(),x=async r=>{const h=[],d=we(ye(Ce,`memo_tree/${r}`),Ge("bm"),We("Y")),u=await Ne(d);if(!u.exists())return console.log("getBookmark.getFireData.null"),null;const $=u.val();for(let y in $){const N=$[y];N.id=y,N.key=y,N.text=N.title,h.push(N)}h.sort((y,N)=>y.title>N.title?1:-1),p([...h])};return c.useEffect(()=>{t!==void 0&&t!=null&&x(t?.uid)},[t]),c.useEffect(()=>{const r=async(h,d)=>{const u=[...d];if(d)for(const $ of d){let y=$;for(;y.parent!==void 0&&y.parent!=="root";){const N=y.parent;y=await Le(`memo_tree/${h}/${N}`);const f={id:y.key,text:y.title,droppable:!1,parent:y.parent};u.filter(l=>l.id===f.id).length===0&&u.push(f)}}for(const $ of u){const y=$.id;$.cnt=u.filter(N=>N.parent===y).length}v(u)};s&&s.length>0&&r(t?.uid,s)},[s]),t===null?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(ot,{children:"주요 목록"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((r,h)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{o.onSelected(r.key),i(`/m/${r.key}`)},children:e.jsx("span",{className:"text-base",children:r.title})})},h))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-3"}),e.jsx(c.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(wt,{initTreeData:b,uid:t?.uid})})]})}const Ct=o=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:`70px 70px 70px ${o.master?"70px":""}`},children:[o.master&&e.jsx(B,{size:"sm",variant:"outlined",color:"brand",onClick:o.onUtil,children:"유틸"}),e.jsx(B,{size:"sm",variant:"outlined",color:"blue",onClick:o.onEdit,children:"수정"}),e.jsx(B,{size:"sm",variant:"outlined",color:"warning",onClick:o.onNewMemo,children:"새글"}),e.jsx(B,{size:"sm",variant:"outlined",color:"error",onClick:o.onDelete,children:"삭제"})]}),Nt=o=>{const{rootDb:t,isLoading:i,memoDetailData:s,onBookmark:p,onTreeUpdate:b,searchWord:v}=o,[x,r]=c.useState(!1),{scrollYProgress:h}=fe(),d=pe(h,{stiffness:100,damping:30,restDelta:.001}),u=Q(),{memoId:$}=xe(),N=le()?.state?.fullIndex,{user:f}=Z(),S=()=>{const w=`/${t==="memo"?"m":t}/edit/${$}`;u(w,{state:{fullIndex:N}})},l=()=>{const w=`/${t==="memo"?"m":t}/util/${$}`;u(w,{state:{fullIndex:N}})},m=()=>{const w=`/${t==="memo"?"m":t}/insert/${$}`;u(w,{state:{fullIndex:N}})},g=async()=>{const w=t==="memo"?`${t}_txt/${f.uid}/${$}`:`${t}_txt/${$}`,L=t==="memo"?`${t}_tree/${f.uid}/${$}`:`${t}/${$}`;await rt(w,L)!==void 0&&(b(),u(`/${t==="memo"?"m":t}`))},k=()=>{r(!0)},D=()=>{r(!1),g()};return c.useEffect(()=>{s&&s.title!==void 0&&je({title:s.title,description:s.title});function w(){window.scrollTo({top:0}),s&&s.html!=="N"&&document.querySelectorAll("pre").forEach(L=>{L.innerHTML=dt(L.innerHTML)})}s&&s.memo!==null&&(w(),s.image&&s.image.map((L,T)=>(console.log("image."+T+"=",L.key),L)))},[s]),i?e.jsx(A,{}):$===""||f===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(Je.div,{className:"progress-bar",style:{scaleX:d}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:s&&s.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:p,children:s&&s.bookmark==="Y"?e.jsx(Ue,{className:"text-red-500"}):e.jsx(at,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s?.path&&s?.path.map((w,L)=>L===0?w?.text:` > ${w?.text}`)})]})]}),e.jsx(mt,{isOpen:x,size:"sm",color:"warning",title:"삭제 확인",message:`하위 자료가 있는 경우 같이 삭제됩니다.
<br/>삭제하시겠습니까?`,onClose:()=>r(!1),onConfirm:()=>{D()}}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(Ct,{master:f?.uid===$e,rootDb:t,onEdit:S,onUtil:l,onNewMemo:m,onDelete:k,bookmark:s&&s.bookmark}),e.jsxs("div",{className:"my-4",children:[s&&s.html==="N"?e.jsx(ve,{postData:s&&s.memo,highlightWord:v}):s&&s.html!=="N"&&s.memo&&e.jsx(Ke,{text:s.memo}),e.jsx(ct,{imageList:s&&s.image}),!s&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(ut,{})})})]})]})]})},ze=({onSubmit:o,onCancel:t,isSubmitting:i,newMode:s=!1})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(B,{variant:"outlined",color:"success",disabled:i,onClick:p=>{p.preventDefault(),o(p)},children:[s?"새글":""," 저장"]}),e.jsx(B,{variant:"outlined",color:"error",onClick:p=>{p.preventDefault(),t()},children:"취소"})]}),$t=c.lazy(()=>Ve(()=>import("./index-B94BYDmb.js").then(o=>o.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31])));lt.Quill.register("modules/imageDrop",it);Te.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const St={syntax:{highlight:o=>Te.highlightAuto(o).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},Tt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],Dt=o=>{const[t,i]=c.useState(o.imageList),[s,p]=c.useState(o.htmlCheck==="Y"),[b,v]=c.useState(o.iconCheck==="Y"),[x,r]=c.useState(!1),[h,d]=c.useState(o.newMode?"":o.content),[u,$]=c.useState(),y=c.useRef(),N=c.useRef(),f=c.useRef(null);c.useRef(null);const S=c.useRef(null),l=o.newMode,m=c.useRef([]),{height:g}=Se(),k=gt.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),D={edTitle:l?"":o.title,edGbn:o.gbn?o.gbn:"etc",edDate:l?k:o.date,content:l?"":o.content,memoTxt:l?"":o.content,htmlCheck:o.htmlCheck,iconCheck:o.iconCheck},{register:w,handleSubmit:L,trigger:T,control:I,setValue:E,getValues:M,watch:q,formState:{errors:be,isSubmitting:ie}}=He({mode:"onChange",defaultValues:D});c.useEffect(()=>{w("edDate"),w("edGbn",{required:!0}),w("htmlCheck"),w("iconCheck"),w("memoTxt")},[]),c.useEffect(()=>{m.current=[],y.current=o.content,N.current=!1},[o.content]);const te=async a=>{l?await o.onNewSubmit(a,m.current):await o.onPostSubmit(a,t,m.current)},ce=()=>{L(te)()},H=a=>{console.log("onDelete.imageList=",a),i(a)},O=a=>{console.log("onInsert.file",a);let C=y.current;a.ext==="jpg"||a.ext==="png"?(C+=`<img src='${a.url}'/>`,F(`<img src='${a.url}'/>
`)):a.ext==="mp4"?(C+=`<video preload="auto" controls="" src='${a.url}'></video>`,F(`<video preload="auto" controls="" src='${a.url}'></video>`)):(C+=`<a src='${a.url}'>${a.name}}</a>`,F(`다운로드
<a href="${a.url}" target="_blank">${a.name}</a>
`)),y.current=C},me=a=>o.onRename(a,M("edTitle")),de=a=>{y.current=a},ue=a=>{console.log("handleFileUpload",a),m.current=a};function ge(a){y.current=a,E("content",a),T("content")}const X=(a,C)=>{console.log(`onChecked.e.${a}=`,C),E(a,C?"Y":"N"),console.log(`onChecked.v.${a}=`,M(a)),a==="htmlCheck"?p(C):a==="rootCheck"?r(C):v(C)},n=q("content"),j=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],R=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],F=a=>{const C=f.current;if(C){const J=C.selectionStart,Y=C.selectionEnd,z=h.slice(0,J),se=h.slice(Y);d(z+a+se),E("memoTxt",z+a+se),setTimeout(()=>{C.selectionStart=C.selectionEnd=J+a.length,C.focus()},0)}},P=a=>{F(a)},W=a=>a?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(a)||a.includes("image")||a.includes("img"):!1,G=a=>new Promise((C,J)=>{const Y=new Image;Y.crossOrigin="anonymous",Y.onload=()=>{const z=document.createElement("canvas"),se=z.getContext("2d");z.width=Y.width,z.height=Y.height,se.drawImage(Y,0,0);try{const oe=z.toDataURL("image/png");console.log("convertImageToBase64.base64=",oe.substring(0,30)+"..."),C(oe)}catch(oe){J(oe)}},Y.onerror=()=>{J(new Error("Failed to load image"))},Y.src=a});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:L(te),style:{width:"100%",minHeight:"300px",maxHeight:{height:g},display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsx(he,{id:"rootCheck",checked:x,onChange:a=>X("rootCheck",a),label:"root로 이동"}),e.jsx(he,{id:"htmlCheck",checked:s,onChange:a=>X("htmlCheck",a),label:"HTML사용"}),e.jsx(he,{id:"iconCheck",checked:b,onChange:a=>X("iconCheck",a),label:"Icon"}),e.jsx(ze,{onSubmit:a=>ce(),onCancel:o.onCancel,isSubmitting:ie,newMode:l})]}),e.jsx(_e,{control:I,onDelete:H,onInsert:O,onRename:me,setContent:de,onFileUpload:ue,imageList:o.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(K,{name:"edTitle",placeholder:"제목",control:I,rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:a=>{a.preventDefault(),E("edTitle",a.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ye,{name:"edGbn",label:"구분",control:I,rules:{required:!0},placeholder:"-- 구분 --",options:j,className:"",allClassName:"max-w-40",onChange:a=>{a.preventDefault();const C=a.target.value;console.log("edGbn=",M("edGbn")),E("edGbn",C)}}),e.jsx(Oe,{id:"edDate",name:"edDate",placeholder:"Select a date",control:I,onChange:(a,C)=>{console.log({dates:a,currentDateString:C}),E("edDate",C)}})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(ve,{postData:h})}),e.jsxs("div",{children:[e.jsx(Ae,{ref:f,className:"",value:h,onChange:a=>{E("memoTxt",a),d(a)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(U,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P(`<box>
</box>`),children:"<Box>"}),e.jsx(U,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(U,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(U,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(U,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>P('<hr style="width=100%"/>'),children:"line"}),R.map((a,C)=>e.jsx(U,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>P("<code>"+a+`
</code>`),children:a},C))]})]}),M("edUrl")&&W(M("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:u,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async a=>{try{const C=await G(u);E("edUrl2",C)}catch(C){console.error("Base64 conversion failed:",C)}},onError:a=>{a.target.style.display="none"}})})]}),s&&e.jsx(c.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx($t,{ref:S,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:n,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:St,formats:Tt,onChange:ge})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},ke=o=>{const{rootDb:t,isLoading:i,memoDetailData:s}=o,{scrollYProgress:p}=fe();pe(p,{stiffness:100,damping:30,restDelta:.001});const b=Q(),v=c.useRef(),x=c.useRef();x.current=o.searchWord;const{memoId:r}=xe(),h=le(),{user:d}=Z();v.current=h.pathname.split("/")[2]==="insert",console.log("memoDetailData=",s);const u=()=>{const l=`/${t==="memo"?"m":t}/${r==="insert"?"":r}`;b(l)},$=async l=>{await V(d.uid,r,l)},y=async l=>{if(console.log("onFilePathList.fileNm=",l),l.length>0)for(let m=0;m<l.length;m++){const g=l[m];console.log("onFilePathList.file=",g);try{const k=await V(d.uid,r,g);console.log("onFilePathList.path=",k)}catch{console.log("onFilePathList.error=",g)}}else await V(d.uid,r,l)},N=async(l,m)=>{console.log("onNewSubmit.values",l);const g=await ae({rootDb:t,uid:d.uid,newData:v.current,key:r==="insert"?"root":r,values:l});if(await re(`${t}_txt`,t,g,m),g!==void 0){const k=`/${t==="memo"?"m":t}/${g}`;b(k,{state:{reflash:!0}})}},f=async(l,m)=>{const g=t==="memo"?`${t}/${d.uid}/`:`${t}/`,k=await qe(g,l.key,m,l.ext);if(k.success){const D=t==="memo"?`${t}_txt/${d.uid}/${r}/image/`:`${t}_txt/${r}/image/`;return _(D+l.key,null),l.key=k.key,l.url=k.url,l.name=k.key+"."+l.ext,_(D+k.key,l),console.log("onRename.file",l),l}},S=async(l,m,g)=>{const k=t==="memo"?`${t}_txt/${d.uid}/`:`${t}_txt/`;t==="memo"?`${t}${d.uid}`:`${t}`,await Me(k,t==="memo"?`${t}/${d.uid}/`:`${t}/`,r,m),console.log("onPostSubmit.values",l);const D=await ae({rootDb:t,uid:d.uid,newData:v.current,key:r==="insert"?"root":r,values:l});console.log("onPostSubmit.newKey=",D),console.log("onPostSubmit.files=",g);const w=await re(`${k}`,t==="memo"?`${t}/${d.uid}/`:`${t}/`,r,g);console.log("onNewSubmit.imageResult",w),t==="memo"&&(_(`memo_tree/${d.uid}/${r}/title`,l.edTitle),l.rootCheck==="Y"&&_(`memo_tree/${d.uid}/${r}/parent`,"root")),v.current=!1;const L=`/${t==="memo"?"m":t}/${r}`;t==="home"&&_("home/tree",null),b(L,{state:{reflash:!0}})};return c.useEffect(()=>{s&&s.title!==void 0&&je({title:s.title,description:s.title});function l(){document.querySelectorAll("pre").forEach((m,g)=>{})}s&&s.memo!==null&&l()},[s]),r===""||d===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",i),s===void 0||i?e.jsx(A,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:v.current===!1&&s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(A,{}):e.jsx(Dt,{newMode:v.current,onPostSubmit:S,onNewSubmit:N,onCancel:u,onRename:f,onFilePath:$,onFilePathList:y,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})}))},Lt=o=>{const[t,i]=c.useState(o.imageList),[s,p]=c.useState(o.content),[b,v]=c.useState(),x=c.useRef(),r=c.useRef(),h=c.useRef(null),d=c.useRef([]),{height:u}=Se(),$={edTitle:o.title,edGbn:o.gbn?o.gbn:"etc",edDate:o.date,content:o.content,memoTxt:o.content,htmlCheck:"N",iconCheck:"N"},{register:y,handleSubmit:N,trigger:f,control:S,setValue:l,getValues:m,watch:g,formState:{errors:k,isSubmitting:D}}=He({mode:"onChange",defaultValues:$});c.useEffect(()=>{y("edDate"),y("memoTxt")},[]),c.useEffect(()=>{d.current=[],x.current=o.content,r.current=!1},[o.content]);const w=async n=>{await o.onPostSubmit(n,t,d.current)},L=()=>{N(w)()},T=n=>{console.log("onDelete.imageList=",n),i(n)},I=n=>{console.log("onInsert.file",n);let j=x.current;n.ext==="jpg"||n.ext==="png"?(j+=`<img src='${n.url}'/>`,H(`<img src='${n.url}'/>
`)):n.ext==="pdf"?(j+=`<PDF>${n.url}</PDF>`,H(`<PDF>${n.url}</PDF>`)):n.ext==="mp4"?(j+=`<video preload="auto" controls="" src='${n.url}'></video>`,H(`<video preload="auto" controls="" src='${n.url}'></video>`)):(j+=`<a src='${n.url}'>${n.name}}</a>`,H(`다운로드
<a href="${n.url}" target="_blank">${n.name}</a>
`)),x.current=j},E=n=>o.onRename(n,m("edTitle")),M=n=>{x.current=n},q=n=>{console.log("handleFileUpload",n),d.current=n};function be(n){H(`<img src='${n}'/>`)}function ie(){console.log("HtmlEditor.imageList=",t);let n="";t&&t.length>0&&t.map((j,R)=>{n+=`<img src="/data/memo/${j.key}.${j.ext}" style="width: 50px;"/>
`}),n!==""&&H(n)}const te=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],ce=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],H=n=>{const j=h.current;if(j){const R=j.selectionStart,F=j.selectionEnd,P=s.slice(0,R),W=s.slice(F);p(P+n+W),l("memoTxt",P+n+W),setTimeout(()=>{j.selectionStart=j.selectionEnd=R+n.length,j.focus()},100)}},O=n=>{H(n)},me=n=>n?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(n)||n.includes("image")||n.includes("img"):!1,de=async()=>{const n=await ht("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile.result=",n)},ue=async()=>{const n=await xt("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile10.result=",n);let j="";n.map(R=>{j+=R+`
`}),H(j)},ge=async()=>{const n=m("edFilePath");if(n===""){const j=[];let R=h.current.value;R=R.replace(/<img src="\/data\/memo\//g,""),R=R.replace(/ style="width: 50px;"/g,""),R=R.replace(/"\/>/g,""),R=R.replace(/ /g,""),R.split(`
`).forEach(async F=>{F.indexOf(".")>0&&(j.push(F),console.log(F))}),j.length>0&&(console.log(j),await o.onFilePathList(j))}else await o.onFilePath(n)},X=n=>new Promise((j,R)=>{const F=new Image;F.crossOrigin="anonymous",F.onload=()=>{const P=document.createElement("canvas"),W=P.getContext("2d");P.width=F.width,P.height=F.height,W.drawImage(F,0,0);try{const G=P.toDataURL("image/png");console.log("convertImageToBase64.base64=",G.substring(0,30)+"..."),j(G)}catch(G){R(G)}},F.onerror=()=>{R(new Error("Failed to load image"))},F.src=n});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:N(w),style:{width:"100%",minHeight:"300px",maxHeight:{height:u},display:"flex",flexDirection:"column"},children:[e.jsx(ze,{onSubmit:n=>L(),onCancel:o.onCancel,isSubmitting:D}),e.jsx(_e,{control:S,onDelete:T,onInsert:I,onRename:E,setContent:M,onFileUpload:q,imageList:o.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(K,{name:"edTitle",placeholder:"제목",control:S,className:"w-full",rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:n=>{n.preventDefault(),l("edTitle",n.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ye,{name:"edGbn",label:"구분",control:S,rules:{required:!0},placeholder:"-- 구분 --",options:te,className:"",allClassName:"max-w-40",onChange:n=>{n.preventDefault();const j=n.target.value;console.log("edGbn=",m("edGbn")),l("edGbn",j)}}),e.jsx(Oe,{id:"edDate",name:"edDate",placeholder:"Select a date",control:S,onChange:(n,j)=>{console.log({dates:n,currentDateString:j}),l("edDate",j)}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{name:"edUrl",placeholder:"Base64로 만들 URL",control:S,className:"w-full",allClassName:"w-full",onChange:n=>{n.preventDefault();const j=n.target.value;console.log("edUrl=",j),l("edUrl",j),v(j)}}),e.jsx(B,{variant:"outlined",color:"success",className:"w-25 h-9",onClick:n=>{n.preventDefault(),be(m("edUrl2"))},children:"적용"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{name:"edUrl2",placeholder:"Base64 이미지 데이터",className:"w-full",allClassName:"w-full",variant:"filled",size:"md",value:m("edUrl2")||""}),e.jsx(B,{variant:"outlined",color:"success",className:"w-25 h-9",onClick:n=>{n.preventDefault(),ie()},children:"첨부추가"})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(K,{name:"edFilePath",placeholder:"이미지리스트에 추가할 파일명",className:"w-full",allClassName:"w-full",control:S,onChange:n=>{n.preventDefault();const j=n.target.value;l("edFilePath",j)}}),e.jsx(B,{size:"sm",variant:"outlined",color:"success",className:"w-25 h-9",onClick:n=>{n.preventDefault(),ge()},children:"파일경로"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),de()},children:"전체파일"}),e.jsx(B,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),ue()},children:"전체파일10"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(ve,{postData:s})})}),e.jsxs("div",{children:[e.jsx(Ae,{ref:h,className:"",value:s,onChange:n=>{l("memoTxt",n),p(n)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(U,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>O(`<box>
</box>`),children:"<Box>"}),e.jsx(U,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>O('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(U,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>O('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(U,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>O('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(U,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>O('<hr style="width=100%"/>'),children:"line"}),ce.map((n,j)=>e.jsx(U,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>O("<code>"+n+`
</code>`),children:n},j))]})]}),m("edUrl")&&me(m("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:b,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async n=>{try{const j=await X(b);l("edUrl2",j)}catch(j){console.error("Base64 conversion failed:",j)}},onError:n=>{n.target.style.display="none"}})})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},Rt=o=>{const{rootDb:t,isLoading:i,memoDetailData:s}=o,{scrollYProgress:p}=fe();pe(p,{stiffness:100,damping:30,restDelta:.001});const b=Q(),v=c.useRef();v.current=o.searchWord;const{memoId:x}=xe();le();const{user:r}=Z();console.log("memoDetailData=",s);const h=()=>{const f=`/${t==="memo"?"m":t}/${x==="insert"?"":x}`;b(f)},d=async f=>{await V(r.uid,x,f)},u=async f=>{if(console.log("onFilePathList.fileNm=",f),f.length>0)for(let S=0;S<f.length;S++){const l=f[S];console.log("onFilePathList.file=",l);try{const m=await V(r.uid,x,l);console.log("onFilePathList.path=",m)}catch{console.log("onFilePathList.error=",l)}}else await V(r.uid,x,f)},$=async(f,S)=>{console.log("onNewSubmit.values",f);const l=await ae({rootDb:t,uid:r.uid,newData:!1,key:x,values:f});if(await re(`${t}_txt`,t,l,S),l!==void 0){const m=`/${t==="memo"?"m":t}/${l}`;b(m,{state:{reflash:!0}})}},y=async(f,S)=>{const l=t==="memo"?`${t}/${r.uid}/`:`${t}/`,m=await qe(l,f.key,S,f.ext);if(m.success){const g=t==="memo"?`${t}_txt/${r.uid}/${x}/image/`:`${t}_txt/${x}/image/`;return _(g+f.key,null),f.key=m.key,f.url=m.url,f.name=m.key+"."+f.ext,_(g+m.key,f),console.log("onRename.file",f),f}},N=async(f,S,l)=>{const m=t==="memo"?`${t}_txt/${r.uid}/`:`${t}_txt/`;t==="memo"?`${t}${r.uid}`:`${t}`,await Me(m,t==="memo"?`${t}/${r.uid}/`:`${t}/`,x,S),console.log("onPostSubmit.values",f);const g=await ae({rootDb:t,uid:r.uid,newData:!1,key:x==="insert"?"root":x,values:f});console.log("onPostSubmit.newKey=",g),console.log("onPostSubmit.files=",l);const k=await re(`${m}`,t==="memo"?`${t}/${r.uid}/`:`${t}/`,x,l);console.log("onNewSubmit.imageResult",k),t==="memo"&&_(`memo_tree/${r.uid}/${x}/title`,f.edTitle);const D=`/${t==="memo"?"m":t}/${x}`;t==="home"&&_("home/tree",null),b(D,{state:{reflash:!0}})};return c.useEffect(()=>{s&&s.title!==void 0&&je({title:s.title,description:s.title});function f(){document.querySelectorAll("pre").forEach((S,l)=>{})}s&&s.memo!==null&&f()},[s]),x===""||r===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",i),s===void 0||i?e.jsx(A,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(A,{}):e.jsx(Lt,{onPostSubmit:N,onNewSubmit:$,onCancel:h,onRename:y,onFilePath:d,onFilePathList:u,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})}))},Ft=({data:o,onNewMemoBtn:t,title:i,rootDb:s})=>{const{user:p}=Z();return e.jsx("div",{className:"justify-items-center space-y-6",children:e.jsxs("div",{className:"text-center mt-5 mb-7 p-8 bg-white dark:bg-gray-900 rounded-xl shadow-lg",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-3",children:i}),e.jsxs("div",{className:"grid gird-cols-1 md:grid-cols-5 items-center gap-3",children:[p===null?e.jsx("p",{className:"text-red-500 font-semibold text-lg text-left md:col-span-3",children:"로그인해야 이용 가능합니다."}):e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-left md:col-span-3",children:["좌측 사이드 메뉴에서 '새글' 버튼을 사용해 메모를 작성하거나, ",e.jsx("br",{}),"기존 메모를 선택하여 확인하세요."]}),e.jsx("div",{className:"w-full items-center justify-center md:col-span-2",children:e.jsx(ft,{})})]})]})})};function It({initTreeData:o,userId:t,memoId:i,onClick:s}){const[p,b]=c.useState(o),{isMoble:v,height:x,width:r}=Qe(),h=c.useRef(),d=c.useRef(),u=c.useRef(null),[$,y]=c.useState(0),[N,f]=c.useState({labels:[],series:[]}),S=(g,k)=>{if(k.dragSource.id!==void 0&&k.dropTargetId!==void 0){const D=`memo_tree/${t}/${k.dragSource.id}/parent`;_(D,k.dropTargetId)}b(g)};c.useEffect(()=>{(()=>{if(o==null)return;for(const T of o){const I=T.id;T.cnt=o.filter(E=>E.parent===I).length}b(o);const k=o.filter(T=>T.parent==="root").sort((T,I)=>T.text.localeCompare(I.text)),D=(T,I)=>{const E=I.filter(q=>q.parent===T);let M=E.length;for(const q of E)M+=D(q.id,I);return M},w=k.map(T=>T.text),L=k.map(T=>D(T.id,o));f({labels:w,series:L})})()},[o]),c.useEffect(()=>{if(!u.current)return;const g=new ResizeObserver(()=>{u.current&&y(u.current.offsetHeight)});return g.observe(u.current),()=>g.disconnect()},[N]),c.useEffect(()=>{},[o]);const l=(g,k)=>{const D=[],w=L=>{const T=k.find(I=>I.id===L);if(!T)return!1;if(T.parent&&T.parent!=="root"){if(w(T.parent))return D.push(T.parent),!0}else return!0;return!1};return w(g)?D.reverse():[]},m=g=>{if(!p||!g||!d.current)return;const k=l(g,p);k.length>0&&setTimeout(()=>{d.current.open(k)},500)};return c.useEffect(()=>{h.current===void 0&&i!==void 0&&(h.current=i,m(i))},[p]),p===void 0||p===""?e.jsx(A,{}):p===null?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(Be,{backend:Fe,options:Re(),children:e.jsx("div",{className:"overflow-y-auto scrollbar-hide",style:{height:x-235-$-(v?56:0)+(r>875?60:0),width:"100%"},children:e.jsx(Ie,{ref:d,tree:p,rootId:"root",onDrop:S,canDrag:()=>!v,sort:!0,render:(g,{depth:k,isOpen:D,onToggle:w,isDragging:L,isDropTarget:T})=>e.jsxs("div",{className:`flex items-center rounded-sm
                text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 pr-1 mx-1 ${L?"opacity-50":""} ${T?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
                ${h.current===g.id?"bg-gray-200 dark:bg-gray-800 rounded-r-sm border-l-4 border-blue-500":""}
                `,style:{paddingLeft:k*20+(g.cnt===0?5:0)-(h.current===g.id?4:0)},children:[e.jsx("div",{className:"min-w-0",children:g.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:w,children:D?e.jsx(Ee,{className:"size-6"}):e.jsx(Pe,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{h.current=g.id,s(g)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[g.icon,g.text]}),g.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",g.cnt,")"]})]})]})})})}),e.jsx("div",{ref:u,children:e.jsx(De,{series:[{name:"건수",data:N.series}],labels:N.labels,showDownload:!1})})]})}const Et=o=>{const t=c.useRef(null);function i(){o.onSearchDataBtn(t.current.value)}function s(){return o.onNewMemoBtn(),!1}function p(b){b.which===13&&i()}return e.jsxs(e.Fragment,{children:[e.jsx(K,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:t,className:"w-full ",allClassName:"px-3 py-2",placeholder:"Enter Search...",fullWidth:!0,onKeyDownCapture:p}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(B,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:s,children:"새글"}),e.jsx(B,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:b=>i(),children:"조회"})]})]})};async function Pt(o,t,i=""){if(t==null||t==="")return"";if(o==="home"){const h=await Le("home/tree");if(h!=null)try{return JSON.parse(h)}catch(d){console.error("Error parsing JSON data:",d)}}const s=o==="home"?"home_txt":i===""?`${o}_tree/${t}`:`${o}_txt/${t}`,p=we(ye(Ce,s)),b=await Ne(p);if(!b.exists())return console.log("getTreeData.null"),null;if(!b.exists())return console.log("getTreeData.exists"),null;const v=b.val(),x=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],r=[];o==="home"&&r.push(...x);for(const h in v){const d=v[h];d.id=h;const u={id:h,key:h,text:d.title,parent:o==="home"?d.gbn:d.parent};o==="memo"?(u.icon=d.bm==="Y"?e.jsx(Ue,{className:"text-red-500"}):d.icon==="Y"?e.jsx(vt,{}):null,u.droppable=!0):u.droppable=!1,!((i===""||i===void 0||i===null)&&(u.parent===void 0||u.parent===null||u.parent===""))&&(o==="home"||i===""||i===void 0||i===null?r.push(u):(d.id=h,(d.memo+"").toLowerCase().indexOf(i.toLowerCase())>-1&&(u.parent="root",u.droppable=!1,r.push(u))))}return r.sort((h,d)=>h.title>d.title?1:-1),o==="home"&&_("home/tree",JSON.stringify(r)),r}const Bt=({data:o})=>{const[t,i]=c.useState({labels:[],series:[]});return c.useEffect(()=>{if(o&&o.length>0){const s=o.filter(x=>x.parent==="root").sort((x,r)=>x.text.localeCompare(r.text)),p=(x,r)=>{const h=r.filter(u=>u.parent===x);let d=h.length;for(const u of h)d+=p(u.id,r);return d},b=s.map(x=>x.text),v=s.map(x=>p(x.id,o));i({labels:b,series:v})}else i({labels:[],series:[]})},[o]),e.jsxs(e.Fragment,{children:[e.jsx(nt,{className:"mt-3 ",children:"건수 통계"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 w-full gap-2 justify-center",children:[e.jsx(jt,{series:t.series,labels:t.labels}),e.jsx(De,{series:[{name:"건수",data:t.series}],labels:t.labels}),e.jsx(bt,{series:[{name:"건수",data:t.series}],labels:t.labels}),e.jsx(kt,{series:t.series,labels:t.labels})]})]})},Ws=({rootDb:o})=>{const t=Q(),{user:i}=Z(),s=c.useRef(),p=c.useRef(!0),b=c.useRef(),[v,x]=c.useState(),r=c.useRef(!1),h=le(),d=c.useRef(!1);d.current=h?.state?.reflash===!0;const u=et({queryKey:["twTreeData",i?.uid,s.current],queryFn:()=>Pt(o,i?.uid,s.current)});u.data!==void 0&&u.data!==""&&!r.current&&(r.current=!0);const $=()=>{const m=v;m&&(m.bookmark=m.bookmark==="Y"?"N":"Y"),console.log("onBookmark.memoDetailData.bookmark=",m.bookmark),console.log("onBookmark.rootDb=",o);const g=o==="memo"?`memo_tree/${i.uid}/${b.current}/bm`:`home_txt/${b.current}/bookmark`;_(g,v.bookmark),x({...v,bookmark:m.bookmark})};c.useEffect(()=>{i!==void 0&&i!=null&&u.refetch()},[i]),c.useEffect(()=>{const m=async D=>{if(D!==""&&i){const w=await pt(o,i?.uid,D,s.current);o==="memo"&&(w.path=Ut(u.data,D)),w.code==="404"&&(w.title="No title"),p.current=!1,x(w===void 0?{}:w)}else x({})},g=h.pathname.split("/"),k=g.length>2?g[g.length-1]:"";p.current=!0,b.current=k,m(k)},[h.pathname,i,d.current]),c.useEffect(()=>{i!==void 0&&i!=null&&u.refetch()},[d.current]);const y=m=>{r.current=!1,m!==void 0&&(s.current=m),u.refetch()},N=m=>{m.id!==b.current&&(p.current=!0,t(`/${o==="memo"?"m":o}/${m.id}`))},f=()=>{if(i==null){alert("로그인 후 이용 가능합니다.");return}const m=`/${o==="memo"?"m":o}/insert/insert`;t(m)},S=m=>{},l=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3 flex items-center justify-center",children:e.jsx(st,{to:o==="memo"?"/m":"/home",children:o==="memo"?"메모장":"홈관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[o==="memo"?"":e.jsx(ne,{to:"/m",children:"메모"}),o==="memo"&&i?.uid===$e?e.jsx(ne,{to:"/home",children:"홈관리"}):null,e.jsx(ne,{to:"/todo",children:"TODO"}),e.jsx(ne,{to:"/tw",children:"Sheet"})]}),i!==null&&e.jsx(Et,{onNewMemoBtn:f,onSearchDataBtn:y}),r.current&&u.isFetched?e.jsx(It,{initTreeData:u.data,userId:i?.uid,memoId:b.current,onClick:N}):i===null?e.jsx(e.Fragment,{}):e.jsx(A,{})]});return e.jsxs(Ze,{sideType:"memo",title:o==="memo"?"메모장":"홈페이지관리",sideContents:l,children:[e.jsx(c.Suspense,{fallback:e.jsx(A,{}),children:e.jsxs(Xe,{children:[e.jsx(ee,{path:"/edit/:memoId",element:e.jsx(ke,{rootDb:o,isLoading:p.current,searchWord:s.current,memoDetailData:v})}),e.jsx(ee,{path:"/insert/:memoId",element:e.jsx(ke,{rootDb:o,isLoading:p.current,searchWord:s.current,memoDetailData:v})}),e.jsx(ee,{path:"/util/:memoId",element:e.jsx(Rt,{rootDb:o,isLoading:p.current,searchWord:s.current,memoDetailData:v})}),e.jsx(ee,{path:"/:memoId",element:e.jsx(Nt,{rootDb:o,isLoading:p.current,searchWord:s.current,memoDetailData:v,onTreeUpdate:y,onBookmark:$,data:u.data})}),e.jsx(ee,{path:"*",element:e.jsx(Ft,{searchWord:s.current,data:u.data,onNewMemoBtn:f,title:o==="memo"?"메모장":"홈페이지관리",rootDb:o})})]})}),o==="memo"?e.jsx(yt,{onSelected:S}):"",b.current===""?e.jsx(Bt,{data:u.data}):null,e.jsx(tt,{})]})},Ut=(o,t)=>{let i=[],s=t;if(!o)return i;const p=o.find(b=>b.id===s);for(i.unshift(p),s=p?.parent;s!=null&&s!==""&&s!=="root";){const b=o.find(v=>v.id===s);s=b?.parent,i.unshift(b)}return i};export{Ws as default};
