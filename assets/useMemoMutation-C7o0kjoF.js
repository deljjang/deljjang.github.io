import{bQ as _,b$ as B,c0 as E,bg as Q,eU as K,h as U,r as d,j as t,B as S,P as O,a1 as N,T as I,v as P,y as H,eV as z,a2 as w,o as G,f as J,q as A,z as W,em as Y,G as F}from"./index-CQnB8GtB.js";import{D as T}from"./Delete-BU18w58u.js";import{D as q}from"./Divider-B_N8bA8P.js";import{T as y}from"./TwBadge-XR3ekmd-.js";import{s as V,f as X,c as Z}from"./MemoComm-Bv5Z_G9W.js";var k={},$;function ee(){if($)return k;$=1;var e=_();Object.defineProperty(k,"__esModule",{value:!0}),k.default=void 0;var a=e(B()),u=E();return k.default=(0,a.default)((0,u.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),k}var te=ee();const se=Q(te),de=e=>{const{control:a}=e;K({control:a,name:"content"});const{t:u}=U(),[p,l]=d.useState(!1),[c]=d.useState(!1),[s,m]=d.useState([]),[o,n]=d.useState(e.imageList),i=d.useRef(0);d.useEffect(()=>{m([])},[]);const g=d.useCallback(r=>{r.preventDefault(),r.dataTransfer?.files&&l(!0)},[]),h=d.useCallback(r=>{r.preventDefault(),l(!1)},[]),f=d.useCallback(r=>{let x=[],v=s;r.type==="drop"?x=r.dataTransfer.files:x=r.target.files;for(const b of x){const R=URL.createObjectURL(b);v=[...v,{id:i.current++,object:b,url:R}]}e.onFileUpload(v),m(v)},[s,e]),j=d.useCallback(r=>{n(r),e.onDelete(r)},[e]),C=r=>{e.onInsert(r)},L=r=>e.onRename(r),D=d.useCallback(r=>{const x=s.filter(v=>v.id!==r);e.onFileUpload(x),m(x)},[s,e]),M=d.useCallback(r=>{r.preventDefault(),r.stopPropagation(),l(!1),f(r)},[f]);return t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsx(S,{children:t.jsxs(O,{variant:"outlined",onDragOver:g,onDragLeave:h,onDrop:M,cursor:"pointer",sx:{"&:hover":{cursor:"pointer"}},style:{border:p?"1px dashed red":"1px dashed gray",paddingLeft:5,paddingRight:5,marginBottom:10,textAlign:"center",cursor:"pointer",backgroundColor:p?"secondary":"transparent",position:"relative"},children:[t.jsx("input",{type:"file",id:"fileUpload",style:{display:"none"},multiple:!0,onChange:f}),t.jsx("label",{htmlFor:"fileUpload",children:t.jsxs(S,{display:"flex",flexDirection:"row",alignItems:"center",children:[t.jsx(N,{color:"primary","aria-label":"upload picture",component:"span",children:t.jsx(se,{style:{fontSize:40}})}),t.jsx(I,{children:u("file_upload")})]})}),c&&t.jsx(P,{size:24,style:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})}),t.jsx(ae,{imgList:o,onInsert:C,onRename:L,onClick:j}),s.length>0&&s.map((r,x)=>{const{id:v,object:{name:b},url:R}=r;return t.jsxs("div",{children:[t.jsxs(S,{display:"flex",flexDirection:"row",alignItems:"center",sx:{justifyContent:"space-between"},children:[t.jsx("img",{src:R,style:{width:"50px"}}),t.jsx("div",{children:b}),t.jsx(N,{"aria-label":"delete",onClick:()=>D(v),children:t.jsx(T,{sx:{color:"red"}})})]},x),t.jsx(q,{})]},x)})]})},ae=e=>{const[a,u]=d.useState(e.imgList),{t:p}=U(),[l,c]=d.useState(""),s=n=>(a.map(i=>{if(i.key===n)return e.onInsert(i),!1}),!1),m=n=>(c(n),a.map(i=>{if(i.key===n)return e.onRename(i).then(h=>{h&&(i.key=h.key,i.name=h.name,u([...a]),c(""))}),!1}),!1),o=n=>{const i=a.map(g=>(g.key===n&&(g.del="Y"),g));u(i),e.onClick(i)};return a&&a.length>0&&a.map((n,i)=>{const{key:g,name:h,url:f,del:j,ext:C}=n,L=/(jpg|jpeg|png|gif|bmp|webp|svg)/i;return j!==void 0?"":t.jsxs("div",{children:[t.jsxs("div",{className:`${H.between} gap-1`,children:[C==="mp4"&&t.jsx(I,{style:{width:"50px",textAlign:"center"},variant:"body",children:C}),L.test(C)&&t.jsx("img",{src:f,style:{maxHeight:"50px",maxWidth:"50px"}}),t.jsxs("div",{className:"flex truncate items-center",children:[l===g&&t.jsx(z,{}),h]}),t.jsxs("div",{style:{display:"flex"},children:[f&&t.jsxs("div",{className:"gap-3",children:[t.jsx(w,{onClick:D=>{D.preventDefault(),m(g)},children:p("edit")}),t.jsx(w,{onClick:D=>{D.preventDefault(),s(g)},children:p("add")})]}),t.jsx(N,{"aria-label":"delete",onClick:()=>o(g),children:t.jsx(T,{sx:{color:"rgb(152 48 48)"}})})]})]}),t.jsx(q,{})]},i)})},ue=({onSubmit:e,onCancel:a,isSubmitting:u,newMode:p=!1})=>{const{t:l}=U();return t.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[t.jsx(w,{variant:"outlined",color:"success",disabled:u,isLoading:u,onClick:c=>{c.preventDefault(),e(c)},children:l(p?"new":"save")}),t.jsx(w,{variant:"outlined",color:"error",onClick:c=>{c.preventDefault(),a()},children:l("cancel")})]})},re=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"];function me({onClick:e}){return t.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[t.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>e(`<box>
</box>`),children:"<Box>"}),t.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>e(`<a href="/data/memo/" target="_blank" class="ahover">
</a>`),children:"Link"}),t.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>e('<img src="/data/memo/"></img>'),children:"image"}),t.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>e('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"video"}),t.jsx(y,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>e('<hr style="width=100%"/>'),children:"line"}),re.map((a,u)=>t.jsx(y,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>e(`<code>lang="${a}" highlight=""`),children:a},u))]})}const ge=(e,a)=>{const u=G(),p=J(),{user:l}=A(),c=W();return Y({mutationFn:async({values:s,imageList:m,files:o})=>{console.log("values=",s);const n=p.pathname.includes("/insert"),i=n&&a==="insert"?"root":a,g=await V({rootDb:e,uid:l.uid,newData:n,key:i,values:s}),h=n?g:a,f=e==="memo"?`${e}_txt/${l.uid}/`:`${e}_txt/`,j=e==="memo"?`${e}/${l.uid}/`:`${e}/`;return n||await X(f,j,h,m),await Z(f,j,h,o),e==="memo"&&!n&&(F(`memo_tree/${l.uid}/${h}/title`,s.edTitle),s.rootCheck==="Y"&&F(`memo_tree/${l.uid}/${h}/parent`,"root")),e==="home"&&F("home/tree",null),{key:h,isNew:n}},onMutate:async({values:s})=>{if(p.pathname.includes("/insert"))return;const o=["memoDetail",e,l?.uid,a];await c.cancelQueries({queryKey:o});const n=c.getQueryData(o);return c.setQueryData(o,i=>({...i,title:s.edTitle,memo:s.edContent,gbn:s.edGbn,date:s.edDate,html:i?.html==="sheet"?"sheet":s.htmlCheck,icon:s.iconCheck})),{previousMemoDetail:n,queryKey:o}},onError:(s,m,o)=>{o?.previousMemoDetail&&c.setQueryData(o.queryKey,o.previousMemoDetail),console.error("Error saving memo:",s)},onSuccess:({key:s})=>{const m=`/${e==="memo"?"m":e}/${s}`;u(m,{state:{reflash:!0}})},onSettled:({key:s,isNew:m}={})=>{const o=m?s:a;c.invalidateQueries({queryKey:["twTreeData",e]}),o&&c.invalidateQueries({queryKey:["memoDetail",e,l.uid,o]})}})};export{de as D,me as H,ue as T,ge as u};
