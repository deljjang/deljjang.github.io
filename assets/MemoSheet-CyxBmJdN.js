import{h as O,N as B,d8 as H,j as e,ci as R,bd as A,w as S,I as M,bf as x,p as U,o as W,n as G,r as h,s as K,z as D,A as E,bo as Y,H as J,bp as Q,bq as X,G as w}from"./index-Dm2paWXQ.js";import{T as Z}from"./TwLoading-8711qt4a.js";import{L as ee}from"./HtmlCode-DzN-g-b-.js";import{C as te}from"./ComponentCard-CmggNZ1k.js";import{M as se,T as I,a as ae}from"./MemoComm-CstTQq_h.js";import"./HtmlText-CSRC21Qo.js";import"./index-li8WhkMN.js";/* empty css                   */import"./HomeChartSemiDonut-Bf5Tx693.js";import"./Favorite-CxVOsNkr.js";import"./fireMemoDetail-R08NaW0A.js";import"./angle-right-DBqiOrnH.js";import"./HtmlCode-gs0zW-wG.js";import"./copy-BwvW1UEc.js";import"./TwRadio-CU2MO1rv.js";import"./TwBadge-E3mjeH7o.js";import"./toPropertyKey-DCwh5dYN.js";import"./SinyImageList-BLwur9MJ.js";import"./ImageListItem-88LjCArz.js";import"./CodeText-Cmp9m1NM.js";/* empty css                   */import"./AniButton-B_sT32aK.js";import"./Button-BYhsbgXg.js";import"./Card-DKuDnLfG.js";import"./CardContent-w8l1hQzq.js";import"./SinySelect-DduZEvvl.js";import"./Grid-Cdp69ch2.js";import"./index-DeHn4D1_.js";import"./TextField-BZhj-9J_.js";import"./InputAdornment-BUZOOGn5.js";import"./Popper-BSFr4vgi.js";import"./Chip-N0lOapfo.js";import"./TwCheckbox-DGDkC5Wm.js";import"./TwTextArea-BPSr2s1E.js";import"./IpInfo-Bw10KjjF.js";const ie=({isOpen:N,onClose:C,onCreate:c})=>{const o={visible:{opacity:1},hidden:{opacity:0}},y={hidden:{y:"-50px",opacity:0,scale:.95},visible:{y:"0",opacity:1,scale:1,transition:{duration:.2,ease:"easeOut"}},exit:{y:"50px",opacity:0,scale:.95,transition:{duration:.15,ease:"easeIn"}}},{t:a}=O(),{register:k,control:g,handleSubmit:$,formState:{errors:f}}=B({defaultValues:{title:"",columns:[{title:"col_0",type:"text",width:100,data:"col_0"},{title:"col_1",type:"text",width:100,data:"col_1"},{title:"col_2",type:"text",width:100,data:"col_2"}]}}),{fields:b,append:_,remove:v}=H({control:g,name:"columns"}),j=[{value:"text",label:a("column_type_text")},{value:"numeric",label:a("column_type_numeric")},{value:"date",label:a("column_type_date")},{value:"checkbox",label:a("column_type_checkbox")}],L=i=>{if(!i.title||i.title.trim()===""){alert(a("sheet_title_required"));return}const p={...i,columns:i.columns.map((r,T)=>r.data&&(r.data==="id"||r.data==="title"||r.data==="description")?r:{...r,data:(r.title||"").toLowerCase().replace(/\s+/g,"_")||`col_${T}`})};c(p)};return e.jsx(R,{children:N&&e.jsx(A.div,{className:"fixed inset-0 bg-black/70 bg-opacity-50 z-180 flex justify-center items-center",variants:o,initial:"hidden",animate:"visible",exit:"hidden",children:e.jsx(A.div,{variants:y,initial:"hidden",animate:"visible",exit:"exit",onClick:i=>i.stopPropagation(),children:e.jsx(se,{isDraggable:!0,className:"w-full max-w-sm sm:max-w-xl max-h-[61vh] overflow-y-auto",title:a("create_new_sheet"),children:e.jsxs("form",{onSubmit:$(L),children:[e.jsx("div",{className:"mb-4",children:e.jsx(I,{...k("title",{required:a("sheet_title_required")}),label:a("sheet_title"),placeholder:a("sheet_title_placeholder"),error:!!f.title,helperText:f.title?.message})}),e.jsx("h3",{className:"text-md font-semibold mb-2",children:a("columns")}),e.jsx("div",{className:"space-y-3",children:b.map((i,p)=>e.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-5 gap-2 items-center p-2 ${S.border} rounded-md`,children:[e.jsx("div",{className:"sm:col-span-2",children:e.jsx(M,{name:`columns.${p}.title`,control:g,defaultValue:i.title,render:({field:r})=>e.jsx(I,{...r,placeholder:a("column_title")})})}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(M,{name:`columns.${p}.type`,control:g,defaultValue:i.type,render:({field:r})=>e.jsx(ae,{...r,options:j,className:"dark:bg-gray-700"})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(x,{type:"button",size:"sm",color:"warning",onClick:()=>v(p),disabled:b.length<=1,children:a("delete")})})]},i.id))}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(x,{type:"button",onClick:()=>_({title:"",type:"text",data:""}),children:a("add_column")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"button",variant:"outlined",onClick:C,children:a("cancel")}),e.jsx(x,{type:"submit",children:a("create")})]})]})]})})})})})};function ze({onDeleteTab:N}){const C=t=>{if(!t)return"";const s=new Date(t),d=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),u=String(s.getDate()).padStart(2,"0"),l=String(s.getHours()).padStart(2,"0"),m=String(s.getMinutes()).padStart(2,"0");return`${d}-${n}-${u} ${l}:${m}`},{user:c}=U(),{t:o}=O(),y=W(),a=G().sheetId,[k,g]=h.useState(null),[$,f]=h.useState(!1),[b,_]=h.useState(null),[v,j]=h.useState(""),[L,i]=h.useState({isOpen:!1});h.useEffect(()=>{K({title:o("appSheet"),description:o("appSheet")})},[]),h.useEffect(()=>{if(c){const t=D(E,`memo_sheet/${c.uid}`),s=Y(t,d=>{const n=d.val(),u=n?Object.keys(n).map(l=>{const m=n[l];return{id:l,...m}}):[];u.sort((l,m)=>(m.createdAt||0)-(l.createdAt||0)),g(u)});return()=>s()}},[c]);const p=async t=>{const s=`memo_sheet/${c.uid}`,d=Q(X(D(E),s)).key,n={title:t.title,columns:t.columns,createdAt:Date.now()};w(`${s}/${d}`,n);const u=`memo_sheet_data/${c.uid}/${d}/data`,l={id:0,createdAt:Date.now()};t.columns.forEach(m=>{m.data!=="id"&&m.data!=="createdAt"&&(l[m.data]="")}),w(`${u}/0`,l),l.id=1,w(`${u}/1`,l),f(!1),y(`/m/sheet/${d}`)},r=t=>{y(`/m/sheet/${t}`)},T=async t=>{w(`memo_sheet/${c.uid}/${t}`,null),i({isOpen:!1}),N(t),t===a&&y("/m")},P=async(t,s)=>{s.stopPropagation(),i({isOpen:!0,title:o("delete_confirm_title"),message:o("delete_confirm_message"),color:"warning",onConfirm:()=>{T(t)},onClose:()=>i({isOpen:!1})})},F=(t,s)=>{s.stopPropagation(),_(t.id),j(t.title)},V=t=>{t.stopPropagation(),_(null),j("")},z=async(t,s)=>{if(s.stopPropagation(),!v.trim()){alert(o("sheet_title_required"));return}await w(`memo_sheet/${c.uid}/${t}/title`,v),g(d=>d.map(n=>n.id===t?{...n,title:v}:n)),_(null),j("")};if(c===void 0||k==null)return e.jsx(Z,{});const q=e.jsxs("div",{className:`${S.between}`,children:[e.jsx(J,{className:"text-md",children:o("memo_sheet_list")}),e.jsx(x,{variant:"ghost",color:"sky",onClick:()=>f(!0),children:o("create_new_sheet")})]});return e.jsxs(te,{title:q,className:"my-5",children:[e.jsx(ee,{...L}),e.jsx(ie,{isOpen:$,onClose:()=>f(!1),onCreate:p}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:k.map(t=>e.jsx("div",{onClick:()=>b!==t.id&&r(t.id),className:`relative p-4 ${S.border} ${S.roundedSm} cursor-pointer hover:bg-gray-100 dark:hover:border-sky-500 dark:hover:bg-indigo-900/50 group`,children:b===t.id?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"text",value:v,onChange:s=>j(s.target.value),onClick:s=>s.stopPropagation(),className:"border p-2 rounded-md dark:bg-gray-700",autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{size:"sm",variant:"outlined",onClick:V,children:o("cancel")}),e.jsx(x,{size:"sm",onClick:s=>z(t.id,s),children:o("save")})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex h-8",children:[" ",e.jsx("h6",{className:" font-semibold pr-16 transition-transform duration-200 ease-in-out group-hover:scale-105 transform-origin-left dark:group-hover:text-lg",children:t.title})]}),e.jsxs("div",{className:"flex justify-between items-baseline mt-2 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"text-xs ",children:C(t.createdAt)}),e.jsxs("p",{className:"text-sm ",children:["(",t.count,")"]})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:s=>F(t,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})}),e.jsx("button",{onClick:s=>P(t.id,s),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},t.id))})]})}export{ze as default};
