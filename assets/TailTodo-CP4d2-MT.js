import{j as o,B as le,P as w,g as x,az as se,ap as re,aq as ae,cK as ie,y as ce,F as de,z as I,D as F,G as ue,ab as u,aw as K,ax as N,H as ge,aj as me}from"./index-Bw-LLa9y.js";import{I as H,T}from"./InputField-Nf6c7eH7.js";import{H as fe,r as he}from"./registry-d8W-ona2.js";import{S as xe}from"./Select-Dl8OgH93.js";import{D as ye}from"./date-picker-ikHcZP2D.js";import{n as De}from"./handson-CS9Rir92.js";const ve=n=>o.jsxs(le,{sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[o.jsx(w,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:n.onInsert,children:"입력"}),o.jsx(w,{type:"button",size:"small",variant:"outlined",color:"error",onClick:n.onDelete,children:"삭제"}),o.jsx(w,{type:"button",size:"small",variant:"outlined",color:"success",onClick:n.onReload,children:"리로드"}),o.jsx(w,{type:"button",size:"small",variant:"outlined",onClick:n.onCsvSave,children:"csv저장"})]});he();const we=n=>{const{userId:d,baseUrl:v}=n,m=x.useRef(null),y=x.useRef(null),[S,U]=x.useState(),[M,P]=x.useState(0),{height:R}=se(),k=re.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),V={edTitle:"",edDate:k},{register:C,handleSubmit:W,trigger:L,reset:q,control:b,setValue:j,getValues:D,formState:{errors:f}}=ae({mode:"submit ",defaultValues:V}),{theme:A}=ie(),O=A==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",Y=async e=>{console.log("onFunPost.data",e.id,e);const t=`${v}/${d}/`;if(e.id===void 0){const l=K(N(I(F),t)).key;console.log("onSubmit.newKey",l),e.id=l}return u(t+e.id+"/title",e.title),u(t+e.id+"/date",e.date),u(t+e.id+"/t1",e.t1),u(t+e.id+"/t2",e.t2),u(t+e.id+"/ing","1"),e},_=async()=>{const e=`${v}/${d}/`,t=ce(I(F,e),de("title"));ue(t,l=>{if(!l.exists())return;const a=l.val(),i=[];for(let r in a){const s=a[r];s.id=r,s.sort=`${s.ing}_${s.date}_${s.title}`,i.push(s)}const h=i.sort((r,s)=>r.sort>s.sort?1:-1).filter(r=>r.ing==="1"),c=i.sort((r,s)=>r.sort>s.sort?-1:1).filter(r=>r.ing==="2");U([...h,...c]),P(i.length)})};x.useEffect(()=>{C("edDate",{required:!0,minLength:10}),C("filterField1"),j("columns1",n.selectDefault),C("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}})},[]),x.useEffect(()=>{d!==void 0&&_()},[d]);const G=async()=>{z()},Z=async()=>{m.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:n.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},$=[],B={indicators:!0},E=[];n.columns.map((e,t)=>{e.select&&$.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&E.push(t)}),B.columns=E;const z=()=>{try{const e=m.current?.hotInstance,t=e?.getPlugin("filters");if(t){const l=D("columns1");console.log("onKeyUp.columns1=",l,"text=",D("filterField1")),n.columns.forEach((h,c)=>{t?.removeConditions(c)}),t?.addCondition(Number(l),"contains",[D("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",m.current);const i=e.getData().length;P(i)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function J(){console.log("onInputBtn.errors=",f),console.log("onInputBtn.edDate=",D("edDate")),console.log("onInputBtn.edTitle=",D("edTitle")),W(Q)()}function Q(e,t){console.log("onSubmit.data=",e),console.log("onSubmit.e=",t),console.log("onSubmit.errors=",f);const l=`${n.baseUrl}/${d}/`,a=K(N(I(F),l)).key;console.log("onSubmit.newKey",e.newKey),u(l+a+"/title",e.edTitle),u(l+a+"/date",e.edDate),u(l+a+"/ing","1"),q({edTitle:"",edDate:k})}const X=async(e,t)=>{if(console.log("afterChange.change=",e,", source=",t),console.log("afterChange.change.length=",e?.length),e!==null){const l=m.current?.hotInstance;if(l?.getPlugin("filters")){const i=l.getData(),h=[];e.forEach((c,r)=>{const s={};console.log("afterChange.index1=",r,", item1=",c[0]),n.columns.forEach((g,ne)=>{console.log("afterChange.filteredData=",i[c[0]],g),s[g.data]=i[c[0]][ne]}),console.log("afterChange.tmp=",s),h.push(s)}),console.log("afterChange.saveData=",h),h.forEach(async(c,r)=>{console.log("afterChange.item=",c);const s=await Y(c);console.log("afterChange.result=",r,", result=",s),S.map(g=>{(g.id===void 0||g.id===null)&&(console.log("afterChange.rowData1=",g),g.id=s?.id,console.log("afterChange.rowData2=",g))})}),l.render()}}},ee=async()=>{const e=m.current.hotInstance;if(console.log("onDelete:",e),e&&y.current!==null){if(e?.getPlugin("filters")){const l=e.getData();console.log("onDelete.filteredData=",l[y.current]);const a=l[y.current][n.keyId];console.log("onDelete.deleteId=",a),window.confirm("삭제하시겠습니까?")&&u(`${n.baseUrl}/${d}/${a}`,null)}e.alter("remove_row",y.current,1)}},p=e=>{const t=e.target.value;console.log("onChange.target=",e.target.value),j(e.target.name,t)};function te(e,t){console.log("handleChangeDate.dates=",e,"currentDateString=",t),j("edDate",t),L("edDate")}const oe=f?.edTitle?o.jsx("div",{className:"sm:grid-cols-12 md:grid-cols-12 lg:grid-cols-12 xl:grid-cols-12",children:o.jsx("p",{className:"error",children:f.edTitle?.message})}):"";return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[o.jsx(xe,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:b,className:"dark:bg-dark-900",defaultValue:n.selectDefault?n.selectDefault:"1",options:$,error:!!f.columns1,onChange:p}),o.jsx(H,{name:"filterField1",control:b,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",size:"small",onKeyUp:z,onChange:p}),o.jsx(ye,{control:b,id:"edDate",name:"edDate",label:"등록일자",placeholder:"일자 입력",onChange:te}),o.jsxs("div",{children:[o.jsx(T,{htmlFor:"edTitle",children:"등록제목"}),o.jsx(H,{name:"edTitle",label:"제목",placeholder:"제목 입력",variant:"filled",size:"small",onChange:p,style:{},error:!!f.edTitle})]})]}),oe,o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[o.jsx(T,{textAlign:"left",children:"건수 : "+De(M)}),o.jsx(ve,{onInsert:J,onDelete:ee,onReload:G,onCsvSave:Z})]}),o.jsx("div",{style:{maxHeight:`${R}- 200`,overflow:"auto"},children:o.jsx(fe,{ref:m,data:S,themeName:O,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:R-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:X,afterSelection:e=>{y.current=e},licenseKey:"non-commercial-and-evaluation",columns:n.columns,cells:(e,t)=>n.columns[t].readOnly===!0?{readOnly:!0}:{},colWidths:n.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:B})})]})},Te=()=>{const{user:n}=ge(),d=[{title:"일자",data:"date",type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"1",type:"text",data:"t1",select:!1},{title:"2",type:"text",data:"t2",select:!1},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"진행중",type:"text",data:"ing",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}],v=[130,500,100,100,100];return!n||n?.uid===void 0?o.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:o.jsx(T,{children:"로그인을 해야 이용 가능합니다."})}):o.jsxs(o.Fragment,{children:[o.jsx(we,{csvFileName:"exported_todo",baseUrl:"todo",columns:d,colWidths:v,selectDefault:"1",keyId:d.length-1,userId:n?.uid}),o.jsx(me,{})]})};export{Te as default};
