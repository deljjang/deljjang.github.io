const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B0b1-GgX.js","assets/index-DpmvMFgI.js","assets/index-runlRhjK.css","assets/SinySelect-Dm7rTsgs.js","assets/Grid-DCOPUcW1.js","assets/index-Bb61gu7M.js","assets/TextField-D6kt7hX-.js","assets/InputAdornment-CPppOv7v.js","assets/Popper-1iIFc3o3.js","assets/Chip-B1yaJNBy.js","assets/index.esm-CP8_fm4d.js","assets/index-Cmdt2tIm.css","assets/TwMemoMain-C42aWUHw.js","assets/TwButton-Cw07FOyO.js"])))=>i.map(i=>d[i]);
import{r as d,j as e,m as re,h as Me,z as U,p as I,D as se,A as ae,S as ne,T as oe,E as A,G as Be,q as ie,t as _e,v as Fe,w as le,x as ce,M as de,C as V,Q as me,R as G,n as ue,H as ge,k as Ue,V as Ye,W as Pe,X as ze,Y as Oe,Z as W,$ as F,a0 as he,a1 as xe,a3 as E,N as Ae,cB as He,cD as We,d4 as qe,a4 as z,a5 as Ve,a6 as Ge,a7 as Ke,a8 as Je,a9 as O,aa as Qe}from"./index-DpmvMFgI.js";import{u as Ze}from"./useSuspenseQuery-COOXkDc4.js";import{T as Xe,u as fe,a as pe,F as et,b as tt,D as rt,l as st,I as at,s as Z,d as X,e as nt}from"./index-B0b1-GgX.js";import{E as ot,C as it}from"./ExpandMore-BXVRkCJJ.js";import{F as ve}from"./Favorite-Up2F3JBy.js";import{T as L}from"./TwButton-Cw07FOyO.js";import{D as lt}from"./datetime-BDx6lZXm.js";import{u as ct}from"./index.esm-CP8_fm4d.js";import"./index-CLQ_oLGC.js";import{S as dt,a as mt}from"./SinySelect-Dm7rTsgs.js";import{T as q,I as ut}from"./TextField-D6kt7hX-.js";import{S as gt}from"./check-circle-esYI99zP.js";import"./useBaseQuery-DlxZhiUC.js";import"./Grid-DCOPUcW1.js";import"./index-Bb61gu7M.js";import"./InputAdornment-CPppOv7v.js";import"./Popper-1iIFc3o3.js";import"./Chip-B1yaJNBy.js";const ht=t=>d.createElement("svg",{viewBox:"0 0 24 24",width:"1em",height:"1em",...t},d.createElement("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z",fill:"currentColor"})),xt=t=>d.createElement("svg",{viewBox:"0 0 24 24",fill:"none",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"})),ft=t=>e.jsx(re.div,{whileHover:{scale:1.05},whileTap:{scale:.9},children:e.jsx(Me,{to:t.to,className:"text-inherit no-underline cursor-pointer",...t,children:e.jsx(Xe,{children:t.children})})});function pt({initTreeData:t}){const[s,o]=d.useState(),r=n=>o(n),c=U();if(d.useEffect(()=>{o(t)},[t]),s==null||s.length===0)return e.jsx(I,{});const g=n=>{console.log("node",n),c(`/m/${n.id}`)};return e.jsx(se,{backend:ne,options:ae(),children:e.jsx(oe,{tree:s,rootId:"root",onDrop:r,render:(n,{depth:p,isOpen:m,onToggle:i})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:p*20+(n.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[n.cnt>0&&e.jsx("div",{onClick:i,children:m?e.jsx(ot,{}):e.jsx(it,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>g(n),children:n.text})]}),n.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",n.cnt,")"]})]})})})}function vt(t){const{user:s}=A(),o=U(),[r,c]=d.useState(),[g,n]=d.useState(),p=async m=>{const i=[],l=ie(le(ce,`memo_tree/${m}`),Fe("bm"),_e("Y")),h=await de(l);if(!h.exists()){console.log("getFireData.null");return}const v=h.val();for(let k in v){const u=v[k];u.id=k,u.key=k,u.text=u.title,i.push(u)}i.sort((k,u)=>k.title>u.title?1:-1),c([...i])};return d.useEffect(()=>{s!==void 0&&s!=null&&p(s?.uid)},[s]),d.useEffect(()=>{const m=async(i,l)=>{const h=[...l];if(l)for(const v of l){let k=v;for(;k.parent!=="root";){k.parent,k=await V(`memo_tree/${i}/${k.parent}`);const u={id:k.key,text:k.title,droppable:!1,parent:k.parent};h.filter(y=>y.id===u.id).length===0&&h.push(u)}}for(const v of h){const k=v.id;v.cnt=h.filter(u=>u.parent===k).length}n(h)};r&&r.length>0&&m(s?.uid,r)},[r]),s===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Be,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:r&&r.map((m,i)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{t.onSelected(m.key),o(`/m/${m.key}`)},children:e.jsx("span",{className:"text-base",children:m.title})})},i))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(d.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(pt,{initTreeData:g,uid:s?.uid})})]})}const jt=t=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:"64px 64px 64px"},children:[e.jsx(L,{size:"sm",variant:"outlined",color:"success",onClick:t.onEdit,children:"수정"}),e.jsx(L,{size:"sm",variant:"outlined",color:"warning",onClick:t.onNewMemo,children:"새글"}),e.jsx(L,{size:"sm",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"})]}),kt=t=>{const{rootDb:s,isLoading:o,memoDetailData:r}=t,{scrollYProgress:c}=fe(),g=pe(c,{stiffness:100,damping:30,restDelta:.001}),[n,p]=d.useState(!1),m=U(),i=d.useRef();i.current=t.searchWord;const{memoId:l}=me(),v=G()?.state?.fullIndex,{user:k}=A(),u=()=>{const x=`/${s==="memo"?"m":s}/edit/${l}`;m(x,{state:{fullIndex:v}})},j=()=>{const x=`/${s==="memo"?"m":s}/insert/${l}`;m(x,{state:{fullIndex:v}})},y=async()=>{const x=s==="memo"?`${s}_txt/${k.uid}/${l}`:`${s}_txt/${l}`,w=s==="memo"?`${s}_tree/${k.uid}`:s;if(await tt(x,w)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}t.onTreeUpdate(),m(`/${s==="memo"?"m":s}`)},b=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&y()},N=()=>{t.onBookmark()};return d.useEffect(()=>{r&&r.title!==void 0&&ue({title:r.title,description:r.title});function x(){window.scrollTo({top:0}),r&&r.html!=="N"&&document.querySelectorAll("pre").forEach(w=>{w.innerHTML=ze(w.innerHTML)})}r&&r.memo!==null&&x()},[r]),o?e.jsx(I,{}):l===""||k===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(re.div,{className:"progress-bar",style:{scaleX:g}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:r&&r.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:N,children:r&&r.bookmark==="Y"?e.jsx(ve,{className:"text-red-500"}):e.jsx(et,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:t.memoDetailData?.path&&t.memoDetailData?.path.map((x,w)=>w===0?x.title:` > ${x.title}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(jt,{rootDb:s,onEdit:u,onNewMemo:j,onDelete:b,bookmark:r&&r.bookmark}),e.jsxs("div",{className:"my-4",children:[r&&r.html==="N"?e.jsx(ge,{postData:r&&r.memo}):r&&r.html!=="N"&&r.memo&&e.jsx(Ue,{text:r.memo}),e.jsx(Ye,{imageList:r&&r.image}),!r&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(Pe,{})})})]})]})]})},yt=({onSubmit:t,onCancel:s,isSubmitting:o,newMode:r})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(L,{variant:"outlined",color:"success",disabled:o,onClick:c=>{c.preventDefault(),t(c)},children:[r?"새글":""," 저장"]}),e.jsx(L,{variant:"outlined",color:"error",onClick:s,children:"취소"})]});d.forwardRef((t,s)=>{const{id:o,label:r,defaultValue:c,onChange:g,className:n="",...p}=t,m=i=>{g&&g(i.target.value)};return e.jsxs("div",{className:` ${n}`,children:[r&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",htmlFor:o,children:r}),e.jsx("input",{ref:s,type:"date",id:o,defaultValue:c,onChange:m,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100",...p})]})});const ee=({label:t,checked:s,id:o,onChange:r,className:c="",disabled:g=!1})=>e.jsxs("label",{className:`flex items-center space-x-3 group cursor-pointer ${g?"cursor-not-allowed opacity-60":""}`,children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("input",{id:o,type:"checkbox",className:`w-5 h-5 appearance-none cursor-pointer dark:border-gray-700 border border-gray-300 checked:border-transparent rounded-md checked:bg-brand-500 disabled:opacity-60 
          ${c}`,checked:s,onChange:n=>r(n.target.checked),disabled:g}),s&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"white",strokeWidth:"1.94437",strokeLinecap:"round",strokeLinejoin:"round"})}),g&&e.jsx("svg",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none top-1/2 left-1/2",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:e.jsx("path",{d:"M11.6666 3.5L5.24992 9.91667L2.33325 7",stroke:"#E4E7EC",strokeWidth:"2.33333",strokeLinecap:"round",strokeLinejoin:"round"})})]}),t&&e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:t})]}),wt=d.forwardRef((t,s)=>{const{placeholder:o="Enter your message",rows:r=3,value:c="",onChange:g,className:n="",disabled:p=!1,error:m=!1,hint:i=""}=t,l=v=>{g&&g(v.target.value)};let h=`w-full rounded-lg border px-4 text-sm shadow-theme-xs focus:outline-hidden ${n} `;return p?h+=" bg-gray-100 opacity-50 text-gray-500 border-gray-300 cursor-not-allowed opacity40 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700":m?h+=" bg-transparent  border-gray-300 focus:border-error-300 focus:ring-3 focus:ring-error-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-error-800":h+=" bg-transparent text-gray-900 dark:text-gray-300 text-gray-900 border-gray-300 focus:border-brand-300 focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:focus:border-brand-800",e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:s,placeholder:o,rows:r,value:c,onChange:l,disabled:p,className:h}),i&&e.jsx("p",{className:`mt-2 text-sm ${m?"text-error-500":"text-gray-500 dark:text-gray-400"}`,children:i})]})}),bt=d.lazy(()=>xe(()=>import("./index-B0b1-GgX.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));st.Quill.register("modules/imageDrop",at);he.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const Nt={syntax:{highlight:t=>he.highlightAuto(t).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},Ct=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],$t=t=>{const[s,o]=d.useState(t.imageList),[r,c]=d.useState(t.htmlCheck==="Y"),[g,n]=d.useState(t.iconCheck==="Y"),[p,m]=d.useState(t.newMode?"":t.content),[i,l]=d.useState(),h=d.useRef(),v=d.useRef(),k=d.useRef(null);d.useRef(null);const u=d.useRef(null),j=t.newMode,y=d.useRef([]),{height:b}=Oe(),N=lt.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),x={edTitle:j?"":t.title,edGbn:t.gbn?t.gbn:"etc",edDate:j?N:t.date,content:j?"":t.content,memoTxt:j?"":t.content,htmlCheck:t.htmlCheck,iconCheck:t.iconCheck},{register:w,handleSubmit:$,trigger:M,control:B,setValue:S,getValues:T,watch:je,formState:{errors:K,isSubmitting:ke}}=ct({mode:"onChange",defaultValues:x});d.useEffect(()=>{w("edDate"),w("edGbn",{required:!0}),w("htmlCheck"),w("iconCheck"),w("memoTxt")},[]),d.useEffect(()=>{y.current=[],h.current=t.content,v.current=!1},[t.content]);const J=async a=>{j?await t.onNewSubmit(a,y.current):await t.onPostSubmit(a,s,y.current)},ye=()=>{$(J)()},we=a=>{console.log("onDelete.imageList=",a),o(a)},be=a=>{console.log("onInsert.file",a);let f=h.current;a.ext==="jpg"?(f+=`<img src='${a.url}'/>`,Y(`<img src='${a.url}'/>`)):a.ext==="mp4"&&(f+=`<video preload="auto" controls="" src='${a.url}'></video>`,Y(`<video preload="auto" controls="" src='${a.url}'></video>`)),h.current=f},Ne=a=>{h.current=a},Ce=a=>{console.log("handleFileUpload",a),y.current=a};function $e(a){Y(`<img src='${a}'/>`)}function Se(a){h.current=a,S("content",a),M("content")}function Te(a,f){console.log("handleChangeDate=",a),console.log("handleChangeDate.currentDateString=",f);let D=W(a);console.log("handleChangeDate.dayjs=",D.format("YYYY-MM-DD HH:mm:ss")),S("edDate",D.format("YYYY-MM-DD")),M("edDate")}const Q=(a,f)=>{console.log(`onChecked.${a}=`,f),S(a,f?"Y":"N"),a==="htmlCheck"?c(f):n(f)},De=je("content"),Le=[{value:"",text:"None"},{value:"react",text:"React"},{value:"css",text:"CSS"},{value:"android",text:"Android"},{value:"java",text:"JAVA"},{value:"image",text:"그림 / 사진"},{value:"etc",text:"기타"},{value:"mui",text:"MUI"}],Ie=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],Y=a=>{const f=k.current;if(f){const D=f.selectionStart,C=f.selectionEnd,R=p.slice(0,D),P=p.slice(C);m(R+a+P),S("memoTxt",R+a+P),setTimeout(()=>{f.selectionStart=f.selectionEnd=D+a.length,f.focus()},0)}},_=a=>{Y(a)},Ee=a=>a?/\.(jpg|jpeg|png|gif|bmp|webp|svg)$/i.test(a)||a.includes("image")||a.includes("img"):!1,Re=a=>new Promise((f,D)=>{const C=new Image;C.crossOrigin="anonymous",C.onload=()=>{const R=document.createElement("canvas"),P=R.getContext("2d");R.width=C.width,R.height=C.height,P.drawImage(C,0,0);try{const H=R.toDataURL("image/png");f(H)}catch(H){D(H)}},C.onerror=()=>{D(new Error("Failed to load image"))},C.src=a});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:$(J),style:{width:"100%",minHeight:"300px",maxHeight:{height:b},display:"flex",flexDirection:"column"},children:[e.jsx(yt,{onSubmit:a=>ye(),onCancel:t.onCancel,isSubmitting:ke,newMode:j}),e.jsx(rt,{control:B,onDelete:we,onInsert:be,setContent:Ne,onFileUpload:Ce,imageList:t.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(q,{...w("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목",variant:"filled",size:"small",error:!!K.edTitle})}),e.jsx(dt,{id:"edGbn",name:"edGbn",label:"구분",mdSize:6,control:B,defaultValue:T("edGbn"),selectList:Le,error:!!K.edGbn,onChange:a=>{a.preventDefault();const f=a.target.value;console.log("edGbn=",T("edGbn")),S("edGbn",f)}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(mt,{id:"edDate",label:"일자",value:W(T("edDate")),...w("edDate"),defaultValue:W(T("edDate")),onChange:(a,f)=>{Te(a,f)}}),e.jsx(ee,{id:"html",checked:r,onChange:a=>Q("htmlCheck",a),label:"HTML사용"}),e.jsx(ee,{id:"icon",checked:g,onChange:a=>Q("iconCheck",a),label:"Icon"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"max-h-130 overflow-y-scroll",children:[e.jsx(ge,{postData:p}),e.jsxs("div",{className:"flex gap-2 my-2",children:[e.jsx(q,{...w("edUrl",{}),label:"URL",placeholder:"URL",variant:"filled",size:"small",onChange:a=>{a.preventDefault();const f=a.target.value;console.log("edUrl=",f),S("edUrl",f),l(f)}}),e.jsx(q,{...w("edUrl2",{}),label:"Base64",placeholder:"Base64 이미지 데이터",variant:"filled",size:"small",multiline:!0,rows:2,value:T("edUrl2")||""}),e.jsx(L,{variant:"outlined",color:"success",onClick:a=>{a.preventDefault(),$e(T("edUrl2"))},children:"적용"})]}),T("edUrl")&&Ee(T("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:i,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async a=>{try{const f=await Re(i);S("edUrl2",f)}catch(f){console.error("Base64 conversion failed:",f)}},onError:a=>{a.target.style.display="none"}})})]}),e.jsxs("div",{children:[e.jsx(wt,{ref:k,className:"",value:p,onChange:a=>{S("memoTxt",a),m(a)},rows:22}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(F,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_("<box></box>"),children:"<Box>"}),Ie.map((a,f)=>e.jsx(F,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>_("<code>"+a+"</code>"),children:a},f)),e.jsx(F,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<a href="/data/" target="_blank"></a>'),children:"Link"}),e.jsx(F,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<img src="/data/"></img>'),children:"img"}),e.jsx(F,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<video preload="auto" controls="" src="/data/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(F,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>_('<hr style="width=100%"/>'),children:"line"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-2"})]})]}),e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(bt,{ref:u,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:De,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:Nt,formats:Ct,onChange:Se})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},te=t=>{const{rootDb:s,isLoading:o,memoDetailData:r}=t,{scrollYProgress:c}=fe();pe(c,{stiffness:100,damping:30,restDelta:.001});const g=U(),n=d.useRef(),p=d.useRef();p.current=t.searchWord;const{memoId:m}=me(),i=G(),{user:l}=A();n.current=i.pathname.split("/")[2]==="insert",console.log("memoDetailData=",r?.title),console.log("newMode=",n.current,", memoId=",m);const h=()=>{const u=`/${s==="memo"?"m":s}/${m==="insert"?"":m}`;g(u)},v=async(u,j)=>{console.log("onNewSubmit.values",u);const y=await Z({rootDb:s,uid:l.uid,newData:n.current,key:m==="insert"?"root":m,values:u});if(await X(`${s}_txt`,s,y,j),y!==void 0){const b=`/${s==="memo"?"m":s}/${y}`;g(b,{state:{reflash:!0}})}},k=async(u,j,y)=>{const b=s==="memo"?`${s}_txt/${l.uid}/`:`${s}_txt/`,N=s==="memo"?`${s}_tree/${l.uid}/`:`${s}/`;await nt(b,N,m,j),console.log("onPostSubmit.values",u);const x=await Z({rootDb:s,uid:l.uid,newData:n.current,key:m==="insert"?"root":m,values:u});console.log("onPostSubmit.newKey=",x),console.log("onPostSubmit.files=",y);const w=await X(`${b}/`,s==="memo"?`${s}/${l.uid}/`:`${s}/`,m,y);console.log("onNewSubmit.imageResult",w),s==="memo"&&E(`memo_tree/${l.uid}/${m}/title`,u.edTitle),n.current=!1;const $=`/${s==="memo"?"m":s}/${m}`;s==="home"&&E("home/tree",null),g($,{state:{reflash:!0}})};return d.useEffect(()=>{r&&r.title!==void 0&&ue({title:r.title,description:r.title});function u(){document.querySelectorAll("pre").forEach((j,y)=>{})}r&&r.memo!==null&&u()},[r]),m===""||l===void 0?e.jsx(e.Fragment,{}):r===void 0||o?e.jsx(I,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:n.current===!1&&r&&(r.title===void 0||r.title===""||r.title===null)?e.jsx(I,{}):e.jsx($t,{newMode:n.current,onPostSubmit:k,onNewSubmit:v,onCancel:h,title:r?.title,gbn:r?.gbn,date:r?.date,htmlCheck:r?.html?r?.html:"Y",iconCheck:r?.icon?r?.icon:"Y",content:r?.memo,imageList:r?.image})})})};function St({initTreeData:t,userId:s,memoId:o,onClick:r}){const[c,g]=d.useState(t),{isMoble:n,height:p,width:m}=Ae(),i=d.useRef(),l=d.useRef(),h=(u,j)=>{if(j.dragSource.id!==void 0&&j.dropTargetId!==void 0){const y=`memo_tree/${s}/${j.dragSource.id}/parent`;E(y,j.dropTargetId)}g(u)};d.useEffect(()=>{(()=>{for(const j of t){const y=j.id;j.cnt=t.filter(b=>b.parent===y).length}g(t)})()},[t]);const v=(u,j)=>{const y=[],b=N=>{const x=j.find(w=>w.id===N);if(!x)return!1;if(x.parent&&x.parent!=="root"){if(b(x.parent))return y.push(x.parent),!0}else return!0;return!1};return b(u)?y.reverse():[]},k=u=>{if(!c||!u||!l.current)return;const j=v(u,c);j.length>0&&setTimeout(()=>{l.current.open(j)},500)};return d.useEffect(()=>{i.current===void 0&&o!==void 0&&(i.current=o,k(o))},[c]),c==null||c.length===0?e.jsx(I,{}):e.jsx(se,{backend:ne,options:ae(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:p-220-(n?56:0)+(m>1024?60:0),width:"100%"},children:e.jsx(oe,{ref:l,tree:c,rootId:"root",onDrop:h,render:(u,{depth:j,isOpen:y,onToggle:b,isDragging:N,isDropTarget:x})=>e.jsxs("div",{className:`w-63 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ${N?"opacity-50":""} ${x?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
              ${i.current===u.id?"menu-item-active":""}
              `,style:{paddingLeft:j*20+(u.cnt===0?5:0)},children:[e.jsx("div",{className:"min-w-0",children:u.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:b,children:y?e.jsx(ht,{className:"size-6"}):e.jsx(xt,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{i.current=u.id,console.log("nodeId.current",i.current),r(u)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[u.icon,u.text]}),u.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",u.cnt,")"]})]})]})})})})}const Tt=t=>{const s=d.useRef(null);function o(){t.onSearchDataBtn(s.current.value)}function r(){return t.onNewMemoBtn(),!1}function c(g){g.which===13&&o()}return e.jsxs(e.Fragment,{children:[e.jsx(ut,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:s,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:c}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(L,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:r,children:"새글"}),e.jsx(L,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:o,children:"조회"})]})]})},Dt=async(t,s,o)=>{let r=new Array;for(let c in o){const g=o[c];try{if(g.key=c,g.url===void 0){const n=await He(We,`${s}/${c}.${g.ext}`),p=await qe(n);g.url=p,E(`${t}/image/${c}/url`,p)}r.push(g)}catch(n){console.log("getImageList.catch",n)}}return r},Lt=async(t,s,o,r)=>{let c="",g="",n={};((i,l,h)=>{g=i==="memo"?`${i}/${l}/${h}`:`${i}/${h}`,c=i==="memo"?`${i}_txt/${l}/${h}`:`${i}_txt/${h}`})(t,s,o);async function m(){if(c===void 0)return"";if(n=await V(c),n===void 0)return console.log("No data available"),"";if(n?.fullIndex,n.image!==void 0&&n.image!==null){const i=await Dt(c,g,n.image);n.image=i,(n.imageOK===void 0||n.imageOK==="N")&&(i&&i.map(l=>{l.ext==="jpg"&&(n.memo=n.memo+`<img src='${l.url}'>`)}),E(`${c}/imageOK`,"Y"),E(`${c}/memo`,n.memo))}if(r!==void 0&&r!==""){const i=r,l=new RegExp(i,"gi"),h=n.memo.replace(l,`<span class='lightext'>${i}</span>`);n.memo=h}}return await m(),n};async function It(t,s,o=""){if(s==null||s==="")return"";if(t==="home"){const i=await V("home/tree");if(i!=null)try{return JSON.parse(i)}catch(l){console.error("Error parsing JSON data:",l)}}const r=t==="home"?"home_txt":o===""?`${t}_tree/${s}`:`${t}_txt/${s}`,c=ie(le(ce,r)),g=await de(c);if(!g.exists())return console.log("getTreeData.null"),null;if(!g.exists())return console.log("getTreeData.exists"),null;const n=g.val(),p=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],m=[];t==="home"&&m.push(...p);for(const i in n){const l=n[i];l.id=i;const h={id:i,key:i,text:l.title,parent:t==="home"?l.gbn:l.parent};t==="memo"?(h.icon=l.bm==="Y"?e.jsx(ve,{className:"text-red-500"}):l.icon==="Y"?e.jsx(gt,{}):null,h.droppable=!0):h.droppable=!1,!(h.parent===void 0||h.parent===null||h.parent==="")&&(t==="home"||o===""||o===void 0||o===null?m.push(h):(l.id=i,(l.memo+"").toLowerCase().indexOf(o.toLowerCase())>-1&&m.push(h)))}return m.sort((i,l)=>i.title>l.title?1:-1),t==="home"&&E("home/tree",JSON.stringify(m)),m}const Et=d.lazy(async()=>await xe(()=>import("./TwMemoMain-C42aWUHw.js"),__vite__mapDeps([12,1,2,13]))),Zt=({rootDb:t})=>{const s=U(),{user:o}=A(),r=d.useRef(),c=d.useRef(!0),g=d.useRef(),n=d.useRef(),[p,m]=d.useState(),i=d.useRef(!1),l=G(),h=d.useRef(!1);h.current=l?.state?.reflash===!0;const v=Ze({queryKey:["twTreeData",o?.uid,r.current],queryFn:()=>It(t,o?.uid,r.current)});v.data!==void 0&&v.data!==""&&!i.current&&(i.current=!0);const k=()=>{const x=p;x&&(x.bookmark=x.bookmark==="Y"?"N":"Y");const w=`memo_tree/${o.uid}/${n.current}/bm`;E(w,p.bookmark),m({...p,bookmark:x.bookmark})};d.useEffect(()=>{o!==void 0&&o!=null&&v.refetch()},[o]),d.useEffect(()=>{const x=async M=>{if(M!==""&&o){const B=await Lt(t,o?.uid,M,r.current);t==="memo"&&(B.path=Rt(v.data,M)),c.current=!1,m(B===void 0?{}:B)}},w=l.pathname.split("/"),$=w.length>2?w[w.length-1]:"";c.current=!0,x($),n.current=$},[l.pathname,o]),d.useEffect(()=>{o!==void 0&&o!=null&&v.refetch()},[h.current]);const u=x=>{i.current=!1,x!==void 0&&(r.current=x),v.refetch()},j=x=>{x.id!==n.current&&(c.current=!0,console.log("node",x),s(`/${t==="memo"?"m":t}/${x.id}`))},y=()=>{if(o==null){alert("로그인 후 이용 가능합니다.");return}const x=`/${t==="memo"?"m":t}/insert/insert`;s(x)},b=x=>{},N=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3",children:e.jsx(ft,{to:"/m",children:t==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[t==="memo"?"":e.jsx(z,{to:"/m",children:"메모"}),t==="memo"&&o?.uid==="I3cTgdCxwjhBBno4mtZYvnODPJu1"?e.jsx(z,{to:"/home",children:"홈관리"}):null,e.jsx(z,{to:"/todo",children:"TODO"}),e.jsx(z,{to:"/tw",children:"Sheet"})]}),e.jsx(Tt,{onNewMemoBtn:y,onSearchDataBtn:u}),i.current&&v.isFetched?e.jsx(St,{expandIndex:g.current,initTreeData:v.data,userId:o?.uid,memoId:n.current,onClick:j}):o===void 0?e.jsx(e.Fragment,{}):e.jsx(I,{})]});return o&&o.uid===Ve&&Ge,e.jsxs(Ke,{sideType:"memo",title:t==="memo"?"메모장":"홈페이지관리",sideContents:N,children:[e.jsx(d.Suspense,{fallback:e.jsx(I,{}),children:e.jsxs(Je,{children:[e.jsx(O,{path:"/edit/:memoId",element:e.jsx(te,{rootDb:t,isLoading:c.current,searchWord:r.current,memoDetailData:p})}),e.jsx(O,{path:"/insert/:memoId",element:e.jsx(te,{rootDb:t,isLoading:c.current,searchWord:r.current,memoDetailData:p})}),e.jsx(O,{path:"/:memoId",element:e.jsx(kt,{rootDb:t,isLoading:c.current,searchWord:r.current,memoDetailData:p,onTreeUpdate:u,onBookmark:k,data:v.data})}),e.jsx(O,{path:"*",element:e.jsx(Et,{searchWord:r.current,data:v.data,onNewMemoBtn:y,title:t==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),t==="memo"?e.jsx(vt,{onSelected:b}):"",e.jsx(Qe,{})]})},Rt=(t,s)=>{let o=[],r=s;if(!t)return o;const c=t.find(g=>g.id===r);for(o.unshift(c),r=c?.parent;r!=null&&r!==""&&r!=="root";){const g=t.find(n=>n.id===r);r=g?.parent,o.unshift(g)}return o};export{Zt as default};
