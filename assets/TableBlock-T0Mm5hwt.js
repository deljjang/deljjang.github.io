import{j as e}from"./index-BQN1J123.js";import{r as g}from"./router-v4BRDFYV.js";import{f as Q,aQ as Y,aR as v}from"./App-BDW7-lXS.js";import"./vendor-CCYiWZgt.js";const te=({id:l,block:i,onUpdateBlock:h,onDelete:Z,readOnly:y})=>{const{t:u}=Q(),S=g.useRef(null),[x,C]=g.useState(null),[m,j]=g.useState(null),[O,M]=g.useState(!1),k=g.useRef({}),W=g.useCallback((n,t,o)=>{const s=n.currentTarget.innerHTML,r=JSON.parse(JSON.stringify(i.content));!r.rows[t]||!r.rows[t][o]||(r.rows[t][o].text=s,h(l,{content:r}))},[i.content,l,h]),$=g.useCallback((n,t,o)=>{const s=n.currentTarget.innerHTML,r=JSON.parse(JSON.stringify(i.content));!r.rows[t]||!r.rows[t][o]||(r.rows[t][o].text=s,h(l,{content:r}))},[i.content,l,h]),z=g.useCallback((n,t,o)=>{const s=`${n}-${t}`,r=k.current[s];r&&r.innerHTML!==o&&(r.innerHTML=o||"")},[]),J=g.useCallback(()=>{const n=JSON.parse(JSON.stringify(i.content));let t=0;n.rows[0]&&n.rows[0].forEach(o=>{t+=o.colSpan||1}),t=t||1,n.rows.push(Array.from({length:t},()=>({text:"",backgroundColor:"",textColor:"",textAlign:"left",rowSpan:1,colSpan:1,isMerged:!1}))),h(l,{content:n})},[i.content,l,h]),T=g.useCallback(n=>{if(!(i.content.rows.length<=1)&&window.confirm(u("delete_confirm_message_simple"))){const t=JSON.parse(JSON.stringify(i.content)),o=t.rows[n];for(let r=0;r<n;r++){let a=0;for(let d=0;d<t.rows[r].length;d++){const c=t.rows[r][d];if(!c.isMerged){const p=c.rowSpan||1;r+p>n&&(c.rowSpan-=1),a+=c.colSpan||1}}}let s=0;for(let r=0;r<o.length;r++){const a=o[r];if(!a.isMerged){const d=a.rowSpan||1;if(d>1&&n+1<t.rows.length){let c=0;for(let p=0;p<t.rows[n+1].length;p++){if(c>=s){const w=t.rows[n+1][p];Object.assign(w,{...a,rowSpan:d-1,isMerged:!1});break}c+=t.rows[n+1][p].colSpan||1}}s+=a.colSpan||1}}t.rows.splice(n,1),h(l,{content:t})}},[i.content,l,h,u]),D=g.useCallback(()=>{const n=JSON.parse(JSON.stringify(i.content));n.rows.forEach((t,o)=>{let s=null;for(let r=t.length-1;r>=0;r--)if(!t[r].isMerged){s=t[r];break}s&&(s.rowSpan||1)>1&&o>0,t.push({text:"",backgroundColor:"",textColor:"",textAlign:"left",rowSpan:1,colSpan:1,isMerged:!1})}),h(l,{content:n})},[i.content,l,h]),V=g.useCallback(n=>{if(window.confirm(u("delete_confirm_message_simple"))){const t=JSON.parse(JSON.stringify(i.content));t.rows.every(o=>(o[n]?.colSpan||1)===1&&(o[n]?.rowSpan||1)===1)?t.rows.forEach(o=>{o.length>1&&o.splice(n,1)}):(t.rows.forEach((o,s)=>{const r=o[n];if(r)if(r.isMerged){let a=null,d=-1;for(let c=n;c>=0;c--)if(!o[c].isMerged){a=o[c],d=c;break}a&&d+(a.colSpan||1)>n&&(a.colSpan-=1)}else{const a=r.colSpan||1;if(a>1&&n+1<o.length){const d=o[n+1];Object.assign(d,{...r,colSpan:a-1,isMerged:!1})}}}),t.rows.forEach(o=>{o.length>1&&n<o.length&&o.splice(n,1)})),h(l,{content:t})}},[i.content,l,h,u]),A=g.useCallback(n=>{n.preventDefault(),n.stopPropagation();const t=n.clientX,o=S.current;if(!o)return;const s=o.offsetWidth,r=d=>{const c=s+(d.clientX-t);o.style.width=`${c}px`},a=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a),h&&o&&h(l,{width:o.offsetWidth})};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)},[l,h]),H=g.useCallback((n,t)=>{n.preventDefault(),n.stopPropagation();const o=n.clientX,r=n.currentTarget.parentElement.offsetWidth,a=c=>{const p=r+(c.clientX-o);if(p>30){const w=S.current.querySelector("table");if(w){const N=w.querySelector("colgroup");N&&N.children[t]&&(N.children[t].style.width=`${p}px`)}}},d=c=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",d);const p=r+(c.clientX-o),w=[...i.content.colWidths||[]];w[t]=Math.max(p,30),h(l,{content:{...i.content,colWidths:w}})};document.addEventListener("mousemove",a),document.addEventListener("mouseup",d)},[i.content,l,h]),X=(n,t,o)=>{n.stopPropagation(),!y&&(C({rowIndex:t,cellIndex:o}),j(null))},L=n=>{if(!x)return;const{rowIndex:t,cellIndex:o}=x,s=JSON.parse(JSON.stringify(i.content));s.rows[t][o]||(s.rows[t][o]={text:""}),s.rows[t][o].backgroundColor=n,h(l,{content:s})},R=n=>{if(!x)return;const{rowIndex:t,cellIndex:o}=x,s=JSON.parse(JSON.stringify(i.content));s.rows[t][o]||(s.rows[t][o]={text:""}),s.rows[t][o].textColor=n,h(l,{content:s})},b=n=>{if(!x)return;const{rowIndex:t,cellIndex:o}=x,s=JSON.parse(JSON.stringify(i.content));s.rows[t][o]||(s.rows[t][o]={text:""}),s.rows[t][o].textAlign=n,h(l,{content:s})},P=(n,t,o)=>{M(!0),j({startRow:t,startCol:o,endRow:t,endCol:o}),C(null)},F=(n,t,o)=>{O&&(n.preventDefault(),j(s=>({...s,endRow:t,endCol:o})))},q=()=>{M(!1)},_=()=>m?{minRow:Math.min(m.startRow,m.endRow),maxRow:Math.max(m.startRow,m.endRow),minCol:Math.min(m.startCol,m.endCol),maxCol:Math.max(m.startCol,m.endCol)}:null,K=()=>{const n=_();if(!n||n.minRow===n.maxRow&&n.minCol===n.maxCol)return;const t=JSON.parse(JSON.stringify(i.content)),{minRow:o,maxRow:s,minCol:r,maxCol:a}=n,d=s-o+1,c=a-r+1;t.rows[o][r].rowSpan=d,t.rows[o][r].colSpan=c,t.rows[o][r].isMerged=!1;for(let p=o;p<=s;p++)for(let w=r;w<=a;w++)p===o&&w===r||t.rows[p]&&t.rows[p][w]&&(t.rows[p][w].isMerged=!0);h(l,{content:t}),j(null)},G=()=>{if(!x)return;const{rowIndex:n,cellIndex:t}=x,o=i.content.rows[n][t];if(!o||o.rowSpan<=1&&o.colSpan<=1)return;const s=JSON.parse(JSON.stringify(i.content)),{rowSpan:r,colSpan:a}=o;s.rows[n][t].rowSpan=1,s.rows[n][t].colSpan=1;for(let d=n;d<n+r;d++)for(let c=t;c<t+a;c++)d===n&&c===t||s.rows[d]&&s.rows[d][c]&&(s.rows[d][c].isMerged=!1);h(l,{content:s}),C(null)},f=_(),E=(n,t)=>f?n>=f.minRow&&n<=f.maxRow&&t>=f.minCol&&t<=f.maxCol:!1;return g.useEffect(()=>{i.content?.rows&&i.content.rows.forEach((n,t)=>{n.forEach((o,s)=>{o.isMerged||z(t,s,o.text||"")})})},[i.content,z]),g.useEffect(()=>{const n=()=>{};return document.addEventListener("click",n),()=>{document.removeEventListener("click",n)}},[]),e.jsx("div",{className:"group relative w-full my-2",children:e.jsx("div",{className:"overflow-x-auto [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden",children:e.jsx(Y.Popover,{isOpen:!y&&(!!x||!!m),positions:["bottom","top","right","left"],padding:10,onClickOutside:()=>{C(null),j(null)},content:e.jsxs("div",{className:"cell-menu z-20 bg-white dark:bg-zinc-800 shadow-lg rounded-md p-1 flex flex-col gap-1 w-60",onClick:n=>n.stopPropagation(),children:[m&&(f.minRow!==f.maxRow||f.minCol!==f.maxCol)&&e.jsx("button",{onClick:K,className:"flex items-center gap-2 p-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-md w-full text-left",children:u("merge_cells")}),x&&(i.content.rows[x.rowIndex]?.[x.cellIndex]?.rowSpan>1||i.content.rows[x.rowIndex]?.[x.cellIndex]?.colSpan>1)&&e.jsx("button",{onClick:G,className:"flex items-center gap-2 p-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-md w-full text-left",children:u("unmerge_cells")}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-gray-200 dark:border-zinc-700 my-1"}),e.jsxs("button",{onClick:()=>T(x.rowIndex),className:"flex items-center gap-2 p-2 text-sm text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50 rounded-md w-full text-left",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),u("delete_row")]}),e.jsxs("button",{onClick:()=>V(x.cellIndex),className:"flex items-center gap-2 p-2 text-sm text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50 rounded-md w-full text-left",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),u("delete_column")]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-zinc-700 my-1"})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:u("cell_background")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:i.content.rows[x.rowIndex]?.[x.cellIndex]?.backgroundColor||"#ffffff",onChange:n=>L(n.target.value),className:"w-6 h-6 p-0 border-none rounded cursor-pointer"}),e.jsx("button",{onClick:()=>L(""),className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white","data-tooltip-id":`reset-cell-bg-color-tooltip-${l}`,"data-tooltip-content":u("tooltip_reset_cell_color"),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M15 2.5a2.5 2.5 0 0 1 2.5 2.5v.5h-5v-.5a2.5 2.5 0 0 1 2.5-2.5z"}),e.jsx("path",{d:"M12.5 15a2.5 2.5 0 0 1-5 0v-2.5h5V15z"}),e.jsx("path",{d:"M8.5 21.5a2.5 2.5 0 0 1-2.5-2.5v-.5h5v.5a2.5 2.5 0 0 1-2.5 2.5z"}),e.jsx("path",{d:"M16.5 15a2.5 2.5 0 0 1-5 0v-2.5h5V15z"}),e.jsx("path",{d:"M15 8.5a2.5 2.5 0 0 1-5 0v-2.5h5V8.5z"}),e.jsx("path",{d:"M21.5 8.5a2.5 2.5 0 0 1-2.5-2.5v-.5h5v.5a2.5 2.5 0 0 1-2.5 2.5z"})]})}),e.jsx(v,{id:`reset-cell-bg-color-tooltip-${l}`,place:"top"})]})]})}),e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:u("cell_text_color")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:i.content.rows[x.rowIndex]?.[x.cellIndex]?.textColor||"#000000",onChange:n=>R(n.target.value),className:"w-6 h-6 p-0 border-none rounded cursor-pointer"}),e.jsx("button",{onClick:()=>R(""),className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white","data-tooltip-id":`reset-cell-text-color-tooltip-${l}`,"data-tooltip-content":u("tooltip_reset_text_color"),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M15 2.5a2.5 2.5 0 0 1 2.5 2.5v.5h-5v-.5a2.5 2.5 0 0 1 2.5-2.5z"}),e.jsx("path",{d:"M12.5 15a2.5 2.5 0 0 1-5 0v-2.5h5V15z"}),e.jsx("path",{d:"M8.5 21.5a2.5 2.5 0 0 1-2.5-2.5v-.5h5v.5a2.5 2.5 0 0 1-2.5 2.5z"}),e.jsx("path",{d:"M16.5 15a2.5 2.5 0 0 1-5 0v-2.5h5V15z"}),e.jsx("path",{d:"M15 8.5a2.5 2.5 0 0 1-5 0v-2.5h5V8.5z"}),e.jsx("path",{d:"M21.5 8.5a2.5 2.5 0 0 1-2.5-2.5v-.5h5v.5a2.5 2.5 0 0 1-2.5 2.5z"})]})}),e.jsx(v,{id:`reset-cell-text-color-tooltip-${l}`,place:"top"})]})]})}),e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:u("label_align")}),e.jsxs("div",{className:"flex items-center bg-gray-100 dark:bg-zinc-700 rounded-md",children:[e.jsx("button",{onClick:()=>b("left"),className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white rounded-md","data-tooltip-id":`align-left-tooltip-${l}`,"data-tooltip-content":u("tooltip_align_left"),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"21",y1:"10",x2:"3",y2:"10"}),e.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),e.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),e.jsx("line",{x1:"21",y1:"18",x2:"3",y2:"18"})]})}),e.jsx(v,{id:`align-left-tooltip-${l}`,place:"top"}),e.jsx("button",{onClick:()=>b("center"),className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white rounded-md","data-tooltip-id":`align-center-tooltip-${l}`,"data-tooltip-content":u("tooltip_align_center"),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"17",y1:"10",x2:"3",y2:"10"}),e.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),e.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),e.jsx("line",{x1:"17",y1:"18",x2:"3",y2:"18"})]})}),e.jsx(v,{id:`align-center-tooltip-${l}`,place:"top"}),e.jsx("button",{onClick:()=>b("right"),className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white rounded-md","data-tooltip-id":`align-right-tooltip-${l}`,"data-tooltip-content":u("tooltip_align_right"),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"21",y1:"10",x2:"7",y2:"10"}),e.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),e.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),e.jsx("line",{x1:"21",y1:"18",x2:"7",y2:"18"})]})}),e.jsx(v,{id:`align-right-tooltip-${l}`,place:"top"})]})]})})]})]}),children:e.jsxs("div",{ref:S,className:"relative inline-block",style:{width:i.width?`${i.width}px`:"auto"},onMouseUp:q,children:[e.jsxs("table",{className:"border-collapse border border-gray-300 dark:border-zinc-600 table-fixed",children:[e.jsx("colgroup",{children:i.content.rows[0]?.map((n,t)=>e.jsx("col",{style:{width:i.content.colWidths?.[t]?`${i.content.colWidths[t]}px`:"auto"}},t))}),e.jsx("tbody",{children:i.content.rows.map((n,t)=>e.jsx("tr",{className:"relative group/row",children:n.map((o,s)=>o.isMerged?null:e.jsxs("td",{rowSpan:o.rowSpan||1,colSpan:o.colSpan||1,className:`relative border border-gray-300 dark:border-zinc-600 p-0 ${E(t,s)?"bg-blue-200 dark:bg-blue-800":""}`,style:{backgroundColor:o.backgroundColor||(E(t,s)?void 0:"transparent")},children:[e.jsx("div",{ref:r=>{const a=`${t}-${s}`;k.current[a]=r,r&&r.innerHTML!==(o.text||"")&&(r.innerHTML=o.text||"")},contentEditable:!y,suppressContentEditableWarning:!0,onInput:r=>W(r,t,s),onBlur:r=>$(r,t,s),onClick:r=>X(r,t,s),onMouseDown:r=>P(r,t,s),onMouseOver:r=>F(r,t,s),className:"p-2 focus:outline-blue-500 overflow-hidden whitespace-nowrap",style:{color:o.textColor||"inherit",textAlign:o.textAlign||"left"}}),t===0&&!y&&e.jsx("div",{onMouseDown:r=>H(r,s),className:"absolute top-0 right-0 w-1 h-full cursor-col-resize bg-blue-500 opacity-0 hover:opacity-100 transition-opacity",style:{zIndex:10}})]},s))},t))})]}),!y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute top-1/2 right-2.5 -translate-y-1/2 w-5 h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[e.jsx("button",{onClick:D,className:"addColumn bg-white dark:bg-zinc-800 p-1 rounded-full items-center opacity-0 group-hover:opacity-100","data-tooltip-id":`add-col-tooltip-${l}`,"data-tooltip-content":u("add_column"),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),e.jsx(v,{id:`add-col-tooltip-${l}`,place:"right"})]}),e.jsxs("div",{className:"absolute -bottom-2.5 left-1/2 -translate-x-1/2 w-full h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[e.jsx("button",{onClick:J,className:`addRow right-6 z-9999 p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity bg-white dark:bg-zinc-800 
            hover:bg-gray-200 dark:hover:bg-zinc-700`,"data-tooltip-id":`add-row-tooltip-${l}`,"data-tooltip-content":u("add"),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),e.jsx(v,{id:`add-row-tooltip-${l}`,place:"bottom"})]}),e.jsx("div",{onMouseDown:A,className:"absolute bottom-0 right-0 w-4 h-4 bg-blue-500 cursor-se-resize opacity-0 group-hover:opacity-100 transition-opacity"})]})]})})})})};export{te as TableBlock};
