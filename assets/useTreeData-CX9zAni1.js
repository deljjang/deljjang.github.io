import{r as c,j as l,i as g,s as j,ap as b,q as T,o as w,n as C,am as R,t as M}from"./index-BOYjaTAS.js";import{T as D,a as S,E as k,b as L,t as x}from"./CommonLayout-Bq2cPeC5.js";const E=j(L)(({theme:e})=>({color:e.palette.text.secondary,[`& .${x.content}`]:{color:e.palette.text.secondary,borderTopRightRadius:e.spacing(2),borderBottomRightRadius:e.spacing(2),paddingRight:e.spacing(1),fontWeight:e.typography.fontWeightMedium,"&.MuiTreeItem-content":{paddingLeft:"3px",paddingRight:"3px"},".MuiTreeItem-label":{paddingLeft:"0px"},".MuiTreeItem-iconContainer":{marginRight:"0px"},"&.Mui-expanded":{fontWeight:e.typography.fontWeightRegular},"&:hover":{backgroundColor:e.palette.action.hover},"&.Mui-selected":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},[`& .${x.label}`]:{fontWeight:"inherit",color:"inherit"}},[`& .${x.group}`]:{marginLeft:0,[`& .${x.content}`]:{paddingLeft:e.spacing(1)}}})),W=c.forwardRef(function(a,s){const{labelIcon:t,labelInfo:n,labelText:r,pl:i,...d}=a;return l.jsx(E,{label:l.jsxs(g,{sx:{display:"flex",alignItems:"center",p:.5,pr:2,pl:{pl:i}},children:[l.jsx(g,{component:t,color:"inherit",sx:{mr:1,pl:{pl:i}}}),l.jsx(b,{sx:{fontWeight:"inherit",flexGrow:1},component:"div",children:r}),l.jsx(b,{variant:"caption",color:"inherit",children:n})]}),...d,ref:s})}),I=e=>{const{id:a,fullIndex:s,title:t,sub:n}=e.item;if(a===void 0)return console.log("SubTreeItem.item.undefined=",e.item),l.jsx(l.Fragment,{});const r=n&&Object.values(n).length>0?Object.values(n).length+"":"";return l.jsx(W,{onClick:()=>e.onDetail(a,s),nodeId:a,labelText:t,labelInfo:r,pl:e.pl,children:n!=null?Object.values(n).sort((i,d)=>i.title>d.title?1:-1).map((i,d)=>l.jsx("div",{style:{paddingLeft:e.pl+5},children:l.jsx(I,{onDetail:e.onDetail,item:i,pl:e.pl+5})},d+"")):""})};function G(e){const[a,s]=c.useState([]),t=(r,i)=>{e.onDetail(r,i)},n=(r,i)=>{s(i)};return l.jsx(g,{sx:{minHeight:180,flexGrow:1,display:"flex",flexDirection:"column",height:e.maxHeight,overflow:"hidden",width:"100%"},children:l.jsx(D,{"aria-label":"icon expansion",defaultCollapseIcon:l.jsx(k,{}),defaultExpandIcon:l.jsx(S,{}),expanded:a,onNodeToggle:n,sx:{flexGrow:1,overflow:"hidden",overflowY:"auto"},children:e.data&&e.data.map((r,i)=>l.jsx(I,{onDetail:t,item:r,parentIndex:i+1,pl:5},i+1))})})}const q=e=>{const[a,s]=c.useState(e),[t,n]=c.useState([]),[r,i]=c.useState(),d=c.useCallback(m=>{const y=T(C(M,m),w("title"));R(y,h=>{if(!h.exists())return;const p=h.val();console.log("useTreeData.data=",p);const f=[];for(let u in p){const o=p[u];o.up===void 0?(o.id=u,o.fullIndex=u):(o.id=o.up,o.fullIndex=o.up),r===""||r===void 0?(o.sub!==null&&(o.children=v(o,o.up)),f.push(o)):(o.id=u,(o.memo+"").toLowerCase().indexOf(r.toLowerCase())>-1&&f.push(o))}f.sort((u,o)=>u.title>o.title?1:-1),n(f)})},[r]);return c.useEffect(()=>{a!==""&&d(a)},[d,a,r]),[t,s,i]};function v(e,a){const s=[];if(e===void 0||e.sub===void 0)return s;for(let t in e.sub){let n=e.sub[t];n.id=t,n.key=t}return Object.values(e.sub).sort((t,n)=>n.title-t.title).map(t=>{t.id=t.key,t.fullIndex=a+"/sub/"+t.key,t.sub!==null&&(t.children=v(t,t.fullIndex)),s.push(t)}),s}export{G as S,q as u};
