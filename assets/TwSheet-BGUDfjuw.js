import{j as s,r as u,aH as ne,aI as re,a as le,q as ie,o as ae,b as H,f as z,c as ce,p as ue,d as de,e as me}from"./index-Bq2okyO2.js";import{T as B}from"./TwLabel-67sX6rJe.js";import{H as fe,r as he}from"./registry-2SgsyguN.js";import{D as ge}from"./datetime-BDx6lZXm.js";import{u as xe}from"./index.esm-Dv4f8xaF.js";/* empty css                */import{s as h}from"./fireDatabase-CYS3RlZB.js";import{n as pe}from"./commonUtil-BuOP-BrX.js";import{u as ye}from"./useWindowDimensions-bUsLyrm4.js";import{T as ve}from"./TwInput-C6zKzPJT.js";import{T as we}from"./TwSelect-2-7eLP7d.js";import{T as C}from"./TwButton-DnBv8mIC.js";import{T as Ce}from"./Footer-Lko9pIeR.js";import"./LinkItem-DmovyF0G.js";import"./Typography-BfnFn_Qs.js";import"./TwLinkItem-B8UrJan3.js";import"./Divider-CoH0J48V.js";import"./dividerClasses-KAVeIEaH.js";import"./Link-DErjXeoJ.js";const je=a=>s.jsxs("div",{className:"my-2 flex justify-end items-center",children:[s.jsx(C,{size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:a.onInsert,children:"추가"}),s.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"error",className:"mr-2",onClick:a.onDelete,children:"삭제"}),s.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"success",className:"mr-2",onClick:a.onReload,children:"리로드"}),s.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:a.onCsvSave,children:"csv저장"})]});he();const De=({csvFileName:a="exported_sheet",baseUrl:m="sheet",columns:g,selectDefault:j="1",keyId:O,userId:x})=>{const c=u.useRef(null),v=u.useRef(null),[b,V]=u.useState(),[K,I]=u.useState(0),{height:R,width:F}=ye(),S=u.useRef(!1),[T,M]=ne(re),{theme:A,settings:L,colWidths:q,setColWidths:D}=le();ge.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:G,reset:be,control:N,setValue:k,getValues:w,formState:{errors:U}}=xe({mode:"submit "}),Z=A==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",J=async e=>{const t=`${m}/${x}/`;if(e.id===void 0||e.id===null||e.id===""){const o=ue(de(H(z),t)).key;e.id=o}return h(t+e.id+"/dv",e.dv),h(t+e.id+"/title",e.title),h(t+e.id+"/t1",e.t1),h(t+e.id+"/t2",e.t2),h(t+e.id+"/ing","1"),e},Q=async()=>{const e=`${m}/${x}/`,t=ie(H(z,e),ae("dv"));ce(t,o=>{if(!o.exists())return;const r=o.val(),l=[];for(let i in r){const n=r[i];n.id=i,n.sort=`${n.dv}_${n.title}`,l.push(n)}l.sort((i,n)=>i.sort>n.sort?1:-1),V(l),I(l.length)})};u.useEffect(()=>{G("filterField1"),k("columns1",j),console.log("SheetGrid.text=",T)},[]),u.useEffect(()=>{x!==void 0&&Q()},[x]),u.useEffect(()=>{F<500&&S.current===!1&&(S.current=!0,D([100,100,100,100,100,100]))},[F]),u.useEffect(()=>{c.current.hotInstance.addHook("afterColumnResize",function(t,o){const r=q;try{r[o]=t,D(r)}catch{D([130,300,100,100,100,100])}})},[c.current]);const X=async()=>{W()},Y=async()=>{c.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:a,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},E=[],P={indicators:!0},$=[];g.map((e,t)=>{e.select&&E.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&$.push(t)}),P.columns=$;const W=()=>{try{const e=c.current?.hotInstance,t=e?.getPlugin("filters");if(t){const o=w("columns1");console.log("onKeyUp.columns1=",o,"text=",w("filterField1")),M(w("filterField1")),g.forEach((i,n)=>{t?.removeConditions(n)}),t?.addCondition(Number(o),"contains",[w("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",c.current);const l=e.getData().length;I(l)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function ee(){c.current.hotInstance.alter("insert_row_above",0,1)}const te=async(e,t)=>{if(e===null)return;const o=c.current?.hotInstance,r=o?.getPlugin("filters");if(r==null)return;const l=o.getData(),i={};e.forEach(async(d,p)=>{i[d[0]]=d[0]}),console.log("afterChange.lines=",i);const n=[];Object.keys(i).map(d=>{const p=i[d];console.log("afterChange.lines.key=",d,", lines=",p);const y={};g.forEach(async(f,oe)=>{y[f.data]=l[p][oe]}),n.push(y)}),console.log("afterChange.saveData=",n),n.forEach(async(d,p)=>{const y=await J(d);console.log("afterChange.result=",p,", result=",y),b.map(f=>{(f.id===void 0||f.id===null)&&(f.id=y?.id,console.log("afterChange.rowData2=",f))})}),o.render()},se=async()=>{const e=c.current.hotInstance;if(e&&v.current!==null){if(e?.getPlugin("filters")){const r=e.getData()[v.current][O];window.confirm("삭제하시겠습니까?")&&h(`${m}/${x}/${r}`,null)}e.alter("remove_row",v.current,1)}},_=e=>{const t=e.target.value;k(e.target.name,t)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[s.jsx(we,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:N,className:"dark:bg-dark-900",defaultValue:j||"1",options:E,error:!!U.columns1,onChange:_}),s.jsx(ve,{name:"filterField1",control:N,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",onKeyUp:W,onChange:_,value:T})]}),s.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[s.jsx(B,{textAlign:"left",children:"건수 : "+pe(K)}),s.jsx(je,{onInsert:ee,onDelete:se,onReload:X,onCsvSave:Y})]}),s.jsx("div",{className:"grid grid-cols-1",style:{maxHeight:`${R} - 210`,overflow:"auto"},children:s.jsx(fe,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:c,data:b,themeName:Z,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:R-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:te,afterSelection:e=>{v.current=e},columns:g,cells:(e,t)=>g[t].readOnly===!0?{readOnly:!0}:{},colWidths:L.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:P,licenseKey:"non-commercial-and-evaluation"})})]})};function Ae(){const{user:a}=me(),m=[{title:"구분",data:"dv",readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"설명1",type:"text",data:"t1",select:!0},{title:"설명2",type:"text",data:"t2",select:!0},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];return a===void 0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:s.jsx(B,{children:"로그인을 해야 이용 가능합니다."})}):s.jsxs(s.Fragment,{children:[s.jsx(De,{csvFileName:"exported_sheet",baseUrl:"sheet",columns:m,selectDefault:"1",keyId:m.length-1,userId:a?.uid}),s.jsx(Ce,{})]})}export{Ae as default};
