import{j as e,i as S,p as Q,r as n,v as O,w as Z,q,z as ee,T as te,C as oe,H as se,S as ne,P as ae,o as U,M as ie,Q as re,D as V,E as k,F as P,J as ce,x as le,R as me,O as z,U as de,V as ue,W as xe,X as fe,Y as he,Z as G,$ as ge}from"./index-BYAZQ8R2.js";import{M as we,a as pe}from"./MemoMoveModal-CyIW9wEL.js";import{L as je}from"./LoginDisplay-Boh56XiM.js";import{H as X,f as K,a as A,b as Me,c as ye,d as De,g as be}from"./fireDetail-KKLUVBUh.js";import{S as Se}from"./SinyTree-COe2DUrE.js";import{a as Ie}from"./useTreeData-DgiE6TFT.js";import{C as ve}from"./CommonLayout-dMzUlhbq.js";import{MemoMain as He}from"./MemoMain-BdstC3jh.js";import{A as L}from"./AniButton-v-vsa3Ju.js";import{c as $e}from"./CodeText-Bu7hV44O.js";import"./TextField--U8wTNcl.js";import"./Button-BYF3W_UD.js";import"./SinyDate-BcCWOyvu.js";import"./InputAdornment-B7xLKaH2.js";import"./Popper-CBt0xfau.js";import"./Chip-DWeJ1F_G.js";import"./index.esm-quhieT8B.js";import"./datetime-BDx6lZXm.js";import"./useBaseQuery-CBtuKhA5.js";import"./Collapse-i6702K5Q.js";const Te=a=>e.jsxs(S,{sx:{flexGrow:1,my:2,width:"100%",display:"flex",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"center",textAlign:"center"},children:[e.jsx(L,{type:"button",size:"small",variant:"outlined",color:"success",onClick:a.onEdit,children:"수정"}),e.jsx(L,{type:"button",size:"small",variant:"outlined",onClick:a.onNewMemo,children:"새글"}),e.jsx(L,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:a.onMove,children:"이동"}),e.jsx(L,{type:"button",size:"small",variant:"outlined",color:"error",onClick:a.onDelete,children:"삭제"})]}),Ce=a=>{const{title:u,gbn:l,date:p,text:m,image:h,setFireId:N,isLoading:j,onReload:I}=Q(),[g,r]=n.useState(!1),[E,M]=n.useState(!1),y=O(),i=n.useRef(),v=n.useRef();v.current=a.searchWord;const{homeId:t}=Z(),o=`${l.current}/sub/${t}`;console.log("HomeMngDetail.fullIndex=",o);const{user:c}=q(),{settings:w,saveSettings:x}=ee(),R=()=>{i.current=!1,j===!1&&r(!0)},F=()=>{i.current=!0,j===!1&&r(!0)},D=async()=>{console.log("handleDelete.homeId=",t);const s=`home_txt/${t}`,d=await De(s,"home");if(console.log("handleDelete.result=",d),d===void 0){alert("삭제에 실패했습니다.[code:d02]");return}y("/homemng")},b=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&D()},H=()=>{r(!1)},W=()=>{M(!0)},$=async s=>{try{const T=await ye("home",l.current,t,s);console.log("onMoveSubmit.result=",T)}catch{}finally{M(!1)}},B=async(s,d)=>{const f=await K(void 0,"home_txt/","home/",s.edGbn,s);console.log("onNewSubmit.newKey=",f,", homeId=",t);const C=await A("home_txt","home",f,d);console.log("onNewSubmit.imageResult",C),f!==void 0&&y(`/homemng/${f}`),i.current=!1,r(!1),I()},Y=async(s,d,T)=>{const _="home_txt",f="home";if(await Me(_,f,t,d),await K(t,"home_txt/","home/",o,s),await A("home_txt","home",t,T),o===void 0){const C=await re(`${f}fullIndex`);C!==void 0&&await V(k(P,`home/${C}/title`),s.edTitle)}i.current=!1,r(!1),I()};n.useEffect(()=>{x({...w,nodeId:t}),r(!1),N(`home_txt/${t}`,`home/${t}`,v.current)},[t,c]);function J(){document.querySelectorAll("pre").forEach(s=>{s.innerHTML=$e(s.innerHTML)})}return n.useEffect(()=>{m!==null&&J()},[m]),t===""||c===void 0?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(te,{children:u.current}),e.jsx(n.Suspense,{fallback:e.jsx(U,{}),children:e.jsxs(oe,{className:"container",sx:{p:0,width:"100%"},children:[!g&&e.jsx(Te,{onEdit:R,onNewMemo:F,onMove:W,onDelete:b}),g&&e.jsx(X,{newMode:i.current,onPostSubmit:Y,onNewSubmit:B,onCancel:H,title:u.current,gbn:l.current,date:p.current,content:m,imageList:h}),e.jsxs(S,{sx:{my:2,overflow:"hidden",overflowX:"auto"},children:[l.current,e.jsx(se,{show:!g,text:m}),!g&&e.jsx(ne,{imageList:h}),j&&e.jsx(S,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx(ae,{sx:{mt:5}})})]}),e.jsx(we,{userId:c.uid,open:E,data:a.data,onClose:()=>M(!1),onPost:$})]})}),e.jsx(ie,{})]})},Le=320,Qe=()=>{const a=O(),{user:u}=q(),[l,p]=n.useState(!1),m=n.useRef(),[h]=Ie("home"),[N,j]=n.useState(""),I=n.useRef();n.useEffect(()=>{},[u]);const g=(o,c)=>{I.current=c,j(o),a(`/homemng/${o}`,{state:{fullIndex:c}})},r=()=>{p(!0)},E=o=>{m.current=o},M=()=>{p(!1)},y=async(o,c)=>{const w=`home_txt/${u.uid}/`;for(let D=0;D<c.length;D++){const b=c[D].object,H=be(b.name),W={ext:H,name:b.name,use:"Y"},$=de(ue(k(P),w+"image")).key;V(k(P,w+`image/${$}`),W);const B=await xe(ge,`home/${N}/${$}.${H}`);await fe(B,b)}const x=he(w),R={title:o.edTitle,date:o.edDate,gbn:o.edGbn,memo:o.content,fullIndex:x,up:x,bookmark:"N"};G(`${w}${x}`,R);const F={gbn:"",property:"m",title:o.title,up:x};G(`home/${x}`,F),p(!1)},{height:i,width:v}=ce();if(!u)return e.jsx(e.Fragment,{});u.uid!==le&&a("/");const t=e.jsxs(S,{sx:{minHeight:110,flexGrow:1,minWidth:100,maxHeight:i},children:[e.jsx(je,{}),e.jsx(pe,{onNewMemoBtn:r,onSearchDataBtn:E}),e.jsx(S,{sx:{flexGrow:1,minWidth:100,minHeight:110,maxHeight:i-220,height:i-220},children:e.jsx(n.Suspense,{fallback:e.jsx(U,{}),children:e.jsx(Se,{data:h,onDetail:g,maxHeight:i-150})})})]});return e.jsxs(ve,{title:"홈 관리",drawerWidth:Le,width:v,sideContents:t,children:[e.jsxs(me,{children:[e.jsx(z,{path:"/",element:e.jsx(He,{searchWord:m.current,data:h,onNewMemoBtn:r,title:"홈페이지 관리"})}),e.jsx(z,{path:"/:homeId",element:e.jsx(Ce,{searchWord:m.current,data:h})})]}),l&&e.jsx(X,{show:l,newMode:l.current,onPostSubmit:y,onNewSubmit:y,onCancel:M,title:"",content:"",imageList:[]})]})};export{Qe as default};
