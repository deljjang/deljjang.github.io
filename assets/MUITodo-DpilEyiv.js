import{aj as Q,j as e,Z as fe,$ as ee,B as k,bX as O,r as i,bm as ge,bn as pe,z as A,A as N,bo as je,aM as te,N as ne,a0 as G,T as _,cD as ye,D as Z,bp as se,bq as oe,I as De,bh as be,U as ve,C as ae,cJ as q,q as Ce,O as we,d1 as Te,d2 as Ie,Q as Se,p as ie,d3 as ke,d4 as X,s as Fe,L as Le}from"./index-DXrHB5H9.js";import{d as J}from"./MuiCard-COA94HVx.js";import{T as Me,a as Re}from"./Tabs-B5GOdT1x.js";import{D as $e,S as Be,a as We}from"./SinySelect-DXiFgJAW.js";import{A as F}from"./AniButton-CMKBF52j.js";import{S as K}from"./SinyItem-BMEsVJcF.js";import{G as b}from"./Grid-D73eAoAs.js";import{T as H}from"./TextField-D9RW5GRW.js";import"./muiBackground-EwbA7iah.js";import"./Card-frmpXIEj.js";import"./CardContent-R3zvoaEB.js";import"./KeyboardArrowRight-Di072QsW.js";import"./index-DNY3ZCiY.js";import"./InputAdornment-DGdYL5b4.js";import"./Popper-DZ6iHmcx.js";import"./Button-C1mNwFdL.js";import"./Chip-BfOPPzrE.js";const Ee=Q(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),ze=Q(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),Pe=ee(k)(({theme:t})=>({backgroundColor:t.palette.mode==="dark"?O.dark.backgroundColor:O.light.backgroundColor,borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",alignContent:"center",justifyContent:"center",overflowX:"auto"}));function Ue({tabValue:t,onChange:o,tabs:u}){const r=fe(),l=ee(Me)({"&.Mui-selected":{color:r.palette.text}});return e.jsx(Pe,{index:t,style:{width:"100%"},children:e.jsx(Re,{value:t,onChange:o,variant:"scrollable",scrollButtons:!1,allowScrollButtonsMobile:!0,"aria-label":"secondary tabs example",children:u.map(d=>e.jsx(l,{label:d.label},d.id))})})}const Ge=t=>{const[o,u]=i.useState(t),[r,l]=i.useState([]),[d,x]=i.useState(),h=i.useCallback(v=>{const C=ge(A(N,v),pe("title"));je(C,w=>{if(!w.exists())return;const p=w.val(),y=[];for(let f in p){const c=p[f];c.id=f,c.sort=`${c.ing}_${c.date}_${c.title}`,(d===""||d===void 0||(c.memo+"").toLowerCase().indexOf(d.toLowerCase())>-1)&&y.push(c)}const B=y.sort((f,c)=>f.sort>c.sort?1:-1).filter(f=>f.ing==="1"),j=y.sort((f,c)=>f.sort>c.sort?-1:1).filter(f=>f.ing==="2");l([...B,...j])})},[d]);return i.useEffect(()=>{o!==""&&h(o)},[h,o,d]),[r,u,x]},He=t=>{const{userId:o}=t,[u,r]=Ge(""),l=te.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),d={edTitle:"",edDate:l},{register:x,handleSubmit:h,reset:v,getValues:C,setFocus:w,formState:{errors:p,isSubmitting:y,submitCount:B}}=ne({mode:"submit ",defaultValues:d}),j=i.useRef();i.useEffect(()=>{x("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:3,message:"3글자 이상 입력해주세요."}}),x("edDate",{required:!0,minLength:10})}),i.useEffect(()=>{o!==void 0&&r(`todo/${o}`)},[o]);async function f(s){s.preventDefault(),h(E)()}const c=()=>{t.handleGoogleLogin()};if(o===void 0)return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:[e.jsx(K,{children:"로그인을 해야 이용가능합니다."}),e.jsx(F,{type:"button",size:"small",variant:"outlined",color:"success",sx:{mt:30},onClick:c,children:"로그인"})]});const L=(s,g)=>{s.preventDefault(),w("edTitle"),v({edTitle:g.title,edDate:g.date}),j.current=g.id},W=s=>{s.preventDefault(),v({edTitle:""}),j.current=void 0},M=(s,g)=>{s.preventDefault(),window.confirm("삭제하시겠습니까?")&&setFireData(`todo/${o}/${g.id}`,null)},T=(s,g)=>{s.preventDefault(),window.confirm("완료하시겠습니까?")&&setFireData(`todo/${o}/${g.id}/ing`,"2")},V=s=>console.error(s);function E(s,g){const m=`todo/${o}/`;if(j.current===void 0){const S=se(oe(A(N),m)).key;j.current=S}setFireData(m+j.current+"/title",s.edTitle),setFireData(m+j.current+"/date",s.edDate),setFireData(m+j.current+"/ing","1"),j.current=void 0,v({edTitle:"",edDate:l})}return e.jsxs(e.Fragment,{children:[e.jsxs(k,{sx:{width:"100%",flexGrow:1,m:2},children:[e.jsx("div",{id:"back-to-top-anchor"}),e.jsx("form",{onSubmit:h(E,V),children:e.jsxs(b,{container:!0,spacing:2,columns:{xs:12,md:12},children:[e.jsx(b,{item:!0,xs:12,children:e.jsx(H,{type:"date",style:{paddingTop:"2px"},fullWidth:!0,placeholder:"일자",...x("edDate"),variant:"standard"})}),e.jsx(b,{item:!0,xs:9,sm:10,children:e.jsxs(k,{sx:{display:"flex",alignItems:"normal",justifyContent:"center"},children:[e.jsx(H,{fullWidth:!0,style:{paddingTop:"2px"},placeholder:"Todo Input",...x("edTitle"),variant:"standard",error:!!p.edTitle}),e.jsx(G,{style:{marginTop:"-4px"},"aria-label":"bookmark",onClick:s=>W(s),children:e.jsx(Ee,{sx:{color:"action.active"}})})]})}),e.jsx(b,{item:!0,xs:3,sm:2,children:e.jsx(F,{variant:"outlined",fullWidth:!0,onClick:s=>f(s),color:"success",size:"small",disabled:y,children:"입력"})}),e.jsx(b,{item:!0,xs:12,sm:12,children:p?.edTitle?e.jsx("p",{className:"error",children:p.edTitle?.message}):null})]})}),u?.map((s,g)=>e.jsxs("div",{children:[e.jsxs(k,{sx:{display:"plex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(_,{component:"div",variant:"body2",color:"text.prime",children:s.date}),e.jsxs(k,{sx:{display:"plex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[s.ing==="1"&&e.jsxs(e.Fragment,{children:[e.jsx(G,{"aria-label":"완료",onClick:m=>T(m,s),children:e.jsx(ze,{})}),e.jsx(G,{"aria-label":"edit",onClick:m=>L(m,s),children:e.jsx(ye,{})})]}),e.jsx(G,{"aria-label":"delete",onClick:m=>M(m,s),children:e.jsx($e,{sx:{color:"rgba(120, 0, 0, 3)"}})})]})]}),e.jsx(_,{component:"div",variant:"body",color:"text.prime",children:s.title}),e.jsx(Z,{})]},g))]}),e.jsx(Z,{})]})},Ve=t=>e.jsxs(k,{sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[e.jsx(F,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:t.onInsert,children:"입력"}),e.jsx(F,{type:"button",size:"small",variant:"outlined",color:"error",onClick:t.onDelete,children:"삭제"}),e.jsx(F,{type:"button",size:"small",variant:"outlined",color:"success",onClick:t.onReload,children:"리로드"}),e.jsx(F,{type:"button",size:"small",variant:"outlined",onClick:t.onCsvSave,children:"csv저장"})]}),Ye=({name:t,label:o,control:u,defaultValue:r,placeholder:l,variant:d="filled",margin:x="none",size:h="small",xsSize:v=12,mdSize:C=6,onKeyUp:w})=>e.jsx(b,{item:!0,xs:v,md:C,children:e.jsx(De,{control:u,name:t,defaultValue:r,render:({field:p})=>e.jsx(H,{label:o,placeholder:l,value:p.value,inputRef:p.ref,onChange:y=>{p.onChange(y)},size:h,defaultValue:r,variant:d,margin:x,fullWidth:!0,onKeyUp:w,...p})})});Se();const qe=t=>{const{userId:o,baseUrl:u}=t,r=i.useRef(null),l=i.useRef(null),[d,x]=i.useState(),[h,v]=i.useState(0),{height:C}=be(),p=ve().palette.mode==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",y=te.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),B={edTitle:"",edDate:y};i.useEffect(()=>{T("edDate",{required:!0,minLength:10}),T("filterField1"),m("columns1",t.selectDefault)},[]),i.useEffect(()=>{(async()=>{if(o!==void 0){const a=await Te(u,o);v(a?.length),x(a)}})()},[o]);const j=async()=>{M()},f=async()=>{r.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:t.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},c=[],L={indicators:!0},W=[];t.columns.map((n,a)=>{n.select&&c.push({value:a,text:n.title}),n.hidden===!0&&W.push(a)}),L.columns=W;const M=()=>{try{const n=r.current?.hotInstance,a=n?.getPlugin("filters");if(a){const D=S("columns1");t.columns.forEach((Y,R)=>{a?.removeConditions(R)}),a?.addCondition(Number(D),"contains",[S("filterField1")]),a?.filter(),n?.render();const P=n.getData().length;v(P)}}catch(n){console.error("Error:",n),console.error("Error:",n.message)}},{register:T,handleSubmit:V,trigger:E,reset:s,control:g,setValue:m,getValues:S,formState:{errors:z}}=ne({mode:"submit ",defaultValues:B});async function re(){V(le)()}function le(n,a){const D=`${t.baseUrl}/${o}/`,I=se(oe(A(N),D)).key;setFireData(D+I+"/title",n.edTitle),setFireData(D+I+"/date",n.edDate),setFireData(D+I+"/ing","1"),s({edTitle:"",edDate:y})}const de=async(n,a)=>{if(n!==null){const D=r.current?.hotInstance;if(D?.getPlugin("filters")){const P=D.getData(),Y=[];n.forEach((R,xe)=>{const U={};t.columns.forEach(($,he)=>{U[$.data]=P[R[0]][he]}),Y.push(U)}),Y.forEach(async(R,xe)=>{const U=await Ie(R,u,o);d.map($=>{($.id===void 0||$.id===null)&&($.id=U?.id)})}),D.render()}}},ce=async()=>{const n=r.current.hotInstance;if(n&&l.current!==null){if(n?.getPlugin("filters")){const I=n.getData()[l.current][t.keyId];window.confirm("삭제하시겠습니까?")&&setFireData(`${t.baseUrl}/${o}/${I}`,null)}n.alter("remove_row",l.current,1)}};function ue(n){let a=q(n);a.format("YYYY-MM-DD HH:mm:ss"),m("edDate",a.format("YYYY-MM-DD")),E("edDate")}const me=z?.edTitle?e.jsx(b,{item:!0,xs:12,children:e.jsx("p",{className:"error",children:z.edTitle?.message})}):"";return e.jsxs(ae,{style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},sx:{mt:0},children:[e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(Be,{id:"columns1",label:"조회 컬럼",mdSize:3,control:g,defaultValue:t.selectDefault?t.selectDefault:"1",selectList:c,error:!!z.columns1,onChange:n=>{n.preventDefault();const a=n.target.value;m("columns1",a),a!=""&&M()}}),e.jsx(Ye,{...T("filterField1"),name:"filterField1",control:g,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",size:"small",mdSize:9,fullWidth:!0,onKeyUp:M}),e.jsx(We,{control:g,id:"edDate",label:"일자",mdSize:3,value:q(S("edDate")),...T("edDate"),defaultValue:q(S("edDate")),onChange:ue}),e.jsx(b,{item:!0,xs:12,md:9,children:e.jsx(H,{...T("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목 입력",variant:"filled",size:"small",style:{},error:!!z.edTitle})}),me,e.jsx(b,{item:!0,xs:12,md:3,sx:{paddingTop:["0 !important","0 !important","0.5rem !important"]},children:e.jsx(K,{textAlign:"left",children:"건수 : "+Ce(h)})}),e.jsx(b,{item:!0,xs:12,md:9,sx:{paddingTop:["0 !important","0 !important","0.5rem !important"]},children:e.jsx(Ve,{onInsert:re,onDelete:ce,onReload:j,onCsvSave:f})})]}),e.jsx("div",{style:{maxHeight:`${C}- 200`,overflow:"auto"},children:e.jsx(we,{ref:r,data:d,themeName:p,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:C-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:de,afterSelection:n=>{l.current=n},licenseKey:"non-commercial-and-evaluation",columns:t.columns,cells:(n,a)=>t.columns[a].readOnly===!0?{readOnly:!0}:{},colWidths:t.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:L})})]})},Ae=()=>{const{user:t}=ie();return!t||t?.uid===void 0?e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:e.jsx(K,{children:"로그인을 해야 이용가능합니다."})}):e.jsx(qe,{csvFileName:"exported_todo",baseUrl:"todo",columns:X,colWidths:ke,selectDefault:"1",keyId:X.length-1,userId:t?.uid})},dt=()=>{const{user:t,handleGoogleLogin:o}=ie(),[u,r]=i.useState(0),l=[{label:"그리도",id:"grid"},{label:"리스트",id:"list"}];i.useEffect(()=>{Fe({title:"Todo",description:""})},[]),i.useEffect(()=>{const x=l.findIndex(h=>`#${h.id}`===window.location.hash);r(x!==-1?x:u)},[u]);const d=(x,h)=>{window.location.hash=`#${l[h].id}`,r(h)};return e.jsxs(ae,{maxWidth:"lg",sx:{mt:3},children:[e.jsx(Ue,{tabValue:u,onChange:d,tabs:l}),e.jsxs(i.Suspense,{fallback:e.jsx(Le,{}),children:[e.jsx(J,{value:u,index:0,style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},children:e.jsx(Ae,{userId:t?.uid||!1,handleGoogleLogin:o})}),e.jsx(J,{value:u,index:1,style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},children:e.jsx(He,{userId:t?.uid,handleGoogleLogin:o})})]})]})};export{dt as MUITodo,dt as default};
