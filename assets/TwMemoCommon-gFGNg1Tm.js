const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BU1ApiQo.js","assets/index-C3sqpkL7.js","assets/index-DEzPJqzK.css","assets/createSvgIcon-xoQsl7YK.js","assets/useControlled-EtIHklse.js","assets/ownerWindow-DvT1GKkC.js","assets/isMuiElement-Dz-HirKr.js","assets/fireDatabase-CRD6NGql.js","assets/fireStorage-DegTSQKc.js","assets/SinyDate-D-jN9VrG.js","assets/Grid-Uy0MErG0.js","assets/useTheme-CJnFoXqa.js","assets/index-CkbFAXXl.js","assets/index-Chjiymov.js","assets/Typography-CERP5IpX.js","assets/Menu-D2rYTpm_.js","assets/useSlotProps-BuYjNNgm.js","assets/resolveComponentProps-B41pG4Nb.js","assets/IconButton-YNfs2HWE.js","assets/TextField-BKaP1Bjw.js","assets/InputAdornment-IFj4VgAK.js","assets/Popper-DhROC-bA.js","assets/Button-Cr6ti3M7.js","assets/Chip-DZXSFmJ1.js","assets/index.esm-WCrIy3jc.js","assets/TwButton-DcMOXnQ4.js","assets/Loading-CAmApmBv.js","assets/Container-B6V-30Vh.js","assets/styled-i2JbhvhN.js","assets/CircularProgress-J9NpBq6e.js","assets/Divider-CVkyunXK.js","assets/dividerClasses-C_49Tk6w.js","assets/index-Cmdt2tIm.css"])))=>i.map(i=>d[i]);
import{r as u,u as J,j as e,c as K,T as Ae,q as ke,e as Ye,o as He,a as we,f as be,g as ye,z as ue,A as se,C as qe,I as Oe,H as We,D as Ce,F as Ne,G as Je,y as Ge,J as Ke,R as Ve,K as G}from"./index-C3sqpkL7.js";import{u as ze}from"./useSuspenseQuery-0cMgF-jE.js";import{L as M}from"./Loading-CAmApmBv.js";import{T as Qe}from"./Footer-BwPqkmIc.js";import"./LinkItem-Cds7StNo.js";import{b as Ze,T as X}from"./TwLinkItem-CqbxO7iI.js";import{g as $e,s as F}from"./fireDatabase-CRD6NGql.js";import{D as Se,g as Te,S as De,T as Le}from"./index-BtJIShBV.js";import{E as Xe,C as et,u as ge,a as he,F as tt,b as st,D as Ie,l as ot,I as nt,s as ee,d as te,e as Re}from"./index-BU1ApiQo.js";import{F as Fe}from"./Favorite-eeSa1qYB.js";import{S as at}from"./SinyImageList-Ba0nKz_T.js";import{H as xe}from"./HtmlCode-BTVksBGO.js";import{c as rt}from"./CodeText-WbH5nX7H.js";import{s as fe}from"./commonUtil-dKXUcBko.js";import{T as I}from"./TwButton-DcMOXnQ4.js";import{C as lt}from"./CircularProgress-J9NpBq6e.js";import{D as it}from"./datetime-BDx6lZXm.js";import{u as Pe}from"./index.esm-WCrIy3jc.js";import{T as pe}from"./TwCheckbox-B7GeeklH.js";import{T as Ee}from"./TwTextArea-xElLuCD6.js";import{T as R}from"./TwBadge-Bqv3tZOO.js";import"./SinyDate-D-jN9VrG.js";import{T as O}from"./TwInput-HjAUbYps.js";import{T as Be}from"./TwSelect-D5uj0Xj-.js";import{T as Me}from"./TwDatePicker-BtT1VNct.js";import{d as W,e as Ue,f as ct,h as dt}from"./fireStorage-DegTSQKc.js";import{S as mt,a as ut}from"./right-DOgb4NZX.js";import{f as gt}from"./fireMemoDetail-mR2jGAtf.js";import{S as ht}from"./check-circle-DxK1RZam.js";import{I as xt}from"./IpInfo-KoYFfTxQ.js";import"./useBaseQuery-DQb-tA7n.js";import"./Container-B6V-30Vh.js";import"./styled-i2JbhvhN.js";import"./Divider-CVkyunXK.js";import"./dividerClasses-C_49Tk6w.js";import"./Typography-CERP5IpX.js";import"./Link-DqRVOIkY.js";import"./createSvgIcon-xoQsl7YK.js";import"./useControlled-EtIHklse.js";import"./ownerWindow-DvT1GKkC.js";import"./isMuiElement-Dz-HirKr.js";import"./IconButton-YNfs2HWE.js";import"./index-Chjiymov.js";import"./ImageListItem-D3QH3M_t.js";import"./copy-CBjuFTJA.js";import"./ComponentCard-xEmSTsWu.js";import"./TwRadio-DsjCP6lW.js";import"./toPropertyKey-DCwh5dYN.js";import"./Grid-Uy0MErG0.js";import"./useTheme-CJnFoXqa.js";import"./index-CkbFAXXl.js";import"./Menu-D2rYTpm_.js";import"./useSlotProps-BuYjNNgm.js";import"./resolveComponentProps-B41pG4Nb.js";import"./TextField-BKaP1Bjw.js";import"./InputAdornment-IFj4VgAK.js";import"./Popper-DhROC-bA.js";import"./Button-Cr6ti3M7.js";import"./Chip-DZXSFmJ1.js";function ft({initTreeData:o}){const[t,m]=u.useState(),s=j=>m(j),v=J();if(u.useEffect(()=>{m(o)},[o]),t==null||t.length===0)return e.jsx(M,{});const C=j=>{console.log("node",j),v(`/m/${j.id}`)};return e.jsx(Se,{backend:De,options:Te(),children:e.jsx(Le,{tree:t,rootId:"root",onDrop:s,render:(j,{depth:x,isOpen:l,onToggle:g})=>e.jsxs("div",{className:"w-60 flex items-center justify-between hover:bg-gray-300 dark:hover:bg-gray-700 rounded-sm ",style:{paddingLeft:x*20+(j.cnt===0?5:0)},children:[e.jsxs("div",{className:"flex items-center",children:[j.cnt>0&&e.jsx("div",{onClick:g,children:l?e.jsx(Xe,{}):e.jsx(et,{})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>C(j),children:j.text})]}),j.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",j.cnt,")"]})]})})})}function vt(o){const{user:t}=K(),m=J(),[s,v]=u.useState(),[C,j]=u.useState(),x=async l=>{const g=[],d=ke(we(be,`memo_tree/${l}`),He("bm"),Ye("Y")),b=await ye(d);if(!b.exists()){console.log("getFireData.null");return}const $=b.val();for(let N in $){const f=$[N];f.id=N,f.key=N,f.text=f.title,g.push(f)}g.sort((N,f)=>N.title>f.title?1:-1),v([...g])};return u.useEffect(()=>{t!==void 0&&t!=null&&x(t?.uid)},[t]),u.useEffect(()=>{const l=async(g,d)=>{const b=[...d];if(d)for(const $ of d){let N=$;for(;N.parent!=="root";){N.parent,N=await $e(`memo_tree/${g}/${N.parent}`);const f={id:N.key,text:N.title,droppable:!1,parent:N.parent};b.filter(k=>k.id===f.id).length===0&&b.push(f)}}for(const $ of b){const N=$.id;$.cnt=b.filter(f=>f.parent===N).length}j(b)};s&&s.length>0&&l(t?.uid,s)},[s]),t===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"tail-bookmark justify-items-center flex items-center flex-col w-full",children:[e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(Ae,{children:"BookMark"}),e.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((l,g)=>e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",onClick:()=>{o.onSelected(l.key),m(`/m/${l.key}`)},children:e.jsx("span",{className:"text-base",children:l.title})})},g))}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"}),e.jsx(u.Suspense,{fallback:e.jsx(M,{}),children:e.jsx(ft,{initTreeData:C,uid:t?.uid})})]})}const pt=o=>e.jsxs("div",{className:"flex-grow my-4 w-full grid grid-cols-3 gap-1 items-center content-center justify-center text-center whitespace-nowrap",style:{gridTemplateColumns:`70px 70px 70px ${o.master?"70px":""}`},children:[o.master&&e.jsx(I,{size:"sm",variant:"outlined",color:"success",onClick:o.onUtil,children:"유틸"}),e.jsx(I,{size:"sm",variant:"outlined",color:"success",onClick:o.onEdit,children:"수정"}),e.jsx(I,{size:"sm",variant:"outlined",color:"warning",onClick:o.onNewMemo,children:"새글"}),e.jsx(I,{size:"sm",variant:"outlined",color:"error",onClick:o.onDelete,children:"삭제"})]}),jt=o=>{const{rootDb:t,isLoading:m,memoDetailData:s,onBookmark:v,onTreeUpdate:C,searchWord:j}=o,{scrollYProgress:x}=ge(),l=he(x,{stiffness:100,damping:30,restDelta:.001}),g=J(),{memoId:d}=ue(),$=se()?.state?.fullIndex,{user:N}=K(),f=()=>{const c=`/${t==="memo"?"m":t}/edit/${d}`;g(c,{state:{fullIndex:$}})},i=()=>{const c=`/${t==="memo"?"m":t}/util/${d}`;g(c,{state:{fullIndex:$}})},k=()=>{const c=`/${t==="memo"?"m":t}/insert/${d}`;g(c,{state:{fullIndex:$}})},r=async()=>{const c=t==="memo"?`${t}_txt/${N.uid}/${d}`:`${t}_txt/${d}`,w=t==="memo"?`${t}_tree/${N.uid}/${d}`:`${t}/${d}`;await st(c,w)!==void 0&&(C(),g(`/${t==="memo"?"m":t}`))},p=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&r()};return u.useEffect(()=>{s&&s.title!==void 0&&fe({title:s.title,description:s.title});function c(){window.scrollTo({top:0}),s&&s.html!=="N"&&document.querySelectorAll("pre").forEach(w=>{w.innerHTML=rt(w.innerHTML)})}s&&s.memo!==null&&(c(),s.image&&s.image.map((w,T)=>(console.log("image."+T+"=",w.key),w)))},[s]),m?e.jsx(M,{}):d===""||N===void 0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsx(qe.div,{className:"progress-bar",style:{scaleX:l}}),e.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[e.jsx("div",{}),e.jsx("div",{className:"flex justify-center",children:s&&s.title}),e.jsxs("div",{className:"text-right justify-end mr-3.5",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"bookmark",onClick:v,children:s&&s.bookmark==="Y"?e.jsx(Fe,{className:"text-red-500"}):e.jsx(tt,{className:"text-gray-600 dark:text-gray-400"})}),e.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:s?.path&&s?.path.map((c,w)=>w===0?c?.text:` > ${c?.text}`)})]})]}),e.jsxs("div",{className:"w-full p-0 m-0",children:[e.jsx(pt,{master:N?.uid===Oe,rootDb:t,onEdit:f,onUtil:i,onNewMemo:k,onDelete:p,bookmark:s&&s.bookmark}),e.jsxs("div",{className:"my-4",children:[s&&s.html==="N"?e.jsx(xe,{postData:s&&s.memo,highlightWord:j}):s&&s.html!=="N"&&s.memo&&e.jsx(We,{text:s.memo}),e.jsx(at,{imageList:s&&s.image}),!s&&e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"mt-12",children:e.jsx(lt,{})})})]})]})]})},_e=({onSubmit:o,onCancel:t,isSubmitting:m,newMode:s=!1})=>e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsxs(I,{variant:"outlined",color:"success",disabled:m,onClick:v=>{v.preventDefault(),o(v)},children:[s?"새글":""," 저장"]}),e.jsx(I,{variant:"outlined",color:"error",onClick:v=>{v.preventDefault(),t()},children:"취소"})]}),kt=u.lazy(()=>Je(()=>import("./index-BU1ApiQo.js").then(o=>o.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32])));ot.Quill.register("modules/imageDrop",nt);Ne.configure({languages:["javascript","ruby","python","java","cpp","kotlin","sql"]});const wt={syntax:{highlight:o=>Ne.highlightAuto(o).value},toolbar:[[{header:"1"},{header:"2"},{header:"3"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"],["code-block"]],imageDrop:!0,clipboard:{matchVisual:!1}},bt=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video","clean","code-block","code-custom"],yt=o=>{const[t,m]=u.useState(o.imageList),[s,v]=u.useState(o.htmlCheck==="Y"),[C,j]=u.useState(o.iconCheck==="Y"),[x,l]=u.useState(o.newMode?"":o.content),[g,d]=u.useState(),b=u.useRef(),$=u.useRef(),N=u.useRef(null);u.useRef(null);const f=u.useRef(null),i=o.newMode,k=u.useRef([]),{height:r}=Ce(),p=it.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),c={edTitle:i?"":o.title,edGbn:o.gbn?o.gbn:"etc",edDate:i?p:o.date,content:i?"":o.content,memoTxt:i?"":o.content,htmlCheck:o.htmlCheck,iconCheck:o.iconCheck},{register:w,handleSubmit:T,trigger:P,control:L,setValue:E,getValues:Y,watch:oe,formState:{errors:ve,isSubmitting:ne}}=Pe({mode:"onChange",defaultValues:c});u.useEffect(()=>{w("edDate"),w("edGbn",{required:!0}),w("htmlCheck"),w("iconCheck"),w("memoTxt")},[]),u.useEffect(()=>{k.current=[],b.current=o.content,$.current=!1},[o.content]);const V=async a=>{i?await o.onNewSubmit(a,k.current):await o.onPostSubmit(a,t,k.current)},ae=()=>{T(V)()},re=a=>{console.log("onDelete.imageList=",a),m(a)},le=a=>{console.log("onInsert.file",a);let y=b.current;a.ext==="jpg"||a.ext==="png"?(y+=`<img src='${a.url}'/>`,h(`<img src='${a.url}'/>
`)):a.ext==="mp4"?(y+=`<video preload="auto" controls="" src='${a.url}'></video>`,h(`<video preload="auto" controls="" src='${a.url}'></video>`)):(y+=`<a src='${a.url}'>${a.name}}</a>`,h(`다운로드
<a href="${a.url}" target="_blank">${a.name}</a>
`)),b.current=y},B=a=>o.onRename(a,Y("edTitle")),A=a=>{b.current=a},ie=a=>{console.log("handleFileUpload",a),k.current=a};function ce(a){b.current=a,E("content",a),P("content")}const z=(a,y)=>{console.log(`onChecked.e.${a}=`,y),E(a,y?"Y":"N"),console.log(`onChecked.v.${a}=`,Y(a)),a==="htmlCheck"?v(y):j(y)},de=oe("content"),me=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],n=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],h=a=>{const y=N.current;if(y){const q=y.selectionStart,_=y.selectionEnd,H=x.slice(0,q),Q=x.slice(_);l(H+a+Q),E("memoTxt",H+a+Q),setTimeout(()=>{y.selectionStart=y.selectionEnd=q+a.length,y.focus()},0)}},S=a=>{h(a)},D=a=>a?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(a)||a.includes("image")||a.includes("img"):!1,U=a=>new Promise((y,q)=>{const _=new Image;_.crossOrigin="anonymous",_.onload=()=>{const H=document.createElement("canvas"),Q=H.getContext("2d");H.width=_.width,H.height=_.height,Q.drawImage(_,0,0);try{const Z=H.toDataURL("image/png");console.log("convertImageToBase64.base64=",Z.substring(0,30)+"..."),y(Z)}catch(Z){q(Z)}},_.onerror=()=>{q(new Error("Failed to load image"))},_.src=a});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:T(V),style:{width:"100%",minHeight:"300px",maxHeight:{height:r},display:"flex",flexDirection:"column"},children:[e.jsxs("div",{className:"flex justify-end mb-1.5 gap-1",children:[e.jsx(pe,{id:"htmlCheck",checked:s,onChange:a=>z("htmlCheck",a),label:"HTML사용"}),e.jsx(pe,{id:"iconCheck",checked:C,onChange:a=>z("iconCheck",a),label:"Icon"}),e.jsx(_e,{onSubmit:a=>ae(),onCancel:o.onCancel,isSubmitting:ne,newMode:i})]}),e.jsx(Ie,{control:L,onDelete:re,onInsert:le,onRename:B,setContent:A,onFileUpload:ie,imageList:o.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(O,{name:"edTitle",placeholder:"제목",control:L,rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:a=>{a.preventDefault(),E("edTitle",a.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Be,{name:"edGbn",label:"구분",control:L,rules:{required:!0},placeholder:"-- 구분 --",options:me,className:"",allClassName:"max-w-40",onChange:a=>{a.preventDefault();const y=a.target.value;console.log("edGbn=",Y("edGbn")),E("edGbn",y)}}),e.jsx(Me,{id:"edDate",name:"edDate",placeholder:"Select a date",control:L,onChange:(a,y)=>{console.log({dates:a,currentDateString:y}),E("edDate",y)}})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(xe,{postData:x})}),e.jsxs("div",{children:[e.jsx(Ee,{ref:N,className:"",value:x,onChange:a=>{E("memoTxt",a),l(a)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S(`<box>
</box>`),children:"<Box>"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>S('<hr style="width=100%"/>'),children:"line"}),n.map((a,y)=>e.jsx(R,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>S("<code>"+a+`
</code>`),children:a},y))]})]}),Y("edUrl")&&D(Y("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:g,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async a=>{try{const y=await U(g);E("edUrl2",y)}catch(y){console.error("Base64 conversion failed:",y)}},onError:a=>{a.target.style.display="none"}})})]}),s&&e.jsx(u.Suspense,{fallback:e.jsx("div",{children:"Loading editor..."}),children:e.jsx(kt,{ref:f,fullWidth:!0,theme:"snow",id:"content",name:"content",type:"div",value:de,style:{minWidth:"400px",border:"1px solid primary.main",minHeight:"200px",height:"400px",maxHeight:"450px"},modules:wt,formats:bt,onChange:ce})}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},je=o=>{const{rootDb:t,isLoading:m,memoDetailData:s}=o,{scrollYProgress:v}=ge();he(v,{stiffness:100,damping:30,restDelta:.001});const C=J(),j=u.useRef(),x=u.useRef();x.current=o.searchWord;const{memoId:l}=ue(),g=se(),{user:d}=K();j.current=g.pathname.split("/")[2]==="insert",console.log("memoDetailData=",s);const b=()=>{const r=`/${t==="memo"?"m":t}/${l==="insert"?"":l}`;C(r)},$=async r=>{await W(d.uid,l,r)},N=async r=>{if(console.log("onFilePathList.fileNm=",r),r.length>0)for(let p=0;p<r.length;p++){const c=r[p];console.log("onFilePathList.file=",c);try{const w=await W(d.uid,l,c);console.log("onFilePathList.path=",w)}catch{console.log("onFilePathList.error=",c)}}else await W(d.uid,l,r)},f=async(r,p)=>{console.log("onNewSubmit.values",r);const c=await ee({rootDb:t,uid:d.uid,newData:j.current,key:l==="insert"?"root":l,values:r});if(await te(`${t}_txt`,t,c,p),c!==void 0){const w=`/${t==="memo"?"m":t}/${c}`;C(w,{state:{reflash:!0}})}},i=async(r,p)=>{const c=t==="memo"?`${t}/${d.uid}/`:`${t}/`,w=await Ue(c,r.key,p,r.ext);if(w.success){const T=t==="memo"?`${t}_txt/${d.uid}/${l}/image/`:`${t}_txt/${l}/image/`;return F(T+r.key,null),r.key=w.key,r.url=w.url,r.name=w.key+"."+r.ext,F(T+w.key,r),console.log("onRename.file",r),r}},k=async(r,p,c)=>{const w=t==="memo"?`${t}_txt/${d.uid}/`:`${t}_txt/`;t==="memo"?`${t}${d.uid}`:`${t}`,await Re(w,t==="memo"?`${t}/${d.uid}/`:`${t}/`,l,p),console.log("onPostSubmit.values",r);const T=await ee({rootDb:t,uid:d.uid,newData:j.current,key:l==="insert"?"root":l,values:r});console.log("onPostSubmit.newKey=",T),console.log("onPostSubmit.files=",c);const P=await te(`${w}`,t==="memo"?`${t}/${d.uid}/`:`${t}/`,l,c);console.log("onNewSubmit.imageResult",P),t==="memo"&&F(`memo_tree/${d.uid}/${l}/title`,r.edTitle),j.current=!1;const L=`/${t==="memo"?"m":t}/${l}`;t==="home"&&F("home/tree",null),C(L,{state:{reflash:!0}})};return u.useEffect(()=>{s&&s.title!==void 0&&fe({title:s.title,description:s.title});function r(){document.querySelectorAll("pre").forEach((p,c)=>{})}s&&s.memo!==null&&r()},[s]),l===""||d===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",m),s===void 0||m?e.jsx(M,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:j.current===!1&&s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(M,{}):e.jsx(yt,{newMode:j.current,onPostSubmit:k,onNewSubmit:f,onCancel:b,onRename:i,onFilePath:$,onFilePathList:N,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})}))},Ct=o=>{const[t,m]=u.useState(o.imageList),[s,v]=u.useState(o.content),[C,j]=u.useState(),x=u.useRef(),l=u.useRef(),g=u.useRef(null),d=u.useRef([]),{height:b}=Ce(),$={edTitle:o.title,edGbn:o.gbn?o.gbn:"etc",edDate:o.date,content:o.content,memoTxt:o.content,htmlCheck:"N",iconCheck:"N"},{register:N,handleSubmit:f,trigger:i,control:k,setValue:r,getValues:p,watch:c,formState:{errors:w,isSubmitting:T}}=Pe({mode:"onChange",defaultValues:$});u.useEffect(()=>{N("edDate"),N("memoTxt")},[]),u.useEffect(()=>{d.current=[],x.current=o.content,l.current=!1},[o.content]);const P=async n=>{await o.onPostSubmit(n,t,d.current)},L=()=>{f(P)()},E=n=>{console.log("onDelete.imageList=",n),m(n)},Y=n=>{console.log("onInsert.file",n);let h=x.current;n.ext==="jpg"||n.ext==="png"?(h+=`<img src='${n.url}'/>`,B(`<img src='${n.url}'/>
`)):n.ext==="pdf"?(h+=`<PDF>${n.url}</PDF>`,B(`<PDF>${n.url}</PDF>`)):n.ext==="mp4"?(h+=`<video preload="auto" controls="" src='${n.url}'></video>`,B(`<video preload="auto" controls="" src='${n.url}'></video>`)):(h+=`<a src='${n.url}'>${n.name}}</a>`,B(`다운로드
<a href="${n.url}" target="_blank">${n.name}</a>
`)),x.current=h},oe=n=>o.onRename(n,p("edTitle")),ve=n=>{x.current=n},ne=n=>{console.log("handleFileUpload",n),d.current=n};function V(n){B(`<img src='${n}'/>`)}function ae(){console.log("HtmlEditor.imageList=",t);let n="";t&&t.length>0&&t.map((h,S)=>{n+=`<img src="/data/memo/${h.key}.${h.ext}" style="width: 50px;"/>
`}),n!==""&&B(n)}const re=[{value:"none",label:"None"},{value:"react",label:"React"},{value:"css",label:"CSS"},{value:"android",label:"Android"},{value:"java",label:"JAVA"},{value:"image",label:"그림 / 사진"},{value:"etc",label:"기타"},{value:"mui",label:"MUI"}],le=["React","JavaScript","Bash","Html","CSS","SQL","Java","Kotlin","C++","C#","Command","Script","Python","Ruby","Go","Swift","Rust"],B=n=>{const h=g.current;if(h){const S=h.selectionStart,D=h.selectionEnd,U=s.slice(0,S),a=s.slice(D);v(U+n+a),r("memoTxt",U+n+a),setTimeout(()=>{h.selectionStart=h.selectionEnd=S+n.length,h.focus()},100)}},A=n=>{B(n)},ie=n=>n?/\.(jpg|jpeg|png|gif|bmp|webp|svg)/i.test(n)||n.includes("image")||n.includes("img"):!1,ce=async()=>{const n=await ct("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile.result=",n)},z=async()=>{const n=await dt("memo/I3cTgdCxwjhBBno4mtZYvnODPJu1");console.log("onAllFile10.result=",n);let h="";n.map(S=>{h+=S+`
`}),B(h)},de=async()=>{const n=p("edFilePath");if(n===""){const h=[];let S=g.current.value;S=S.replace(/<img src="\/data\/memo\//g,""),S=S.replace(/ style="width: 50px;"/g,""),S=S.replace(/"\/>/g,""),S=S.replace(/ /g,""),S.split(`
`).forEach(async D=>{D.indexOf(".")>0&&(h.push(D),console.log(D))}),h.length>0&&(console.log(h),await o.onFilePathList(h))}else await o.onFilePath(n)},me=n=>new Promise((h,S)=>{const D=new Image;D.crossOrigin="anonymous",D.onload=()=>{const U=document.createElement("canvas"),a=U.getContext("2d");U.width=D.width,U.height=D.height,a.drawImage(D,0,0);try{const y=U.toDataURL("image/png");console.log("convertImageToBase64.base64=",y.substring(0,30)+"..."),h(y)}catch(y){S(y)}},D.onerror=()=>{S(new Error("Failed to load image"))},D.src=n});return e.jsx("div",{className:"my-2 mb-[50px], w-full",children:e.jsxs("form",{onSubmit:f(P),style:{width:"100%",minHeight:"300px",maxHeight:{height:b},display:"flex",flexDirection:"column"},children:[e.jsx(_e,{onSubmit:n=>L(),onCancel:o.onCancel,isSubmitting:T}),e.jsx(Ie,{control:k,onDelete:E,onInsert:Y,onRename:oe,setContent:ve,onFileUpload:ne,imageList:o.imageList}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(O,{name:"edTitle",placeholder:"제목",control:k,className:"w-full",rules:{required:"해당 필드는 필수입니다.",minLength:{value:2,message:"2글자 이상 입력해주세요."}},onChange:n=>{n.preventDefault(),r("edTitle",n.target.value)}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Be,{name:"edGbn",label:"구분",control:k,rules:{required:!0},placeholder:"-- 구분 --",options:re,className:"",allClassName:"max-w-40",onChange:n=>{n.preventDefault();const h=n.target.value;console.log("edGbn=",p("edGbn")),r("edGbn",h)}}),e.jsx(Me,{id:"edDate",name:"edDate",placeholder:"Select a date",control:k,onChange:(n,h)=>{console.log({dates:n,currentDateString:h}),r("edDate",h)}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{name:"edUrl",placeholder:"Base64로 만들 URL",control:k,className:"w-full",allClassName:"w-full",onChange:n=>{n.preventDefault();const h=n.target.value;console.log("edUrl=",h),r("edUrl",h),j(h)}}),e.jsx(I,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),V(p("edUrl2"))},children:"적용"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{name:"edUrl2",placeholder:"Base64 이미지 데이터",className:"w-full",allClassName:"w-full",variant:"filled",size:"small",value:p("edUrl2")||""}),e.jsx(I,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),ae()},children:"첨부추가"})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(O,{name:"edFilePath",placeholder:"이미지리스트에 추가할 파일명",className:"w-full",allClassName:"w-full",control:k,onChange:n=>{n.preventDefault();const h=n.target.value;r("edFilePath",h)}}),e.jsx(I,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),de()},children:"파일경로"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),ce()},children:"전체파일"}),e.jsx(I,{variant:"outlined",color:"success",onClick:n=>{n.preventDefault(),z()},children:"전체파일10"})]})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"}),e.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("div",{className:"max-h-100 overflow-y-scroll",children:e.jsx(xe,{postData:s})})}),e.jsxs("div",{children:[e.jsx(Ee,{ref:g,className:"",value:s,onChange:n=>{r("memoTxt",n),v(n)},rows:20}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 xsm:grid-cols-5 sm:grid-cols-7 md:grid-cols-7 lg:grid-cols-8",children:[e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A(`<box>
</box>`),children:"<Box>"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<a href="/data/memo/" target="_blank"></a>'),children:"Link"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<img src="/data/memo/"></img>'),children:"img"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<video preload="auto" controls="" src="/memo/" style="width: 100%; height: 100%;"></video>'),children:"Video"}),e.jsx(R,{className:"cursor-pointer",variant:"light",color:"success",onClick:()=>A('<hr style="width=100%"/>'),children:"line"}),le.map((n,h)=>e.jsx(R,{className:"cursor-pointer",variant:"light",color:"dark",onClick:()=>A("<code>"+n+`
</code>`),children:n},h))]})]}),p("edUrl")&&ie(p("edUrl"))&&e.jsx("div",{className:"mt-2 p-2 border border-gray-300 dark:border-gray-600 rounded",children:e.jsx("img",{src:C,alt:"Preview",className:"max-w-full h-auto max-h-48 object-contain",onLoad:async n=>{try{const h=await me(C);r("edUrl2",h)}catch(h){console.error("Base64 conversion failed:",h)}},onError:n=>{n.target.style.display="none"}})})]}),e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 my-4"})]})})},Nt=o=>{const{rootDb:t,isLoading:m,memoDetailData:s}=o,{scrollYProgress:v}=ge();he(v,{stiffness:100,damping:30,restDelta:.001});const C=J(),j=u.useRef();j.current=o.searchWord;const{memoId:x}=ue();se();const{user:l}=K();console.log("memoDetailData=",s);const g=()=>{const i=`/${t==="memo"?"m":t}/${x==="insert"?"":x}`;C(i)},d=async i=>{await W(l.uid,x,i)},b=async i=>{if(console.log("onFilePathList.fileNm=",i),i.length>0)for(let k=0;k<i.length;k++){const r=i[k];console.log("onFilePathList.file=",r);try{const p=await W(l.uid,x,r);console.log("onFilePathList.path=",p)}catch{console.log("onFilePathList.error=",r)}}else await W(l.uid,x,i)},$=async(i,k)=>{console.log("onNewSubmit.values",i);const r=await ee({rootDb:t,uid:l.uid,newData:!1,key:x,values:i});if(await te(`${t}_txt`,t,r,k),r!==void 0){const p=`/${t==="memo"?"m":t}/${r}`;C(p,{state:{reflash:!0}})}},N=async(i,k)=>{const r=t==="memo"?`${t}/${l.uid}/`:`${t}/`,p=await Ue(r,i.key,k,i.ext);if(p.success){const c=t==="memo"?`${t}_txt/${l.uid}/${x}/image/`:`${t}_txt/${x}/image/`;return F(c+i.key,null),i.key=p.key,i.url=p.url,i.name=p.key+"."+i.ext,F(c+p.key,i),console.log("onRename.file",i),i}},f=async(i,k,r)=>{const p=t==="memo"?`${t}_txt/${l.uid}/`:`${t}_txt/`;t==="memo"?`${t}${l.uid}`:`${t}`,await Re(p,t==="memo"?`${t}/${l.uid}/`:`${t}/`,x,k),console.log("onPostSubmit.values",i);const c=await ee({rootDb:t,uid:l.uid,newData:!1,key:x==="insert"?"root":x,values:i});console.log("onPostSubmit.newKey=",c),console.log("onPostSubmit.files=",r);const w=await te(`${p}`,t==="memo"?`${t}/${l.uid}/`:`${t}/`,x,r);console.log("onNewSubmit.imageResult",w),t==="memo"&&F(`memo_tree/${l.uid}/${x}/title`,i.edTitle);const T=`/${t==="memo"?"m":t}/${x}`;t==="home"&&F("home/tree",null),C(T,{state:{reflash:!0}})};return u.useEffect(()=>{s&&s.title!==void 0&&fe({title:s.title,description:s.title});function i(){document.querySelectorAll("pre").forEach((k,r)=>{})}s&&s.memo!==null&&i()},[s]),x===""||l===void 0?e.jsx(e.Fragment,{}):(console.log("isLoading=",m),s===void 0||m?e.jsx(M,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full p-0 m-0",children:s&&(s.title===void 0||s.title===""||s.title===null)?e.jsx(M,{}):e.jsx(Ct,{onPostSubmit:f,onNewSubmit:$,onCancel:g,onRename:N,onFilePath:d,onFilePathList:b,title:s?.title,gbn:s?.gbn,date:s?.date,htmlCheck:s?.html?s?.html==="Y"?"Y":"N":"Y",iconCheck:!s?.icon==="Y"?"Y":"N",content:s?.memo,imageList:s?.image})})}))};function $t({initTreeData:o,userId:t,memoId:m,onClick:s}){const[v,C]=u.useState(o),{isMoble:j,height:x,width:l}=Ge(),g=u.useRef(),d=u.useRef(),b=(f,i)=>{if(i.dragSource.id!==void 0&&i.dropTargetId!==void 0){const k=`memo_tree/${t}/${i.dragSource.id}/parent`;F(k,i.dropTargetId)}C(f)};u.useEffect(()=>{(()=>{for(const i of o){const k=i.id;i.cnt=o.filter(r=>r.parent===k).length}C(o)})()},[o]);const $=(f,i)=>{const k=[],r=p=>{const c=i.find(w=>w.id===p);if(!c)return!1;if(c.parent&&c.parent!=="root"){if(r(c.parent))return k.push(c.parent),!0}else return!0;return!1};return r(f)?k.reverse():[]},N=f=>{if(!v||!f||!d.current)return;const i=$(f,v);i.length>0&&setTimeout(()=>{d.current.open(i)},500)};return u.useEffect(()=>{g.current===void 0&&m!==void 0&&(g.current=m,N(m))},[v]),v==null||v===""?e.jsx(M,{}):e.jsx(Se,{backend:De,options:Te(),children:e.jsx("div",{className:"overflow-y-auto",style:{height:x-235-(j?56:0)+(l>1024?60:0),width:"100%"},children:e.jsx(Le,{ref:d,tree:v,rootId:"root",onDrop:b,sort:!0,render:(f,{depth:i,isOpen:k,onToggle:r,isDragging:p,isDropTarget:c})=>e.jsxs("div",{className:`w-62 flex items-center rounded-sm
              text-gray-500 dark:text-gray-400 cursor-pointer select-none min-h-8 py-1 ml-1 ${p?"opacity-50":""} ${c?"bg-blue-200 dark:bg-blue-800":"hover:bg-gray-300 dark:hover:bg-gray-700"} 
              ${g.current===f.id?"bg-gray-200 dark:bg-gray-800 rounded-r-lg border-l-4 border-blue-500":""}
              `,style:{paddingLeft:i*20+(f.cnt===0?5:0)-(g.current===f.id?4:0)},children:[e.jsx("div",{className:"min-w-0",children:f.cnt>0&&e.jsx("div",{className:"hover:bg-white dark:hover:bg-gray-950 rounded-full",onClick:r,children:k?e.jsx(mt,{className:"size-6"}):e.jsx(ut,{className:"size-6"})})}),e.jsxs("div",{className:"flex items-center flex-1 min-w-0 justify-between",onClick:()=>{g.current=f.id,s(f)},children:[e.jsxs("div",{className:"flex truncate pr-2",children:[f.icon,f.text]}),f.cnt>0&&e.jsxs("div",{className:"text-gray-500 text-sm",children:["(",f.cnt,")"]})]})]})})})})}const St=o=>{const t=u.useRef(null);function m(){o.onSearchDataBtn(t.current.value)}function s(){return o.onNewMemoBtn(),!1}function v(C){C.which===13&&m()}return e.jsxs(e.Fragment,{children:[e.jsx(O,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:t,className:"w-full ",allClassName:"px-3 py-2",placeholder:"Enter Search...",fullWidth:!0,onKeyDownCapture:v}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(I,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:s,children:"새글"}),e.jsx(I,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:m,children:"조회"})]})]})};async function Tt(o,t,m=""){if(t==null||t==="")return"";if(o==="home"){const g=await $e("home/tree");if(g!=null)try{return JSON.parse(g)}catch(d){console.error("Error parsing JSON data:",d)}}const s=o==="home"?"home_txt":m===""?`${o}_tree/${t}`:`${o}_txt/${t}`,v=ke(we(be,s)),C=await ye(v);if(!C.exists())return console.log("getTreeData.null"),null;if(!C.exists())return console.log("getTreeData.exists"),null;const j=C.val(),x=[{text:"1.React",id:"react",key:"react",parent:"root"},{text:"2.CSS",id:"css",key:"css",parent:"root"},{text:"3.Android",id:"android",key:"android",parent:"root"},{text:"4.Java",id:"java",key:"java",parent:"root"},{text:"5.이미지",id:"image",key:"image",parent:"root"},{text:"6.Etc",id:"etc",key:"etc",parent:"root"}],l=[];o==="home"&&l.push(...x);for(const g in j){const d=j[g];d.id=g;const b={id:g,key:g,text:d.title,parent:o==="home"?d.gbn:d.parent};o==="memo"?(b.icon=d.bm==="Y"?e.jsx(Fe,{className:"text-red-500"}):d.icon==="Y"?e.jsx(ht,{}):null,b.droppable=!0):b.droppable=!1,!((m===""||m===void 0||m===null)&&(b.parent===void 0||b.parent===null||b.parent===""))&&(o==="home"||m===""||m===void 0||m===null?l.push(b):(d.id=g,(d.memo+"").toLowerCase().indexOf(m.toLowerCase())>-1&&(b.parent="root",b.droppable=!1,l.push(b))))}return l.sort((g,d)=>g.title>d.title?1:-1),o==="home"&&F("home/tree",JSON.stringify(l)),l}const Dt=o=>{function t(){return o.onNewMemoBtn(),!1}return e.jsxs("div",{className:"justify-items-center",children:[e.jsx("h3",{children:o.title}),e.jsx("div",{children:"사이드 메뉴에서"}),e.jsx(I,{variant:"outlined",color:"success",onClick:t,children:"새글"}),e.jsx("div",{children:"버튼을 사용해 메모를 작성합니다."}),e.jsx(xt,{})]})},Bs=({rootDb:o})=>{const t=J(),{user:m}=K(),s=u.useRef(),v=u.useRef(!0),C=u.useRef(),j=u.useRef(),[x,l]=u.useState(),g=u.useRef(!1),d=se(),b=u.useRef(!1);b.current=d?.state?.reflash===!0;const $=ze({queryKey:["twTreeData",m?.uid,s.current],queryFn:()=>Tt(o,m?.uid,s.current)});$.data!==void 0&&$.data!==""&&!g.current&&(g.current=!0);const N=()=>{const c=x;c&&(c.bookmark=c.bookmark==="Y"?"N":"Y");const w=`memo_tree/${m.uid}/${j.current}/bm`;F(w,x.bookmark),l({...x,bookmark:c.bookmark})};u.useEffect(()=>{m!==void 0&&m!=null&&$.refetch()},[m]),u.useEffect(()=>{const c=async P=>{if(P!==""&&m){const L=await gt(o,m?.uid,P,s.current);o==="memo"&&(L.path=Lt($.data,P)),L.code==="404"&&(L.title="No title"),v.current=!1,l(L===void 0?{}:L)}},w=d.pathname.split("/"),T=w.length>2?w[w.length-1]:"";v.current=!0,c(T),j.current=T},[d.pathname,m,b.current]),u.useEffect(()=>{m!==void 0&&m!=null&&$.refetch()},[b.current]);const f=c=>{g.current=!1,c!==void 0&&(s.current=c),$.refetch()},i=c=>{c.id!==j.current&&(v.current=!0,t(`/${o==="memo"?"m":o}/${c.id}`))},k=()=>{if(m==null){alert("로그인 후 이용 가능합니다.");return}const c=`/${o==="memo"?"m":o}/insert/insert`;t(c)},r=c=>{},p=e.jsxs("div",{className:"w-[270px]",children:[e.jsx("div",{className:"mt-3 flex items-center justify-center",children:e.jsx(Ze,{to:"/m",children:o==="memo"?"메모장":"홈페이지관리"})}),e.jsxs("div",{className:"flex gap-7 justify-center",children:[o==="memo"?"":e.jsx(X,{to:"/m",children:"메모"}),o==="memo"&&m?.uid==="I3cTgdCxwjhBBno4mtZYvnODPJu1"?e.jsx(X,{to:"/home",children:"홈관리"}):null,e.jsx(X,{to:"/todo",children:"TODO"}),e.jsx(X,{to:"/tw",children:"Sheet"})]}),e.jsx(St,{onNewMemoBtn:k,onSearchDataBtn:f}),g.current&&$.isFetched?e.jsx($t,{expandIndex:C.current,initTreeData:$.data,userId:m?.uid,memoId:j.current,onClick:i}):m===void 0?e.jsx(e.Fragment,{}):e.jsx(M,{})]});return e.jsxs(Ke,{sideType:"memo",title:o==="memo"?"메모장":"홈페이지관리",sideContents:p,children:[e.jsx(u.Suspense,{fallback:e.jsx(M,{}),children:e.jsxs(Ve,{children:[e.jsx(G,{path:"/edit/:memoId",element:e.jsx(je,{rootDb:o,isLoading:v.current,searchWord:s.current,memoDetailData:x})}),e.jsx(G,{path:"/insert/:memoId",element:e.jsx(je,{rootDb:o,isLoading:v.current,searchWord:s.current,memoDetailData:x})}),e.jsx(G,{path:"/util/:memoId",element:e.jsx(Nt,{rootDb:o,isLoading:v.current,searchWord:s.current,memoDetailData:x})}),e.jsx(G,{path:"/:memoId",element:e.jsx(jt,{rootDb:o,isLoading:v.current,searchWord:s.current,memoDetailData:x,onTreeUpdate:f,onBookmark:N,data:$.data})}),e.jsx(G,{path:"*",element:e.jsx(Dt,{searchWord:s.current,data:$.data,onNewMemoBtn:k,title:o==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),o==="memo"?e.jsx(vt,{onSelected:r}):"",e.jsx(Qe,{})]})},Lt=(o,t)=>{let m=[],s=t;if(!o)return m;const v=o.find(C=>C.id===s);for(m.unshift(v),s=v?.parent;s!=null&&s!==""&&s!=="root";){const C=o.find(j=>j.id===s);s=C?.parent,m.unshift(C)}return m};export{Bs as default};
