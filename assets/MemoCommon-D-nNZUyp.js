const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MemoMain-CPBVtV3r.js","assets/index-ByQy2Q5j.js","assets/index-BWqt79us.css","assets/TailButton-DkBYmgbr.js"])))=>i.map(i=>d[i]);
import{f as L,g as xe,h as ze,p as _e,v as Ae,i as qe,k as Ye,l as Ve,n as pe,o as Ke,s as Ge,q as ve,t as ye,r as f,w as Ue,x as H,M as we,y as te,z as Xe,D as Je,E as Qe,F as Ze,G as et,j as i,B as S,I as tt,J as Y,K as je,N as be,O as nt,P as ne,Q as ke,R as st,U as ot,V as it,a as K,b as G,W as Se,T as Ie,X as lt,Y as at,Z as rt,A as C,c as $e,_ as Z,d as Te,$ as ct,a0 as se,a1 as ut,C as Me,H as dt,S as ft,a2 as mt,a3 as Ee,e as Le,a4 as gt,a5 as ht,a6 as xt,a7 as Ce,L as J,a8 as pt,a9 as oe,aa as ie,ab as vt,ac as yt,ad as V,ae as wt,af as jt,ag as bt,ah as kt,ai as St,aj as It,ak as P,m as $t,al as Tt,am as Mt,an as z,ao as Et,ap as Lt,aq as Ct}from"./index-ByQy2Q5j.js";import{T as Dt,C as Bt,E as Rt,a as Nt,t as _}from"./TreeView-BApZ4GjX.js";import{T as le}from"./TailButton-DkBYmgbr.js";import{T as Ot}from"./TailLayout-COdE6szZ.js";import{F as Ht}from"./Favorite-CAS14pqh.js";function De(e,t){let n;const s=()=>{const{currentTime:o}=t,r=(o===null?0:o.value)/100;n!==r&&e(r),n=r};return L.update(s,!0),()=>xe(s)}const A=new WeakMap;let $;function Wt(e,t){if(t){const{inlineSize:n,blockSize:s}=t[0];return{width:n,height:s}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function Ft({target:e,contentRect:t,borderBoxSize:n}){var s;(s=A.get(e))===null||s===void 0||s.forEach(o=>{o({target:e,contentSize:t,get size(){return Wt(e,n)}})})}function Pt(e){e.forEach(Ft)}function zt(){typeof ResizeObserver>"u"||($=new ResizeObserver(Pt))}function _t(e,t){$||zt();const n=ze(e);return n.forEach(s=>{let o=A.get(s);o||(o=new Set,A.set(s,o)),o.add(t),$?.observe(s)}),()=>{n.forEach(s=>{const o=A.get(s);o?.delete(t),o?.size||$?.unobserve(s)})}}const q=new Set;let W;function At(){W=()=>{const e={width:window.innerWidth,height:window.innerHeight},t={target:window,size:e,contentSize:e};q.forEach(n=>n(t))},window.addEventListener("resize",W)}function qt(e){return q.add(e),W||At(),()=>{q.delete(e),!q.size&&W&&(W=void 0)}}function Yt(e,t){return typeof e=="function"?qt(e):_t(e,t)}const Vt=50,ae=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Kt=()=>({time:0,x:ae(),y:ae()}),Gt={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function re(e,t,n,s){const o=n[t],{length:l,position:r}=Gt[t],c=o.current,d=n.time;o.current=e[`scroll${r}`],o.scrollLength=e[`scroll${l}`]-e[`client${l}`],o.offset.length=0,o.offset[0]=0,o.offset[1]=o.scrollLength,o.progress=_e(0,o.scrollLength,o.current);const a=s-d;o.velocity=a>Vt?0:Ae(o.current-c,a)}function Ut(e,t,n){re(e,"x",t,n),re(e,"y",t,n),t.time=n}function Xt(e,t){const n={x:0,y:0};let s=e;for(;s&&s!==t;)if(s instanceof HTMLElement)n.x+=s.offsetLeft,n.y+=s.offsetTop,s=s.offsetParent;else if(s.tagName==="svg"){const o=s.getBoundingClientRect();s=s.parentElement;const l=s.getBoundingClientRect();n.x+=o.left-l.left,n.y+=o.top-l.top}else if(s instanceof SVGGraphicsElement){const{x:o,y:l}=s.getBBox();n.x+=o,n.y+=l;let r=null,c=s.parentNode;for(;!r;)c.tagName==="svg"&&(r=c),c=s.parentNode;s=r}else break;return n}const Q={start:0,center:.5,end:1};function ce(e,t,n=0){let s=0;if(e in Q&&(e=Q[e]),typeof e=="string"){const o=parseFloat(e);e.endsWith("px")?s=o:e.endsWith("%")?e=o/100:e.endsWith("vw")?s=o/100*document.documentElement.clientWidth:e.endsWith("vh")?s=o/100*document.documentElement.clientHeight:e=o}return typeof e=="number"&&(s=t*e),n+s}const Jt=[0,0];function Qt(e,t,n,s){let o=Array.isArray(e)?e:Jt,l=0,r=0;return typeof e=="number"?o=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?o=e.split(" "):o=[e,Q[e]?e:"0"]),l=ce(o[0],n,s),r=ce(o[1],t),l-r}const Zt={All:[[0,0],[1,1]]},en={x:0,y:0};function tn(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function nn(e,t,n){const{offset:s=Zt.All}=n,{target:o=e,axis:l="y"}=n,r=l==="y"?"height":"width",c=o!==e?Xt(o,e):en,d=o===e?{width:e.scrollWidth,height:e.scrollHeight}:tn(o),a={width:e.clientWidth,height:e.clientHeight};t[l].offset.length=0;let u=!t[l].interpolate;const h=s.length;for(let m=0;m<h;m++){const y=Qt(s[m],a[r],d[r],c[l]);!u&&y!==t[l].interpolatorOffsets[m]&&(u=!0),t[l].offset[m]=y}u&&(t[l].interpolate=qe(t[l].offset,Ye(s),{clamp:!1}),t[l].interpolatorOffsets=[...t[l].offset]),t[l].progress=Ve(0,1,t[l].interpolate(t[l].current))}function sn(e,t=e,n){if(n.x.targetOffset=0,n.y.targetOffset=0,t!==e){let s=t;for(;s&&s!==e;)n.x.targetOffset+=s.offsetLeft,n.y.targetOffset+=s.offsetTop,s=s.offsetParent}n.x.targetLength=t===e?t.scrollWidth:t.clientWidth,n.y.targetLength=t===e?t.scrollHeight:t.clientHeight,n.x.containerLength=e.clientWidth,n.y.containerLength=e.clientHeight}function on(e,t,n,s={}){return{measure:()=>sn(e,s.target,n),update:o=>{Ut(e,n,o),(s.offset||s.target)&&nn(e,n,s)},notify:()=>t(n)}}const N=new WeakMap,ue=new WeakMap,U=new WeakMap,de=e=>e===document.documentElement?window:e;function ee(e,{container:t=document.documentElement,...n}={}){let s=U.get(t);s||(s=new Set,U.set(t,s));const o=Kt(),l=on(t,e,o,n);if(s.add(l),!N.has(t)){const c=()=>{for(const m of s)m.measure()},d=()=>{for(const m of s)m.update(pe.timestamp)},a=()=>{for(const m of s)m.notify()},u=()=>{L.read(c,!1,!0),L.read(d,!1,!0),L.update(a,!1,!0)};N.set(t,u);const h=de(t);window.addEventListener("resize",u,{passive:!0}),t!==document.documentElement&&ue.set(t,Yt(t,u)),h.addEventListener("scroll",u,{passive:!0})}const r=N.get(t);return L.read(r,!1,!0),()=>{var c;xe(r);const d=U.get(t);if(!d||(d.delete(l),d.size))return;const a=N.get(t);N.delete(t),a&&(de(t).removeEventListener("scroll",a),(c=ue.get(t))===null||c===void 0||c(),window.removeEventListener("resize",a))}}function ln({source:e,container:t,axis:n="y"}){e&&(t=e);const s={value:0},o=ee(l=>{s.value=l[n].progress*100},{container:t,axis:n});return{currentTime:s,cancel:o}}const X=new Map;function Be({source:e,container:t=document.documentElement,axis:n="y"}={}){e&&(t=e),X.has(t)||X.set(t,{});const s=X.get(t);return s[n]||(s[n]=Ge()?new ScrollTimeline({source:t,axis:n}):ln({source:t,axis:n})),s[n]}function an(e){return e.length===2}function Re(e){return e&&(e.target||e.offset)}function rn(e,t){return an(e)||Re(t)?ee(n=>{e(n[t.axis].progress,n)},t):De(e,Be(t))}function cn(e,t){if(e.flatten(),Re(t))return e.pause(),ee(n=>{e.time=e.duration*n[t.axis].progress},t);{const n=Be(t);return e.attachTimeline?e.attachTimeline(n,s=>(s.pause(),De(o=>{s.time=s.duration*o},n))):Ke}}function un(e,{axis:t="y",...n}={}){const s={axis:t,...n};return typeof e=="function"?rn(e,s):cn(e,s)}function fe(e,t){Ue(!!(!t||t.current))}const dn=()=>({scrollX:H(0),scrollY:H(0),scrollXProgress:H(0),scrollYProgress:H(0)});function Ne({container:e,target:t,layoutEffect:n=!0,...s}={}){const o=ve(dn);return(n?ye:f.useEffect)(()=>(fe("target",t),fe("container",e),un((r,{x:c,y:d})=>{o.scrollX.set(c.current),o.scrollXProgress.set(c.progress),o.scrollY.set(d.current),o.scrollYProgress.set(d.progress)},{...s,container:e?.current||void 0,target:t?.current||void 0})),[e,t,JSON.stringify(s.offset)]),o}function fn(e){const t=ve(()=>H(e)),{isStatic:n}=f.useContext(we);if(n){const[,s]=f.useState(e);f.useEffect(()=>t.on("change",s),[])}return t}function me(e){return typeof e=="number"?e:parseFloat(e)}function Oe(e,t={}){const{isStatic:n}=f.useContext(we),s=f.useRef(null),o=fn(te(e)?me(e.get()):e),l=f.useRef(o.get()),r=f.useRef(()=>{}),c=()=>{const a=s.current;a&&a.time===0&&a.sample(pe.delta),d(),s.current=Xe({keyframes:[o.get(),l.current],velocity:o.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...t,onUpdate:r.current})},d=()=>{s.current&&s.current.stop()};return f.useInsertionEffect(()=>o.attach((a,u)=>n?u(a):(l.current=a,r.current=u,L.update(c),o.get()),d),[JSON.stringify(t)]),ye(()=>{if(te(e))return e.on("change",a=>o.set(me(a)))},[o]),o}var O={},ge;function mn(){if(ge)return O;ge=1;var e=Je();Object.defineProperty(O,"__esModule",{value:!0}),O.default=void 0;var t=e(Qe()),n=Ze();return O.default=(0,t.default)((0,n.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder"),O}var gn=mn();const hn=et(gn),xn=tt(Nt)(({theme:e})=>({color:e.palette.text.secondary,[`& .${_.content}`]:{color:e.palette.text.secondary,borderTopRightRadius:e.spacing(2),borderBottomRightRadius:e.spacing(2),paddingRight:e.spacing(1),fontWeight:e.typography.fontWeightMedium,"&.MuiTreeItem-content":{paddingLeft:"3px",paddingRight:"3px"},".MuiTreeItem-label":{paddingLeft:"0px"},".MuiTreeItem-iconContainer":{marginRight:"0px"},"&.Mui-expanded":{fontWeight:e.typography.fontWeightRegular},"&:hover":{backgroundColor:e.palette.action.hover},"&.Mui-selected":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},[`& .${_.label}`]:{fontWeight:"inherit",color:"inherit"}},[`& .${_.group}`]:{marginLeft:0,[`& .${_.content}`]:{paddingLeft:e.spacing(1)}}})),pn=f.forwardRef(function(t,n){const{labelIcon:s,labelInfo:o,labelText:l,pl:r,...c}=t;return i.jsx(xn,{label:i.jsxs(S,{sx:{display:"flex",alignItems:"center",p:.5,pr:2,pl:{pl:r}},children:[i.jsx(S,{component:s,color:"inherit",sx:{mr:1,pl:{pl:r}}}),i.jsx(Y,{sx:{fontWeight:"inherit",flexGrow:1},component:"div",children:l}),i.jsx(Y,{variant:"caption",color:"inherit",children:o})]}),...c,ref:n})}),He=e=>{const{id:t,fullIndex:n,title:s,sub:o}=e.item;if(t===void 0)return console.log("SubTreeItem.item.undefined=",e.item),i.jsx(i.Fragment,{});const l=o&&Object.values(o).length>0?Object.values(o).length+"":"";return i.jsx(pn,{onClick:()=>e.onDetail(t,n),nodeId:t,labelText:s,labelInfo:l,pl:e.pl,children:o!=null?Object.values(o).sort((r,c)=>r.title>c.title?1:-1).map((r,c)=>i.jsx("div",{style:{paddingLeft:e.pl+5},children:i.jsx(He,{onDetail:e.onDetail,item:r,pl:e.pl+5})},c+"")):""})};function We(e){const[t,n]=f.useState([]),[s,o]=f.useState([]),l=(d,a)=>{e.onDetail(d,a)};f.useEffect(()=>{if(e.expandIndex!==void 0){let d=e.expandIndex.split("/");d=d.filter(a=>a!=="sub"),console.log("SinyTree.tmp2=",d),e.expandIndex.indexOf("undefined")<0&&(n(d),o(d[d.length-1]))}},[e.expandIndex]);const r=(d,a)=>{},c=(d,a)=>{n(a)};return i.jsx(S,{sx:{minHeight:180,flexGrow:1,display:"flex",flexDirection:"column",height:e.maxHeight,overflow:"hidden",overflowY:"auto",width:"100%"},children:i.jsx(Dt,{"aria-label":"icon expansion",defaultCollapseIcon:i.jsx(Rt,{}),defaultExpandIcon:i.jsx(Bt,{}),expanded:t,onNodeSelect:r,selected:s,onNodeToggle:c,sx:{flexGrow:1,overflow:"hidden",overflowY:"auto"},children:e.data&&e.data.map((d,a)=>i.jsx(He,{onDetail:l,item:d,parentIndex:a+1,pl:5},a+1))})})}async function vn(e,t,n=""){if(t==null||t==="")return"";let s=n===""?`${e}/${t}`:`${e}_txt/${t}`;e==="home"&&(s="home_txt");const o=je(be(ke,s)),l=await nt(o);if(!l.exists())return console.log("getTreeData.null"),null;if(!l.exists())return console.log("getTreeData.exists"),null;const r=l.val(),c=[],d={};e==="home"&&(ne.map(a=>{c.push({title:a.label,id:a.id,sub:[]})}),ne.map(a=>{d[a.id]=[]}));for(const a in r){const u=r[a];u.up===void 0?(u.id=a,u.fullIndex=a):(u.id=u.up,u.fullIndex=u.up),e==="home"?u.gbn!==void 0&&d[u.gbn].push(u):n===""||n===void 0?(u.sub!==null&&(u.children=Fe(u,u.up)),c.push(u)):(u.id=a,(u.memo+"").toLowerCase().indexOf(n.toLowerCase())>-1&&c.push(u))}return e==="home"?Object.values(d).map((a,u)=>{a.sort((h,m)=>h.title>m.title?1:-1),c[u].sub=a}):c.sort((a,u)=>a.title>u.title?1:-1),c}function Fe(e,t){const n=[];if(e===void 0||e.sub===void 0)return n;for(let s in e.sub){let o=e.sub[s];o.id=s,o.key=s}return Object.values(e.sub).sort((s,o)=>o.title-s.title).map(s=>{s.id=s.key,s.fullIndex=t+"/sub/"+s.key,s.sub!==null&&(s.children=Fe(s,s.fullIndex)),n.push(s)}),n}const yn=e=>{const[t,n]=f.useState([]),s=()=>{const o=je(be(ke,`memo_txt/${e}`),ot("bookmark"),st("Y"));it(o,l=>{if(!l.exists())return;const r=l.val(),c=[];for(let d in r){const a=r[d];a.key=d,c.push(a)}c.sort((d,a)=>d.title>a.title?1:-1),n(c)})};return f.useEffect(()=>{s()},[e]),t};function wn(e){const{user:t}=K(),n=G(),s=yn(t?.uid);return t===void 0?i.jsx(i.Fragment,{}):i.jsxs("div",{className:"tail-bookmark justify-items-center",sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"100%"},children:[i.jsx(Se,{}),i.jsx(Ie,{children:"BookMark"}),i.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:s&&s.map((o,l)=>i.jsx("div",{children:i.jsx(lt,{component:"button",variant:"body",onClick:()=>{e.onSelected(o.key),n(`/memo/${o.key}`)},children:i.jsx(Y,{variant:"body1",children:o.title})})},l))})]})}const jn=e=>{const t=f.useRef(null);function n(){e.onSearchDataBtn(t.current.value)}function s(){return e.onNewMemoBtn(),!1}function o(l){l.which===13&&n()}return i.jsxs(i.Fragment,{children:[i.jsx(at,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:t,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:o}),i.jsxs("div",{className:"flex justify-center",children:[i.jsx(le,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:s,children:"새글"}),i.jsx(le,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:n,children:"조회"})]})]})},bn=({className:e="",children:t})=>i.jsx("h4",{className:`mb-2 text-lg font-semibold text-center text-gray-800 dark:text-white/90 
      ${e}}
      `,children:t}),kn={position:"absolute",top:"50%",left:"50%",display:"flex",flexDirection:"column",alignItems:"center",transform:"translate(-50%, -50%)",width:250,maxHeight:"400px",bgcolor:"background.paper",border:"1px solid #000",boxShadow:24,boxSizing:"border-box",p:4},Sn=e=>i.jsxs(S,{sx:{my:2,mt:3,display:"flex"},children:[i.jsx(C,{type:"submit",variant:"outlined",color:"success",onClick:e.onPost,children:"확인"}),i.jsx(C,{type:"button",variant:"outlined",onClick:e.onClose,children:"취소"})]}),In=e=>{const[t,n]=f.useState(e.open),[s,o]=f.useState(),l=()=>{n(!1),o(void 0),e.onClose()};f.useEffect(()=>{n(e.open)},[e.open]);const r=d=>{o(d)},c=()=>{if(s===void 0){alert("이동할 메모장을 선택해 주세요");return}e.onPost(s)};return i.jsx("div",{children:i.jsx(rt,{open:t,onClose:l,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:i.jsxs(S,{sx:kn,children:[i.jsx(Y,{id:"modal-modal-title",variant:"h6",component:"h2",children:"이동할 메모장 선택"}),i.jsx(Se,{}),i.jsx(S,{sx:{width:"100%",minHeight:110,maxHeight:200,flexGrow:1,minWidth:100,overflow:"hidden"},children:i.jsx(We,{data:e.data,onDetail:r,maxHeight:200})}),i.jsx(Sn,{onPost:c,onClose:l})]})})})},$n=e=>i.jsxs(S,{sx:{flexGrow:1,my:2,width:"100%",display:"grid",gridTemplateColumns:"64px 64px  64px  64px ",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:[i.jsx(C,{type:"button",size:"small",variant:"outlined",color:"success",onClick:e.onEdit,children:"수정"}),i.jsx(C,{type:"button",size:"small",variant:"outlined",onClick:e.onNewMemo,children:"새글"}),e.rootDb==="memo"?i.jsx(C,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:e.onMove,children:"이동"}):"",i.jsx(C,{type:"button",size:"small",variant:"outlined",color:"error",onClick:e.onDelete,children:"삭제"})]}),Tn=e=>{const{rootDb:t,memoDetailData:n,bookmark:s}=e,{scrollYProgress:o}=Ne(),l=Oe(o,{stiffness:100,damping:30,restDelta:.001}),[r,c]=f.useState(!1),d=G(),a=f.useRef();a.current=e.searchWord;const{memoId:u}=$e(),m=Z()?.state?.fullIndex,{user:y}=K(),M=()=>{const x=`/${t}/edit/${u}`;d(x,{state:{fullIndex:m}})},T=()=>{const x=`/${t}/insert/${u}`;d(x,{state:{fullIndex:m}})},p=async()=>{const x=t==="memo"?`${t}_txt/${y.uid}/${u}`:`${t}_txt/${u}`,v=t==="memo"?`${t}/${y.uid}`:t;if(await ht(x,v)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}e.onTreeUpdate(),d(`/${t}`)},g=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&p()},k=()=>{c(!0)},j=()=>{e.onBookmark()},b=async x=>{try{const v=t==="memo"?`${t}_txt/${y.uid}`:`${t}_txt`,E=t==="memo"?`memo/${y.uid}`:t,w=await gt(v,E,u,x);e.onTreeUpdate()}catch(v){console.log("catch",v)}finally{c(!1)}};return f.useEffect(()=>{if(n&&n.title!==void 0){const v=document.querySelector("title");v.innerHTML=`${Te.appTitle} :: ${n.title}`}function x(){document.querySelectorAll("pre").forEach(v=>{v.innerHTML=Le(v.innerHTML)})}n&&n.memo!==null&&x()},[n]),u===""||y===void 0?i.jsx(i.Fragment,{}):i.jsxs(ct.Fragment,{children:[i.jsx(se.div,{className:"progress-bar",style:{scaleX:l}}),i.jsxs(Ie,{style:{display:"flex",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"space-between"},children:[i.jsx("div",{}),i.jsx("div",{children:n&&n.title}),i.jsx(se.div,{whileHover:{scale:1.1},whileTap:{scale:.8},initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:.5,ease:[0,.71,.2,1.01],scale:{type:"spring",damping:2,stiffness:100,restDelta:.001}},children:i.jsx(ut,{"aria-label":"bookmark",onClick:j,children:s==="Y"?i.jsx(Ht,{sx:{color:"red"}}):i.jsx(hn,{})})})]}),i.jsxs(Me,{className:"container",sx:{p:0,width:"100%"},children:[i.jsx($n,{rootDb:t,onEdit:M,onNewMemo:T,onMove:k,onDelete:g,onBookmark:j,bookmark:s}),i.jsxs(S,{sx:{my:2},children:[i.jsx(dt,{text:n&&n.memo}),i.jsx(ft,{imageList:n&&n.image}),!n&&i.jsx(S,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:i.jsx(mt,{sx:{mt:5}})})]}),i.jsx(In,{userId:y?.uid,open:r,data:e.data,onClose:()=>c(!1),onPost:b})]}),i.jsx(Ee,{})]})},he=e=>{const{rootDb:t,memoDetailData:n}=e,{scrollYProgress:s}=Ne();Oe(s,{stiffness:100,damping:30,restDelta:.001});const o=G(),l=f.useRef(),r=f.useRef();r.current=e.searchWord;const{memoId:c}=$e(),d=Z(),a=n?.fullIndex,{user:u}=K();console.log("MemoDetailEdit.memoId:",c,", fullIndex:",a,", user=",u?.uid),console.log("MemoDetailEdit.props:",e),l.current=d.pathname.split("/")[2]==="insert",console.log("MemoDetailEdit.newMode=",l.current);const{settings:h,saveSettings:m}=xt(),y=()=>{const p=`/${t}/${c==="insert"?"":c}`;o(p,{state:{fullIndex:a}})},M=async(p,g)=>{console.log("onNewSubmit.values",p),console.log("onNewSubmit.fullIndex",a);const k=t==="memo"?`${t}_txt/${u.uid}/`:`${t}_txt/`,j=t==="memo"?`${t}/${u.uid}/`:`${t}/`;console.log("onNewSubmit.txtLocate",k),console.log("onNewSubmit.locate",j);const b=await oe(void 0,k,j,a,p);if(await ie(`${t}_txt`,t,b,g),b!==void 0){const x=`/${t}/${b}`;o(x,{state:{reflash:!0}})}},T=async(p,g,k)=>{const j=t==="memo"?`${t}_txt/${u.uid}`:`${t}_txt`,b=t==="memo"?`${t}/${u.uid}`:t,x=await vt(j,b,c,g);console.log("onPostSubmit.imageDelete",x),console.log("onPostSubmit.memoId",c),console.log("onPostSubmit.values",p);const v=await oe(l.current?void 0:c,`${j}/`,`${b}/`,a,p);console.log("onPostSubmit.newKey=",v),console.log("onPostSubmit.files=",k);const E=await ie(`${j}/`,`${b}/`,c,k);if(console.log("onNewSubmit.imageResult",E),console.log("onPostSubmit.fullIndex",a),t==="memo"&&a===void 0){const I=await yt(u.uid,`${c}/fullIndex`);console.log("onPostSubmit.fullPath",I),I!==void 0&&V(`memo/${u.uid}/${I}/title`,p.edTitle)}l.current=!1;const w=`/${t}/${c}`;o(w,{state:{fullIndex:a,reflash:!0}})};return f.useEffect(()=>{if(n&&n.title!==void 0){const g=document.querySelector("title");g.innerHTML=`${Te.appTitle} :: ${n.title}`}u!=null&&c!==void 0&&(m({...h,nodeId:c}),l.current===!1&&t==="memo"&&a!==void 0&&Ce(u.uid,c,a));function p(){document.querySelectorAll("pre").forEach(g=>{g.innerHTML=Le(g.innerHTML)})}n&&n.memo!==null&&p()},[n]),c===""||u===void 0?i.jsx(i.Fragment,{}):i.jsxs(i.Fragment,{children:[i.jsx(Me,{className:"container",sx:{p:0,width:"100%"},children:l.current===!1&&n&&(n.title===void 0||n.title===""||n.title===null)?i.jsx(J,{}):i.jsx(pt,{newMode:l.current,onPostSubmit:T,onNewSubmit:M,onCancel:y,title:n.title,gbn:n.gbn,date:n.date,content:n.memo,imageList:n.image})}),i.jsx(Ee,{})]})},Mn=async(e,t,n)=>{let s=new Array;for(let o in n){const l=n[o];try{if(l.key=o,l.url===void 0){const r=await jt(bt,`${t}/${o}.${l.ext}`),c=await kt(r);l.url=c,V(`${e}/image/${o}/url`,c)}s.push(l)}catch(r){console.log("getImageList.catch",r)}}return s},En=async(e,t,n,s)=>{let o="",l="",r={};((a,u,h)=>{l=a==="memo"?`${a}/${u}/${h}`:`${a}/${h}`,o=a==="memo"?`${a}_txt/${u}/${h}`:`${a}_txt/${h}`})(e,t,n);async function d(){if(o===void 0)return"";if(r=await wt(o),r===void 0)return console.log("No data available"),"";if(r?.fullIndex,r.image!==void 0){const a=await Mn(o,l,r.image);(r.imageOK===void 0||r.imageOK==="N")&&(a&&a.map(u=>{u.ext==="jpg"&&(r.memo=r.memo+`<img src='${u.url}'>`)}),console.log("fireMemoDetail.onNeedData.id=",o),V(`${o}/imageOK`,"Y"),V(`${o}/memo`,r.memo))}if(s!==void 0&&s!==""){const a=s,u=new RegExp(a,"gi"),h=r.memo.replace(u,`<span class='lightext'>${a}</span>`);r.memo=h}}return await d(),r},Ln=f.lazy(async()=>await Ct(()=>import("./MemoMain-CPBVtV3r.js"),__vite__mapDeps([0,1,2,3]))),On=({rootDb:e})=>{const t=G(),{user:n}=K(),s=f.useRef(),[o,l]=f.useState(),[r,c]=f.useState(),[d,a]=f.useState(),[u,h]=f.useState(),m=f.useRef(!1),{isMoble:y,height:M}=St(),T=Z(),p=f.useRef(!1);p.current=T?.state?.reflash===!0;const g=It({queryKey:["treeMemo",n?.uid,s.current],queryFn:()=>vn(e,n?.uid,s.current)});g.data!==void 0&&g.data!==""&&!m.current&&(m.current=!0);const k=()=>{d&&(d.bookmark=d.bookmark==="Y"?"N":"Y"),console.log("onBookmark.memoDetailData.bookmark="+d.bookmark),h(d.bookmark),Lt(n.uid,r,d.bookmark)};f.useEffect(()=>{n!==void 0&&n!=null&&g.refetch()},[n]),f.useEffect(()=>{console.log("useEffect.loadOK=",m.current)},[m.current]),f.useEffect(()=>{const w=async F=>{if(F!==""&&n){const B=await En(e,n?.uid,F,s.current);{const R=Pe(g.data,"",F);console.log("useEffect.set.fullIndex=",R),B.fullIndex=R,R!==o&&(l(R),Ce(n.uid,F,R))}B.bookmark===void 0&&(B.bookmark="N"),h(B.bookmark),a(B)}},I=T.pathname.split("/"),D=I.length>2?I[I.length-1]:"";console.log("useEffect.tmp=",D),w(D),c(D)},[T.pathname,n]),f.useEffect(()=>{n!==void 0&&n!=null&&g.refetch()},[p.current]);const j=w=>{m.current=!1,w!==void 0&&(s.current=w),g.refetch()},b=(w,I)=>{console.log("onDetail.memoId=",w,", fullIndex=",o);const D=`/${e}/${w}`;t(D,{state:{fullIndex:o}})},x=()=>{if(n==null){alert("로그인 후 이용 가능합니다.");return}const w=`/${e}/insert/insert`;t(w)},v=w=>{},E=i.jsxs("div",{className:"",children:[i.jsx(bn,{className:"mt-3 ",children:e==="memo"?"메모장":"홈페이지관리"}),i.jsxs("div",{className:"flex gap-7 justify-center",children:[i.jsx(P,{to:"/",children:"홈"}),e==="memo"?"":i.jsx(P,{to:"/memo",children:"메모"}),i.jsx(P,{to:"/todo",children:"TODO"}),i.jsx(P,{to:"/tail",children:"Sheet"})]}),i.jsx(jn,{onNewMemoBtn:x,onSearchDataBtn:j}),i.jsx("div",{className:`grow-1 h-[${M-220}px]`,children:m.current&&g.isFetched?i.jsx(We,{expandIndex:o,data:g.data,onDetail:b,maxHeight:M-220-(y?56:0)}):i.jsx(J,{})})]});return n&&n.uid===$t&&Tt,i.jsxs(Ot,{sideType:"memo",title:e==="memo"?"메모장":"홈페이지관리",sideContents:E,children:[i.jsx(f.Suspense,{fallback:i.jsx(J,{}),children:i.jsxs(Mt,{children:[i.jsx(z,{path:"/edit/:memoId",element:i.jsx(he,{rootDb:e,searchWord:s.current,memoDetailData:d,data:g.data})}),i.jsx(z,{path:"/insert/:memoId",element:i.jsx(he,{rootDb:e,searchWord:s.current,memoDetailData:d,data:g.data})}),i.jsx(z,{path:"/:memoId",element:i.jsx(Tn,{rootDb:e,searchWord:s.current,memoDetailData:d,bookmark:u,onTreeUpdate:j,onBookmark:k,data:g.data})}),i.jsx(z,{path:"*",element:i.jsx(Ln,{searchWord:s.current,data:g.data,onNewMemoBtn:x,title:e==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),e==="memo"?i.jsx(wn,{onSelected:v}):"",i.jsx(Et,{})]})},Pe=(e,t,n)=>{let s="";if(e)for(let o=0;o<e.length;o++){const l=e[o];if(l.id===n)return s=t+l.id,s;if(l.sub!==null&&l.sub!==void 0&&(s=Pe(Object.values(l.sub),t+l.id+"/sub/",n),s!==""))return s}return s};export{On as M};
