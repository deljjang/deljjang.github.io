import{r as u,j as r,i as g,s as h,ap as f,q as b,o as m,n as y,t as v,p as T}from"./index-DUSpVCOt.js";import{T as I,a as j,E as M,b as C,t as d}from"./CommonLayout-CnYkp9j8.js";import{u as D}from"./useSuspenseQuery-CVasmJeR.js";const R=h(C)(({theme:e})=>({color:e.palette.text.secondary,[`& .${d.content}`]:{color:e.palette.text.secondary,borderTopRightRadius:e.spacing(2),borderBottomRightRadius:e.spacing(2),paddingRight:e.spacing(1),fontWeight:e.typography.fontWeightMedium,"&.MuiTreeItem-content":{paddingLeft:"3px",paddingRight:"3px"},".MuiTreeItem-label":{paddingLeft:"0px"},".MuiTreeItem-iconContainer":{marginRight:"0px"},"&.Mui-expanded":{fontWeight:e.typography.fontWeightRegular},"&:hover":{backgroundColor:e.palette.action.hover},"&.Mui-selected":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},[`& .${d.label}`]:{fontWeight:"inherit",color:"inherit"}},[`& .${d.group}`]:{marginLeft:0,[`& .${d.content}`]:{paddingLeft:e.spacing(1)}}})),w=u.forwardRef(function(o,s){const{labelIcon:t,labelInfo:n,labelText:c,pl:l,...a}=o;return r.jsx(R,{label:r.jsxs(g,{sx:{display:"flex",alignItems:"center",p:.5,pr:2,pl:{pl:l}},children:[r.jsx(g,{component:t,color:"inherit",sx:{mr:1,pl:{pl:l}}}),r.jsx(f,{sx:{fontWeight:"inherit",flexGrow:1},component:"div",children:c}),r.jsx(f,{variant:"caption",color:"inherit",children:n})]}),...a,ref:s})}),p=e=>{const{id:o,fullIndex:s,title:t,sub:n}=e.item;if(o===void 0)return console.log("SubTreeItem.item.undefined=",e.item),r.jsx(r.Fragment,{});const c=n&&Object.values(n).length>0?Object.values(n).length+"":"";return r.jsx(w,{onClick:()=>e.onDetail(o,s),nodeId:o,labelText:t,labelInfo:c,pl:e.pl,children:n!=null?Object.values(n).sort((l,a)=>l.title>a.title?1:-1).map((l,a)=>r.jsx("div",{style:{paddingLeft:e.pl+5},children:r.jsx(p,{onDetail:e.onDetail,item:l,pl:e.pl+5})},a+"")):""})};function $(e){const[o,s]=u.useState([]),t=(c,l)=>{e.onDetail(c,l)},n=(c,l)=>{s(l)};return console.log("SinyTree.props.data=",e.data),r.jsx(g,{sx:{minHeight:180,flexGrow:1,display:"flex",flexDirection:"column",height:e.maxHeight,overflow:"hidden",width:"100%"},children:r.jsx(I,{"aria-label":"icon expansion",defaultCollapseIcon:r.jsx(M,{}),defaultExpandIcon:r.jsx(j,{}),expanded:o,onNodeToggle:n,sx:{flexGrow:1,overflow:"hidden",overflowY:"auto"},children:e.data&&e.data.map((c,l)=>r.jsx(p,{onDetail:t,item:c,parentIndex:l+1,pl:5},l+1))})})}async function S(e,o=""){if(console.log("getTreeMemoData.userId=",e,", word=",o),console.log("getTreeMemoData.userId=",e,", word=",o),e==null||e==="")return"";const s=o===""?`memo/${e}`:`memo_txt/${e}`;console.log("getTreeMemoData.word=",o,", param=",s);const t=b(y(v,s),m("title")),n=await T(t);if(!n.exists()){console.log("getFireText.null");return}if(!n.exists())return;const c=n.val();console.log("useTreeData.data=",c);const l=[];for(let a in c){const i=c[a];i.up===void 0?(i.id=a,i.fullIndex=a):(i.id=i.up,i.fullIndex=i.up),o===""||o===void 0?(i.sub!==null&&(i.children=x(i,i.up)),l.push(i)):(i.id=a,(i.memo+"").toLowerCase().indexOf(o.toLowerCase())>-1&&l.push(i))}return l.sort((a,i)=>a.title>i.title?1:-1),l}function x(e,o){const s=[];if(e===void 0||e.sub===void 0)return s;for(let t in e.sub){let n=e.sub[t];n.id=t,n.key=t}return Object.values(e.sub).sort((t,n)=>n.title-t.title).map(t=>{t.id=t.key,t.fullIndex=o+"/sub/"+t.key,t.sub!==null&&(t.children=x(t,t.fullIndex)),s.push(t)}),s}const O=e=>{const[o,s]=u.useState(e),[t,n]=u.useState([]),[c,l]=u.useState();return u.useEffect(()=>{if(o!==""){console.log("param=",o);const a=D({queryKey:["treeMemo",o],queryFn:()=>S(o)});console.log("tQuery=",a),n(a.data)}},[o,c]),[t,s,l]};export{$ as S,S as g,O as u};
