import{aq as se,j as e,r as m,a0 as le,a2 as re,E as a,F as c,a3 as ie,ar as Q,i as z,G as I,ac as A,a6 as ee,as as De,a4 as te,M as je,U as J,V as X,D as T,J as be,l as ve,C as ae,an as Z,at as Ce,s as ce,au as oe,q as Te,t as we,o as Se}from"./index-BIXBUUro.js";import{D as Ie,S as ke,a as $e}from"./SinyDate-CyOB54NO.js";import{D as de}from"./datetime-BDx6lZXm.js";import{a as ue,C as Be}from"./index.esm-CMm5mWpG.js";import{A as H}from"./AniButton-DR2UJtFe.js";import{T as _}from"./TextField-Cy9EtlX2.js";import{e as ne}from"./MuiCard-DmgdrjK-.js";import{H as Fe,r as Me}from"./registry-B0zkL9Zb.js";import{n as Le}from"./handson-CS9Rir92.js";import{T as Re,a as Ee}from"./Tabs-rxSMVoh8.js";import"./InputAdornment-CO5zZT3M.js";import"./Popper-Czrv449L.js";import"./Button-C579_WSb.js";import"./Chip-D6LwS71a.js";import"./Card-0pN4Ihm0.js";import"./CardContent-DKR7x2zf.js";import"./KeyboardArrowRight-CXjffbTU.js";const We=se(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),Ye=se(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),Pe=o=>{const[s,i]=m.useState(o),[d,u]=m.useState([]),[g,h]=m.useState(),y=m.useCallback(k=>{const F=le(a(c,k),re("title"));ie(F,E=>{if(!E.exists())return;const p=E.val(),w=[];for(let j in p){const x=p[j];x.id=j,x.sort=`${x.ing}_${x.date}_${x.title}`,(g===""||g===void 0||(x.memo+"").toLowerCase().indexOf(g.toLowerCase())>-1)&&w.push(x)}const K=w.sort((j,x)=>j.sort>x.sort?1:-1).filter(j=>j.ing==="1"),D=w.sort((j,x)=>j.sort>x.sort?-1:1).filter(j=>j.ing==="2");u([...K,...D])})},[g]);return m.useEffect(()=>{s!==""&&y(s)},[y,s,g]),[d,i,h]},ze=o=>{const{userId:s}=o,[i,d]=Pe("");console.log("TodoDetail.todoList=",i);const u=de.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),g={edTitle:"",edDate:u},{register:h,handleSubmit:y,reset:k,getValues:F,setFocus:E,formState:{errors:p,isSubmitting:w,submitCount:K}}=ue({mode:"submit ",defaultValues:g}),D=m.useRef();m.useEffect(()=>{h("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:3,message:"3글자 이상 입력해주세요."}}),h("edDate",{required:!0,minLength:10})}),m.useEffect(()=>{s!==void 0&&d(`todo/${s}`)},[s]);async function j(l){console.log("onInputBtn.errors=",p),console.log("onInputBtn.isSubmitting=",w),console.log("onInputBtn.edDate=",F("edDate")),console.log("onInputBtn.edTitle=",F("edTitle")),console.log("onInputBtn.submitCount=",K),l.preventDefault(),y(M)()}const x=()=>{o.handleGoogleLogin()};if(s===void 0)return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:[e.jsx(Q,{children:"로그인을 해야 이용가능합니다."}),e.jsx(H,{type:"button",size:"small",variant:"outlined",color:"success",sx:{mt:30},onClick:x,children:"로그인"})]});const U=(l,b)=>{l.preventDefault(),console.log("onEdit.item=",b),E("edTitle"),k({edTitle:b.title,edDate:b.date}),D.current=b.id,console.log("onEdit.todoId=",D.current)},V=l=>{l.preventDefault(),console.log("onCancel.item="),k({edTitle:""}),D.current=void 0},q=(l,b)=>{l.preventDefault(),window.confirm("삭제하시겠습니까?")&&T(a(c,`todo/${s}/${b.id}`),null)},N=(l,b)=>{l.preventDefault(),window.confirm("완료하시겠습니까?")&&T(a(c,`todo/${s}/${b.id}/ing`),"2")},G=l=>console.error(l);function M(l,b){console.log("onSubmit.data=",l),console.log("onSubmit.e=",b),console.log("onSubmit.todoId=",D.current),console.log("onSubmit.errors=",p);const v=`todo/${s}/`;if(D.current===void 0){const W=J(X(a(c),v)).key;console.log("onSubmit.newKey",W),D.current=W}T(a(c,v+D.current+"/title"),l.edTitle),T(a(c,v+D.current+"/date"),l.edDate),T(a(c,v+D.current+"/ing"),"1"),D.current=void 0,k({edTitle:"",edDate:u})}return e.jsxs(e.Fragment,{children:[e.jsxs(z,{sx:{width:"100%",flexGrow:1,m:2},children:[e.jsx("div",{id:"back-to-top-anchor"}),e.jsx("form",{onSubmit:y(M,G),children:e.jsxs(I,{container:!0,spacing:2,columns:{xs:12,md:12},children:[e.jsx(I,{item:!0,xs:12,children:e.jsx(_,{type:"date",style:{paddingTop:"2px"},fullWidth:!0,placeholder:"일자",...h("edDate"),variant:"standard"})}),e.jsx(I,{item:!0,xs:9,sm:10,children:e.jsxs(z,{sx:{display:"flex",alignItems:"normal",justifyContent:"center"},children:[e.jsx(_,{fullWidth:!0,style:{paddingTop:"2px"},placeholder:"Todo Input",...h("edTitle"),variant:"standard",error:!!p.edTitle}),e.jsx(A,{style:{marginTop:"-4px"},"aria-label":"bookmark",onClick:l=>V(l),children:e.jsx(We,{sx:{color:"action.active"}})})]})}),e.jsx(I,{item:!0,xs:3,sm:2,children:e.jsx(H,{variant:"outlined",fullWidth:!0,onClick:l=>j(l),color:"success",size:"small",disabled:w,children:"입력"})}),e.jsx(I,{item:!0,xs:12,sm:12,children:p?.edTitle?e.jsx("p",{className:"error",children:p.edTitle?.message}):null})]})}),i?.map((l,b)=>e.jsxs("div",{children:[e.jsxs(z,{sx:{display:"plex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(ee,{component:"div",variant:"body2",color:"text.prime",children:l.date}),e.jsxs(z,{sx:{display:"plex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[l.ing==="1"&&e.jsxs(e.Fragment,{children:[e.jsx(A,{"aria-label":"완료",onClick:v=>N(v,l),children:e.jsx(Ye,{})}),e.jsx(A,{"aria-label":"edit",onClick:v=>U(v,l),children:e.jsx(De,{})})]}),e.jsx(A,{"aria-label":"delete",onClick:v=>q(v,l),children:e.jsx(Ie,{sx:{color:"rgba(120, 0, 0, 3)"}})})]})]}),e.jsx(ee,{component:"div",variant:"body",color:"text.prime",children:l.title}),e.jsx(te,{})]},b)),e.jsx(je,{})]}),e.jsx(te,{})]})},He=o=>e.jsxs(z,{sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[e.jsx(H,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:o.onInsert,children:"입력"}),e.jsx(H,{type:"button",size:"small",variant:"outlined",color:"error",onClick:o.onDelete,children:"삭제"}),e.jsx(H,{type:"button",size:"small",variant:"outlined",color:"success",onClick:o.onReload,children:"리로드"}),e.jsx(H,{type:"button",size:"small",variant:"outlined",onClick:o.onCsvSave,children:"csv저장"})]}),Ke=({name:o,label:s,control:i,defaultValue:d,placeholder:u,variant:g="filled",margin:h="none",size:y="small",xsSize:k=12,mdSize:F=6,onKeyUp:E})=>e.jsx(I,{item:!0,xs:k,md:F,children:e.jsx(Be,{control:i,name:o,defaultValue:d,render:({field:p})=>e.jsx(_,{label:s,placeholder:u,value:p.value,inputRef:p.ref,onChange:w=>{p.onChange(w)},size:y,defaultValue:d,variant:g,margin:h,fullWidth:!0,onKeyUp:E,...p})})});Me();const Ge=o=>{const{userId:s,baseUrl:i}=o,d=m.useRef(null),u=m.useRef(null),[g,h]=m.useState(),[y,k]=m.useState(0),{height:F}=be(),p=ve().palette.mode==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",w=de.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),K={edTitle:"",edDate:w},D=async t=>{console.log("onFunPost.data",t.id,t);const n=`${i}/${s}/`;if(t.id===void 0){const r=J(X(a(c),n)).key;console.log("onSubmit.newKey",r),t.id=r}return T(a(c,n+t.id+"/title"),t.title),T(a(c,n+t.id+"/date"),t.date),T(a(c,n+t.id+"/t1"),t.t1),T(a(c,n+t.id+"/t2"),t.t2),T(a(c,n+t.id+"/ing"),"1"),t},j=async()=>{const t=`${i}/${s}/`,n=le(a(c,t),re("title"));ie(n,r=>{if(!r.exists())return;const S=r.val(),$=[];for(let C in S){const f=S[C];f.id=C,f.sort=`${f.ing}_${f.date}_${f.title}`,$.push(f)}const P=$.sort((C,f)=>C.sort>f.sort?1:-1).filter(C=>C.ing==="1"),B=$.sort((C,f)=>C.sort>f.sort?-1:1).filter(C=>C.ing==="2");h([...P,...B]),k($.length)})};m.useEffect(()=>{M("edDate",{required:!0,minLength:10}),M("filterField1"),O("columns1",o.selectDefault)},[]),m.useEffect(()=>{s!==void 0&&j()},[s]);const x=async()=>{G()},U=async()=>{d.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:o.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},V=[],q={indicators:!0},N=[];o.columns.map((t,n)=>{t.select&&V.push({value:n,text:t.title}),t.hidden===!0&&N.push(n)}),q.columns=N;const G=()=>{try{const t=d.current?.hotInstance,n=t?.getPlugin("filters");if(n){const r=L("columns1");console.log("onKeyUp.columns1=",r,"text=",L("filterField1")),o.columns.forEach((P,B)=>{n?.removeConditions(B)}),n?.addCondition(Number(r),"contains",[L("filterField1")]),n?.filter(),t?.render(),console.log("filtersPlugin=",n),console.log("hotRef=",d.current);const $=t.getData().length;k($)}}catch(t){console.error("Error:",t),console.error("Error:",t.message)}},{register:M,handleSubmit:l,trigger:b,reset:v,control:W,setValue:O,getValues:L,formState:{errors:Y}}=ue({mode:"submit ",defaultValues:K});async function me(){console.log("onInputBtn.errors=",Y),console.log("onInputBtn.edDate=",L("edDate")),console.log("onInputBtn.edTitle=",L("edTitle")),l(ge)()}function ge(t,n){console.log("onSubmit.data=",t),console.log("onSubmit.e=",n),console.log("onSubmit.errors=",Y);const r=`${o.baseUrl}/${s}/`,S=J(X(a(c),r)).key;console.log("onSubmit.newKey",t.newKey),T(a(c,r+S+"/title"),t.edTitle),T(a(c,r+S+"/date"),t.edDate),T(a(c,r+S+"/ing"),"1"),v({edTitle:"",edDate:w})}const fe=async(t,n)=>{if(console.log("afterChange.change=",t,", source=",n),console.log("afterChange.change.length=",t?.length),t!==null){const r=d.current?.hotInstance;if(r?.getPlugin("filters")){const $=r.getData(),P=[];t.forEach((B,C)=>{const f={};console.log("afterChange.index1=",C,", item1=",B[0]),o.columns.forEach((R,ye)=>{console.log("afterChange.filteredData=",$[B[0]],R),f[R.data]=$[B[0]][ye]}),console.log("afterChange.tmp=",f),P.push(f)}),console.log("afterChange.saveData=",P),P.forEach(async(B,C)=>{console.log("afterChange.item=",B);const f=await D(B);console.log("afterChange.result=",C,", result=",f),g.map(R=>{(R.id===void 0||R.id===null)&&(console.log("afterChange.rowData1=",R),R.id=f?.id,console.log("afterChange.rowData2=",R))})}),r.render()}}},he=async()=>{const t=d.current.hotInstance;if(console.log("onDelete:",t),t&&u.current!==null){if(t?.getPlugin("filters")){const r=t.getData();console.log("onDelete.filteredData=",r[u.current]);const S=r[u.current][o.keyId];console.log("onDelete.deleteId=",S),window.confirm("삭제하시겠습니까?")&&T(a(c,`${o.baseUrl}/${s}/${S}`),null)}t.alter("remove_row",u.current,1)}};function xe(t){console.log("handleChangeDate=",t);let n=Z(t);n.format("YYYY-MM-DD HH:mm:ss"),console.log("handleChangeDate.dayjs=",n.format("YYYY-MM-DD HH:mm:ss")),O("edDate",n.format("YYYY-MM-DD")),b("edDate")}const pe=Y?.edTitle?e.jsx(I,{item:!0,xs:12,children:e.jsx("p",{className:"error",children:Y.edTitle?.message})}):"";return e.jsxs(ae,{style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},sx:{mt:0},children:[e.jsxs(I,{container:!0,spacing:3,children:[e.jsx(ke,{id:"columns1",label:"조회 컬럼",mdSize:3,control:W,defaultValue:o.selectDefault?o.selectDefault:"1",selectList:V,error:!!Y.columns1,onChange:t=>{t.preventDefault();const n=t.target.value;console.log("columns1=",L("columns1")),O("columns1",n),n!=""&&G()}}),e.jsx(Ke,{...M("filterField1"),name:"filterField1",control:W,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",size:"small",mdSize:9,fullWidth:!0,onKeyUp:G}),e.jsx($e,{control:W,id:"edDate",label:"일자",mdSize:3,value:Z(L("edDate")),...M("edDate"),defaultValue:Z(L("edDate")),onChange:xe}),e.jsx(I,{item:!0,xs:12,md:9,children:e.jsx(_,{...M("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),fullWidth:!0,label:"제목",placeholder:"제목 입력",variant:"filled",size:"small",style:{},error:!!Y.edTitle})}),pe,e.jsx(I,{item:!0,xs:12,md:3,sx:{paddingTop:["0 !important","0 !important","0.5rem !important"]},children:e.jsx(Q,{textAlign:"left",children:"건수 : "+Le(y)})}),e.jsx(I,{item:!0,xs:12,md:9,sx:{paddingTop:["0 !important","0 !important","0.5rem !important"]},children:e.jsx(He,{onInsert:me,onDelete:he,onReload:x,onCsvSave:U})})]}),e.jsx("div",{style:{maxHeight:`${F}- 200`,overflow:"auto"},children:e.jsx(Fe,{ref:d,data:g,themeName:p,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:F-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:fe,afterSelection:t=>{u.current=t},licenseKey:"non-commercial-and-evaluation",columns:o.columns,cells:(t,n)=>o.columns[n].readOnly===!0?{readOnly:!0}:{},colWidths:o.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:q})})]})},Ue=({userId:o})=>{const s=[{title:"일자",data:"date",type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"1",type:"text",data:"t1",select:!1},{title:"2",type:"text",data:"t2",select:!1},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"진행중",type:"text",data:"ing",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}],i=[130,500,100,100,100];return o===void 0?e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:e.jsx(Q,{children:"로그인을 해야 이용가능합니다."})}):e.jsx(Ge,{csvFileName:"exported_todo",baseUrl:"todo",columns:s,colWidths:i,selectDefault:"1",keyId:s.length-1,userId:o})},Ve=ce(z)(({theme:o})=>({backgroundColor:o.palette.mode==="dark"?oe.dark.backgroundColor:oe.light.backgroundColor,borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",alignContent:"center",justifyContent:"center",overflowX:"auto"}));function qe({tabValue:o,onChange:s,tabs:i}){const d=Ce(),u=ce(Re)({"&.Mui-selected":{color:d.palette.text}});return e.jsx(Ve,{index:o,style:{width:"100%"},children:e.jsx(Ee,{value:o,onChange:s,variant:"scrollable",scrollButtons:!1,allowScrollButtonsMobile:!0,"aria-label":"secondary tabs example",children:i.map(g=>e.jsx(u,{label:g.label},g.id))})})}const ct=()=>{const{user:o,handleGoogleLogin:s}=Te(),[i,d]=m.useState(0),u=[{label:"그리도",id:"grid"},{label:"리스트",id:"list"}];m.useEffect(()=>{const h=document.querySelector("title");h.innerHTML=`${we.templateName} :: Todo`},[]),m.useEffect(()=>{const h=u.findIndex(y=>`#${y.id}`===window.location.hash);d(h!==-1?h:i)},[i]);const g=(h,y)=>{window.location.hash=`#${u[y].id}`,d(y)};return e.jsxs(ae,{maxWidth:"lg",sx:{mt:3},children:[e.jsx(qe,{tabValue:i,onChange:g,tabs:u}),e.jsxs(m.Suspense,{fallback:e.jsx(Se,{}),children:[e.jsx(ne,{value:i,index:0,style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},children:e.jsx(Ue,{userId:o?.uid||!1,handleGoogleLogin:s})}),e.jsx(ne,{value:i,index:1,style:{maxWidth:"100%",width:"100%",paddingLeft:"0px",paddingRight:"0px"},children:e.jsx(ze,{userId:o?.uid,handleGoogleLogin:s})})]})]})};export{ct as default};
