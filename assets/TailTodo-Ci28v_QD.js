import{j as o,i as le,r as D,J as se,ch as re,a0 as ae,a2 as ie,E as a,F as i,a3 as ce,D as m,U as K,V as U,q as de,cn as ue}from"./index-BIXBUUro.js";import{I as z,T}from"./InputField-BxLWa9fk.js";import{H as ge,r as me}from"./registry-B0zkL9Zb.js";import{D as fe}from"./datetime-BDx6lZXm.js";import{a as he}from"./index.esm-CMm5mWpG.js";import{D as xe}from"./date-picker-BuysMe20.js";import{S as ye}from"./Select-Bk1ufa3L.js";import{n as De}from"./handson-CS9Rir92.js";import{A as p}from"./AniButton-DR2UJtFe.js";import"./Button-C579_WSb.js";const ve=n=>o.jsxs(le,{sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[o.jsx(p,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:n.onInsert,children:"입력"}),o.jsx(p,{type:"button",size:"small",variant:"outlined",color:"error",onClick:n.onDelete,children:"삭제"}),o.jsx(p,{type:"button",size:"small",variant:"outlined",color:"success",onClick:n.onReload,children:"리로드"}),o.jsx(p,{type:"button",size:"small",variant:"outlined",onClick:n.onCsvSave,children:"csv저장"})]});me();const Ce=n=>{const{userId:g,baseUrl:w}=n,h=D.useRef(null),v=D.useRef(null),[S,V]=D.useState(),[H,R]=D.useState(0),{height:k}=se(),P=fe.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),M={edTitle:"",edDate:P},{register:b,handleSubmit:W,trigger:A,reset:L,control:j,setValue:I,getValues:C,formState:{errors:x}}=he({mode:"submit ",defaultValues:M}),{theme:q}=re(),O=q==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",Y=async e=>{console.log("onFunPost.data",e.id,e);const t=`${w}/${g}/`;if(e.id===void 0){const l=K(U(a(i),t)).key;console.log("onSubmit.newKey",l),e.id=l}return m(a(i,t+e.id+"/title"),e.title),m(a(i,t+e.id+"/date"),e.date),m(a(i,t+e.id+"/t1"),e.t1),m(a(i,t+e.id+"/t2"),e.t2),m(a(i,t+e.id+"/ing"),"1"),e},_=async()=>{const e=`${w}/${g}/`,t=ae(a(i,e),ie("title"));ce(t,l=>{if(!l.exists())return;const c=l.val(),d=[];for(let r in c){const s=c[r];s.id=r,s.sort=`${s.ing}_${s.date}_${s.title}`,d.push(s)}const y=d.sort((r,s)=>r.sort>s.sort?1:-1).filter(r=>r.ing==="1"),u=d.sort((r,s)=>r.sort>s.sort?-1:1).filter(r=>r.ing==="2");V([...y,...u]),R(d.length)})};D.useEffect(()=>{b("edDate",{required:!0,minLength:10}),b("filterField1"),I("columns1",n.selectDefault),b("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}})},[]),D.useEffect(()=>{g!==void 0&&_()},[g]);const G=async()=>{N()},J=async()=>{h.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:n.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},$=[],E={indicators:!0},B=[];n.columns.map((e,t)=>{e.select&&$.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&B.push(t)}),E.columns=B;const N=()=>{try{const e=h.current?.hotInstance,t=e?.getPlugin("filters");if(t){const l=C("columns1");console.log("onKeyUp.columns1=",l,"text=",C("filterField1")),n.columns.forEach((y,u)=>{t?.removeConditions(u)}),t?.addCondition(Number(l),"contains",[C("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",h.current);const d=e.getData().length;R(d)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function Z(){console.log("onInputBtn.errors=",x),console.log("onInputBtn.edDate=",C("edDate")),console.log("onInputBtn.edTitle=",C("edTitle")),W(Q)()}function Q(e,t){console.log("onSubmit.data=",e),console.log("onSubmit.e=",t),console.log("onSubmit.errors=",x);const l=`${n.baseUrl}/${g}/`,c=K(U(a(i),l)).key;console.log("onSubmit.newKey",e.newKey),m(a(i,l+c+"/title"),e.edTitle),m(a(i,l+c+"/date"),e.edDate),m(a(i,l+c+"/ing"),"1"),L({edTitle:"",edDate:P})}const X=async(e,t)=>{if(console.log("afterChange.change=",e,", source=",t),console.log("afterChange.change.length=",e?.length),e!==null){const l=h.current?.hotInstance;if(l?.getPlugin("filters")){const d=l.getData(),y=[];e.forEach((u,r)=>{const s={};console.log("afterChange.index1=",r,", item1=",u[0]),n.columns.forEach((f,ne)=>{console.log("afterChange.filteredData=",d[u[0]],f),s[f.data]=d[u[0]][ne]}),console.log("afterChange.tmp=",s),y.push(s)}),console.log("afterChange.saveData=",y),y.forEach(async(u,r)=>{console.log("afterChange.item=",u);const s=await Y(u);console.log("afterChange.result=",r,", result=",s),S.map(f=>{(f.id===void 0||f.id===null)&&(console.log("afterChange.rowData1=",f),f.id=s?.id,console.log("afterChange.rowData2=",f))})}),l.render()}}},ee=async()=>{const e=h.current.hotInstance;if(console.log("onDelete:",e),e&&v.current!==null){if(e?.getPlugin("filters")){const l=e.getData();console.log("onDelete.filteredData=",l[v.current]);const c=l[v.current][n.keyId];console.log("onDelete.deleteId=",c),window.confirm("삭제하시겠습니까?")&&m(a(i,`${n.baseUrl}/${g}/${c}`),null)}e.alter("remove_row",v.current,1)}},F=e=>{const t=e.target.value;console.log("onChange.target=",e.target.value),I(e.target.name,t)};function te(e,t){console.log("handleChangeDate.dates=",e,"currentDateString=",t),I("edDate",t),A("edDate")}const oe=x?.edTitle?o.jsx("div",{className:"sm:grid-cols-12 md:grid-cols-12 lg:grid-cols-12 xl:grid-cols-12",children:o.jsx("p",{className:"error",children:x.edTitle?.message})}):"";return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[o.jsx(ye,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:j,className:"dark:bg-dark-900",defaultValue:n.selectDefault?n.selectDefault:"1",options:$,error:!!x.columns1,onChange:F}),o.jsx(z,{name:"filterField1",control:j,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",size:"small",onKeyUp:N,onChange:F}),o.jsx(xe,{control:j,id:"edDate",name:"edDate",label:"등록일자",placeholder:"일자 입력",onChange:te}),o.jsxs("div",{children:[o.jsx(T,{htmlFor:"edTitle",children:"등록제목"}),o.jsx(z,{name:"edTitle",label:"제목",placeholder:"제목 입력",variant:"filled",size:"small",onChange:F,style:{},error:!!x.edTitle})]})]}),oe,o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[o.jsx(T,{textAlign:"left",children:"건수 : "+De(H)}),o.jsx(ve,{onInsert:Z,onDelete:ee,onReload:G,onCsvSave:J})]}),o.jsx("div",{style:{maxHeight:`${k}- 200`,overflow:"auto"},children:o.jsx(ge,{ref:h,data:S,themeName:O,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:k-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:X,afterSelection:e=>{v.current=e},licenseKey:"non-commercial-and-evaluation",columns:n.columns,cells:(e,t)=>n.columns[t].readOnly===!0?{readOnly:!0}:{},colWidths:n.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:E})})]})},Pe=()=>{const{user:n}=de(),g=[{title:"일자",data:"date",type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"1",type:"text",data:"t1",select:!1},{title:"2",type:"text",data:"t2",select:!1},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"진행중",type:"text",data:"ing",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}],w=[130,500,100,100,100];return!n||n?.uid===void 0?o.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:o.jsx(T,{children:"로그인을 해야 이용 가능합니다."})}):o.jsxs(o.Fragment,{children:[o.jsx(Ce,{csvFileName:"exported_todo",baseUrl:"todo",columns:g,colWidths:w,selectDefault:"1",keyId:g.length-1,userId:n?.uid}),o.jsx(ue,{})]})};export{Pe as default};
