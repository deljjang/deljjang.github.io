import{j as t}from"./index-Ck2d_L_e.js";import{g as _,n as g,N as se,i as ae,U as le,a2 as ne,a3 as oe,a4 as P,a5 as E,a6 as re,a1 as V,Q as T,w as ie,O as ce,a8 as m,a9 as de,aa as ue,P as me,o as he}from"./App--a2e3x7R.js";import{D as fe}from"./luxon-MrBZWWSV.js";import{r as u}from"./router-BlMcuVHC.js";import{u as ge}from"./useWindowDimensions-c3RsCB5T.js";import{T as xe}from"./TwDatePicker-CS_I1-sS.js";import{T as ye}from"./TwSelect-CNt8UIub.js";import"./vendor-CCYiWZgt.js";const we=[130,500,100,100,100],M=[{title:"col_date",data:"date",type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,readOnly:!1,select:!0},{title:"col_title",type:"text",data:"title",select:!0},{title:"col_1",type:"text",data:"t1",select:!1},{title:"col_2",type:"text",data:"t2",select:!1},{title:"col_sort",type:"text",data:"sort",select:!1,hidden:!0},{title:"col_ing",type:"text",data:"ing",select:!1,hidden:!0},{title:"col_id",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}],De=s=>{const{t:n}=_();return t.jsxs("div",{className:"my-2 flex flex-grow items-center justify-end whitespace-nowrap pt-0",children:[t.jsx(g,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:s.onInsert,className:"mr-2",children:n("input")}),t.jsx(g,{type:"button",size:"sm",variant:"outlined",color:"warning",onClick:s.onDelete,className:"mr-2",children:n("delete")}),t.jsx(g,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:s.onReload,className:"mr-2",children:n("reload")}),t.jsx(g,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:s.onCsvSave,children:n("csv_save")})]})};me();const pe=s=>{const{userId:n,baseUrl:x}=s,d=u.useRef(null),y=u.useRef(null),[O,U]=u.useState([]),[W,w]=u.useState(0),{height:C}=ge(),{t:l}=_(),F=fe.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),q={edTitle:"",edDate:F},{register:D,handleSubmit:z,trigger:A,control:p,setValue:v,getValues:I,reset:B,formState:{errors:h}}=se({mode:"submit ",defaultValues:q}),H=ae(le)==="dark"?"ht-theme-main-dark-auto":"ht-theme-main";u.useEffect(()=>{D("edDate",{required:!0,minLength:10}),D("filterField1"),v("columns1",s.selectDefault),D("edTitle",{required:l("required_field"),minLength:{value:1,message:l("min_length_1")}})},[]),u.useEffect(()=>{if(!n)return;const e=ne(P(E,`${x}/${n}`),oe("date")),a=re(e,o=>{const r=o.val(),i=r?Object.keys(r).map(c=>({id:c,...r[c]})):[];i.sort((c,f)=>c.date>f.date?-1:1),U(i),w(i.length)});return()=>a()},[n,x]);const L=async()=>{$()},Y=async()=>{d.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:s.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},N=[],R={indicators:!0},S=[],k=new Array;s.columns.map((e,a)=>{k.push({...e,title:l(e.title)}),e.select&&N.push({value:a,text:l(e.title),label:l(e.title)}),e.hidden===!0&&S.push(a)}),R.columns=S;const $=()=>{try{const e=d.current?.hotInstance,a=e?.getPlugin("filters");if(a){const o=I("columns1");s.columns.forEach((c,f)=>{a?.removeConditions(f)}),a?.addCondition(Number(o),"contains",[I("filterField1")]),a?.filter(),e?.render();const i=e.getData().length;w(i)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function K(){z(G)()}function G(e,a){const o=`${s.baseUrl}/${n}/`,r=de(ue(P(E),o)).key;m(o+r+"/title",e.edTitle),m(o+r+"/date",e.edDate),m(o+r+"/ing","1"),B({edTitle:"",edDate:F})}const Q=async(e,a)=>{if(a==="loadData"||!e)return;const o=d.current?.hotInstance;o&&e.forEach(async r=>{const[i,c,f,ee]=r,j=o.getSourceDataAtRow(i);if(j&&j.id){const te=`${x}/${n}/${j.id}/${c}`;await m(te,ee)}})},Z=async()=>{const e=d.current.hotInstance;if(e&&y.current!==null&&e?.getPlugin("filters")){const r=e.getData()[y.current][s.keyId],i=l("delete_confirm_message_simple");window.confirm(i)&&m(`${s.baseUrl}/${n}/${r}`,null)}},b=e=>{v(e.target.name,e.target.value)};function J(e,a){v("edDate",a),A("edDate")}const X=h?.edTitle?t.jsx("div",{className:"sm:grid-cols-12 md:grid-cols-12 lg:grid-cols-12 xl:grid-cols-12",children:t.jsx("p",{className:"error",children:h.edTitle?.message})}):"";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx(ye,{id:"columns1",name:"columns1",placeholder:l("search_column"),control:p,className:"dark:bg-dark-900",defaultValue:s.selectDefault?s.selectDefault:"1",options:N,error:!!h.columns1,onChange:b}),t.jsx(V,{name:"filterField1",control:p,label:l("search"),placeholder:l("search_placeholder"),variant:"filled",margin:"none",onKeyUp:$,onChange:b}),t.jsx(xe,{control:p,id:"edDate",name:"edDate",label:l("registration_date"),placeholder:l("date_input_placeholder"),onChange:J}),t.jsxs("div",{children:[t.jsx(T,{htmlFor:"edTitle",children:l("registration_title")}),t.jsx(V,{name:"edTitle",label:l("title"),placeholder:l("title_input_placeholder"),variant:"filled",onChange:b,error:!!h.edTitle})]})]}),X,t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2 items-end",children:[t.jsx(T,{className:"align-middle pt-2 md:pt-0 text-right md:text-left",children:l("count")+" : "+ie(W)}),t.jsx(De,{onInsert:K,onDelete:Z,onReload:L,onCsvSave:Y})]}),t.jsx("div",{style:{maxHeight:`${C}- 200`,overflow:"auto"},children:t.jsx(ce,{ref:d,data:O,className:H,rowHeaders:!0,colHeaders:s.columns.map(e=>l(e.title)),autoWrapRow:!0,height:C-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:Q,afterSelection:e=>{y.current=e},afterFilter:()=>{w(d.current?.hotInstance.countRows()||0)},licenseKey:"non-commercial-and-evaluation",columns:k,cells:(e,a)=>s.columns[a].readOnly===!0?{readOnly:!0}:{},colWidths:s.colWidths,manualColumnResize:!0,filters:!0,dropdownMenu:!0,stretchH:"last",hiddenColumns:R})})]})},Re=()=>{const{user:s}=he(),{t:n}=_();return!s||s?.uid===void 0?t.jsx("div",{className:"flex flex-col items-center w-full mt-[50px] mb-[100px]",children:t.jsx(T,{children:n("login_required")})}):t.jsx(t.Fragment,{children:t.jsx(pe,{csvFileName:"exported_todo",baseUrl:"todo",columns:M,colWidths:we,selectDefault:"1",keyId:M.length-1,userId:s?.uid})})};export{Re as default};
