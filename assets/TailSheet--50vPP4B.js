import{j as o,r as m,P as ee,cP as W,q as te,o as oe,n as u,am as ne,O as x,Y as se,Z as le,t as f,A as re}from"./index-x9uRvfkR.js";import{I as ae,T as H}from"./InputField-DInebggm.js";import{H as ie,r as ce}from"./registry-CPJ_rcL-.js";import{D as de}from"./datetime-BDx6lZXm.js";import{a as ue}from"./index.esm-Cn_lIKqV.js";import{S as fe}from"./Select-BIZF0Xyi.js";import{n as me}from"./handson-DdAkNqUh.js";import{T as C}from"./TailButton-CSvNk1h6.js";const ge=a=>o.jsxs("div",{className:"my-2 flex justify-end items-center",sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[o.jsx(C,{size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:a.onInsert,children:"추가"}),o.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"error",className:"mr-2",onClick:a.onDelete,children:"삭제"}),o.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"success",className:"mr-2",onClick:a.onReload,children:"리로드"}),o.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:a.onCsvSave,children:"csv저장"})]});ce();const he=({csvFileName:a="exported_sheet",baseUrl:g="sheet",columns:y,selectDefault:w="1",keyId:z,userId:p})=>{const i=m.useRef(null),v=m.useRef(null),[I,V]=m.useState(),[_,b]=m.useState(0),{height:P}=ee(),{settings:R,changeColWidths:B}=W(),K={edTitle:"",edDate:de.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd")},{register:O,reset:ye,control:S,setValue:F,getValues:D,formState:{errors:A}}=ue({mode:"submit ",defaultValues:K}),{theme:M}=W(),L=M==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",q=async e=>{console.log("onFunPost.data=",e.id,e);const t=`${g}/${p}/`;if(e.id===void 0){const n=se(le(u(f),t)).key;console.log("onFunPost.newKey",n),e.id=n}return x(u(f,t+e.id+"/dv"),e.dv),x(u(f,t+e.id+"/title"),e.title),x(u(f,t+e.id+"/t1"),e.t1),x(u(f,t+e.id+"/t2"),e.t2),x(u(f,t+e.id+"/ing"),"1"),e},G=async()=>{const e=`${g}/${p}/`,t=te(u(f,e),oe("dv"));ne(t,n=>{if(!n.exists())return;const l=n.val(),r=[];for(let c in l){const s=l[c];s.id=c,s.sort=`${s.dv}_${s.title}`,r.push(s)}r.sort((c,s)=>c.sort>s.sort?1:-1),V(r),b(r.length)})};m.useEffect(()=>{O("filterField1"),F("columns1",w)},[]),m.useEffect(()=>{p!==void 0&&G()},[p]),m.useEffect(()=>{i.current.hotInstance.addHook("afterColumnResize",function(t,n){const l=R.colWidths;l[n]=t,B(l)})},[i.current]);const U=async()=>{$()},Z=async()=>{i.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:a,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},k=[],E={indicators:!0},N=[];y.map((e,t)=>{e.select&&k.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&N.push(t)}),E.columns=N;const $=()=>{try{const e=i.current?.hotInstance,t=e?.getPlugin("filters");if(t){const n=D("columns1");console.log("onKeyUp.columns1=",n,"text=",D("filterField1")),y.forEach((c,s)=>{t?.removeConditions(s)}),t?.addCondition(Number(n),"contains",[D("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",i.current);const r=e.getData().length;b(r)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function Y(){const e=i.current.hotInstance;console.log("onInsert:",e),e.alter("insert_row_above",0,1)}const J=async(e,t)=>{if(console.log("afterChange.change=",e,", source=",t,", change.length=",e?.length),e!==null){const n=i.current?.hotInstance;if(n?.getPlugin("filters")){const r=n.getData(),c=[];e.forEach((s,j)=>{const h={};console.log("afterChange.index1=",j,", item1=",s[0]),y.forEach((d,X)=>{console.log("afterChange.filteredData=",r[s[0]],d),h[d.data]=r[s[0]][X]}),console.log("afterChange.tmp=",h),c.push(h)}),console.log("afterChange.saveData=",c),c.forEach(async(s,j)=>{console.log("afterChange.item=",s);const h=await q(s);console.log("afterChange.result=",j,", result=",h),I.map(d=>{(d.id===void 0||d.id===null)&&(console.log("afterChange.rowData1=",d),d.id=h?.id,console.log("afterChange.rowData2=",d))})}),n.render()}}},Q=async()=>{const e=i.current.hotInstance;if(console.log("onDelete:",e),e&&v.current!==null){if(e?.getPlugin("filters")){const n=e.getData();console.log("onDelete.filteredData=",n[v.current]);const l=n[v.current][z];console.log("onDelete.deleteId=",l),window.confirm("삭제하시겠습니까?")&&x(u(f,`${g}/${p}/${l}`),null)}e.alter("remove_row",v.current,1)}},T=e=>{const t=e.target.value;console.log("onChange.target=",e.target.value),F(e.target.name,t)};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[o.jsx(fe,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",control:S,className:"dark:bg-dark-900",defaultValue:w||"1",options:k,error:!!A.columns1,onChange:T}),o.jsx(ae,{name:"filterField1",control:S,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",onKeyUp:$,onChange:T})]}),o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[o.jsx(H,{textAlign:"left",children:"건수 : "+me(_)}),o.jsx(ge,{onInsert:Y,onDelete:Q,onReload:U,onCsvSave:Z})]}),o.jsx("div",{style:{maxHeight:`${P}- 200`,overflow:"auto"},children:o.jsx(ie,{ref:i,data:I,themeName:L,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:P-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:J,afterSelection:e=>{v.current=e},licenseKey:"non-commercial-and-evaluation",columns:y,cells:(e,t)=>y[t].readOnly===!0?{readOnly:!0}:{},colWidths:R.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:E})})]})};function Pe(){const{user:a}=re(),g=[{title:"구분",data:"dv",readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"설명1",type:"text",data:"t1",select:!0},{title:"설명2",type:"text",data:"t2",select:!0},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"진행중",type:"text",data:"ing",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];return a===void 0?o.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:o.jsx(H,{children:"로그인을 해야 이용 가능합니다."})}):o.jsx(he,{csvFileName:"exported_sheet",baseUrl:"sheet",columns:g,selectDefault:"1",keyId:g.length-1,userId:a?.uid})}export{Pe as default};
