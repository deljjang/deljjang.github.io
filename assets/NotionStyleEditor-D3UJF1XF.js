import{ck as re,S as Hc,cl as Op,cm as bp,cn as xp,co as _p,cp as Br,cq as Lp,cr as Fp,cs as Up,ct as Pp,cu as Dp,cv as Vp,cw as Bp,cx as kp,cy as Gp,cz as Hp,cA as Wp,cB as zp,cC as jp,cD as Yp,cE as Wc,cF as $p,cG as Xp,cH as zc,cI as Ra,cJ as Kp,cK as qp,cL as jc,cM as Qp,cN as Zp,cO as Yc,cP as Jp,cQ as em,cR as $c,cS as tm,cT as zu,cU as rm,cV as nm,cW as sm,cX as im,cY as am,cZ as om,c_ as um,c$ as lm,d0 as cm,d1 as hm,d2 as dm,d3 as fm,d4 as pm,d5 as mm,d6 as gm,d7 as Em,d8 as Rm,d9 as ym,da as Nm,db as Tm,dc as vm,dd as Sm,de as Am,df as Cm,dg as wm,dh as Im,di as Mm,dj as Om,dk as bm,dl as xm,dm as _m,dn as Lm,dp as Fm,dq as Um,dr as Pm,ds as Dm,dt as Vm,du as Bm,dv as km,dw as Gm,dx as Hm,dy as Wm,dz as zm,dA as jm,dB as Ym,dC as $m,dD as Xm,dE as Km,dF as qm,dG as Qm,dH as Zm,dI as Jm,dJ as eg,dK as tg,dL as rg,dM as ng,dN as sg,dO as ig,dP as ag,dQ as og,dR as ug,dS as lg,dT as cg,dU as hg,dV as dg,dW as fg,dX as pg,dY as mg,dZ as gg,d_ as Eg,d$ as Rg,e0 as yg,e1 as Ng,a0 as Xc,r as C,j as N,Q as Tg,e2 as vg,q as Kc,h as $o,n as Sg,I as Ag,cj as qc,bf as Zn,y as Zt,k as yt,aK as Ns,O as Cg,e3 as wg,J as ju,a2 as oi,bJ as an,e4 as Ig,b$ as Qc,cc as Mg,G as Og,c4 as Yu,c5 as $u,ca as bg,c9 as xg,c6 as _g}from"./index-DAHv2Xmi.js";import{M as Lg,b as Fg}from"./HtmlCode-Cu7MldRx.js";function Ug(s){const e=typeof window>"u"?!1:window.jQuery;e&&(e.fn.handsontable=function(t){const r=this.first();let n=r.data("handsontable");if(typeof t!="string"){const l=t||{};return n?n.updateSettings(l):(n=new s.Core(r[0],l),r.data("handsontable",n),n.init()),r}let i;if(n)if(typeof n[t]<"u"){for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];i=n[t].call(n,...o),t==="destroy"&&r.removeData()}else throw new Error(`Handsontable do not provide action: ${t}`);return i})}var Va,Ba,ka,Ga,Ha;Hc();Ug(re);re.__GhostTable=Op;re._getListenersCounter=bp;re._getRegisteredMapsCounter=xp;re.EventManager=_p;const Pg=[Lp,Fp,Up,Pp,Dp,Vp,Bp,kp,Gp,Hp,Wp,zp],Dg=[jp,Yp];re.helper={};re.dom={};Br(Pg,s=>{Br(Object.getOwnPropertyNames(s),e=>{e.charAt(0)!=="_"&&(re.helper[e]=s[e])})});Br(Dg,s=>{Br(Object.getOwnPropertyNames(s),e=>{e.charAt(0)!=="_"&&(re.dom[e]=s[e])})});re.cellTypes=(Va=re.cellTypes)!==null&&Va!==void 0?Va:{};Br($p(),s=>{re.cellTypes[s]=Wc(s)});re.cellTypes.registerCellType=Xp;re.cellTypes.getCellType=Wc;re.editors=(Ba=re.editors)!==null&&Ba!==void 0?Ba:{};Br(Kp(),s=>{re.editors[`${Ra(s)}Editor`]=zc(s)});re.editors.registerEditor=qp;re.editors.getEditor=zc;re.renderers=(ka=re.renderers)!==null&&ka!==void 0?ka:{};Br(Qp(),s=>{const e=jc(s);s==="base"&&(re.renderers.cellDecorator=e),re.renderers[`${Ra(s)}Renderer`]=e});re.renderers.registerRenderer=Zp;re.renderers.getRenderer=jc;re.validators=(Ga=re.validators)!==null&&Ga!==void 0?Ga:{};Br(Jp(),s=>{re.validators[`${Ra(s)}Validator`]=Yc(s)});re.validators.registerValidator=em;re.validators.getValidator=Yc;re.plugins=(Ha=re.plugins)!==null&&Ha!==void 0?Ha:{};Br(tm(),s=>{re.plugins[s]=$c(s)});re.plugins[`${Ra(zu.PLUGIN_KEY)}Plugin`]=zu;re.plugins.registerPlugin=rm;re.plugins.getPlugin=$c;/**
 * @preserve
 * Authors: Hwang, Gun-gu
 * Last updated: Aug 20, 2018
 *
 * Description: Definition file for Korean - Korea language-country.
 */const Vg={languageCode:"ko-KR",[Ng]:"위쪽에 행 삽입",[yg]:"아래쪽에 행 삽입",[Rg]:"왼쪽에 열 삽입",[Eg]:"오른쪽에 열 삽입",[gg]:["행 삭제","여러 행 삭제"],[mg]:["열 삭제","여러 열 삭제"],[pg]:"되돌리기",[fg]:"다시하기",[dg]:"읽기 전용",[hg]:"열 지우기",[cg]:"정렬",[lg]:"왼쪽",[ug]:"중앙",[og]:"오른쪽",[ag]:"자동",[ig]:"위쪽",[sg]:"가운데",[ng]:"아래쪽",[rg]:"열 고정",[tg]:"열 고정 해제",[eg]:"테두리",[Jm]:"위쪽",[Zm]:"오른쪽",[Qm]:"아래쪽",[qm]:"왼쪽",[Km]:"테두리 지우기",[Xm]:"댓글 달기",[$m]:"댓글 편집",[Ym]:"댓글 삭제",[jm]:"읽기 전용 댓글",[zm]:"셀 병합",[Wm]:"셀 병합 해제",[Hm]:"복사",[Gm]:"잘라내기",[km]:"자녀 행 추가",[Bm]:"부모행에서 제거",[Vm]:["열 숨기기","여러 열 숨기기"],[Dm]:["열 숨기기 해제","여러 열 숨기기 해제"],[Pm]:["행 숨기기","여러 행 숨기기"],[Um]:["행 숨기기 해제","여러 행 숨기기 해제"],[Fm]:"조건없음",[Lm]:"비어있음",[_m]:"비어있지 않음",[xm]:"같",[bm]:"같지 않음",[Om]:"시작 문자",[Mm]:"끝 문자",[Im]:"포함",[wm]:"포함하지 않음",[Cm]:"보다 큼",[Am]:"크거나 같음",[Sm]:"보다 작",[vm]:"작거나 같음",[Tm]:"사이",[Nm]:"사이 제외",[ym]:"다음",[Rm]:"전",[Em]:"오늘",[gm]:"내일",[mm]:"어제",[pm]:"공란",[fm]:"조건부 필터",[dm]:"값 필터",[hm]:"그리고",[cm]:"또는",[lm]:"전체선택",[um]:"지우기",[om]:"확인",[am]:"취소",[im]:"찾기",[sm]:"값",[nm]:"두번째 값"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Be;(function(s){s.RELATIVE="RELATIVE",s.ABSOLUTE="ABSOLUTE"})(Be||(Be={}));class Rt{constructor(e,t,r){this.type=e,this.col=t,this.sheet=r}static absolute(e,t){return new Rt(Be.ABSOLUTE,e,t)}static relative(e,t){return new Rt(Be.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleColumnAddress(e).col-r.toSimpleColumnAddress(e).col}isColumnAbsolute(){return this.type===Be.ABSOLUTE}isColumnRelative(){return this.type===Be.RELATIVE}isAbsolute(){return this.type===Be.ABSOLUTE&&this.sheet!==void 0}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new Rt(this.type,this.col+t,n)}shiftedByColumns(e){return new Rt(this.type,this.col+e,this.sheet)}toSimpleColumnAddress(e){const t=hr(this,e);let r=this.col;return this.isColumnRelative()&&(r=e.col+this.col),Cd(t,r)}shiftRelativeDimensions(e,t){const r=this.isColumnRelative()?this.col+e:this.col;return new Rt(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnAbsolute()?this.col+e:this.col;return new Rt(this.type,r,this.sheet)}withSheet(e){return new Rt(this.type,this.col,e)}isInvalid(e){return this.toSimpleColumnAddress(e).col<0}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case Be.RELATIVE:return`${t}#COLR${this.col}`;case Be.ABSOLUTE:return`${t}#COLA${this.col}`}}unparse(e){const t=this.toSimpleColumnAddress(e);if(yN(t))return;const r=Na(t.col);return`${this.type===Be.ABSOLUTE?"$":""}${r}`}exceedsSheetSizeLimits(e){return this.col>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mt{constructor(e,t,r){this.type=e,this.row=t,this.sheet=r}static absolute(e,t){return new mt(Be.ABSOLUTE,e,t)}static relative(e,t){return new mt(Be.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleRowAddress(e).row-r.toSimpleRowAddress(e).row}isRowAbsolute(){return this.type===Be.ABSOLUTE}isRowRelative(){return this.type===Be.RELATIVE}isAbsolute(){return this.type===Be.ABSOLUTE&&this.sheet!==void 0}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new mt(this.type,this.row+r,n)}shiftedByRows(e){return new mt(this.type,this.row+e,this.sheet)}toSimpleRowAddress(e){const t=hr(this,e);let r=this.row;return this.isRowRelative()&&(r=e.row+this.row),Ad(t,r)}shiftRelativeDimensions(e,t){const r=this.isRowRelative()?this.row+t:this.row;return new mt(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isRowAbsolute()?this.row+t:this.row;return new mt(this.type,r,this.sheet)}withSheet(e){return new mt(this.type,this.row,e)}isInvalid(e){return this.toSimpleRowAddress(e).row<0}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case Be.RELATIVE:return`${t}#ROWR${this.row}`;case Be.ABSOLUTE:return`${t}#ROWA${this.row}`}}unparse(e){const t=this.toSimpleRowAddress(e);return RN(t)?void 0:`${this.type===Be.ABSOLUTE?"$":""}${t.row+1}`}exceedsSheetSizeLimits(e){return this.row>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Re;(function(s){s.CELL_REFERENCE_RELATIVE="CELL_REFERENCE",s.CELL_REFERENCE_ABSOLUTE="CELL_REFERENCE_ABSOLUTE",s.CELL_REFERENCE_ABSOLUTE_COL="CELL_REFERENCE_ABSOLUTE_COL",s.CELL_REFERENCE_ABSOLUTE_ROW="CELL_REFERENCE_ABSOLUTE_ROW"})(Re||(Re={}));class Ce{constructor(e,t,r,n){this.col=e,this.row=t,this.type=r,this.sheet=n}static fromColAndRow(e,t,r){return(e.isColumnAbsolute()&&t.isRowAbsolute()?Ce.absolute.bind(this):e.isColumnAbsolute()?Ce.absoluteCol.bind(this):t.isRowAbsolute()?Ce.absoluteRow.bind(this):Ce.relative.bind(this))(e.col,t.row,r)}static relative(e,t,r){return new Ce(e,t,Re.CELL_REFERENCE_RELATIVE,r)}static absolute(e,t,r){return new Ce(e,t,Re.CELL_REFERENCE_ABSOLUTE,r)}static absoluteCol(e,t,r){return new Ce(e,t,Re.CELL_REFERENCE_ABSOLUTE_COL,r)}static absoluteRow(e,t,r){return new Ce(e,t,Re.CELL_REFERENCE_ABSOLUTE_ROW,r)}toSimpleCellAddress(e){const t=hr(this,e);return this.type===Re.CELL_REFERENCE_ABSOLUTE?U(t,this.col,this.row):this.type===Re.CELL_REFERENCE_ABSOLUTE_ROW?U(t,e.col+this.col,this.row):this.type===Re.CELL_REFERENCE_ABSOLUTE_COL?U(t,this.col,e.row+this.row):U(t,e.col+this.col,e.row+this.row)}toColumnAddress(){const e=this.isColumnRelative()?Be.RELATIVE:Be.ABSOLUTE;return new Rt(e,this.col,this.sheet)}toRowAddress(){const e=this.isRowRelative()?Be.RELATIVE:Be.ABSOLUTE;return new mt(e,this.row,this.sheet)}toSimpleColumnAddress(e){const t=hr(this,e);let r=this.col;return this.isColumnRelative()&&(r+=e.col),Cd(t,r)}toSimpleRowAddress(e){const t=hr(this,e);let r=this.row;return this.isRowRelative()&&(r+=e.row),Ad(t,r)}isRowAbsolute(){return this.type===Re.CELL_REFERENCE_ABSOLUTE||this.type===Re.CELL_REFERENCE_ABSOLUTE_ROW}isColumnAbsolute(){return this.type===Re.CELL_REFERENCE_ABSOLUTE||this.type===Re.CELL_REFERENCE_ABSOLUTE_COL}isColumnRelative(){return this.type===Re.CELL_REFERENCE_RELATIVE||this.type===Re.CELL_REFERENCE_ABSOLUTE_ROW}isRowRelative(){return this.type===Re.CELL_REFERENCE_RELATIVE||this.type===Re.CELL_REFERENCE_ABSOLUTE_COL}isAbsolute(){return this.type===Re.CELL_REFERENCE_ABSOLUTE&&this.sheet!==void 0}shiftedByRows(e){return new Ce(this.col,this.row+e,this.type,this.sheet)}shiftedByColumns(e){return new Ce(this.col+e,this.row,this.type,this.sheet)}moved(e,t,r){const n=this.sheet===void 0?void 0:e;return new Ce(this.col+t,this.row+r,this.type,n)}withSheet(e){return new Ce(this.col,this.row,this.type,e)}isInvalid(e){return Ct(this.toSimpleCellAddress(e))}shiftRelativeDimensions(e,t){const r=this.isColumnAbsolute()?this.col:this.col+e,n=this.isRowAbsolute()?this.row:this.row+t;return new Ce(r,n,this.type,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnRelative()?this.col:this.col+e,n=this.isRowRelative()?this.row:this.row+t;return new Ce(r,n,this.type,this.sheet)}hash(e){const t=e&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case Re.CELL_REFERENCE_RELATIVE:return`${t}#${this.row}R${this.col}`;case Re.CELL_REFERENCE_ABSOLUTE:return`${t}#${this.row}A${this.col}`;case Re.CELL_REFERENCE_ABSOLUTE_COL:return`${t}#${this.row}AC${this.col}`;case Re.CELL_REFERENCE_ABSOLUTE_ROW:return`${t}#${this.row}AR${this.col}`}}unparse(e){const t=this.toSimpleCellAddress(e);if(Ct(t))return;const r=Na(t.col),n=this.type===Re.CELL_REFERENCE_ABSOLUTE||this.type===Re.CELL_REFERENCE_ABSOLUTE_ROW?"$":"";return`${this.type===Re.CELL_REFERENCE_ABSOLUTE||this.type===Re.CELL_REFERENCE_ABSOLUTE_COL?"$":""}${r}${n}${t.row+1}`}exceedsSheetSizeLimits(e,t){return this.row>=t||this.col>=e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Zs=":",Nt="$",Bg="\\s+",kg="[ \\t\\n\\r]+",ya="A-Za-zÀ-ʯ",Xo=`${ya}0-9_.`,Zc=`[${ya}0-9_]+`,Gg="'(((?!').|'')*)'",ns=`(${Zc}|${Gg})!`,Jc=`(${ns})?\\${Nt}?[A-Za-z]+\\${Nt}?[0-9]+`,Xu=`(${ns})?\\${Nt}?[A-Za-z]+`,Ku=`(${ns})?\\${Nt}?[0-9]+`,eh="[rR][0-9]*[cC][0-9]*",Hg=`(${Jc})[^${Xo}]`,th=`[${ya}_][${Xo}]*`,Wg=["0","1","2","3","4","5","6","7","8","9"],rh=[...Array.from(Array(26)).map((s,e)=>e+65),...Array.from(Array(26)).map((s,e)=>e+97),...Array.from(Array(496)).map((s,e)=>e+192)].map(s=>String.fromCharCode(s));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const nh=new RegExp(`^(${ns})?(\\${Nt}?)([A-Za-z]+)(\\${Nt}?)([0-9]+)$`),zg=new RegExp(`^(${ns})?(\\${Nt}?)([A-Za-z]+)$`),jg=new RegExp(`^(${ns})?(\\${Nt}?)([0-9]+)$`),Yg=new RegExp(`^${Zc}$`),Un=(s,e,t)=>{const r=nh.exec(e),n=Ko(r[6]);let i=Ta(r,s);if(i===void 0)return;i===null&&(i=void 0);const a=Number(r[8])-1;return r[5]===Nt&&r[7]===Nt?Ce.absolute(n,a,i):r[5]===Nt?Ce.absoluteCol(n,a-t.row,i):r[7]===Nt?Ce.absoluteRow(n-t.col,a,i):Ce.relative(n-t.col,a-t.row,i)},Hi=(s,e,t)=>{const r=zg.exec(e);let n=Ta(r,s);if(n===void 0)return;n===null&&(n=void 0);const i=Ko(r[6]);return r[5]===Nt?Rt.absolute(i,n):Rt.relative(i-t.col,n)},Wi=(s,e,t)=>{const r=jg.exec(e);let n=Ta(r,s);if(n===void 0)return;n===null&&(n=void 0);const i=Number(r[6])-1;return r[5]===Nt?mt.absolute(i,n):mt.relative(i-t.row,n)},uo=(s,e,t)=>{const r=nh.exec(e);if(!r)return;const n=Ko(r[6]);let i=Ta(r,s);if(i===void 0)return;i===null&&(i=t);const a=Number(r[8])-1;return U(i,n,a)},$g=(s,e,t)=>{const r=e.split(Zs);if(r.length!==2)return;const[n,i]=r,a=uo(s,n,t);if(a===void 0)return;const o=uo(s,i,a.sheet);if(o!==void 0&&a.sheet===o.sheet)return Ao(a,o)},zi=(s,e,t)=>{const r=Na(e.col),n=sh(e.sheet,s);if(n!==void 0)return t!==e.sheet?`${n}!${r}${e.row+1}`:`${r}${e.row+1}`},Xg=(s,e,t)=>{const r=zi(s,e.start,t),n=zi(s,e.end,e.start.sheet);if(!(r===void 0||n===void 0))return`${r}${Zs}${n}`};function Ko(s){return s.length===1?s.toUpperCase().charCodeAt(0)-65:s.split("").reduce((e,t)=>e*26+(t.toUpperCase().charCodeAt(0)-64),0)-1}function Na(s){let e="";for(;s>=0;)e=String.fromCharCode(s%26+97)+e,s=Math.floor(s/26)-1;return e.toUpperCase()}function sh(s,e){let t=e(s);if(t!==void 0)return Yg.test(t)?t:(t=t.replace(/'/g,"''"),`'${t}'`)}function Ta(s,e){var t;let r=(t=s[3])!==null&&t!==void 0?t:s[2];return r?(r=r.replace(/''/g,"'"),e(r)):null}function we(s){return s&&s.length===0}function Gr(s){return s==null?[]:Object.keys(s)}function gt(s){for(var e=[],t=Object.keys(s),r=0;r<t.length;r++)e.push(s[t[r]]);return e}function Kg(s,e){for(var t=[],r=Gr(s),n=0;n<r.length;n++){var i=r[n];t.push(e.call(null,s[i],i))}return t}function B(s,e){for(var t=[],r=0;r<s.length;r++)t.push(e.call(null,s[r],r));return t}function Mt(s){for(var e=[],t=0;t<s.length;t++){var r=s[t];Array.isArray(r)?e=e.concat(Mt(r)):e.push(r)}return e}function er(s){return we(s)?void 0:s[0]}function ih(s){var e=s&&s.length;return e?s[e-1]:void 0}function $(s,e){if(Array.isArray(s))for(var t=0;t<s.length;t++)e.call(null,s[t],t);else if(Qo(s))for(var r=Gr(s),t=0;t<r.length;t++){var n=r[t],i=s[n];e.call(null,i,n)}else throw Error("non exhaustive match")}function wr(s){return typeof s=="string"}function tr(s){return s===void 0}function on(s){return s instanceof Function}function ct(s,e){return e===void 0&&(e=1),s.slice(e,s.length)}function ks(s,e){return e===void 0&&(e=1),s.slice(0,s.length-e)}function fr(s,e){var t=[];if(Array.isArray(s))for(var r=0;r<s.length;r++){var n=s[r];e.call(null,n)&&t.push(n)}return t}function Sn(s,e){return fr(s,function(t){return!e(t)})}function sr(s,e){for(var t=Object.keys(s),r={},n=0;n<t.length;n++){var i=t[n],a=s[i];e(a)&&(r[i]=a)}return r}function Y(s,e){return Qo(s)?s.hasOwnProperty(e):!1}function Qe(s,e){return Jn(s,function(t){return t===e})!==void 0}function Ot(s){for(var e=[],t=0;t<s.length;t++)e.push(s[t]);return e}function Js(s){var e={};for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t]);return e}function Jn(s,e){for(var t=0;t<s.length;t++){var r=s[t];if(e.call(null,r))return r}}function qg(s,e){for(var t=[],r=0;r<s.length;r++){var n=s[r];e.call(null,n)&&t.push(n)}return t}function dt(s,e,t){for(var r=Array.isArray(s),n=r?s:gt(s),i=r?[]:Gr(s),a=t,o=0;o<n.length;o++)a=e.call(null,a,n[o],r?o:i[o]);return a}function ei(s){return Sn(s,function(e){return e==null})}function qo(s,e){e===void 0&&(e=function(r){return r});var t=[];return dt(s,function(r,n){var i=e(n);return Qe(t,i)?r:(t.push(i),r.concat(n))},[])}function cr(s){return Array.isArray(s)}function kr(s){return s instanceof RegExp}function Qo(s){return s instanceof Object}function Jt(s,e){for(var t=0;t<s.length;t++)if(!e(s[t],t))return!1;return!0}function va(s,e){return Sn(s,function(t){return Qe(e,t)})}function ah(s,e){for(var t=0;t<s.length;t++)if(e(s[t]))return!0;return!1}function Qg(s,e){for(var t=0;t<s.length;t++)if(s[t]===e)return t;return-1}function pr(s){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r++)for(var n=e[r],i=Gr(n),a=0;a<i.length;a++){var o=i[a];s[o]=n[o]}return s}function Zg(s){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0;r<e.length;r++){var n=e[r];if(!tr(n))for(var i=Gr(n),a=0;a<i.length;a++){var o=i[a];Y(s,o)||(s[o]=n[o])}}return s}function Sa(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return Zg.apply(null,[{}].concat(s))}function oh(s,e){var t={};return $(s,function(r){var n=e(r),i=t[n];i?i.push(r):t[n]=[r]}),t}function qu(s,e){for(var t=Js(s),r=Gr(e),n=0;n<r.length;n++){var i=r[n],a=e[i];t[i]=a}return t}function Je(){}function Qu(s){return s}function Jg(s){for(var e=[],t=0;t<s.length;t++){var r=s[t];e.push(r!==void 0?r:void 0)}return e}function lo(s){console&&console.error&&console.error("Error: "+s)}function Zo(s){console&&console.warn&&console.warn("Warning: "+s)}function Zu(){return typeof Map=="function"}function eE(s,e){e.forEach(function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach(function(n){if(n!=="constructor"){var i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(s.prototype,n,i):s.prototype[n]=t.prototype[n]}})})}function uh(s){function e(){}e.prototype=s;var t=new e;function r(){return typeof t.bar}return r(),r(),s}function ji(s){return s[s.length-1]}function lh(s){var e=new Date().getTime(),t=s(),r=new Date().getTime(),n=r-e;return{time:n,value:t}}var Mi={exports:{}},tE=Mi.exports,Ju;function rE(){return Ju||(Ju=1,function(s){(function(e,t){s.exports?s.exports=t():e.regexpToAst=t()})(typeof self<"u"?self:tE,function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(m){this.idx=m.idx,this.input=m.input,this.groupIdx=m.groupIdx},e.prototype.pattern=function(m){this.idx=0,this.input=m,this.groupIdx=0,this.consumeChar("/");var S=this.disjunction();this.consumeChar("/");for(var v={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":o(v,"global");break;case"i":o(v,"ignoreCase");break;case"m":o(v,"multiLine");break;case"u":o(v,"unicode");break;case"y":o(v,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:v,value:S}},e.prototype.disjunction=function(){var m=[];for(m.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),m.push(this.alternative());return{type:"Disjunction",value:m}},e.prototype.alternative=function(){for(var m=[];this.isTerm();)m.push(this.term());return{type:"Alternative",value:m}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var m;switch(this.popChar()){case"=":m="Lookahead";break;case"!":m="NegativeLookahead";break}u(m);var S=this.disjunction();return this.consumeChar(")"),{type:m,value:S}}l()},e.prototype.quantifier=function(m){var S;switch(this.popChar()){case"*":S={atLeast:0,atMost:1/0};break;case"+":S={atLeast:1,atMost:1/0};break;case"?":S={atLeast:0,atMost:1};break;case"{":var v=this.integerIncludingZero();switch(this.popChar()){case"}":S={atLeast:v,atMost:v};break;case",":var A;this.isDigit()?(A=this.integerIncludingZero(),S={atLeast:v,atMost:A}):S={atLeast:v,atMost:1/0},this.consumeChar("}");break}if(m===!0&&S===void 0)return;u(S);break}if(!(m===!0&&S===void 0))return u(S),this.peekChar(0)==="?"?(this.consumeChar("?"),S.greedy=!1):S.greedy=!0,S.type="Quantifier",S},e.prototype.atom=function(){var m;switch(this.peekChar()){case".":m=this.dotAll();break;case"\\":m=this.atomEscape();break;case"[":m=this.characterClass();break;case"(":m=this.group();break}return m===void 0&&this.isPatternCharacter()&&(m=this.patternCharacter()),u(m),this.isQuantifier()&&(m.quantifier=this.quantifier()),m},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[i(`
`),i("\r"),i("\u2028"),i("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var m=this.positiveInteger();return{type:"GroupBackReference",value:m}},e.prototype.characterClassEscape=function(){var m,S=!1;switch(this.popChar()){case"d":m=d;break;case"D":m=d,S=!0;break;case"s":m=p;break;case"S":m=p,S=!0;break;case"w":m=f;break;case"W":m=f,S=!0;break}return u(m),{type:"Set",value:m,complement:S}},e.prototype.controlEscapeAtom=function(){var m;switch(this.popChar()){case"f":m=i("\f");break;case"n":m=i(`
`);break;case"r":m=i("\r");break;case"t":m=i("	");break;case"v":m=i("\v");break}return u(m),{type:"Character",value:m}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var m=this.popChar();if(/[a-zA-Z]/.test(m)===!1)throw Error("Invalid ");var S=m.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:S}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:i("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var m=this.popChar();return{type:"Character",value:i(m)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var m=this.popChar();return{type:"Character",value:i(m)}}},e.prototype.characterClass=function(){var m=[],S=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),S=!0);this.isClassAtom();){var v=this.classAtom(),A=v.type==="Character";if(A&&this.isRangeDash()){this.consumeChar("-");var w=this.classAtom(),I=w.type==="Character";if(I){if(w.value<v.value)throw Error("Range out of order in character class");m.push({from:v.value,to:w.value})}else a(v.value,m),m.push(i("-")),a(w.value,m)}else a(v.value,m)}return this.consumeChar("]"),{type:"Set",complement:S,value:m}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:i("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var m=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),m=!1;break;default:this.groupIdx++;break}var S=this.disjunction();this.consumeChar(")");var v={type:"Group",capturing:m,value:S};return m&&(v.idx=this.groupIdx),v},e.prototype.positiveInteger=function(){var m=this.popChar();if(n.test(m)===!1)throw Error("Expecting a positive integer");for(;r.test(this.peekChar(0));)m+=this.popChar();return parseInt(m,10)},e.prototype.integerIncludingZero=function(){var m=this.popChar();if(r.test(m)===!1)throw Error("Expecting an integer");for(;r.test(this.peekChar(0));)m+=this.popChar();return parseInt(m,10)},e.prototype.patternCharacter=function(){var m=this.popChar();switch(m){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:i(m)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},e.prototype.isDigit=function(){return r.test(this.peekChar(0))},e.prototype.isClassAtom=function(m){switch(m===void 0&&(m=0),this.peekChar(m)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}},e.prototype.isQuantifier=function(){var m=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(m)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(m){for(var S="",v=0;v<m;v++){var A=this.popChar();if(t.test(A)===!1)throw Error("Expecting a HexDecimal digits");S+=A}var w=parseInt(S,16);return{type:"Character",value:w}},e.prototype.peekChar=function(m){return m===void 0&&(m=0),this.input[this.idx+m]},e.prototype.popChar=function(){var m=this.peekChar(0);return this.consumeChar(),m},e.prototype.consumeChar=function(m){if(m!==void 0&&this.input[this.idx]!==m)throw Error("Expected: '"+m+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t=/[0-9a-fA-F]/,r=/[0-9]/,n=/[1-9]/;function i(m){return m.charCodeAt(0)}function a(m,S){m.length!==void 0?m.forEach(function(v){S.push(v)}):S.push(m)}function o(m,S){if(m[S]===!0)throw"duplicate flag "+S;m[S]=!0}function u(m){if(m===void 0)throw Error("Internal Error - Should never get here!")}function l(){throw Error("Internal Error - Should never get here!")}var c,d=[];for(c=i("0");c<=i("9");c++)d.push(c);var f=[i("_")].concat(d);for(c=i("a");c<=i("z");c++)f.push(c);for(c=i("A");c<=i("Z");c++)f.push(c);var p=[i(" "),i("\f"),i(`
`),i("\r"),i("	"),i("\v"),i("	"),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i("\u2028"),i("\u2029"),i(" "),i(" "),i("　"),i("\uFEFF")];function E(){}return E.prototype.visitChildren=function(m){for(var S in m){var v=m[S];m.hasOwnProperty(S)&&(v.type!==void 0?this.visit(v):Array.isArray(v)&&v.forEach(function(A){this.visit(A)},this))}},E.prototype.visit=function(m){switch(m.type){case"Pattern":this.visitPattern(m);break;case"Flags":this.visitFlags(m);break;case"Disjunction":this.visitDisjunction(m);break;case"Alternative":this.visitAlternative(m);break;case"StartAnchor":this.visitStartAnchor(m);break;case"EndAnchor":this.visitEndAnchor(m);break;case"WordBoundary":this.visitWordBoundary(m);break;case"NonWordBoundary":this.visitNonWordBoundary(m);break;case"Lookahead":this.visitLookahead(m);break;case"NegativeLookahead":this.visitNegativeLookahead(m);break;case"Character":this.visitCharacter(m);break;case"Set":this.visitSet(m);break;case"Group":this.visitGroup(m);break;case"GroupBackReference":this.visitGroupBackReference(m);break;case"Quantifier":this.visitQuantifier(m);break}this.visitChildren(m)},E.prototype.visitPattern=function(m){},E.prototype.visitFlags=function(m){},E.prototype.visitDisjunction=function(m){},E.prototype.visitAlternative=function(m){},E.prototype.visitStartAnchor=function(m){},E.prototype.visitEndAnchor=function(m){},E.prototype.visitWordBoundary=function(m){},E.prototype.visitNonWordBoundary=function(m){},E.prototype.visitLookahead=function(m){},E.prototype.visitNegativeLookahead=function(m){},E.prototype.visitCharacter=function(m){},E.prototype.visitSet=function(m){},E.prototype.visitGroup=function(m){},E.prototype.visitGroupBackReference=function(m){},E.prototype.visitQuantifier=function(m){},{RegExpParser:e,BaseRegExpVisitor:E,VERSION:"0.4.0"}})}(Mi)),Mi.exports}var ti=rE(),Oi={},nE=new ti.RegExpParser;function Aa(s){var e=s.toString();if(Oi.hasOwnProperty(e))return Oi[e];var t=nE.pattern(e);return Oi[e]=t,t}function sE(){Oi={}}var iE=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ch="Complement Sets are not supported for first char optimization",Yi=`Unable to use "first char" lexer optimizations:
`;function aE(s,e){e===void 0&&(e=!1);try{var t=Aa(s),r=co(t.value,{},t.flags.ignoreCase);return r}catch(i){if(i.message===ch)e&&Zo(""+Yi+("	Unable to optimize: < "+s.toString()+` >
`)+`	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{var n="";e&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),lo(Yi+`
`+("	Failed parsing: < "+s.toString()+` >
`)+("	Using the regexp-to-ast library version: "+ti.VERSION+`
`)+"	Please open an issue at: https://github.com/bd82/regexp-to-ast/issues"+n)}}return[]}function co(s,e,t){switch(s.type){case"Disjunction":for(var r=0;r<s.value.length;r++)co(s.value[r],e,t);break;case"Alternative":for(var n=s.value,r=0;r<n.length;r++){var i=n[r];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var a=i;switch(a.type){case"Character":ui(a.value,e,t);break;case"Set":if(a.complement===!0)throw Error(ch);$(a.value,function(l){if(typeof l=="number")ui(l,e,t);else{var c=l;if(t===!0)for(var d=c.from;d<=c.to;d++)ui(d,e,t);else{for(var d=c.from;d<=c.to&&d<Ts;d++)ui(d,e,t);if(c.to>=Ts)for(var f=c.from>=Ts?c.from:Ts,p=c.to,E=sn(f),m=sn(p),S=E;S<=m;S++)e[S]=S}}});break;case"Group":co(a.value,e,t);break;default:throw Error("Non Exhaustive Match")}var o=a.quantifier!==void 0&&a.quantifier.atLeast===0;if(a.type==="Group"&&ho(a)===!1||a.type!=="Group"&&o===!1)break}break;default:throw Error("non exhaustive match!")}return gt(e)}function ui(s,e,t){var r=sn(s);e[r]=r,t===!0&&oE(s,e)}function oE(s,e){var t=String.fromCharCode(s),r=t.toUpperCase();if(r!==t){var n=sn(r.charCodeAt(0));e[n]=n}else{var i=t.toLowerCase();if(i!==t){var n=sn(i.charCodeAt(0));e[n]=n}}}function el(s,e){return Jn(s.value,function(t){if(typeof t=="number")return Qe(e,t);var r=t;return Jn(e,function(n){return r.from<=n&&n<=r.to})!==void 0})}function ho(s){return s.quantifier&&s.quantifier.atLeast===0?!0:s.value?cr(s.value)?Jt(s.value,ho):ho(s.value):!1}var uE=function(s){iE(e,s);function e(t){var r=s.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return e.prototype.visitChildren=function(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}s.prototype.visitChildren.call(this,t)}},e.prototype.visitCharacter=function(t){Qe(this.targetCharCodes,t.value)&&(this.found=!0)},e.prototype.visitSet=function(t){t.complement?el(t,this.targetCharCodes)===void 0&&(this.found=!0):el(t,this.targetCharCodes)!==void 0&&(this.found=!0)},e}(ti.BaseRegExpVisitor);function Jo(s,e){if(e instanceof RegExp){var t=Aa(e),r=new uE(s);return r.visit(t),r.found}else return Jn(e,function(n){return Qe(s,n.charCodeAt(0))})!==void 0}var hh=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ir="PATTERN",Nn="defaultMode",li="modes",dh=typeof new RegExp("(?:)").sticky=="boolean";function lE(s,e){e=Sa(e,{useSticky:dh,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:function(A,w){return w()}});var t=e.tracer;t("initCharCodeToOptimizedIndexMap",function(){_E()});var r;t("Reject Lexer.NA",function(){r=Sn(s,function(A){return A[Ir]===It.NA})});var n=!1,i;t("Transform Patterns",function(){n=!1,i=B(r,function(A){var w=A[Ir];if(kr(w)){var I=w.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."?I:I.length===2&&I[0]==="\\"&&!Qe(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:e.useSticky?rl(w):tl(w)}else{if(on(w))return n=!0,{exec:w};if(Y(w,"exec"))return n=!0,w;if(typeof w=="string"){if(w.length===1)return w;var O=w.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),_=new RegExp(O);return e.useSticky?rl(_):tl(_)}else throw Error("non exhaustive match")}})});var a,o,u,l,c;t("misc mapping",function(){a=B(r,function(A){return A.tokenTypeIdx}),o=B(r,function(A){var w=A.GROUP;if(w!==It.SKIPPED){if(wr(w))return w;if(tr(w))return!1;throw Error("non exhaustive match")}}),u=B(r,function(A){var w=A.LONGER_ALT;if(w){var I=Qg(r,w);return I}}),l=B(r,function(A){return A.PUSH_MODE}),c=B(r,function(A){return Y(A,"POP_MODE")})});var d;t("Line Terminator Handling",function(){var A=mh(e.lineTerminatorCharacters);d=B(r,function(w){return!1}),e.positionTracking!=="onlyOffset"&&(d=B(r,function(w){if(Y(w,"LINE_BREAKS"))return w.LINE_BREAKS;if(ph(w,A)===!1)return Jo(A,w.PATTERN)}))});var f,p,E,m;t("Misc Mapping #2",function(){f=B(r,fh),p=B(i,OE),E=dt(r,function(A,w){var I=w.GROUP;return wr(I)&&I!==It.SKIPPED&&(A[I]=[]),A},{}),m=B(i,function(A,w){return{pattern:i[w],longerAlt:u[w],canLineTerminator:d[w],isCustom:f[w],short:p[w],group:o[w],push:l[w],pop:c[w],tokenTypeIdx:a[w],tokenType:r[w]}})});var S=!0,v=[];return e.safeMode||t("First Char Optimization",function(){v=dt(r,function(A,w,I){if(typeof w.PATTERN=="string"){var O=w.PATTERN.charCodeAt(0),_=sn(O);Wa(A,_,m[I])}else if(cr(w.START_CHARS_HINT)){var x;$(w.START_CHARS_HINT,function(G){var H=typeof G=="string"?G.charCodeAt(0):G,P=sn(H);x!==P&&(x=P,Wa(A,P,m[I]))})}else if(kr(w.PATTERN))if(w.PATTERN.unicode)S=!1,e.ensureOptimizations&&lo(""+Yi+("	Unable to analyze < "+w.PATTERN.toString()+` > pattern.
`)+`	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{var L=aE(w.PATTERN,e.ensureOptimizations);we(L)&&(S=!1),$(L,function(G){Wa(A,G,m[I])})}else e.ensureOptimizations&&lo(""+Yi+("	TokenType: <"+w.name+`> is using a custom token pattern without providing <start_chars_hint> parameter.
`)+`	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),S=!1;return A},[])}),t("ArrayPacking",function(){v=Jg(v)}),{emptyGroups:E,patternIdxToConfig:m,charCodeToPatternIdxToConfig:v,hasCustom:n,canBeOptimized:S}}function cE(s,e){var t=[],r=dE(s);t=t.concat(r.errors);var n=fE(r.valid),i=n.valid;return t=t.concat(n.errors),t=t.concat(hE(i)),t=t.concat(TE(i)),t=t.concat(vE(i,e)),t=t.concat(SE(i)),t}function hE(s){var e=[],t=fr(s,function(r){return kr(r[Ir])});return e=e.concat(mE(t)),e=e.concat(RE(t)),e=e.concat(yE(t)),e=e.concat(NE(t)),e=e.concat(gE(t)),e}function dE(s){var e=fr(s,function(n){return!Y(n,Ir)}),t=B(e,function(n){return{message:"Token Type: ->"+n.name+"<- missing static 'PATTERN' property",type:Ye.MISSING_PATTERN,tokenTypes:[n]}}),r=va(s,e);return{errors:t,valid:r}}function fE(s){var e=fr(s,function(n){var i=n[Ir];return!kr(i)&&!on(i)&&!Y(i,"exec")&&!wr(i)}),t=B(e,function(n){return{message:"Token Type: ->"+n.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ye.INVALID_PATTERN,tokenTypes:[n]}}),r=va(s,e);return{errors:t,valid:r}}var pE=/[^\\][\$]/;function mE(s){var e=function(n){hh(i,n);function i(){var a=n!==null&&n.apply(this,arguments)||this;return a.found=!1,a}return i.prototype.visitEndAnchor=function(a){this.found=!0},i}(ti.BaseRegExpVisitor),t=fr(s,function(n){var i=n[Ir];try{var a=Aa(i),o=new e;return o.visit(a),o.found}catch{return pE.test(i.source)}}),r=B(t,function(n){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+n.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ye.EOI_ANCHOR_FOUND,tokenTypes:[n]}});return r}function gE(s){var e=fr(s,function(r){var n=r[Ir];return n.test("")}),t=B(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Ye.EMPTY_MATCH_PATTERN,tokenTypes:[r]}});return t}var EE=/[^\\[][\^]|^\^/;function RE(s){var e=function(n){hh(i,n);function i(){var a=n!==null&&n.apply(this,arguments)||this;return a.found=!1,a}return i.prototype.visitStartAnchor=function(a){this.found=!0},i}(ti.BaseRegExpVisitor),t=fr(s,function(n){var i=n[Ir];try{var a=Aa(i),o=new e;return o.visit(a),o.found}catch{return EE.test(i.source)}}),r=B(t,function(n){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+n.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ye.SOI_ANCHOR_FOUND,tokenTypes:[n]}});return r}function yE(s){var e=fr(s,function(r){var n=r[Ir];return n instanceof RegExp&&(n.multiline||n.global)}),t=B(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ye.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}});return t}function NE(s){var e=[],t=B(s,function(i){return dt(s,function(a,o){return i.PATTERN.source===o.PATTERN.source&&!Qe(e,o)&&o.PATTERN!==It.NA&&(e.push(o),a.push(o)),a},[])});t=ei(t);var r=fr(t,function(i){return i.length>1}),n=B(r,function(i){var a=B(i,function(u){return u.name}),o=er(i).PATTERN;return{message:"The same RegExp pattern ->"+o+"<-"+("has been used in all of the following Token Types: "+a.join(", ")+" <-"),type:Ye.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}});return n}function TE(s){var e=fr(s,function(r){if(!Y(r,"GROUP"))return!1;var n=r.GROUP;return n!==It.SKIPPED&&n!==It.NA&&!wr(n)}),t=B(e,function(r){return{message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ye.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}});return t}function vE(s,e){var t=fr(s,function(n){return n.PUSH_MODE!==void 0&&!Qe(e,n.PUSH_MODE)}),r=B(t,function(n){var i="Token Type: ->"+n.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+n.PUSH_MODE+"<-which does not exist";return{message:i,type:Ye.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[n]}});return r}function SE(s){var e=[],t=dt(s,function(r,n,i){var a=n.PATTERN;return a===It.NA||(wr(a)?r.push({str:a,idx:i,tokenType:n}):kr(a)&&CE(a)&&r.push({str:a.source,idx:i,tokenType:n})),r},[]);return $(s,function(r,n){$(t,function(i){var a=i.str,o=i.idx,u=i.tokenType;if(n<o&&AE(a,r.PATTERN)){var l="Token: ->"+u.name+`<- can never be matched.
`+("Because it appears AFTER the Token Type ->"+r.name+"<-")+`in the lexer's definition.
See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:l,type:Ye.UNREACHABLE_PATTERN,tokenTypes:[r,u]})}})}),e}function AE(s,e){if(kr(e)){var t=e.exec(s);return t!==null&&t.index===0}else{if(on(e))return e(s,0,[],{});if(Y(e,"exec"))return e.exec(s,0,[],{});if(typeof e=="string")return e===s;throw Error("non exhaustive match")}}function CE(s){var e=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return Jn(e,function(t){return s.source.indexOf(t)!==-1})===void 0}function tl(s){var e=s.ignoreCase?"i":"";return new RegExp("^(?:"+s.source+")",e)}function rl(s){var e=s.ignoreCase?"iy":"y";return new RegExp(""+s.source,e)}function wE(s,e,t){var r=[];return Y(s,Nn)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Nn+`> property in its definition
`,type:Ye.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Y(s,li)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+li+`> property in its definition
`,type:Ye.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Y(s,li)&&Y(s,Nn)&&!Y(s.modes,s.defaultMode)&&r.push({message:"A MultiMode Lexer cannot be initialized with a "+Nn+": <"+s.defaultMode+`>which does not exist
`,type:Ye.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Y(s,li)&&$(s.modes,function(n,i){$(n,function(a,o){tr(a)&&r.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+("<"+i+"> at index: <"+o+`>
`),type:Ye.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),r}function IE(s,e,t){var r=[],n=!1,i=ei(Mt(Kg(s.modes,function(u){return u}))),a=Sn(i,function(u){return u[Ir]===It.NA}),o=mh(t);return e&&$(a,function(u){var l=ph(u,o);if(l!==!1){var c=xE(u,l),d={message:c,type:l.issue,tokenType:u};r.push(d)}else Y(u,"LINE_BREAKS")?u.LINE_BREAKS===!0&&(n=!0):Jo(o,u.PATTERN)&&(n=!0)}),e&&!n&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ye.NO_LINE_BREAKS_FLAGS}),r}function ME(s){var e={},t=Gr(s);return $(t,function(r){var n=s[r];if(cr(n))e[r]=[];else throw Error("non exhaustive match")}),e}function fh(s){var e=s.PATTERN;if(kr(e))return!1;if(on(e))return!0;if(Y(e,"exec"))return!0;if(wr(e))return!1;throw Error("non exhaustive match")}function OE(s){return wr(s)&&s.length===1?s.charCodeAt(0):!1}var bE={test:function(s){for(var e=s.length,t=this.lastIndex;t<e;t++){var r=s.charCodeAt(t);if(r===10)return this.lastIndex=t+1,!0;if(r===13)return s.charCodeAt(t+1)===10?this.lastIndex=t+2:this.lastIndex=t+1,!0}return!1},lastIndex:0};function ph(s,e){if(Y(s,"LINE_BREAKS"))return!1;if(kr(s.PATTERN)){try{Jo(e,s.PATTERN)}catch(t){return{issue:Ye.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}else{if(wr(s.PATTERN))return!1;if(fh(s))return{issue:Ye.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function xE(s,e){if(e.issue===Ye.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
`+("	The problem is in the <"+s.name+`> Token Type
`)+("	 Root cause: "+e.errMsg+`.
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(e.issue===Ye.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
`+("	The problem is in the <"+s.name+`> Token Type
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function mh(s){var e=B(s,function(t){return wr(t)&&t.length>0?t.charCodeAt(0):t});return e}function Wa(s,e,t){s[e]===void 0?s[e]=[t]:s[e].push(t)}var Ts=256;function sn(s){return s<Ts?s:bi[s]}var bi=[];function _E(){if(we(bi)){bi=new Array(65536);for(var s=0;s<65536;s++)bi[s]=s>255?255+~~(s/255):s}}function Ca(s,e){var t=s.tokenTypeIdx;return t===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[t]===!0}function $i(s,e){return s.tokenTypeIdx===e.tokenTypeIdx}var nl=1,gh={};function ri(s){var e=LE(s);FE(e),PE(e),UE(e),$(e,function(t){t.isParent=t.categoryMatches.length>0})}function LE(s){for(var e=Ot(s),t=s,r=!0;r;){t=ei(Mt(B(t,function(i){return i.CATEGORIES})));var n=va(t,e);e=e.concat(n),we(n)?r=!1:t=n}return e}function FE(s){$(s,function(e){Rh(e)||(gh[nl]=e,e.tokenTypeIdx=nl++),sl(e)&&!cr(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),sl(e)||(e.CATEGORIES=[]),DE(e)||(e.categoryMatches=[]),VE(e)||(e.categoryMatchesMap={})})}function UE(s){$(s,function(e){e.categoryMatches=[],$(e.categoryMatchesMap,function(t,r){e.categoryMatches.push(gh[r].tokenTypeIdx)})})}function PE(s){$(s,function(e){Eh([],e)})}function Eh(s,e){$(s,function(t){e.categoryMatchesMap[t.tokenTypeIdx]=!0}),$(e.CATEGORIES,function(t){var r=s.concat(e);Qe(r,t)||Eh(r,t)})}function Rh(s){return Y(s,"tokenTypeIdx")}function sl(s){return Y(s,"CATEGORIES")}function DE(s){return Y(s,"categoryMatches")}function VE(s){return Y(s,"categoryMatchesMap")}function BE(s){return Y(s,"tokenTypeIdx")}var kE={buildUnableToPopLexerModeMessage:function(s){return"Unable to pop Lexer Mode after encountering Token ->"+s.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(s,e,t,r,n){return"unexpected character: ->"+s.charAt(e)+"<- at offset: "+e+","+(" skipped "+t+" characters.")}},Ye;(function(s){s[s.MISSING_PATTERN=0]="MISSING_PATTERN",s[s.INVALID_PATTERN=1]="INVALID_PATTERN",s[s.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",s[s.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",s[s.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",s[s.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",s[s.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",s[s.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",s[s.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",s[s.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",s[s.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",s[s.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",s[s.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",s[s.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",s[s.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",s[s.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",s[s.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"})(Ye||(Ye={}));var vs={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:kE,traceInitPerf:!1,skipValidations:!1};Object.freeze(vs);var It=function(){function s(e,t){var r=this;if(t===void 0&&(t=vs),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},typeof t=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=qu(vs,t);var n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var i,a=!0;r.TRACE_INIT("Lexer Config handling",function(){if(r.config.lineTerminatorsPattern===vs.lineTerminatorsPattern)r.config.lineTerminatorsPattern=bE;else if(r.config.lineTerminatorCharacters===vs.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');r.trackStartLines=/full|onlyStart/i.test(r.config.positionTracking),r.trackEndLines=/full/i.test(r.config.positionTracking),cr(e)?(i={modes:{}},i.modes[Nn]=Ot(e),i[Nn]=Nn):(a=!1,i=Js(e))}),r.config.skipValidations===!1&&(r.TRACE_INIT("performRuntimeChecks",function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(wE(i,r.trackStartLines,r.config.lineTerminatorCharacters))}),r.TRACE_INIT("performWarningRuntimeChecks",function(){r.lexerDefinitionWarning=r.lexerDefinitionWarning.concat(IE(i,r.trackStartLines,r.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},$(i.modes,function(c,d){i.modes[d]=Sn(c,function(f){return tr(f)})});var o=Gr(i.modes);if($(i.modes,function(c,d){r.TRACE_INIT("Mode: <"+d+"> processing",function(){if(r.modes.push(d),r.config.skipValidations===!1&&r.TRACE_INIT("validatePatterns",function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(cE(c,o))}),we(r.lexerDefinitionErrors)){ri(c);var f;r.TRACE_INIT("analyzeTokenTypes",function(){f=lE(c,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:r.TRACE_INIT.bind(r)})}),r.patternIdxToConfig[d]=f.patternIdxToConfig,r.charCodeToPatternIdxToConfig[d]=f.charCodeToPatternIdxToConfig,r.emptyGroups=qu(r.emptyGroups,f.emptyGroups),r.hasCustom=f.hasCustom||r.hasCustom,r.canModeBeOptimized[d]=f.canBeOptimized}})}),r.defaultMode=i.defaultMode,!we(r.lexerDefinitionErrors)&&!r.config.deferDefinitionErrorsHandling){var u=B(r.lexerDefinitionErrors,function(c){return c.message}),l=u.join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+l)}$(r.lexerDefinitionWarning,function(c){Zo(c.message)}),r.TRACE_INIT("Choosing sub-methods implementations",function(){if(dh?(r.chopInput=Qu,r.match=r.matchWithTest):(r.updateLastIndex=Je,r.match=r.matchWithExec),a&&(r.handleModes=Je),r.trackStartLines===!1&&(r.computeNewColumn=Qu),r.trackEndLines===!1&&(r.updateTokenEndLineColumnLocation=Je),/full/i.test(r.config.positionTracking))r.createTokenInstance=r.createFullToken;else if(/onlyStart/i.test(r.config.positionTracking))r.createTokenInstance=r.createStartOnlyToken;else if(/onlyOffset/i.test(r.config.positionTracking))r.createTokenInstance=r.createOffsetOnlyToken;else throw Error('Invalid <positionTracking> config option: "'+r.config.positionTracking+'"');r.hasCustom?(r.addToken=r.addTokenUsingPush,r.handlePayload=r.handlePayloadWithCustom):(r.addToken=r.addTokenUsingMemberAccess,r.handlePayload=r.handlePayloadNoCustom)}),r.TRACE_INIT("Failed Optimization Warnings",function(){var c=dt(r.canModeBeOptimized,function(d,f,p){return f===!1&&d.push(p),d},[]);if(t.ensureOptimizations&&!we(c))throw Error("Lexer Modes: < "+c.join(", ")+` > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),r.TRACE_INIT("clearRegExpParserCache",function(){sE()}),r.TRACE_INIT("toFastProperties",function(){uh(r)})})}return s.prototype.tokenize=function(e,t){if(t===void 0&&(t=this.defaultMode),!we(this.lexerDefinitionErrors)){var r=B(this.lexerDefinitionErrors,function(a){return a.message}),n=r.join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+n)}var i=this.tokenizeInternal(e,t);return i},s.prototype.tokenizeInternal=function(e,t){var r=this,n,i,a,o,u,l,c,d,f,p,E,m,S,v,A=e,w=A.length,I=0,O=0,_=this.hasCustom?0:Math.floor(e.length/10),x=new Array(_),L=[],G=this.trackStartLines?1:void 0,H=this.trackStartLines?1:void 0,P=ME(this.emptyGroups),le=this.trackStartLines,se=this.config.lineTerminatorsPattern,ie=0,ce=[],q=[],fe=[],ye=[];Object.freeze(ye);var Se=void 0;function Ae(){return ce}function Ue(Te){var He=sn(Te),ee=q[He];return ee===void 0?ye:ee}var ae=function(Te){if(fe.length===1&&Te.tokenType.PUSH_MODE===void 0){var He=r.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Te);L.push({offset:Te.startOffset,line:Te.startLine!==void 0?Te.startLine:void 0,column:Te.startColumn!==void 0?Te.startColumn:void 0,length:Te.image.length,message:He})}else{fe.pop();var ee=ih(fe);ce=r.patternIdxToConfig[ee],q=r.charCodeToPatternIdxToConfig[ee],ie=ce.length;var Me=r.canModeBeOptimized[ee]&&r.config.safeMode===!1;q&&Me?Se=Ue:Se=Ae}};function Ne(Te){fe.push(Te),q=this.charCodeToPatternIdxToConfig[Te],ce=this.patternIdxToConfig[Te],ie=ce.length,ie=ce.length;var He=this.canModeBeOptimized[Te]&&this.config.safeMode===!1;q&&He?Se=Ue:Se=Ae}Ne.call(this,t);for(var pe;I<w;){u=null;var V=A.charCodeAt(I),b=Se(V),z=b.length;for(n=0;n<z;n++){pe=b[n];var j=pe.pattern;l=null;var me=pe.short;if(me!==!1?V===me&&(u=j):pe.isCustom===!0?(v=j.exec(A,I,x,P),v!==null?(u=v[0],v.payload!==void 0&&(l=v.payload)):u=null):(this.updateLastIndex(j,I),u=this.match(j,e,I)),u!==null){if(o=pe.longerAlt,o!==void 0){var X=ce[o],Oe=X.pattern;c=null,X.isCustom===!0?(v=Oe.exec(A,I,x,P),v!==null?(a=v[0],v.payload!==void 0&&(c=v.payload)):a=null):(this.updateLastIndex(Oe,I),a=this.match(Oe,e,I)),a&&a.length>u.length&&(u=a,l=c,pe=X)}break}}if(u!==null){if(d=u.length,f=pe.group,f!==void 0&&(p=pe.tokenTypeIdx,E=this.createTokenInstance(u,I,p,pe.tokenType,G,H,d),this.handlePayload(E,l),f===!1?O=this.addToken(x,O,E):P[f].push(E)),e=this.chopInput(e,d),I=I+d,H=this.computeNewColumn(H,d),le===!0&&pe.canLineTerminator===!0){var ke=0,at=void 0,Ge=void 0;se.lastIndex=0;do at=se.test(u),at===!0&&(Ge=se.lastIndex-1,ke++);while(at===!0);ke!==0&&(G=G+ke,H=d-Ge,this.updateTokenEndLineColumnLocation(E,f,Ge,ke,G,H,d))}this.handleModes(pe,ae,Ne,E)}else{for(var _e=I,Tt=G,_t=H,Et=!1;!Et&&I<w;)for(A.charCodeAt(I),e=this.chopInput(e,1),I++,i=0;i<ie;i++){var zt=ce[i],j=zt.pattern,me=zt.short;if(me!==!1?A.charCodeAt(I)===me&&(Et=!0):zt.isCustom===!0?Et=j.exec(A,I,x,P)!==null:(this.updateLastIndex(j,I),Et=j.exec(e)!==null),Et===!0)break}m=I-_e,S=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(A,_e,m,Tt,_t),L.push({offset:_e,line:Tt,column:_t,length:m,message:S})}}return this.hasCustom||(x.length=O),{tokens:x,groups:P,errors:L}},s.prototype.handleModes=function(e,t,r,n){if(e.pop===!0){var i=e.push;t(n),i!==void 0&&r.call(this,i)}else e.push!==void 0&&r.call(this,e.push)},s.prototype.chopInput=function(e,t){return e.substring(t)},s.prototype.updateLastIndex=function(e,t){e.lastIndex=t},s.prototype.updateTokenEndLineColumnLocation=function(e,t,r,n,i,a,o){var u,l;t!==void 0&&(u=r===o-1,l=u?-1:0,n===1&&u===!0||(e.endLine=i+l,e.endColumn=a-1+-l))},s.prototype.computeNewColumn=function(e,t){return e+t},s.prototype.createTokenInstance=function(){return null},s.prototype.createOffsetOnlyToken=function(e,t,r,n){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:n}},s.prototype.createStartOnlyToken=function(e,t,r,n,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:r,tokenType:n}},s.prototype.createFullToken=function(e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:n}},s.prototype.addToken=function(e,t,r){return 666},s.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},s.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,t++,t},s.prototype.handlePayload=function(e,t){},s.prototype.handlePayloadNoCustom=function(e,t){},s.prototype.handlePayloadWithCustom=function(e,t){t!==null&&(e.payload=t)},s.prototype.match=function(e,t,r){return null},s.prototype.matchWithTest=function(e,t,r){var n=e.test(t);return n===!0?t.substring(r,e.lastIndex):null},s.prototype.matchWithExec=function(e,t){var r=e.exec(t);return r!==null?r[0]:r},s.prototype.TRACE_INIT=function(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--> <"+e+">");var n=lh(t),i=n.time,a=n.value,o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(r+"<-- <"+e+"> time: "+i+"ms"),this.traceInitIndent--,a}else return t()},s.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",s.NA=/NOT_APPLICABLE/,s}();function jn(s){return yh(s)?s.LABEL:s.name}function yh(s){return wr(s.LABEL)&&s.LABEL!==""}var GE="parent",il="categories",al="label",ol="group",ul="push_mode",ll="pop_mode",cl="longer_alt",hl="line_breaks",dl="start_chars_hint";function oe(s){return HE(s)}function HE(s){var e=s.pattern,t={};if(t.name=s.name,tr(e)||(t.PATTERN=e),Y(s,GE))throw`The parent property is no longer supported.
See: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.`;return Y(s,il)&&(t.CATEGORIES=s[il]),ri([t]),Y(s,al)&&(t.LABEL=s[al]),Y(s,ol)&&(t.GROUP=s[ol]),Y(s,ll)&&(t.POP_MODE=s[ll]),Y(s,ul)&&(t.PUSH_MODE=s[ul]),Y(s,cl)&&(t.LONGER_ALT=s[cl]),Y(s,hl)&&(t.LINE_BREAKS=s[hl]),Y(s,dl)&&(t.START_CHARS_HINT=s[dl]),t}var An=oe({name:"EOF",pattern:It.NA});ri([An]);function eu(s,e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:r,startLine:n,endLine:i,startColumn:a,endColumn:o,tokenTypeIdx:s.tokenTypeIdx,tokenType:s}}function ve(s,e){return Ca(s,e)}var Hr=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Or=function(){function s(e){this.definition=e}return s.prototype.accept=function(e){e.visit(this),$(this.definition,function(t){t.accept(e)})},s}(),Gt=function(s){Hr(e,s);function e(t){var r=s.call(this,[])||this;return r.idx=1,pr(r,sr(t,function(n){return n!==void 0})),r}return Object.defineProperty(e.prototype,"definition",{get:function(){return this.referencedRule!==void 0?this.referencedRule.definition:[]},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.accept=function(t){t.visit(this)},e}(Or),ss=function(s){Hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.orgText="",pr(r,sr(t,function(n){return n!==void 0})),r}return e}(Or),bt=function(s){Hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.ignoreAmbiguities=!1,pr(r,sr(t,function(n){return n!==void 0})),r}return e}(Or),ht=function(s){Hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,pr(r,sr(t,function(n){return n!==void 0})),r}return e}(Or),rr=function(s){Hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,pr(r,sr(t,function(n){return n!==void 0})),r}return e}(Or),nr=function(s){Hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,pr(r,sr(t,function(n){return n!==void 0})),r}return e}(Or),je=function(s){Hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,pr(r,sr(t,function(n){return n!==void 0})),r}return e}(Or),Ht=function(s){Hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,pr(r,sr(t,function(n){return n!==void 0})),r}return e}(Or),Wt=function(s){Hr(e,s);function e(t){var r=s.call(this,t.definition)||this;return r.idx=1,r.ignoreAmbiguities=!1,r.hasPredicates=!1,pr(r,sr(t,function(n){return n!==void 0})),r}return e}(Or),Fe=function(){function s(e){this.idx=1,pr(this,sr(e,function(t){return t!==void 0}))}return s.prototype.accept=function(e){e.visit(this)},s}();function WE(s){return B(s,xi)}function xi(s){function e(n){return B(n,xi)}if(s instanceof Gt)return{type:"NonTerminal",name:s.nonTerminalName,idx:s.idx};if(s instanceof bt)return{type:"Flat",definition:e(s.definition)};if(s instanceof ht)return{type:"Option",idx:s.idx,definition:e(s.definition)};if(s instanceof rr)return{type:"RepetitionMandatory",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof nr)return{type:"RepetitionMandatoryWithSeparator",name:s.name,idx:s.idx,separator:xi(new Fe({terminalType:s.separator})),definition:e(s.definition)};if(s instanceof Ht)return{type:"RepetitionWithSeparator",name:s.name,idx:s.idx,separator:xi(new Fe({terminalType:s.separator})),definition:e(s.definition)};if(s instanceof je)return{type:"Repetition",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof Wt)return{type:"Alternation",name:s.name,idx:s.idx,definition:e(s.definition)};if(s instanceof Fe){var t={type:"Terminal",name:s.terminalType.name,label:jn(s.terminalType),idx:s.idx},r=s.terminalType.PATTERN;return s.terminalType.PATTERN&&(t.pattern=kr(r)?r.source:r),t}else{if(s instanceof ss)return{type:"Rule",name:s.name,orgText:s.orgText,definition:e(s.definition)};throw Error("non exhaustive match")}}var wa=function(){function s(){}return s.prototype.walk=function(e,t){var r=this;t===void 0&&(t=[]),$(e.definition,function(n,i){var a=ct(e.definition,i+1);if(n instanceof Gt)r.walkProdRef(n,a,t);else if(n instanceof Fe)r.walkTerminal(n,a,t);else if(n instanceof bt)r.walkFlat(n,a,t);else if(n instanceof ht)r.walkOption(n,a,t);else if(n instanceof rr)r.walkAtLeastOne(n,a,t);else if(n instanceof nr)r.walkAtLeastOneSep(n,a,t);else if(n instanceof Ht)r.walkManySep(n,a,t);else if(n instanceof je)r.walkMany(n,a,t);else if(n instanceof Wt)r.walkOr(n,a,t);else throw Error("non exhaustive match")})},s.prototype.walkTerminal=function(e,t,r){},s.prototype.walkProdRef=function(e,t,r){},s.prototype.walkFlat=function(e,t,r){var n=t.concat(r);this.walk(e,n)},s.prototype.walkOption=function(e,t,r){var n=t.concat(r);this.walk(e,n)},s.prototype.walkAtLeastOne=function(e,t,r){var n=[new ht({definition:e.definition})].concat(t,r);this.walk(e,n)},s.prototype.walkAtLeastOneSep=function(e,t,r){var n=fl(e,t,r);this.walk(e,n)},s.prototype.walkMany=function(e,t,r){var n=[new ht({definition:e.definition})].concat(t,r);this.walk(e,n)},s.prototype.walkManySep=function(e,t,r){var n=fl(e,t,r);this.walk(e,n)},s.prototype.walkOr=function(e,t,r){var n=this,i=t.concat(r);$(e.definition,function(a){var o=new bt({definition:[a]});n.walk(o,i)})},s}();function fl(s,e,t){var r=[new ht({definition:[new Fe({terminalType:s.separator})].concat(s.definition)})],n=r.concat(e,t);return n}var In=function(){function s(){}return s.prototype.visit=function(e){var t=e;switch(t.constructor){case Gt:return this.visitNonTerminal(t);case bt:return this.visitFlat(t);case ht:return this.visitOption(t);case rr:return this.visitRepetitionMandatory(t);case nr:return this.visitRepetitionMandatoryWithSeparator(t);case Ht:return this.visitRepetitionWithSeparator(t);case je:return this.visitRepetition(t);case Wt:return this.visitAlternation(t);case Fe:return this.visitTerminal(t);case ss:return this.visitRule(t);default:throw Error("non exhaustive match")}},s.prototype.visitNonTerminal=function(e){},s.prototype.visitFlat=function(e){},s.prototype.visitOption=function(e){},s.prototype.visitRepetition=function(e){},s.prototype.visitRepetitionMandatory=function(e){},s.prototype.visitRepetitionMandatoryWithSeparator=function(e){},s.prototype.visitRepetitionWithSeparator=function(e){},s.prototype.visitAlternation=function(e){},s.prototype.visitTerminal=function(e){},s.prototype.visitRule=function(e){},s}(),zE=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function jE(s){return s instanceof bt||s instanceof ht||s instanceof je||s instanceof rr||s instanceof nr||s instanceof Ht||s instanceof Fe||s instanceof ss}function Xi(s,e){e===void 0&&(e=[]);var t=s instanceof ht||s instanceof je||s instanceof Ht;return t?!0:s instanceof Wt?ah(s.definition,function(r){return Xi(r,e)}):s instanceof Gt&&Qe(e,s)?!1:s instanceof Or?(s instanceof Gt&&e.push(s),Jt(s.definition,function(r){return Xi(r,e)})):!1}function YE(s){return s instanceof Wt}function or(s){if(s instanceof Gt)return"SUBRULE";if(s instanceof ht)return"OPTION";if(s instanceof Wt)return"OR";if(s instanceof rr)return"AT_LEAST_ONE";if(s instanceof nr)return"AT_LEAST_ONE_SEP";if(s instanceof Ht)return"MANY_SEP";if(s instanceof je)return"MANY";if(s instanceof Fe)return"CONSUME";throw Error("non exhaustive match")}var $E=function(s){zE(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return e.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},e.prototype.visitTerminal=function(t){var r=t.terminalType.name+this.separator+"Terminal";Y(this.dslMethods,r)||(this.dslMethods[r]=[]),this.dslMethods[r].push(t)},e.prototype.visitNonTerminal=function(t){var r=t.nonTerminalName+this.separator+"Terminal";Y(this.dslMethods,r)||(this.dslMethods[r]=[]),this.dslMethods[r].push(t)},e.prototype.visitOption=function(t){this.dslMethods.option.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.dslMethods.repetitionWithSeparator.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.dslMethods.repetitionMandatory.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)},e.prototype.visitRepetition=function(t){this.dslMethods.repetition.push(t)},e.prototype.visitAlternation=function(t){this.dslMethods.alternation.push(t)},e}(In),ci=new $E;function XE(s){ci.reset(),s.accept(ci);var e=ci.dslMethods;return ci.reset(),e}function ni(s){if(s instanceof Gt)return ni(s.referencedRule);if(s instanceof Fe)return QE(s);if(jE(s))return KE(s);if(YE(s))return qE(s);throw Error("non exhaustive match")}function KE(s){for(var e=[],t=s.definition,r=0,n=t.length>r,i,a=!0;n&&a;)i=t[r],a=Xi(i),e=e.concat(ni(i)),r=r+1,n=t.length>r;return qo(e)}function qE(s){var e=B(s.definition,function(t){return ni(t)});return qo(Mt(e))}function QE(s){return[s.terminalType]}var Nh="_~IN~_",ZE=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),JE=function(s){ZE(e,s);function e(t){var r=s.call(this)||this;return r.topProd=t,r.follows={},r}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},e.prototype.walkTerminal=function(t,r,n){},e.prototype.walkProdRef=function(t,r,n){var i=tR(t.referencedRule,t.idx)+this.topProd.name,a=r.concat(n),o=new bt({definition:a}),u=ni(o);this.follows[i]=u},e}(wa);function eR(s){var e={};return $(s,function(t){var r=new JE(t).startWalking();pr(e,r)}),e}function tR(s,e){return s.name+e+Nh}var rR=4,un=8,nR=8,Yn=1<<un,Ki=2<<un,Is=3<<un,Ms=4<<un,Os=5<<un,Gn=6<<un;function bs(s,e,t){return t|e|s}var sR=32-nR;function Th(s,e,t,r){var n=r+1<<sR;return bs(s,e,t)|n}var iR=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function pl(s,e){isNaN(s.startOffset)===!0?(s.startOffset=e.startOffset,s.endOffset=e.endOffset):s.endOffset<e.endOffset&&(s.endOffset=e.endOffset)}function ml(s,e){isNaN(s.startOffset)===!0?(s.startOffset=e.startOffset,s.startColumn=e.startColumn,s.startLine=e.startLine,s.endOffset=e.endOffset,s.endColumn=e.endColumn,s.endLine=e.endLine):s.endOffset<e.endOffset&&(s.endOffset=e.endOffset,s.endColumn=e.endColumn,s.endLine=e.endLine)}function aR(s,e,t){s.children[t]===void 0?s.children[t]=[e]:s.children[t].push(e)}function gl(s,e,t){s.children[e]===void 0?s.children[e]=[t]:s.children[e].push(t)}var tu=function(s){iR(e,s);function e(t){var r=s.call(this)||this;return r.result=[],r.ruleIdx=t,r}return e.prototype.collectNamedDSLMethod=function(t,r,n){if(!tr(t.name)){var i=void 0;if(t instanceof ht||t instanceof je||t instanceof rr||t instanceof Wt)i=new r({definition:t.definition,idx:t.idx});else if(t instanceof nr||t instanceof Ht)i=new r({definition:t.definition,idx:t.idx,separator:t.separator});else throw Error("non exhaustive match");var a=[i],o=bs(this.ruleIdx,n,t.idx);this.result.push({def:a,key:o,name:t.name,orgProd:t})}},e.prototype.visitOption=function(t){this.collectNamedDSLMethod(t,ht,Ki)},e.prototype.visitRepetition=function(t){this.collectNamedDSLMethod(t,je,Is)},e.prototype.visitRepetitionMandatory=function(t){this.collectNamedDSLMethod(t,rr,Ms)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.collectNamedDSLMethod(t,nr,Gn)},e.prototype.visitRepetitionWithSeparator=function(t){this.collectNamedDSLMethod(t,Ht,Os)},e.prototype.visitAlternation=function(t){var r=this;this.collectNamedDSLMethod(t,Wt,Yn);var n=t.definition.length>1;$(t.definition,function(i,a){if(!tr(i.name)){var o=i.definition;n?o=[new ht({definition:i.definition})]:o=i.definition;var u=Th(r.ruleIdx,Yn,t.idx,a);r.result.push({def:o,key:u,name:i.name,orgProd:i})}})},e}(In);function oR(s,e){var t={allRuleNames:[]};return $(s,function(r){var n=e[r.name];t.allRuleNames.push(r.name);var i=new tu(n);r.accept(i),$(i.result,function(a){a.def,a.key;var o=a.name;t.allRuleNames.push(r.name+o)})}),t}var Mn=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),uR=function(s){Mn(e,s);function e(t,r){var n=s.call(this)||this;return n.topProd=t,n.path=r,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}return e.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ot(this.path.ruleStack).reverse(),this.occurrenceStack=Ot(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},e.prototype.walk=function(t,r){r===void 0&&(r=[]),this.found||s.prototype.walk.call(this,t,r)},e.prototype.walkProdRef=function(t,r,n){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){var i=r.concat(n);this.updateExpectedNext(),this.walk(t.referencedRule,i)}},e.prototype.updateExpectedNext=function(){we(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},e}(wa),lR=function(s){Mn(e,s);function e(t,r){var n=s.call(this,t,r)||this;return n.path=r,n.nextTerminalName="",n.nextTerminalOccurrence=0,n.nextTerminalName=n.path.lastTok.name,n.nextTerminalOccurrence=n.path.lastTokOccurrence,n}return e.prototype.walkTerminal=function(t,r,n){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){var i=r.concat(n),a=new bt({definition:i});this.possibleTokTypes=ni(a),this.found=!0}},e}(uR),Ia=function(s){Mn(e,s);function e(t,r){var n=s.call(this)||this;return n.topRule=t,n.occurrence=r,n.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},n}return e.prototype.startWalking=function(){return this.walk(this.topRule),this.result},e}(wa),cR=function(s){Mn(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkMany=function(t,r,n){if(t.idx===this.occurrence){var i=er(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkMany.call(this,t,r,n)},e}(Ia),El=function(s){Mn(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkManySep=function(t,r,n){if(t.idx===this.occurrence){var i=er(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkManySep.call(this,t,r,n)},e}(Ia),hR=function(s){Mn(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkAtLeastOne=function(t,r,n){if(t.idx===this.occurrence){var i=er(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkAtLeastOne.call(this,t,r,n)},e}(Ia),Rl=function(s){Mn(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e.prototype.walkAtLeastOneSep=function(t,r,n){if(t.idx===this.occurrence){var i=er(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Fe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else s.prototype.walkAtLeastOneSep.call(this,t,r,n)},e}(Ia);function fo(s,e,t){t===void 0&&(t=[]),t=Ot(t);var r=[],n=0;function i(l){return l.concat(ct(s,n+1))}function a(l){var c=fo(i(l),e,t);return r.concat(c)}for(;t.length<e&&n<s.length;){var o=s[n];if(o instanceof bt)return a(o.definition);if(o instanceof Gt)return a(o.definition);if(o instanceof ht)r=a(o.definition);else if(o instanceof rr){var u=o.definition.concat([new je({definition:o.definition})]);return a(u)}else if(o instanceof nr){var u=[new bt({definition:o.definition}),new je({definition:[new Fe({terminalType:o.separator})].concat(o.definition)})];return a(u)}else if(o instanceof Ht){var u=o.definition.concat([new je({definition:[new Fe({terminalType:o.separator})].concat(o.definition)})]);r=a(u)}else if(o instanceof je){var u=o.definition.concat([new je({definition:o.definition})]);r=a(u)}else{if(o instanceof Wt)return $(o.definition,function(l){r=a(l.definition)}),r;if(o instanceof Fe)t.push(o.terminalType);else throw Error("non exhaustive match")}n++}return r.push({partialPath:t,suffixDef:ct(s,n)}),r}function vh(s,e,t,r){var n="EXIT_NONE_TERMINAL",i=[n],a="EXIT_ALTERNATIVE",o=!1,u=e.length,l=u-r-1,c=[],d=[];for(d.push({idx:-1,def:s,ruleStack:[],occurrenceStack:[]});!we(d);){var f=d.pop();if(f===a){o&&ih(d).idx<=l&&d.pop();continue}var p=f.def,E=f.idx,m=f.ruleStack,S=f.occurrenceStack;if(!we(p)){var v=p[0];if(v===n){var A={idx:E,def:ct(p),ruleStack:ks(m),occurrenceStack:ks(S)};d.push(A)}else if(v instanceof Fe)if(E<u-1){var w=E+1,I=e[w];if(t(I,v.terminalType)){var A={idx:w,def:ct(p),ruleStack:m,occurrenceStack:S};d.push(A)}}else if(E===u-1)c.push({nextTokenType:v.terminalType,nextTokenOccurrence:v.idx,ruleStack:m,occurrenceStack:S}),o=!0;else throw Error("non exhaustive match");else if(v instanceof Gt){var O=Ot(m);O.push(v.nonTerminalName);var _=Ot(S);_.push(v.idx);var A={idx:E,def:v.definition.concat(i,ct(p)),ruleStack:O,occurrenceStack:_};d.push(A)}else if(v instanceof ht){var x={idx:E,def:ct(p),ruleStack:m,occurrenceStack:S};d.push(x),d.push(a);var L={idx:E,def:v.definition.concat(ct(p)),ruleStack:m,occurrenceStack:S};d.push(L)}else if(v instanceof rr){var G=new je({definition:v.definition,idx:v.idx}),H=v.definition.concat([G],ct(p)),A={idx:E,def:H,ruleStack:m,occurrenceStack:S};d.push(A)}else if(v instanceof nr){var P=new Fe({terminalType:v.separator}),G=new je({definition:[P].concat(v.definition),idx:v.idx}),H=v.definition.concat([G],ct(p)),A={idx:E,def:H,ruleStack:m,occurrenceStack:S};d.push(A)}else if(v instanceof Ht){var x={idx:E,def:ct(p),ruleStack:m,occurrenceStack:S};d.push(x),d.push(a);var P=new Fe({terminalType:v.separator}),le=new je({definition:[P].concat(v.definition),idx:v.idx}),H=v.definition.concat([le],ct(p)),L={idx:E,def:H,ruleStack:m,occurrenceStack:S};d.push(L)}else if(v instanceof je){var x={idx:E,def:ct(p),ruleStack:m,occurrenceStack:S};d.push(x),d.push(a);var le=new je({definition:v.definition,idx:v.idx}),H=v.definition.concat([le],ct(p)),L={idx:E,def:H,ruleStack:m,occurrenceStack:S};d.push(L)}else if(v instanceof Wt)for(var se=v.definition.length-1;se>=0;se--){var ie=v.definition[se],ce={idx:E,def:ie.definition.concat(ct(p)),ruleStack:m,occurrenceStack:S};d.push(ce),d.push(a)}else if(v instanceof bt)d.push({idx:E,def:v.definition.concat(ct(p)),ruleStack:m,occurrenceStack:S});else if(v instanceof ss)d.push(dR(v,E,m,S));else throw Error("non exhaustive match")}}return c}function dR(s,e,t,r){var n=Ot(t);n.push(s.name);var i=Ot(r);return i.push(1),{idx:e,def:s.definition,ruleStack:n,occurrenceStack:i}}var Sh=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ie;(function(s){s[s.OPTION=0]="OPTION",s[s.REPETITION=1]="REPETITION",s[s.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",s[s.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",s[s.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",s[s.ALTERNATION=5]="ALTERNATION"})(Ie||(Ie={}));function fR(s){if(s instanceof ht)return Ie.OPTION;if(s instanceof je)return Ie.REPETITION;if(s instanceof rr)return Ie.REPETITION_MANDATORY;if(s instanceof nr)return Ie.REPETITION_MANDATORY_WITH_SEPARATOR;if(s instanceof Ht)return Ie.REPETITION_WITH_SEPARATOR;if(s instanceof Wt)return Ie.ALTERNATION;throw Error("non exhaustive match")}function pR(s,e,t,r,n,i){var a=ru(s,e,t),o=wh(a)?$i:Ca;return i(a,r,o,n)}function mR(s,e,t,r,n,i){var a=nu(s,e,n,t),o=wh(a)?$i:Ca;return i(a[0],o,r)}function gR(s,e,t,r){var n=s.length,i=Jt(s,function(u){return Jt(u,function(l){return l.length===1})});if(e)return function(u){for(var l=B(u,function(w){return w.GATE}),c=0;c<n;c++){var d=s[c],f=d.length,p=l[c];if(!(p!==void 0&&p.call(this)===!1))e:for(var E=0;E<f;E++){for(var m=d[E],S=m.length,v=0;v<S;v++){var A=this.LA(v+1);if(t(A,m[v])===!1)continue e}return c}}};if(i&&!r){var a=B(s,function(u){return Mt(u)}),o=dt(a,function(u,l,c){return $(l,function(d){Y(u,d.tokenTypeIdx)||(u[d.tokenTypeIdx]=c),$(d.categoryMatches,function(f){Y(u,f)||(u[f]=c)})}),u},[]);return function(){var u=this.LA(1);return o[u.tokenTypeIdx]}}else return function(){for(var u=0;u<n;u++){var l=s[u],c=l.length;e:for(var d=0;d<c;d++){for(var f=l[d],p=f.length,E=0;E<p;E++){var m=this.LA(E+1);if(t(m,f[E])===!1)continue e}return u}}}}function ER(s,e,t){var r=Jt(s,function(l){return l.length===1}),n=s.length;if(r&&!t){var i=Mt(s);if(i.length===1&&we(i[0].categoryMatches)){var a=i[0],o=a.tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===o}}else{var u=dt(i,function(l,c,d){return l[c.tokenTypeIdx]=!0,$(c.categoryMatches,function(f){l[f]=!0}),l},[]);return function(){var l=this.LA(1);return u[l.tokenTypeIdx]===!0}}}else return function(){e:for(var l=0;l<n;l++){for(var c=s[l],d=c.length,f=0;f<d;f++){var p=this.LA(f+1);if(e(p,c[f])===!1)continue e}return!0}return!1}}var RR=function(s){Sh(e,s);function e(t,r,n){var i=s.call(this)||this;return i.topProd=t,i.targetOccurrence=r,i.targetProdType=n,i}return e.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},e.prototype.checkIsTarget=function(t,r,n,i){return t.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1},e.prototype.walkOption=function(t,r,n){this.checkIsTarget(t,Ie.OPTION,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkAtLeastOne=function(t,r,n){this.checkIsTarget(t,Ie.REPETITION_MANDATORY,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkAtLeastOneSep=function(t,r,n){this.checkIsTarget(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkMany=function(t,r,n){this.checkIsTarget(t,Ie.REPETITION,r,n)||s.prototype.walkOption.call(this,t,r,n)},e.prototype.walkManySep=function(t,r,n){this.checkIsTarget(t,Ie.REPETITION_WITH_SEPARATOR,r,n)||s.prototype.walkOption.call(this,t,r,n)},e}(wa),Ah=function(s){Sh(e,s);function e(t,r,n){var i=s.call(this)||this;return i.targetOccurrence=t,i.targetProdType=r,i.targetRef=n,i.result=[],i}return e.prototype.checkIsTarget=function(t,r){t.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)},e.prototype.visitOption=function(t){this.checkIsTarget(t,Ie.OPTION)},e.prototype.visitRepetition=function(t){this.checkIsTarget(t,Ie.REPETITION)},e.prototype.visitRepetitionMandatory=function(t){this.checkIsTarget(t,Ie.REPETITION_MANDATORY)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.checkIsTarget(t,Ie.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.visitRepetitionWithSeparator=function(t){this.checkIsTarget(t,Ie.REPETITION_WITH_SEPARATOR)},e.prototype.visitAlternation=function(t){this.checkIsTarget(t,Ie.ALTERNATION)},e}(In);function yl(s){for(var e=new Array(s),t=0;t<s;t++)e[t]=[];return e}function za(s){for(var e=[""],t=0;t<s.length;t++){for(var r=s[t],n=[],i=0;i<e.length;i++){var a=e[i];n.push(a+"_"+r.tokenTypeIdx);for(var o=0;o<r.categoryMatches.length;o++){var u="_"+r.categoryMatches[o];n.push(a+u)}}e=n}return e}function yR(s,e,t){for(var r=0;r<s.length;r++)if(r!==t)for(var n=s[r],i=0;i<e.length;i++){var a=e[i];if(n[a]===!0)return!1}return!0}function Ch(s,e){for(var t=B(s,function(c){return fo([c],1)}),r=yl(t.length),n=B(t,function(c){var d={};return $(c,function(f){var p=za(f.partialPath);$(p,function(E){d[E]=!0})}),d}),i=t,a=1;a<=e;a++){var o=i;i=yl(o.length);for(var u=function(c){for(var d=o[c],f=0;f<d.length;f++){var p=d[f].partialPath,E=d[f].suffixDef,m=za(p),S=yR(n,m,c);if(S||we(E)||p.length===e){var v=r[c];if(po(v,p)===!1){v.push(p);for(var A=0;A<m.length;A++){var w=m[A];n[c][w]=!0}}}else{var I=fo(E,a+1,p);i[c]=i[c].concat(I),$(I,function(O){var _=za(O.partialPath);$(_,function(x){n[c][x]=!0})})}}},l=0;l<o.length;l++)u(l)}return r}function ru(s,e,t,r){var n=new Ah(s,Ie.ALTERNATION,r);return e.accept(n),Ch(n.result,t)}function nu(s,e,t,r){var n=new Ah(s,t);e.accept(n);var i=n.result,a=new RR(e,s,t),o=a.startWalking(),u=new bt({definition:i}),l=new bt({definition:o});return Ch([u,l],r)}function po(s,e){e:for(var t=0;t<s.length;t++){var r=s[t];if(r.length===e.length){for(var n=0;n<r.length;n++){var i=e[n],a=r[n],o=i===a||a.categoryMatchesMap[i.tokenTypeIdx]!==void 0;if(o===!1)continue e}return!0}}return!1}function NR(s,e){return s.length<e.length&&Jt(s,function(t,r){var n=e[r];return t===n||n.categoryMatchesMap[t.tokenTypeIdx]})}function wh(s){return Jt(s,function(e){return Jt(e,function(t){return Jt(t,function(r){return we(r.categoryMatches)})})})}var su=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function TR(s,e,t,r,n,i){var a=B(s,function(A){return SR(A,n)}),o=B(s,function(A){return Oh(A,A,n)}),u=[],l=[],c=[];Jt(o,we)&&(u=B(s,function(A){return xR(A,n)}),l=B(s,function(A){return _R(A,e,r,n)}),c=UR(s,e,n));var d=VR(s,t,n),f=B(t,function(A){return MR(A,n)}),p=vR(s,n),E=BR(s,n),m=B(s,function(A){return FR(A,n)}),S=B(s,function(A){return wR(A,n)}),v=B(s,function(A){return OR(A,s,i,n)});return Mt(a.concat(f,p,E,c,o,u,l,d,m,S,v))}function vR(s,e){var t=[];return $(s,function(r){var n=new tu("");r.accept(n);var i=B(n.result,function(a){return a.orgProd});t.push(B(i,function(a){return IR(r,a,e)}))}),Mt(t)}function SR(s,e){var t=new CR;s.accept(t);var r=t.allProductions,n=oh(r,AR),i=sr(n,function(o){return o.length>1}),a=B(gt(i),function(o){var u=er(o),l=e.buildDuplicateFoundError(s,o),c=or(u),d={message:l,type:st.DUPLICATE_PRODUCTIONS,ruleName:s.name,dslName:c,occurrence:u.idx},f=Ih(u);return f&&(d.parameter=f),d});return a}function AR(s){return or(s)+"_#_"+s.idx+"_#_"+Ih(s)}function Ih(s){return s instanceof Fe?s.terminalType.name:s instanceof Gt?s.nonTerminalName:""}var CR=function(s){su(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.allProductions=[],t}return e.prototype.visitNonTerminal=function(t){this.allProductions.push(t)},e.prototype.visitOption=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e.prototype.visitAlternation=function(t){this.allProductions.push(t)},e.prototype.visitTerminal=function(t){this.allProductions.push(t)},e}(In),Cn=/^[a-zA-Z_]\w*$/,Mh=new RegExp(Cn.source.replace("^","^\\$"));function wR(s,e){var t=[],r=s.name;return r.match(Cn)||t.push({message:e.buildInvalidRuleNameError({topLevelRule:s,expectedPattern:Cn}),type:st.INVALID_RULE_NAME,ruleName:r}),t}function IR(s,e,t){var r=[],n;return e.name.match(Mh)||(n=t.buildInvalidNestedRuleNameError(s,e),r.push({message:n,type:st.INVALID_NESTED_RULE_NAME,ruleName:s.name})),r}function MR(s,e){var t=[],r=s.name;return r.match(Cn)||t.push({message:e.buildTokenNameError({tokenType:s,expectedPattern:Cn}),type:st.INVALID_TOKEN_NAME}),t}function OR(s,e,t,r){var n=[],i=dt(e,function(o,u){return u.name===s.name?o+1:o},0);if(i>1){var a=r.buildDuplicateRuleNameError({topLevelRule:s,grammarName:t});n.push({message:a,type:st.DUPLICATE_RULE_NAME,ruleName:s.name})}return n}function bR(s,e,t){var r=[],n;return Qe(e,s)||(n="Invalid rule override, rule: ->"+s+"<- cannot be overridden in the grammar: ->"+t+"<-as it is not defined in any of the super grammars ",r.push({message:n,type:st.INVALID_RULE_OVERRIDE,ruleName:s})),r}function Oh(s,e,t,r){r===void 0&&(r=[]);var n=[],i=_i(e.definition);if(we(i))return[];var a=s.name,o=Qe(i,s);o&&n.push({message:t.buildLeftRecursionError({topLevelRule:s,leftRecursionPath:r}),type:st.LEFT_RECURSION,ruleName:a});var u=va(i,r.concat([s])),l=B(u,function(c){var d=Ot(r);return d.push(c),Oh(s,c,t,d)});return n.concat(Mt(l))}function _i(s){var e=[];if(we(s))return e;var t=er(s);if(t instanceof Gt)e.push(t.referencedRule);else if(t instanceof bt||t instanceof ht||t instanceof rr||t instanceof nr||t instanceof Ht||t instanceof je)e=e.concat(_i(t.definition));else if(t instanceof Wt)e=Mt(B(t.definition,function(a){return _i(a.definition)}));else if(!(t instanceof Fe))throw Error("non exhaustive match");var r=Xi(t),n=s.length>1;if(r&&n){var i=ct(s);return e.concat(_i(i))}else return e}var iu=function(s){su(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.alternations=[],t}return e.prototype.visitAlternation=function(t){this.alternations.push(t)},e}(In);function xR(s,e){var t=new iu;s.accept(t);var r=t.alternations,n=dt(r,function(i,a){var o=ks(a.definition),u=B(o,function(l,c){var d=vh([l],[],null,1);return we(d)?{message:e.buildEmptyAlternationError({topLevelRule:s,alternation:a,emptyChoiceIdx:c}),type:st.NONE_LAST_EMPTY_ALT,ruleName:s.name,occurrence:a.idx,alternative:c+1}:null});return i.concat(ei(u))},[]);return n}function _R(s,e,t,r){var n=new iu;s.accept(n);var i=n.alternations,a=t[s.name];a&&(i=Sn(i,function(u){return a[or(u)+(u.idx===0?"":u.idx)]})),i=Sn(i,function(u){return u.ignoreAmbiguities===!0});var o=dt(i,function(u,l){var c=l.idx,d=l.maxLookahead||e,f=ru(c,s,d,l),p=PR(f,l,s,r),E=DR(f,l,s,r);return u.concat(p,E)},[]);return o}var LR=function(s){su(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.allProductions=[],t}return e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e}(In);function FR(s,e){var t=new iu;s.accept(t);var r=t.alternations,n=dt(r,function(i,a){return a.definition.length>255&&i.push({message:e.buildTooManyAlternativesError({topLevelRule:s,alternation:a}),type:st.TOO_MANY_ALTS,ruleName:s.name,occurrence:a.idx}),i},[]);return n}function UR(s,e,t){var r=[];return $(s,function(n){var i=new LR;n.accept(i);var a=i.allProductions;$(a,function(o){var u=fR(o),l=o.maxLookahead||e,c=o.idx,d=nu(c,n,u,l),f=d[0];if(we(Mt(f))){var p=t.buildEmptyRepetitionError({topLevelRule:n,repetition:o});r.push({message:p,type:st.NO_NON_EMPTY_LOOKAHEAD,ruleName:n.name})}})}),r}function PR(s,e,t,r){var n=[],i=dt(s,function(o,u,l){return e.definition[l].ignoreAmbiguities===!0||$(u,function(c){var d=[l];$(s,function(f,p){l!==p&&po(f,c)&&e.definition[p].ignoreAmbiguities!==!0&&d.push(p)}),d.length>1&&!po(n,c)&&(n.push(c),o.push({alts:d,path:c}))}),o},[]),a=B(i,function(o){var u=B(o.alts,function(c){return c+1}),l=r.buildAlternationAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:u,prefixPath:o.path});return{message:l,type:st.AMBIGUOUS_ALTS,ruleName:t.name,occurrence:e.idx,alternatives:[o.alts]}});return a}function DR(s,e,t,r){var n=[],i=dt(s,function(a,o,u){var l=B(o,function(c){return{idx:u,path:c}});return a.concat(l)},[]);return $(i,function(a){var o=e.definition[a.idx];if(o.ignoreAmbiguities!==!0){var u=a.idx,l=a.path,c=qg(i,function(f){return e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<u&&NR(f.path,l)}),d=B(c,function(f){var p=[f.idx+1,u+1],E=e.idx===0?"":e.idx,m=r.buildAlternationPrefixAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:p,prefixPath:f.path});return{message:m,type:st.AMBIGUOUS_PREFIX_ALTS,ruleName:t.name,occurrence:E,alternatives:p}});n=n.concat(d)}}),n}function VR(s,e,t){var r=[],n=B(e,function(i){return i.name});return $(s,function(i){var a=i.name;if(Qe(n,a)){var o=t.buildNamespaceConflictError(i);r.push({message:o,type:st.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:a})}}),r}function BR(s,e){var t=[];return $(s,function(r){var n=new tu("");r.accept(n);var i=oh(n.result,function(o){return o.name}),a=sr(i,function(o){return o.length>1});$(gt(a),function(o){var u=B(o,function(c){return c.orgProd}),l=e.buildDuplicateNestedRuleNameError(r,u);t.push({message:l,type:st.DUPLICATE_NESTED_NAME,ruleName:r.name})})}),t}var bh={buildMismatchTokenMessage:function(s){var e=s.expected,t=s.actual;s.previous,s.ruleName;var r=yh(e),n=r?"--> "+jn(e)+" <--":"token of type --> "+e.name+" <--",i="Expecting "+n+" but found --> '"+t.image+"' <--";return i},buildNotAllInputParsedMessage:function(s){var e=s.firstRedundant;return s.ruleName,"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage:function(s){var e=s.expectedPathsPerAlt,t=s.actual;s.previous;var r=s.customUserDescription;s.ruleName;var n="Expecting: ",i=er(t).image,a=`
but found: '`+i+"'";if(r)return n+r+a;var o=dt(e,function(d,f){return d.concat(f)},[]),u=B(o,function(d){return"["+B(d,function(f){return jn(f)}).join(", ")+"]"}),l=B(u,function(d,f){return"  "+(f+1)+". "+d}),c=`one of these possible Token sequences:
`+l.join(`
`);return n+c+a},buildEarlyExitMessage:function(s){var e=s.expectedIterationPaths,t=s.actual,r=s.customUserDescription;s.ruleName;var n="Expecting: ",i=er(t).image,a=`
but found: '`+i+"'";if(r)return n+r+a;var o=B(e,function(l){return"["+B(l,function(c){return jn(c)}).join(",")+"]"}),u=`expecting at least one iteration which starts with one of these possible Token sequences::
  `+("<"+o.join(" ,")+">");return n+u+a}};Object.freeze(bh);var kR={buildRuleNotFoundError:function(s,e){var t="Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+s.name+"<-";return t}},au={buildDuplicateFoundError:function(s,e){function t(c){return c instanceof Fe?c.terminalType.name:c instanceof Gt?c.nonTerminalName:""}var r=s.name,n=er(e),i=n.idx,a=or(n),o=t(n),u=i>0,l="->"+a+(u?i:"")+"<- "+(o?"with argument: ->"+o+"<-":"")+`
                  appears more than once (`+e.length+" times) in the top level rule: ->"+r+`<-.                  
                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildInvalidNestedRuleNameError:function(s,e){var t="Invalid nested rule name: ->"+e.name+"<- inside rule: ->"+s.name+`<-
`+("it must match the pattern: ->"+Mh.toString()+`<-.
`)+"Note that this means a nested rule name must start with the '$'(dollar) sign.";return t},buildDuplicateNestedRuleNameError:function(s,e){var t=er(e).name,r="Duplicate nested rule name: ->"+t+"<- inside rule: ->"+s.name+`<-
A nested name must be unique in the scope of a top level grammar rule.`;return r},buildNamespaceConflictError:function(s){var e=`Namespace conflict found in grammar.
`+("The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+s.name+`>.
`)+`To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`;return e},buildAlternationPrefixAmbiguityError:function(s){var e=B(s.prefixPath,function(n){return jn(n)}).join(", "),t=s.alternation.idx===0?"":s.alternation.idx,r="Ambiguous alternatives: <"+s.ambiguityIndices.join(" ,")+`> due to common lookahead prefix
`+("in <OR"+t+"> inside <"+s.topLevelRule.name+`> Rule,
`)+("<"+e+`> may appears as a prefix path in all these alternatives.
`)+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`;return r},buildAlternationAmbiguityError:function(s){var e=B(s.prefixPath,function(n){return jn(n)}).join(", "),t=s.alternation.idx===0?"":s.alternation.idx,r="Ambiguous Alternatives Detected: <"+s.ambiguityIndices.join(" ,")+"> in <OR"+t+">"+(" inside <"+s.topLevelRule.name+`> Rule,
`)+("<"+e+`> may appears as a prefix path in all these alternatives.
`);return r=r+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError:function(s){var e=or(s.repetition);s.repetition.idx!==0&&(e+=s.repetition.idx);var t="The repetition <"+e+"> within Rule <"+s.topLevelRule.name+`> can never consume any tokens.
This could lead to an infinite loop.`;return t},buildTokenNameError:function(s){var e=s.tokenType.name,t="Invalid Grammar Token name: ->"+e+"<- it must match the pattern: ->"+s.expectedPattern.toString()+"<-";return t},buildEmptyAlternationError:function(s){var e="Ambiguous empty alternative: <"+(s.emptyChoiceIdx+1)+">"+(" in <OR"+s.alternation.idx+"> inside <"+s.topLevelRule.name+`> Rule.
`)+"Only the last alternative may be an empty alternative.";return e},buildTooManyAlternativesError:function(s){var e=`An Alternation cannot have more than 256 alternatives:
`+("<OR"+s.alternation.idx+"> inside <"+s.topLevelRule.name+`> Rule.
 has `+(s.alternation.definition.length+1)+" alternatives.");return e},buildLeftRecursionError:function(s){var e=s.topLevelRule.name,t=B(s.leftRecursionPath,function(i){return i.name}),r=e+" --> "+t.concat([e]).join(" --> "),n=`Left Recursion found in grammar.
`+("rule: <"+e+`> can be invoked from itself (directly or indirectly)
`)+(`without consuming any Tokens. The grammar path that causes this is: 
 `+r+`
`)+` To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring.`;return n},buildInvalidRuleNameError:function(s){var e=s.topLevelRule.name,t=s.expectedPattern.toString(),r="Invalid grammar rule name: ->"+e+"<- it must match the pattern: ->"+t+"<-";return r},buildDuplicateRuleNameError:function(s){var e;s.topLevelRule instanceof ss?e=s.topLevelRule.name:e=s.topLevelRule;var t="Duplicate definition, rule: ->"+e+"<- is already defined in the grammar: ->"+s.grammarName+"<-";return t}},GR=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function HR(s,e){var t=new WR(s,e);return t.resolveRefs(),t.errors}var WR=function(s){GR(e,s);function e(t,r){var n=s.call(this)||this;return n.nameToTopRule=t,n.errMsgProvider=r,n.errors=[],n}return e.prototype.resolveRefs=function(){var t=this;$(gt(this.nameToTopRule),function(r){t.currTopLevel=r,r.accept(t)})},e.prototype.visitNonTerminal=function(t){var r=this.nameToTopRule[t.nonTerminalName];if(r)t.referencedRule=r;else{var n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:n,type:st.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}},e}(In);function zR(s){s=Sa(s,{errMsgProvider:kR});var e={};return $(s.rules,function(t){e[t.name]=t}),HR(e,s.errMsgProvider)}function jR(s){return s=Sa(s,{errMsgProvider:au,ignoredIssues:{}}),TR(s.rules,s.maxLookahead,s.tokenTypes,s.ignoredIssues,s.errMsgProvider,s.grammarName)}var xh="MismatchedTokenException",_h="NoViableAltException",Lh="EarlyExitException",Fh="NotAllInputParsedException",Uh=[xh,_h,Lh,Fh];Object.freeze(Uh);function qi(s){return Qe(Uh,s.name)}function ou(s,e,t){this.name=xh,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}ou.prototype=Error.prototype;function Ph(s,e,t){this.name=_h,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}Ph.prototype=Error.prototype;function Dh(s,e){this.name=Fh,this.message=s,this.token=e,this.resyncedTokens=[]}Dh.prototype=Error.prototype;function Vh(s,e,t){this.name=Lh,this.message=s,this.token=e,this.previousToken=t,this.resyncedTokens=[]}Vh.prototype=Error.prototype;var ja={},Bh="InRuleRecoveryException";function kh(s){this.name=Bh,this.message=s}kh.prototype=Error.prototype;var YR=function(){function s(){}return s.prototype.initRecoverable=function(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Y(e,"recoveryEnabled")?e.recoveryEnabled:At.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=$R)},s.prototype.getTokenToInsert=function(e){var t=eu(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},s.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},s.prototype.tryInRepetitionRecovery=function(e,t,r,n){for(var i=this,a=this.findReSyncTokenType(),o=this.exportLexerState(),u=[],l=!1,c=this.LA(1),d=this.LA(1),f=function(){var p=i.LA(0),E=i.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:c,previous:p,ruleName:i.getCurrRuleFullName()}),m=new ou(E,c,i.LA(0));m.resyncedTokens=ks(u),i.SAVE_ERROR(m)};!l;)if(this.tokenMatcher(d,n)){f();return}else if(r.call(this)){f(),e.apply(this,t);return}else this.tokenMatcher(d,a)?l=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,u));this.importLexerState(o)},s.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,r){return!(r===!1||e===void 0||t===void 0||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))},s.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t),n=this.getNextPossibleTokenTypes(r);return n},s.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t)){var r=this.getTokenToInsert(e);return r}if(this.canRecoverWithSingleTokenDeletion(e)){var n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new kh("sad sad panda")},s.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},s.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e)||we(t))return!1;var n=this.LA(1),i=Jn(t,function(a){return r.tokenMatcher(n,a)})!==void 0;return i},s.prototype.canRecoverWithSingleTokenDeletion=function(e){var t=this.tokenMatcher(this.LA(2),e);return t},s.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return Qe(r,e)},s.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var n=t.tokenType;if(Qe(e,n))return n;t=this.LA(r),r++}},s.prototype.getCurrFollowKey=function(){if(this.RULE_STACK.length===1)return ja;var e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(r)}},s.prototype.buildFullFollowKeyStack=function(){var e=this,t=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return we(this.LAST_EXPLICIT_RULE_STACK)||(t=B(this.LAST_EXPLICIT_RULE_STACK,function(n){return e.RULE_STACK[n]}),r=B(this.LAST_EXPLICIT_RULE_STACK,function(n){return e.RULE_OCCURRENCE_STACK[n]})),B(t,function(n,i){return i===0?ja:{ruleName:e.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:e.shortRuleNameToFullName(t[i-1])}})},s.prototype.flattenFollowSet=function(){var e=this,t=B(this.buildFullFollowKeyStack(),function(r){return e.getFollowSetFromFollowKey(r)});return Mt(t)},s.prototype.getFollowSetFromFollowKey=function(e){if(e===ja)return[An];var t=e.ruleName+e.idxInCallingRule+Nh+e.inRule;return this.resyncFollows[t]},s.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,An)||t.push(e),t},s.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return ks(t)},s.prototype.attemptInRepetitionRecovery=function(e,t,r,n,i,a,o){},s.prototype.getCurrentGrammarPath=function(e,t){var r=this.getHumanReadableRuleStack(),n=Ot(this.RULE_OCCURRENCE_STACK),i={ruleStack:r,occurrenceStack:n,lastTok:e,lastTokOccurrence:t};return i},s.prototype.getHumanReadableRuleStack=function(){var e=this;return we(this.LAST_EXPLICIT_RULE_STACK)?B(this.RULE_STACK,function(t){return e.shortRuleNameToFullName(t)}):B(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])})},s}();function $R(s,e,t,r,n,i,a){var o=this.getKeyForAutomaticLookahead(r,n),u=this.firstAfterRepMap[o];if(u===void 0){var l=this.getCurrRuleFullName(),c=this.getGAstProductions()[l],d=new i(c,n);u=d.startWalking(),this.firstAfterRepMap[o]=u}var f=u.token,p=u.occurrence,E=u.isEndOfRule;this.RULE_STACK.length===1&&E&&f===void 0&&(f=An,p=1),this.shouldInRepetitionRecoveryBeTried(f,p,a)&&this.tryInRepetitionRecovery(s,e,t,f)}var XR=function(){function s(){}return s.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=Y(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:At.dynamicTokensEnabled,this.maxLookahead=Y(e,"maxLookahead")?e.maxLookahead:At.maxLookahead,this.lookAheadFuncsCache=Zu()?new Map:[],Zu()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},s.prototype.preComputeLookaheadFunctions=function(e){var t=this;$(e,function(r){t.TRACE_INIT(r.name+" Rule Lookahead",function(){var n=XE(r),i=n.alternation,a=n.repetition,o=n.option,u=n.repetitionMandatory,l=n.repetitionMandatoryWithSeparator,c=n.repetitionWithSeparator;$(i,function(d){var f=d.idx===0?"":d.idx;t.TRACE_INIT(""+or(d)+f,function(){var p=pR(d.idx,r,d.maxLookahead||t.maxLookahead,d.hasPredicates,t.dynamicTokensEnabled,t.lookAheadBuilderForAlternatives),E=bs(t.fullRuleNameToShort[r.name],Yn,d.idx);t.setLaFuncCache(E,p)})}),$(a,function(d){t.computeLookaheadFunc(r,d.idx,Is,Ie.REPETITION,d.maxLookahead,or(d))}),$(o,function(d){t.computeLookaheadFunc(r,d.idx,Ki,Ie.OPTION,d.maxLookahead,or(d))}),$(u,function(d){t.computeLookaheadFunc(r,d.idx,Ms,Ie.REPETITION_MANDATORY,d.maxLookahead,or(d))}),$(l,function(d){t.computeLookaheadFunc(r,d.idx,Gn,Ie.REPETITION_MANDATORY_WITH_SEPARATOR,d.maxLookahead,or(d))}),$(c,function(d){t.computeLookaheadFunc(r,d.idx,Os,Ie.REPETITION_WITH_SEPARATOR,d.maxLookahead,or(d))})})})},s.prototype.computeLookaheadFunc=function(e,t,r,n,i,a){var o=this;this.TRACE_INIT(""+a+(t===0?"":t),function(){var u=mR(t,e,i||o.maxLookahead,o.dynamicTokensEnabled,n,o.lookAheadBuilderForOptional),l=bs(o.fullRuleNameToShort[e.name],r,t);o.setLaFuncCache(l,u)})},s.prototype.lookAheadBuilderForOptional=function(e,t,r){return ER(e,t,r)},s.prototype.lookAheadBuilderForAlternatives=function(e,t,r,n){return gR(e,t,r,n)},s.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return bs(r,e,t)},s.prototype.getLaFuncFromCache=function(e){},s.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},s.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},s.prototype.setLaFuncCache=function(e,t){},s.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},s.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},s}();function KR(s){return Ma(s.constructor)}var qR=/^\s*function\s*(\S*)\s*\(/,Nl="name";function Ma(s){var e=s.name;if(e)return e;var t=s.toString().match(qR)[1];return t}function Gh(s,e){var t=Object.getOwnPropertyDescriptor(s,Nl);return tr(t)||t.configurable?(Object.defineProperty(s,Nl,{enumerable:!1,configurable:!0,writable:!1,value:e}),!0):!1}function QR(s,e){for(var t=Gr(s),r=t.length,n=0;n<r;n++)for(var i=t[n],a=s[i],o=a.length,u=0;u<o;u++){var l=a[u];l.tokenTypeIdx===void 0&&(l.fullName!==void 0?this[l.fullName](l.children,e):this[l.name](l.children,e))}}function ZR(s,e){var t=function(){};Gh(t,s+"BaseSemantics");var r={visit:function(n,i){if(cr(n)&&(n=n[0]),!tr(n))return n.fullName!==void 0?this[n.fullName](n.children,i):this[n.name](n.children,i)},validateVisitor:function(){var n=ey(this,e);if(!we(n)){var i=B(n,function(a){return a.msg});throw Error("Errors Detected in CST Visitor <"+Ma(this.constructor)+`>:
	`+(""+i.join(`

`).replace(/\n/g,`
	`)))}}};return t.prototype=r,t.prototype.constructor=t,t._RULE_NAMES=e,t}function JR(s,e,t){var r=function(){};Gh(r,s+"BaseSemanticsWithDefaults");var n=Object.create(t.prototype);return $(e,function(i){n[i]=QR}),r.prototype=n,r.prototype.constructor=r,r}var Qi;(function(s){s[s.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",s[s.MISSING_METHOD=1]="MISSING_METHOD"})(Qi||(Qi={}));function ey(s,e){var t=ty(s,e),r=ny(s,e);return t.concat(r)}function ty(s,e){var t=B(e,function(r){if(!on(s[r]))return{msg:"Missing visitor method: <"+r+"> on "+Ma(s.constructor)+" CST Visitor.",type:Qi.MISSING_METHOD,methodName:r}});return ei(t)}var ry=["constructor","visit","validateVisitor"];function ny(s,e){var t=[];for(var r in s)Cn.test(r)&&on(s[r])&&!Qe(ry,r)&&!Qe(e,r)&&t.push({msg:"Redundant visitor method: <"+r+"> on "+Ma(s.constructor)+` CST Visitor
There is no Grammar Rule corresponding to this method's name.
`+("For utility methods on visitor classes use methods names that do not match /"+Cn.source+"/."),type:Qi.REDUNDANT_METHOD,methodName:r});return t}var sy=function(){function s(){}return s.prototype.initTreeBuilder=function(e){if(this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=Y(e,"outputCst")?e.outputCst:At.outputCst,this.nodeLocationTracking=Y(e,"nodeLocationTracking")?e.nodeLocationTracking:At.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Je,this.cstFinallyStateUpdate=Je,this.cstPostTerminal=Je,this.cstPostNonTerminal=Je,this.cstPostRule=Je,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=ml,this.setNodeLocationFromNode=ml,this.cstPostRule=Je,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=pl,this.setNodeLocationFromNode=pl,this.cstPostRule=Je,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Je,this.setNodeLocationFromNode=Je,this.cstPostRule=Je,this.setInitialNodeLocation=Je;else throw Error('Invalid <nodeLocationTracking> config option: "'+e.nodeLocationTracking+'"')},s.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},s.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},s.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},s.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},s.prototype.cstNestedInvocationStateUpdate=function(e,t){var r={name:e,fullName:this.shortRuleNameToFull[this.getLastExplicitRuleShortName()]+e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},s.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1);var r={name:e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},s.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},s.prototype.cstNestedFinallyStateUpdate=function(){var e=this.CST_STACK.pop();this.cstPostRule(e)},s.prototype.cstPostRuleFull=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?(r.endOffset=t.endOffset,r.endLine=t.endLine,r.endColumn=t.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)},s.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?r.endOffset=t.endOffset:r.startOffset=NaN},s.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];aR(r,t,e),this.setNodeLocationFromToken(r.location,t)},s.prototype.cstPostNonTerminal=function(e,t){if(this.isBackTracking()!==!0){var r=this.CST_STACK[this.CST_STACK.length-1];gl(r,t,e),this.setNodeLocationFromNode(r.location,e.location)}},s.prototype.getBaseCstVisitorConstructor=function(){if(tr(this.baseCstVisitorConstructor)){var e=ZR(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},s.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(tr(this.baseCstVisitorWithDefaultsConstructor)){var e=JR(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},s.prototype.nestedRuleBeforeClause=function(e,t){var r;if(e.NAME!==void 0)return r=e.NAME,this.nestedRuleInvocationStateUpdate(r,t),r},s.prototype.nestedAltBeforeClause=function(e,t,r,n){var i=this.getLastExplicitRuleShortName(),a=Th(i,r,t,n),o;if(e.NAME!==void 0)return o=e.NAME,this.nestedRuleInvocationStateUpdate(o,a),{shortName:a,nestedName:o}},s.prototype.nestedRuleFinallyClause=function(e,t){var r=this.CST_STACK,n=r[r.length-1];this.nestedRuleFinallyStateUpdate();var i=r[r.length-1];gl(i,t,n),this.setNodeLocationFromNode(i.location,n.location)},s.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},s.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},s.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},s.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},s.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},s.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},s.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},s.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},s}(),iy=function(){function s(){}return s.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(s.prototype,"input",{get:function(){return this.tokVector},set:function(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),s.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Ji},s.prototype.LA=function(e){var t=this.currIdx+e;return t<0||this.tokVectorLength<=t?Ji:this.tokVector[t]},s.prototype.consumeToken=function(){this.currIdx++},s.prototype.exportLexerState=function(){return this.currIdx},s.prototype.importLexerState=function(e){this.currIdx=e},s.prototype.resetLexerState=function(){this.currIdx=-1},s.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},s.prototype.getLexerPosition=function(){return this.exportLexerState()},s}(),ay=function(){function s(){}return s.prototype.ACTION=function(e){return e.call(this)},s.prototype.consume=function(e,t,r){return this.consumeInternal(t,e,r)},s.prototype.subrule=function(e,t,r){return this.subruleInternal(t,e,r)},s.prototype.option=function(e,t){return this.optionInternal(t,e)},s.prototype.or=function(e,t){return this.orInternal(t,e)},s.prototype.many=function(e,t){return this.manyInternal(e,t)},s.prototype.atLeastOne=function(e,t){return this.atLeastOneInternal(e,t)},s.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},s.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},s.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},s.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},s.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},s.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},s.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},s.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},s.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},s.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},s.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},s.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},s.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},s.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},s.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},s.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},s.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},s.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},s.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},s.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},s.prototype.OPTION=function(e){return this.optionInternal(e,0)},s.prototype.OPTION1=function(e){return this.optionInternal(e,1)},s.prototype.OPTION2=function(e){return this.optionInternal(e,2)},s.prototype.OPTION3=function(e){return this.optionInternal(e,3)},s.prototype.OPTION4=function(e){return this.optionInternal(e,4)},s.prototype.OPTION5=function(e){return this.optionInternal(e,5)},s.prototype.OPTION6=function(e){return this.optionInternal(e,6)},s.prototype.OPTION7=function(e){return this.optionInternal(e,7)},s.prototype.OPTION8=function(e){return this.optionInternal(e,8)},s.prototype.OPTION9=function(e){return this.optionInternal(e,9)},s.prototype.OR=function(e){return this.orInternal(e,0)},s.prototype.OR1=function(e){return this.orInternal(e,1)},s.prototype.OR2=function(e){return this.orInternal(e,2)},s.prototype.OR3=function(e){return this.orInternal(e,3)},s.prototype.OR4=function(e){return this.orInternal(e,4)},s.prototype.OR5=function(e){return this.orInternal(e,5)},s.prototype.OR6=function(e){return this.orInternal(e,6)},s.prototype.OR7=function(e){return this.orInternal(e,7)},s.prototype.OR8=function(e){return this.orInternal(e,8)},s.prototype.OR9=function(e){return this.orInternal(e,9)},s.prototype.MANY=function(e){this.manyInternal(0,e)},s.prototype.MANY1=function(e){this.manyInternal(1,e)},s.prototype.MANY2=function(e){this.manyInternal(2,e)},s.prototype.MANY3=function(e){this.manyInternal(3,e)},s.prototype.MANY4=function(e){this.manyInternal(4,e)},s.prototype.MANY5=function(e){this.manyInternal(5,e)},s.prototype.MANY6=function(e){this.manyInternal(6,e)},s.prototype.MANY7=function(e){this.manyInternal(7,e)},s.prototype.MANY8=function(e){this.manyInternal(8,e)},s.prototype.MANY9=function(e){this.manyInternal(9,e)},s.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},s.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},s.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},s.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},s.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},s.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},s.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},s.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},s.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},s.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},s.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},s.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},s.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},s.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},s.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},s.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},s.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},s.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},s.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},s.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},s.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},s.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},s.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},s.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},s.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},s.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},s.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},s.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},s.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},s.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},s.prototype.RULE=function(e,t,r){if(r===void 0&&(r=ea),Qe(this.definedRulesNames,e)){var n=au.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),i={message:n,type:st.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}this.definedRulesNames.push(e);var a=this.defineRule(e,t,r);return this[e]=a,a},s.prototype.OVERRIDE_RULE=function(e,t,r){r===void 0&&(r=ea);var n=[];n=n.concat(bR(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,n);var i=this.defineRule(e,t,r);return this[e]=i,i},s.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(n){if(qi(n))return!1;throw n}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},s.prototype.getGAstProductions=function(){return this.gastProductionsCache},s.prototype.getSerializedGastProductions=function(){return WE(gt(this.gastProductionsCache))},s}(),oy=function(){function s(){}return s.prototype.initRecognizerEngine=function(e,t){if(this.className=KR(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=$i,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Y(t,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(cr(e)){if(we(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(cr(e))this.tokensMap=dt(e,function(a,o){return a[o.name]=o,a},{});else if(Y(e,"modes")&&Jt(Mt(gt(e.modes)),BE)){var r=Mt(gt(e.modes)),n=qo(r);this.tokensMap=dt(n,function(a,o){return a[o.name]=o,a},{})}else if(Qo(e))this.tokensMap=Js(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=An;var i=Jt(gt(e),function(a){return we(a.categoryMatches)});this.tokenMatcher=i?$i:Ca,ri(gt(this.tokensMap))},s.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+`> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);var n=Y(r,"resyncEnabled")?r.resyncEnabled:ea.resyncEnabled,i=Y(r,"recoveryValueFunc")?r.recoveryValueFunc:ea.recoveryValueFunc,a=this.ruleShortNameIdx<<rR+un;this.ruleShortNameIdx++,this.shortRuleNameToFull[a]=e,this.fullRuleNameToShort[e]=a;function o(c){try{if(this.outputCst===!0){t.apply(this,c);var d=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(d),d}else return t.apply(this,c)}catch(f){return this.invokeRuleCatch(f,n,i)}finally{this.ruleFinallyStateUpdate()}}var u;u=function(c,d){return c===void 0&&(c=0),this.ruleInvocationStateUpdate(a,e,c),o.call(this,d)};var l="ruleName";return u[l]=e,u.originalGrammarAction=t,u},s.prototype.invokeRuleCatch=function(e,t,r){var n=this.RULE_STACK.length===1,i=t&&!this.isBackTracking()&&this.recoveryEnabled;if(qi(e)){var a=e;if(i){var o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))if(a.resyncedTokens=this.reSyncTo(o),this.outputCst){var u=this.CST_STACK[this.CST_STACK.length-1];return u.recoveredNode=!0,u}else return r();else{if(this.outputCst){var u=this.CST_STACK[this.CST_STACK.length-1];u.recoveredNode=!0,a.partialCstResult=u}throw a}}else{if(n)return this.moveToTerminatedState(),r();throw a}}else throw e},s.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Ki,t),n=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Ki,t);return this.optionInternalLogic(e,t,r)},s.prototype.optionInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(e.DEF!==void 0){if(a=e.DEF,o=e.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=e;if(i.call(this)===!0)return a.call(this)},s.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Ms,e),n=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Ms,e);this.atLeastOneInternalLogic(e,t,r)},s.prototype.atLeastOneInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(t.DEF!==void 0){if(a=t.DEF,o=t.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=t;if(i.call(this)===!0)for(var l=this.doSingleRepetition(a);i.call(this)===!0&&l===!0;)l=this.doSingleRepetition(a);else throw this.raiseEarlyExitException(e,Ie.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],i,Ms,e,hR)},s.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Gn,e),n=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Gn,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},s.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var n=this,i=t.DEF,a=t.SEP,o=this.getLaFuncFromCache(r);if(o.call(this)===!0){i.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),a)};this.tokenMatcher(this.LA(1),a)===!0;)this.CONSUME(a),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,a,u,i,Rl],u,Gn,e,Rl)}else throw this.raiseEarlyExitException(e,Ie.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)},s.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Is,e),n=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Is,e);return this.manyInternalLogic(e,t,r)},s.prototype.manyInternalLogic=function(e,t,r){var n=this,i=this.getLaFuncFromCache(r),a,o;if(t.DEF!==void 0){if(a=t.DEF,o=t.GATE,o!==void 0){var u=i;i=function(){return o.call(n)&&u.call(n)}}}else a=t;for(var l=!0;i.call(this)===!0&&l===!0;)l=this.doSingleRepetition(a);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],i,Is,e,cR,l)},s.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Os,e),n=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(Os,e);this.manySepFirstInternalLogic(e,t,r)},s.prototype.manySepFirstInternalLogic=function(e,t,r){var n=this,i=t.DEF,a=t.SEP,o=this.getLaFuncFromCache(r);if(o.call(this)===!0){i.call(this);for(var u=function(){return n.tokenMatcher(n.LA(1),a)};this.tokenMatcher(this.LA(1),a)===!0;)this.CONSUME(a),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,a,u,i,El],u,Os,e,El)}},s.prototype.repetitionSepSecondInternal=function(e,t,r,n,i){for(;r();)this.CONSUME(t),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,n,i],r,Gn,e,i)},s.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();e.call(this);var r=this.getLexerPosition();return r>t},s.prototype.orInternalNoCst=function(e,t){var r=cr(e)?e:e.DEF,n=this.getKeyForAutomaticLookahead(Yn,t),i=this.getLaFuncFromCache(n),a=i.call(this,r);if(a!==void 0){var o=r[a];return o.ALT.call(this)}this.raiseNoAltException(t,e.ERR_MSG)},s.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(Yn,t),n=this.nestedRuleBeforeClause(e,r);try{var i=cr(e)?e:e.DEF,a=this.getLaFuncFromCache(r),o=a.call(this,i);if(o!==void 0){var u=i[o],l=this.nestedAltBeforeClause(u,t,Yn,o);try{return u.ALT.call(this)}finally{l!==void 0&&this.nestedRuleFinallyClause(l.shortName,l.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{n!==void 0&&this.nestedRuleFinallyClause(r,n)}},s.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Dh(t,e))}},s.prototype.subruleInternal=function(e,t,r){var n;try{var i=r!==void 0?r.ARGS:void 0;return n=e.call(this,t,i),this.cstPostNonTerminal(n,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),n}catch(a){this.subruleInternalError(a,r,e.ruleName)}},s.prototype.subruleInternalError=function(e,t,r){throw qi(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,t!==void 0&&t.LABEL!==void 0?t.LABEL:r),delete e.partialCstResult),e},s.prototype.consumeInternal=function(e,t,r){var n;try{var i=this.LA(1);this.tokenMatcher(i,e)===!0?(this.consumeToken(),n=i):this.consumeInternalError(e,i,r)}catch(a){n=this.consumeInternalRecovery(e,t,a)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,n),n},s.prototype.consumeInternalError=function(e,t,r){var n,i=this.LA(0);throw r!==void 0&&r.ERR_MSG?n=r.ERR_MSG:n=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new ou(n,t,i))},s.prototype.consumeInternalRecovery=function(e,t,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){var n=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,n)}catch(i){throw i.name===Bh?r:i}}else throw r},s.prototype.saveRecogState=function(){var e=this.errors,t=Ot(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},s.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},s.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},s.prototype.isBackTracking=function(){return this.isBackTrackingStack.length!==0},s.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]},s.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull[e]},s.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),An)},s.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},s}(),uy=function(){function s(){}return s.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=Sa(e.errorMessageProvider,At.errorMessageProvider)},s.prototype.SAVE_ERROR=function(e){if(qi(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ot(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(s.prototype,"errors",{get:function(){return Ot(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),s.prototype.raiseEarlyExitException=function(e,t,r){for(var n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],a=nu(e,i,t,this.maxLookahead),o=a[0],u=[],l=1;l<=this.maxLookahead;l++)u.push(this.LA(l));var c=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:o,actual:u,previous:this.LA(0),customUserDescription:r,ruleName:n});throw this.SAVE_ERROR(new Vh(c,this.LA(1),this.LA(0)))},s.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),n=this.getGAstProductions()[r],i=ru(e,n,this.maxLookahead),a=[],o=1;o<=this.maxLookahead;o++)a.push(this.LA(o));var u=this.LA(0),l=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:a,previous:u,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Ph(l,this.LA(1),u))},s}(),ly=function(){function s(){}return s.prototype.initContentAssist=function(){},s.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache[e];if(tr(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return vh([r],t,this.tokenMatcher,this.maxLookahead)},s.prototype.getNextPossibleTokenTypes=function(e){var t=er(e.ruleStack),r=this.getGAstProductions(),n=r[t],i=new lR(n,e).startWalking();return i},s}(),Oa={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Oa);var Tl=!0,vl=Math.pow(2,un)-1,Hh=oe({name:"RECORDING_PHASE_TOKEN",pattern:It.NA});ri([Hh]);var Wh=eu(Hh,`This IToken indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Wh);var cy={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,children:{}},hy=function(){function s(){}return s.prototype.initGastRecorder=function(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1},s.prototype.enableRecording=function(){var e=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var t=function(n){var i=n>0?n:"";e["CONSUME"+i]=function(a,o){return this.consumeInternalRecord(a,n,o)},e["SUBRULE"+i]=function(a,o){return this.subruleInternalRecord(a,n,o)},e["OPTION"+i]=function(a){return this.optionInternalRecord(a,n)},e["OR"+i]=function(a){return this.orInternalRecord(a,n)},e["MANY"+i]=function(a){this.manyInternalRecord(n,a)},e["MANY_SEP"+i]=function(a){this.manySepFirstInternalRecord(n,a)},e["AT_LEAST_ONE"+i]=function(a){this.atLeastOneInternalRecord(n,a)},e["AT_LEAST_ONE_SEP"+i]=function(a){this.atLeastOneSepFirstInternalRecord(n,a)}},r=0;r<10;r++)t(r);e.consume=function(n,i,a){return this.consumeInternalRecord(i,n,a)},e.subrule=function(n,i,a){return this.subruleInternalRecord(i,n,a)},e.option=function(n,i){return this.optionInternalRecord(i,n)},e.or=function(n,i){return this.orInternalRecord(i,n)},e.many=function(n,i){this.manyInternalRecord(n,i)},e.atLeastOne=function(n,i){this.atLeastOneInternalRecord(n,i)},e.ACTION=e.ACTION_RECORD,e.BACKTRACK=e.BACKTRACK_RECORD,e.LA=e.LA_RECORD})},s.prototype.disableRecording=function(){var e=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var t=0;t<10;t++){var r=t>0?t:"";delete e["CONSUME"+r],delete e["SUBRULE"+r],delete e["OPTION"+r],delete e["OR"+r],delete e["MANY"+r],delete e["MANY_SEP"+r],delete e["AT_LEAST_ONE"+r],delete e["AT_LEAST_ONE_SEP"+r]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})},s.prototype.ACTION_RECORD=function(e){},s.prototype.BACKTRACK_RECORD=function(e,t){return function(){return!0}},s.prototype.LA_RECORD=function(e){return Ji},s.prototype.topLevelRuleRecord=function(e,t){try{var r=new ss({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}},s.prototype.optionInternalRecord=function(e,t){return ds.call(this,ht,e,t)},s.prototype.atLeastOneInternalRecord=function(e,t){ds.call(this,rr,t,e)},s.prototype.atLeastOneSepFirstInternalRecord=function(e,t){ds.call(this,nr,t,e,Tl)},s.prototype.manyInternalRecord=function(e,t){ds.call(this,je,t,e)},s.prototype.manySepFirstInternalRecord=function(e,t){ds.call(this,Ht,t,e,Tl)},s.prototype.orInternalRecord=function(e,t){return dy.call(this,e,t)},s.prototype.subruleInternalRecord=function(e,t,r){if(Zi(t),!e||Y(e,"ruleName")===!1){var n=new Error("<SUBRULE"+Sl(t)+"> argument is invalid"+(" expecting a Parser method reference but got: <"+JSON.stringify(e)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw n.KNOWN_RECORDER_ERROR=!0,n}var i=ji(this.recordingProdStack),a=e.ruleName,o=new Gt({idx:t,nonTerminalName:a,referencedRule:void 0});return i.definition.push(o),this.outputCst?cy:Oa},s.prototype.consumeInternalRecord=function(e,t,r){if(Zi(t),!Rh(e)){var n=new Error("<CONSUME"+Sl(t)+"> argument is invalid"+(" expecting a TokenType reference but got: <"+JSON.stringify(e)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw n.KNOWN_RECORDER_ERROR=!0,n}var i=ji(this.recordingProdStack),a=new Fe({idx:t,terminalType:e});return i.definition.push(a),Wh},s}();function ds(s,e,t,r){r===void 0&&(r=!1),Zi(t);var n=ji(this.recordingProdStack),i=on(e)?e:e.DEF,a=new s({definition:[],idx:t});return Y(e,"NAME")&&(a.name=e.NAME),r&&(a.separator=e.SEP),Y(e,"MAX_LOOKAHEAD")&&(a.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(a),i.call(this),n.definition.push(a),this.recordingProdStack.pop(),Oa}function dy(s,e){var t=this;Zi(e);var r=ji(this.recordingProdStack),n=cr(s)===!1,i=n===!1?s:s.DEF,a=new Wt({definition:[],idx:e,ignoreAmbiguities:n&&s.IGNORE_AMBIGUITIES===!0});Y(s,"NAME")&&(a.name=s.NAME),Y(s,"MAX_LOOKAHEAD")&&(a.maxLookahead=s.MAX_LOOKAHEAD);var o=ah(i,function(u){return on(u.GATE)});return a.hasPredicates=o,r.definition.push(a),$(i,function(u){var l=new bt({definition:[]});a.definition.push(l),Y(u,"NAME")&&(l.name=u.NAME),Y(u,"IGNORE_AMBIGUITIES")?l.ignoreAmbiguities=u.IGNORE_AMBIGUITIES:Y(u,"GATE")&&(l.ignoreAmbiguities=!0),t.recordingProdStack.push(l),u.ALT.call(t),t.recordingProdStack.pop()}),Oa}function Sl(s){return s===0?"":""+s}function Zi(s){if(s<0||s>vl){var e=new Error("Invalid DSL Method idx value: <"+s+`>
	`+("Idx value must be a none negative value smaller than "+(vl+1)));throw e.KNOWN_RECORDER_ERROR=!0,e}}var fy=function(){function s(){}return s.prototype.initPerformanceTracer=function(e){if(Y(e,"traceInitPerf")){var t=e.traceInitPerf,r=typeof t=="number";this.traceInitMaxIdent=r?t:1/0,this.traceInitPerf=r?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=At.traceInitPerf;this.traceInitIndent=-1},s.prototype.TRACE_INIT=function(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--> <"+e+">");var n=lh(t),i=n.time,a=n.value,o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(r+"<-- <"+e+"> time: "+i+"ms"),this.traceInitIndent--,a}else return t()},s}(),zh=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},s(e,t)};return function(e,t){s(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ji=eu(An,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Ji);var At=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:bh,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),ea=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),st;(function(s){s[s.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",s[s.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",s[s.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",s[s.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",s[s.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",s[s.LEFT_RECURSION=5]="LEFT_RECURSION",s[s.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",s[s.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",s[s.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",s[s.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",s[s.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",s[s.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",s[s.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",s[s.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",s[s.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"})(st||(st={}));function py(s){return s===void 0&&(s=void 0),function(){return s}}var uu=function(){function s(e,t){t===void 0&&(t=At),this.ignoredIssues=At.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1;var r=this;r.initErrorHandler(t),r.initLexerAdapter(),r.initLooksAhead(t),r.initRecognizerEngine(e,t),r.initRecoverable(t),r.initTreeBuilder(t),r.initContentAssist(),r.initGastRecorder(t),r.initPerformanceTracer(t),Y(t,"ignoredIssues")&&t.ignoredIssues!==At.ignoredIssues&&Zo(`The <ignoredIssues> IParserConfig property is soft-deprecated and will be removed in future versions.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.`),this.ignoredIssues=Y(t,"ignoredIssues")?t.ignoredIssues:At.ignoredIssues,this.skipValidations=Y(t,"skipValidations")?t.skipValidations:At.skipValidations}return s.performSelfAnalysis=function(e){e.performSelfAnalysis()},s.prototype.performSelfAnalysis=function(){var e=this;this.TRACE_INIT("performSelfAnalysis",function(){var t;e.selfAnalysisDone=!0;var r=e.className;e.TRACE_INIT("toFastProps",function(){uh(e)}),e.TRACE_INIT("Grammar Recording",function(){try{e.enableRecording(),$(e.definedRulesNames,function(i){var a=e[i],o=a.originalGrammarAction,u=void 0;e.TRACE_INIT(i+" Rule",function(){u=e.topLevelRuleRecord(i,o)}),e.gastProductionsCache[i]=u})}finally{e.disableRecording()}});var n=[];if(e.TRACE_INIT("Grammar Resolving",function(){n=zR({rules:gt(e.gastProductionsCache)}),e.definitionErrors.push.apply(e.definitionErrors,n)}),e.TRACE_INIT("Grammar Validations",function(){if(we(n)&&e.skipValidations===!1){var i=jR({rules:gt(e.gastProductionsCache),maxLookahead:e.maxLookahead,tokenTypes:gt(e.tokensMap),ignoredIssues:e.ignoredIssues,errMsgProvider:au,grammarName:r});e.definitionErrors.push.apply(e.definitionErrors,i)}}),we(e.definitionErrors)&&(e.recoveryEnabled&&e.TRACE_INIT("computeAllProdsFollows",function(){var i=eR(gt(e.gastProductionsCache));e.resyncFollows=i}),e.TRACE_INIT("ComputeLookaheadFunctions",function(){e.preComputeLookaheadFunctions(gt(e.gastProductionsCache))})),e.TRACE_INIT("expandAllNestedRuleNames",function(){var i=oR(gt(e.gastProductionsCache),e.fullRuleNameToShort);e.allRuleNames=i.allRuleNames}),!s.DEFER_DEFINITION_ERRORS_HANDLING&&!we(e.definitionErrors))throw t=B(e.definitionErrors,function(i){return i.message}),new Error(`Parser Definition Errors detected:
 `+t.join(`
-------------------------------
`))})},s.DEFER_DEFINITION_ERRORS_HANDLING=!1,s}();eE(uu,[YR,XR,sy,iy,oy,ay,uy,ly,hy,fy]);(function(s){zh(e,s);function e(t,r){r===void 0&&(r=At);var n=this,i=Js(r);return i.outputCst=!0,n=s.call(this,t,i)||this,n}return e})(uu);var my=function(s){zh(e,s);function e(t,r){r===void 0&&(r=At);var n=this,i=Js(r);return i.outputCst=!1,n=s.call(this,t,i)||this,n}return e}(uu);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Al=(s,e)=>({type:s,message:e});var Ve;(function(s){s.LexingError="LexingError",s.ParserError="ParsingError",s.StaticOffsetError="StaticOffsetError",s.StaticOffsetOutOfRangeError="StaticOffsetOutOfRangeError",s.RangeOffsetNotAllowed="RangeOffsetNotAllowed",s.InvalidRangeSize="InvalidRangeSize"})(Ve||(Ve={}));var y;(function(s){s.EMPTY="EMPTY",s.NUMBER="NUMBER",s.STRING="STRING",s.MINUS_UNARY_OP="MINUS_UNARY_OP",s.PLUS_UNARY_OP="PLUS_UNARY_OP",s.PERCENT_OP="PERCENT_OP",s.CONCATENATE_OP="CONCATENATE_OP",s.EQUALS_OP="EQUALS_OP",s.NOT_EQUAL_OP="NOT_EQUAL_OP",s.GREATER_THAN_OP="GREATER_THAN_OP",s.LESS_THAN_OP="LESS_THAN_OP",s.GREATER_THAN_OR_EQUAL_OP="GREATER_THAN_OR_EQUAL_OP",s.LESS_THAN_OR_EQUAL_OP="LESS_THAN_OR_EQUAL_OP",s.PLUS_OP="PLUS_OP",s.MINUS_OP="MINUS_OP",s.TIMES_OP="TIMES_OP",s.DIV_OP="DIV_OP",s.POWER_OP="POWER_OP",s.FUNCTION_CALL="FUNCTION_CALL",s.NAMED_EXPRESSION="NAMED_EXPRESSION",s.PARENTHESIS="PARENTHESES",s.CELL_REFERENCE="CELL_REFERENCE",s.CELL_RANGE="CELL_RANGE",s.COLUMN_RANGE="COLUMN_RANGE",s.ROW_RANGE="ROW_RANGE",s.ERROR="ERROR",s.ERROR_WITH_RAW_INPUT="ERROR_WITH_RAW_INPUT",s.ARRAY="ARRAY"})(y||(y={}));var Dt;(function(s){s[s.RELATIVE=0]="RELATIVE",s[s.START_ABSOLUTE=1]="START_ABSOLUTE",s[s.BOTH_ABSOLUTE=2]="BOTH_ABSOLUTE"})(Dt||(Dt={}));const gy=s=>({type:y.EMPTY,leadingWhitespace:s?.image}),Ey=(s,e)=>({type:y.NUMBER,value:s,leadingWhitespace:e?.image}),Ry=s=>{var e;return{type:y.STRING,value:s.image.slice(1,-1),leadingWhitespace:(e=s.leadingWhitespace)===null||e===void 0?void 0:e.image}},Cl=(s,e)=>({type:y.CELL_REFERENCE,reference:s,leadingWhitespace:e?.image}),wl=(s,e,t,r)=>(lu(s,e,t),{type:y.CELL_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r}),yy=(s,e,t,r)=>(lu(s,e,t),{type:y.COLUMN_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r?.image}),Ny=(s,e,t,r)=>(lu(s,e,t),{type:y.ROW_RANGE,start:s,end:e,sheetReferenceType:t,leadingWhitespace:r?.image}),Ty=(s,e,t)=>({type:y.CONCATENATE_OP,left:s,right:e,leadingWhitespace:t?.image}),vy=(s,e,t)=>({type:y.EQUALS_OP,left:s,right:e,leadingWhitespace:t?.image}),Sy=(s,e,t)=>({type:y.NOT_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),Ay=(s,e,t)=>({type:y.GREATER_THAN_OP,left:s,right:e,leadingWhitespace:t?.image}),Cy=(s,e,t)=>({type:y.LESS_THAN_OP,left:s,right:e,leadingWhitespace:t?.image}),wy=(s,e,t)=>({type:y.GREATER_THAN_OR_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),Iy=(s,e,t)=>({type:y.LESS_THAN_OR_EQUAL_OP,left:s,right:e,leadingWhitespace:t?.image}),My=(s,e,t)=>({type:y.PLUS_OP,left:s,right:e,leadingWhitespace:t?.image}),Oy=(s,e,t)=>({type:y.MINUS_OP,left:s,right:e,leadingWhitespace:t?.image}),by=(s,e,t)=>({type:y.TIMES_OP,left:s,right:e,leadingWhitespace:t?.image}),xy=(s,e,t)=>({type:y.DIV_OP,left:s,right:e,leadingWhitespace:t?.image}),_y=(s,e,t)=>({type:y.POWER_OP,left:s,right:e,leadingWhitespace:t?.image}),Ly=(s,e)=>({type:y.MINUS_UNARY_OP,value:s,leadingWhitespace:e?.image}),Fy=(s,e)=>({type:y.PLUS_UNARY_OP,value:s,leadingWhitespace:e?.image}),Uy=(s,e)=>({type:y.PERCENT_OP,value:s,leadingWhitespace:e?.image}),Py=(s,e,t,r,n)=>({type:y.FUNCTION_CALL,procedureName:s,args:e,leadingWhitespace:t?.image,internalWhitespace:r?.image,hyperlink:n}),Il=(s,e,t)=>({type:y.ARRAY,args:s,leadingWhitespace:e?.image,internalWhitespace:t?.image}),Dy=(s,e)=>({type:y.NAMED_EXPRESSION,expressionName:s,leadingWhitespace:e?.image}),Vy=(s,e,t)=>({type:y.PARENTHESIS,expression:s,leadingWhitespace:e?.image,internalWhitespace:t?.image}),Tr=(s,e)=>({type:y.ERROR,error:s,leadingWhitespace:e?.image}),xn=(s,e,t)=>({type:y.ERROR_WITH_RAW_INPUT,error:e,rawInput:s,leadingWhitespace:t?.image}),mo=()=>({type:y.ERROR,error:g.parsingError()});function lu(s,e,t){if(s.sheet!==void 0&&e.sheet===void 0||s.sheet===void 0&&e.sheet!==void 0)throw new Error("Start address inconsistent with end address");if(s.sheet===void 0&&t!==Dt.RELATIVE||s.sheet!==void 0&&t===Dt.RELATIVE)throw new Error("Sheet address inconsistent with sheet reference type")}function ue(s,e){return(e??"")+s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const jh={[y.PLUS_OP]:"+",[y.MINUS_OP]:"-",[y.TIMES_OP]:"*",[y.DIV_OP]:"/",[y.CONCATENATE_OP]:"&",[y.POWER_OP]:"^",[y.EQUALS_OP]:"=",[y.NOT_EQUAL_OP]:"<>",[y.GREATER_THAN_OP]:">",[y.GREATER_THAN_OR_EQUAL_OP]:">=",[y.LESS_THAN_OP]:"<",[y.LESS_THAN_OR_EQUAL_OP]:"<="};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const By=(s,e,t,r)=>({ast:s,relativeDependencies:e,hasVolatileFunction:t,hasStructuralChangeFunction:r});class ky{constructor(e){this.functionRegistry=e,this.cache=new Map}set(e,t){const r=xa(t,this.functionRegistry),n=By(t,r,Xr(t,this.functionRegistry.isFunctionVolatile),Xr(t,this.functionRegistry.isFunctionDependentOnSheetStructureChange));return this.cache.set(e,n),n}get(e){return this.cache.get(e)}maybeSetAndThenGet(e,t){const r=this.cache.get(e);return r!==void 0?r.ast:(this.set(e,t),t)}}const Xr=(s,e)=>{switch(s.type){case y.EMPTY:case y.NUMBER:case y.STRING:case y.ERROR:case y.ERROR_WITH_RAW_INPUT:case y.CELL_REFERENCE:case y.CELL_RANGE:case y.COLUMN_RANGE:case y.ROW_RANGE:case y.NAMED_EXPRESSION:return!1;case y.PERCENT_OP:case y.PLUS_UNARY_OP:case y.MINUS_UNARY_OP:return Xr(s.value,e);case y.CONCATENATE_OP:case y.EQUALS_OP:case y.NOT_EQUAL_OP:case y.LESS_THAN_OP:case y.GREATER_THAN_OP:case y.LESS_THAN_OR_EQUAL_OP:case y.GREATER_THAN_OR_EQUAL_OP:case y.MINUS_OP:case y.PLUS_OP:case y.TIMES_OP:case y.DIV_OP:case y.POWER_OP:return Xr(s.left,e)||Xr(s.right,e);case y.PARENTHESIS:return Xr(s.expression,e);case y.FUNCTION_CALL:return e(s.procedureName)?!0:s.args.some(t=>Xr(t,e));case y.ARRAY:return s.args.some(t=>t.some(r=>Xr(r,e)))}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class T{}T.DistinctSigns="Distinct signs.";T.WrongArgNumber="Wrong number of arguments.";T.EmptyArg="Empty function argument.";T.EmptyArray="Empty array not allowed.";T.ArrayDimensions="Array dimensions are not compatible.";T.NoSpaceForArrayResult="No space for array result.";T.ValueSmall="Value too small.";T.ValueLarge="Value too large.";T.BadCriterion="Incorrect criterion.";T.RangeManySheets="Range spans more than one sheet.";T.CellRangeExpected="Cell range expected.";T.WrongDimension="Wrong range dimension.";T.ScalarExpected="Cell range not allowed.";T.NumberCoercion="Value cannot be coerced to number.";T.NumberExpected="Number argument expected.";T.IntegerExpected="Value needs to be an integer.";T.BadMode="Mode not recognized.";T.DateBounds="Date outside of bounds.";T.OutOfSheet="Resulting reference is out of the sheet.";T.WrongType="Wrong type of argument.";T.NaN="NaN or infinite value encountered.";T.EqualLength="Ranges need to be of equal length.";T.Negative="Value cannot be negative.";T.NotBinary="String does not represent a binary number.";T.NotOctal="String does not represent an octal number.";T.NotHex="String does not represent a hexadecimal number.";T.EndStartPeriod="End period needs to be at least start period.";T.CellRefExpected="Cell reference expected.";T.EmptyRange="Empty range not allowed.";T.BadRef="Address is not correct.";T.NumberRange="Number-only range expected.";T.ValueNotFound="Value not found.";T.ValueBaseLarge="Value in base too large.";T.ValueBaseSmall="Value in base too small.";T.ValueBaseLong="Value in base too long.";T.NegativeLength="Length cannot be negative.";T.PatternNotFound="Pattern not found.";T.OneValue="Needs at least one value.";T.TwoValues="Range needs to contain at least two elements.";T.ThreeValues="Range needs to contain at least three elements.";T.IndexBounds="Index out of bounds.";T.IndexLarge="Index too large.";T.Formula="Expected formula.";T.NegativeCount="Count cannot be negative.";T.ParseError="Parsing error.";T.SheetRef="Sheet does not exist.";T.PeriodLong="Period number cannot exceed life length.";T.InvalidDate="Invalid date.";T.BitshiftLong="Result of bitshift is too long.";T.EmptyString="Empty-string argument not allowed.";T.LengthBounds="Length out of bounds.";T.NegativeTime="Time cannot be negative.";T.NoDefault="No default option.";T.NoConditionMet="None of the conditions were met.";T.Selector="Selector cannot exceed the number of arguments.";T.StartEndDate="Start date needs to be earlier than end date.";T.IncorrectDateTime="String does not represent correct DateTime.";T.CharacterCodeBounds="Character code out of bounds.";T.NonZero="Argument cannot be 0.";T.LessThanOne="Argument cannot be less than 1.";T.WeekendString="Incorrect weekend bitmask string.";T.InvalidRoman="Invalid roman numeral.";T.WrongOrder="Wrong order of values.";T.ComplexNumberExpected="Complex number expected.";T.ShouldBeIorJ="Should be 'i' or 'j'.";T.SizeMismatch="Array dimensions mismatched.";T.FunctionName=s=>`Function name ${s} not recognized.`;T.NamedExpressionName=s=>`Named expression ${s} not recognized.`;T.LicenseKey=s=>`License key is ${s}.`;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Gy{constructor(){this.POSSIBLE_START_CHARACTERS=[...rh,...Wg,Nt,"'","_"],this.cellReferenceRegexp=new RegExp(Hg,"y")}match(e,t){this.cellReferenceRegexp.lastIndex=t;const r=this.cellReferenceRegexp.exec(e+"@");return r==null||r[1]==null?null:(r[0]=r[1],r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Hy{constructor(){this.POSSIBLE_START_CHARACTERS=[...rh,"_"],this.namedExpressionRegexp=new RegExp(th,"y"),this.r1c1CellRefRegexp=new RegExp(`^${eh}$`)}match(e,t){this.namedExpressionRegexp.lastIndex=t;const r=this.namedExpressionRegexp.exec(e);return r==null||r[0]==null||this.r1c1CellRefRegexp.test(r[0])?null:r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Gs=oe({name:"AdditionOp",pattern:It.NA}),go=oe({name:"PlusOp",pattern:/\+/,categories:Gs}),Eo=oe({name:"MinusOp",pattern:/-/,categories:Gs}),ba=oe({name:"MultiplicationOp",pattern:It.NA}),Yh=oe({name:"TimesOp",pattern:/\*/,categories:ba}),$h=oe({name:"DivOp",pattern:/\//,categories:ba}),Ro=oe({name:"PowerOp",pattern:/\^/}),Xh=oe({name:"PercentOp",pattern:/%/}),ln=oe({name:"BooleanOp",pattern:It.NA}),yo=oe({name:"EqualsOp",pattern:/=/,categories:ln}),Kh=oe({name:"NotEqualOp",pattern:/<>/,categories:ln}),qh=oe({name:"GreaterThanOp",pattern:/>/,categories:ln}),Qh=oe({name:"LessThanOp",pattern:/</,categories:ln}),Zh=oe({name:"GreaterThanOrEqualOp",pattern:/>=/,categories:ln}),Jh=oe({name:"LessThanOrEqualOp",pattern:/<=/,categories:ln}),ed=oe({name:"ConcatenateOp",pattern:/&/}),No=oe({name:"LParen",pattern:/\(/}),Li=oe({name:"RParen",pattern:/\)/}),td=oe({name:"ArrayLParen",pattern:/{/}),rd=oe({name:"ArrayRParen",pattern:/}/}),nd=oe({name:"StringLiteral",pattern:/"([^"\\]*(\\.[^"\\]*)*)"/}),sd=oe({name:"ErrorLiteral",pattern:/#[A-Za-z0-9\/]+[?!]?/}),Hs=oe({name:"RangeSeparator",pattern:new RegExp(Zs)}),cu=oe({name:"ColumnRange",pattern:new RegExp(`${Xu}${Zs}${Xu}`)}),hu=oe({name:"RowRange",pattern:new RegExp(`${Ku}${Zs}${Ku}`)}),du=oe({name:"ProcedureName",pattern:new RegExp(`([${ya}][${Xo}]*)\\(`)}),Ya=new Gy,Jr=oe({name:"CellReference",pattern:Ya.match.bind(Ya),start_chars_hint:Ya.POSSIBLE_START_CHARACTERS,line_breaks:!1}),$a=new Hy,id=oe({name:"NamedExpression",pattern:$a.match.bind($a),start_chars_hint:$a.POSSIBLE_START_CHARACTERS,line_breaks:!1}),fu=s=>{const e=s.translationPackage.getFunctionTranslation("OFFSET"),t=s.errorMapping,r=s.translationPackage.buildFunctionMapping(),n=new RegExp(s.ignoreWhiteSpace==="standard"?kg:Bg),i=oe({name:"WhiteSpace",pattern:n}),a=oe({name:"ArrayRowSep",pattern:s.arrayRowSeparator}),o=oe({name:"ArrayColSep",pattern:s.arrayColumnSeparator}),u=oe({name:"NumberLiteral",pattern:new RegExp(`(([${s.decimalSeparator}]\\d+)|(\\d+([${s.decimalSeparator}]\\d*)?))(e[+-]?\\d+)?`)}),l=oe({name:"OffsetProcedureName",pattern:new RegExp(e,"i")});let c,d;s.functionArgSeparator===s.arrayColumnSeparator?(c=o,d=[]):s.functionArgSeparator===s.arrayRowSeparator?(c=a,d=[]):(c=oe({name:"ArgSeparator",pattern:s.functionArgSeparator}),d=[c]);const f=[i,go,Eo,Yh,$h,Ro,yo,Kh,Xh,Zh,Jh,qh,Qh,No,Li,td,rd,l,du,Hs,...d,cu,hu,u,nd,sd,ed,ln,Gs,ba,Jr,id,a,o];return{ArgSeparator:c,NumberLiteral:u,OffsetProcedureName:l,ArrayRowSeparator:a,ArrayColSeparator:o,WhiteSpace:i,allTokens:f,errorMapping:t,functionMapping:r,decimalSeparator:s.decimalSeparator,maxColumns:s.maxColumns,maxRows:s.maxRows}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Hn extends my{constructor(e,t){super(e.allTokens,{outputCst:!1,maxLookahead:7}),this.booleanExpressionOrEmpty=this.RULE("booleanExpressionOrEmpty",()=>this.OR([{ALT:()=>this.SUBRULE(this.booleanExpression)},{ALT:py(gy())}])),this.procedureExpression=this.RULE("procedureExpression",()=>{var r;const n=this.CONSUME(du),i=n.image.toUpperCase().slice(0,-1),a=(r=this.lexerConfig.functionMapping[i])!==null&&r!==void 0?r:i,o=[];let u=this.SUBRULE(this.booleanExpressionOrEmpty);this.MANY(()=>{var c;const d=this.CONSUME(this.lexerConfig.ArgSeparator);u.type===y.EMPTY&&(u.leadingWhitespace=(c=d.leadingWhitespace)===null||c===void 0?void 0:c.image),o.push(u),u=this.SUBRULE2(this.booleanExpressionOrEmpty)}),o.push(u),o.length===1&&o[0].type===y.EMPTY&&(o.length=0);const l=this.CONSUME(Li);return Py(a,o,n.leadingWhitespace,l.leadingWhitespace)}),this.namedExpressionExpression=this.RULE("namedExpressionExpression",()=>{const r=this.CONSUME(id);return Dy(r.image,r.leadingWhitespace)}),this.offsetProcedureExpression=this.RULE("offsetProcedureExpression",()=>{const r=[];return this.CONSUME(this.lexerConfig.OffsetProcedureName),this.CONSUME(No),this.MANY_SEP({SEP:this.lexerConfig.ArgSeparator,DEF:()=>{r.push(this.SUBRULE(this.booleanExpression))}}),this.CONSUME(Li),this.handleOffsetHeuristic(r)}),this.columnRangeExpression=this.RULE("columnRangeExpression",()=>{const r=this.CONSUME(cu),[n,i]=r.image.split(":"),a=this.ACTION(()=>Hi(this.sheetMapping,n,this.formulaAddress)),o=this.ACTION(()=>Hi(this.sheetMapping,i,this.formulaAddress));if(a===void 0||o===void 0)return Tr(new g(R.REF));if(a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns)||o.exceedsSheetSizeLimits(this.lexerConfig.maxColumns))return xn(r.image,new g(R.NAME),r.leadingWhitespace);if(a.sheet===void 0&&o.sheet!==void 0)return this.parsingError(Ve.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:l,sheetRefType:c}=Hn.fixSheetIdsForRangeEnds(a,o);return yy(u,l,c,r.leadingWhitespace)}),this.rowRangeExpression=this.RULE("rowRangeExpression",()=>{const r=this.CONSUME(hu),[n,i]=r.image.split(":"),a=this.ACTION(()=>Wi(this.sheetMapping,n,this.formulaAddress)),o=this.ACTION(()=>Wi(this.sheetMapping,i,this.formulaAddress));if(a===void 0||o===void 0)return Tr(new g(R.REF));if(a.exceedsSheetSizeLimits(this.lexerConfig.maxRows)||o.exceedsSheetSizeLimits(this.lexerConfig.maxRows))return xn(r.image,new g(R.NAME),r.leadingWhitespace);if(a.sheet===void 0&&o.sheet!==void 0)return this.parsingError(Ve.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:l,sheetRefType:c}=Hn.fixSheetIdsForRangeEnds(a,o);return Ny(u,l,c,r.leadingWhitespace)}),this.cellReference=this.RULE("cellReference",()=>{const r=this.CONSUME(Jr),n=this.ACTION(()=>Un(this.sheetMapping,r.image,this.formulaAddress));return n===void 0?xn(r.image,new g(R.REF),r.leadingWhitespace):n.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?xn(r.image,new g(R.NAME),r.leadingWhitespace):Cl(n,r.leadingWhitespace)}),this.endRangeReference=this.RULE("endRangeReference",r=>{var n;const i=this.CONSUME(Jr),a=this.ACTION(()=>Un(this.sheetMapping,r.image,this.formulaAddress)),o=this.ACTION(()=>Un(this.sheetMapping,i.image,this.formulaAddress));return a===void 0||o===void 0?this.ACTION(()=>xn(`${r.image}:${i.image}`,new g(R.REF),r.leadingWhitespace)):a.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)||o.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?this.ACTION(()=>xn(`${r.image}:${i.image}`,new g(R.NAME),r.leadingWhitespace)):this.buildCellRange(a,o,(n=r.leadingWhitespace)===null||n===void 0?void 0:n.image)}),this.endOfRangeExpression=this.RULE("endOfRangeExpression",r=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeReference,{ARGS:[r]})},{ALT:()=>{var n;const i=this.SUBRULE(this.offsetProcedureExpression),a=this.ACTION(()=>Un(this.sheetMapping,r.image,this.formulaAddress));return a===void 0?Tr(new g(R.REF)):i.type===y.CELL_REFERENCE?this.buildCellRange(a,i.reference,(n=r.leadingWhitespace)===null||n===void 0?void 0:n.image):this.parsingError(Ve.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.cellRangeExpression=this.RULE("cellRangeExpression",()=>{const r=this.CONSUME(Jr);return this.CONSUME2(Hs),this.SUBRULE(this.endOfRangeExpression,{ARGS:[r]})}),this.endRangeWithOffsetStartReference=this.RULE("endRangeWithOffsetStartReference",r=>{const n=this.CONSUME(Jr),i=this.ACTION(()=>Un(this.sheetMapping,n.image,this.formulaAddress));return i===void 0?this.ACTION(()=>Tr(new g(R.REF))):this.buildCellRange(r.reference,i,r.leadingWhitespace)}),this.endOfRangeWithOffsetStartExpression=this.RULE("endOfRangeWithOffsetStartExpression",r=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeWithOffsetStartReference,{ARGS:[r]})},{ALT:()=>{const n=this.SUBRULE(this.offsetProcedureExpression);return n.type===y.CELL_REFERENCE?this.buildCellRange(r.reference,n.reference,r.leadingWhitespace):this.parsingError(Ve.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.offsetExpression=this.RULE("offsetExpression",()=>{const r=this.SUBRULE(this.offsetProcedureExpression);let n;return this.OPTION(()=>{this.CONSUME(Hs),r.type===y.CELL_RANGE?n=this.parsingError(Ve.RangeOffsetNotAllowed,"Range offset not allowed here"):n=this.SUBRULE(this.endOfRangeWithOffsetStartExpression,{ARGS:[r]})}),n!==void 0?n:r}),this.insideArrayExpression=this.RULE("insideArrayExpression",()=>{const r=[[]];return r[r.length-1].push(this.SUBRULE(this.booleanExpression)),this.MANY(()=>{this.OR([{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayColSeparator),r[r.length-1].push(this.SUBRULE2(this.booleanExpression))}},{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayRowSeparator),r.push([]),r[r.length-1].push(this.SUBRULE3(this.booleanExpression))}}])}),Il(r)}),this.parenthesisExpression=this.RULE("parenthesisExpression",()=>{const r=this.CONSUME(No),n=this.SUBRULE(this.booleanExpression),i=this.CONSUME(Li);return Vy(n,r.leadingWhitespace,i.leadingWhitespace)}),this.arrayExpression=this.RULE("arrayExpression",()=>this.OR([{ALT:()=>{const r=this.CONSUME(td),n=this.SUBRULE(this.insideArrayExpression),i=this.CONSUME(rd);return Il(n.args,r.leadingWhitespace,i.leadingWhitespace)}},{ALT:()=>this.SUBRULE(this.parenthesisExpression)}])),this.numericStringToNumber=r=>{const n=r.replace(this.lexerConfig.decimalSeparator,".");return Number(n)},this.positiveAtomicExpression=this.RULE("positiveAtomicExpression",()=>{var r;return this.OR((r=this.atomicExpCache)!==null&&r!==void 0?r:this.atomicExpCache=[{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.SUBRULE(this.cellRangeExpression)},{ALT:()=>this.SUBRULE(this.columnRangeExpression)},{ALT:()=>this.SUBRULE(this.rowRangeExpression)},{ALT:()=>this.SUBRULE(this.offsetExpression)},{ALT:()=>this.SUBRULE(this.cellReference)},{ALT:()=>this.SUBRULE(this.procedureExpression)},{ALT:()=>this.SUBRULE(this.namedExpressionExpression)},{ALT:()=>{const n=this.CONSUME(this.lexerConfig.NumberLiteral);return Ey(this.numericStringToNumber(n.image),n.leadingWhitespace)}},{ALT:()=>{const n=this.CONSUME(nd);return Ry(n)}},{ALT:()=>{const n=this.CONSUME(sd),i=n.image.toUpperCase(),a=this.lexerConfig.errorMapping[i];return a?Tr(new g(a),n.leadingWhitespace):this.parsingError(Ve.ParserError,"Unknown error literal")}}])}),this.rightUnaryOpAtomicExpression=this.RULE("rightUnaryOpAtomicExpression",()=>{const r=this.SUBRULE(this.positiveAtomicExpression),n=this.OPTION(()=>this.CONSUME(Xh));return n?Uy(r,n.leadingWhitespace):r}),this.atomicExpression=this.RULE("atomicExpression",()=>this.OR([{ALT:()=>{const r=this.CONSUME(Gs),n=this.SUBRULE(this.atomicExpression);return ve(r,go)?Fy(n,r.leadingWhitespace):ve(r,Eo)?Ly(n,r.leadingWhitespace):(this.customParsingError=Al(Ve.ParserError,"Mismatched token type"),this.customParsingError)}},{ALT:()=>this.SUBRULE2(this.rightUnaryOpAtomicExpression)}])),this.powerExpression=this.RULE("powerExpression",()=>{let r=this.SUBRULE(this.atomicExpression);return this.MANY(()=>{const n=this.CONSUME(Ro),i=this.SUBRULE2(this.atomicExpression);ve(n,Ro)?r=_y(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{let r=this.SUBRULE(this.powerExpression);return this.MANY(()=>{const n=this.CONSUME(ba),i=this.SUBRULE2(this.powerExpression);ve(n,Yh)?r=by(r,i,n.leadingWhitespace):ve(n,$h)?r=xy(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.additionExpression=this.RULE("additionExpression",()=>{let r=this.SUBRULE(this.multiplicationExpression);return this.MANY(()=>{const n=this.CONSUME(Gs),i=this.SUBRULE2(this.multiplicationExpression);ve(n,go)?r=My(r,i,n.leadingWhitespace):ve(n,Eo)?r=Oy(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.concatenateExpression=this.RULE("concatenateExpression",()=>{let r=this.SUBRULE(this.additionExpression);return this.MANY(()=>{const n=this.CONSUME(ed),i=this.SUBRULE2(this.additionExpression);r=Ty(r,i,n.leadingWhitespace)}),r}),this.booleanExpression=this.RULE("booleanExpression",()=>{let r=this.SUBRULE(this.concatenateExpression);return this.MANY(()=>{const n=this.CONSUME(ln),i=this.SUBRULE2(this.concatenateExpression);ve(n,yo)?r=vy(r,i,n.leadingWhitespace):ve(n,Kh)?r=Sy(r,i,n.leadingWhitespace):ve(n,qh)?r=Ay(r,i,n.leadingWhitespace):ve(n,Qh)?r=Cy(r,i,n.leadingWhitespace):ve(n,Zh)?r=wy(r,i,n.leadingWhitespace):ve(n,Jh)?r=Iy(r,i,n.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),r}),this.formula=this.RULE("formula",()=>(this.CONSUME(yo),this.SUBRULE(this.booleanExpression))),this.lexerConfig=e,this.sheetMapping=t,this.formulaAddress=U(0,0,0),this.performSelfAnalysis()}parseFromTokens(e,t){this.input=e;let r=this.formulaWithContext(t),n=[];return this.customParsingError&&n.push(this.customParsingError),n=n.concat(this.errors.map(i=>({type:Ve.ParserError,message:i.message}))),n.length>0&&(r=mo()),{ast:r,errors:n}}reset(){super.reset(),this.customParsingError=void 0}formulaWithContext(e){return this.formulaAddress=e,this.formula()}buildCellRange(e,t,r){if(e.sheet===void 0&&t.sheet!==void 0)return this.parsingError(Ve.ParserError,"Malformed range expression");const{firstEnd:n,secondEnd:i,sheetRefType:a}=Hn.fixSheetIdsForRangeEnds(e,t);return wl(n,i,a,r)}static fixSheetIdsForRangeEnds(e,t){const r=Hn.rangeSheetReferenceType(e.sheet,t.sheet),n=e.sheet!==void 0&&t.sheet===void 0?t.withSheet(e.sheet):t;return{firstEnd:e,secondEnd:n,sheetRefType:r}}handleOffsetHeuristic(e){var t;const r=e[0];if(r.type!==y.CELL_REFERENCE)return this.parsingError(Ve.StaticOffsetError,"First argument to OFFSET is not a reference");const n=e[1];let i;if(n.type===y.NUMBER&&Number.isInteger(n.value))i=n.value;else if(n.type===y.PLUS_UNARY_OP&&n.value.type===y.NUMBER&&Number.isInteger(n.value.value))i=n.value.value;else if(n.type===y.MINUS_UNARY_OP&&n.value.type===y.NUMBER&&Number.isInteger(n.value.value))i=-n.value.value;else return this.parsingError(Ve.StaticOffsetError,"Second argument to OFFSET is not a static number");const a=e[2];let o;if(a.type===y.NUMBER&&Number.isInteger(a.value))o=a.value;else if(a.type===y.PLUS_UNARY_OP&&a.value.type===y.NUMBER&&Number.isInteger(a.value.value))o=a.value.value;else if(a.type===y.MINUS_UNARY_OP&&a.value.type===y.NUMBER&&Number.isInteger(a.value.value))o=-a.value.value;else return this.parsingError(Ve.StaticOffsetError,"Third argument to OFFSET is not a static number");const u=e[3];let l;if(u===void 0)l=1;else if(u.type===y.NUMBER){if(l=u.value,l<1)return this.parsingError(Ve.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(l))return this.parsingError(Ve.StaticOffsetError,"Fourth argument to OFFSET is not integer")}else return this.parsingError(Ve.StaticOffsetError,"Fourth argument to OFFSET is not a static number");const c=e[4];let d;if(c===void 0)d=1;else if(c.type===y.NUMBER){if(d=c.value,d<1)return this.parsingError(Ve.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(d))return this.parsingError(Ve.StaticOffsetError,"Fifth argument to OFFSET is not integer")}else return this.parsingError(Ve.StaticOffsetError,"Fifth argument to OFFSET is not a static number");const f=new Ce(r.reference.col+o,r.reference.row+i,r.reference.type,(t=r.reference.sheet)!==null&&t!==void 0?t:void 0);let p=f.col,E=f.row;if((r.reference.type===Re.CELL_REFERENCE_RELATIVE||r.reference.type===Re.CELL_REFERENCE_ABSOLUTE_COL)&&(E=E+this.formulaAddress.row),(r.reference.type===Re.CELL_REFERENCE_RELATIVE||r.reference.type===Re.CELL_REFERENCE_ABSOLUTE_ROW)&&(p=p+this.formulaAddress.col),p<0||E<0)return Tr(new g(R.REF,T.OutOfSheet));if(d===1&&l===1)return Cl(f);{const m=new Ce(f.col+d-1,f.row+l-1,f.type,f.sheet),S=r.reference.sheet==null?Dt.RELATIVE:Dt.BOTH_ABSOLUTE;return wl(f,m,S)}}parsingError(e,t){return this.customParsingError=Al(e,t),mo()}static rangeSheetReferenceType(e,t){return e===void 0?Dt.RELATIVE:t===void 0?Dt.START_ABSOLUTE:Dt.BOTH_ABSOLUTE}}class ta{constructor(e){this.lexerConfig=e,this.lexer=new It(e.allTokens,{ensureOptimizations:!0})}tokenizeFormula(e){const t=this.lexer.tokenize(e);let r=t.tokens;return r=this.trimTrailingWhitespaces(r),r=this.skipWhitespacesInsideRanges(r),r=this.skipWhitespacesBeforeArgSeparators(r),t.tokens=r,t}skipWhitespacesInsideRanges(e){return ta.filterTokensByNeighbors(e,(t,r,n)=>(ve(t,Jr)||ve(t,Hs))&&ve(r,this.lexerConfig.WhiteSpace)&&(ve(n,Jr)||ve(n,Hs)))}skipWhitespacesBeforeArgSeparators(e){return ta.filterTokensByNeighbors(e,(t,r,n)=>!ve(t,this.lexerConfig.ArgSeparator)&&ve(r,this.lexerConfig.WhiteSpace)&&ve(n,this.lexerConfig.ArgSeparator))}static filterTokensByNeighbors(e,t){if(e.length<3)return e;let r=0;const n=[e[r++]];for(;r<e.length-1;)t(e[r-1],e[r],e[r+1])||n.push(e[r]),++r;return n.push(e[r]),n}trimTrailingWhitespaces(e){return e.length>0&&ve(e[e.length-1],this.lexerConfig.WhiteSpace)&&e.pop(),e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ad{constructor(e,t,r,n){this.config=e,this.lexerConfig=t,this.sheetMappingFn=r,this.namedExpressions=n}unparse(e,t){return"="+this.unparseAst(e,t)}unparseAst(e,t){var r,n;switch(e.type){case y.EMPTY:return ue("",e.leadingWhitespace);case y.NUMBER:return ue(od(e.value,this.config.decimalSeparator),e.leadingWhitespace);case y.STRING:return ue('"'+e.value+'"',e.leadingWhitespace);case y.FUNCTION_CALL:{const i=e.args.map(u=>u!==void 0?this.unparseAst(u,t):"").join(this.config.functionArgSeparator),o=(this.config.translationPackage.isFunctionTranslated(e.procedureName)?this.config.translationPackage.getFunctionTranslation(e.procedureName):e.procedureName)+"("+i+ue(")",e.internalWhitespace);return ue(o,e.leadingWhitespace)}case y.NAMED_EXPRESSION:{const i=(r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.sheet))===null||r===void 0?void 0:r.displayName;return ue(i||e.expressionName,e.leadingWhitespace)}case y.CELL_REFERENCE:{let i;return e.reference.sheet!==void 0?i=this.unparseSheetName(e.reference.sheet)+"!":i="",i+=(n=e.reference.unparse(t))!==null&&n!==void 0?n:this.config.translationPackage.getErrorTranslation(R.REF),ue(i,e.leadingWhitespace)}case y.COLUMN_RANGE:case y.ROW_RANGE:case y.CELL_RANGE:return ue(this.formatRange(e,t),e.leadingWhitespace);case y.PLUS_UNARY_OP:{const i=this.unparseAst(e.value,t);return ue("+",e.leadingWhitespace)+i}case y.MINUS_UNARY_OP:{const i=this.unparseAst(e.value,t);return ue("-",e.leadingWhitespace)+i}case y.PERCENT_OP:return this.unparseAst(e.value,t)+ue("%",e.leadingWhitespace);case y.ERROR:{const i=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:R.ERROR);return ue(i,e.leadingWhitespace)}case y.ERROR_WITH_RAW_INPUT:return ue(e.rawInput,e.leadingWhitespace);case y.PARENTHESIS:{const a="("+this.unparseAst(e.expression,t)+ue(")",e.internalWhitespace);return ue(a,e.leadingWhitespace)}case y.ARRAY:{const i="{"+e.args.map(a=>a.map(o=>this.unparseAst(o,t)).join(this.config.arrayColumnSeparator)).join(this.config.arrayRowSeparator)+ue("}",e.internalWhitespace);return ue(i,e.leadingWhitespace)}default:{const i=this.unparseAst(e.left,t),a=this.unparseAst(e.right,t);return i+ue(jh[e.type],e.leadingWhitespace)+a}}}unparseSheetName(e){const t=sh(e,this.sheetMappingFn);if(t===void 0)throw new Le(e);return t}formatRange(e,t){let r="",n="";e.start.sheet!==void 0&&e.sheetReferenceType!==Dt.RELATIVE&&(r=this.unparseSheetName(e.start.sheet)+"!"),e.end.sheet!==void 0&&e.sheetReferenceType===Dt.BOTH_ABSOLUTE&&(n=this.unparseSheetName(e.end.sheet)+"!");const i=e.start.unparse(t),a=e.end.unparse(t);return i===void 0||a===void 0?this.config.translationPackage.getErrorTranslation(R.REF):`${r}${i}:${n}${a}`}}function od(s,e){return s.toString().replace(".",e)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class xs{constructor(e,t,r){this.config=e,this.functionRegistry=t,this.sheetMapping=r,this.statsCacheUsed=0,this.lexerConfig=fu(e),this.lexer=new ta(this.lexerConfig),this.formulaParser=new Hn(this.lexerConfig,this.sheetMapping),this.cache=new ky(this.functionRegistry)}parse(e,t){this.formulaAddress=t;const r=this.tokenizeFormula(e);if(r.errors.length>0){const d=r.errors.map(f=>({type:Ve.LexingError,message:f.message}));return{ast:mo(),errors:d,hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]}}const n=this.computeHashFromTokens(r.tokens,t);let i=this.cache.get(n);if(i!==void 0)++this.statsCacheUsed;else{const d=this.bindWhitespacesToTokens(r.tokens),f=this.formulaParser.parseFromTokens(d,t);if(f.errors.length>0)return Object.assign(Object.assign({},f),{hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]});i=this.cache.set(n,f.ast)}const{ast:a,hasVolatileFunction:o,hasStructuralChangeFunction:u}=i,l=this.convertReversedRangesToRegularRanges(a),c=xa(l,this.functionRegistry);return{ast:l,errors:[],hasVolatileFunction:o,hasStructuralChangeFunction:u,dependencies:c}}convertReversedRangesToRegularRanges(e){switch(e.type){case y.EMPTY:case y.NUMBER:case y.STRING:case y.ERROR:case y.ERROR_WITH_RAW_INPUT:case y.CELL_REFERENCE:case y.NAMED_EXPRESSION:return e;case y.CELL_RANGE:{const{start:t,end:r}=e,n=this.orderCellRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case y.COLUMN_RANGE:{const{start:t,end:r}=e,n=this.orderColumnRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case y.ROW_RANGE:{const{start:t,end:r}=e,n=this.orderRowRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case y.PERCENT_OP:case y.PLUS_UNARY_OP:case y.MINUS_UNARY_OP:{const t=this.convertReversedRangesToRegularRanges(e.value);return Object.assign(Object.assign({},e),{value:t})}case y.CONCATENATE_OP:case y.EQUALS_OP:case y.NOT_EQUAL_OP:case y.LESS_THAN_OP:case y.GREATER_THAN_OP:case y.LESS_THAN_OR_EQUAL_OP:case y.GREATER_THAN_OR_EQUAL_OP:case y.MINUS_OP:case y.PLUS_OP:case y.TIMES_OP:case y.DIV_OP:case y.POWER_OP:{const t=this.convertReversedRangesToRegularRanges(e.left),r=this.convertReversedRangesToRegularRanges(e.right);return Object.assign(Object.assign({},e),{left:t,right:r})}case y.PARENTHESIS:{const t=this.convertReversedRangesToRegularRanges(e.expression);return Object.assign(Object.assign({},e),{expression:t})}case y.FUNCTION_CALL:{const t=e.args.map(r=>this.convertReversedRangesToRegularRanges(r));return Object.assign(Object.assign({},e),{args:t})}case y.ARRAY:{const t=e.args.map(r=>r.map(n=>this.convertReversedRangesToRegularRanges(n)));return Object.assign(Object.assign({},e),{args:t})}}}orderCellRangeEnds(e,t){const r=[e,t],[n,i]=r.map(c=>c.toColumnAddress()).sort(Rt.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(c=>c.toRowAddress()).sort(mt.compareByAbsoluteAddress(this.formulaAddress)),[u,l]=r.map(c=>c.sheet).sort(xs.compareSheetIds.bind(this));return{start:Ce.fromColAndRow(n,a,u),end:Ce.fromColAndRow(i,o,l)}}orderColumnRangeEnds(e,t){const r=[e,t],[n,i]=r.sort(Rt.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(u=>u.sheet).sort(xs.compareSheetIds.bind(this));return{start:new Rt(n.type,n.col,a),end:new Rt(i.type,i.col,o)}}orderRowRangeEnds(e,t){const r=[e,t],[n,i]=r.sort(mt.compareByAbsoluteAddress(this.formulaAddress)),[a,o]=r.map(u=>u.sheet).sort(xs.compareSheetIds.bind(this));return{start:new mt(n.type,n.row,a),end:new mt(i.type,i.row,o)}}static compareSheetIds(e,t){return e=e??1/0,t=t??1/0,e-t}fetchCachedResultForAst(e){const t=this.computeHashFromAst(e);return this.fetchCachedResult(t)}fetchCachedResult(e){const t=this.cache.get(e);if(t===void 0)throw new Error("There is no AST with such key in the cache");{const{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,relativeDependencies:a}=t;return{ast:r,errors:[],hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}}}computeHashFromTokens(e,t){var r;let n="",i=0;for(;i<e.length;){const a=e[i];if(ve(a,Jr)){const o=Un(this.sheetMapping,a.image,t);o===void 0?n=n.concat(a.image):n=n.concat(o.hash(!0))}else if(ve(a,du)){const o=a.image.toUpperCase().slice(0,-1),u=(r=this.lexerConfig.functionMapping[o])!==null&&r!==void 0?r:o;n=n.concat(u,"(")}else if(ve(a,cu)){const[o,u]=a.image.split(":"),l=Hi(this.sheetMapping,o,t),c=Hi(this.sheetMapping,u,t);l===void 0||c===void 0?n=n.concat("!REF"):n=n.concat(l.hash(!0),":",c.hash(!0))}else if(ve(a,hu)){const[o,u]=a.image.split(":"),l=Wi(this.sheetMapping,o,t),c=Wi(this.sheetMapping,u,t);l===void 0||c===void 0?n=n.concat("!REF"):n=n.concat(l.hash(!0),":",c.hash(!0))}else n=n.concat(a.image);i++}return n}rememberNewAst(e){const t=this.computeHashFromAst(e);return this.cache.maybeSetAndThenGet(t,e)}computeHashFromAst(e){return"="+this.computeHashOfAstNode(e)}computeHashOfAstNode(e){switch(e.type){case y.EMPTY:return e.leadingWhitespace||"";case y.NUMBER:return ue(od(e.value,this.config.decimalSeparator),e.leadingWhitespace);case y.STRING:return ue('"'+e.value+'"',e.leadingWhitespace);case y.NAMED_EXPRESSION:return ue(e.expressionName,e.leadingWhitespace);case y.FUNCTION_CALL:{const t=e.args.map(n=>this.computeHashOfAstNode(n)).join(this.config.functionArgSeparator),r=e.procedureName+"("+t+ue(")",e.internalWhitespace);return ue(r,e.leadingWhitespace)}case y.CELL_REFERENCE:return ue(e.reference.hash(!0),e.leadingWhitespace);case y.COLUMN_RANGE:case y.ROW_RANGE:case y.CELL_RANGE:{const t=e.start.hash(e.sheetReferenceType!==Dt.RELATIVE),r=e.end.hash(e.sheetReferenceType===Dt.BOTH_ABSOLUTE);return ue(t+":"+r,e.leadingWhitespace)}case y.MINUS_UNARY_OP:return ue("-"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case y.PLUS_UNARY_OP:return ue("+"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case y.PERCENT_OP:return this.computeHashOfAstNode(e.value)+ue("%",e.leadingWhitespace);case y.ERROR:{const t=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:R.ERROR);return ue(t,e.leadingWhitespace)}case y.ERROR_WITH_RAW_INPUT:return ue(e.rawInput,e.leadingWhitespace);case y.ARRAY:{const t=e.args.map(r=>r.map(n=>this.computeHashOfAstNode(n)).join(",")).join(";");return ue("{"+t+ue("}",e.internalWhitespace),e.leadingWhitespace)}case y.PARENTHESIS:{const r="("+this.computeHashOfAstNode(e.expression)+ue(")",e.internalWhitespace);return ue(r,e.leadingWhitespace)}default:return this.computeHashOfAstNode(e.left)+ue(jh[e.type],e.leadingWhitespace)+this.computeHashOfAstNode(e.right)}}bindWhitespacesToTokens(e){const t=[],r=e[0];ve(r,this.lexerConfig.WhiteSpace)||t.push(r);for(let n=1;n<e.length;++n){const i=e[n];if(ve(i,this.lexerConfig.WhiteSpace))continue;const a=e[n-1];ve(a,this.lexerConfig.WhiteSpace)&&(i.leadingWhitespace=a),t.push(i)}return t}tokenizeFormula(e){return this.lexer.tokenizeFormula(e)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Pn=(s,e,t,r)=>{switch(s.type){case y.EMPTY:case y.NUMBER:case y.STRING:case y.ERROR:return;case y.NAMED_EXPRESSION:{r&&t.push(new Pr(s.expressionName));return}case y.CELL_REFERENCE:{r&&t.push(new ud(s.reference));return}case y.CELL_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new Wy(s.start,s.end));return}case y.COLUMN_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new zy(s.start,s.end));return}case y.ROW_RANGE:{r&&s.start.sheet===s.end.sheet&&t.push(new jy(s.start,s.end));return}case y.PERCENT_OP:case y.PLUS_UNARY_OP:case y.MINUS_UNARY_OP:{Pn(s.value,e,t,!0);return}case y.CONCATENATE_OP:case y.EQUALS_OP:case y.NOT_EQUAL_OP:case y.LESS_THAN_OP:case y.GREATER_THAN_OP:case y.LESS_THAN_OR_EQUAL_OP:case y.GREATER_THAN_OR_EQUAL_OP:case y.MINUS_OP:case y.PLUS_OP:case y.TIMES_OP:case y.DIV_OP:case y.POWER_OP:Pn(s.left,e,t,!0),Pn(s.right,e,t,!0);return;case y.PARENTHESIS:Pn(s.expression,e,t,r);return;case y.FUNCTION_CALL:{const n=!e.doesFunctionNeedArgumentToBeComputed(s.procedureName);s.args.forEach(i=>Pn(i,e,t,n));return}}},xa=(s,e)=>{const t=new Array;return Pn(s,e,t,!0),t};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ud{constructor(e){this.dependency=e}absolutize(e){return this.dependency.toSimpleCellAddress(e)}}class Wy{constructor(e,t){this.start=e,this.end=t}absolutize(e){return new W(this.start.toSimpleCellAddress(e),this.end.toSimpleCellAddress(e))}}class zy{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleColumnAddress(e),r=this.end.toSimpleColumnAddress(e);return new Dr(t.sheet,t.col,r.col)}}class jy{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleRowAddress(e),r=this.end.toSimpleRowAddress(e);return new Vr(t.sheet,t.row,r.row)}}class Pr{constructor(e){this.name=e}absolutize(e){return this}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const vr=(s,e)=>s.map(t=>t.absolutize(e)),Yy=s=>s.filter(e=>e instanceof Pr?!0:e instanceof W?!(Ct(e.start)||Ct(e.end)):!Ct(e));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const te=Symbol("Empty value");function F(s){return s instanceof br?s.val:s}class br{constructor(e,t){this.val=e,this.format=t}fromNumber(e){return new this.constructor(e)}}function pu(s,e){if(typeof s=="number")return e;{const t=s.fromNumber(e);return t.format=s.format,t}}class mu extends br{getDetailedType(){return k.NUMBER_DATE}}class To extends br{getDetailedType(){return k.NUMBER_CURRENCY}}class gu extends br{getDetailedType(){return k.NUMBER_TIME}}class Eu extends br{getDetailedType(){return k.NUMBER_DATETIME}}class Fi extends br{getDetailedType(){return k.NUMBER_PERCENT}}function de(s){return typeof s=="number"||s instanceof br}var k;(function(s){s.NUMBER_RAW="NUMBER_RAW",s.NUMBER_DATE="NUMBER_DATE",s.NUMBER_TIME="NUMBER_TIME",s.NUMBER_DATETIME="NUMBER_DATETIME",s.NUMBER_CURRENCY="NUMBER_CURRENCY",s.NUMBER_PERCENT="NUMBER_PERCENT"})(k||(k={}));function $y(s){return s instanceof br?s.getDetailedType():k.NUMBER_RAW}function Xy(s){if(s instanceof br)return s.format}function ra(s){return s instanceof br?{type:s.getDetailedType(),format:s.format}:{type:k.NUMBER_RAW}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class D{constructor(e,t,r,n){this._data=e,this.range=t,this.dependencyGraph=r,this._hasOnlyNumbers=n,this.size=e===void 0?new Z(t.effectiveWidth(r),t.effectiveHeight(r)):new Z(e[0].length,e.length)}get data(){return this.ensureThatComputed(),this._data}static fromRange(e,t,r){return new D(e,t,r,!0)}static onlyNumbers(e){return new D(e,void 0,void 0,!0)}static onlyValues(e){return new D(e,void 0,void 0,void 0)}static onlyRange(e,t){return new D(void 0,e,t,void 0)}static fromScalar(e){return new D([[e]],void 0,void 0,void 0)}isAdHoc(){return this.range===void 0}width(){return this.size.width}height(){return this.size.height}valuesFromTopLeftCorner(){this.ensureThatComputed();const e=[];for(let t=0;t<this._data.length;t++)for(let r=0;r<this._data[0].length;r++)e.push(this._data[t][r]);return e}*effectiveAddressesFromData(e){for(let t=0;t<this.data.length;++t){const r=this.data[t];for(let n=0;n<r.length;++n)yield U(e.sheet,e.col+n,e.row+t)}}*entriesFromTopLeftCorner(e){this.ensureThatComputed();for(let t=0;t<this.size.height;++t)for(let r=0;r<this.size.width;++r)yield[this._data[t][r],U(e.sheet,e.col+r,e.row+t)]}*iterateValuesFromTopLeftCorner(){yield*this.valuesFromTopLeftCorner()}numberOfElements(){return this.size.width*this.size.height}hasOnlyNumbers(){if(this._hasOnlyNumbers===void 0){this._hasOnlyNumbers=!0;for(const e of this.data)for(const t of e)if(typeof t!="number")return this._hasOnlyNumbers=!1,!1}return this._hasOnlyNumbers}rawNumbers(){return this._data}rawData(){var e;return this.ensureThatComputed(),(e=this._data)!==null&&e!==void 0?e:[]}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}ensureThatComputed(){this._data===void 0&&(this._hasOnlyNumbers=!0,this._data=this.range.addressesArrayMap(this.dependencyGraph,e=>{const t=this.dependencyGraph.getCellValue(e);return t instanceof D?(this._hasOnlyNumbers=!1,new g(R.VALUE,T.ScalarExpected)):(de(t)||(this._hasOnlyNumbers=!1),t)}))}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class tn{constructor(){this.changes=new Map}static empty(){return new tn}addAll(e){for(const t of e.changes.values())this.add(t.address,t);return this}addChange(e,t,r){this.addInterpreterValue(e,t,r)}exportChanges(e){let t=[];return this.changes.forEach(r=>{const n=e.exportChange(r);Array.isArray(n)?t=t.concat(n):t.push(n)}),t}getChanges(){return Array.from(this.changes.values())}isEmpty(){return this.changes.size===0}add(e,t){const r=t.value;if(r instanceof D)for(const n of r.effectiveAddressesFromData(e))this.changes.delete(_s(n));this.changes.set(_s(e),t)}addInterpreterValue(e,t,r){this.add(t,{address:t,value:e,oldValue:r})}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class wt{constructor(e,t,r){if(this.sheet=e,this.rowStart=t,this.rowEnd=r,t<0)throw Error("Starting row cant be less than 0");if(r<t)throw Error("Row span cant end before start")}get numberOfRows(){return this.rowEnd-this.rowStart+1}get start(){return this.rowStart}get end(){return this.rowEnd}static fromNumberOfRows(e,t,r){return new wt(e,t,t+r-1)}static fromRowStartAndEnd(e,t,r){return new wt(e,t,r)}*rows(){for(let e=this.rowStart;e<=this.rowEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.rowStart,e.rowStart),r=Math.min(this.rowEnd,e.rowEnd);return t>r?null:new wt(this.sheet,t,r)}firstRow(){return new wt(this.sheet,this.rowStart,this.rowStart)}}class Vt{constructor(e,t,r){if(this.sheet=e,this.columnStart=t,this.columnEnd=r,t<0)throw Error("Starting column cant be less than 0");if(r<t)throw Error("Column span cant end before start")}get numberOfColumns(){return this.columnEnd-this.columnStart+1}get start(){return this.columnStart}get end(){return this.columnEnd}static fromNumberOfColumns(e,t,r){return new Vt(e,t,t+r-1)}static fromColumnStartAndEnd(e,t,r){return new Vt(e,t,r)}*columns(){for(let e=this.columnStart;e<=this.columnEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.columnStart,e.columnStart),r=Math.min(this.columnEnd,e.columnEnd);return t>r?null:new Vt(this.sheet,t,r)}firstColumn(){return new Vt(this.sheet,this.columnStart,this.columnStart)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var K;(function(s){s.BUILD_ENGINE_TOTAL="BUILD_ENGINE_TOTAL",s.PARSER="PARSER",s.GRAPH_BUILD="GRAPH_BUILD",s.COLLECT_DEPENDENCIES="COLLECT_DEPENDENCIES",s.PROCESS_DEPENDENCIES="PROCESS_DEPENDENCIES",s.TOP_SORT="TOP_SORT",s.BUILD_COLUMN_INDEX="BUILD_COLUMN_INDEX",s.EVALUATION="EVALUATION",s.VLOOKUP="VLOOKUP",s.TRANSFORM_ASTS="TRANSFORM_ASTS",s.TRANSFORM_ASTS_POSTPONED="TRANSFORM_ASTS_POSTPONED",s.ADJUSTING_ADDRESS_MAPPING="ADJUSTING_ADDRESS_MAPPING",s.ADJUSTING_ARRAY_MAPPING="ADJUSTING_ARRAY_MAPPING",s.ADJUSTING_RANGES="ADJUSTING_RANGES",s.ADJUSTING_GRAPH="ADJUSTING_GRAPH",s.CRITERION_FUNCTION_FULL_CACHE_USED="CRITERION_FUNCTION_FULL_CACHE_USED",s.CRITERION_FUNCTION_PARTIAL_CACHE_USED="CRITERION_FUNCTION_PARTIAL_CACHE_USED"})(K||(K={}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ld{constructor(){this.stats=new Map([[K.CRITERION_FUNCTION_FULL_CACHE_USED,0],[K.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0]]),this.startTimes=new Map}incrementCriterionFunctionFullCacheUsed(){var e;const t=((e=this.stats.get(K.CRITERION_FUNCTION_FULL_CACHE_USED))!==null&&e!==void 0?e:0)+1;this.stats.set(K.CRITERION_FUNCTION_FULL_CACHE_USED,t)}incrementCriterionFunctionPartialCacheUsed(){var e;const t=((e=this.stats.get(K.CRITERION_FUNCTION_PARTIAL_CACHE_USED))!==null&&e!==void 0?e:0)+1;this.stats.set(K.CRITERION_FUNCTION_PARTIAL_CACHE_USED,t)}reset(){this.stats.clear(),this.startTimes.clear(),this.stats.set(K.CRITERION_FUNCTION_FULL_CACHE_USED,0),this.stats.set(K.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0)}start(e){if(this.startTimes.get(e))throw Error(`Statistics ${e} already started`);this.startTimes.set(e,Date.now())}end(e){var t;const r=Date.now(),n=this.startTimes.get(e);if(n){let i=(t=this.stats.get(e))!==null&&t!==void 0?t:0;i+=r-n,this.stats.set(e,i),this.startTimes.delete(e)}else throw Error(`Statistics ${e} not started`)}measure(e,t){this.start(e);const r=t();return this.end(e),r}snapshot(){return new Map(this.stats)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ky extends ld{incrementCriterionFunctionFullCacheUsed(){}incrementCriterionFunctionPartialCacheUsed(){}start(e){}end(e){}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Le extends Error{constructor(e){super(`There's no sheet with id = ${e}`)}}class cd extends Error{constructor(e){super(`There's no sheet with name '${e}'`)}}class Ws extends Error{constructor(e){super(`Sheet with name ${e} already exists`)}}class Tn extends Error{constructor(){super("Sheet size limit exceeded")}}class Ui extends Error{constructor(){super("This is not a formula")}}class hd extends Error{constructor(e){super(`Address (row = ${e.row}, col = ${e.col}) is invalid`)}}class $e extends Error{constructor(e){super(`Invalid arguments, expected ${e}`)}}class zs extends Error{constructor(e,t){super(`Sheets ${e} and ${t} are not equal.`)}}class dd extends Error{constructor(e){super(`Name of Named Expression '${e}' is already present`)}}class fd extends Error{constructor(e){super(`Name of Named Expression '${e}' is invalid`)}}class js extends Error{constructor(e){super(`Named Expression '${e}' does not exist`)}}class pd extends Error{constructor(){super("There is no operation to undo")}}class md extends Error{constructor(){super("There is no operation to redo")}}class gd extends Error{constructor(){super("There is nothing to paste")}}function qy(s,e){switch(typeof e){case"function":case"symbol":return e.toString();case"bigint":return"BigInt("+e.toString()+")";default:return e instanceof RegExp?"RegExp("+e.toString()+")":e}}class Ed extends Error{constructor(e){super(`Unable to parse value: ${JSON.stringify(e,qy,4)}`)}}class he extends Error{constructor(e,t){super(`Expected value of type: ${e} for config parameter: ${t}`)}}class Qy extends Error{constructor(e){super(`Config parameter ${e} cannot be empty.`)}}class Rd extends Error{constructor(e,t){super(`Config parameter ${e} should be at least ${t}`)}}class yd extends Error{constructor(e,t){super(`Config parameter ${e} should be at most ${t}`)}}class Nd extends Error{constructor(e,t){super(`Expected one of ${e} for config parameter: ${t}`)}}class Td extends Error{constructor(){super("Computations are suspended")}}class Dn extends Error{constructor(e){super(`Translation for ${e} is missing in the translation package you're using.`)}}class vd extends Error{constructor(e){super(`Cannot register translation for function with id: ${e}`)}}class vo extends Error{constructor(){super("Language not registered.")}}class Sd extends Error{constructor(){super("Language already registered.")}}class es extends Error{static functionNotDeclaredInPlugin(e,t){return new es(`Function with id ${e} not declared in plugin ${t}`)}static functionMethodNotFound(e,t){return new es(`Function method ${e} not found in plugin ${t}`)}}class vn extends Error{static cannotRegisterFunctionWithId(e){return new vn(`Cannot register function with id ${e}`)}static cannotUnregisterFunctionWithId(e){return new vn(`Cannot unregister function with id ${e}`)}static cannotUnregisterProtectedPlugin(){return new vn("Cannot unregister protected plugin")}}class Wn extends Error{constructor(){super("Cannot perform this operation, source location has an array inside.")}}class na extends Error{constructor(){super("Cannot perform this operation, target location has an array inside.")}}class Ru extends Error{constructor(){super("Relative addresses not allowed in named expressions.")}}class Zy extends Error{constructor(e,t){super(`Alias id ${e} in plugin ${t} already defined as a function or alias.`)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Jy{constructor(e){this.policy=e,this.mapping=new Map}getCell(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new Le(e.sheet);return t.getCell(e)}fetchCell(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new Le(e.sheet);const r=t.getCell(e);if(!r)throw Error("Vertex for address missing in AddressMapping");return r}strategyFor(e){const t=this.mapping.get(e);if(t===void 0)throw new Le(e);return t}addSheet(e,t){if(this.mapping.has(e))throw Error("Sheet already added");this.mapping.set(e,t)}autoAddSheet(e,t){const{height:r,width:n,fill:i}=t,a=this.policy.call(i);this.addSheet(e,new a(n,r))}getCellValue(e){const t=this.getCell(e);return t===void 0?te:t instanceof ze?t.getArrayCellValue(e):t.getCellValue()}getRawValue(e){const t=this.getCell(e);return t instanceof rn?t.getValues().rawValue:t instanceof ze?t.getArrayCellRawValue(e):null}setCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized");r.setCell(e,t)}moveCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized.");if(e.sheet!==t.sheet)throw Error("Cannot move cells between sheets.");if(r.has(t))throw new Error("Cannot move cell. Destination already occupied.");const n=r.getCell(e);if(n===void 0)throw new Error("Cannot move cell. No cell with such address.");this.setCell(t,n),this.removeCell(e)}removeCell(e){const t=this.mapping.get(e.sheet);if(!t)throw Error("Sheet not initialized");t.removeCell(e)}has(e){const t=this.mapping.get(e.sheet);return t===void 0?!1:t.has(e)}getHeight(e){const t=this.mapping.get(e);if(t===void 0)throw new Le(e);return t.getHeight()}getWidth(e){const t=this.mapping.get(e);if(!t)throw new Le(e);return t.getWidth()}addRows(e,t,r){const n=this.mapping.get(e);if(n===void 0)throw new Le(e);n.addRows(t,r)}removeRows(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new Le(e.sheet);t.removeRows(e)}removeSheet(e){this.mapping.delete(e)}addColumns(e,t,r){const n=this.mapping.get(e);if(n===void 0)throw new Le(e);n.addColumns(t,r)}removeColumns(e){const t=this.mapping.get(e.sheet);if(t===void 0)throw new Le(e.sheet);t.removeColumns(e)}*verticesFromRowsSpan(e){yield*this.mapping.get(e.sheet).verticesFromRowsSpan(e)}*verticesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).verticesFromColumnsSpan(e)}*entriesFromRowsSpan(e){yield*this.mapping.get(e.sheet).entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).entriesFromColumnsSpan(e)}*entries(){for(const[e,t]of this.mapping.entries())yield*t.getEntries(e)}*sheetEntries(e){const t=this.mapping.get(e);if(t!==void 0)yield*t.getEntries(e);else throw new Le(e)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class eN{constructor(){this.arrayMapping=new Map}getArray(e){const t=this.getArrayByCorner(e.start);if(t?.getRange().sameAs(e))return t}getArrayByCorner(e){return this.arrayMapping.get(_s(e))}setArray(e,t){this.arrayMapping.set(_s(e.start),t)}removeArray(e){typeof e=="string"?this.arrayMapping.delete(e):this.arrayMapping.delete(_s(e.start))}count(){return this.arrayMapping.size}*arraysInRows(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetRows(e.sheet,e.rowStart,e.rowEnd)&&(yield[t,r])}*arraysInCols(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetColumn(e.sheet,e.columnStart,e.columnEnd)&&(yield[t,r])}isFormulaArrayInRow(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetRows(e,t))return!0;return!1}isFormulaArrayInAllRows(e){let t=!0;for(const r of e.rows())this.isFormulaArrayInRow(e.sheet,r)||(t=!1);return t}isFormulaArrayInColumn(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetColumn(e,t))return!0;return!1}isFormulaArrayInAllColumns(e){let t=!0;for(const r of e.columns())this.isFormulaArrayInColumn(e.sheet,r)||(t=!1);return t}isFormulaArrayInRange(e){for(const t of this.arrayMapping.values())if(t.getRange().doesOverlap(e))return!0;return!1}isFormulaArrayAtAddress(e){for(const t of this.arrayMapping.values())if(t.getRange().addressInRange(e))return!0;return!1}moveArrayVerticesAfterRowByRows(e,t,r){this.updateArrayVerticesInSheet(e,(n,i)=>{const a=i.getRange();return t<=a.start.row?[a.shifted(0,r),i]:void 0})}moveArrayVerticesAfterColumnByColumns(e,t,r){this.updateArrayVerticesInSheet(e,(n,i)=>{const a=i.getRange();return t<=a.start.col?[a.shifted(r,0),i]:void 0})}updateArrayVerticesInSheet(e,t){const r=Array();for(const[n,i]of this.arrayMapping.entries()){if(i.sheet!==e)continue;const a=t(n,i);a!==void 0&&(this.removeArray(n),r.push(a))}r.forEach(([n,i])=>{this.setArray(n,i)})}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ss{constructor(e){this.size=e}width(){return this.size.width}height(){return this.size.height}get(e,t){throw Error("Array not computed yet.")}simpleRangeValue(){throw Error("Array not computed yet.")}}class ts{constructor(e){if(this.size=new Z(e.length>0?e[0].length:0,e.length),this.array=e,this.size.width<=0||this.size.height<=0)throw Error("Incorrect array size")}static fromInterpreterValue(e){return e instanceof D?new ts(e.data):new ts([[e]])}simpleRangeValue(){return D.onlyValues(this.array)}addRows(e,t){this.array.splice(e,0,...this.nullArrays(t,this.width())),this.size.height+=t}addColumns(e,t){for(let r=0;r<this.height();r++)this.array[r].splice(e,0,...new Array(t).fill(te));this.size.width+=t}removeRows(e,t){if(this.outOfBound(0,e)||this.outOfBound(0,t))throw Error("Array index out of bound");const r=t-e+1;this.array.splice(e,r),this.size.height-=r}removeColumns(e,t){if(this.outOfBound(e,0)||this.outOfBound(t,0))throw Error("Array index out of bound");const r=t-e+1;for(const n of this.array)n.splice(e,r);this.size.width-=r}nullArrays(e,t){const r=[];for(let n=0;n<e;++n)r.push(new Array(t).fill(te));return r}get(e,t){if(this.outOfBound(e,t))throw Error("Array index out of bound");return this.array[t][e]}set(e,t,r){if(this.outOfBound(e,t))throw Error("Array index out of bound");this.array[t][e]=r}width(){return this.size.width}height(){return this.size.height}raw(){return this.array}resize(e){if(this.height()<e.height&&isFinite(e.height)&&this.addRows(this.height(),e.height-this.height()),this.height()>e.height||(this.width()<e.width&&isFinite(e.width)&&this.addColumns(this.width(),e.width-this.width()),this.width()>e.width))throw Error("Resizing to smaller array")}outOfBound(e,t){return e<0||t<0||t>this.size.height-1||e>this.size.width-1}}class Xa{constructor(e,t){this.error=e,this.size=t}get(e,t){return this.error}width(){return this.size.width}height(){return this.size.height}simpleRangeValue(){return this.error}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Bt{constructor(e,t,r){this.formula=e,this.cellAddress=t,this.version=r}get width(){return 1}get height(){return 1}static fromAst(e,t,r,n){return r.isScalar()?new Sr(e,t,n):new ze(e,t,r,n)}getFormula(e){return this.ensureRecentData(e),this.formula}ensureRecentData(e){if(this.version!=e.version()){const[t,r,n]=e.applyTransformations(this.formula,this.cellAddress,this.version);this.formula=t,this.cellAddress=r,this.version=n}}getAddress(e){return this.ensureRecentData(e),this.cellAddress}}class ze extends Bt{constructor(e,t,r,n=0){super(e,t,n),r.isRef?this.array=new Xa(new g(R.REF,T.NoSpaceForArrayResult),Z.error()):this.array=new Ss(r)}get width(){return this.array.width()}get height(){return this.array.height()}get sheet(){return this.cellAddress.sheet}get leftCorner(){return this.cellAddress}setCellValue(e){if(e instanceof g)return this.setErrorValue(e),e;const t=ts.fromInterpreterValue(e);return t.resize(this.array.size),this.array=t,e}getCellValue(){if(this.array instanceof Ss)throw Error("Array not computed yet.");return this.array.simpleRangeValue()}valueOrUndef(){if(!(this.array instanceof Ss))return this.array.simpleRangeValue()}getArrayCellValue(e){const t=e.col-this.cellAddress.col,r=e.row-this.cellAddress.row;try{return this.array.get(t,r)}catch{return new g(R.REF)}}getArrayCellRawValue(e){const t=this.getArrayCellValue(e);if(!(t instanceof g||t===te))return F(t)}setArrayCellValue(e,t){const r=e.col-this.cellAddress.col,n=e.row-this.cellAddress.row;this.array instanceof ts&&this.array.set(r,n,t)}setNoSpace(){return this.array=new Xa(new g(R.SPILL,T.NoSpaceForArrayResult),Z.error()),this.getCellValue()}getRange(){return W.spanFrom(this.cellAddress,this.width,this.height)}getRangeOrUndef(){return W.spanFromOrUndef(this.cellAddress,this.width,this.height)}setAddress(e){this.cellAddress=e}setFormula(e){this.formula=e}spansThroughSheetRows(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.row<=r&&t<this.cellAddress.row+this.height}spansThroughSheetColumn(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.col<=r&&t<this.cellAddress.col+this.width}isComputed(){return!(this.array instanceof Ss)}columnsFromArray(){return Vt.fromNumberOfColumns(this.cellAddress.sheet,this.cellAddress.col,this.width)}rowsFromArray(){return wt.fromNumberOfRows(this.cellAddress.sheet,this.cellAddress.row,this.height)}ensureRecentData(e){}isLeftCorner(e){return $s(this.cellAddress,e)}setErrorValue(e){this.array=new Xa(e,this.array.size)}}class Sr extends Bt{constructor(e,t,r){super(e,t,r)}valueOrUndef(){return this.cachedCellValue}setCellValue(e){return this.cachedCellValue=e,this.cachedCellValue}getCellValue(){if(this.cachedCellValue!==void 0)return this.cachedCellValue;throw Error("Value of the formula cell is not computed.")}isComputed(){return this.cachedCellValue!==void 0}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pt{constructor(e){this.range=e,this.functionCache=new Map,this.criterionFunctionCache=new Map,this.dependentCacheRanges=new Set,this.bruteForce=!1}get start(){return this.range.start}get end(){return this.range.end}get sheet(){return this.range.start.sheet}getFunctionValue(e){return this.functionCache.get(e)}setFunctionValue(e,t){this.functionCache.set(e,t)}getCriterionFunctionValue(e,t){var r;return(r=this.getCriterionFunctionValues(e).get(t))===null||r===void 0?void 0:r[0]}getCriterionFunctionValues(e){var t;return(t=this.criterionFunctionCache.get(e))!==null&&t!==void 0?t:new Map}setCriterionFunctionValues(e,t){this.criterionFunctionCache.set(e,t)}addDependentCacheRange(e){e!==this&&this.dependentCacheRanges.add(e)}clearCache(){this.functionCache.clear(),this.criterionFunctionCache.clear(),this.dependentCacheRanges.forEach(e=>e.criterionFunctionCache.clear()),this.dependentCacheRanges.clear()}getStart(){return this.start}getEnd(){return this.end}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const tN=(s,e,t,r,n)=>{if(e instanceof pt){const o=e.range.intersectionWith(t);return o!==void 0?Array.from(o.addresses(n)):[]}let i,a;if(e instanceof Bt)i=e.getFormula(r),a=e.getAddress(r);else return[];return xa(i,s).filter(o=>o instanceof ud).map(o=>o.dependency.toSimpleCellAddress(a)).filter(o=>t.addressInRange(o))};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Fr;(function(s){s[s.ON_STACK=0]="ON_STACK",s[s.PROCESSED=1]="PROCESSED",s[s.POPPED=2]="POPPED"})(Fr||(Fr={}));class rN{constructor(e=[],t=[]){this.nodesSparseArray=e,this.edgesSparseArray=t,this.entranceTime=[],this.low=[],this.parent=[],this.inSCC=[],this.nodeStatus=[],this.order=[],this.sccNonSingletons=[],this.timeCounter=0}getTopSortedWithSccSubgraphFrom(e,t,r){const n=e.reverse();return n.forEach(i=>this.runDFS(i)),this.postprocess(n,r,t)}getAdjacentNodeIds(e){return this.edgesSparseArray[e].filter(t=>t!==void 0&&this.nodesSparseArray[t])}runDFS(e){if(this.nodeStatus[e]!==void 0)return;this.nodeStatus[e]=Fr.ON_STACK;const t=[e],r=[];for(;t.length>0;){const n=t[t.length-1];switch(this.nodeStatus[n]){case Fr.ON_STACK:{this.handleOnStack(n,r,t);break}case Fr.PROCESSED:{this.handleProcessed(n,r,t);break}case Fr.POPPED:{t.pop();break}}}}handleOnStack(e,t,r){this.entranceTime[e]=this.timeCounter,this.low[e]=this.timeCounter,this.timeCounter++,t.push(e),this.getAdjacentNodeIds(e).forEach(n=>{this.entranceTime[n]===void 0&&(r.push(n),this.parent[n]=e,this.nodeStatus[n]=Fr.ON_STACK)}),this.nodeStatus[e]=Fr.PROCESSED}handleProcessed(e,t,r){let n=this.entranceTime[e];if(this.getAdjacentNodeIds(e).forEach(i=>{this.inSCC[i]||(n=this.parent[i]===e?Math.min(n,this.low[i]):Math.min(n,this.entranceTime[i]))}),this.low[e]=n,n===this.entranceTime[e]){const i=[];do i.push(t[t.length-1]),t.pop();while(i[i.length-1]!==e);i.forEach(a=>{this.inSCC[a]=!0}),this.order.push(...i),i.length>1&&i.forEach(a=>{this.sccNonSingletons[a]=!0})}r.pop(),this.nodeStatus[e]=Fr.POPPED}postprocess(e,t,r){const n=[];e.forEach(o=>{n[o]=!0});const i=[],a=[];return this.order.reverse(),this.order.forEach(o=>{const u=this.getAdjacentNodeIds(o);this.sccNonSingletons[o]||u.includes(o)?(a.push(this.nodesSparseArray[o]),t(this.nodesSparseArray[o]),u.forEach(l=>n[l]=!0)):(i.push(this.nodesSparseArray[o]),n[o]&&r(this.nodesSparseArray[o])&&u.forEach(l=>n[l]=!0))}),{sorted:i,cycled:a}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class nN{constructor(e,t){this.rawValue=e,this.processFn=t,this.processedValue=null}getProcessedValue(){return this.processedValue===null&&(this.processedValue=this.processFn(this.rawValue)),this.processedValue}markAsModified(){this.processedValue=null}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class sN{constructor(e){this.dependencyQuery=e,this.nodesSparseArray=[],this.edgesSparseArray=[],this.nodesIds=new Map,this.dirtyAndVolatileNodeIds=new nN({dirty:[],volatile:[]},t=>this.processDirtyAndVolatileNodeIds(t)),this.infiniteRangeIds=new Set,this.changingWithStructureNodeIds=[],this.nextId=0}getNodes(){return this.nodesSparseArray.filter(e=>e!==void 0)}hasNode(e){return this.nodesIds.has(e)}existsEdge(e,t){const r=this.getNodeId(e),n=this.getNodeId(t);return r===void 0||n===void 0?!1:this.edgesSparseArray[r].includes(n)}adjacentNodes(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);return new Set(this.edgesSparseArray[t].filter(r=>r!==void 0).map(r=>this.nodesSparseArray[r]))}adjacentNodesCount(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);return this.fixEdgesArrayForNode(t).length}addNodeAndReturnId(e){const t=this.nodesIds.get(e);if(t!==void 0)return t;const r=this.nextId;return this.nextId++,this.nodesSparseArray[r]=e,this.edgesSparseArray[r]=[],this.nodesIds.set(e,r),r}addEdge(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0)throw this.missingNodeError(e);if(n===void 0)throw this.missingNodeError(t);this.edgesSparseArray[r].includes(n)||this.edgesSparseArray[r].push(n)}removeNode(e){const t=this.getNodeId(e);if(t===void 0)throw this.missingNodeError(e);this.edgesSparseArray[t].length>0&&(this.edgesSparseArray[t].forEach(n=>this.dirtyAndVolatileNodeIds.rawValue.dirty.push(n)),this.dirtyAndVolatileNodeIds.markAsModified());const r=this.removeDependencies(e);return delete this.nodesSparseArray[t],delete this.edgesSparseArray[t],this.infiniteRangeIds.delete(t),this.nodesIds.delete(e),r}removeEdge(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0)throw this.missingNodeError(e);if(n===void 0)throw this.missingNodeError(t);const i=this.edgesSparseArray[r].indexOf(n);if(i===-1)throw new Error("Edge does not exist");delete this.edgesSparseArray[r][i]}removeEdgeIfExists(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(r===void 0||n===void 0)return;const i=this.edgesSparseArray[r].indexOf(n);i!==-1&&delete this.edgesSparseArray[r][i]}topSortWithScc(){return this.getTopSortedWithSccSubgraphFrom(this.getNodes(),()=>!0,()=>{})}getTopSortedWithSccSubgraphFrom(e,t,r){const n=new rN(this.nodesSparseArray,this.edgesSparseArray),i=e.map(a=>this.getNodeId(a)).filter(a=>a!==void 0);return n.getTopSortedWithSccSubgraphFrom(i,t,r)}markNodeAsVolatile(e){const t=this.getNodeId(e);t!==void 0&&(this.dirtyAndVolatileNodeIds.rawValue.volatile.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsDirty(e){const t=this.getNodeId(e);t!==void 0&&(this.dirtyAndVolatileNodeIds.rawValue.dirty.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}getDirtyAndVolatileNodes(){return this.dirtyAndVolatileNodeIds.getProcessedValue()}clearDirtyNodes(){this.dirtyAndVolatileNodeIds.rawValue.dirty=[],this.dirtyAndVolatileNodeIds.markAsModified()}markNodeAsChangingWithStructure(e){const t=this.getNodeId(e);t!==void 0&&this.changingWithStructureNodeIds.push(t)}markChangingWithStructureNodesAsDirty(){this.changingWithStructureNodeIds.length<=0||(this.dirtyAndVolatileNodeIds.rawValue.dirty=[...this.dirtyAndVolatileNodeIds.rawValue.dirty,...this.changingWithStructureNodeIds],this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsInfiniteRange(e){const t=this.getNodeIdIfNotNumber(e);t!==void 0&&this.infiniteRangeIds.add(t)}getInfiniteRanges(){return[...this.infiniteRangeIds].map(e=>({node:this.nodesSparseArray[e],id:e}))}getNodeId(e){return this.nodesIds.get(e)}getNodeIdIfNotNumber(e){return typeof e=="number"?e:this.nodesIds.get(e)}fixEdgesArrayForNode(e){const t=this.edgesSparseArray[e];return this.edgesSparseArray[e]=t.filter(r=>r!==void 0&&this.nodesSparseArray[r]),this.edgesSparseArray[e]}removeDependencies(e){const t=this.dependencyQuery(e);return t.forEach(([r,n])=>{this.removeEdgeIfExists(n,e)}),t}processDirtyAndVolatileNodeIds({dirty:e,volatile:t}){return[...new Set([...e,...t])].map(r=>this.nodesSparseArray[r]).filter(r=>r!==void 0)}missingNodeError(e){return new Error(`Unknown node ${e}`)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class iN{constructor(){this.rangeMapping=new Map}getMappingSize(e){var t,r;return(r=(t=this.rangeMapping.get(e))===null||t===void 0?void 0:t.size)!==null&&r!==void 0?r:0}setRange(e){let t=this.rangeMapping.get(e.getStart().sheet);t===void 0&&(t=new Map,this.rangeMapping.set(e.getStart().sheet,t));const r=Pi(e.getStart(),e.getEnd());t.set(r,e)}removeRange(e){const t=e.getStart().sheet,r=this.rangeMapping.get(t);if(r===void 0)return;const n=Pi(e.getStart(),e.getEnd());r.delete(n),r.size===0&&this.rangeMapping.delete(t)}getRange(e,t){const r=this.rangeMapping.get(e.sheet),n=Pi(e,t);return r?.get(n)}fetchRange(e,t){const r=this.getRange(e,t);if(!r)throw Error("Range does not exist");return r}truncateRanges(e,t){const r=Array(),n=Array(),i=Array(),a=e.sheet;for(const[u,l]of this.entriesFromSheet(e.sheet)){const c=l.range;e.start<=t(l.range.end)&&(c.removeSpan(e),c.shouldBeRemoved()?(this.removeByKey(a,u),r.push(l)):n.push([u,l]),i.push(l))}const o=[];n.sort((u,l)=>oN(u[1],l[1],t));for(const[u,l]of n){const c=aN(l.range);if(c===u)continue;const d=this.getByKey(a,c);this.removeByKey(a,u),d!==void 0&&l!=d?o.push([d,l]):this.setRange(l)}return{verticesToRemove:r,verticesToMerge:o,verticesWithChangedSize:i}}moveAllRangesInSheetAfterRowByRows(e,t,r){return this.updateVerticesFromSheet(e,(n,i)=>t<=i.start.row?(i.range.shiftByRows(r),{changedSize:!1,vertex:i}):t>i.start.row&&t<=i.end.row?(i.range.expandByRows(r),{changedSize:!0,vertex:i}):void 0)}moveAllRangesInSheetAfterColumnByColumns(e,t,r){return this.updateVerticesFromSheet(e,(n,i)=>t<=i.start.col?(i.range.shiftByColumns(r),{changedSize:!1,vertex:i}):t>i.start.col&&t<=i.end.col?(i.range.expandByColumns(r),{changedSize:!0,vertex:i}):void 0)}moveRangesInsideSourceRange(e,t,r,n){this.updateVerticesFromSheet(e.sheet,(i,a)=>{if(e.containsRange(a.range))return a.range.shiftByColumns(t),a.range.shiftByRows(r),a.range.moveToSheet(n),{changedSize:!1,vertex:a}})}removeRangesInSheet(e){if(this.rangeMapping.has(e)){const t=this.rangeMapping.get(e).values();return this.rangeMapping.delete(e),t}return[][Symbol.iterator]()}*rangesInSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.values())}*rangeVerticesContainedInRange(e){for(const t of this.rangesInSheet(e.sheet))e.containsRange(t.range)&&(yield t)}findSmallerRange(e){if(e.height()>1&&Number.isFinite(e.height())){const t=U(e.end.sheet,e.end.col,e.end.row-1),r=this.getRange(e.start,t);if(r!==void 0){const n=W.fromSimpleCellAddresses(U(e.start.sheet,e.start.col,e.end.row),e.end);return{smallerRangeVertex:r,restRange:n}}}return{restRange:e}}*entriesFromSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.entries())}removeByKey(e,t){this.rangeMapping.get(e).delete(t)}getByKey(e,t){var r;return(r=this.rangeMapping.get(e))===null||r===void 0?void 0:r.get(t)}updateVerticesFromSheet(e,t){const r=Array();for(const[n,i]of this.entriesFromSheet(e)){const a=t(n,i);a!==void 0&&(this.removeByKey(e,n),r.push(a))}return r.forEach(n=>{this.setRange(n.vertex)}),{verticesWithChangedSize:r.filter(n=>n.changedSize).map(n=>n.vertex)}}}function Pi(s,e){return`${s.col},${s.row},${e.col},${e.row}`}function aN(s){return Pi(s.start,s.end)}const oN=(s,e,t)=>{const r=t(s.range.start),n=t(s.range.start);if(r===n){const i=t(s.range.end),a=t(e.range.end);return i-a}else return r-n};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class uN{constructor(e,t,r){this.functions=e,this.errors=t,this.ui=r,this._protectedTranslations={VERSION:"VERSION"},this.checkUI(),this.checkErrors(),this.checkFunctionTranslations(this.functions),Object.assign(this.functions,this._protectedTranslations)}extendFunctions(e){this.checkFunctionTranslations(e),Object.assign(this.functions,e)}buildFunctionMapping(){return Object.keys(this.functions).reduce((e,t)=>(e[this.functions[t]]=t,e),{})}buildErrorMapping(){return Object.keys(this.errors).reduce((e,t)=>(e[this.errors[t]]=t,e),{})}isFunctionTranslated(e){return this.functions[e]!==void 0}getFunctionTranslations(e){const t=[];for(const r of e)this.isFunctionTranslated(r)&&t.push(this.functions[r]);return t}getFunctionTranslation(e){const t=this.functions[e];if(t===void 0)throw new Dn(`functions.${e}`);return t}getMaybeFunctionTranslation(e){return this.functions[e]}getErrorTranslation(e){if(e===R.LIC)return`#${R.LIC}!`;const t=this.errors[e];if(t===void 0)throw new Dn(`errors.${e}`);return t}getUITranslation(e){const t=this.ui[e];if(t===void 0)throw new Dn(`ui.${e}`);return t}checkUI(){for(const e of Object.values(Ys))if(!(e in this.ui))throw new Dn(`ui.${e}`)}checkErrors(){for(const e of Object.values(R))if(!(e in this.errors)&&e!==R.LIC)throw new Dn(`errors.${e}`)}checkFunctionTranslations(e){const t=new Set(Object.getOwnPropertyNames(e));for(const r of Object.getOwnPropertyNames(this._protectedTranslations))if(t.has(r))throw new vd(r)}}function lN(s){return new uN(Object.assign({},s.functions),Object.assign({},s.errors),Object.assign({},s.ui))}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Ys;(function(s){s.NEW_SHEET_PREFIX="NEW_SHEET_PREFIX"})(Ys||(Ys={}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Vn(s){return s.toLowerCase()}class cN{constructor(e,t){this.id=e,this.displayName=t}get canonicalName(){return Vn(this.displayName)}}class hN{constructor(e){this.languages=e,this.mappingFromCanonicalName=new Map,this.mappingFromId=new Map,this.lastSheetId=-1,this.fetch=t=>{const r=this.mappingFromCanonicalName.get(Vn(t));if(r===void 0)throw new cd(t);return r.id},this.get=t=>{var r;return(r=this.mappingFromCanonicalName.get(Vn(t)))===null||r===void 0?void 0:r.id},this.fetchDisplayName=t=>this.fetchSheetById(t).displayName,this.sheetNamePrefix=e.getUITranslation(Ys.NEW_SHEET_PREFIX)}addSheet(e=`${this.sheetNamePrefix}${this.lastSheetId+2}`){const t=Vn(e);if(this.mappingFromCanonicalName.has(t))throw new Ws(e);this.lastSheetId++;const r=new cN(this.lastSheetId,e);return this.store(r),r.id}removeSheet(e){const t=this.fetchSheetById(e);e==this.lastSheetId&&--this.lastSheetId,this.mappingFromCanonicalName.delete(t.canonicalName),this.mappingFromId.delete(t.id)}getDisplayName(e){var t;return(t=this.mappingFromId.get(e))===null||t===void 0?void 0:t.displayName}*displayNames(){for(const e of this.mappingFromCanonicalName.values())yield e.displayName}numberOfSheets(){return this.mappingFromCanonicalName.size}hasSheetWithId(e){return this.mappingFromId.has(e)}hasSheetWithName(e){return this.mappingFromCanonicalName.has(Vn(e))}renameSheet(e,t){const r=this.fetchSheetById(e),n=r.displayName;if(n===t)return;const i=this.mappingFromCanonicalName.get(Vn(t));if(i!==void 0&&i.id!==r.id)throw new Ws(t);const a=r.canonicalName;return this.mappingFromCanonicalName.delete(a),r.displayName=t,this.store(r),n}sheetNames(){return Array.from(this.mappingFromId.values()).map(e=>e.displayName)}store(e){this.mappingFromId.set(e.id,e),this.mappingFromCanonicalName.set(e.canonicalName,e)}fetchSheetById(e){const t=this.mappingFromId.get(e);if(t===void 0)throw new Le(e);return t}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class yu{constructor(e,t,r,n,i,a,o,u){this.addressMapping=e,this.rangeMapping=t,this.sheetMapping=r,this.arrayMapping=n,this.stats=i,this.lazilyTransformingAstService=a,this.functionRegistry=o,this.namedExpressions=u,this.changes=tn.empty(),this.dependencyQueryAddresses=l=>{if(l instanceof pt)return this.rangeDependencyQuery(l).map(([c,d])=>c);{const c=this.formulaDependencyQuery(l);if(c!==void 0){const[d,f]=c;return f.map(p=>p instanceof Pr?this.namedExpressions.namedExpressionOrPlaceholder(p.name,d.sheet).address:De(p)?p:Ao(p.start,p.end))}else return[]}},this.dependencyQueryVertices=l=>{if(l instanceof pt)return this.rangeDependencyQuery(l);{const c=this.formulaDependencyQuery(l);if(c!==void 0){const[d,f]=c;return f.map(p=>{if(p instanceof W)return[p.start,this.rangeMapping.fetchRange(p.start,p.end)];if(p instanceof Pr){const E=this.namedExpressions.namedExpressionOrPlaceholder(p.name,d.sheet);return[E.address,this.addressMapping.fetchCell(E.address)]}else return[p,this.addressMapping.fetchCell(p)]})}else return[]}},this.rangeDependencyQuery=l=>{const c=[],{smallerRangeVertex:d,restRange:f}=this.rangeMapping.findSmallerRange(l.range);let p;d!==void 0&&this.graph.adjacentNodes(d).has(l)?(p=f,c.push([new W(d.start,d.end),d])):p=l.range;for(const E of p.addresses(this)){const m=this.addressMapping.getCell(E);m!==void 0&&c.push([E,m])}return c},this.formulaDependencyQuery=l=>{let c,d;if(l instanceof Bt)d=l.getAddress(this.lazilyTransformingAstService),c=l.getFormula(this.lazilyTransformingAstService);else return;const f=xa(c,this.functionRegistry);return[d,vr(f,d)]},this.graph=new sN(this.dependencyQueryVertices)}static buildEmpty(e,t,r,n,i){return new yu(new Jy(t.chooseAddressMappingPolicy),new iN,new hN(t.translationPackage),new eN,i,e,r,n)}setFormulaToCell(e,t,r,n,i,a){const o=Bt.fromAst(t,e,n,this.lazilyTransformingAstService.version());return this.exchangeOrAddFormulaVertex(o),this.processCellDependencies(r,o),this.graph.markNodeAsDirty(o),i&&this.markAsVolatile(o),a&&this.markAsDependentOnStructureChange(o),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setParsingErrorToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);return this.exchangeOrAddGraphNode(r,t),this.addressMapping.setCell(e,t),this.graph.markNodeAsDirty(t),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setValueToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);if(r instanceof ze&&this.arrayMapping.removeArray(r.getRange()),r instanceof rn)r.getValues().rawValue!==t.rawValue&&(r.setValues(t),this.graph.markNodeAsDirty(r));else{const n=new rn(t.parsedValue,t.rawValue);this.exchangeOrAddGraphNode(r,n),this.addressMapping.setCell(e,n),this.graph.markNodeAsDirty(n)}return this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setCellEmpty(e){const t=this.shrinkPossibleArrayAndGetCell(e);if(t===void 0)return tn.empty();if(this.graph.adjacentNodes(t).size>0){const r=new Zr;this.exchangeGraphNode(t,r),this.graph.adjacentNodesCount(r)===0?(this.removeVertex(r),this.addressMapping.removeCell(e)):(this.graph.markNodeAsDirty(r),this.addressMapping.setCell(e,r))}else this.removeVertex(t),this.addressMapping.removeCell(e);return this.getAndClearContentChanges()}clearDirtyVertices(){this.graph.clearDirtyNodes()}verticesToRecompute(){return this.graph.getDirtyAndVolatileNodes()}processCellDependencies(e,t){const r=this.graph.getNodeId(t);e.forEach(n=>{if(n instanceof W){const i=n;let a=this.getRange(i.start,i.end);a===void 0&&(a=new pt(i),this.rangeMapping.setRange(a)),this.graph.addNodeAndReturnId(a);const o=this.graph.getNodeId(a);i.isFinite()||this.graph.markNodeAsInfiniteRange(o);const{smallerRangeVertex:u,restRange:l}=this.rangeMapping.findSmallerRange(i);if(u!==void 0){if(this.graph.addEdge(u,o),a.bruteForce){a.bruteForce=!1;for(const d of i.addresses(this))this.graph.removeEdge(this.fetchCell(d),o)}}else a.bruteForce=!0;const c=this.arrayMapping.getArray(l);if(c!==void 0)this.graph.addEdge(c,o);else for(const d of l.addresses(this)){const{vertex:f,id:p}=this.fetchCellOrCreateEmpty(d);this.graph.addEdge(p??f,o)}this.graph.addEdge(o,r),i.isFinite()&&this.correctInfiniteRangesDependenciesByRangeVertex(a)}else if(n instanceof Pr){const i=t.getAddress(this.lazilyTransformingAstService).sheet,{vertex:a,id:o}=this.fetchNamedExpressionVertex(n.name,i);this.graph.addEdge(o??a,r)}else{const{vertex:i,id:a}=this.fetchCellOrCreateEmpty(n);this.graph.addEdge(a??i,r)}})}fetchNamedExpressionVertex(e,t){const r=this.namedExpressions.namedExpressionOrPlaceholder(e,t);return this.fetchCellOrCreateEmpty(r.address)}exchangeNode(e,t){const r=this.fetchCellOrCreateEmpty(e).vertex,n=this.fetchCellOrCreateEmpty(t).vertex;this.addressMapping.removeCell(e),this.exchangeGraphNode(r,n)}fetchCellOrCreateEmpty(e){const t=this.addressMapping.getCell(e);if(t!==void 0)return{vertex:t,id:void 0};const r=new Zr,n=this.graph.addNodeAndReturnId(r);return this.addressMapping.setCell(e,r),{vertex:r,id:n}}removeRows(e){this.stats.measure(K.ADJUSTING_GRAPH,()=>{for(const[r,n]of this.addressMapping.entriesFromRowsSpan(e)){for(const i of this.graph.adjacentNodes(n))this.graph.markNodeAsDirty(i);if(n instanceof ze)if(n.isLeftCorner(r))this.shrinkArrayToCorner(n),this.arrayMapping.removeArray(n.getRange());else continue;this.removeVertex(n)}}),this.stats.measure(K.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeRows(e)});const t=this.stats.measure(K.ADJUSTING_RANGES,()=>{const r=this.truncateRanges(e,n=>n.row);return this.getArrayVerticesRelatedToRanges(r)});return this.stats.measure(K.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterRemovingRows(e.sheet,e.rowStart,e.numberOfRows)}),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}removeSheet(e){this.clearSheet(e);for(const[t,r]of this.addressMapping.sheetEntries(e)){for(const n of this.graph.adjacentNodes(r))this.graph.markNodeAsDirty(n);this.removeVertex(r),this.addressMapping.removeCell(t)}this.stats.measure(K.ADJUSTING_RANGES,()=>{const t=this.rangeMapping.removeRangesInSheet(e);for(const r of t)this.removeVertex(r);this.stats.measure(K.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeSheet(e)})})}clearSheet(e){const t=new Set;for(const[r,n]of this.addressMapping.sheetEntries(e))n instanceof ze?t.add(n):this.setCellEmpty(r);for(const r of t.values())this.setArrayEmpty(r);this.addStructuralNodesToChangeSet()}removeColumns(e){this.stats.measure(K.ADJUSTING_GRAPH,()=>{for(const[r,n]of this.addressMapping.entriesFromColumnsSpan(e)){for(const i of this.graph.adjacentNodes(n))this.graph.markNodeAsDirty(i);if(n instanceof ze)if(n.isLeftCorner(r))this.shrinkArrayToCorner(n),this.arrayMapping.removeArray(n.getRange());else continue;this.removeVertex(n)}}),this.stats.measure(K.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeColumns(e)});const t=this.stats.measure(K.ADJUSTING_RANGES,()=>{const r=this.truncateRanges(e,n=>n.col);return this.getArrayVerticesRelatedToRanges(r)});return this.stats.measure(K.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterRemovingColumns(e.sheet,e.columnStart,e.numberOfColumns)),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}addRows(e){this.stats.measure(K.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addRows(e.sheet,e.rowStart,e.numberOfRows)});const t=this.stats.measure(K.ADJUSTING_RANGES,()=>{const r=this.rangeMapping.moveAllRangesInSheetAfterRowByRows(e.sheet,e.rowStart,e.numberOfRows);return this.fixRangesWhenAddingRows(e.sheet,e.rowStart,e.numberOfRows),this.getArrayVerticesRelatedToRanges(r.verticesWithChangedSize)});this.stats.measure(K.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterAddingRow(e.sheet,e.rowStart,e.numberOfRows)});for(const r of this.addressMapping.verticesFromRowsSpan(e))this.graph.markNodeAsDirty(r);return this.addStructuralNodesToChangeSet(),{affectedArrays:t}}addColumns(e){this.stats.measure(K.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addColumns(e.sheet,e.columnStart,e.numberOfColumns)});const t=this.stats.measure(K.ADJUSTING_RANGES,()=>{const r=this.rangeMapping.moveAllRangesInSheetAfterColumnByColumns(e.sheet,e.columnStart,e.numberOfColumns);return this.fixRangesWhenAddingColumns(e.sheet,e.columnStart,e.numberOfColumns),this.getArrayVerticesRelatedToRanges(r.verticesWithChangedSize)});this.stats.measure(K.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterAddingColumn(e.sheet,e.columnStart,e.numberOfColumns));for(const r of this.addressMapping.verticesFromColumnsSpan(e))this.graph.markNodeAsDirty(r);return this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}isThereSpaceForArray(e){const t=e.getRangeOrUndef();if(t===void 0)return!1;for(const r of t.addresses(this)){const n=this.addressMapping.getCell(r);if(n!==void 0&&!(n instanceof Zr)&&n!==e)return!1}return!0}moveCells(e,t,r,n){for(const i of e.addressesWithDirection(t,r,this)){const a=U(n,i.col+t,i.row+r);let o=this.addressMapping.getCell(i);const u=this.addressMapping.getCell(a);if(this.addressMapping.removeCell(i),o!==void 0){this.graph.markNodeAsDirty(o),this.addressMapping.setCell(a,o);let l;for(const c of this.graph.adjacentNodes(o))c instanceof pt&&!e.containsRange(c.range)&&(l=l??this.fetchCellOrCreateEmpty(i).vertex,this.graph.addEdge(l,c),this.graph.removeEdge(o,c));l&&(this.graph.markNodeAsDirty(l),this.addressMapping.setCell(i,l))}if(u!==void 0){o===void 0&&this.addressMapping.removeCell(a);for(const l of this.graph.adjacentNodes(u))o=o??this.fetchCellOrCreateEmpty(a).vertex,this.graph.addEdge(o,l),this.graph.markNodeAsDirty(o);this.removeVertex(u)}}for(const i of this.rangeMapping.rangeVerticesContainedInRange(e))for(const a of this.graph.adjacentNodes(i))if(a instanceof pt&&!e.containsRange(a.range)){this.graph.removeEdge(i,a);for(const o of i.range.addresses(this)){const{vertex:u,id:l}=this.fetchCellOrCreateEmpty(o);this.graph.addEdge(l??u,a),this.addressMapping.setCell(o,u),this.graph.markNodeAsDirty(u)}}this.rangeMapping.moveRangesInsideSourceRange(e,t,r,n)}setArrayEmpty(e){const t=W.spanFrom(e.getAddress(this.lazilyTransformingAstService),e.width,e.height),r=this.graph.adjacentNodes(e);for(const n of t.addresses(this))this.addressMapping.removeCell(n);for(const n of r.values()){const i=tN(this.functionRegistry,n,e.getRange(),this.lazilyTransformingAstService,this);for(const a of i){const{vertex:o,id:u}=this.fetchCellOrCreateEmpty(a);this.graph.addEdge(u??o,n)}i.length>0&&this.graph.markNodeAsDirty(n)}this.removeVertex(e),this.arrayMapping.removeArray(e.getRange())}addVertex(e,t){this.graph.addNodeAndReturnId(t),this.addressMapping.setCell(e,t)}addArrayVertex(e,t){this.graph.addNodeAndReturnId(t),this.setAddressMappingForArrayVertex(t,e)}*arrayFormulaNodes(){for(const e of this.graph.getNodes())e instanceof ze&&(yield e)}*entriesFromRowsSpan(e){yield*this.addressMapping.entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.addressMapping.entriesFromColumnsSpan(e)}fetchCell(e){return this.addressMapping.fetchCell(e)}getCell(e){return this.addressMapping.getCell(e)}getCellValue(e){return this.addressMapping.getCellValue(e)}getRawValue(e){return this.addressMapping.getRawValue(e)}getScalarValue(e){const t=this.addressMapping.getCellValue(e);return t instanceof D?new g(R.VALUE,T.ScalarExpected):t}existsEdge(e,t){return this.graph.existsEdge(e,t)}getSheetId(e){return this.sheetMapping.fetch(e)}getSheetHeight(e){return this.addressMapping.getHeight(e)}getSheetWidth(e){return this.addressMapping.getWidth(e)}getArray(e){return this.arrayMapping.getArray(e)}getRange(e,t){return this.rangeMapping.getRange(e,t)}topSortWithScc(){return this.graph.topSortWithScc()}markAsVolatile(e){this.graph.markNodeAsVolatile(e)}markAsDependentOnStructureChange(e){this.graph.markNodeAsChangingWithStructure(e)}forceApplyPostponedTransformations(){for(const e of this.graph.getNodes())e instanceof Sr&&e.ensureRecentData(this.lazilyTransformingAstService)}*rawValuesFromRange(e){for(const t of e.addresses(this)){const r=this.getScalarValue(t);r!==te&&(yield[F(r),t])}}computeListOfValuesInRange(e){const t=[];for(const r of e.addresses(this)){const n=this.getScalarValue(r);t.push(n)}return t}shrinkArrayToCorner(e){this.cleanAddressMappingUnderArray(e);for(const t of this.adjacentArrayVertices(e)){let r;t instanceof Bt?r=this.formulaDirectDependenciesToArray(t,e):r=this.rangeDirectDependenciesToArray(t,e);let n=!1;for(const[i,a]of r)e.isLeftCorner(i)&&(n=!0),this.graph.addEdge(a,t),this.graph.markNodeAsDirty(a);n||this.graph.removeEdge(e,t)}this.graph.markNodeAsDirty(e)}isArrayInternalCell(e){const t=this.getCell(e);return t instanceof ze&&!t.isLeftCorner(e)}getAndClearContentChanges(){const e=this.changes;return this.changes=tn.empty(),e}getAdjacentNodesAddresses(e){const t=this.graph.adjacentNodes(e),r=[];return t.forEach(n=>{const i=n;i instanceof pt?r.push(Ao(i.start,i.end)):r.push(i.getAddress(this.lazilyTransformingAstService))}),r}exchangeGraphNode(e,t){this.graph.addNodeAndReturnId(t);const r=this.graph.adjacentNodes(e);this.removeVertex(e),r.forEach(n=>{this.graph.hasNode(n)&&this.graph.addEdge(t,n)})}setArray(e,t){this.arrayMapping.setArray(e,t)}correctInfiniteRangesDependency(e){const t=this.graph.getInfiniteRanges().filter(({node:a})=>a.range.addressInRange(e));if(t.length<=0)return;const{vertex:r,id:n}=this.fetchCellOrCreateEmpty(e),i=n??this.graph.getNodeId(r);t.forEach(({id:a})=>{this.graph.addEdge(i,a)})}exchangeOrAddGraphNode(e,t){e?this.exchangeGraphNode(e,t):this.graph.addNodeAndReturnId(t)}getArrayVerticesRelatedToRanges(e){const t=new Set;return e.forEach(r=>{this.graph.hasNode(r)&&this.graph.adjacentNodes(r).forEach(n=>{n instanceof ze&&t.add(n)})}),t}correctInfiniteRangesDependenciesByRangeVertex(e){this.graph.getInfiniteRanges().forEach(({id:t,node:r})=>{const n=e.range.intersectionWith(r.range);n!==void 0&&n.addresses(this).forEach(i=>{const{vertex:a,id:o}=this.fetchCellOrCreateEmpty(i);this.graph.addEdge(o??a,t)})})}cleanAddressMappingUnderArray(e){const t=e.getRange();for(const r of t.addresses(this)){const n=e.getArrayCellValue(r);this.getCell(r)===e?e.isLeftCorner(r)?this.changes.addChange(new g(R.REF),r,n):(this.addressMapping.removeCell(r),this.changes.addChange(te,r,n)):this.changes.addChange(te,r,n)}}*formulaDirectDependenciesToArray(e,t){var r;const[,n]=(r=this.formulaDependencyQuery(e))!==null&&r!==void 0?r:[];if(n!==void 0){for(const i of n)if(!(i instanceof Pr||i instanceof W)&&t.getRange().addressInRange(i)){const a=this.fetchCellOrCreateEmpty(i).vertex;yield[i,a]}}}*rangeDirectDependenciesToArray(e,t){const{restRange:r}=this.rangeMapping.findSmallerRange(e.range);for(const n of r.addresses(this))if(t.getRange().addressInRange(n)){const i=this.fetchCellOrCreateEmpty(n).vertex;yield[n,i]}}*adjacentArrayVertices(e){const t=this.graph.adjacentNodes(e);for(const r of t)(r instanceof Bt||r instanceof pt)&&(yield r)}addStructuralNodesToChangeSet(){this.graph.markChangingWithStructureNodesAsDirty()}fixRangesWhenAddingRows(e,t,r){const n=Array.from(this.rangeMapping.rangesInSheet(e));for(const i of n)if(i.range.includesRow(t+r))if(i.bruteForce){const a=i.range.rangeWithSameWidth(t,r);for(const o of a.addresses(this)){const{vertex:u,id:l}=this.fetchCellOrCreateEmpty(o);this.graph.addEdge(l??u,i)}}else{let a=i,o=this.rangeMapping.findSmallerRange(a.range);if(o.smallerRangeVertex!==void 0)continue;for(;o.smallerRangeVertex===void 0;){const u=new pt(W.spanFrom(a.range.start,a.range.width(),a.range.height()-1));this.rangeMapping.setRange(u),this.graph.addNodeAndReturnId(u);const l=new W(U(a.range.start.sheet,a.range.start.col,a.range.end.row),a.range.end);this.addAllFromRange(l,a),this.graph.addEdge(u,a),a=u,o=this.rangeMapping.findSmallerRange(a.range)}this.graph.addEdge(o.smallerRangeVertex,a),this.addAllFromRange(o.restRange,a),this.graph.removeEdge(o.smallerRangeVertex,i)}}addAllFromRange(e,t){for(const r of e.addresses(this)){const{vertex:n,id:i}=this.fetchCellOrCreateEmpty(r);this.graph.addEdge(i??n,t)}}fixRangesWhenAddingColumns(e,t,r){for(const n of this.rangeMapping.rangesInSheet(e))if(n.range.includesColumn(t+r)){let i;n.bruteForce?i=n.range.rangeWithSameHeight(t,r):i=W.spanFrom(U(e,t,n.range.end.row),r,1);for(const a of i.addresses(this)){const{vertex:o,id:u}=this.fetchCellOrCreateEmpty(a);this.graph.addEdge(u??o,n)}}}exchangeOrAddFormulaVertex(e){const t=e.getAddress(this.lazilyTransformingAstService),r=W.spanFrom(t,e.width,e.height),n=this.shrinkPossibleArrayAndGetCell(t);if(e instanceof ze&&this.setArray(r,e),this.exchangeOrAddGraphNode(n,e),this.addressMapping.setCell(t,e),e instanceof ze){if(!this.isThereSpaceForArray(e))return;for(const i of r.addresses(this)){if(e.isLeftCorner(i))continue;const a=this.getCell(i);this.exchangeOrAddGraphNode(a,e)}}for(const i of r.addresses(this))this.addressMapping.setCell(i,e)}setAddressMappingForArrayVertex(e,t){if(this.addressMapping.setCell(t,e),!(e instanceof ze))return;const r=W.spanFromOrUndef(t,e.width,e.height);if(r!==void 0&&(this.setArray(r,e),!!this.isThereSpaceForArray(e)))for(const n of r.addresses(this))this.addressMapping.setCell(n,e)}truncateRanges(e,t){const{verticesToRemove:r,verticesToMerge:n,verticesWithChangedSize:i}=this.rangeMapping.truncateRanges(e,t);for(const[a,o]of n)this.mergeRangeVertices(a,o);for(const a of r)this.removeVertexAndCleanupDependencies(a);return i}fixArraysAfterAddingRow(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInRows(wt.fromRowStartAndEnd(e,t-1,t-1))){const i=n.getRange();for(let a=i.start.col;a<=i.end.col;++a)for(let o=t;o<=i.end.row;++o){const u=U(e,a,o),l=U(e,a,o+r),c=n.getArrayCellValue(u);this.addressMapping.moveCell(l,u),this.changes.addChange(te,l,c)}}}fixArraysAfterRemovingRows(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,-r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInRows(wt.fromRowStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(n))for(const i of n.getRange().addresses(this))this.addressMapping.setCell(i,n);else this.setNoSpaceIfArray(n)}fixArraysAfterAddingColumn(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInCols(Vt.fromColumnStartAndEnd(e,t-1,t-1))){const i=n.getRange();for(let a=i.start.row;a<=i.end.row;++a)for(let o=t;o<=i.end.col;++o){const u=U(e,o,a),l=U(e,o+r,a),c=n.getArrayCellValue(u);this.addressMapping.moveCell(l,u),this.changes.addChange(te,l,c)}}}fixArraysAfterRemovingColumns(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,-r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInCols(Vt.fromColumnStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(n))for(const i of n.getRange().addresses(this))this.addressMapping.setCell(i,n);else this.setNoSpaceIfArray(n)}shrinkPossibleArrayAndGetCell(e){const t=this.getCell(e);return t instanceof ze?(this.setNoSpaceIfArray(t),this.getCell(e)):t}setNoSpaceIfArray(e){e instanceof ze&&(this.shrinkArrayToCorner(e),e.setNoSpace())}removeVertex(e){this.removeVertexAndCleanupDependencies(e),e instanceof pt&&this.rangeMapping.removeRange(e)}mergeRangeVertices(e,t){const r=this.graph.adjacentNodes(t);this.removeVertexAndCleanupDependencies(t),this.graph.removeEdgeIfExists(e,t),r.forEach(n=>{this.graph.hasNode(n)&&this.graph.addEdge(e,n)})}removeVertexAndCleanupDependencies(e){const t=new Set(this.graph.removeNode(e));for(;t.size>0;){const r=t.values().next().value;t.delete(r);const[n,i]=r;this.graph.hasNode(i)&&this.graph.adjacentNodesCount(i)===0&&((i instanceof pt||i instanceof Zr)&&this.graph.removeNode(i).forEach(a=>t.add(a)),i instanceof pt?this.rangeMapping.removeRange(i):i instanceof Zr&&this.addressMapping.removeCell(n))}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Zr{constructor(){}getCellValue(){return te}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class rn{constructor(e,t){this.parsedValue=e,this.rawValue=t}getValues(){return{parsedValue:this.parsedValue,rawValue:this.rawValue}}setValues(e){this.parsedValue=e.parsedValue,this.rawValue=e.rawValue}getCellValue(){return this.parsedValue}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class $n{constructor(e,t){this.errors=e,this.rawInput=t}getCellValue(){const e=this.errors.map(t=>t.message).find(t=>t);return g.parsingError(e)}getFormula(){return this.rawInput}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class dN{constructor(e,t){this.width=e,this.height=t,this.mapping=new Map}getCell(e){var t;return(t=this.mapping.get(e.col))===null||t===void 0?void 0:t.get(e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1);let r=this.mapping.get(e.col);r||(r=new Map,this.mapping.set(e.col,r)),r.set(e.row,t)}has(e){var t;return!!(!((t=this.mapping.get(e.col))===null||t===void 0)&&t.get(e.row))}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){var t;(t=this.mapping.get(e.col))===null||t===void 0||t.delete(e.row)}addRows(e,t){this.mapping.forEach(r=>{const n=new Map;r.forEach((i,a)=>{a>=e&&(n.set(a+t,i),r.delete(a))}),n.forEach((i,a)=>{r.set(a,i)})}),this.height+=t}addColumns(e,t){const r=new Map;this.mapping.forEach((n,i)=>{i>=e&&(r.set(i+t,n),this.mapping.delete(i))}),r.forEach((n,i)=>{this.mapping.set(i,n)}),this.width+=t}removeRows(e){this.mapping.forEach(n=>{const i=new Map;n.forEach((a,o)=>{o>=e.rowStart&&(n.delete(o),o>e.rowEnd&&i.set(o-e.numberOfRows,a))}),i.forEach((a,o)=>{n.set(o,a)})});const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){const t=new Map;this.mapping.forEach((i,a)=>{a>=e.columnStart&&(this.mapping.delete(a),a>e.columnEnd&&t.set(a-e.numberOfColumns,i))}),t.forEach((i,a)=>{this.mapping.set(a,i)});const r=Math.min(this.width-1,e.columnEnd),n=Math.max(0,r-e.columnStart+1);this.width=Math.max(0,this.width-n)}*getEntries(e){for(const[t,r]of this.mapping)for(const[n,i]of r)yield[U(e,t,n),i]}*verticesFromColumn(e){const t=this.mapping.get(e);if(t!==void 0)for(const[r,n]of t)yield n}*verticesFromRow(e){for(const t of this.mapping.values()){const r=t.get(e);r!==void 0&&(yield r)}}*verticesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(r!==void 0)for(const[n,i]of r)yield i}}*verticesFromRowsSpan(e){for(const t of this.mapping.values())for(const r of e.rows()){const n=t.get(r);n!==void 0&&(yield n)}}*entriesFromRowsSpan(e){for(const[t,r]of this.mapping.entries())for(const n of e.rows()){const i=r.get(n);i!==void 0&&(yield[U(e.sheet,t,n),i])}}*entriesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(r!==void 0)for(const[n,i]of r.entries())yield[U(e.sheet,t,n),i]}}*vertices(){for(const[e,t]of this.mapping)for(const[r,n]of t)n!==void 0&&(yield n)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class fN{constructor(e,t){this.width=e,this.height=t,this.mapping=new Array(t);for(let r=0;r<t;r++)this.mapping[r]=new Array(e)}getCell(e){return this.getCellVertex(e.col,e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1),this.mapping[e.row]||(this.mapping[e.row]=new Array(this.width)),this.mapping[e.row][e.col]=t}has(e){const t=this.mapping[e.row];return t?!!t[e.col]:!1}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){this.mapping[e.row]!==void 0&&delete this.mapping[e.row][e.col]}addRows(e,t){const r=[];for(let n=0;n<t;n++)r.push(new Array(this.width));this.mapping.splice(e,0,...r),this.height+=t}addColumns(e,t){for(let r=0;r<this.height;r++)this.mapping[r]!==void 0&&this.mapping[r].splice(e,0,...new Array(t));this.width+=t}removeRows(e){this.mapping.splice(e.rowStart,e.numberOfRows);const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){for(let n=0;n<this.height;n++)this.mapping[n]!==void 0&&this.mapping[n].splice(e.columnStart,e.numberOfColumns);const t=Math.min(this.width-1,e.columnEnd),r=Math.max(0,t-e.columnStart+1);this.width=Math.max(0,this.width-r)}*getEntries(e){for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r){const n=this.getCellVertex(r,t);n&&(yield[U(e,r,t),n])}}*verticesFromColumn(e){for(let t=0;t<this.height;++t){const r=this.getCellVertex(e,t);r&&(yield r)}}*verticesFromRow(e){for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}*verticesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const n=this.getCellVertex(t,r);n&&(yield n)}}*verticesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const n=this.getCellVertex(t,r);n&&(yield n)}}*entriesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const n=this.getCellVertex(t,r);n&&(yield[U(e.sheet,t,r),n])}}*entriesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const n=this.getCellVertex(t,r);n&&(yield[U(e.sheet,t,r),n])}}*vertices(){for(let e=0;e<this.height;++e)for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}getCellVertex(e,t){var r;return(r=this.mapping[t])===null||r===void 0?void 0:r[e]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var R;(function(s){s.DIV_BY_ZERO="DIV_BY_ZERO",s.NAME="NAME",s.VALUE="VALUE",s.NUM="NUM",s.NA="NA",s.CYCLE="CYCLE",s.REF="REF",s.SPILL="SPILL",s.LIC="LIC",s.ERROR="ERROR"})(R||(R={}));var vt;(function(s){s.FORMULA="FORMULA",s.VALUE="VALUE",s.ARRAY="ARRAY",s.EMPTY="EMPTY",s.ARRAYFORMULA="ARRAYFORMULA"})(vt||(vt={}));const pN=(s,e)=>s instanceof ze?s.isLeftCorner(e)?vt.ARRAYFORMULA:vt.ARRAY:s instanceof Sr||s instanceof $n?vt.FORMULA:s instanceof rn?vt.VALUE:vt.EMPTY;var sa;(function(s){s.EMPTY="EMPTY",s.NUMBER="NUMBER",s.STRING="STRING",s.BOOLEAN="BOOLEAN",s.ERROR="ERROR"})(sa||(sa={}));var So;(function(s){s.NUMBER="NUMBER"})(So||(So={}));const lr=Object.assign(Object.assign({},sa),So),mN=Object.assign(Object.assign({},sa),k),Ml=s=>{switch(s){case lr.EMPTY:return 0;case lr.NUMBER:return 1;case lr.STRING:return 2;case lr.BOOLEAN:return 3;case lr.ERROR:return 4}throw new Error("Cell value not computed")},ia=s=>{if(s===te)return lr.EMPTY;if(s instanceof g||s instanceof D)return lr.ERROR;if(typeof s=="string")return lr.STRING;if(de(s))return lr.NUMBER;if(typeof s=="boolean")return lr.BOOLEAN;throw new Error("Cell value not computed")},gN=s=>de(s)?$y(s):ia(s),EN=s=>{if(de(s))return Xy(s)};class g{constructor(e,t,r){this.type=e,this.message=t,this.root=r}static parsingError(e){return new g(R.ERROR,`${T.ParseError}${e?" "+e:""}`)}attachRootVertex(e){return this.root===void 0?new g(this.type,this.message,e):this}}const Ad=(s,e)=>({sheet:s,row:e}),RN=s=>s.row<0,Cd=(s,e)=>({sheet:s,col:e}),yN=s=>s.col<0,U=(s,e,t)=>({sheet:s,col:e,row:t}),Ct=s=>s.col<0||s.row<0,NN=(s,e,t,r)=>U(e,s.col+t,s.row+r),_s=s=>`${s.sheet},${s.row},${s.col}`;function De(s){var e,t,r;return s&&(typeof s=="object"||typeof s=="function")&&typeof((e=s)===null||e===void 0?void 0:e.sheet)=="number"&&typeof((t=s)===null||t===void 0?void 0:t.col)=="number"&&typeof((r=s)===null||r===void 0?void 0:r.row)=="number"}const hr=(s,e)=>{var t;return(t=s.sheet)!==null&&t!==void 0?t:e.sheet},$s=(s,e)=>s.sheet===e.sheet&&s.col===e.col&&s.row===e.row;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const TN="AbsoluteCellRange: Wrong range size";function Pt(s){if(s&&(typeof s=="object"||typeof s=="function")){const e=s;return"start"in e&&De(e.start)&&"end"in e&&De(e.end)}else return!1}const Ao=(s,e)=>({start:s,end:e});class W{constructor(e,t){if(e.sheet!==t.sheet)throw new zs(e.sheet,t.sheet);this.start=U(e.sheet,e.col,e.row),this.end=U(t.sheet,t.col,t.row)}get sheet(){return this.start.sheet}static fromSimpleCellAddresses(e,t){if(e.sheet!==t.sheet)throw new zs(e.sheet,t.sheet);const r=t.col-e.col,n=t.row-e.row;return Number.isFinite(n)&&Number.isFinite(r)?new W(e,t):Number.isFinite(n)?new Vr(e.sheet,e.row,t.row):new Dr(e.sheet,e.col,t.col)}static fromAst(e,t){return e.type===y.CELL_RANGE?W.fromCellRange(e,t):e.type===y.COLUMN_RANGE?Dr.fromColumnRange(e,t):Vr.fromRowRangeAst(e,t)}static fromAstOrUndef(e,t){try{return W.fromAst(e,t)}catch{return}}static fromCellRange(e,t){return new W(e.start.toSimpleCellAddress(t),e.end.toSimpleCellAddress(t))}static spanFrom(e,t,r){const n=W.spanFromOrUndef(e,t,r);if(n===void 0)throw new Error(TN);return n}static spanFromOrUndef(e,t,r){if(!Number.isFinite(t)&&Number.isFinite(r))return e.col!==0?void 0:new Vr(e.sheet,e.row,e.row+r-1);if(!Number.isFinite(r)&&Number.isFinite(t))return e.row!==0?void 0:new Dr(e.sheet,e.col,e.col+t-1);if(Number.isFinite(r)&&Number.isFinite(t))return new W(e,U(e.sheet,e.col+t-1,e.row+r-1))}static fromCoordinates(e,t,r,n,i){return new W(U(e,t,r),U(e,n,i))}isFinite(){return Number.isFinite(this.size())}doesOverlap(e){return!(this.start.sheet!=e.start.sheet||this.end.row<e.start.row||this.start.row>e.end.row||this.end.col<e.start.col||this.start.col>e.end.col)}addressInRange(e){return this.sheet!==e.sheet?!1:this.start.row<=e.row&&this.end.row>=e.row&&this.start.col<=e.col&&this.end.col>=e.col}columnInRange(e){return this.sheet!==e.sheet?!1:this.start.col<=e.col&&this.end.col>=e.col}rowInRange(e){return this.sheet!==e.sheet?!1:this.start.row<=e.row&&this.end.row>=e.row}containsRange(e){return this.addressInRange(e.start)&&this.addressInRange(e.end)}intersectionWith(e){if(this.sheet!==e.start.sheet)return;const t=Math.max(this.start.row,e.start.row),r=Math.min(this.end.row,e.end.row),n=Math.max(this.start.col,e.start.col),i=Math.min(this.end.col,e.end.col);if(!(t>r||n>i))return new W(U(this.sheet,n,t),U(this.sheet,i,r))}includesRow(e){return this.start.row<e&&this.end.row>=e}includesColumn(e){return this.start.col<e&&this.end.col>=e}shiftByRows(e){this.start.row+=e,this.end.row+=e}expandByRows(e){this.end.row+=e}shiftByColumns(e){this.start.col+=e,this.end.col+=e}shifted(e,t){return W.spanFrom(U(this.sheet,this.start.col+e,this.start.row+t),this.width(),this.height())}expandByColumns(e){this.end.col+=e}moveToSheet(e){this.start.sheet=e,this.end.sheet=e}removeSpan(e){e instanceof wt?this.removeRows(e.start,e.end):this.removeColumns(e.start,e.end)}shouldBeRemoved(){return this.width()<=0||this.height()<=0}rangeWithSameWidth(e,t){return W.spanFrom(U(this.sheet,this.start.col,e),this.width(),t)}rangeWithSameHeight(e,t){return W.spanFrom(U(this.sheet,e,this.start.row),t,this.height())}toString(){return`${this.start.sheet},${this.start.col},${this.start.row},${this.end.col},${this.end.row}`}width(){return this.end.col-this.start.col+1}height(){return this.end.row-this.start.row+1}size(){return this.height()*this.width()}arrayOfAddressesInRange(){const e=[];for(let t=0;t<this.height();++t){e[t]=[];for(let r=0;r<this.width();++r){const n=U(this.sheet,this.start.col+r,this.start.row+t);e[t].push(n)}}return e}withStart(e){return new W(e,this.end)}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}sameAs(e){return $s(this.start,e.start)&&$s(this.end,e.end)}addressesArrayMap(e,t){const r=[];let n=this.start.row;for(;n<=this.effectiveEndRow(e);){let i=this.start.col;const a=[];for(;i<=this.effectiveEndColumn(e);)a.push(t(U(this.start.sheet,i,n))),i++;r.push(a),n++}return r}addresses(e){const t=[];let r=this.start.row;const n=this.effectiveEndRow(e),i=this.effectiveEndColumn(e);for(;r<=n;){let a=this.start.col;for(;a<=i;)t.push(U(this.start.sheet,a,r)),a++;r++}return t}*addressesWithDirection(e,t,r){if(e>0)if(t>0){let n=this.effectiveEndRow(r);for(;n>=this.start.row;){let i=this.effectiveEndColumn(r);for(;i>=this.start.col;)yield U(this.start.sheet,i,n),i-=1;n-=1}}else{let n=this.start.row;for(;n<=this.effectiveEndRow(r);){let i=this.effectiveEndColumn(r);for(;i>=this.start.col;)yield U(this.start.sheet,i,n),i-=1;n+=1}}else if(t>0){let n=this.effectiveEndRow(r);for(;n>=this.start.row;){let i=this.start.col;for(;i<=this.effectiveEndColumn(r);)yield U(this.start.sheet,i,n),i+=1;n-=1}}else{let n=this.start.row;for(;n<=this.effectiveEndRow(r);){let i=this.start.col;for(;i<=this.effectiveEndColumn(r);)yield U(this.start.sheet,i,n),i+=1;n+=1}}}getAddress(e,t){if(e<0||t<0||t>this.height()-1||e>this.width()-1)throw Error("Index out of bound");return U(this.start.sheet,this.start.col+e,this.start.row+t)}exceedsSheetSizeLimits(e,t){return this.end.col>=e||this.end.row>=t}effectiveEndColumn(e){return this.end.col}effectiveEndRow(e){return this.end.row}effectiveWidth(e){return this.width()}effectiveHeight(e){return this.height()}removeRows(e,t){if(!(e>this.end.row)){if(t<this.start.row){const r=t-e+1;return this.shiftByRows(-r)}e<=this.start.row&&(this.start.row=e),this.end.row-=Math.min(t,this.end.row)-e+1}}removeColumns(e,t){if(!(e>this.end.col)){if(t<this.start.col){const r=t-e+1;return this.shiftByColumns(-r)}e<=this.start.col&&(this.start.col=e),this.end.col-=Math.min(t,this.end.col)-e+1}}}class Dr extends W{constructor(e,t,r){super(U(e,t,0),U(e,r,Number.POSITIVE_INFINITY))}static fromColumnRange(e,t){const r=e.start.toSimpleColumnAddress(t),n=e.end.toSimpleColumnAddress(t);if(r.sheet!==n.sheet)throw new zs(r.sheet,n.sheet);return new Dr(r.sheet,r.col,n.col)}shouldBeRemoved(){return this.width()<=0}shiftByRows(e){}expandByRows(e){}shifted(e,t){return new Dr(this.sheet,this.start.col+e,this.end.col+e)}rangeWithSameHeight(e,t){return new Dr(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.col>=e}effectiveEndRow(e){return this.effectiveHeight(e)-1}effectiveHeight(e){return e.getSheetHeight(this.sheet)}removeRows(e,t){}}class Vr extends W{constructor(e,t,r){super(U(e,0,t),U(e,Number.POSITIVE_INFINITY,r))}static fromRowRangeAst(e,t){const r=e.start.toSimpleRowAddress(t),n=e.end.toSimpleRowAddress(t);if(r.sheet!==n.sheet)throw new zs(r.sheet,n.sheet);return new Vr(r.sheet,r.row,n.row)}shouldBeRemoved(){return this.height()<=0}shiftByColumns(e){}expandByColumns(e){}shifted(e,t){return new Vr(this.sheet,this.start.row+t,this.end.row+t)}rangeWithSameWidth(e,t){return new Vr(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.row>=t}effectiveEndColumn(e){return this.effectiveWidth(e)-1}effectiveWidth(e){return e.getSheetWidth(this.sheet)}removeColumns(e,t){}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Cr{constructor(e,t,r){this.formulaAddress=e,this.arraysFlag=t,this.formulaVertex=r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function vN(s){const e=s.caseSensitive?s.accentSensitive?"variant":"case":s.accentSensitive?"accent":"base",t=s.caseFirst,r=s.ignorePunctuation;return new Intl.Collator(s.localeLang,{sensitivity:e,caseFirst:t,ignorePunctuation:r})}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const SN="i",AN=/^\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij]))\s*(([+-])\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij])))?$/;class CN{constructor(e,t,r){this.config=e,this.dateTimeHelper=t,this.numberLiteralsHelper=r,this.lt=(n,i)=>this.compare(n,i)<0,this.leq=(n,i)=>this.compare(n,i)<=0,this.gt=(n,i)=>this.compare(n,i)>0,this.geq=(n,i)=>this.compare(n,i)>=0,this.eq=(n,i)=>this.compare(n,i)===0,this.neq=(n,i)=>this.compare(n,i)!==0,this.pow=(n,i)=>Math.pow(F(n),F(i)),this.addWithEpsilonRaw=(n,i)=>{const a=n+i;return Math.abs(a)<this.actualEps*Math.abs(n)?0:a},this.addWithEpsilon=(n,i)=>{const a=xl(n,i);return this.ExtendedNumberFactory(this.addWithEpsilonRaw(F(n),F(i)),a)},this.unaryMinus=n=>pu(n,-F(n)),this.unaryPlus=n=>n,this.unaryPercent=n=>new Fi(F(n)/100),this.concat=(n,i)=>n.concat(i),this.nonstrictadd=(n,i)=>n instanceof g?n:i instanceof g?i:typeof n=="number"?typeof i=="number"?this.addWithEpsilonRaw(n,i):n:typeof i=="number"?i:0,this.subtract=(n,i)=>{const a=xl(n,i),o=F(n),u=F(i);let l=o-u;return Math.abs(l)<this.actualEps*Math.abs(o)&&(l=0),this.ExtendedNumberFactory(l,a)},this.divide=(n,i)=>{const a=F(n),o=F(i);if(o===0)return new g(R.DIV_BY_ZERO);{const u=_l(n,i);return this.ExtendedNumberFactory(a/o,u)}},this.multiply=(n,i)=>{const a=_l(n,i);return this.ExtendedNumberFactory(F(n)*F(i),a)},this.manyToExactComplex=n=>{const i=[];for(const a of n){if(a instanceof g)return a;if(de(a)||typeof a=="string"){const o=this.coerceScalarToComplex(a);o instanceof g||i.push(o)}}return i},this.coerceNumbersExactRanges=n=>this.manyToNumbers(n,this.manyToExactNumbers),this.coerceNumbersCoerceRangesDropNulls=n=>this.manyToNumbers(n,this.manyToCoercedNumbersDropNulls),this.manyToExactNumbers=n=>{const i=[];for(const a of n){if(a instanceof g)return a;de(a)&&i.push(F(a))}return i},this.manyToOnlyNumbersDropNulls=n=>{const i=[];for(const a of n){if(a instanceof g)return a;if(de(a))i.push(F(a));else if(a!==te)return new g(R.VALUE,T.NumberExpected)}return i},this.manyToCoercedNumbersDropNulls=n=>{const i=[];for(const a of n){if(a instanceof g)return a;if(a===te)continue;const o=this.coerceScalarToNumberOrError(a);de(o)&&i.push(F(o))}return i},this.collator=vN(e),this.actualEps=e.smartRounding?e.precisionEpsilon:0}eqMatcherFunction(e){const t=this.buildRegex(e);return r=>typeof r=="string"&&t.test(this.normalizeString(r))}neqMatcherFunction(e){const t=this.buildRegex(e);return r=>typeof r!="string"||!t.test(this.normalizeString(r))}searchString(e,t){var r;const i=this.buildRegex(e,!1).exec(t);return(r=i?.index)!==null&&r!==void 0?r:-1}requiresRegex(e){if(!this.config.useRegularExpressions&&!this.config.useWildcards)return!this.config.matchWholeCell;for(let t=0;t<e.length;t++){const r=e.charAt(t);if(Xs(r)||this.config.useRegularExpressions&&Ks(r))return!0}return!1}floatCmp(e,t){const r=F(e),n=F(t),i=1+this.actualEps;return n>=0&&r*i>=n&&r<=n*i||n<=0&&r*i<=n&&r>=n*i?0:r>n?1:-1}coerceScalarToNumberOrError(e){var t;return e instanceof g?e:(t=this.coerceToMaybeNumber(e))!==null&&t!==void 0?t:new g(R.VALUE,T.NumberCoercion)}coerceToMaybeNumber(e){var t;return(t=this.coerceNonDateScalarToMaybeNumber(e))!==null&&t!==void 0?t:typeof e=="string"?this.dateTimeHelper.dateStringToDateNumber(e):void 0}coerceNonDateScalarToMaybeNumber(e){if(e===te)return 0;if(typeof e=="string"){if(e==="")return 0;const t=this.coerceStringToMaybePercentNumber(e);if(t!==void 0)return t;const r=this.coerceStringToMaybeCurrencyNumber(e);return r!==void 0?r:this.numberLiteralsHelper.numericStringToMaybeNumber(e.trim())}else return de(e)?e:typeof e=="boolean"?Number(e):void 0}coerceStringToMaybePercentNumber(e){const t=e.trim();if(t.endsWith("%")){const r=t.slice(0,t.length-1).trim(),n=this.numberLiteralsHelper.numericStringToMaybeNumber(r);if(n!==void 0)return new Fi(n/100)}}coerceStringToMaybeCurrencyNumber(e){const t=this.currencyMatcher(e.trim());if(t!==void 0){const[r,n]=t,i=this.numberLiteralsHelper.numericStringToMaybeNumber(n);if(i!==void 0)return new To(i,r)}}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length).trim()];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length).trim()]}}coerceComplexExactRanges(e){const t=[];for(const n of e)if(n instanceof D)t.push(n);else if(n!==te){const i=this.coerceScalarToComplex(n);if(i instanceof g)return i;t.push(i)}const r=[];for(const n of t)if(n instanceof D){const i=this.manyToExactComplex(n.valuesFromTopLeftCorner());if(i instanceof g)return i;r.push(...i)}else r.push(n);return r}coerceScalarToComplex(e){return e instanceof g?e:e===te?[0,0]:de(e)?[F(e),0]:typeof e=="string"?this.coerceStringToComplex(e):new g(R.NUM,T.ComplexNumberExpected)}ExtendedNumberFactory(e,t){const{type:r,format:n}=t;switch(r){case k.NUMBER_RAW:return e;case k.NUMBER_CURRENCY:return new To(e,n??this.config.currencySymbol[0]);case k.NUMBER_DATE:return new mu(e,n);case k.NUMBER_DATETIME:return new Eu(e,n);case k.NUMBER_TIME:return new gu(e,n);case k.NUMBER_PERCENT:return new Fi(e,n)}}buildRegex(e,t=!0){e=this.normalizeString(e);let r,n=this.config.useWildcards,i=this.config.useRegularExpressions;if(i)try{RegExp(e)}catch{i=!1,n=!1}return i?r=ON(e,this.config.caseSensitive):n?r=IN(e,this.config.caseSensitive):r=MN(e,this.config.caseSensitive),this.config.matchWholeCell&&t?RegExp("^("+r+")$"):RegExp(r)}normalizeString(e){return this.config.caseSensitive||(e=e.toLowerCase()),this.config.accentSensitive||(e=bd(e,"nfd").replace(/[\u0300-\u036f]/g,"")),e}compare(e,t){if(typeof e=="string"||typeof t=="string"){const r=typeof e=="string"?this.dateTimeHelper.dateStringToDateNumber(e):e,n=typeof t=="string"?this.dateTimeHelper.dateStringToDateNumber(t):t;if(de(r)&&de(n))return this.floatCmp(r,n)}return e===te?e=Ol(t):t===te&&(t=Ol(e)),typeof e=="string"&&typeof t=="string"?this.stringCmp(e,t):typeof e=="boolean"&&typeof t=="boolean"?bl(Co(e),Co(t)):de(e)&&de(t)?this.floatCmp(e,t):e===te&&t===te?0:bl(Ml(ia(e)),Ml(ia(t)))}stringCmp(e,t){return this.collator.compare(e,t)}manyToNumbers(e,t){const r=[];for(const i of e)if(i instanceof D)r.push(i);else{const a=F(this.coerceScalarToNumberOrError(i));if(a instanceof g)return a;r.push(a)}const n=[];for(const i of r)if(i instanceof D){const a=t(i.valuesFromTopLeftCorner());if(a instanceof g)return a;n.push(...a)}else n.push(i);return n}coerceStringToComplex(e){const t=AN.exec(e);if(t===null)return new g(R.NUM,T.ComplexNumberExpected);let r;if(t[6]!==void 0?r=t[1]==="-"?[0,-1]:[0,1]:r=this.parseComplexToken(t[1]+t[3],t[5]),r instanceof g||t[8]===void 0)return r;let n;return t[14]!==void 0?n=t[9]==="-"?[0,-1]:[0,1]:n=this.parseComplexToken(t[9]+t[11],t[13]),n instanceof g?n:t[5]!==""||t[13]===""?new g(R.NUM,T.ComplexNumberExpected):t[8]==="+"?[r[0]+n[0],r[1]+n[1]]:[r[0]-n[0],r[1]-n[1]]}parseComplexToken(e,t){const r=F(this.coerceNonDateScalarToMaybeNumber(e));return r===void 0?new g(R.NUM,T.ComplexNumberExpected):t===""?[r,0]:[0,r]}}function Pe([s,e],t){if(!isFinite(s)||!isFinite(e))return new g(R.NUM,T.NaN);if(t=t??SN,e===0)return`${s}`;const r=`${e===-1||e===1?"":Math.abs(e)}${t}`;return s===0?`${e<0?"-":""}${r}`:`${s}${e<0?"-":"+"}${r}`}function wd(s){return s instanceof D?s:D.fromScalar(s)}function Co(s){return Number(s)}function Ol(s){return typeof s=="string"?"":de(s)?0:typeof s=="boolean"?!1:te}function Id(s){if(s instanceof g||typeof s=="boolean")return s;if(s===te)return!1;if(de(s))return F(s)!==0;{const e=s.toUpperCase();return e==="TRUE"?!0:e==="FALSE"||e===""?!1:void 0}}function wo(s){return s instanceof g||typeof s=="string"?s:s===te?"":de(s)?F(s).toString():s?"TRUE":"FALSE"}function hi(s){return s===te?0:s}function bl(s,e){const t=F(s),r=F(e);return t>r?1:t<r?-1:0}function Md(s){return isNaN(s)||s===1/0||s===-1/0}function Od(s){return s===0?0:s}function Xs(s){return["*","?"].includes(s)}const wN=["{","}","[","]","(",")","<",">","=",".","+","-",",","\\","$","^","!"];function Ks(s){return wN.includes(s)}function IN(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);if(n==="~"){if(r==s.length-1){t+="~";continue}const i=s.charAt(r+1);Xs(i)||Ks(i)?(t+="\\"+i,r++):(t+=i,r++)}else Xs(n)?t+="."+n:Ks(n)?t+="\\"+n:e?t+=n:t+=n.toLowerCase()}return t}function MN(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);Xs(n)||Ks(n)?t+="\\"+n:e?t+=n:t+=n.toLowerCase()}return t}function ON(s,e){let t="";for(let r=0;r<s.length;r++){const n=s.charAt(r);Xs(n)||Ks(n)||e?t+=n:t+=n.toLowerCase()}return t}function xl(s,e){const{type:t,format:r}=ra(s),{type:n,format:i}=ra(e);if(t===k.NUMBER_RAW)return{type:n,format:i};if(n===k.NUMBER_RAW)return{type:t,format:r};if((t===k.NUMBER_DATETIME||t===k.NUMBER_DATE)&&(n===k.NUMBER_DATETIME||n===k.NUMBER_DATE))return{type:k.NUMBER_RAW};if(t===k.NUMBER_TIME){if(n===k.NUMBER_DATE)return{type:k.NUMBER_DATETIME,format:`${i} ${r}`};if(n===k.NUMBER_DATETIME)return{type:k.NUMBER_DATETIME,format:i}}if(n===k.NUMBER_TIME){if(t===k.NUMBER_DATE)return{type:k.NUMBER_DATETIME,format:`${r} ${i}`};if(t===k.NUMBER_DATETIME)return{type:k.NUMBER_DATETIME,format:r}}return{type:t,format:r}}function _l(s,e){let{type:t,format:r}=ra(s),{type:n,format:i}=ra(e);return t===k.NUMBER_PERCENT&&(t=k.NUMBER_RAW,r=void 0),n===k.NUMBER_PERCENT&&(n=k.NUMBER_RAW,i=void 0),t===k.NUMBER_RAW?{type:n,format:i}:n===k.NUMBER_RAW?{type:t,format:r}:{type:k.NUMBER_RAW}}function Ls(s){return bd(s.toLowerCase(),"nfd").replace(/[\u0300-\u036f]/g,"")}function Di(s,e){var t;if(s.isAdHoc())return(t=s.data[0])===null||t===void 0?void 0:t[0];const r=s.range;if(e.formulaAddress.sheet===r.sheet){if(r.width()===1){const n=e.formulaAddress.row-r.start.row;if(n>=0&&n<r.height())return s.data[n][0]}else if(r.height()===1){const n=e.formulaAddress.col-r.start.col;if(n>=0&&n<r.width())return s.data[0][n]}}}function bd(s,e){return s.normalize(e.toUpperCase())}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var h;(function(s){s.STRING="STRING",s.NUMBER="NUMBER",s.BOOLEAN="BOOLEAN",s.SCALAR="SCALAR",s.NOERROR="NOERROR",s.RANGE="RANGE",s.INTEGER="INTEGER",s.COMPLEX="COMPLEX",s.ANY="ANY"})(h||(h={}));class Q{constructor(e){this.coerceScalarToNumberOrError=t=>this.arithmeticHelper.coerceScalarToNumberOrError(t),this.runFunction=(t,r,n,i)=>{const a=this.evaluateArguments(t,r,n),o=a.map(([E,m])=>E),u=a.map(([E,m])=>m),l=this.buildMetadataForEachArgumentValue(o.length,n),c=r.arraysFlag&&!n.vectorizationForbidden;if(!this.isNumberOfArgumentValuesValid(l,o.length))return new g(R.NA,T.WrongArgNumber);const[d,f]=c?this.calculateSizeOfVectorizedResultArray(o,l):[1,1];if(d===1&&f===1){const E=this.vectorizeAndBroadcastArgumentsIfNecessary(c,o,l,0,0);return this.calculateSingleCellOfResultArray(r,E,l,u,i,n.returnNumberType)}const p=[...Array(d).keys()].map(E=>[...Array(f).keys()].map(m=>{const S=this.vectorizeAndBroadcastArgumentsIfNecessary(c,o,l,E,m),v=this.calculateSingleCellOfResultArray(r,S,l,u,i,n.returnNumberType);if(v instanceof D)throw new Error("Function returning array cannot be vectorized.");return v}));return D.onlyValues(p)},this.runFunctionWithReferenceArgument=(t,r,n,i,a,o=()=>new g(R.NA,T.CellRefExpected))=>{if(t.length===0)return this.returnNumberWrapper(i(),n.returnNumberType);if(t.length>1)return new g(R.NA,T.WrongArgNumber);let u=t[0];for(;u.type===y.PARENTHESIS;)u=u.expression;let l;if(u.type===y.CELL_REFERENCE)l=u.reference.toSimpleCellAddress(r.formulaAddress);else if(u.type===y.CELL_RANGE||u.type===y.COLUMN_RANGE||u.type===y.ROW_RANGE)try{l=W.fromAst(u,r.formulaAddress).start}catch{return new g(R.REF,T.CellRefExpected)}return l!==void 0?this.returnNumberWrapper(a(l),n.returnNumberType):this.runFunction(t,r,n,o)},this.interpreter=e,this.dependencyGraph=e.dependencyGraph,this.columnSearch=e.columnSearch,this.config=e.config,this.serialization=e.serialization,this.arraySizePredictor=e.arraySizePredictor,this.dateTimeHelper=e.dateTimeHelper,this.arithmeticHelper=e.arithmeticHelper}evaluateAst(e,t){return this.interpreter.evaluateAst(e,t)}arraySizeForAst(e,t){return this.arraySizePredictor.checkArraySizeForAst(e,t)}listOfScalarValues(e,t){const r=[];for(const n of e){const i=this.evaluateAst(n,t);if(i instanceof D)for(const a of i.valuesFromTopLeftCorner())r.push([a,!0]);else r.push([i,!1])}return r}coerceToType(e,t,r){let n;if(e instanceof D)switch(t.argumentType){case h.RANGE:case h.ANY:n=e;break;default:{const i=Di(e,r);if(i===void 0)return;e=i}}if(!(e instanceof D))switch(t.argumentType){case h.INTEGER:case h.NUMBER:const i=this.coerceScalarToNumberOrError(e);if(!de(i)){n=i;break}const a=F(i);if(t.maxValue!==void 0&&a>t.maxValue)return new g(R.NUM,T.ValueLarge);if(t.minValue!==void 0&&a<t.minValue)return new g(R.NUM,T.ValueSmall);if(t.lessThan!==void 0&&a>=t.lessThan)return new g(R.NUM,T.ValueLarge);if(t.greaterThan!==void 0&&a<=t.greaterThan)return new g(R.NUM,T.ValueSmall);if(t.argumentType===h.INTEGER&&!Number.isInteger(a))return new g(R.NUM,T.IntegerExpected);n=i;break;case h.STRING:n=wo(e);break;case h.BOOLEAN:n=Id(e);break;case h.SCALAR:case h.NOERROR:case h.ANY:n=e;break;case h.RANGE:if(e instanceof g)return e;n=wd(e);break;case h.COMPLEX:return this.arithmeticHelper.coerceScalarToComplex(F(e))}return t.passSubtype||n===void 0?n:F(n)}calculateSingleCellOfResultArray(e,t,r,n,i,a){const o=this.coerceArgumentsToRequiredTypes(e,t,r,n);if(o instanceof g)return o;const u=i(...o);return this.returnNumberWrapper(u,a)}coerceArgumentsToRequiredTypes(e,t,r,n){const i=[];for(let a=0;a<r.length;a++){const o=r[a],u=t[a]!==void 0?t[a]:o?.defaultValue;if(u===void 0){i.push(void 0);continue}const l=this.coerceToType(u,o,e);if(l===void 0&&!n[a])return new g(R.VALUE,T.WrongType);if(l instanceof g&&o.argumentType!==h.SCALAR)return l;i.push(l)}return i}vectorizeAndBroadcastArgumentsIfNecessary(e,t,r,n,i){return t.map((a,o)=>e&&this.isRangePassedAsAScalarArgument(a,r[o])?this.vectorizeAndBroadcastRangeArgument(a,n,i):a)}vectorizeAndBroadcastRangeArgument(e,t,r){var n;const i=e.height()===1?0:t,a=e.width()===1?0:r;return(n=e.data[i])===null||n===void 0?void 0:n[a]}evaluateArguments(e,t,r){return r.expandRanges?this.listOfScalarValues(e,t):e.map(n=>[this.evaluateAst(n,t),!1])}buildMetadataForEachArgumentValue(e,t){const r=t.parameters?[...t.parameters]:[];if(t.repeatLastArgs!==void 0&&Number.isInteger(t.repeatLastArgs)&&t.repeatLastArgs>0)for(;e>r.length;)r.push(...r.slice(r.length-t.repeatLastArgs));return r}isNumberOfArgumentValuesValid(e,t){return t>e.length?!1:t<e.length?e.slice(t).every(i=>i?.optionalArg||i?.defaultValue!==void 0):!0}calculateSizeOfVectorizedResultArray(e,t){const r=e.filter((a,o)=>this.isRangePassedAsAScalarArgument(a,t[o])),n=Math.max(1,...r.map(a=>a.height())),i=Math.max(1,...r.map(a=>a.width()));return[n,i]}isRangePassedAsAScalarArgument(e,t){return e==null||t==null?!1:e instanceof D&&![h.RANGE,h.ANY].includes(t.argumentType)}metadata(e){const t=this.constructor.implementedFunctions[e];if(t!==void 0)return t;throw new Error(`No metadata for function ${e}.`)}returnNumberWrapper(e,t,r){return t!==void 0&&de(e)?this.arithmeticHelper.ExtendedNumberFactory(F(e),{type:t,format:r}):e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Z{constructor(e,t,r=!1){this.width=e,this.height=t,this.isRef=r}static error(){return new Z(1,1,!0)}static scalar(){return new Z(1,1,!1)}isScalar(){return this.width===1&&this.height===1||this.isRef}}function bN(s,e){return new Z(Math.max(s.width,e.width),Math.max(s.height,e.height))}function xN(s){return new Z(s.width,s.height)}class _N{constructor(e,t){this.config=e,this.functionRegistry=t}checkArraySize(e,t){return this.checkArraySizeForAst(e,{formulaAddress:t,arraysFlag:this.config.useArrayArithmetic})}checkArraySizeForAst(e,t){switch(e.type){case y.FUNCTION_CALL:return this.checkArraySizeForFunction(e,t);case y.COLUMN_RANGE:case y.ROW_RANGE:case y.CELL_RANGE:{const r=W.fromAstOrUndef(e,t.formulaAddress);return r===void 0?Z.error():new Z(r.width(),r.height(),!0)}case y.ARRAY:{const r=[],n=[];for(const o of e.args){const u=o.map(d=>this.checkArraySizeForAst(d,t)),l=Math.min(...u.map(d=>d.height)),c=u.reduce((d,f)=>d+f.width,0);r.push(l),n.push(c)}const i=r.reduce((o,u)=>o+u,0),a=Math.min(...n);return new Z(a,i)}case y.STRING:case y.NUMBER:return Z.scalar();case y.CELL_REFERENCE:return new Z(1,1,!0);case y.DIV_OP:case y.CONCATENATE_OP:case y.EQUALS_OP:case y.GREATER_THAN_OP:case y.GREATER_THAN_OR_EQUAL_OP:case y.LESS_THAN_OP:case y.LESS_THAN_OR_EQUAL_OP:case y.MINUS_OP:case y.NOT_EQUAL_OP:case y.PLUS_OP:case y.POWER_OP:case y.TIMES_OP:{const r=this.checkArraySizeForAst(e.left,t),n=this.checkArraySizeForAst(e.right,t);return!t.arraysFlag&&(r.height>1||r.width>1||n.height>1||n.width>1)?Z.error():bN(r,n)}case y.MINUS_UNARY_OP:case y.PLUS_UNARY_OP:case y.PERCENT_OP:{const r=this.checkArraySizeForAst(e.value,t);return!t.arraysFlag&&(r.height>1||r.width>1)?Z.error():xN(r)}case y.PARENTHESIS:return this.checkArraySizeForAst(e.expression,t);case y.EMPTY:return Z.error();default:return Z.error()}}checkArraySizeForFunction(e,t){const r=this.functionRegistry.getArraySizeFunction(e.procedureName);if(r!==void 0)return r(e,t);const n=this.functionRegistry.getMetadata(e.procedureName);if(n===void 0||n.expandRanges||!t.arraysFlag||n.vectorizationForbidden||n.parameters===void 0)return new Z(1,1);const i=e.args.map(l=>{var c;return this.checkArraySizeForAst(l,new Cr(t.formulaAddress,t.arraysFlag||((c=n?.enableArrayArithmeticForArguments)!==null&&c!==void 0?c:!1)))}),a=[...n.parameters];if(n.repeatLastArgs!==void 0&&a.length<i.length&&(i.length-a.length)%n.repeatLastArgs!==0)return Z.error();for(;a.length<i.length;){if(n.repeatLastArgs===void 0)return Z.error();a.push(...a.slice(a.length-n.repeatLastArgs))}let o=1,u=1;for(let l=0;l<i.length;l++)a[l].argumentType!==h.RANGE&&a[l].argumentType!==h.ANY&&(u=Math.max(u,i[l].height),o=Math.max(o,i[l].width));return new Z(o,u)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class xd{constructor(e,t,r){var n;this.value=t,this.address=r,this.type=e.type,this.message=(n=e.message)!==null&&n!==void 0?n:""}toString(){return this.value}valueOf(){return this.value}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function ge(s,e,t){if(typeof s>"u")return kt.defaultConfig[t];if(typeof e=="string"){if(typeof s===e)return s;throw new he(e,t)}else{if(e.includes(s))return s;throw new Nd(e.map(r=>`'${r}'`).join(" "),t)}}function _n(s,e,t){if(s<t)throw new Rd(e,t)}function LN(s,e,t){if(s>t)throw new yd(e,t)}function di(s,e,t,r){if(e(s))return s;if(typeof s>"u")return kt.defaultConfig[r];throw new he(t,r)}function Ll(...s){const e=new Map;s.forEach(r=>{const n=e.get(r.value)||[];n.push(r.name),e.set(r.value,n)});const t=[];for(const r of e.values())r.length>1&&t.push(r);if(t.length>0){t.forEach(n=>n.sort());const r=t.map(n=>`[${n}]`).join("; ");throw new Error(`Config initialization failed. Parameters in conflict: ${r}`)}}function M(s,e,t){if(typeof s!==e)throw new he(e,t)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Nu=new RegExp("^ss(\\.(s+|0+))?$"),FN=new RegExp("^[0-9/.\\-: ]+[ap]?m?$"),UN=new RegExp("\\s+"),_d=new RegExp("[ /.-]"),Io=":",Fl=1e3,PN=Ld(BN),DN=Ld(kN);function VN(s,e,t){if(e===void 0&&t===void 0)return;let r=s.replace(UN," ").trim().toLowerCase();if(!GN(r))return;let n=r.substring(r.length-2);n==="am"||n==="pm"?r=r.substring(0,r.length-2).trim():(n=r.substring(r.length-1),n==="a"||n==="p"?r=r.substring(0,r.length-1).trim():n=void 0);const i=r.split(_d);i.length>=2&&i[i.length-2].includes(Io)&&(i[i.length-2]=i[i.length-2]+"."+i[i.length-1],i.pop());const a=i[i.length-1].split(Io);if(n!==void 0&&a.push(n),i.length===1)return Ul(a,t);if(a.length===1)return Pl(i,e);const o=Pl(i.slice(0,i.length-1),e),u=Ul(a,t);if(o!==void 0)return u===void 0?void 0:Object.assign(Object.assign({},o),u)}function Ul(s,e){var t,r,n;if(e===void 0)return;const{itemsCount:i,hourItem:a,minuteItem:o,secondItem:u}=PN(e);let l;if(s[s.length-1]==="am"||s[s.length-1]==="a"?(l=!1,s.pop()):(s[s.length-1]==="pm"||s[s.length-1]==="p")&&(l=!0,s.pop()),s.length!==i)return;const c=Number((t=s[u])!==null&&t!==void 0?t:"0");if(!Number.isFinite(c))return;const d=Math.round(c*Fl)/Fl,f=Number((r=s[o])!==null&&r!==void 0?r:"0");if(!(Number.isFinite(f)&&Number.isInteger(f)))return;const p=Number((n=s[a])!==null&&n!==void 0?n:"0");return!(Number.isFinite(p)&&Number.isInteger(p))||l!==void 0&&(p<0||p>12)?void 0:{hours:l!==void 0?p%12+(l?12:0):p,minutes:f,seconds:d}}function Pl(s,e){var t;if(e===void 0)return;const{itemsCount:r,dayItem:n,monthItem:i,shortYearItem:a,longYearItem:o}=DN(e);if(s.length!==r)return;const u=Number(s[n]);if(!(Number.isFinite(u)&&Number.isInteger(u)))return;const l=Number(s[i]);if(!(Number.isFinite(l)&&Number.isInteger(l))||s[o]&&s[a])return;const c=Number((t=s[o])!==null&&t!==void 0?t:s[a]);if(Number.isFinite(c)&&Number.isInteger(c)&&!(s[o]&&(c<1e3||c>9999))&&!(s[a]&&(c<0||c>99)))return{year:c,month:l,day:u}}function BN(s){const e=s.toLowerCase().trim(),r=(e.endsWith("am/pm")?e.substring(0,e.length-5):e.endsWith("a/p")?e.substring(0,s.length-3):e).trim().split(Io);return{itemsCount:r.length,hourItem:r.indexOf("hh"),minuteItem:r.indexOf("mm"),secondItem:r.findIndex(n=>Nu.test(n))}}function kN(s){const e=s.toLowerCase().trim().split(_d);return{itemsCount:e.length,dayItem:e.indexOf("dd"),monthItem:e.indexOf("mm"),shortYearItem:e.indexOf("yy"),longYearItem:e.indexOf("yyyy")}}function GN(s){return FN.test(s)}function Ld(s){const e={};return t=>{const r=e[t];if(r!==void 0)return r;const n=s(t);return e[t]=n,n}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Mo=[31,28,31,30,31,30,31,31,30,31,30,31],zn=[0,31,59,90,120,151,181,212,243,273,304,334],fi=60,pi=60,Oo=24;function Fs(s){return s&&(typeof s=="object"||typeof s=="function")?"year"in s&&typeof s.year=="number"&&"month"in s&&typeof s.month=="number"&&"day"in s&&typeof s.day=="number":!1}function Fd(s){return s&&(typeof s=="object"||typeof s=="function")?"hours"in s&&typeof s.hours=="number"&&"minutes"in s&&typeof s.minutes=="number"&&"seconds"in s&&typeof s.seconds=="number":!1}const HN={year:9999,month:12,day:31};class WN{constructor(e){this.config=e,this.minDateAbsoluteValue=this.dateToNumberFromZero(e.nullDate),this.maxDateValue=this.dateToNumber(HN),this.leapYear1900=e.leapYear1900,!this.leapYear1900&&0<=this.dateToNumber({year:1900,month:2,day:28})?this.epochYearZero=this.numberToSimpleDate(2).year:this.epochYearZero=this.numberToSimpleDate(1).year,this.parseDateTime=e.parseDateTime}getWithinBounds(e){return e<=this.maxDateValue&&e>=0?e:void 0}dateStringToDateNumber(e){const{dateTime:t,dateFormat:r="",timeFormat:n=""}=this.parseDateTimeFromConfigFormats(e);if(t!==void 0)return Fd(t)?Fs(t)?new Eu(Kn(t)+this.dateToNumber(t),r+" "+n):new gu(Kn(t),n):Fs(t)?new mu(this.dateToNumber(t),r):0}parseDateTimeFromConfigFormats(e){return this.parseDateTimeFromFormats(e,this.config.dateFormats,this.config.timeFormats)}getNullYear(){return this.config.nullYear}getEpochYearZero(){return this.epochYearZero}isValidDate(e){return isNaN(e.year)||isNaN(e.month)||isNaN(e.day)||e.day!==Math.round(e.day)||e.month!==Math.round(e.month)||e.year!==Math.round(e.year)||e.year<1582||e.month<1||e.month>12||e.day<1?!1:this.isLeapYear(e.year)&&e.month===2?e.day<=29:e.day<=Mo[e.month-1]}dateToNumber(e){return this.dateToNumberFromZero(e)-this.minDateAbsoluteValue}relativeNumberToAbsoluteNumber(e){return e+this.minDateAbsoluteValue-(this.leapYear1900?1:0)}numberToSimpleDate(e){const t=Math.floor(e)+this.minDateAbsoluteValue;let r=Math.floor(t/365.2425);this.dateToNumberFromZero({year:r+1,month:1,day:1})<=t?r++:this.dateToNumberFromZero({year:r-1,month:1,day:1})>t&&r--;const n=t-this.dateToNumberFromZero({year:r,month:1,day:1}),i=zN(n-(this.isLeapYear(r)&&n>=59?1:0)),a=n-zn[i]-(this.isLeapYear(r)&&i>1?1:0);return{year:r,month:i+1,day:a+1}}numberToSimpleDateTime(e){const t=Xn(e%1),r=Math.floor(t.hours/Oo);t.hours=t.hours%Oo;const n=this.numberToSimpleDate(Math.floor(e)+r);return Object.assign(Object.assign({},n),t)}leapYearsCount(e){return Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400)+(this.config.leapYear1900&&e>=1900?1:0)}daysInMonth(e,t){return this.isLeapYear(e)&&t===2?29:Mo[t-1]}endOfMonth(e){return{year:e.year,month:e.month,day:this.daysInMonth(e.year,e.month)}}toBasisUS(e,t){return e.day===31&&(e.day=30),e.day===30&&t.day===31&&(t.day=30),e.month===2&&e.day===this.daysInMonth(e.year,e.month)&&(e.day=30,t.month===2&&t.day===this.daysInMonth(t.year,t.month)&&(t.day=30)),[e,t]}yearLengthForBasis(e,t){return e.year!==t.year?e.year+1!==t.year||e.month<t.month||e.month===t.month&&e.day<t.day?(this.leapYearsCount(t.year)-this.leapYearsCount(e.year-1))/(t.year-e.year+1)+365:this.countLeapDays(t)!==this.countLeapDays({year:e.year,month:e.month,day:e.day-1})?366:365:this.isLeapYear(e.year)?366:365}parseSingleFormat(e,t,r){const n=this.parseDateTime(e,t,r);if(!(Fs(n)&&(n.year>=0&&n.year<100&&(n.year<this.getNullYear()?n.year+=2e3:n.year+=1900),!this.isValidDate(n))))return n}parseDateTimeFromFormats(e,t,r){const n=t.length===0?[void 0]:t,i=r.length===0?[void 0]:r;for(const a of n)for(const o of i){const u=this.parseSingleFormat(e,a,o);if(u!==void 0)return{dateTime:u,timeFormat:o,dateFormat:a}}return{}}countLeapDays(e){return e.month>2||e.month===2&&e.day>=29?this.leapYearsCount(e.year):this.leapYearsCount(e.year-1)}dateToNumberFromZero(e){return 365*e.year+zn[e.month-1]+e.day-1+(e.month<=2?this.leapYearsCount(e.year-1):this.leapYearsCount(e.year))}isLeapYear(e){return e%4?!1:e%100?!0:e%400?e===1900&&this.config.leapYear1900:!0}}function zN(s){let e=0;return zn[e+6]<=s&&(e+=6),zn[e+3]<=s&&(e+=3),zn[e+2]<=s?e+=2:zn[e+1]<=s&&(e+=1),e}function Dl(s,e){const t=12*s.year+s.month-1+e;return{year:Math.floor(t/12),month:t%12+1,day:s.day}}function jN(s){return{year:s.year,month:s.month,day:Math.min(s.day,Mo[s.month-1])}}function Ka(s){return Math.round(s*3600*24)/(3600*24)}function YN(s,e=1){return Math.round(s*e)/e}function Xn(s){const e=s*Oo*pi*fi,t=YN(e%fi,1e5)%fi,r=(e-t)/fi,n=Math.round(r%pi)%pi,i=(r-n)/pi;return{hours:Math.round(i),minutes:n,seconds:t}}function Kn(s){return((s.seconds/60+s.minutes)/60+s.hours)/24}function Vl(s){return{year:s.year,month:s.month,day:Math.min(30,s.day)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class $N{call(){return fN}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Bl=/(\\.|dd|DD|d|D|mm|MM|m|M|YYYY|YY|yyyy|yy|HH|hh|H|h|ss(\.(0+|s+))?|s|AM\/PM|am\/pm|A\/P|a\/p|\[mm]|\[MM]|\[hh]|\[HH])/g,kl=/(\\.|[#0]+(\.[#0]*)?)/g;var Ar;(function(s){s.FORMAT="FORMAT",s.FREE_TEXT="FREE_TEXT"})(Ar||(Ar={}));function mi(s,e){return{type:s,value:e}}var aa;(function(s){s.DATE="DATE",s.NUMBER="NUMBER",s.STRING="STRING"})(aa||(aa={}));function XN(s){Bl.lastIndex=0;const e=[];let t;do t=Bl.exec(s),t!==null&&e.push(t);while(t);return e}function KN(s){kl.lastIndex=0;const e=kl.exec(s);return e!==null?[e]:[]}function Ud(s,e){const t=[];let r=0;for(let i=0;i<s.length;++i){const a=s[i];if(a.index!==r){const o=e.substr(r,a.index-r);t.push(mi(Ar.FREE_TEXT,o))}a[0].startsWith("\\")?t.push(mi(Ar.FREE_TEXT,a[0])):t.push(mi(Ar.FORMAT,a[0])),r=a.index+a[0].length}const n=s[s.length-1];if(n.index+n[0].length<e.length){const i=e.substr(n.index+n[0].length,e.length);t.push(mi(Ar.FREE_TEXT,i))}return t}function Pd(s){const e=XN(s);if(!e.every(t=>Dd(t)))return{type:aa.DATE,tokens:Ud(e,s)}}function qN(s){const e=KN(s);if(!e.every(t=>Dd(t)))return{type:aa.NUMBER,tokens:Ud(e,s)}}function Dd(s){return s[0].startsWith("\\")}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function QN(s,e,t,r){const n=t.stringifyDateTime(r.numberToSimpleDateTime(s),e);if(n!==void 0)return n;const i=t.stringifyDuration(Xn(s),e);if(i!==void 0)return i;const a=qN(e);return a!==void 0?JN(a.tokens,s):e}function St(s,e){let t=`${s}`;for(;t.length<e;)t="0"+t;return t}function ZN(s,e){let t=`${s}`;for(;t.length<e;)t=t+"0";return t}function Gl(s,e){return s.split(e).length-1}function JN(s,e){let t="";for(let r=0;r<s.length;++r){const n=s[r];if(n.type===Ar.FREE_TEXT){t+=n.value;continue}const i=n.value.split("."),a=i[0],o=i[1]||"",u=i[1]?".":"",l=Number(e.toFixed(o.length)).toString().split(".");let c=l[0]||"",d=l[1]||"";if(a.length>c.length){const p=Gl(a.substr(0,a.length-c.length),"0");c=St(c,p+c.length)}const f=Gl(o.substr(d.length,o.length-d.length),"0");d=ZN(d,f+d.length),t+=c+u+d}return t}function eT(s,e){const t=Pd(e);if(t===void 0)return;const r=t.tokens;let n="";for(const i of r){if(i.type===Ar.FREE_TEXT){n+=i.value;continue}switch(i.value.toLowerCase()){case"h":case"hh":{n+=St(s.hours,i.value.length),s.hours=0;break}case"[hh]":{n+=St(s.hours,i.value.length-2),s.hours=0;break}case"m":case"mm":{n+=St(s.minutes,i.value.length),s.minutes=0;break}case"[mm]":{n+=St(s.minutes+60*s.hours,i.value.length-2),s.minutes=0,s.hours=0;break}case"s":case"ss":{n+=St(Math.floor(s.seconds),i.value.length);break}default:{if(Nu.test(i.value)){const a=Math.max(i.value.length-3,0);n+=`${s.seconds<10?"0":""}${Math.floor(s.seconds*Math.pow(10,a))/Math.pow(10,a)}`;continue}return}}}return n}function tT(s,e){const t=Pd(e);if(t===void 0)return;const r=t.tokens;let n="",i=!1;const a=r.some(o=>o.type===Ar.FORMAT&&(o.value==="a/p"||o.value==="A/P"||o.value==="am/pm"||o.value==="AM/PM"));for(let o=0;o<r.length;o++){const u=r[o];if(u.type===Ar.FREE_TEXT){n+=u.value;continue}switch(u.value.toLowerCase()){case"h":case"hh":{i=!0,n+=St(a?(s.hours+11)%12+1:s.hours,u.value.length);break}case"d":case"dd":{n+=St(s.day,u.value.length);break}case"s":case"ss":{n+=St(Math.floor(s.seconds),u.value.length);break}case"m":case"mm":{o+1<r.length&&r[o+1].value.startsWith(":")&&(i=!0),i?n+=St(s.minutes,u.value.length):n+=St(s.month,u.value.length),i=!0;break}case"yy":{n+=St(s.year%100,u.value.length);break}case"yyyy":{n+=s.year;break}case"am/pm":case"a/p":{const[l,c]=u.value.split("/");n+=s.hours<12?l:c;break}default:{if(Nu.test(u.value)){const l=u.value.length-3;n+=`${s.seconds<10?"0":""}${Math.floor(s.seconds*Math.pow(10,l))/Math.pow(10,l)}`;continue}return}}}return n}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const bo="length",Us=s=>parseInt(s,16),Hl=s=>parseInt(s,10),qa=s=>(s+"").replace(/\-/g,""),oa=(s,e,t)=>s.substr(e,t),ir=s=>s.codePointAt(0)-65;function rT(s){return qa(s)[bo]===25?Us(oa(qa(s),Us("12"),ir("F")))/(Us(oa(qa(s),ir("C"),ir("Y")>>4))||(~~![][bo]<<3)+1):0}function nT(s){if(s=(s+"").replace(/\-/g,""),s[bo]!==ir("Z"))return!1;let e=0;return[[0,ir("G")+1],[ir("H"),ir("H")-1],[ir("G")+ir("H"),ir("G")]].reduce((t,[r,n],i)=>(t|=(Hl(`${Hl(Us(oa(s,e+r-(i===0?0:2),n+(i?2:0)))+(Us(oa(s,e+r+n,2))+[]).padStart(2,"0"))}`)%97||2)>>1,e+=2,t),ir("A"))==="1">>1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const sT={invalid:()=>"The license key for HyperFormula is invalid.",expired:({keyValidityDate:s})=>`The license key for HyperFormula expired on ${s}, and is not valid for the installed version.`,missing:()=>"The license key for HyperFormula is missing."};let Wl=!1;function iT(s){const e={template:"missing",vars:{}};if(s==="gpl-v3"||s==="internal-use-in-handsontable")e.template="valid";else if(typeof s=="string"&&nT(s)){const[t,r,n]="14/10/2025".split("/"),i=Math.floor(new Date(`${r}/${t}/${n}`).getTime()/864e5),a=rT(s);e.vars.keyValidityDate=aT(new Date((a+1)*864e5)),i>a?e.template="expired":e.template="valid"}else s!==""&&(e.template="invalid");return!Wl&&e.template!=="valid"&&(console.warn(sT[e.template](e.vars)),Wl=!0),e.template}function aT(s){const t=["January","February","March","April","May","June","July","August","September","October","November","December"][s.getMonth()],r=s.getDate(),n=s.getFullYear();return`${t} ${r}, ${n}`}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var be;(function(s){class e{constructor(u){this.value=u,this.value=pu(this.value,Od(F(this.value)))}}s.Number=e;class t{constructor(u){this.value=u}}s.String=t;class r{constructor(u){this.value=u}}s.Boolean=r;class n{static getSingletonInstance(){return n.instance||(n.instance=new n),n.instance}}s.Empty=n;class i{constructor(u){this.formula=u}}s.Formula=i;class a{constructor(u,l){this.value=new g(u,l)}}s.Error=a})(be||(be={}));function oT(s){return s.startsWith("=")}function uT(s){const e=s.toLowerCase();return e==="true"||e==="false"}function lT(s,e){const t=s.toUpperCase();return/#[A-Za-z0-9\/]+[?!]?/.test(t)&&Object.prototype.hasOwnProperty.call(e,t)}class cT{constructor(e,t,r){this.config=e,this.dateHelper=t,this.numberLiteralsHelper=r}parse(e){if(e==null)return be.Empty.getSingletonInstance();if(typeof e=="number")return Md(e)?new be.Error(R.NUM,T.ValueLarge):new be.Number(e);if(typeof e=="boolean")return new be.Boolean(e);if(e instanceof Date){const t=this.dateHelper.dateToNumber({day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()}),r=Kn({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()+e.getMilliseconds()/1e3}),n=t+r;return n<0?new be.Error(R.NUM,T.DateBounds):n%1===0?new be.Number(new mu(n,"Date()")):n<1?new be.Number(new gu(n,"Date()")):new be.Number(new Eu(n,"Date()"))}else if(typeof e=="string"){if(uT(e))return new be.Boolean(e.toLowerCase()==="true");if(oT(e))return new be.Formula(e);if(lT(e,this.config.errorMapping))return new be.Error(this.config.errorMapping[e.toUpperCase()]);{let t=e.trim(),r=0,n;if(t.endsWith("%"))r=1,t=t.slice(0,t.length-1);else{const o=this.currencyMatcher(t);o!==void 0&&(r=2,[n,t]=o)}const i=this.numberLiteralsHelper.numericStringToMaybeNumber(t);if(i!==void 0){let o;return r===1?o=new Fi(i/100):r===2?o=new To(i,n):o=i,new be.Number(o)}const a=this.dateHelper.dateStringToDateNumber(t);return a!==void 0?new be.Number(a):new be.String(e.startsWith("'")?e.slice(1):e)}}else throw new Ed(e)}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length)];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length)]}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Rn;(function(s){s[s.COPY=0]="COPY",s[s.CUT=1]="CUT"})(Rn||(Rn={}));var lt;(function(s){s[s.VALUE=0]="VALUE",s[s.EMPTY=1]="EMPTY",s[s.FORMULA=2]="FORMULA",s[s.PARSING_ERROR=3]="PARSING_ERROR"})(lt||(lt={}));class zl{constructor(e,t,r,n,i){this.sourceLeftCorner=e,this.width=t,this.height=r,this.type=n,this.content=i}*getContent(e){if(this.content!==void 0)for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r)yield[U(e.sheet,e.col+r,e.row+t),this.content[t][r]]}}class hT{constructor(e,t,r){this.dependencyGraph=t,this.operations=r,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}cut(e,t,r){this.clipboard=new zl(e,t,r,Rn.CUT)}copy(e,t,r){const n=[];for(let i=0;i<r;++i){n[i]=[];for(let a=0;a<t;++a){const o=this.operations.getClipboardCell(U(e.sheet,e.col+a,e.row+i));n[i].push(o)}}this.clipboard=new zl(e,t,r,Rn.COPY,n)}abortCut(){this.clipboard&&this.clipboard.type===Rn.CUT&&this.clear()}clear(){this.clipboard=void 0}ensureItIsPossibleToCopyPaste(e){if(this.clipboard===void 0)return;if(Ct(e)||!this.dependencyGraph.sheetMapping.hasSheetWithId(e.sheet))throw new $e("a valid target address.");const t=W.spanFrom(e,this.clipboard.width,this.clipboard.height);if(t.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new Tn;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new Error("It is not possible to paste onto an array")}isCutClipboard(){return this.clipboard!==void 0&&this.clipboard.type===Rn.CUT}isCopyClipboard(){return this.clipboard!==void 0&&this.clipboard.type===Rn.COPY}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ua{constructor(e,t,r,n){this.displayName=e,this.address=t,this.added=r,this.options=n}normalizeExpressionName(){return this.displayName.toLowerCase()}copy(){return new ua(this.displayName,this.address,this.added,this.options)}}class dT{constructor(){this.mapping=new Map}has(e){return this.mapping.has(this.normalizeExpressionName(e))}isNameAvailable(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);return!(r&&r.added)}add(e){this.mapping.set(e.normalizeExpressionName(),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}getExisting(e){const t=this.mapping.get(this.normalizeExpressionName(e));if(t&&t.added)return t}remove(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);r&&(r.added=!1)}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}normalizeExpressionName(e){return e.toLowerCase()}}class jl{constructor(){this.mapping=new Map}add(e){this.mapping.set(this.normalizeExpressionName(e.displayName),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}has(e){return this.mapping.has(this.normalizeExpressionName(e))}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(e=>e.added)}isNameAvailable(e){const t=this.normalizeExpressionName(e);return!this.mapping.has(t)}remove(e){const t=this.normalizeExpressionName(e);this.mapping.get(t)&&this.mapping.delete(t)}normalizeExpressionName(e){return e.toLowerCase()}}class wn{constructor(){this.nextNamedExpressionRow=0,this.workbookStore=new dT,this.worksheetStores=new Map,this.addressCache=new Map}isNameAvailable(e,t){var r,n;return t===void 0?this.workbookStore.isNameAvailable(e):(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.isNameAvailable(e))!==null&&n!==void 0?n:!0}namedExpressionInAddress(e){const t=this.addressCache.get(e);if(t&&t.added)return t}namedExpressionForScope(e,t){var r;return t===void 0?this.workbookStore.getExisting(e):(r=this.worksheetStore(t))===null||r===void 0?void 0:r.get(e)}nearestNamedExpression(e,t){var r,n;return(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.get(e))!==null&&n!==void 0?n:this.workbookStore.getExisting(e)}isExpressionInScope(e,t){var r,n;return(n=(r=this.worksheetStore(t))===null||r===void 0?void 0:r.has(e))!==null&&n!==void 0?n:!1}isNameValid(e){const t=new RegExp(`^${Jc}$`),r=new RegExp(`^${eh}$`),n=new RegExp(`^${th}$`);return t.test(e)||r.test(e)?!1:n.test(e)}addNamedExpression(e,t,r){const n=t===void 0?this.workbookStore:this.worksheetStoreOrCreate(t);let i=n.get(e);return i!==void 0?(i.added=!0,i.displayName=e,i.options=r):(i=new ua(e,this.nextAddress(),!0,r),n.add(i)),this.addressCache.set(i.address.row,i),i}restoreNamedExpression(e,t){const r=t===void 0?this.workbookStore:this.worksheetStoreOrCreate(t);return e.added=!0,r.add(e),this.addressCache.set(e.address.row,e),e}namedExpressionOrPlaceholder(e,t){var r;return(r=this.worksheetStoreOrCreate(t).get(e))!==null&&r!==void 0?r:this.workbookNamedExpressionOrPlaceholder(e)}workbookNamedExpressionOrPlaceholder(e){let t=this.workbookStore.get(e);return t===void 0&&(t=new ua(e,this.nextAddress(),!1),this.workbookStore.add(t)),t}remove(e,t){let r;t===void 0?r=this.workbookStore:r=this.worksheetStore(t);const n=r?.get(e);if(r===void 0||n===void 0||!n.added)throw Error("Named expression does not exist");r.remove(e),r instanceof jl&&r.mapping.size===0&&this.worksheetStores.delete(t),this.addressCache.delete(n.address.row)}getAllNamedExpressionsNamesInScope(e){return this.getAllNamedExpressions().filter(({scope:t})=>t===e).map(t=>t.expression.displayName)}getAllNamedExpressionsNames(){return this.getAllNamedExpressions().map(e=>e.expression.displayName)}getAllNamedExpressions(){const e=[];return this.workbookStore.getAllNamedExpressions().forEach(t=>{e.push({expression:t,scope:void 0})}),this.worksheetStores.forEach((t,r)=>{t.getAllNamedExpressions().forEach(n=>{e.push({expression:n,scope:r})})}),e}getAllNamedExpressionsForScope(e){var t,r;return e===void 0?this.workbookStore.getAllNamedExpressions():(r=(t=this.worksheetStores.get(e))===null||t===void 0?void 0:t.getAllNamedExpressions())!==null&&r!==void 0?r:[]}worksheetStoreOrCreate(e){let t=this.worksheetStores.get(e);return t||(t=new jl,this.worksheetStores.set(e,t)),t}worksheetStore(e){return this.worksheetStores.get(e)}nextAddress(){return U(wn.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}}wn.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;const Kr=s=>{switch(s.type){case y.EMPTY:case y.NUMBER:case y.STRING:case y.ERROR:case y.ERROR_WITH_RAW_INPUT:return!1;case y.CELL_REFERENCE:return!s.reference.isAbsolute();case y.CELL_RANGE:case y.COLUMN_RANGE:case y.ROW_RANGE:return!s.start.isAbsolute();case y.NAMED_EXPRESSION:return!1;case y.PERCENT_OP:case y.PLUS_UNARY_OP:case y.MINUS_UNARY_OP:return Kr(s.value);case y.CONCATENATE_OP:case y.EQUALS_OP:case y.NOT_EQUAL_OP:case y.LESS_THAN_OP:case y.GREATER_THAN_OP:case y.LESS_THAN_OR_EQUAL_OP:case y.GREATER_THAN_OR_EQUAL_OP:case y.MINUS_OP:case y.PLUS_OP:case y.TIMES_OP:case y.DIV_OP:case y.POWER_OP:return Kr(s.left)||Kr(s.right);case y.PARENTHESIS:return Kr(s.expression);case y.FUNCTION_CALL:return s.args.some(e=>Kr(e));case y.ARRAY:return s.args.some(e=>e.some(t=>Kr(t)))}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class cn{performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[n,i]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService)),a=t.rememberNewAst(n);r.setFormula(a),r.setAddress(i)}}transformSingleAst(e,t){const r=this.transformAst(e,t),n=this.fixNodeAddress(t);return[r,n]}transformAst(e,t){switch(e.type){case y.CELL_REFERENCE:return this.transformCellReferenceAst(e,t);case y.CELL_RANGE:return this.transformCellRangeAst(e,t);case y.COLUMN_RANGE:return this.transformColumnRangeAst(e,t);case y.ROW_RANGE:return this.transformRowRangeAst(e,t);case y.EMPTY:case y.ERROR:case y.NUMBER:case y.NAMED_EXPRESSION:case y.ERROR_WITH_RAW_INPUT:case y.STRING:return e;case y.PERCENT_OP:case y.MINUS_UNARY_OP:case y.PLUS_UNARY_OP:return Object.assign(Object.assign({},e),{value:this.transformAst(e.value,t)});case y.FUNCTION_CALL:return Object.assign(Object.assign({},e),{procedureName:e.procedureName,args:e.args.map(r=>this.transformAst(r,t))});case y.PARENTHESIS:return Object.assign(Object.assign({},e),{expression:this.transformAst(e.expression,t)});case y.ARRAY:return Object.assign(Object.assign({},e),{args:e.args.map(r=>r.map(n=>this.transformAst(n,t)))});default:return Object.assign(Object.assign({},e),{left:this.transformAst(e.left,t),right:this.transformAst(e.right,t)})}}transformCellReferenceAst(e,t){const r=this.transformCellAddress(e.reference,t);return r instanceof Ce?Object.assign(Object.assign({},e),{reference:r}):r===R.REF?Tr(new g(R.REF)):e}transformCellRangeAst(e,t){const r=this.transformCellRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===R.REF?Tr(new g(R.REF)):e}transformColumnRangeAst(e,t){const r=this.transformColumnRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===R.REF?Tr(new g(R.REF)):e}transformRowRangeAst(e,t){const r=this.transformRowRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===R.REF?Tr(new g(R.REF)):e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class fT extends cn{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!1}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=hr(e,t);if(r!==this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet)return!1;const n=e.toSimpleColumnAddress(t);return r===this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet?this.columnsSpan.columnStart<=n.col?e.shiftedByColumns(this.columnsSpan.numberOfColumns):!1:t.sheet===this.columnsSpan.sheet&&r!==this.columnsSpan.sheet?e.isColumnAbsolute()||t.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(-this.columnsSpan.numberOfColumns):e.isColumnAbsolute()?e.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(this.columnsSpan.numberOfColumns):e.toSimpleColumnAddress(t).col<this.columnsSpan.columnStart?t.col<this.columnsSpan.columnStart?!1:e.shiftedByColumns(-this.columnsSpan.numberOfColumns):t.col<this.columnsSpan.columnStart?e.shiftedByColumns(this.columnsSpan.numberOfColumns):!1}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col+this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n===R.REF||i===R.REF?R.REF:n||i?[n||e,i||t]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class xo extends cn{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!1}transformColumnRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}transformCellAddress(e,t){const r=hr(e,t);if(r!==this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet)return!1;const n=e.toSimpleRowAddress(t);return r===this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet?this.rowsSpan.rowStart<=n.row?e.shiftedByRows(this.rowsSpan.numberOfRows):!1:t.sheet===this.rowsSpan.sheet&&r!==this.rowsSpan.sheet?e.isRowAbsolute()||t.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(-this.rowsSpan.numberOfRows):e.isRowAbsolute()?e.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(this.rowsSpan.numberOfRows):n.row<this.rowsSpan.rowStart?t.row<this.rowsSpan.rowStart?!1:e.shiftedByRows(-this.rowsSpan.numberOfRows):t.row<this.rowsSpan.rowStart?e.shiftedByRows(this.rowsSpan.numberOfRows):!1}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row+this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n===R.REF||i===R.REF?R.REF:n||i?[n||e,i||t]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pT extends cn{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return e.isInvalid(t)?R.REF:!1}transformCellRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?R.REF:!1}transformColumnRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?R.REF:!1}transformRowRange(e,t,r){return e.isInvalid(r)||t.isInvalid(r)?R.REF:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mT extends cn{constructor(e,t,r,n){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=n,this.dependentFormulaTransformer=new gT(e,t,r,n)}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}transformSingleAst(e,t){return this.sourceRange.addressInRange(t)?[this.transformAst(e,t),this.fixNodeAddress(t)]:this.dependentFormulaTransformer.transformSingleAst(e,t)}fixNodeAddress(e){return U(this.toSheet,e.col+this.toRight,e.row+this.toBottom)}transformCellAddress(e,t){return this.transformAddress(e,t)}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformAddress(e,t){const r=this.sourceRange;if(e instanceof Ce){const n=e.toSimpleCellAddress(t);if(r.addressInRange(n))return e.shiftAbsoluteDimensions(this.toRight,this.toBottom)}return e.shiftRelativeDimensions(-this.toRight,-this.toBottom)}transformRange(e,t,r){const n=this.sourceRange;if(e instanceof Ce&&t instanceof Ce){const i=e.toSimpleCellAddress(r),a=t.toSimpleCellAddress(r);if(n.addressInRange(i)&&n.addressInRange(a))return[e.shiftAbsoluteDimensions(this.toRight,this.toBottom),t.shiftAbsoluteDimensions(this.toRight,this.toBottom)]}return[e.shiftRelativeDimensions(-this.toRight,-this.toBottom),t.shiftRelativeDimensions(-this.toRight,-this.toBottom)]}}class gT extends cn{constructor(e,t,r,n){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=n}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.shouldMove(e,t)?e.moved(this.toSheet,this.toRight,this.toBottom):!1}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}shouldMove(e,t){return e instanceof Ce?this.sourceRange.addressInRange(e.toSimpleCellAddress(t)):e instanceof mt?this.sourceRange.rowInRange(e.toSimpleRowAddress(t))&&!this.sourceRange.isFinite():this.sourceRange.columnInRange(e.toSimpleColumnAddress(t))&&!this.sourceRange.isFinite()}transformRange(e,t,r){const n=this.transformCellAddress(e,r),i=this.transformCellAddress(t,r);return n&&i?[n,i]:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ET extends cn{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!0}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=hr(e,t);if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet!==r)return!1;if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet===r){const n=e.toSimpleColumnAddress(t);if(n.col<this.columnsSpan.columnStart)return!1;if(n.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet!==r){if(e.isColumnAbsolute())return!1;if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet===r)if(e.isColumnAbsolute()){if(e.col<this.columnsSpan.columnStart)return!1;if(e.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}else{const n=e.toSimpleColumnAddress(t);if(n.col<this.columnsSpan.columnStart){if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}else if(n.col>this.columnsSpan.columnEnd){if(t.col<this.columnsSpan.columnStart)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns);if(t.col>this.columnsSpan.columnEnd)return!1}}return R.REF}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col-this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const n=hr(e,r);let i=e,a=t;if(this.columnsSpan.sheet===n){const l=e.toSimpleColumnAddress(r),c=t.toSimpleColumnAddress(r);if(this.columnsSpan.columnStart<=l.col&&this.columnsSpan.columnEnd>=c.col)return R.REF;l.col>=this.columnsSpan.columnStart&&l.col<=this.columnsSpan.columnEnd&&(i=e.shiftedByColumns(this.columnsSpan.columnEnd-l.col+1)),c.col>=this.columnsSpan.columnStart&&c.col<=this.columnsSpan.columnEnd&&(a=t.shiftedByColumns(-(c.col-this.columnsSpan.columnStart+1)))}const o=this.transformCellAddress(i,r),u=this.transformCellAddress(a,r);if(o===!1&&u===!1)return[i,a];if(o===R.REF||u===R.REF)throw Error("Cannot happen");return[o||i,u||a]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class _o extends cn{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!0}transformColumnRangeAst(e,t){return e}transformCellAddress(e,t){const r=hr(e,t);if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet!==r)return!1;if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet===r){const n=e.toSimpleRowAddress(t);if(n.row<this.rowsSpan.rowStart)return!1;if(n.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet!==r){if(e.isRowAbsolute())return!1;if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet===r)if(e.isRowAbsolute()){if(e.row<this.rowsSpan.rowStart)return!1;if(e.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}else{const n=e.toSimpleRowAddress(t);if(n.row<this.rowsSpan.rowStart){if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}else if(n.row>this.rowsSpan.rowEnd){if(t.row<this.rowsSpan.rowStart)return e.shiftedByRows(-this.rowsSpan.numberOfRows);if(t.row>this.rowsSpan.rowEnd)return!1}}return R.REF}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row-this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const n=hr(e,r);let i=e,a=t;if(this.rowsSpan.sheet===n){const l=e.toSimpleRowAddress(r),c=t.toSimpleRowAddress(r);if(this.rowsSpan.rowStart<=l.row&&this.rowsSpan.rowEnd>=c.row)return R.REF;l.row>=this.rowsSpan.rowStart&&l.row<=this.rowsSpan.rowEnd&&(i=e.shiftedByRows(this.rowsSpan.rowEnd-l.row+1)),c.row>=this.rowsSpan.rowStart&&c.row<=this.rowsSpan.rowEnd&&(a=t.shiftedByRows(-(c.row-this.rowsSpan.rowStart+1)))}const o=this.transformCellAddress(i,r),u=this.transformCellAddress(a,r);return o===!1&&u===!1?[i,a]:o===R.REF||u===R.REF?R.REF:[o||i,u||a]}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class RT extends cn{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[n]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService));r.setFormula(n)}}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.transformAddress(e)}transformCellRange(e,t,r){return this.transformAddress(e)}transformColumnRange(e,t,r){return this.transformAddress(e)}transformRowRange(e,t,r){return this.transformAddress(e)}transformAddress(e){return e.sheet===this.sheet?R.REF:!1}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Vd(s){if(!Array.isArray(s))throw new $e("an array of arrays.");for(let e=0;e<s.length;e++)if(!Array.isArray(s[e]))throw new $e("an array of arrays.")}function la(s){let e=0,t=0,r=0;for(let i=0;i<s.length;i++){let a=0;for(let o=0;o<s[i].length;o++){const u=s[i][o];u!=null&&(a=o+1,++r)}e=Math.max(e,a),a>0&&(t=i+1)}const n=e*t;return{height:t,width:e,fill:n===0?0:r/n}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Bd{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return ca(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>wt.fromNumberOfRows(this.sheet,e[0],e[1]))}}class kd{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return ha(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(e=>wt.fromNumberOfRows(this.sheet,e[0],e[1]))}}class Gd{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return ha(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>Vt.fromNumberOfColumns(this.sheet,e[0],e[1]))}}class Hd{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return ca(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(e=>Vt.fromNumberOfColumns(this.sheet,e[0],e[1]))}}class yT{constructor(e,t,r,n,i,a,o,u,l){this.dependencyGraph=t,this.columnSearch=r,this.cellContentParser=n,this.parser=i,this.stats=a,this.lazilyTransformingAstService=o,this.namedExpressions=u,this.arraySizePredictor=l,this.changes=tn.empty(),this.allocateNamedExpressionAddressSpace(),this.maxColumns=e.maxColumns,this.maxRows=e.maxRows}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}removeRows(e){const t=[];for(const r of e.rowsSpans()){const n=this.doRemoveRows(r);n&&t.push(n)}return t}addRows(e){for(const t of e.rowsSpans())this.doAddRows(t)}addColumns(e){for(const t of e.columnsSpans())this.doAddColumns(t)}removeColumns(e){const t=[];for(const r of e.columnsSpans()){const n=this.doRemoveColumns(r);n&&t.push(n)}return t}removeSheet(e){this.dependencyGraph.removeSheet(e);let t=0;this.stats.measure(K.TRANSFORM_ASTS,()=>{const n=new RT(e);n.performEagerTransformations(this.dependencyGraph,this.parser),t=this.lazilyTransformingAstService.addTransformation(n)}),this.sheetMapping.removeSheet(e),this.columnSearch.removeSheet(e);const r=this.namedExpressions.getAllNamedExpressionsForScope(e).map(n=>this.removeNamedExpression(n.normalizeExpressionName(),e));return{version:t,scopedNamedExpressions:r}}removeSheetByName(e){const t=this.sheetMapping.fetch(e);return this.removeSheet(t)}clearSheet(e){this.dependencyGraph.clearSheet(e),this.columnSearch.removeSheet(e)}addSheet(e){const t=this.sheetMapping.addSheet(e),r=[];return this.dependencyGraph.addressMapping.autoAddSheet(t,la(r)),this.sheetMapping.fetchDisplayName(t)}renameSheet(e,t){return this.sheetMapping.renameSheet(e,t)}moveRows(e,t,r,n){const i=wt.fromNumberOfRows(e,n,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddRows(i),n<t&&(t+=r);const a=U(e,0,t),o=U(e,0,n);this.moveCells(a,Number.POSITIVE_INFINITY,r,o);const u=wt.fromNumberOfRows(e,t,r);return this.doRemoveRows(u),this.lazilyTransformingAstService.commitCombinedMode()}moveColumns(e,t,r,n){const i=Vt.fromNumberOfColumns(e,n,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddColumns(i),n<t&&(t+=r);const a=U(e,t,0),o=U(e,n,0);this.moveCells(a,r,Number.POSITIVE_INFINITY,o);const u=Vt.fromNumberOfColumns(e,t,r);return this.doRemoveColumns(u),this.lazilyTransformingAstService.commitCombinedMode()}moveCells(e,t,r,n){this.ensureItIsPossibleToMoveCells(e,t,r,n);const i=W.spanFrom(e,t,r),a=W.spanFrom(n,t,r),o=n.col-e.col,u=n.row-e.row,l=n.sheet,c=this.getRangeClipboardCells(a),d=this.dependencyGraph.rawValuesFromRange(a);this.columnSearch.removeValues(d);const f=this.dependencyGraph.rawValuesFromRange(i);this.columnSearch.moveValues(f,o,u,l);let p=0;this.stats.measure(K.TRANSFORM_ASTS,()=>{const m=new mT(i,o,u,l);m.performEagerTransformations(this.dependencyGraph,this.parser),p=this.lazilyTransformingAstService.addTransformation(m)}),this.dependencyGraph.moveCells(i,o,u,l);const E=this.updateNamedExpressionsForMovedCells(e,t,r,n);return{version:p,overwrittenCellsData:c,addedGlobalNamedExpressions:E}}setRowOrder(e,t){const r=[];let n=[];for(const[i,a]of t)if(i!==a){const o=W.spanFrom({sheet:e,col:0,row:i},1/0,1),u=this.getRangeClipboardCells(o);n=n.concat(u),r.push(u.map(([{sheet:l,col:c},d])=>[{sheet:l,col:c,row:a},d]))}return r.forEach(i=>this.restoreClipboardCells(e,i.values())),n}setColumnOrder(e,t){const r=[];let n=[];for(const[i,a]of t)if(i!==a){const o=W.spanFrom({sheet:e,col:i,row:0},1,1/0),u=this.getRangeClipboardCells(o);n=n.concat(u),r.push(u.map(([{sheet:l,col:c,row:d},f])=>[{sheet:l,col:a,row:d},f]))}return r.forEach(i=>this.restoreClipboardCells(e,i.values())),n}addNamedExpression(e,t,r,n){const i=this.namedExpressions.addNamedExpression(e,r,n);this.storeNamedExpressionInCell(i.address,t),this.adjustNamedExpressionEdges(i,e,r)}restoreNamedExpression(e,t,r){const n=e.displayName;this.restoreCell(e.address,t);const i=this.namedExpressions.restoreNamedExpression(e,r);this.adjustNamedExpressionEdges(i,n,r)}changeNamedExpressionExpression(e,t,r,n){const i=this.namedExpressions.namedExpressionForScope(e,r);if(!i)throw new js(e);const a=i.copy();i.options=n;const o=this.getClipboardCell(i.address);return this.storeNamedExpressionInCell(i.address,t),[a,o]}removeNamedExpression(e,t){const r=this.namedExpressions.namedExpressionForScope(e,t);if(!r)throw new js(e);this.namedExpressions.remove(r.displayName,t);const n=this.getClipboardCell(r.address);if(t!==void 0){const i=this.namedExpressions.workbookNamedExpressionOrPlaceholder(e);this.dependencyGraph.exchangeNode(r.address,i.address)}else this.dependencyGraph.setCellEmpty(r.address);return[r,n]}ensureItIsPossibleToMoveCells(e,t,r,n){if(Ct(e)||!(da(t)&&da(r)||NT(e,t,r))||Ct(n)||!this.sheetMapping.hasSheetWithId(e.sheet)||!this.sheetMapping.hasSheetWithId(n.sheet))throw new $e("a valid range of cells to move.");const i=W.spanFrom(e,t,r),a=W.spanFrom(n,t,r);if(a.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new Tn;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new Wn;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(a))throw new na}restoreClipboardCells(e,t){const r=[];for(const[n,i]of t)if(this.restoreCell(n,i),i.type===lt.FORMULA){const{dependencies:a}=this.parser.fetchCachedResult(i.hash);r.push(...this.updateNamedExpressionsForTargetAddress(e,n,a))}return r}restoreCell(e,t){switch(t.type){case lt.VALUE:{this.setValueToCell(t,e);break}case lt.FORMULA:{this.setFormulaToCellFromCache(t.hash,e);break}case lt.EMPTY:{this.setCellEmpty(e);break}case lt.PARSING_ERROR:{this.setParsingErrorToCell(t.rawInput,t.errors,e);break}}}getOldContent(e){const t=this.dependencyGraph.getCell(e);if(t===void 0||t instanceof Zr)return[e,{type:lt.EMPTY}];if(t instanceof rn)return[e,Object.assign({type:lt.VALUE},t.getValues())];if(t instanceof Bt)return[t.getAddress(this.lazilyTransformingAstService),{type:lt.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))}];if(t instanceof $n)return[e,{type:lt.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}];throw Error("Trying to copy unsupported type")}getClipboardCell(e){const t=this.dependencyGraph.getCell(e);if(t===void 0||t instanceof Zr)return{type:lt.EMPTY};if(t instanceof rn)return Object.assign({type:lt.VALUE},t.getValues());if(t instanceof ze){const r=t.getArrayCellValue(e);return r===te?{type:lt.EMPTY}:{type:lt.VALUE,parsedValue:r,rawValue:t.getArrayCellRawValue(e)}}else{if(t instanceof Sr)return{type:lt.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))};if(t instanceof $n)return{type:lt.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}}throw Error("Trying to copy unsupported type")}getSheetClipboardCells(e){const t=this.dependencyGraph.getSheetHeight(e),r=this.dependencyGraph.getSheetWidth(e),n=new Array(t);for(let i=0;i<t;i++){n[i]=new Array(r);for(let a=0;a<r;a++){const o=U(e,a,i);n[i][a]=this.getClipboardCell(o)}}return n}getRangeClipboardCells(e){const t=[];for(const r of e.addresses(this.dependencyGraph))t.push([r,this.getClipboardCell(r)]);return t}setCellContent(e,t){const r=this.cellContentParser.parse(t),n=this.getOldContent(e);if(r instanceof be.Formula){const i=this.parser.parse(r.formula,e),{ast:a,errors:o}=i;if(o.length>0)this.setParsingErrorToCell(r.formula,o,e);else try{const u=this.arraySizePredictor.checkArraySize(a,e);if(u.width<=0||u.height<=0)throw Error("Incorrect array size");this.setFormulaToCell(e,u,i)}catch(u){if(!u.message)throw u;const l={type:Ve.InvalidRangeSize,message:"Invalid range size."};this.setParsingErrorToCell(r.formula,[l],e)}}else r instanceof be.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e);return n}setSheetContent(e,t){this.clearSheet(e);for(let r=0;r<t.length;r++)for(let n=0;n<t[r].length;n++){const i=U(e,n,r);this.setCellContent(i,t[r][n])}}setParsingErrorToCell(e,t,r){const n=this.dependencyGraph.getCellValue(r),i=new $n(t,e),a=this.dependencyGraph.setParsingErrorToCell(r,i);this.columnSearch.remove(F(n),r),this.columnSearch.applyChanges(a.getChanges()),this.changes.addAll(a),this.changes.addChange(i.getCellValue(),r)}setFormulaToCell(e,t,{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}){const o=this.dependencyGraph.getCellValue(e),u=this.dependencyGraph.setFormulaToCell(e,r,vr(a,e),t,n,i);this.columnSearch.remove(F(o),e),this.columnSearch.applyChanges(u.getChanges()),this.changes.addAll(u)}setValueToCell(e,t){const r=this.dependencyGraph.getCellValue(t),n=this.dependencyGraph.setValueToCell(t,e);this.columnSearch.change(F(r),F(e.parsedValue),t),this.columnSearch.applyChanges(n.getChanges().filter(i=>!$s(i.address,t))),this.changes.addAll(n),this.changes.addChange(e.parsedValue,t)}setCellEmpty(e){if(this.dependencyGraph.isArrayInternalCell(e))return;const t=this.dependencyGraph.getCellValue(e),r=this.dependencyGraph.setCellEmpty(e);this.columnSearch.remove(F(t),e),this.columnSearch.applyChanges(r.getChanges()),this.changes.addAll(r),this.changes.addChange(te,e)}setFormulaToCellFromCache(e,t){const{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:i,dependencies:a}=this.parser.fetchCachedResult(e),o=vr(a,t),[u]=new pT(t.sheet).transformSingleAst(r,t);this.parser.rememberNewAst(u);const l=Yy(o),c=this.arraySizePredictor.checkArraySize(r,t);this.dependencyGraph.setFormulaToCell(t,u,l,c,n,i)}rowEffectivelyNotInSheet(e,t){const r=this.dependencyGraph.addressMapping.getHeight(t);return e>=r}getAndClearContentChanges(){const e=this.changes;return this.changes=tn.empty(),e}forceApplyPostponedTransformations(){this.dependencyGraph.forceApplyPostponedTransformations()}doRemoveRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const t=[];for(const[a]of this.dependencyGraph.entriesFromRowsSpan(e))t.push({address:a,cellType:this.getClipboardCell(a)});const{affectedArrays:r,contentChanges:n}=this.dependencyGraph.removeRows(e);this.columnSearch.applyChanges(n.getChanges());let i=0;return this.stats.measure(K.TRANSFORM_ASTS,()=>{const a=new _o(e);a.performEagerTransformations(this.dependencyGraph,this.parser),i=this.lazilyTransformingAstService.addTransformation(a)}),this.rewriteAffectedArrays(r),{version:i,removedCells:t,rowFrom:e.rowStart,rowCount:e.numberOfRows}}doRemoveColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const t=[];for(const[a]of this.dependencyGraph.entriesFromColumnsSpan(e))t.push({address:a,cellType:this.getClipboardCell(a)});const{affectedArrays:r,contentChanges:n}=this.dependencyGraph.removeColumns(e);this.columnSearch.applyChanges(n.getChanges()),this.columnSearch.removeColumns(e);let i=0;return this.stats.measure(K.TRANSFORM_ASTS,()=>{const a=new ET(e);a.performEagerTransformations(this.dependencyGraph,this.parser),i=this.lazilyTransformingAstService.addTransformation(a)}),this.rewriteAffectedArrays(r),{version:i,removedCells:t,columnFrom:e.columnStart,columnCount:e.numberOfColumns}}doAddRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const{affectedArrays:t}=this.dependencyGraph.addRows(e);this.stats.measure(K.TRANSFORM_ASTS,()=>{const r=new xo(e);r.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(r)}),this.rewriteAffectedArrays(t)}rewriteAffectedArrays(e){for(const t of e.values()){if(t.array.size.isRef)continue;const r=t.getFormula(this.lazilyTransformingAstService),n=t.getAddress(this.lazilyTransformingAstService),i=this.parser.computeHashFromAst(r);this.setFormulaToCellFromCache(i,n)}}doAddColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const{affectedArrays:t,contentChanges:r}=this.dependencyGraph.addColumns(e);this.columnSearch.addColumns(e),this.columnSearch.applyChanges(r.getChanges()),this.stats.measure(K.TRANSFORM_ASTS,()=>{const n=new fT(e);n.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(n)}),this.rewriteAffectedArrays(t)}columnEffectivelyNotInSheet(e,t){const r=this.dependencyGraph.addressMapping.getWidth(t);return e>=r}adjustNamedExpressionEdges(e,t,r){if(r===void 0)return;const{vertex:n,id:i}=this.dependencyGraph.fetchCellOrCreateEmpty(e.address),a=i??this.dependencyGraph.graph.getNodeId(n),o=this.namedExpressions.workbookNamedExpressionOrPlaceholder(t),{vertex:u,id:l}=this.dependencyGraph.fetchCellOrCreateEmpty(o.address),c=l??this.dependencyGraph.graph.getNodeId(u);for(const d of this.dependencyGraph.graph.adjacentNodes(u))if(d instanceof Sr&&d.getAddress(this.lazilyTransformingAstService).sheet===r){const f=d.getFormula(this.lazilyTransformingAstService),p=d.getAddress(this.lazilyTransformingAstService),{dependencies:E}=this.parser.fetchCachedResultForAst(f);for(const m of vr(E,p))m instanceof Pr&&m.name.toLowerCase()===e.displayName.toLowerCase()&&(this.dependencyGraph.graph.removeEdgeIfExists(c,d),this.dependencyGraph.graph.addEdge(a,d))}}storeNamedExpressionInCell(e,t){const r=this.cellContentParser.parse(t);if(r instanceof be.Formula){const n=this.parser.parse(r.formula,U(-1,0,0));if(Kr(n.ast))throw new Ru;const{ast:i,hasVolatileFunction:a,hasStructuralChangeFunction:o,dependencies:u}=n;this.dependencyGraph.setFormulaToCell(e,i,vr(u,e),Z.scalar(),a,o)}else r instanceof be.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e)}updateNamedExpressionsForMovedCells(e,t,r,n){if(e.sheet===n.sheet)return[];const i=[],a=W.spanFrom(n,t,r);for(const o of a.addresses(this.dependencyGraph)){const u=this.addressMapping.fetchCell(o);if(u instanceof Sr&&o.sheet!==e.sheet){const l=u.getFormula(this.lazilyTransformingAstService),{dependencies:c}=this.parser.fetchCachedResultForAst(l);i.push(...this.updateNamedExpressionsForTargetAddress(e.sheet,o,c))}}return i}updateNamedExpressionsForTargetAddress(e,t,r){if(e===t.sheet)return[];const n=[],i=this.addressMapping.fetchCell(t);for(const a of vr(r,t)){if(!(a instanceof Pr))continue;const o=a.name,u=this.dependencyGraph.fetchNamedExpressionVertex(o,e).vertex,c=this.namedExpressions.isExpressionInScope(o,t.sheet)?this.dependencyGraph.fetchNamedExpressionVertex(o,t.sheet).vertex:this.copyOrFetchGlobalNamedExpressionVertex(o,u,n);c!==u&&(this.dependencyGraph.graph.removeEdgeIfExists(u,i),this.dependencyGraph.graph.addEdge(c,i))}return n}allocateNamedExpressionAddressSpace(){this.dependencyGraph.addressMapping.addSheet(wn.SHEET_FOR_WORKBOOK_EXPRESSIONS,new dN(0,0))}copyOrFetchGlobalNamedExpressionVertex(e,t,r){let n=this.namedExpressions.namedExpressionForScope(e);if(n===void 0)if(n=this.namedExpressions.addNamedExpression(e),r.push(n.normalizeExpressionName()),t instanceof Sr){const i=this.parser.fetchCachedResultForAst(t.getFormula(this.lazilyTransformingAstService)),{ast:a,hasVolatileFunction:o,hasStructuralChangeFunction:u,dependencies:l}=i;this.dependencyGraph.setFormulaToCell(n.address,a,vr(l,n.address),Z.scalar(),o,u)}else t instanceof Zr?this.setCellEmpty(n.address):t instanceof rn&&this.setValueToCell(t.getValues(),n.address);return this.dependencyGraph.fetchCellOrCreateEmpty(n.address).vertex}}function ca(s){if(s.length<=1)return s;const e=[...s].sort(([n],[i])=>n-i),t=e.reduce((n,[i,a])=>{const o=n[n.length-1],u=o[0]+o[1];return i<=u?o[1]+=Math.max(0,a-(u-i)):n.push([i,a]),n},[e[0]]);let r=0;for(let n=0;n<t.length;++n)t[n][0]-=r,r+=t[n][1];return t}function ha(s){if(s.length<=1)return s;const e=[...s].sort(([n],[i])=>n-i),t=e.reduce((n,[i,a])=>{const o=n[n.length-1];return i===o[0]?o[1]=Math.max(o[1],a):n.push([i,a]),n},[e[0]]);let r=0;for(let n=0;n<t.length;++n)t[n][0]+=r,r+=t[n][1];return t}function da(s){return Number.isInteger(s)&&s>0}function NT(s,e,t){return s.row===0&&da(e)&&t===Number.POSITIVE_INFINITY||s.col===0&&da(t)&&e===Number.POSITIVE_INFINITY}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Xe{}class TT extends Xe{constructor(e,t){super(),this.command=e,this.rowsRemovals=t}doUndo(e){e.undoRemoveRows(this)}doRedo(e){e.redoRemoveRows(this)}}class vT extends Xe{constructor(e,t,r,n,i,a,o){super(),this.sourceLeftCorner=e,this.width=t,this.height=r,this.destinationLeftCorner=n,this.overwrittenCellsData=i,this.addedGlobalNamedExpressions=a,this.version=o}doUndo(e){e.undoMoveCells(this)}doRedo(e){e.redoMoveCells(this)}}class ST extends Xe{constructor(e){super(),this.command=e}doUndo(e){e.undoAddRows(this)}doRedo(e){e.redoAddRows(this)}}class AT extends Xe{constructor(e,t,r){super(),this.sheetId=e,this.rowMapping=t,this.oldContent=r}doUndo(e){e.undoSetRowOrder(this)}doRedo(e){e.redoSetRowOrder(this)}}class CT extends Xe{constructor(e,t,r){super(),this.sheetId=e,this.columnMapping=t,this.oldContent=r}doUndo(e){e.undoSetColumnOrder(this)}doRedo(e){e.redoSetColumnOrder(this)}}class wT extends Xe{constructor(e,t,r){super(),this.sheetId=e,this.oldSheetContent=t,this.newSheetContent=r}doUndo(e){e.undoSetSheetContent(this)}doRedo(e){e.redoSetSheetContent(this)}}class IT extends Xe{constructor(e,t,r,n,i){super(),this.sheet=e,this.startRow=t,this.numberOfRows=r,this.targetRow=n,this.version=i,this.undoStart=this.startRow<this.targetRow?this.targetRow-this.numberOfRows:this.targetRow,this.undoEnd=this.startRow>this.targetRow?this.startRow+this.numberOfRows:this.startRow}doUndo(e){e.undoMoveRows(this)}doRedo(e){e.redoMoveRows(this)}}class MT extends Xe{constructor(e,t,r,n,i){super(),this.sheet=e,this.startColumn=t,this.numberOfColumns=r,this.targetColumn=n,this.version=i,this.undoStart=this.startColumn<this.targetColumn?this.targetColumn-this.numberOfColumns:this.targetColumn,this.undoEnd=this.startColumn>this.targetColumn?this.startColumn+this.numberOfColumns:this.startColumn}doUndo(e){e.undoMoveColumns(this)}doRedo(e){e.redoMoveColumns(this)}}class OT extends Xe{constructor(e){super(),this.command=e}doUndo(e){e.undoAddColumns(this)}doRedo(e){e.redoAddColumns(this)}}class bT extends Xe{constructor(e,t){super(),this.command=e,this.columnsRemovals=t}doUndo(e){e.undoRemoveColumns(this)}doRedo(e){e.redoRemoveColumns(this)}}class xT extends Xe{constructor(e){super(),this.sheetName=e}doUndo(e){e.undoAddSheet(this)}doRedo(e){e.redoAddSheet(this)}}class _T extends Xe{constructor(e,t,r,n,i){super(),this.sheetName=e,this.sheetId=t,this.oldSheetContent=r,this.scopedNamedExpressions=n,this.version=i}doUndo(e){e.undoRemoveSheet(this)}doRedo(e){e.redoRemoveSheet(this)}}class LT extends Xe{constructor(e,t,r){super(),this.sheetId=e,this.oldName=t,this.newName=r}doUndo(e){e.undoRenameSheet(this)}doRedo(e){e.redoRenameSheet(this)}}class FT extends Xe{constructor(e,t){super(),this.sheetId=e,this.oldSheetContent=t}doUndo(e){e.undoClearSheet(this)}doRedo(e){e.redoClearSheet(this)}}class UT extends Xe{constructor(e){super(),this.cellContents=e}doUndo(e){e.undoSetCellContents(this)}doRedo(e){e.redoSetCellContents(this)}}class PT extends Xe{constructor(e,t,r,n){super(),this.targetLeftCorner=e,this.oldContent=t,this.newContent=r,this.addedGlobalNamedExpressions=n}doUndo(e){e.undoPaste(this)}doRedo(e){e.redoPaste(this)}}class DT extends Xe{constructor(e,t,r,n){super(),this.name=e,this.newContent=t,this.scope=r,this.options=n}doUndo(e){e.undoAddNamedExpression(this)}doRedo(e){e.redoAddNamedExpression(this)}}class VT extends Xe{constructor(e,t,r){super(),this.namedExpression=e,this.content=t,this.scope=r}doUndo(e){e.undoRemoveNamedExpression(this)}doRedo(e){e.redoRemoveNamedExpression(this)}}class BT extends Xe{constructor(e,t,r,n,i){super(),this.namedExpression=e,this.newContent=t,this.oldContent=r,this.scope=n,this.options=i}doUndo(e){e.undoChangeNamedExpression(this)}doRedo(e){e.redoChangeNamedExpression(this)}}class kT extends Xe{constructor(){super(...arguments),this.operations=[]}add(e){this.operations.push(e)}*reversedOperations(){for(let e=this.operations.length-1;e>=0;e--)yield this.operations[e]}doUndo(e){e.undoBatch(this)}doRedo(e){e.redoBatch(this)}}class GT{constructor(e,t){this.operations=t,this.oldData=new Map,this.undoStack=[],this.redoStack=[],this.undoLimit=e.undoLimit}saveOperation(e){this.batchUndoEntry!==void 0?this.batchUndoEntry.add(e):this.addUndoEntry(e)}beginBatchMode(){this.batchUndoEntry=new kT}commitBatchMode(){if(this.batchUndoEntry===void 0)throw Error("Batch mode wasn't started");this.addUndoEntry(this.batchUndoEntry),this.batchUndoEntry=void 0}storeDataForVersion(e,t,r){this.oldData.has(e)||this.oldData.set(e,[]),this.oldData.get(e).push([t,r])}clearRedoStack(){this.redoStack=[]}clearUndoStack(){this.undoStack=[]}isUndoStackEmpty(){return this.undoStack.length===0}isRedoStackEmpty(){return this.redoStack.length===0}undo(){const e=this.undoStack.pop();if(!e)throw Error("Attempted to undo without operation on stack");this.undoEntry(e),this.redoStack.push(e)}undoBatch(e){for(const t of e.reversedOperations())this.undoEntry(t)}undoRemoveRows(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},rowsRemovals:r}=e;for(let n=r.length-1;n>=0;--n){const i=r[n];this.operations.addRows(new kd(t,[[i.rowFrom,i.rowCount]]));for(const{address:a,cellType:o}of i.removedCells)this.operations.restoreCell(a,o);this.restoreOldDataFromVersion(i.version-1)}}undoRemoveColumns(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},columnsRemovals:r}=e;for(let n=r.length-1;n>=0;--n){const i=r[n];this.operations.addColumns(new Gd(t,[[i.columnFrom,i.columnCount]]));for(const{address:a,cellType:o}of i.removedCells)this.operations.restoreCell(a,o);this.restoreOldDataFromVersion(i.version-1)}}undoAddRows(e){const t=e.command.rowsSpans();for(let r=t.length-1;r>=0;--r){const n=t[r];this.operations.removeRows(new Bd(e.command.sheet,[[n.rowStart,n.numberOfRows]]))}}undoAddColumns(e){const t=e.command.columnsSpans();for(let r=t.length-1;r>=0;--r){const n=t[r];this.operations.removeColumns(new Hd(e.command.sheet,[[n.columnStart,n.numberOfColumns]]))}}undoSetCellContents(e){for(const t of e.cellContents){const r=t.address,[n,i]=t.oldContent;$s(r,n)||this.operations.setCellEmpty(r),this.operations.restoreCell(n,i)}}undoPaste(e){this.restoreOperationOldContent(e.oldContent);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoMoveRows(e){const{sheet:t}=e;this.operations.moveRows(t,e.undoStart,e.numberOfRows,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveColumns(e){const{sheet:t}=e;this.operations.moveColumns(t,e.undoStart,e.numberOfColumns,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveCells(e){this.operations.forceApplyPostponedTransformations(),this.operations.moveCells(e.destinationLeftCorner,e.width,e.height,e.sourceLeftCorner),this.restoreOperationOldContent(e.overwrittenCellsData),this.restoreOldDataFromVersion(e.version-1);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoAddSheet(e){const{sheetName:t}=e;this.operations.removeSheetByName(t)}undoRemoveSheet(e){this.operations.forceApplyPostponedTransformations();const{oldSheetContent:t,sheetId:r}=e;this.operations.addSheet(e.sheetName);for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=U(r,a,n);this.operations.restoreCell(u,o)}}for(const[n,i]of e.scopedNamedExpressions)this.operations.restoreNamedExpression(n,i,r);this.restoreOldDataFromVersion(e.version-1)}undoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.oldName)}undoClearSheet(e){const{oldSheetContent:t,sheetId:r}=e;for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=U(r,a,n);this.operations.restoreCell(u,o)}}}undoSetSheetContent(e){const{oldSheetContent:t,sheetId:r}=e;this.operations.clearSheet(r);for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++){const o=i[a],u=U(r,a,n);this.operations.restoreCell(u,o)}}}undoAddNamedExpression(e){this.operations.removeNamedExpression(e.name,e.scope)}undoRemoveNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.content,e.scope)}undoChangeNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.oldContent,e.scope)}undoSetRowOrder(e){this.restoreOperationOldContent(e.oldContent)}undoSetColumnOrder(e){this.restoreOperationOldContent(e.oldContent)}redo(){const e=this.redoStack.pop();if(!e)throw Error("Attempted to redo without operation on stack");this.redoEntry(e),this.undoStack.push(e)}redoBatch(e){for(const t of e.operations)this.redoEntry(t)}redoRemoveRows(e){this.operations.removeRows(e.command)}redoMoveCells(e){this.operations.moveCells(e.sourceLeftCorner,e.width,e.height,e.destinationLeftCorner)}redoRemoveColumns(e){this.operations.removeColumns(e.command)}redoPaste(e){const{targetLeftCorner:t,newContent:r}=e,n=r.length,i=r[0].length;for(let a=0;a<n;++a)for(let o=0;o<i;++o){const u=U(t.sheet,t.col+o,t.row+a);this.operations.restoreCell(u,r[a][o])}}redoSetCellContents(e){for(const t of e.cellContents)this.operations.setCellContent(t.address,t.newContent)}redoAddRows(e){this.operations.addRows(e.command)}redoAddColumns(e){this.operations.addColumns(e.command)}redoRemoveSheet(e){this.operations.removeSheetByName(e.sheetName)}redoAddSheet(e){this.operations.addSheet(e.sheetName)}redoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.newName)}redoMoveRows(e){this.operations.moveRows(e.sheet,e.startRow,e.numberOfRows,e.targetRow)}redoMoveColumns(e){this.operations.moveColumns(e.sheet,e.startColumn,e.numberOfColumns,e.targetColumn)}redoClearSheet(e){this.operations.clearSheet(e.sheetId)}redoSetSheetContent(e){const{sheetId:t,newSheetContent:r}=e;this.operations.setSheetContent(t,r)}redoAddNamedExpression(e){this.operations.addNamedExpression(e.name,e.newContent,e.scope,e.options)}redoRemoveNamedExpression(e){this.operations.removeNamedExpression(e.namedExpression.displayName,e.scope)}redoChangeNamedExpression(e){this.operations.changeNamedExpressionExpression(e.namedExpression.displayName,e.newContent,e.scope,e.options)}redoSetRowOrder(e){this.operations.setRowOrder(e.sheetId,e.rowMapping)}redoSetColumnOrder(e){this.operations.setColumnOrder(e.sheetId,e.columnMapping)}addUndoEntry(e){this.undoStack.push(e),this.undoStack.splice(0,Math.max(0,this.undoStack.length-this.undoLimit))}undoEntry(e){e.doUndo(this)}restoreOperationOldContent(e){for(const[t,r]of e)this.operations.restoreCell(t,r)}redoEntry(e){e.doRedo(this)}restoreOldDataFromVersion(e){const t=this.oldData.get(e)||[];for(const r of t){const[n,i]=r;this.operations.setFormulaToCellFromCache(i,n)}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class HT{constructor(e,t,r,n,i,a,o,u,l,c){this.operations=t,this.undoRedo=r,this.clipboardOperations=n,this.dependencyGraph=i,this.columnSearch=a,this.parser=o,this.cellContentParser=u,this.lazilyTransformingAstService=l,this.namedExpressions=c,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}get sheetMapping(){return this.dependencyGraph.sheetMapping}addRows(e,...t){const r=new kd(e,t);this.ensureItIsPossibleToAddRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(r),this.undoRedo.saveOperation(new ST(r))}removeRows(e,...t){const r=new Bd(e,t);this.ensureItIsPossibleToRemoveRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.removeRows(r);this.undoRedo.saveOperation(new TT(r,n))}addColumns(e,...t){const r=new Gd(e,t);this.ensureItIsPossibleToAddColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(r),this.undoRedo.saveOperation(new OT(r))}removeColumns(e,...t){const r=new Hd(e,t);this.ensureItIsPossibleToRemoveColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.removeColumns(r);this.undoRedo.saveOperation(new bT(r,n))}moveCells(e,t,r,n){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const{version:i,overwrittenCellsData:a,addedGlobalNamedExpressions:o}=this.operations.moveCells(e,t,r,n);this.undoRedo.saveOperation(new vT(e,t,r,n,a,o,i))}moveRows(e,t,r,n){this.ensureItIsPossibleToMoveRows(e,t,r,n),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const i=this.operations.moveRows(e,t,r,n);this.undoRedo.saveOperation(new IT(e,t,r,n,i))}moveColumns(e,t,r,n){this.ensureItIsPossibleToMoveColumns(e,t,r,n),this.undoRedo.clearRedoStack();const i=this.operations.moveColumns(e,t,r,n);this.undoRedo.saveOperation(new MT(e,t,r,n,i))}cut(e,t,r){this.clipboardOperations.cut(e,t,r)}ensureItIsPossibleToCopy(e,t,r){if(!Ln(t))throw new $e("width to be positive integer.");if(!Ln(r))throw new $e("height to be positive integer.")}copy(e,t,r){this.ensureItIsPossibleToCopy(e,t,r),this.clipboardOperations.copy(e,t,r)}paste(e){const t=this.clipboardOperations.clipboard;if(t===void 0)throw new gd;if(this.clipboardOperations.isCutClipboard())this.moveCells(t.sourceLeftCorner,t.width,t.height,e);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(e);const r=W.spanFrom(e,t.width,t.height),n=this.operations.getRangeClipboardCells(r);this.undoRedo.clearRedoStack();const i=this.operations.restoreClipboardCells(t.sourceLeftCorner.sheet,t.getContent(e));this.undoRedo.saveOperation(new PT(e,n,t.content,i))}}beginUndoRedoBatchMode(){this.undoRedo.beginBatchMode()}commitUndoRedoBatchMode(){this.undoRedo.commitBatchMode()}isClipboardEmpty(){return this.clipboardOperations.clipboard===void 0}clearClipboard(){this.clipboardOperations.clear()}addSheet(e){e!==void 0&&this.ensureItIsPossibleToAddSheet(e),this.undoRedo.clearRedoStack();const t=this.operations.addSheet(e);return this.undoRedo.saveOperation(new xT(t)),t}removeSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.sheetMapping.fetchDisplayName(e),r=this.operations.getSheetClipboardCells(e),{version:n,scopedNamedExpressions:i}=this.operations.removeSheet(e);this.undoRedo.saveOperation(new _T(t,e,r,i,n))}renameSheet(e,t){this.ensureItIsPossibleToRenameSheet(e,t);const r=this.operations.renameSheet(e,t);return r!==void 0&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new LT(e,r,t))),r}clearSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.operations.getSheetClipboardCells(e);this.operations.clearSheet(e),this.undoRedo.saveOperation(new FT(e,t))}setCellContents(e,t){if(!(t instanceof Array))t=[[t]];else for(let n=0;n<t.length;n++)if(!(t[n]instanceof Array))throw new $e("an array of arrays or a raw cell value.");this.ensureItIsPossibleToChangeCellContents(e,t),this.undoRedo.clearRedoStack();const r=[];for(let n=0;n<t.length;n++)for(let i=0;i<t[n].length;i++){const a={sheet:e.sheet,row:e.row+n,col:e.col+i},o=t[n][i];this.clipboardOperations.abortCut();const u=this.operations.setCellContent(a,o);r.push({address:a,newContent:o,oldContent:u})}this.undoRedo.saveOperation(new UT(r))}setSheetContent(e,t){this.ensureScopeIdIsValid(e),this.ensureItIsPossibleToChangeSheetContents(e,t),Vd(t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.getSheetClipboardCells(e);this.operations.setSheetContent(e,t),this.undoRedo.saveOperation(new wT(e,r,t))}setRowOrder(e,t){this.validateSwapRowIndexes(e,t),this.testRowOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setRowOrder(e,t);this.undoRedo.saveOperation(new AT(e,t,r))}validateSwapRowIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new Le(e);this.validateRowOrColumnMapping(e,t,"row")}testColumnOrderForArrays(e,t){for(const[r,n]of t)if(r!==n){const i=W.spanFrom({sheet:e,col:r,row:0},1,1/0);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new Wn}}setColumnOrder(e,t){this.validateSwapColumnIndexes(e,t),this.testColumnOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setColumnOrder(e,t);this.undoRedo.saveOperation(new CT(e,t,r))}validateSwapColumnIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new Le(e);this.validateRowOrColumnMapping(e,t,"column")}testRowOrderForArrays(e,t){for(const[r,n]of t)if(r!==n){const i=W.spanFrom({sheet:e,col:0,row:r},1/0,1);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new Wn}}mappingFromOrder(e,t,r){if(!this.sheetMapping.hasSheetWithId(e))throw new Le(e);const n=r==="row"?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e);if(t.length!==n)throw new $e(`number of ${r}s provided to be sheet ${r==="row"?"height":"width"}.`);const i=[];for(let a=0;a<n;a++)t[a]!==a&&i.push([a,t[a]]);return i}undo(){if(this.undoRedo.isUndoStackEmpty())throw new pd;this.clipboardOperations.abortCut(),this.undoRedo.undo()}redo(){if(this.undoRedo.isRedoStackEmpty())throw new md;this.clipboardOperations.abortCut(),this.undoRedo.redo()}addNamedExpression(e,t,r,n){this.ensureItIsPossibleToAddNamedExpression(e,t,r),this.operations.addNamedExpression(e,t,r,n),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new DT(e,t,r,n))}changeNamedExpressionExpression(e,t,r,n){this.ensureItIsPossibleToChangeNamedExpression(e,r,t);const[i,a]=this.operations.changeNamedExpressionExpression(e,r,t,n);this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new BT(i,r,a,t,n))}removeNamedExpression(e,t){this.ensureScopeIdIsValid(t);const[r,n]=this.operations.removeNamedExpression(e,t);return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new VT(r,n,t)),r}ensureItIsPossibleToAddNamedExpression(e,t,r){this.ensureScopeIdIsValid(r),this.ensureNamedExpressionNameIsValid(e,r),this.ensureNamedExpressionIsValid(t)}ensureItIsPossibleToChangeNamedExpression(e,t,r){if(this.ensureScopeIdIsValid(r),this.namedExpressions.namedExpressionForScope(e,r)===void 0)throw new js(e);this.ensureNamedExpressionIsValid(t)}isItPossibleToRemoveNamedExpression(e,t){if(this.ensureScopeIdIsValid(t),this.namedExpressions.namedExpressionForScope(e,t)===void 0)throw new js(e)}ensureItIsPossibleToAddRows(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new Le(e);const r=this.dependencyGraph.getSheetHeight(e),n=t.map(i=>i[1]).reduce((i,a)=>i+a,0);if(r+n>this.maxRows)throw new Tn;for(const[i,a]of t)if(!hn(i)||!Ln(a))throw new $e("row number to be nonnegative and number of rows to add to be positive.")}ensureItIsPossibleToRemoveRows(e,...t){for(const[r,n]of t){const i=r+n-1;if(!hn(r)||!hn(i))throw new $e("starting and ending row to be nonnegative.");if(i<r)throw new $e("starting row to be smaller than the ending row.");if(!this.sheetMapping.hasSheetWithId(e))throw new Le(e)}}ensureItIsPossibleToAddColumns(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new Le(e);const r=this.dependencyGraph.getSheetWidth(e),n=t.map(i=>i[1]).reduce((i,a)=>i+a,0);if(r+n>this.maxColumns)throw new Tn;for(const[i,a]of t)if(!hn(i)||!Ln(a))throw new $e("column number to be nonnegative and number of columns to add to be positive.")}ensureItIsPossibleToRemoveColumns(e,...t){for(const[r,n]of t){const i=r+n-1;if(!hn(r)||!hn(i))throw new $e("starting and ending column to be nonnegative.");if(i<r)throw new $e("starting column to be smaller than the ending column.");if(!this.sheetMapping.hasSheetWithId(e))throw new Le(e)}}ensureItIsPossibleToMoveRows(e,t,r,n){this.ensureItIsPossibleToAddRows(e,[n,r]);const i=U(e,0,t),a=U(e,0,n);if(!this.sheetMapping.hasSheetWithId(e)||Ct(i)||Ct(a)||!Ln(r)||n<=t+r&&n>=t)throw new $e("a valid range of rows to move.");const o=this.dependencyGraph.getSheetWidth(e),u=W.spanFrom(i,o,r);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(u))throw new Wn;if(n>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllRows(wt.fromNumberOfRows(e,n-1,2)))throw new na}ensureItIsPossibleToMoveColumns(e,t,r,n){this.ensureItIsPossibleToAddColumns(e,[n,r]);const i=U(e,t,0),a=U(e,n,0);if(!this.sheetMapping.hasSheetWithId(e)||Ct(i)||Ct(a)||!Ln(r)||n<=t+r&&n>=t)throw new $e("a valid range of columns to move.");const o=this.dependencyGraph.getSheetHeight(e),u=W.spanFrom(i,r,o);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(u))throw new Wn;if(n>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllColumns(Vt.fromNumberOfColumns(e,n-1,2)))throw new na}ensureItIsPossibleToAddSheet(e){if(this.sheetMapping.hasSheetWithName(e))throw new Ws(e)}ensureItIsPossibleToRenameSheet(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new Le(e);const r=this.sheetMapping.get(t);if(r!==void 0&&r!==e)throw new Ws(t)}ensureItIsPossibleToChangeContent(e){if(Ct(e))throw new hd(e);if(!this.sheetMapping.hasSheetWithId(e.sheet))throw new Le(e.sheet)}ensureItIsPossibleToChangeCellContents(e,t){const r=la(t),n=W.spanFrom(e,r.width,r.height);this.ensureRangeInSizeLimits(n);for(const i of n.addresses(this.dependencyGraph))this.ensureItIsPossibleToChangeContent(i)}ensureItIsPossibleToChangeSheetContents(e,t){const r=la(t),n=W.spanFrom(U(e,0,0),r.width,r.height);this.ensureRangeInSizeLimits(n)}ensureRangeInSizeLimits(e){if(e.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new Tn}isThereSomethingToUndo(){return!this.undoRedo.isUndoStackEmpty()}isThereSomethingToRedo(){return!this.undoRedo.isRedoStackEmpty()}getAndClearContentChanges(){return this.operations.getAndClearContentChanges()}ensureScopeIdIsValid(e){if(e!==void 0&&!this.sheetMapping.hasSheetWithId(e))throw new Le(e)}validateRowOrColumnMapping(e,t,r){const n=r==="row"?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e),i=t.map(([o,u])=>o).sort((o,u)=>o-u),a=t.map(([o,u])=>u).sort((o,u)=>o-u);for(let o=0;o<i.length;o++){if(!hn(i[o])||i[o]>=n)throw new $e(`${r} numbers to be nonnegative integers and less than sheet ${r==="row"?"height":"width"}.`);if(i[o]===i[o+1])throw new $e(`source ${r} numbers to be unique.`);if(i[o]!==a[o])throw new $e(`target ${r} numbers to be permutation of source ${r} numbers.`)}}ensureNamedExpressionNameIsValid(e,t){if(!this.namedExpressions.isNameValid(e))throw new fd(e);if(!this.namedExpressions.isNameAvailable(e,t))throw new dd(e)}ensureNamedExpressionIsValid(e){const t=this.cellContentParser.parse(e);if(t instanceof be.Formula){const r=this.parser.parse(t.formula,U(-1,0,0));if(Kr(r.ast))throw new Ru}}}function Ln(s){return Number.isInteger(s)&&s>0}function hn(s){return Number.isInteger(s)&&s>=0}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class WT{constructor(e,t,r,n,i,a){this.config=e,this.stats=t,this.interpreter=r,this.lazilyTransformingAstService=n,this.dependencyGraph=i,this.columnSearch=a}run(){this.stats.start(K.TOP_SORT);const{sorted:e,cycled:t}=this.dependencyGraph.topSortWithScc();this.stats.end(K.TOP_SORT),this.stats.measure(K.EVALUATION,()=>{this.recomputeFormulas(t,e)})}partialRun(e){const t=tn.empty();return this.stats.measure(K.EVALUATION,()=>{this.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(e,r=>{if(r instanceof Bt){const n=r.isComputed()?r.getCellValue():void 0,i=this.recomputeFormulaVertexValue(r);if(i!==n){const a=r.getAddress(this.lazilyTransformingAstService);return t.addChange(i,a),this.columnSearch.change(F(n),F(i),a),!0}return!1}else return r instanceof pt&&r.clearCache(),!0},r=>{if(r instanceof pt)r.clearCache();else if(r instanceof Bt){const n=r.getAddress(this.lazilyTransformingAstService);this.columnSearch.remove(F(r.valueOrUndef()),n);const i=new g(R.CYCLE,void 0,r);r.setCellValue(i),t.addChange(i,n)}})}),t}runAndForget(e,t,r){const n=[];for(const a of vr(r,t))if(a instanceof W){const o=a;if(this.dependencyGraph.getRange(o.start,o.end)===void 0){const u=new pt(o);this.dependencyGraph.rangeMapping.setRange(u),n.push(u)}}const i=this.evaluateAstToCellValue(e,new Cr(t,this.config.useArrayArithmetic));return n.forEach(a=>{this.dependencyGraph.rangeMapping.removeRange(a)}),i}recomputeFormulas(e,t){e.forEach(r=>{r instanceof Bt&&r.setCellValue(new g(R.CYCLE,void 0,r))}),t.forEach(r=>{if(r instanceof Bt){const n=this.recomputeFormulaVertexValue(r),i=r.getAddress(this.lazilyTransformingAstService);this.columnSearch.add(F(n),i)}else r instanceof pt&&r.clearCache()})}recomputeFormulaVertexValue(e){const t=e.getAddress(this.lazilyTransformingAstService);if(e instanceof ze&&(e.array.size.isRef||!this.dependencyGraph.isThereSpaceForArray(e)))return e.setNoSpace();{const r=e.getFormula(this.lazilyTransformingAstService),n=this.evaluateAstToCellValue(r,new Cr(t,this.config.useArrayArithmetic,e));return e.setCellValue(n)}}evaluateAstToCellValue(e,t){const r=this.interpreter.evaluateAst(e,t);return r instanceof D?r:r===te&&this.config.evaluateNullToZero?0:r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Lo{constructor(e,t){this.address=e,this.newValue=t}get col(){return this.address.col}get row(){return this.address.row}get sheet(){return this.address.sheet}get value(){return this.newValue}}class Wd{constructor(e,t){this.name=e,this.newValue=t}}class zT{constructor(e,t,r,n){this.config=e,this.namedExpressions=t,this.sheetIndexMapping=r,this.lazilyTransformingService=n}exportChange(e){const t=e.value,r=e.address;if(r.sheet===wn.SHEET_FOR_WORKBOOK_EXPRESSIONS){const n=this.namedExpressions.namedExpressionInAddress(r.row);if(!n)throw new Error("Missing named expression");return new Wd(n.displayName,this.exportScalarOrRange(t))}else if(t instanceof D){const n=[];for(const[i,a]of t.entriesFromTopLeftCorner(r))n.push(new Lo(a,this.exportValue(i)));return n}else return new Lo(r,this.exportValue(t))}exportValue(e){return e instanceof D?this.detailedError(new g(R.VALUE,T.ScalarExpected)):this.config.smartRounding&&de(e)?this.cellValueRounding(F(e)):e instanceof g?this.detailedError(e):e===te?null:F(e)}exportScalarOrRange(e){return e instanceof D?e.rawData().map(t=>t.map(r=>this.exportValue(r))):this.exportValue(e)}detailedError(e){var t,r;let n;const i=(t=e.root)===null||t===void 0?void 0:t.getAddress(this.lazilyTransformingService);return i!==void 0&&(i.sheet===wn.SHEET_FOR_WORKBOOK_EXPRESSIONS?n=(r=this.namedExpressions.namedExpressionInAddress(i.row))===null||r===void 0?void 0:r.displayName:n=zi(this.sheetIndexMapping,i,-1)),new xd(e,this.config.translationPackage.getErrorTranslation(e.type),n)}cellValueRounding(e){if(e===0)return e;const t=Math.floor(Math.log10(Math.abs(e))),r=Math.pow(10,this.config.precisionRounding-t);return e<0?-Math.round(-e*r)/r:Math.round(e*r)/r}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class jT{constructor(e,t,r,n,i,a){this.dependencyGraph=e,this.columnSearch=t,this.parser=r,this.cellContentParser=n,this.stats=i,this.arraySizePredictor=a,this.buildStrategy=new YT(e,t,r,i,n,a)}buildGraph(e,t){const r=t.measure(K.COLLECT_DEPENDENCIES,()=>this.buildStrategy.run(e));this.dependencyGraph.getAndClearContentChanges(),t.measure(K.PROCESS_DEPENDENCIES,()=>this.processDependencies(r))}processDependencies(e){e.forEach((t,r)=>{this.dependencyGraph.processCellDependencies(t,r)})}}class YT{constructor(e,t,r,n,i,a){this.dependencyGraph=e,this.columnIndex=t,this.parser=r,this.stats=n,this.cellContentParser=i,this.arraySizePredictor=a}run(e){const t=new Map;for(const r in e){const n=this.dependencyGraph.getSheetId(r),i=e[r];for(let a=0;a<i.length;++a){const o=i[a];for(let u=0;u<o.length;++u){const l=o[u],c=U(n,u,a),d=this.cellContentParser.parse(l);if(d instanceof be.Formula){const f=this.stats.measure(K.PARSER,()=>this.parser.parse(d.formula,c));if(f.errors.length>0){this.shrinkArrayIfNeeded(c);const p=new $n(f.errors,d.formula);this.dependencyGraph.addVertex(c,p)}else{this.shrinkArrayIfNeeded(c);const p=this.arraySizePredictor.checkArraySize(f.ast,c);if(p.isScalar()){const E=new Sr(f.ast,c,0);t.set(E,vr(f.dependencies,c)),this.dependencyGraph.addVertex(c,E),f.hasVolatileFunction&&this.dependencyGraph.markAsVolatile(E),f.hasStructuralChangeFunction&&this.dependencyGraph.markAsDependentOnStructureChange(E)}else{const E=new ze(f.ast,c,new Z(p.width,p.height));t.set(E,vr(f.dependencies,c)),this.dependencyGraph.addArrayVertex(c,E)}}}else if(!(d instanceof be.Empty)){this.shrinkArrayIfNeeded(c);const f=new rn(d.value,l);this.columnIndex.add(F(d.value),c),this.dependencyGraph.addVertex(c,f)}}}}return t}shrinkArrayIfNeeded(e){const t=this.dependencyGraph.getCell(e);t instanceof ze&&this.dependencyGraph.shrinkArrayToCorner(t)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const gi=new Map([["gpl-v3",1],["missing",2],["invalid",3],["expired",4]]);class zd extends Q{version(e,t){return this.runFunction(e.args,t,this.metadata("VERSION"),()=>{const{licenseKeyValidityState:r,licenseKey:n}=this.config;let i;return gi.has(n)?i=gi.get(n):gi.has(r)?i=gi.get(r):r==="valid"&&(i=n.slice(-5)),`HyperFormula v${it.version}, ${i}`})}}zd.implementedFunctions={VERSION:{method:"version",parameters:[]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Qa(s,e){var t;let r=e.implementedFunctions[s];const n=(t=e.aliases)===null||t===void 0?void 0:t[s];if(n!==void 0){if(r!==void 0)throw new Zy(s,e.name);r=e.implementedFunctions[n]}if(r===void 0)throw es.functionNotDeclaredInPlugin(s,e.name);return r}class Ke{constructor(e){if(this.config=e,this.functions=new Map,this.arraySizeFunctions=new Map,this.volatileFunctions=new Set,this.arrayFunctions=new Set,this.structuralChangeFunctions=new Set,this.functionsWhichDoesNotNeedArgumentsToBeComputed=new Set,this.functionsMetadata=new Map,this.doesFunctionNeedArgumentToBeComputed=t=>this.functionsWhichDoesNotNeedArgumentsToBeComputed.has(t),this.isFunctionVolatile=t=>this.volatileFunctions.has(t),this.isArrayFunction=t=>this.arrayFunctions.has(t),this.isFunctionDependentOnSheetStructureChange=t=>this.structuralChangeFunctions.has(t),e.functionPlugins.length>0){this.instancePlugins=new Map;for(const t of e.functionPlugins)Ke.loadPluginFunctions(t,this.instancePlugins)}else this.instancePlugins=new Map(Ke.plugins);for(const[t,r]of Ke.protectedFunctions())Ke.loadFunctionUnprotected(r,t,this.instancePlugins);for(const[t,r]of this.instancePlugins.entries())this.categorizeFunction(t,Qa(t,r))}static registerFunctionPlugin(e,t){this.loadPluginFunctions(e,this.plugins),t!==void 0&&this.loadTranslations(t)}static registerFunction(e,t,r){this.loadPluginFunction(t,e,this.plugins),r!==void 0&&this.loadTranslations(r)}static unregisterFunction(e){if(this.functionIsProtected(e))throw vn.cannotUnregisterFunctionWithId(e);this.plugins.delete(e)}static unregisterFunctionPlugin(e){for(const t of this.protectedPlugins())if(t===e)throw vn.cannotUnregisterProtectedPlugin();for(const[t,r]of this.plugins.entries())r===e&&this.plugins.delete(t)}static unregisterAll(){this.plugins.clear()}static getRegisteredFunctionIds(){return[...Array.from(this.plugins.keys()),...Array.from(this._protectedPlugins.keys())]}static getPlugins(){return Array.from(new Set(this.plugins.values()).values())}static getFunctionPlugin(e){if(!this.functionIsProtected(e))return this.plugins.get(e)}static functionIsProtected(e){return this._protectedPlugins.has(e)}static loadTranslations(e){const t=new Set(it.getRegisteredLanguagesCodes());Object.keys(e).forEach(r=>{t.has(r)&&it.getLanguage(r).extendFunctions(e[r])})}static loadPluginFunctions(e,t){Object.keys(e.implementedFunctions).forEach(r=>{this.loadPluginFunction(e,r,t)}),e.aliases!==void 0&&Object.keys(e.aliases).forEach(r=>{this.loadPluginFunction(e,r,t)})}static loadPluginFunction(e,t,r){if(this.functionIsProtected(t))throw vn.cannotRegisterFunctionWithId(t);this.loadFunctionUnprotected(e,t,r)}static handleDeprecatedMetadata(e,t){t&&t.arrayFunction!==void 0&&(console.warn(`${e}: 'arrayFunction' parameter is deprecated since 3.1.0; Use 'enableArrayArithmeticForArguments' instead.`),t.enableArrayArithmeticForArguments=t.arrayFunction),t&&t.arraySizeMethod!==void 0&&(console.warn(`${e}: 'arraySizeMethod' parameter is deprecated since 3.1.0; Use 'sizeOfResultArrayMethod' instead.`),t.sizeOfResultArrayMethod=t.arraySizeMethod)}static loadFunctionUnprotected(e,t,r){const n=Qa(t,e),i=n.method;if(this.handleDeprecatedMetadata(t,n),Object.prototype.hasOwnProperty.call(e.prototype,i))r.set(t,e);else throw es.functionMethodNotFound(i,e.name)}static*protectedFunctions(){for(const[e,t]of this._protectedPlugins)t!==void 0&&(yield[e,t])}static*protectedPlugins(){for(const[,e]of this._protectedPlugins)e!==void 0&&(yield e)}initializePlugins(e){const t=[];for(const[r,n]of this.instancePlugins.entries()){let i=t.find(l=>l instanceof n);i===void 0&&(i=new n(e),t.push(i));const a=Qa(r,n),o=a.method;this.functions.set(r,[o,i]);const u=a.sizeOfResultArrayMethod;u!==void 0&&this.arraySizeFunctions.set(r,[u,i])}}getFunctionPlugin(e){if(!Ke.functionIsProtected(e))return this.instancePlugins.get(e)}getFunction(e){const t=this.functions.get(e);if(t!==void 0&&this.config.translationPackage.isFunctionTranslated(e)){const[r,n]=t;return(i,a)=>n[r](i,a)}else return}getArraySizeFunction(e){const t=this.arraySizeFunctions.get(e);if(t!==void 0&&this.config.translationPackage.isFunctionTranslated(e)){const[r,n]=t;return(i,a)=>n[r](i,a)}else return}getMetadata(e){return this.functionsMetadata.get(e)}getPlugins(){const e=new Set;for(const[t,r]of this.instancePlugins)Ke.functionIsProtected(t)||e.add(r);return Array.from(e)}getRegisteredFunctionIds(){return Array.from(this.functions.keys())}categorizeFunction(e,t){t.isVolatile&&this.volatileFunctions.add(e),t.enableArrayArithmeticForArguments&&this.arrayFunctions.add(e),t.doesNotNeedArgumentsToBeComputed&&this.functionsWhichDoesNotNeedArgumentsToBeComputed.add(e),t.isDependentOnSheetStructureChange&&this.structuralChangeFunctions.add(e),this.functionsMetadata.set(e,t)}}Ke.plugins=new Map;Ke._protectedPlugins=new Map([["VERSION",zd],["OFFSET",void 0]]);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var rt;(function(s){s.GREATER_THAN="GREATER_THAN",s.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",s.LESS_THAN="LESS_THAN",s.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",s.NOT_EQUAL="NOT_EQUAL",s.EQUAL="EQUAL"})(rt||(rt={}));const Ei=(s,e)=>({operator:s,value:e});class $T{constructor(e){var t,r,n,i;this.trueString=(r=(t=e.translationPackage.getMaybeFunctionTranslation("TRUE"))===null||t===void 0?void 0:t.toLowerCase())!==null&&r!==void 0?r:"true",this.falseString=(i=(n=e.translationPackage.getMaybeFunctionTranslation("FALSE"))===null||n===void 0?void 0:n.toLowerCase())!==null&&i!==void 0?i:"false"}fromCellValue(e,t){if(typeof e!="string"&&typeof e!="boolean"&&typeof e!="number")return;const r=this.parseCriterion(e,t);if(r!==void 0)return{raw:e,lambda:qT(r,t)}}parseCriterion(e,t){if(typeof e=="number"||typeof e=="boolean")return Ei(rt.EQUAL,e);if(typeof e=="string"){const r=XT.exec(e);let n,i;r?(i=KT(r[1]),n=r[2]):(i=rt.EQUAL,n=e);const a=t.coerceToMaybeNumber(n),o=n.toLowerCase()===this.trueString?!0:n.toLowerCase()===this.falseString?!1:void 0;if(i===void 0)return;if(n==="")return Ei(i,null);if(a===void 0){if(i===rt.EQUAL||i===rt.NOT_EQUAL)return Ei(i,o??n)}else return Ei(i,F(a))}}}const XT=/([<>=]+)(.*)/;function KT(s){switch(s){case">":return rt.GREATER_THAN;case">=":return rt.GREATER_THAN_OR_EQUAL;case"<":return rt.LESS_THAN;case"<=":return rt.LESS_THAN_OR_EQUAL;case"<>":return rt.NOT_EQUAL;case"=":return rt.EQUAL;default:return}}const qT=(s,e)=>{switch(s.operator){case rt.GREATER_THAN:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)>0:t=>!1;case rt.GREATER_THAN_OR_EQUAL:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)>=0:t=>!1;case rt.LESS_THAN:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)<0:t=>!1;case rt.LESS_THAN_OR_EQUAL:return typeof s.value=="number"?t=>typeof t=="number"&&e.floatCmp(t,s.value)<=0:t=>!1;case rt.EQUAL:return typeof s.value=="number"?t=>{if(typeof t=="number")return e.floatCmp(t,s.value)===0;if(typeof t=="string"){if(t==="")return!1;const r=e.coerceToMaybeNumber(t);return r===void 0?!1:e.floatCmp(r,s.value)===0}else return!1}:typeof s.value=="string"?e.eqMatcherFunction(s.value):typeof s.value=="boolean"?t=>typeof t=="boolean"&&t===s.value:t=>t===te;case rt.NOT_EQUAL:return typeof s.value=="number"?t=>{if(typeof t=="number")return e.floatCmp(t,s.value)!==0;if(typeof t=="string"){if(t==="")return!0;const r=e.coerceToMaybeNumber(t);return r===void 0?!0:e.floatCmp(r,s.value)!==0}else return!0}:typeof s.value=="string"?e.neqMatcherFunction(s.value):typeof s.value=="boolean"?t=>typeof t!="boolean"||t!==s.value:t=>t!==te}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class QT{constructor(e,t,r,n,i,a,o,u,l,c){this.config=e,this.dependencyGraph=t,this.columnSearch=r,this.stats=n,this.arithmeticHelper=i,this.functionRegistry=a,this.namedExpressions=o,this.serialization=u,this.arraySizePredictor=l,this.dateTimeHelper=c,this.equalOp=(d,f)=>$t(this.arithmeticHelper.eq,d,f),this.notEqualOp=(d,f)=>$t(this.arithmeticHelper.neq,d,f),this.greaterThanOp=(d,f)=>$t(this.arithmeticHelper.gt,d,f),this.lessThanOp=(d,f)=>$t(this.arithmeticHelper.lt,d,f),this.greaterThanOrEqualOp=(d,f)=>$t(this.arithmeticHelper.geq,d,f),this.lessThanOrEqualOp=(d,f)=>$t(this.arithmeticHelper.leq,d,f),this.concatOp=(d,f)=>$t(this.arithmeticHelper.concat,wo(d),wo(f)),this.plusOp=(d,f)=>$t(this.arithmeticHelper.addWithEpsilon,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.minusOp=(d,f)=>$t(this.arithmeticHelper.subtract,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.timesOp=(d,f)=>$t(this.arithmeticHelper.multiply,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.powerOp=(d,f)=>$t(this.arithmeticHelper.pow,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.divOp=(d,f)=>$t(this.arithmeticHelper.divide,this.arithmeticHelper.coerceScalarToNumberOrError(d),this.arithmeticHelper.coerceScalarToNumberOrError(f)),this.unaryMinusOp=d=>Yl(this.arithmeticHelper.unaryMinus,this.arithmeticHelper.coerceScalarToNumberOrError(d)),this.percentOp=d=>Yl(this.arithmeticHelper.unaryPercent,this.arithmeticHelper.coerceScalarToNumberOrError(d)),this.unaryPlusOp=d=>this.arithmeticHelper.unaryPlus(d),this.functionRegistry.initializePlugins(this),this.criterionBuilder=new $T(e)}evaluateAst(e,t){let r=this.evaluateAstWithoutPostprocessing(e,t);if(de(r)){if(Md(F(r)))return new g(R.NUM,T.NaN);r=pu(r,Od(F(r)))}return r instanceof D&&r.height()===1&&r.width()===1&&([[r]]=r.data),ZT(r,t.formulaVertex)}evaluateAstWithoutPostprocessing(e,t){switch(e.type){case y.EMPTY:return te;case y.CELL_REFERENCE:{const r=e.reference.toSimpleCellAddress(t.formulaAddress);return Ct(r)?new g(R.REF,T.BadRef):this.dependencyGraph.getCellValue(r)}case y.NUMBER:case y.STRING:return e.value;case y.CONCATENATE_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.concatOp,r,n,t)}case y.EQUALS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.equalOp,r,n,t)}case y.NOT_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.notEqualOp,r,n,t)}case y.GREATER_THAN_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOp,r,n,t)}case y.LESS_THAN_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOp,r,n,t)}case y.GREATER_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOrEqualOp,r,n,t)}case y.LESS_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOrEqualOp,r,n,t)}case y.PLUS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.plusOp,r,n,t)}case y.MINUS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.minusOp,r,n,t)}case y.TIMES_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.timesOp,r,n,t)}case y.POWER_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.powerOp,r,n,t)}case y.DIV_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.divOp,r,n,t)}case y.PLUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryPlusOp,r,t)}case y.MINUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryMinusOp,r,t)}case y.PERCENT_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.percentOp,r,t)}case y.FUNCTION_CALL:{if(this.config.licenseKeyValidityState!=="valid"&&!Ke.functionIsProtected(e.procedureName))return new g(R.LIC,T.LicenseKey(this.config.licenseKeyValidityState));const r=this.functionRegistry.getFunction(e.procedureName);return r!==void 0?r(e,new Cr(t.formulaAddress,t.arraysFlag||this.functionRegistry.isArrayFunction(e.procedureName),t.formulaVertex)):new g(R.NAME,T.FunctionName(e.procedureName))}case y.NAMED_EXPRESSION:{const r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.formulaAddress.sheet);return r?this.dependencyGraph.getCellValue(r.address):new g(R.NAME,T.NamedExpressionName(e.expressionName))}case y.CELL_RANGE:{if(!this.rangeSpansOneSheet(e))return new g(R.REF,T.RangeManySheets);const r=W.fromCellRange(e,t.formulaAddress),n=this.dependencyGraph.getArray(r);if(n){const i=n.array;if(i instanceof Ss)throw new Error("Array should be already computed");if(i instanceof g)return i;if(i instanceof ts)return D.fromRange(i.raw(),r,this.dependencyGraph);throw new Error("Unknown array")}else return D.onlyRange(r,this.dependencyGraph)}case y.COLUMN_RANGE:{if(!this.rangeSpansOneSheet(e))return new g(R.REF,T.RangeManySheets);const r=Dr.fromColumnRange(e,t.formulaAddress);return D.onlyRange(r,this.dependencyGraph)}case y.ROW_RANGE:{if(!this.rangeSpansOneSheet(e))return new g(R.REF,T.RangeManySheets);const r=Vr.fromRowRangeAst(e,t.formulaAddress);return D.onlyRange(r,this.dependencyGraph)}case y.PARENTHESIS:return this.evaluateAst(e.expression,t);case y.ARRAY:{let r;const n=[];for(const i of e.args){let a;const o=[];for(const l of i){const c=wd(this.evaluateAst(l,t)),d=c.height();if(a===void 0)a=d,o.push(...c.data);else if(a===d)for(let f=0;f<d;f++)o[f].push(...c.data[f]);else return new g(R.REF,T.SizeMismatch)}const u=o[0].length;if(r===void 0)r=u,n.push(...o);else if(r===u)n.push(...o);else return new g(R.REF,T.SizeMismatch)}return D.onlyValues(n)}case y.ERROR_WITH_RAW_INPUT:case y.ERROR:return e.error}}rangeSpansOneSheet(e){return e.start.sheet===e.end.sheet}unaryRangeWrapper(e,t,r){var n;if(t instanceof D&&!r.arraysFlag&&(t=(n=Di(t,r))!==null&&n!==void 0?n:new g(R.VALUE,T.ScalarExpected)),t instanceof g)return t;if(t instanceof D){const i=t.data.map(a=>a.map(e));return D.onlyValues(i)}return e(t)}binaryRangeWrapper(e,t,r,n){var i,a;if(t instanceof D&&!n.arraysFlag&&(t=(i=Di(t,n))!==null&&i!==void 0?i:new g(R.VALUE,T.ScalarExpected)),t instanceof g)return t;if(r instanceof D&&!n.arraysFlag&&(r=(a=Di(r,n))!==null&&a!==void 0?a:new g(R.VALUE,T.ScalarExpected)),r instanceof g)return r;if(t instanceof D||r instanceof D){if(!(t instanceof D))if(r.isAdHoc()){const c=r.data;for(let d=0;d<c.length;d++)for(let f=0;f<c[0].length;f++)c[d][f]=e(t,c[d][f]);return D.onlyValues(c)}else t=D.fromScalar(t);if(!(r instanceof D))if(t.isAdHoc()){const c=t.data;for(let d=0;d<c.length;d++)for(let f=0;f<c[0].length;f++)c[d][f]=e(c[d][f],r);return D.onlyValues(c)}else r=D.fromScalar(r);if(t.width()===r.width()&&t.height()===r.height()){if(t.isAdHoc()){const c=t.data,d=r.data;for(let f=0;f<c.length;f++)for(let p=0;p<c[0].length;p++)c[f][p]=e(c[f][p],d[f][p]);return D.onlyValues(c)}if(r.isAdHoc()){const c=t.data,d=r.data;for(let f=0;f<c.length;f++)for(let p=0;p<c[0].length;p++)d[f][p]=e(c[f][p],d[f][p]);return D.onlyValues(d)}}const o=Math.max(t.width(),r.width()),u=Math.max(t.height(),r.height()),l=Array(u);for(let c=0;c<u;c++)l[c]=Array(o);for(let c=0;c<u;c++){const d=t.height()!==1?c:0,f=r.height()!==1?c:0;for(let p=0;p<o;p++){const E=t.width()!==1?p:0,m=r.width()!==1?p:0;d<t.height()&&f<r.height()&&E<t.width()&&m<r.width()?l[c][p]=e(t.data[d][E],r.data[f][m]):l[c][p]=new g(R.NA)}}return D.onlyValues(l)}return e(t,r)}}function Yl(s,e){return e instanceof g?e:s(e)}function $t(s,e,t){return e instanceof g?e:t instanceof g?t:s(e,t)}function ZT(s,e){return s instanceof g&&e!==void 0?s.attachRootVertex(e):s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class JT{constructor(e){this.sheet=e,this.transformations=[]}add(e){this.transformations.push(e)}performEagerTransformations(e,t){this.transformations.forEach(r=>r.performEagerTransformations(e,t))}transformSingleAst(e,t){let[r,n]=[e,t];return this.transformations.forEach(i=>{[r,n]=i.transformSingleAst(r,n)}),[r,n]}isIrreversible(){return!0}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ev{constructor(e){this.stats=e,this.transformations=[]}version(){return this.transformations.length}addTransformation(e){return this.combinedTransformer!==void 0?this.combinedTransformer.add(e):this.transformations.push(e),this.version()}beginCombinedMode(e){this.combinedTransformer=new JT(e)}commitCombinedMode(){if(this.combinedTransformer===void 0)throw Error("Combined mode wasn't started");return this.transformations.push(this.combinedTransformer),this.combinedTransformer=void 0,this.version()}applyTransformations(e,t,r){this.stats.start(K.TRANSFORM_ASTS_POSTPONED);for(let i=r;i<this.transformations.length;i++){const a=this.transformations[i];a.isIrreversible()&&(this.undoRedo.storeDataForVersion(i,t,this.parser.computeHashFromAst(e)),this.parser.rememberNewAst(e));const[o,u]=a.transformSingleAst(e,t);e=o,t=u}const n=this.parser.rememberNewAst(e);return this.stats.end(K.TRANSFORM_ASTS_POSTPONED),[n,t,this.transformations.length]}*getTransformationsFrom(e,t){for(let r=e;r<this.transformations.length;r++){const n=this.transformations[r];(!t||t(n))&&(yield n)}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const yr=-1;function tv(s,e,{searchCoordinate:t,orderingDirection:r,ifNoMatch:n},i){const a=e.start[t],o=t==="col"?e.effectiveEndColumn(i):e.effectiveEndRow(i),u=t==="col"?f=>F(i.getCellValue(U(e.sheet,f,e.start.row))):f=>F(i.getCellValue(U(e.sheet,e.start.col,f))),l=r==="asc"?(f,p)=>fa(f,p):(f,p)=>-fa(f,p),c=rv(f=>l(s,u(f))>=0,a,o),d=u(c);if(d===s)return c-a;if(n==="returnLowerBound"){if(c===yr)return r==="asc"?yr:0;if(typeof d!=typeof s)return yr;if(r==="asc")return c-a;const f=c+1;return f<=o?f-a:yr}if(n==="returnUpperBound"){if(c===yr)return r==="asc"?0:yr;if(typeof d!=typeof s)return yr;if(r==="desc")return c-a;const f=c+1;return f<=o?f-a:yr}return yr}function rv(s,e,t){let r=e,n=t;for(;r<n;){const i=Math.ceil((r+n)/2);s(i)?r=i:n=i-1}return r===n&&s(r)?r:yr}function fa(s,e){return typeof s==typeof e?s===te?0:s<e?-1:s>e?1:0:s===te?-1:e===te?1:e instanceof g||typeof s=="number"&&typeof e=="string"||typeof s=="number"&&typeof e=="boolean"?-1:typeof s=="string"&&typeof e=="number"?1:typeof s=="string"&&typeof e=="boolean"?-1:1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const $l=-1;class jd{constructor(e){this.dependencyGraph=e}advancedFind(e,t,{returnOccurrence:r}={returnOccurrence:"first"}){const n=t.range,i=n===void 0?t.valuesFromTopLeftCorner():this.dependencyGraph.computeListOfValuesInRange(n),a=r==="first"?0:i.length-1,o=r==="first"?l=>l<i.length:l=>l>=0,u=r==="first"?l=>l+1:l=>l-1;for(let l=a;o(l);l=u(l))if(e(F(i[l])))return l;return $l}basicFind(e,t,r,{ordering:n,ifNoMatch:i,returnOccurrence:a}){const o=typeof e=="string"?Ls(e):e,u=t.range;return u===void 0?this.findNormalizedValue(o,t.valuesFromTopLeftCorner(),i,a):n==="none"?this.findNormalizedValue(o,this.dependencyGraph.computeListOfValuesInRange(u),i,a):tv(o,u,{searchCoordinate:r,orderingDirection:n,ifNoMatch:i},this.dependencyGraph)}findNormalizedValue(e,t,r="returnNotFound",n="first"){const i=t.map(F).map(f=>typeof f=="string"?Ls(f):f);if(r==="returnNotFound")return n==="first"?i.indexOf(e):i.lastIndexOf(e);const a=r==="returnLowerBound"?(f,p)=>fa(f,p):(f,p)=>-fa(f,p);let o=r==="returnLowerBound"?-1/0:1/0,u=$l;const l=n==="first"?0:i.length-1,c=n==="first"?f=>f<i.length:f=>f>=0,d=n==="first"?f=>f+1:f=>f-1;for(let f=l;c(f);f=d(f)){const p=i[f];if(p===e)return f;a(p,e)>0||a(o,p)<0&&(o=p,u=f)}return u}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Yd extends jd{constructor(e){super(e),this.dependencyGraph=e}add(e,t){}remove(e,t){}change(e,t,r){}applyChanges(e){}addColumns(e){}removeColumns(e){}removeSheet(e){}moveValues(e,t,r,n){}removeValues(e){}find(e,t,r){return this.basicFind(e,t,"row",r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class yn{constructor(e,t,r){this.dependencyGraph=e,this.config=t,this.stats=r,this.index=new Map,this.transformingService=this.dependencyGraph.lazilyTransformingAstService,this.binarySearchStrategy=new Yd(e)}add(e,t){if(!(e===te||e instanceof g))if(e instanceof D)for(const[r,n]of e.entriesFromTopLeftCorner(t))this.addSingleCellValue(F(r),n);else this.addSingleCellValue(e,t)}remove(e,t){if(e!==void 0)if(e instanceof D)for(const[r,n]of e.entriesFromTopLeftCorner(t))this.removeSingleValue(F(r),n);else this.removeSingleValue(e,t)}change(e,t,r){e!==t&&(this.remove(e,r),this.add(t,r))}applyChanges(e){for(const t of e)t.oldValue!==void 0&&this.change(F(t.oldValue),F(t.value),t.address)}moveValues(e,t,r,n){for(const[i,a]of e){const o=NN(a,n,t,r);this.remove(i,a),this.add(i,o)}}removeValues(e){for(const[t,r]of e)this.remove(t,r)}find(e,t,{ordering:r,ifNoMatch:n,returnOccurrence:i}){i==null&&(i=r==="none"?"first":"last");const a=this.findUsingColumnIndex(e,t,i);return a!==void 0?a:this.binarySearchStrategy.find(e,t,{ordering:r,ifNoMatch:n,returnOccurrence:i})}findUsingColumnIndex(e,t,r){const n=t.range;if(n===void 0)return;this.ensureRecentData(n.sheet,n.start.col,e);const i=this.getColumnMap(n.sheet,n.start.col);if(!i)return-1;const a=typeof e=="string"?Ls(e):e,o=i.get(a);if(!o||!o.index||o.index.length===0)return;const u=yn.findRowBelongingToRange(o,n,r);return u!==void 0?u-n.start.row:void 0}static findRowBelongingToRange(e,t,r){const n=t.start.row,i=t.end.row,a=r==="first"?dn(n,e.index,"upperBound"):dn(i,e.index,"lowerBound");if(a===-1)return;const o=e.index[a];return o>=n&&o<=i?o:void 0}advancedFind(e,t,r={returnOccurrence:"first"}){return this.binarySearchStrategy.advancedFind(e,t,r)}addColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,0,...Array(e.numberOfColumns))}removeColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,e.numberOfColumns)}removeSheet(e){this.index.delete(e)}getColumnMap(e,t){this.index.has(e)||this.index.set(e,[]);const r=this.index.get(e);let n=r[t];return n||(n=new Map,r[t]=n),n}getValueIndex(e,t,r){const n=this.getColumnMap(e,t);let i=this.getColumnMap(e,t).get(r);return i||(i={version:this.transformingService.version(),index:[]},n.set(r,i)),i}ensureRecentData(e,t,r){const n=this.getValueIndex(e,t,r),i=this.transformingService.version();if(n.version===i)return;const a=this.transformingService.getTransformationsFrom(n.version,o=>o.sheet===e&&(o instanceof xo||o instanceof _o));for(const o of a)o instanceof xo?this.addRows(t,o.rowsSpan,r):o instanceof _o&&this.removeRows(t,o.rowsSpan,r);n.version=i}addSingleCellValue(e,t){this.stats.measure(K.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e),typeof e=="string"&&(e=Ls(e));const r=this.getValueIndex(t.sheet,t.col,e);yn.addValue(r,t.row)})}removeSingleValue(e,t){this.stats.measure(K.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(t.sheet,t.col,e);const r=this.getColumnMap(t.sheet,t.col);typeof e=="string"&&(e=Ls(e));const n=r.get(e);if(!n)return;const i=dn(t.row,n.index);i>-1&&n.index.splice(i,1),n.index.length===0&&r.delete(e),r.size===0&&delete this.index.get(t.sheet)[t.col]})}addRows(e,t,r){const n=this.getValueIndex(t.sheet,e,r);yn.shiftRows(n,t.rowStart,t.numberOfRows)}removeRows(e,t,r){const n=this.getValueIndex(t.sheet,e,r);yn.removeRowsFromValues(n,t),yn.shiftRows(n,t.rowEnd+1,-t.numberOfRows)}static addValue(e,t){const r=dn(t,e.index,"lowerBound");e.index[r]===t||e.index.splice(r+1,0,t)}static removeRowsFromValues(e,t){const r=dn(t.rowStart,e.index,"upperBound"),n=dn(t.rowEnd,e.index,"lowerBound");r>-1&&n>-1&&r<=n&&e.index[r]<=t.rowEnd&&e.index.splice(r,n-r+1)}static shiftRows(e,t,r){const n=dn(t,e.index,"upperBound");if(n!==-1)for(let i=n;i<e.index.length;++i)e.index[i]+=r}}function dn(s,e,t="upperBound"){let r=0,n=e.length-1;for(;r<=n;){const o=Math.floor((r+n)/2);if(s>e[o])r=o+1;else if(s<e[o])n=o-1;else return o}const i=t==="lowerBound"?n:r;return i>=0&&i<=e.length?i:-1}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function nv(s,e,t){return e.useColumnIndex?new yn(s,e,t):new Yd(s)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class sv{constructor(e){this.config=e;const t=this.config.thousandSeparator==="."?`\\${this.config.thousandSeparator}`:this.config.thousandSeparator,r=this.config.decimalSeparator==="."?`\\${this.config.decimalSeparator}`:this.config.decimalSeparator;this.numberPattern=new RegExp(`^([+-]?((${r}\\d+)|(\\d+(${t}\\d{3,})*(${r}\\d*)?)))(e[+-]?\\d+)?$`),this.allThousandSeparatorsRegex=new RegExp(`${t}`,"g")}numericStringToMaybeNumber(e){if(this.numberPattern.test(e)){const t=this.numericStringToNumber(e);return isNaN(t)?void 0:t}}numericStringToNumber(e){const t=e.replace(this.allThousandSeparatorsRegex,"").replace(this.config.decimalSeparator,".");return Number(t)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Tu{constructor(e,t,r){this.dependencyGraph=e,this.unparser=t,this.exporter=r}getCellHyperlink(e){const t=this.dependencyGraph.getCell(e);if(t instanceof Sr){const r=t.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(r.procedureName==="HYPERLINK")return r.hyperlink}}getCellFormula(e,t){const r=this.dependencyGraph.getCell(e);if(r instanceof Sr){const n=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);return t=t??e,this.unparser.unparse(n,t)}else if(r instanceof ze){const n=r.getAddress(this.dependencyGraph.lazilyTransformingAstService);if(n.row!==e.row||n.col!==e.col||n.sheet!==e.sheet)return;t=t??e;const i=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(i!==void 0)return this.unparser.unparse(i,t)}else if(r instanceof $n)return r.getFormula()}getCellSerialized(e,t){var r;return(r=this.getCellFormula(e,t))!==null&&r!==void 0?r:this.getRawValue(e)}getCellValue(e){return this.exporter.exportValue(this.dependencyGraph.getScalarValue(e))}getRawValue(e){return this.dependencyGraph.getRawValue(e)}getSheetValues(e){return this.genericSheetGetter(e,t=>this.getCellValue(t))}getSheetFormulas(e){return this.genericSheetGetter(e,t=>this.getCellFormula(t))}genericSheetGetter(e,t){const r=this.dependencyGraph.getSheetHeight(e),n=this.dependencyGraph.getSheetWidth(e),i=new Array(r);for(let a=0;a<r;a++){i[a]=new Array(n);for(let o=0;o<n;o++){const u=U(e,o,a);i[a][o]=t(u)}for(let o=n-1;o>=0&&(i[a][o]===null||i[a][o]===void 0);o--)i[a].pop()}for(let a=r-1;a>=0&&i[a].length===0;a--)i.pop();return i}genericAllSheetsGetter(e){const t={};for(const r of this.dependencyGraph.sheetMapping.displayNames()){const n=this.dependencyGraph.sheetMapping.fetch(r);t[r]=e(n)}return t}getSheetSerialized(e){return this.genericSheetGetter(e,t=>this.getCellSerialized(t))}getAllSheetsValues(){return this.genericAllSheetsGetter(e=>this.getSheetValues(e))}getAllSheetsFormulas(){return this.genericAllSheetsGetter(e=>this.getSheetFormulas(e))}getAllSheetsSerialized(){return this.genericAllSheetsGetter(e=>this.getSheetSerialized(e))}getAllNamedExpressionsSerialized(){const e=[];let t=0;for(const r of this.dependencyGraph.sheetMapping.displayNames()){const n=this.dependencyGraph.sheetMapping.fetch(r);e[n]=t,t++}return this.dependencyGraph.namedExpressions.getAllNamedExpressions().map(r=>({name:r.expression.displayName,expression:this.getCellSerialized(r.expression.address),scope:r.scope!==void 0?e[r.scope]:void 0,options:r.expression.options}))}withNewConfig(e,t){const r=new ad(e,fu(e),this.dependencyGraph.sheetMapping.fetchDisplayName,t);return new Tu(this.dependencyGraph,r,this.exporter)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ri{static buildFromSheets(e,t={},r=[]){const n=new kt(t);return this.buildEngine(n,e,r)}static buildFromSheet(e,t={},r=[]){const n=new kt(t),i=n.translationPackage.getUITranslation(Ys.NEW_SHEET_PREFIX)+"1";return this.buildEngine(n,{[i]:e},r)}static buildEmpty(e={},t=[]){return this.buildEngine(new kt(e),{},t)}static rebuildWithConfig(e,t,r,n){return this.buildEngine(e,t,r,n)}static buildEngine(e,t={},r=[],n=e.useStats?new ld:new Ky){n.start(K.BUILD_ENGINE_TOTAL);const i=new wn,a=new Ke(e),o=new ev(n),u=yu.buildEmpty(o,e,a,i,n),l=nv(u,e,n),c=u.sheetMapping,d=u.addressMapping;for(const P in t)if(Object.prototype.hasOwnProperty.call(t,P)){const le=t[P];Vd(le);const se=la(le);if(se.height>e.maxRows||se.width>e.maxColumns)throw new Tn;const ie=c.addSheet(P);d.autoAddSheet(ie,se)}const f=new xs(e,a,c.get);o.parser=f;const p=new ad(e,fu(e),c.fetchDisplayName,i),E=new WN(e),m=new sv(e),S=new CN(e,E,m),v=new cT(e,E,m),A=new _N(e,a),w=new yT(e,u,l,v,f,n,o,i,A),I=new GT(e,w);o.undoRedo=I;const O=new hT(e,u,w),_=new HT(e,w,I,O,u,l,f,v,o,i),x=new zT(e,i,c.fetchDisplayName,o),L=new Tu(u,p,x),G=new QT(e,u,l,n,S,a,i,L,A,E);n.measure(K.GRAPH_BUILD,()=>{new jT(u,l,f,v,n,A).buildGraph(t,n)}),r.forEach(P=>{_.ensureItIsPossibleToAddNamedExpression(P.name,P.expression,P.scope),_.operations.addNamedExpression(P.name,P.expression,P.scope,P.options)});const H=new WT(e,n,G,o,u,l);return H.run(),n.end(K.BUILD_ENGINE_TOTAL),{config:e,stats:n,dependencyGraph:u,columnSearch:l,parser:f,unparser:p,cellContentParser:v,evaluator:H,lazilyTransformingAstService:o,crudOperations:_,exporter:x,namedExpressions:i,serialization:L,functionRegistry:a}}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function iv(s){for(const[e,t]of Object.entries(s))t instanceof Function?s[e]=av(t):delete s[e]}function av(s){return()=>{throw new Error(`The "${s}" method cannot be called because this HyperFormula instance has been destroyed`)}}var yi={exports:{}},Xl;function ov(){if(Xl)return yi.exports;Xl=1;function s(){}return s.prototype={on:function(e,t,r){var n=this.e||(this.e={});return(n[e]||(n[e]=[])).push({fn:t,ctx:r}),this},once:function(e,t,r){var n=this;function i(){n.off(e,i),t.apply(r,arguments)}return i._=t,this.on(e,i,r)},emit:function(e){var t=[].slice.call(arguments,1),r=((this.e||(this.e={}))[e]||[]).slice(),n=0,i=r.length;for(n;n<i;n++)r[n].fn.apply(r[n].ctx,t);return this},off:function(e,t){var r=this.e||(this.e={}),n=r[e],i=[];if(n&&t)for(var a=0,o=n.length;a<o;a++)n[a].fn!==t&&n[a].fn._!==t&&i.push(n[a]);return i.length?r[e]=i:delete r[e],this}},yi.exports=s,yi.exports.TinyEmitter=s,yi.exports}var uv=ov();/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var Nr;(function(s){s.SheetAdded="sheetAdded",s.SheetRemoved="sheetRemoved",s.SheetRenamed="sheetRenamed",s.NamedExpressionAdded="namedExpressionAdded",s.NamedExpressionRemoved="namedExpressionRemoved",s.ValuesUpdated="valuesUpdated",s.EvaluationSuspended="evaluationSuspended",s.EvaluationResumed="evaluationResumed"})(Nr||(Nr={}));class lv extends uv.TinyEmitter{emit(e,...t){return super.emit(e,...t),this}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class it{constructor(e,t,r,n,i,a,o,u,l,c,d,f,p,E){this._config=e,this._stats=t,this._dependencyGraph=r,this._columnSearch=n,this._parser=i,this._unparser=a,this._cellContentParser=o,this._evaluator=u,this._lazilyTransformingAstService=l,this._crudOperations=c,this._exporter=d,this._namedExpressions=f,this._serialization=p,this._functionRegistry=E,this._emitter=new lv,this._evaluationSuspended=!1}static get defaultConfig(){return cv()}get graph(){return this.dependencyGraph.graph}get rangeMapping(){return this.dependencyGraph.rangeMapping}get arrayMapping(){return this.dependencyGraph.arrayMapping}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}get dependencyGraph(){return this._dependencyGraph}get evaluator(){return this._evaluator}get columnSearch(){return this._columnSearch}get lazilyTransformingAstService(){return this._lazilyTransformingAstService}get licenseKeyValidityState(){return this._config.licenseKeyValidityState}static buildFromArray(e,t={},r=[]){return this.buildFromEngineState(Ri.buildFromSheet(e,t,r))}static buildFromSheets(e,t={},r=[]){return this.buildFromEngineState(Ri.buildFromSheets(e,t,r))}static buildEmpty(e={},t=[]){return this.buildFromEngineState(Ri.buildEmpty(e,t))}static getLanguage(e){M(e,"string","languageCode");const t=this.registeredLanguages.get(e);if(t===void 0)throw new vo;return t}static registerLanguage(e,t){if(M(e,"string","languageCode"),this.registeredLanguages.has(e))throw new Sd;this.registeredLanguages.set(e,lN(t))}static unregisterLanguage(e){if(M(e,"string","languageCode"),this.registeredLanguages.has(e))this.registeredLanguages.delete(e);else throw new vo}static getRegisteredLanguagesCodes(){return Array.from(this.registeredLanguages.keys())}static registerFunctionPlugin(e,t){Ke.registerFunctionPlugin(e,t)}static unregisterFunctionPlugin(e){Ke.unregisterFunctionPlugin(e)}static registerFunction(e,t,r){M(e,"string","functionId"),Ke.registerFunction(e,t,r)}static unregisterFunction(e){M(e,"string","functionId"),Ke.unregisterFunction(e)}static unregisterAllFunctions(){Ke.unregisterAll()}static getRegisteredFunctionNames(e){M(e,"string","code");const t=Ke.getRegisteredFunctionIds();return this.getLanguage(e).getFunctionTranslations(t)}static getFunctionPlugin(e){return M(e,"string","functionId"),Ke.getFunctionPlugin(e)}static getAllFunctionPlugins(){return Ke.getPlugins()}static buildFromEngineState(e){return new it(e.config,e.stats,e.dependencyGraph,e.columnSearch,e.parser,e.unparser,e.cellContentParser,e.evaluator,e.lazilyTransformingAstService,e.crudOperations,e.exporter,e.namedExpressions,e.serialization,e.functionRegistry)}getCellValue(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellValue(e)}getCellFormula(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");return this._serialization.getCellFormula(e)}getCellHyperlink(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellHyperlink(e)}getCellSerialized(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellSerialized(e)}getSheetValues(e){return M(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetValues(e)}getSheetFormulas(e){return M(e,"number","sheetId"),this._serialization.getSheetFormulas(e)}getSheetSerialized(e){return M(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetSerialized(e)}getAllSheetsDimensions(){return this._serialization.genericAllSheetsGetter(e=>this.getSheetDimensions(e))}getSheetDimensions(e){return M(e,"number","sheetId"),{width:this.dependencyGraph.getSheetWidth(e),height:this.dependencyGraph.getSheetHeight(e)}}getAllSheetsValues(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsValues()}getAllSheetsFormulas(){return this._serialization.getAllSheetsFormulas()}getAllSheetsSerialized(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsSerialized()}updateConfig(e){Object.entries(e).every(([r,n])=>this._config[r]===n)||this.rebuildWithConfig(e)}getConfig(){return this._config.getConfig()}rebuildAndRecalculate(){this.rebuildWithConfig({})}getStats(){return this._stats.snapshot()}undo(){return this._crudOperations.undo(),this.recomputeIfDependencyGraphNeedsIt()}redo(){return this._crudOperations.redo(),this.recomputeIfDependencyGraphNeedsIt()}isThereSomethingToUndo(){return this._crudOperations.isThereSomethingToUndo()}isThereSomethingToRedo(){return this._crudOperations.isThereSomethingToRedo()}isItPossibleToSetCellContents(e){let t;if(De(e))t=new W(e,e);else if(Pt(e))t=new W(e.start,e.end);else throw new he("SimpleCellAddress | SimpleCellRange","address");try{this._crudOperations.ensureRangeInSizeLimits(t);for(const r of t.addresses(this._dependencyGraph))this._crudOperations.ensureItIsPossibleToChangeContent(r)}catch{return!1}return!0}setCellContents(e,t){return this._crudOperations.setCellContents(e,t),this.recomputeIfDependencyGraphNeedsIt()}swapRowIndexes(e,t){return M(e,"number","sheetId"),this._crudOperations.setRowOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapRowIndexes(e,t){M(e,"number","sheetId");try{return this._crudOperations.validateSwapRowIndexes(e,t),this._crudOperations.testRowOrderForArrays(e,t),!0}catch{return!1}}setRowOrder(e,t){M(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"row");return this.swapRowIndexes(e,r)}isItPossibleToSetRowOrder(e,t){M(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"row");return this._crudOperations.validateSwapRowIndexes(e,r),this._crudOperations.testRowOrderForArrays(e,r),!0}catch{return!1}}swapColumnIndexes(e,t){return M(e,"number","sheetId"),this._crudOperations.setColumnOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapColumnIndexes(e,t){M(e,"number","sheetId");try{return this._crudOperations.validateSwapColumnIndexes(e,t),this._crudOperations.testColumnOrderForArrays(e,t),!0}catch{return!1}}setColumnOrder(e,t){M(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"column");return this.swapColumnIndexes(e,r)}isItPossibleToSetColumnOrder(e,t){M(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"column");return this._crudOperations.validateSwapColumnIndexes(e,r),this._crudOperations.testColumnOrderForArrays(e,r),!0}catch{return!1}}isItPossibleToAddRows(e,...t){M(e,"number","sheetId");const r=ha(t);try{return this._crudOperations.ensureItIsPossibleToAddRows(e,...r),!0}catch{return!1}}addRows(e,...t){return M(e,"number","sheetId"),this._crudOperations.addRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveRows(e,...t){M(e,"number","sheetId");const r=ca(t);try{return this._crudOperations.ensureItIsPossibleToRemoveRows(e,...r),!0}catch{return!1}}removeRows(e,...t){return M(e,"number","sheetId"),this._crudOperations.removeRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToAddColumns(e,...t){M(e,"number","sheetId");const r=ha(t);try{return this._crudOperations.ensureItIsPossibleToAddColumns(e,...r),!0}catch{return!1}}addColumns(e,...t){return M(e,"number","sheetId"),this._crudOperations.addColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveColumns(e,...t){M(e,"number","sheetId");const r=ca(t);try{return this._crudOperations.ensureItIsPossibleToRemoveColumns(e,...r),!0}catch{return!1}}removeColumns(e,...t){return M(e,"number","sheetId"),this._crudOperations.removeColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveCells(e,t){if(!De(t))throw new he("SimpleCellAddress","destinationLeftCorner");if(!Pt(e))throw new he("SimpleCellRange","source");try{const r=new W(e.start,e.end);return this._crudOperations.operations.ensureItIsPossibleToMoveCells(r.start,r.width(),r.height(),t),!0}catch{return!1}}moveCells(e,t){if(!De(t))throw new he("SimpleCellAddress","destinationLeftCorner");if(!Pt(e))throw new he("SimpleCellRange","source");const r=new W(e.start,e.end);return this._crudOperations.moveCells(r.start,r.width(),r.height(),t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveRows(e,t,r,n){M(e,"number","sheetId"),M(t,"number","startRow"),M(r,"number","numberOfRows"),M(n,"number","targetRow");try{return this._crudOperations.ensureItIsPossibleToMoveRows(e,t,r,n),!0}catch{return!1}}moveRows(e,t,r,n){return M(e,"number","sheetId"),M(t,"number","startRow"),M(r,"number","numberOfRows"),M(n,"number","targetRow"),this._crudOperations.moveRows(e,t,r,n),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveColumns(e,t,r,n){M(e,"number","sheetId"),M(t,"number","startColumn"),M(r,"number","numberOfColumns"),M(n,"number","targetColumn");try{return this._crudOperations.ensureItIsPossibleToMoveColumns(e,t,r,n),!0}catch{return!1}}moveColumns(e,t,r,n){return M(e,"number","sheetId"),M(t,"number","startColumn"),M(r,"number","numberOfColumns"),M(n,"number","targetColumn"),this._crudOperations.moveColumns(e,t,r,n),this.recomputeIfDependencyGraphNeedsIt()}copy(e){if(!Pt(e))throw new he("SimpleCellRange","source");const t=new W(e.start,e.end);return this._crudOperations.copy(t.start,t.width(),t.height()),this.getRangeValues(e)}cut(e){if(!Pt(e))throw new he("SimpleCellRange","source");const t=new W(e.start,e.end);return this._crudOperations.cut(t.start,t.width(),t.height()),this.getRangeValues(e)}paste(e){if(!De(e))throw new he("SimpleCellAddress","targetLeftCorner");return this.ensureEvaluationIsNotSuspended(),this._crudOperations.paste(e),this.recomputeIfDependencyGraphNeedsIt()}isClipboardEmpty(){return this._crudOperations.isClipboardEmpty()}clearClipboard(){this._crudOperations.clearClipboard()}clearRedoStack(){this._crudOperations.undoRedo.clearRedoStack()}clearUndoStack(){this._crudOperations.undoRedo.clearUndoStack()}getRangeValues(e){if(!Pt(e))throw new he("SimpleCellRange","source");return new W(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellValue(n)))}getRangeFormulas(e){if(!Pt(e))throw new he("SimpleCellRange","source");return new W(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellFormula(n)))}getRangeSerialized(e){if(!Pt(e))throw new he("SimpleCellRange","source");return new W(e.start,e.end).arrayOfAddressesInRange().map(r=>r.map(n=>this.getCellSerialized(n)))}getFillRangeData(e,t,r=!1){if(!Pt(e))throw new he("SimpleCellRange","source");if(!Pt(t))throw new he("SimpleCellRange","target");const n=new W(e.start,e.end),i=new W(t.start,t.end);return this.ensureEvaluationIsNotSuspended(),i.arrayOfAddressesInRange().map(a=>a.map(o=>{const u=((o.row-(r?t:e).start.row)%n.height()+n.height())%n.height()+e.start.row,l=((o.col-(r?t:e).start.col)%n.width()+n.width())%n.width()+e.start.col;return this._serialization.getCellSerialized({row:u,col:l,sheet:n.sheet},o)}))}isItPossibleToAddSheet(e){M(e,"string","sheetName");try{return this._crudOperations.ensureItIsPossibleToAddSheet(e),!0}catch{return!1}}addSheet(e){e!==void 0&&M(e,"string","sheetName");const t=this._crudOperations.addSheet(e);return this._emitter.emit(Nr.SheetAdded,t),t}isItPossibleToRemoveSheet(e){M(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch{return!1}}removeSheet(e){M(e,"number","sheetId");const t=this.sheetMapping.getDisplayName(e);this._crudOperations.removeSheet(e);const r=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Nr.SheetRemoved,t,r),r}isItPossibleToClearSheet(e){M(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch{return!1}}clearSheet(e){return M(e,"number","sheetId"),this._crudOperations.clearSheet(e),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToReplaceSheetContent(e,t){M(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),this._crudOperations.ensureItIsPossibleToChangeSheetContents(e,t),!0}catch{return!1}}setSheetContent(e,t){return M(e,"number","sheetId"),this._crudOperations.setSheetContent(e,t),this.recomputeIfDependencyGraphNeedsIt()}simpleCellAddressFromString(e,t){return M(e,"string","cellAddress"),M(t,"number","sheetId"),uo(this.sheetMapping.get,e,t)}simpleCellRangeFromString(e,t){return M(e,"string","cellRange"),M(t,"number","sheetId"),$g(this.sheetMapping.get,e,t)}simpleCellAddressToString(e,t={}){if(!De(e))throw new he("SimpleCellAddress","cellAddress");const r=typeof t=="number"?t:t.includeSheetName?e.sheet+1:e.sheet;return zi(this.sheetMapping.fetchDisplayName,e,r)}simpleCellRangeToString(e,t={}){if(!Pt(e))throw new he("SimpleCellRange","cellRange");const r=typeof t=="number"?t:t.includeSheetName?e.start.sheet+e.end.sheet+1:e.start.sheet;return Xg(this.sheetMapping.fetchDisplayName,e,r)}getCellDependents(e){let t;if(De(e))t=this._dependencyGraph.addressMapping.getCell(e);else if(Pt(e))t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end);else throw new he("SimpleCellAddress | SimpleCellRange",e);return t===void 0?[]:this._dependencyGraph.getAdjacentNodesAddresses(t)}getCellPrecedents(e){let t;if(De(e))t=this._dependencyGraph.addressMapping.getCell(e);else if(Pt(e))t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end);else throw new he("SimpleCellAddress | SimpleCellRange",e);return t===void 0?[]:this._dependencyGraph.dependencyQueryAddresses(t)}getSheetName(e){return M(e,"number","sheetId"),this.sheetMapping.getDisplayName(e)}getSheetNames(){return this.sheetMapping.sheetNames()}getSheetId(e){return M(e,"string","sheetName"),this.sheetMapping.get(e)}doesSheetExist(e){return M(e,"string","sheetName"),this.sheetMapping.hasSheetWithName(e)}getCellType(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");const t=this.dependencyGraph.getCell(e);return pN(t,e)}doesCellHaveSimpleValue(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");return this.getCellType(e)===vt.VALUE}doesCellHaveFormula(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===vt.FORMULA||t===vt.ARRAYFORMULA}isCellEmpty(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");return this.getCellType(e)===vt.EMPTY}isCellPartOfArray(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===vt.ARRAY||t===vt.ARRAYFORMULA}getCellValueType(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return ia(t)}getCellValueDetailedType(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return gN(t)}getCellValueFormat(e){if(!De(e))throw new he("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return EN(t)}countSheets(){return this.sheetMapping.numberOfSheets()}isItPossibleToRenameSheet(e,t){M(e,"number","sheetId"),M(t,"string","newName");try{return this._crudOperations.ensureItIsPossibleToRenameSheet(e,t),!0}catch{return!1}}renameSheet(e,t){M(e,"number","sheetId"),M(t,"string","newName");const r=this._crudOperations.renameSheet(e,t);r!==void 0&&this._emitter.emit(Nr.SheetRenamed,r,t)}batch(e){this.suspendEvaluation(),this._crudOperations.beginUndoRedoBatchMode();try{e()}catch(t){throw this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation(),t}return this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation()}suspendEvaluation(){this._evaluationSuspended=!0,this._emitter.emit(Nr.EvaluationSuspended)}resumeEvaluation(){this._evaluationSuspended=!1;const e=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Nr.EvaluationResumed,e),e}isEvaluationSuspended(){return this._evaluationSuspended}isItPossibleToAddNamedExpression(e,t,r){M(e,"string","expressionName"),r!==void 0&&M(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToAddNamedExpression(e,t,r),!0}catch{return!1}}addNamedExpression(e,t,r,n){M(e,"string","expressionName"),r!==void 0&&M(r,"number","scope"),this._crudOperations.addNamedExpression(e,t,r,n);const i=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Nr.NamedExpressionAdded,e,i),i}getNamedExpressionValue(e,t){M(e,"string","expressionName"),t!==void 0&&M(t,"number","scope"),this.ensureEvaluationIsNotSuspended(),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);if(r)return this._serialization.getCellValue(r.address)}getNamedExpressionFormula(e,t){M(e,"string","expressionName"),t!==void 0&&M(t,"number","scope"),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);if(r!==void 0)return this._serialization.getCellFormula(r.address)}getNamedExpression(e,t){M(e,"string","expressionName"),t!==void 0&&M(t,"number","scope");const r=this._namedExpressions.namedExpressionForScope(e,t);if(r===void 0)return;const n=this._serialization.getCellFormula(r.address);return{name:e,scope:t,expression:n,options:r.options}}isItPossibleToChangeNamedExpression(e,t,r){M(e,"string","expressionName"),r!==void 0&&M(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToChangeNamedExpression(e,t,r),!0}catch{return!1}}changeNamedExpression(e,t,r,n){return M(e,"string","expressionName"),r!==void 0&&M(r,"number","scope"),this._crudOperations.changeNamedExpressionExpression(e,r,t,n),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveNamedExpression(e,t){M(e,"string","expressionName"),t!==void 0&&M(t,"number","scope");try{return this._crudOperations.isItPossibleToRemoveNamedExpression(e,t),!0}catch{return!1}}removeNamedExpression(e,t){M(e,"string","expressionName"),t!==void 0&&M(t,"number","scope");const r=this._crudOperations.removeNamedExpression(e,t);if(r){const n=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Nr.NamedExpressionRemoved,r.displayName,n),n}else return[]}listNamedExpressions(e){return e!==void 0&&M(e,"number","scope"),this._crudOperations.ensureScopeIdIsValid(e),this._namedExpressions.getAllNamedExpressionsNamesInScope(e)}getAllNamedExpressionsSerialized(){return this._serialization.getAllNamedExpressionsSerialized()}normalizeFormula(e){M(e,"string","formulaString");const{ast:t,address:r}=this.extractTemporaryFormula(e);if(t===void 0)throw new Ui;return this._unparser.unparse(t,r)}calculateFormula(e,t){M(e,"string","formulaString"),M(t,"number","sheetId"),this._crudOperations.ensureScopeIdIsValid(t);const{ast:r,address:n,dependencies:i}=this.extractTemporaryFormula(e,t);if(r===void 0)throw new Ui;const a=this.evaluator.runAndForget(r,n,i);return this._exporter.exportScalarOrRange(a)}getNamedExpressionsFromFormula(e){M(e,"string","formulaString");const{ast:t,dependencies:r}=this.extractTemporaryFormula(e);if(t===void 0)throw new Ui;const n=r.filter(a=>a instanceof Pr).map(a=>a.name);return[...new Set(n)]}validateFormula(e){M(e,"string","formulaString");const{ast:t}=this.extractTemporaryFormula(e);return t!==void 0}getRegisteredFunctionNames(){return it.getLanguage(this._config.language).getFunctionTranslations(this._functionRegistry.getRegisteredFunctionIds())}getFunctionPlugin(e){return M(e,"string","functionId"),this._functionRegistry.getFunctionPlugin(e)}getAllFunctionPlugins(){return this._functionRegistry.getPlugins()}numberToDateTime(e){return M(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDateTime(e)}numberToDate(e){return M(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDate(e)}numberToTime(e){return M(e,"number","val"),Xn(e)}on(e,t){this._emitter.on(e,t)}once(e,t){this._emitter.once(e,t)}off(e,t){this._emitter.off(e,t)}destroy(){iv(this)}ensureEvaluationIsNotSuspended(){if(this._evaluationSuspended)throw new Td}extractTemporaryFormula(e,t=1){const r=this._cellContentParser.parse(e),n={sheet:t,col:0,row:0};if(!(r instanceof be.Formula))return{address:n,dependencies:[]};const{ast:i,errors:a,dependencies:o}=this._parser.parse(r.formula,n);return a.length>0?{address:n,dependencies:[]}:{ast:i,address:n,dependencies:o}}rebuildWithConfig(e){const t=this._config.mergeConfig(e),r=this._config.mergeConfig({language:e.language}),n=this._serialization.withNewConfig(r,this._namedExpressions).getAllSheetsSerialized(),i=this._serialization.getAllNamedExpressionsSerialized(),a=Ri.rebuildWithConfig(t,n,i,this._stats);this._config=a.config,this._stats=a.stats,this._dependencyGraph=a.dependencyGraph,this._columnSearch=a.columnSearch,this._parser=a.parser,this._unparser=a.unparser,this._cellContentParser=a.cellContentParser,this._evaluator=a.evaluator,this._lazilyTransformingAstService=a.lazilyTransformingAstService,this._crudOperations=a.crudOperations,this._exporter=a.exporter,this._namedExpressions=a.namedExpressions,this._serialization=a.serialization,this._functionRegistry=a.functionRegistry}recomputeIfDependencyGraphNeedsIt(){if(this._evaluationSuspended)return[];{const e=this._crudOperations.getAndClearContentChanges(),t=this.dependencyGraph.verticesToRecompute();this.dependencyGraph.clearDirtyVertices(),t.length>0&&e.addAll(this.evaluator.partialRun(t));const r=e.exportChanges(this._exporter);return e.isEmpty()||this._emitter.emit(Nr.ValuesUpdated,r),r}}}it.version="3.1.0";it.buildDate="14/10/2025 09:41:56";it.releaseDate="14/10/2025";it.languages={};it.registeredLanguages=new Map;/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Kl=new WeakMap;class kt{constructor(e={},t=!0){const{accentSensitive:r,caseSensitive:n,caseFirst:i,chooseAddressMappingPolicy:a,context:o,currencySymbol:u,dateFormats:l,decimalSeparator:c,evaluateNullToZero:d,functionArgSeparator:f,functionPlugins:p,ignorePunctuation:E,leapYear1900:m,localeLang:S,language:v,ignoreWhiteSpace:A,licenseKey:w,matchWholeCell:I,arrayColumnSeparator:O,arrayRowSeparator:_,maxRows:x,maxColumns:L,nullYear:G,nullDate:H,parseDateTime:P,precisionEpsilon:le,precisionRounding:se,stringifyDateTime:ie,stringifyDuration:ce,smartRounding:q,timeFormats:fe,thousandSeparator:ye,useArrayArithmetic:Se,useStats:Ae,undoLimit:Ue,useColumnIndex:ae,useRegularExpressions:Ne,useWildcards:pe}=e;this.useArrayArithmetic=ge(Se,"boolean","useArrayArithmetic"),this.accentSensitive=ge(r,"boolean","accentSensitive"),this.caseSensitive=ge(n,"boolean","caseSensitive"),this.caseFirst=ge(i,["upper","lower","false"],"caseFirst"),this.ignorePunctuation=ge(E,"boolean","ignorePunctuation"),this.chooseAddressMappingPolicy=a??kt.defaultConfig.chooseAddressMappingPolicy,this.dateFormats=[...di(l,Array.isArray,"array","dateFormats")],this.timeFormats=[...di(fe,Array.isArray,"array","timeFormats")],this.functionArgSeparator=ge(f,"string","functionArgSeparator"),this.decimalSeparator=ge(c,[".",","],"decimalSeparator"),this.language=ge(v,"string","language"),this.ignoreWhiteSpace=ge(A,["standard","any"],"ignoreWhiteSpace"),this.licenseKey=ge(w,"string","licenseKey"),this.thousandSeparator=ge(ye,["",","," ","."],"thousandSeparator"),this.arrayColumnSeparator=ge(O,[",",";"],"arrayColumnSeparator"),this.arrayRowSeparator=ge(_,[";","|"],"arrayRowSeparator"),this.localeLang=ge(S,"string","localeLang"),this.functionPlugins=[...p??kt.defaultConfig.functionPlugins],this.smartRounding=ge(q,"boolean","smartRounding"),this.evaluateNullToZero=ge(d,"boolean","evaluateNullToZero"),this.nullYear=ge(G,"number","nullYear"),_n(this.nullYear,"nullYear",0),LN(this.nullYear,"nullYear",100),this.precisionRounding=ge(se,"number","precisionRounding"),_n(this.precisionRounding,"precisionRounding",0),this.precisionEpsilon=ge(le,"number","precisionEpsilon"),_n(this.precisionEpsilon,"precisionEpsilon",0),this.useColumnIndex=ge(ae,"boolean","useColumnIndex"),this.useStats=ge(Ae,"boolean","useStats"),this.parseDateTime=ge(P,"function","parseDateTime"),this.stringifyDateTime=ge(ie,"function","stringifyDateTime"),this.stringifyDuration=ge(ce,"function","stringifyDuration"),this.translationPackage=it.getLanguage(this.language),this.errorMapping=this.translationPackage.buildErrorMapping(),this.nullDate=di(H,Fs,"IDate","nullDate"),this.leapYear1900=ge(m,"boolean","leapYear1900"),this.undoLimit=ge(Ue,"number","undoLimit"),this.useRegularExpressions=ge(Ne,"boolean","useRegularExpressions"),this.useWildcards=ge(pe,"boolean","useWildcards"),this.matchWholeCell=ge(I,"boolean","matchWholeCell"),_n(this.undoLimit,"undoLimit",0),this.maxRows=ge(x,"number","maxRows"),_n(this.maxRows,"maxRows",1),this.maxColumns=ge(L,"number","maxColumns"),this.currencySymbol=this.setupCurrencySymbol(u),_n(this.maxColumns,"maxColumns",1),this.context=o,Kl.set(this,{licenseKeyValidityState:iT(this.licenseKey)}),Ll({value:this.decimalSeparator,name:"decimalSeparator"},{value:this.functionArgSeparator,name:"functionArgSeparator"},{value:this.thousandSeparator,name:"thousandSeparator"}),Ll({value:this.arrayRowSeparator,name:"arrayRowSeparator"},{value:this.arrayColumnSeparator,name:"arrayColumnSeparator"})}setupCurrencySymbol(e){const t=[...di(e,Array.isArray,"array","currencySymbol")];return t.forEach(r=>{if(typeof r!="string")throw new he("string[]","currencySymbol");if(r==="")throw new Qy("currencySymbol")}),t}get licenseKeyValidityState(){return Kl.get(this).licenseKeyValidityState}getConfig(){return $d(this)}mergeConfig(e){const t=Object.assign({},this.getConfig(),e);return new kt(t,!1)}static warnDeprecatedOptions(e){}static warnDeprecatedIfUsed(e,t,r,n){e!==void 0&&console.warn(n===void 0?`${t} option is deprecated since ${r}`:`${t} option is deprecated since ${r}, please use ${n}`)}}kt.defaultConfig={accentSensitive:!1,currencySymbol:["$"],caseSensitive:!1,caseFirst:"lower",context:void 0,chooseAddressMappingPolicy:new $N,dateFormats:["DD/MM/YYYY","DD/MM/YY"],decimalSeparator:".",evaluateNullToZero:!1,functionArgSeparator:",",functionPlugins:[],ignorePunctuation:!1,language:"enGB",ignoreWhiteSpace:"standard",licenseKey:"",leapYear1900:!1,localeLang:"en",matchWholeCell:!0,arrayColumnSeparator:",",arrayRowSeparator:";",maxRows:4e4,maxColumns:18278,nullYear:30,nullDate:{year:1899,month:12,day:30},parseDateTime:VN,precisionEpsilon:1e-13,precisionRounding:10,smartRounding:!0,stringifyDateTime:tT,stringifyDuration:eT,timeFormats:["hh:mm","hh:mm:ss.sss"],thousandSeparator:"",undoLimit:20,useRegularExpressions:!1,useWildcards:!0,useColumnIndex:!1,useStats:!1,useArrayArithmetic:!1};function $d(s){var e;const t={};for(const r in kt.defaultConfig){const n=(e=s[r])!==null&&e!==void 0?e:kt.defaultConfig[r];Array.isArray(n)?t[r]=[...n]:t[r]=n}return t}function cv(){return $d({})}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Fo={errors:{CYCLE:"#CYCLE!",DIV_BY_ZERO:"#DIV/0!",ERROR:"#ERROR!",NA:"#N/A",NAME:"#NAME?",NUM:"#NUM!",REF:"#REF!",SPILL:"#SPILL!",VALUE:"#VALUE!"},functions:{FILTER:"FILTER",ADDRESS:"ADDRESS",ARRAY_CONSTRAIN:"ARRAY_CONSTRAIN",ARRAYFORMULA:"ARRAYFORMULA",ABS:"ABS",ACOS:"ACOS",ACOSH:"ACOSH",ACOT:"ACOT",ACOTH:"ACOTH",AND:"AND",ARABIC:"ARABIC",ASIN:"ASIN",ASINH:"ASINH",ATAN2:"ATAN2",ATAN:"ATAN",ATANH:"ATANH",AVERAGE:"AVERAGE",AVERAGEA:"AVERAGEA",AVERAGEIF:"AVERAGEIF",BASE:"BASE",BIN2DEC:"BIN2DEC",BIN2HEX:"BIN2HEX",BIN2OCT:"BIN2OCT",BITAND:"BITAND",BITLSHIFT:"BITLSHIFT",BITOR:"BITOR",BITRSHIFT:"BITRSHIFT",BITXOR:"BITXOR",CEILING:"CEILING",CHAR:"CHAR",CHOOSE:"CHOOSE",CLEAN:"CLEAN",CODE:"CODE",COLUMN:"COLUMN",COLUMNS:"COLUMNS",CONCATENATE:"CONCATENATE",CORREL:"CORREL",COS:"COS",COSH:"COSH",COT:"COT",COTH:"COTH",COUNT:"COUNT",COUNTA:"COUNTA",COUNTBLANK:"COUNTBLANK",COUNTIF:"COUNTIF",COUNTIFS:"COUNTIFS",COUNTUNIQUE:"COUNTUNIQUE",CSC:"CSC",CSCH:"CSCH",CUMIPMT:"CUMIPMT",CUMPRINC:"CUMPRINC",DATE:"DATE",DATEDIF:"DATEDIF",DATEVALUE:"DATEVALUE",DAY:"DAY",DAYS360:"DAYS360",DAYS:"DAYS",DB:"DB",DDB:"DDB",DEC2BIN:"DEC2BIN",DEC2HEX:"DEC2HEX",DEC2OCT:"DEC2OCT",DECIMAL:"DECIMAL",DEGREES:"DEGREES",DELTA:"DELTA",DOLLARDE:"DOLLARDE",DOLLARFR:"DOLLARFR",EDATE:"EDATE",EFFECT:"EFFECT",EOMONTH:"EOMONTH",ERF:"ERF",ERFC:"ERFC",EVEN:"EVEN",EXACT:"EXACT",EXP:"EXP",FALSE:"FALSE",FIND:"FIND",FORMULATEXT:"FORMULATEXT",FV:"FV",FVSCHEDULE:"FVSCHEDULE",HEX2BIN:"HEX2BIN",HEX2DEC:"HEX2DEC",HEX2OCT:"HEX2OCT",HLOOKUP:"HLOOKUP",HOUR:"HOUR",HYPERLINK:"HYPERLINK",IF:"IF",IFERROR:"IFERROR",IFNA:"IFNA",IFS:"IFS",INDEX:"INDEX",INT:"INT",INTERVAL:"INTERVAL",IPMT:"IPMT",ISBINARY:"ISBINARY",ISBLANK:"ISBLANK",ISERR:"ISERR",ISERROR:"ISERROR",ISEVEN:"ISEVEN",ISFORMULA:"ISFORMULA",ISLOGICAL:"ISLOGICAL",ISNA:"ISNA",ISNONTEXT:"ISNONTEXT",ISNUMBER:"ISNUMBER",ISODD:"ISODD",ISOWEEKNUM:"ISOWEEKNUM",ISPMT:"ISPMT",ISREF:"ISREF",ISTEXT:"ISTEXT",LEFT:"LEFT",LEN:"LEN",LN:"LN",LOG10:"LOG10",LOG:"LOG",LOWER:"LOWER",MATCH:"MATCH",MAX:"MAX",MAXA:"MAXA",MAXIFS:"MAXIFS",MAXPOOL:"MAXPOOL",MEDIAN:"MEDIAN",MEDIANPOOL:"MEDIANPOOL",MID:"MID",MIN:"MIN",MINA:"MINA",MINIFS:"MINIFS",MINUTE:"MINUTE",MIRR:"MIRR",MMULT:"MMULT",MOD:"MOD",MONTH:"MONTH",NA:"NA",NETWORKDAYS:"NETWORKDAYS","NETWORKDAYS.INTL":"NETWORKDAYS.INTL",NOMINAL:"NOMINAL",NOT:"NOT",NOW:"NOW",NPER:"NPER",NPV:"NPV",OCT2BIN:"OCT2BIN",OCT2DEC:"OCT2DEC",OCT2HEX:"OCT2HEX",ODD:"ODD",OFFSET:"OFFSET",OR:"OR",PI:"PI",PMT:"PMT",PDURATION:"PDURATION",PRODUCT:"PRODUCT",POWER:"POWER",PPMT:"PPMT",PROPER:"PROPER",PV:"PV",RADIANS:"RADIANS",RAND:"RAND",RATE:"RATE",REPLACE:"REPLACE",REPT:"REPT",RIGHT:"RIGHT",ROMAN:"ROMAN",ROUND:"ROUND",ROUNDDOWN:"ROUNDDOWN",ROUNDUP:"ROUNDUP",ROW:"ROW",ROWS:"ROWS",RRI:"RRI",SEARCH:"SEARCH",SEC:"SEC",SECH:"SECH",SECOND:"SECOND",SHEET:"SHEET",SHEETS:"SHEETS",SIN:"SIN",SINH:"SINH",SLN:"SLN",SPLIT:"SPLIT",SQRT:"SQRT",STDEVA:"STDEVA","STDEV.P":"STDEV.P",STDEVPA:"STDEVPA","STDEV.S":"STDEV.S",SUBSTITUTE:"SUBSTITUTE",SUBTOTAL:"SUBTOTAL",SUM:"SUM",SUMIF:"SUMIF",SUMIFS:"SUMIFS",SUMPRODUCT:"SUMPRODUCT",SUMSQ:"SUMSQ",SWITCH:"SWITCH",SYD:"SYD",T:"T",TAN:"TAN",TANH:"TANH",TBILLEQ:"TBILLEQ",TBILLPRICE:"TBILLPRICE",TBILLYIELD:"TBILLYIELD",TEXT:"TEXT",TIME:"TIME",TIMEVALUE:"TIMEVALUE",TODAY:"TODAY",TRANSPOSE:"TRANSPOSE",TRIM:"TRIM",TRUE:"TRUE",TRUNC:"TRUNC",UNICHAR:"UNICHAR",UNICODE:"UNICODE",UPPER:"UPPER",VARA:"VARA","VAR.P":"VAR.P",VARPA:"VARPA","VAR.S":"VAR.S",VLOOKUP:"VLOOKUP",WEEKDAY:"WEEKDAY",WEEKNUM:"WEEKNUM",WORKDAY:"WORKDAY","WORKDAY.INTL":"WORKDAY.INTL",XNPV:"XNPV",XOR:"XOR",XLOOKUP:"XLOOKUP",YEAR:"YEAR",YEARFRAC:"YEARFRAC","HF.ADD":"HF.ADD","HF.CONCAT":"HF.CONCAT","HF.DIVIDE":"HF.DIVIDE","HF.EQ":"HF.EQ","HF.GT":"HF.GT","HF.GTE":"HF.GTE","HF.LT":"HF.LT","HF.LTE":"HF.LTE","HF.MINUS":"HF.MINUS","HF.MULTIPLY":"HF.MULTIPLY","HF.NE":"HF.NE","HF.POW":"HF.POW","HF.UMINUS":"HF.UMINUS","HF.UNARY_PERCENT":"HF.UNARY_PERCENT","HF.UPLUS":"HF.UPLUS",VARP:"VARP",VAR:"VAR",STDEVP:"STDEVP",STDEV:"STDEV","EXPON.DIST":"EXPON.DIST",FISHER:"FISHER",FISHERINV:"FISHERINV",GAMMA:"GAMMA","GAMMA.DIST":"GAMMA.DIST",GAMMALN:"GAMMALN","GAMMALN.PRECISE":"GAMMALN.PRECISE","GAMMA.INV":"GAMMA.INV",GAUSS:"GAUSS",FACT:"FACT",FACTDOUBLE:"FACTDOUBLE",COMBIN:"COMBIN",COMBINA:"COMBINA",GCD:"GCD",LCM:"LCM",MROUND:"MROUND",MULTINOMIAL:"MULTINOMIAL",QUOTIENT:"QUOTIENT",RANDBETWEEN:"RANDBETWEEN",SERIESSUM:"SERIESSUM",SIGN:"SIGN",SQRTPI:"SQRTPI",SUMX2MY2:"SUMX2MY2",SUMX2PY2:"SUMX2PY2",SUMXMY2:"SUMXMY2",EXPONDIST:"EXPONDIST",GAMMADIST:"GAMMADIST",GAMMAINV:"GAMMAINV","BETA.DIST":"BETA.DIST",BETADIST:"BETADIST","BETA.INV":"BETA.INV",BETAINV:"BETAINV","BINOM.DIST":"BINOM.DIST",BINOMDIST:"BINOMDIST","BINOM.INV":"BINOM.INV",BESSELI:"BESSELI",BESSELJ:"BESSELJ",BESSELK:"BESSELK",BESSELY:"BESSELY","CHISQ.DIST":"CHISQ.DIST","CHISQ.DIST.RT":"CHISQ.DIST.RT","CHISQ.INV":"CHISQ.INV","CHISQ.INV.RT":"CHISQ.INV.RT",CHIDIST:"CHIDIST",CHIINV:"CHIINV","F.DIST":"F.DIST","F.DIST.RT":"F.DIST.RT","F.INV":"F.INV","F.INV.RT":"F.INV.RT",FDIST:"FDIST",FINV:"FINV",WEIBULL:"WEIBULL","WEIBULL.DIST":"WEIBULL.DIST",POISSON:"POISSON","POISSON.DIST":"POISSON.DIST","HYPGEOM.DIST":"HYPGEOM.DIST",HYPGEOMDIST:"HYPGEOMDIST","T.DIST":"T.DIST","T.DIST.2T":"T.DIST.2T","T.DIST.RT":"T.DIST.RT","T.INV":"T.INV","T.INV.2T":"T.INV.2T",TDIST:"TDIST",TINV:"TINV",LOGINV:"LOGINV","LOGNORM.DIST":"LOGNORM.DIST","LOGNORM.INV":"LOGNORM.INV",LOGNORMDIST:"LOGNORMDIST","NORM.DIST":"NORM.DIST","NORM.INV":"NORM.INV","NORM.S.DIST":"NORM.S.DIST","NORM.S.INV":"NORM.S.INV",NORMDIST:"NORMDIST",NORMINV:"NORMINV",NORMSDIST:"NORMSDIST",NORMSINV:"NORMSINV",PHI:"PHI","NEGBINOM.DIST":"NEGBINOM.DIST",NEGBINOMDIST:"NEGBINOMDIST",COMPLEX:"COMPLEX",IMABS:"IMABS",IMAGINARY:"IMAGINARY",IMARGUMENT:"IMARGUMENT",IMCONJUGATE:"IMCONJUGATE",IMCOS:"IMCOS",IMCOSH:"IMCOSH",IMCOT:"IMCOT",IMCSC:"IMCSC",IMCSCH:"IMCSCH",IMDIV:"IMDIV",IMEXP:"IMEXP",IMLN:"IMLN",IMLOG10:"IMLOG10",IMLOG2:"IMLOG2",IMPOWER:"IMPOWER",IMPRODUCT:"IMPRODUCT",IMREAL:"IMREAL",IMSEC:"IMSEC",IMSECH:"IMSECH",IMSIN:"IMSIN",IMSINH:"IMSINH",IMSQRT:"IMSQRT",IMSUB:"IMSUB",IMSUM:"IMSUM",IMTAN:"IMTAN",LARGE:"LARGE",SMALL:"SMALL",AVEDEV:"AVEDEV",CONFIDENCE:"CONFIDENCE","CONFIDENCE.NORM":"CONFIDENCE.NORM","CONFIDENCE.T":"CONFIDENCE.T",DEVSQ:"DEVSQ",GEOMEAN:"GEOMEAN",HARMEAN:"HARMEAN",CRITBINOM:"CRITBINOM","COVARIANCE.P":"COVARIANCE.P","COVARIANCE.S":"COVARIANCE.S",COVAR:"COVAR",PEARSON:"PEARSON",RSQ:"RSQ",STANDARDIZE:"STANDARDIZE","Z.TEST":"Z.TEST",ZTEST:"ZTEST","F.TEST":"F.TEST",FTEST:"FTEST",STEYX:"STEYX",SLOPE:"SLOPE","CHISQ.TEST":"CHISQ.TEST",CHITEST:"CHITEST","T.TEST":"T.TEST",TTEST:"TTEST",SKEW:"SKEW","SKEW.P":"SKEW.P",WEIBULLDIST:"WEIBULLDIST",VARS:"VARS",TINV2T:"TINV2T",TDISTRT:"TDISTRT",TDIST2T:"TDIST2T",STDEVS:"STDEVS",FINVRT:"FINVRT",FDISTRT:"FDISTRT",CHIDISTRT:"CHIDISTRT",CHIINVRT:"CHIINVRT",COVARIANCEP:"COVARIANCEP",COVARIANCES:"COVARIANCES",LOGNORMINV:"LOGNORMINV",POISSONDIST:"POISSONDIST",SKEWP:"SKEWP","CEILING.MATH":"CEILING.MATH",FLOOR:"FLOOR","FLOOR.MATH":"FLOOR.MATH","CEILING.PRECISE":"CEILING.PRECISE","FLOOR.PRECISE":"FLOOR.PRECISE","ISO.CEILING":"ISO.CEILING"},langCode:"enGB",ui:{NEW_SHEET_PREFIX:"Sheet"}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */var qr;(function(s){s[s.FullyAbsolute=1]="FullyAbsolute",s[s.RowAbsoluteColRelative=2]="RowAbsoluteColRelative",s[s.RowRelativeColAbsolute=3]="RowRelativeColAbsolute",s[s.FullyRelative=4]="FullyRelative"})(qr||(qr={}));class Xd extends Q{verifyAddressArguments(e,t,r,n){if(n){if(e<1||t<1)return new g(R.VALUE,T.LessThanOne)}else if(qr.FullyAbsolute==r){if(e<1||t<1)return new g(R.VALUE,T.LessThanOne)}else if(qr.RowAbsoluteColRelative==r){if(e<1)return new g(R.VALUE,T.LessThanOne)}else if(qr.RowRelativeColAbsolute==r&&t<1)return new g(R.VALUE,T.LessThanOne)}address(e,t){return this.runFunction(e.args,t,this.metadata("ADDRESS"),(r,n,i,a,o)=>{const u=this.verifyAddressArguments(r,n,i,a);if(u!==void 0)return u;const l=Na(n-1);let c="";o!=null&&(c=`${o}!`);const d=n==0?"C":`C[${n}]`,f=r==0?"R":`R[${r}]`;return qr.FullyRelative==i?a?`${c}${l}${r}`:`${c}${f}${d}`:qr.RowRelativeColAbsolute==i?a?`${c}$${l}${r}`:`${c}${f}C${n}`:qr.RowAbsoluteColRelative==i?a?`${c}${l}$${r}`:`${c}R${r}${d}`:a?`${c}$${l}$${r}`:`${c}R${r}C${n}`})}}Xd.implementedFunctions={ADDRESS:{method:"address",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,defaultValue:1,minValue:1,maxValue:4},{argumentType:h.BOOLEAN,optionalArg:!0,defaultValue:!0},{argumentType:h.STRING,optionalArg:!0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Kd extends Q{arrayformula(e,t){return this.runFunction(e.args,t,this.metadata("ARRAYFORMULA"),r=>r)}arrayformulaArraySize(e,t){if(e.args.length!==1)return Z.error();const r=this.metadata("ARRAYFORMULA");return e.args.map(i=>{var a;return this.arraySizeForAst(i,new Cr(t.formulaAddress,t.arraysFlag||((a=r?.enableArrayArithmeticForArguments)!==null&&a!==void 0?a:!1)))})[0]}arrayconstrain(e,t){return this.runFunction(e.args,t,this.metadata("ARRAY_CONSTRAIN"),(r,n,i)=>{n=Math.min(n,r.height()),i=Math.min(i,r.width());const a=r.data,o=[];for(let u=0;u<n;u++)o.push(a[u].slice(0,i));return D.onlyValues(o)})}arrayconstrainArraySize(e,t){if(e.args.length!==3)return Z.error();const r=this.metadata("ARRAY_CONSTRAIN"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new Cr(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))});let{height:i,width:a}=n[0];return e.args[1].type===y.NUMBER&&(i=Math.min(i,e.args[1].value)),e.args[2].type===y.NUMBER&&(a=Math.min(a,e.args[2].value)),i<1||a<1||!Number.isInteger(i)||!Number.isInteger(a)?Z.error():new Z(a,i)}filter(e,t){return this.runFunction(e.args,t,this.metadata("FILTER"),(r,...n)=>{for(const o of n)if(r.width()!==o.width()||r.height()!==o.height())return new g(R.NA,T.EqualLength);if(r.width()>1&&r.height()>1)return new g(R.NA,T.WrongDimension);const i=r.data,a=[];for(let o=0;o<r.height();o++){const u=[];for(let l=0;l<r.width();l++){let c=!0;for(const d of n)if(Id(d.data[o][l])!==!0){c=!1;break}c&&u.push(i[o][l])}u.length>0&&a.push(u)}return a.length>0?D.onlyValues(a):new g(R.NA,T.EmptyRange)})}filterArraySize(e,t){if(e.args.length<=1)return Z.error();const r=this.metadata("FILTER"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new Cr(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))}),i=Math.max(...n.map(o=>o.width)),a=Math.max(...n.map(o=>o.height));return new Z(i,a)}}Kd.implementedFunctions={ARRAYFORMULA:{method:"arrayformula",sizeOfResultArrayMethod:"arrayformulaArraySize",enableArrayArithmeticForArguments:!0,parameters:[{argumentType:h.ANY}]},ARRAY_CONSTRAIN:{method:"arrayconstrain",sizeOfResultArrayMethod:"arrayconstrainArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:1}],vectorizationForbidden:!0},FILTER:{method:"filter",sizeOfResultArrayMethod:"filterArraySize",enableArrayArithmeticForArguments:!0,parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class qd extends Q{abs(e,t){return this.runFunction(e.args,t,this.metadata("ABS"),Math.abs)}}qd.implementedFunctions={ABS:{method:"abs",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const hv=0xffffffffffff,ql=-53,Ql=53;class Qd extends Q{bitlshift(e,t){return this.runFunction(e.args,t,this.metadata("BITLSHIFT"),Zd)}bitrshift(e,t){return this.runFunction(e.args,t,this.metadata("BITRSHIFT"),Jd)}}Qd.implementedFunctions={BITLSHIFT:{method:"bitlshift",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:ql,maxValue:Ql}]},BITRSHIFT:{method:"bitrshift",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:ql,maxValue:Ql}]}};function Zd(s,e){return e<0?Jd(s,-e):ef(s*Math.pow(2,e))}function Jd(s,e){return e<0?Zd(s,-e):ef(Math.floor(s/Math.pow(2,e)))}function ef(s){return s>hv?new g(R.NUM,T.BitshiftLong):s}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class tf extends Q{bitand(e,t){return this.runFunction(e.args,t,this.metadata("BITAND"),(r,n)=>r&n)}bitor(e,t){return this.runFunction(e.args,t,this.metadata("BITOR"),(r,n)=>r|n)}bitxor(e,t){return this.runFunction(e.args,t,this.metadata("BITXOR"),(r,n)=>r^n)}}tf.implementedFunctions={BITAND:{method:"bitand",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0}]},BITOR:{method:"bitor",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0}]},BITXOR:{method:"bitxor",parameters:[{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class rf extends Q{literalTrue(e,t){return this.runFunction(e.args,t,this.metadata("TRUE"),()=>!0)}literalFalse(e,t){return this.runFunction(e.args,t,this.metadata("FALSE"),()=>!1)}conditionalIf(e,t){return this.runFunction(e.args,t,this.metadata("IF"),(r,n,i)=>r?n:i)}ifs(e,t){return this.runFunction(e.args,t,this.metadata("IFS"),(...r)=>{for(let n=0;n<r.length;n+=2)if(r[n])return r[n+1];return new g(R.NA,T.NoConditionMet)})}and(e,t){return this.runFunction(e.args,t,this.metadata("AND"),(...r)=>r.filter(n=>n!==void 0).every(n=>!!n))}or(e,t){return this.runFunction(e.args,t,this.metadata("OR"),(...r)=>r.filter(n=>n!==void 0).some(n=>n))}not(e,t){return this.runFunction(e.args,t,this.metadata("NOT"),r=>!r)}xor(e,t){return this.runFunction(e.args,t,this.metadata("XOR"),(...r)=>{let n=0;return r.filter(i=>i!==void 0).forEach(i=>{i&&n++}),n%2===1})}switch(e,t){return this.runFunction(e.args,t,this.metadata("SWITCH"),(r,...n)=>{const i=n.length;let a=0;for(;a+1<i;a+=2)if(!(n[a]instanceof g)&&this.arithmeticHelper.eq(r,n[a]))return n[a+1];return a<i?n[a]:new g(R.NA,T.NoDefault)})}iferror(e,t){return this.runFunction(e.args,t,this.metadata("IFERROR"),(r,n)=>r instanceof g?n:r)}ifna(e,t){return this.runFunction(e.args,t,this.metadata("IFNA"),(r,n)=>r instanceof g&&r.type===R.NA?n:r)}choose(e,t){return this.runFunction(e.args,t,this.metadata("CHOOSE"),(r,...n)=>r>n.length?new g(R.NUM,T.Selector):n[r-1])}}rf.implementedFunctions={TRUE:{method:"literalTrue",parameters:[]},FALSE:{method:"literalFalse",parameters:[]},IF:{method:"conditionalIf",parameters:[{argumentType:h.BOOLEAN},{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,defaultValue:!1,passSubtype:!0}]},IFS:{method:"ifs",parameters:[{argumentType:h.BOOLEAN},{argumentType:h.SCALAR,passSubtype:!0}],repeatLastArgs:2},AND:{method:"and",parameters:[{argumentType:h.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},OR:{method:"or",parameters:[{argumentType:h.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},XOR:{method:"xor",parameters:[{argumentType:h.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},NOT:{method:"not",parameters:[{argumentType:h.BOOLEAN}]},SWITCH:{method:"switch",parameters:[{argumentType:h.NOERROR},{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,passSubtype:!0}],repeatLastArgs:1},IFERROR:{method:"iferror",parameters:[{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,passSubtype:!0}]},IFNA:{method:"ifna",parameters:[{argumentType:h.SCALAR,passSubtype:!0},{argumentType:h.SCALAR,passSubtype:!0}]},CHOOSE:{method:"choose",parameters:[{argumentType:h.INTEGER,minValue:1},{argumentType:h.SCALAR,passSubtype:!0}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class nf extends Q{char(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),r=>r<1||r>=256?new g(R.VALUE,T.CharacterCodeBounds):String.fromCharCode(Math.trunc(r)))}unichar(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),r=>r<1||r>=1114112?new g(R.VALUE,T.CharacterCodeBounds):String.fromCodePoint(Math.trunc(r)))}}nf.implementedFunctions={CHAR:{method:"char",parameters:[{argumentType:h.NUMBER}]},UNICHAR:{method:"unichar",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class sf extends Q{code(e,t){return this.runFunction(e.args,t,this.metadata("CODE"),r=>r.length===0?new g(R.VALUE,T.EmptyString):r.charCodeAt(0))}unicode(e,t){return this.runFunction(e.args,t,this.metadata("UNICODE"),r=>{var n;return(n=r.codePointAt(0))!==null&&n!==void 0?n:new g(R.VALUE,T.EmptyString)})}}sf.implementedFunctions={CODE:{method:"code",parameters:[{argumentType:h.STRING}]},UNICODE:{method:"unicode",parameters:[{argumentType:h.STRING}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class af extends Q{countblank(e,t){return this.runFunction(e.args,t,this.metadata("COUNTBLANK"),(...r)=>{let n=0;return r.forEach(i=>{i===te&&n++}),n})}}af.implementedFunctions={COUNTBLANK:{method:"countblank",parameters:[{argumentType:h.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class of extends Q{countunique(e,t){return this.runFunction(e.args,t,this.metadata("COUNTUNIQUE"),(...r)=>{const n=new Set,i=new Set;for(const a of r)a instanceof g?i.add(a.type):a!==""&&n.add(a);return n.size+i.size})}}of.implementedFunctions={COUNTUNIQUE:{method:"countunique",parameters:[{argumentType:h.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class uf extends Q{constructor(){super(...arguments),this.isoweeknumCore=e=>{const t=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),r=this.dateTimeHelper.numberToSimpleDate(e),n=this.dateTimeHelper.dateToNumber({year:r.year,month:1,day:1}),i=this.dateTimeHelper.relativeNumberToAbsoluteNumber(n),a=i+((4-i)%7+7)%7,o=Math.floor((t-1)/7)-Math.floor((a-1)/7)+1;return o===0?this.isoweeknumCore(e-7)+1:o},this.days360Core=(e,t,r)=>{const n=this.dateTimeHelper.numberToSimpleDate(e),i=this.dateTimeHelper.numberToSimpleDate(t);let a,o;return r?(a=Vl(n),o=Vl(i)):[a,o]=this.dateTimeHelper.toBasisUS(n,i),360*(o.year-a.year)+30*(o.month-a.month)+o.day-a.day}}date(e,t){return this.runFunction(e.args,t,this.metadata("DATE"),(r,n,i)=>{const a=Math.trunc(i);let o=Math.trunc(n),u=Math.trunc(r);u<this.dateTimeHelper.getEpochYearZero()&&(u+=this.dateTimeHelper.getEpochYearZero());const l=Math.floor((o-1)/12);u+=l,o-=l*12;const c={year:u,month:o,day:1};if(this.dateTimeHelper.isValidDate(c)){let d=this.dateTimeHelper.dateToNumber(c)+(a-1);return d=this.dateTimeHelper.getWithinBounds(d),d===void 0?new g(R.NUM,T.DateBounds):d}return new g(R.VALUE,T.InvalidDate)})}time(e,t){return this.runFunction(e.args,t,this.metadata("TIME"),(r,n,i)=>{const a=Kn({hours:Math.trunc(r),minutes:Math.trunc(n),seconds:Math.trunc(i)});return a<0?new g(R.NUM,T.NegativeTime):a%1})}eomonth(e,t){return this.runFunction(e.args,t,this.metadata("EOMONTH"),(r,n)=>{const i=this.dateTimeHelper.numberToSimpleDate(r);let a=this.dateTimeHelper.dateToNumber(this.dateTimeHelper.endOfMonth(Dl(i,n)));return a=this.dateTimeHelper.getWithinBounds(a),a===void 0?new g(R.NUM,T.DateBounds):a})}day(e,t){return this.runFunction(e.args,t,this.metadata("DAY"),r=>this.dateTimeHelper.numberToSimpleDate(r).day)}days(e,t){return this.runFunction(e.args,t,this.metadata("DAYS"),(r,n)=>Math.trunc(r)-Math.trunc(n))}month(e,t){return this.runFunction(e.args,t,this.metadata("MONTH"),r=>this.dateTimeHelper.numberToSimpleDate(r).month)}year(e,t){return this.runFunction(e.args,t,this.metadata("YEAR"),r=>this.dateTimeHelper.numberToSimpleDate(r).year)}hour(e,t){return this.runFunction(e.args,t,this.metadata("HOUR"),r=>Xn(Ka(r)%1).hours)}minute(e,t){return this.runFunction(e.args,t,this.metadata("MINUTE"),r=>Xn(Ka(r)%1).minutes)}second(e,t){return this.runFunction(e.args,t,this.metadata("SECOND"),r=>Xn(Ka(r)%1).seconds)}text(e,t){return this.runFunction(e.args,t,this.metadata("TEXT"),(r,n)=>QN(r,n,this.config,this.dateTimeHelper))}weekday(e,t){return this.runFunction(e.args,t,this.metadata("WEEKDAY"),(r,n)=>{const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(r));if(n===3)return(i-1)%7;const a=ec.get(n);return a===void 0?new g(R.NUM,T.BadMode):(i-a)%7+1})}weeknum(e,t){return this.runFunction(e.args,t,this.metadata("WEEKNUM"),(r,n)=>{const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(r)),a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.dateToNumber({year:a.year,month:1,day:1}),u=this.dateTimeHelper.relativeNumberToAbsoluteNumber(o);if(n===21)return this.isoweeknumCore(r);const l=ec.get(n);return l===void 0?new g(R.NUM,T.BadMode):Math.floor((i-l)/7)-Math.floor((u-l)/7)+1})}isoweeknum(e,t){return this.runFunction(e.args,t,this.metadata("ISOWEEKNUM"),this.isoweeknumCore)}datevalue(e,t){return this.runFunction(e.args,t,this.metadata("DATEVALUE"),r=>{const{dateTime:n}=this.dateTimeHelper.parseDateTimeFromConfigFormats(r);return n===void 0?new g(R.VALUE,T.IncorrectDateTime):Fs(n)?(Fd(n)?Math.trunc(Kn(n)):0)+this.dateTimeHelper.dateToNumber(n):0})}timevalue(e,t){return this.runFunction(e.args,t,this.metadata("TIMEVALUE"),r=>{const n=this.dateTimeHelper.dateStringToDateNumber(r);return n===void 0?new g(R.VALUE,T.IncorrectDateTime):F(n)%1})}now(e,t){return this.runFunction(e.args,t,this.metadata("NOW"),()=>{const r=new Date(Date.now());return Kn({hours:r.getHours(),minutes:r.getMinutes(),seconds:r.getSeconds()})+this.dateTimeHelper.dateToNumber({year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()})})}today(e,t){return this.runFunction(e.args,t,this.metadata("TODAY"),()=>{const r=new Date(Date.now());return this.dateTimeHelper.dateToNumber({year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()})})}edate(e,t){return this.runFunction(e.args,t,this.metadata("EDATE"),(r,n)=>{const i=this.dateTimeHelper.numberToSimpleDate(r),a=jN(Dl(i,n));let o=this.dateTimeHelper.dateToNumber(a);return o=this.dateTimeHelper.getWithinBounds(o),o===void 0?new g(R.NUM,T.DateBounds):o})}datedif(e,t){return this.runFunction(e.args,t,this.metadata("DATEDIF"),(r,n,i)=>{if(r>n)return new g(R.NUM,T.StartEndDate);if(i==="D")return Math.floor(n)-Math.floor(r);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);switch(i){case"M":return(o.year-a.year)*12+(o.month-a.month)-(o.day<a.day?1:0);case"YM":return(12+(o.month-a.month)-(o.day<a.day?1:0))%12;case"Y":return o.month>a.month||o.month===a.month&&o.day>=a.day?o.year-a.year:o.year-a.year-1;case"MD":if(o.day>=a.day)return o.day-a.day;{const u=o.month===1?12:o.month-1,l=o.month===1?o.year-1:o.year;return this.dateTimeHelper.daysInMonth(l,u)+o.day-a.day}case"YD":return o.month>a.month||o.month===a.month&&o.day>=a.day?Math.floor(n)-this.dateTimeHelper.dateToNumber({year:o.year,month:a.month,day:a.day}):Math.floor(n)-Math.floor(r)-365*(o.year-a.year-1)-this.dateTimeHelper.leapYearsCount(o.year-1)+this.dateTimeHelper.leapYearsCount(a.year);default:return new g(R.NUM,T.BadMode)}})}days360(e,t){return this.runFunction(e.args,t,this.metadata("DAYS360"),this.days360Core)}yearfrac(e,t){return this.runFunction(e.args,t,this.metadata("YEARFRAC"),(r,n,i)=>{switch(r=Math.trunc(r),n=Math.trunc(n),r>n&&([r,n]=[n,r]),i){case 0:return this.days360Core(r,n,!1)/360;case 1:return(n-r)/this.dateTimeHelper.yearLengthForBasis(this.dateTimeHelper.numberToSimpleDate(r),this.dateTimeHelper.numberToSimpleDate(n));case 2:return(n-r)/360;case 3:return(n-r)/365;case 4:return this.days360Core(r,n,!0)/360}throw new Error("Should not be reachable.")})}interval(e,t){return this.runFunction(e.args,t,this.metadata("INTERVAL"),r=>{r=Math.trunc(r);const n=r%60;r=Math.trunc(r/60);const i=r%60;r=Math.trunc(r/60);const a=r%24;r=Math.trunc(r/24);const o=r%30;r=Math.trunc(r/30);const u=r%12,l=Math.trunc(r/12);return"P"+(l>0?`${l}Y`:"")+(u>0?`${u}M`:"")+(o>0?`${o}D`:"")+"T"+(a>0?`${a}H`:"")+(i>0?`${i}M`:"")+(n>0?`${n}S`:"")})}networkdays(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS"),(r,n,i)=>this.networkdayscore(r,n,1,i))}networkdaysintl(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS.INTL"),(r,n,i,a)=>this.networkdayscore(r,n,i,a))}workday(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY"),(r,n,i)=>this.workdaycore(r,n,1,i))}workdayintl(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY.INTL"),(r,n,i,a)=>this.workdaycore(r,n,i,a))}networkdayscore(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t);let i=1;e>t&&([e,t]=[t,e],i=-1);const a=Jl(r);if(a instanceof g)return a;const o=this.simpleRangeToFilteredHolidays(a,n);return o instanceof g?o:i*this.countWorkdays(e,t,a,o)}workdaycore(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t);const i=Jl(r);if(i instanceof g)return i;const a=this.simpleRangeToFilteredHolidays(i,n);if(a instanceof g)return a;if(t>0){let o=1;for(;this.countWorkdays(e+1,e+o,i,a)<t;)o*=2;let u=1;for(;u+1<o;){const l=Math.trunc((u+o)/2);this.countWorkdays(e+1,e+l,i,a)<t?u=l:o=l}return e+o}else if(t<0){t*=-1;let o=1;for(;this.countWorkdays(e-o,e-1,i,a)<t;)o*=2;let u=1;for(;u+1<o;){const l=Math.trunc((u+o)/2);this.countWorkdays(e-l,e-1,i,a)<t?u=l:o=l}return e-o}else return e}countWorkdays(e,t,r,n){const i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(t)),a=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e));let o=0;for(let u=0;u<7;u++)r.charAt(u)==="0"&&(o+=Math.floor((i+6-u)/7),o-=Math.floor((a-1+6-u)/7));return o-=Zl(t+1,n)-Zl(e,n),o}simpleRangeToFilteredHolidays(e,t){var r;const n=(r=t?.valuesFromTopLeftCorner())!==null&&r!==void 0?r:[];for(const a of n)if(a instanceof g)return a;const i=[];for(const a of n)if(a!==te)if(de(a))i.push(Math.trunc(F(a)));else return new g(R.VALUE,T.WrongType);return[...new Set(i)].sort((a,o)=>a-o).filter(a=>{const u=(this.dateTimeHelper.relativeNumberToAbsoluteNumber(a)-1)%7;return e.charAt(u)==="0"})}}uf.implementedFunctions={DATE:{method:"date",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:k.NUMBER_DATE},TIME:{method:"time",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:k.NUMBER_TIME},MONTH:{method:"month",parameters:[{argumentType:h.NUMBER,minValue:0}]},YEAR:{method:"year",parameters:[{argumentType:h.NUMBER,minValue:0}]},HOUR:{method:"hour",parameters:[{argumentType:h.NUMBER,minValue:0}]},MINUTE:{method:"minute",parameters:[{argumentType:h.NUMBER,minValue:0}]},SECOND:{method:"second",parameters:[{argumentType:h.NUMBER,minValue:0}]},TEXT:{method:"text",parameters:[{argumentType:h.NUMBER},{argumentType:h.STRING}]},EOMONTH:{method:"eomonth",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER}],returnNumberType:k.NUMBER_DATE},DAY:{method:"day",parameters:[{argumentType:h.NUMBER,minValue:0}]},DAYS:{method:"days",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0}]},WEEKDAY:{method:"weekday",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,defaultValue:1}]},WEEKNUM:{method:"weeknum",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,defaultValue:1}]},ISOWEEKNUM:{method:"isoweeknum",parameters:[{argumentType:h.NUMBER,minValue:0}]},DATEVALUE:{method:"datevalue",parameters:[{argumentType:h.STRING}],returnNumberType:k.NUMBER_DATE},TIMEVALUE:{method:"timevalue",parameters:[{argumentType:h.STRING}],returnNumberType:k.NUMBER_TIME},NOW:{method:"now",parameters:[],isVolatile:!0,returnNumberType:k.NUMBER_DATETIME},TODAY:{method:"today",parameters:[],isVolatile:!0,returnNumberType:k.NUMBER_DATE},EDATE:{method:"edate",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER}],returnNumberType:k.NUMBER_DATE},DAYS360:{method:"days360",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.BOOLEAN,defaultValue:!1}]},DATEDIF:{method:"datedif",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.STRING}]},YEARFRAC:{method:"yearfrac",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.INTEGER,defaultValue:0,minValue:0,maxValue:4}]},INTERVAL:{method:"interval",parameters:[{argumentType:h.NUMBER,minValue:0}]},NETWORKDAYS:{method:"networkdays",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.RANGE,optionalArg:!0}]},"NETWORKDAYS.INTL":{method:"networkdaysintl",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NOERROR,defaultValue:1},{argumentType:h.RANGE,optionalArg:!0}]},WORKDAY:{method:"workday",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER},{argumentType:h.RANGE,optionalArg:!0}]},"WORKDAY.INTL":{method:"workdayintl",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER},{argumentType:h.NOERROR,defaultValue:1},{argumentType:h.RANGE,optionalArg:!0}]}};function Zl(s,e){if(e.length===0||s<=e[0])return 0;if(e[e.length-1]<s)return e.length;let t=0,r=e.length-1;for(;t+1<r;){const n=Math.floor((r+t)/2);e[n]>=s?r=n:t=n}return r}function Jl(s){var e;return typeof s!="number"&&typeof s!="string"?new g(R.VALUE,T.WrongType):typeof s=="string"?s.length!==7||!/^(0|1)*$/.test(s)||s==="1111111"?new g(R.NUM,T.WeekendString):s:(e=dv.get(s))!==null&&e!==void 0?e:new g(R.NUM,T.BadMode)}const ec=new Map([[1,0],[2,1],[11,1],[12,2],[13,3],[14,4],[15,5],[16,6],[17,0]]),dv=new Map([[1,"0000011"],[2,"1000001"],[3,"1100000"],[4,"0110000"],[5,"0011000"],[6,"0001100"],[7,"0000110"],[11,"0000001"],[12,"1000000"],[13,"0100000"],[14,"0010000"],[15,"0001000"],[16,"0000100"],[17,"0000010"]]);/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class lf extends Q{degrees(e,t){return this.runFunction(e.args,t,this.metadata("DEGREES"),r=>r*(180/Math.PI))}}lf.implementedFunctions={DEGREES:{method:"degrees",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class cf extends Q{delta(e,t){return this.runFunction(e.args,t,this.metadata("DELTA"),(r,n)=>r===n?1:0)}}cf.implementedFunctions={DELTA:{method:"delta",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class hf extends Q{exp(e,t){return this.runFunction(e.args,t,this.metadata("EXP"),Math.exp)}}hf.implementedFunctions={EXP:{method:"exp",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class df extends Q{pmt(e,t){return this.runFunction(e.args,t,this.metadata("PMT"),vu)}ipmt(e,t){return this.runFunction(e.args,t,this.metadata("IPMT"),Uo)}ppmt(e,t){return this.runFunction(e.args,t,this.metadata("PPMT"),tc)}fv(e,t){return this.runFunction(e.args,t,this.metadata("FV"),Po)}cumipmt(e,t){return this.runFunction(e.args,t,this.metadata("CUMIPMT"),(r,n,i,a,o,u)=>{if(a>o)return new g(R.NUM,T.EndStartPeriod);let l=0;for(let c=a;c<=o;c++)l+=Uo(r,c,n,i,0,u);return l})}cumprinc(e,t){return this.runFunction(e.args,t,this.metadata("CUMPRINC"),(r,n,i,a,o,u)=>{if(a>o)return new g(R.NUM,T.EndStartPeriod);let l=0;for(let c=a;c<=o;c++)l+=tc(r,c,n,i,0,u);return l})}db(e,t){return this.runFunction(e.args,t,this.metadata("DB"),(r,n,i,a,o)=>{if(o===12&&a>i||a>i+1)return new g(R.NUM,T.PeriodLong);if(n>=r)return 0;const u=Math.round((1-Math.pow(n/r,1/i))*1e3)/1e3,l=r*u*o/12;if(a===1)return l;let c=l;for(let d=0;d<a-2;d++)c+=(r-c)*u;return a===i+1?(r-c)*u*(12-o)/12:(r-c)*u})}ddb(e,t){return this.runFunction(e.args,t,this.metadata("DDB"),(r,n,i,a,o)=>{if(a>i)return new g(R.NUM);let u=o/i,l;u>=1?(u=1,a===1?l=r:l=0):l=r*Math.pow(1-u,a-1);const c=r*Math.pow(1-u,a);return Math.max(l-Math.max(n,c),0)})}dollarde(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARDE"),(r,n)=>{if(n<1)return new g(R.DIV_BY_ZERO);for(n=Math.trunc(n);n>10;)n/=10;return Math.trunc(r)+(r-Math.trunc(r))*10/n})}dollarfr(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARFR"),(r,n)=>{if(n<1)return new g(R.DIV_BY_ZERO);for(n=Math.trunc(n);n>10;)n/=10;return Math.trunc(r)+(r-Math.trunc(r))*n/10})}effect(e,t){return this.runFunction(e.args,t,this.metadata("EFFECT"),(r,n)=>(n=Math.trunc(n),Math.pow(1+r/n,n)-1))}ispmt(e,t){return this.runFunction(e.args,t,this.metadata("ISPMT"),(r,n,i,a)=>i===0?new g(R.DIV_BY_ZERO):a*r*(n/i-1))}nominal(e,t){return this.runFunction(e.args,t,this.metadata("NOMINAL"),(r,n)=>(n=Math.trunc(n),(Math.pow(r+1,1/n)-1)*n))}nper(e,t){return this.runFunction(e.args,t,this.metadata("NPER"),(r,n,i,a,o)=>r===0?n===0?new g(R.DIV_BY_ZERO):(-i-a)/n:(o&&(n*=1+r),Math.log((n-a*r)/(i*r+n))/Math.log(1+r)))}rate(e,t){return this.runFunction(e.args,t,this.metadata("RATE"),(r,n,i,a,o,u)=>{if(u<=-1)return new g(R.VALUE);const l=1e-7,c=50;let d=u;o=o?1:0;for(let f=0;f<c;f++){if(d<=-1)return new g(R.NUM);let p;if(Math.abs(d)<l)p=i*(1+r*d)+n*(1+d*o)*r+a;else{const m=Math.pow(1+d,r);p=i*m+n*(1/d+o)*(m-1)+a}if(Math.abs(p)<l)return d;let E;if(Math.abs(d)<l)E=i*r+n*o*r;else{const m=Math.pow(1+d,r),S=r*Math.pow(1+d,r-1);E=i*S+n*(1/d+o)*S+n*(-1/(d*d))*(m-1)}d-=p/E}return new g(R.NUM)})}pv(e,t){return this.runFunction(e.args,t,this.metadata("PV"),(r,n,i,a,o)=>(o=o?1:0,r===-1?n===0?new g(R.NUM):new g(R.DIV_BY_ZERO):r===0?-i*n-a:((1-Math.pow(1+r,n))*i*(1+r*o)/r-a)/Math.pow(1+r,n)))}rri(e,t){return this.runFunction(e.args,t,this.metadata("RRI"),(r,n,i)=>n===0||i<0&&n>0||i>0&&n<0?new g(R.NUM):Math.pow(i/n,1/r)-1)}sln(e,t){return this.runFunction(e.args,t,this.metadata("SLN"),(r,n,i)=>i===0?new g(R.DIV_BY_ZERO):(r-n)/i)}syd(e,t){return this.runFunction(e.args,t,this.metadata("SYD"),(r,n,i,a)=>a>i?new g(R.NUM):(r-n)*(i-a+1)*2/(i*(i+1)))}tbilleq(e,t){return this.runFunction(e.args,t,this.metadata("TBILLEQ"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new g(R.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);if(o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day))return new g(R.NUM);const u=360-i*(n-r);return u===0?0:u<0?new g(R.NUM):365*i/u})}tbillprice(e,t){return this.runFunction(e.args,t,this.metadata("TBILLPRICE"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new g(R.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);if(o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day))return new g(R.NUM);const u=360-i*(n-r);return u===0?0:u<0?new g(R.NUM):100*(1-i*(n-r)/360)})}tbillyield(e,t){return this.runFunction(e.args,t,this.metadata("TBILLYIELD"),(r,n,i)=>{if(r=Math.round(r),n=Math.round(n),r>=n)return new g(R.NUM);const a=this.dateTimeHelper.numberToSimpleDate(r),o=this.dateTimeHelper.numberToSimpleDate(n);return o.year>a.year+1||o.year===a.year+1&&(o.month>a.month||o.month===a.month&&o.day>a.day)?new g(R.NUM):(100-i)*360/(i*(n-r))})}fvschedule(e,t){return this.runFunction(e.args,t,this.metadata("FVSCHEDULE"),(r,n)=>{const i=n.valuesFromTopLeftCorner();for(const a of i)if(a instanceof g)return a;for(const a of i)if(de(a))r*=1+F(a);else if(a!==te)return new g(R.VALUE,T.NumberExpected);return r})}npv(e,t){return this.runFunction(e.args,t,this.metadata("NPV"),(r,...n)=>{const i=this.arithmeticHelper.coerceNumbersExactRanges(n);return i instanceof g?i:Za(r,i)})}mirr(e,t){return this.runFunction(e.args,t,this.metadata("MIRR"),(r,n,i)=>{const a=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());if(a instanceof g)return a;let o=!1,u=!1;const l=[],c=[];for(const E of a)E>0?(o=!0,l.push(E),c.push(0)):E<0?(u=!0,c.push(E),l.push(0)):(c.push(0),l.push(0));if(!o||!u)return new g(R.DIV_BY_ZERO);const d=a.length,f=Za(i,l);if(f instanceof g)return f;const p=Za(n,c);return p instanceof g?p:Math.pow(-f*Math.pow(1+i,d)/p/(1+n),1/(d-1))-1})}pduration(e,t){return this.runFunction(e.args,t,this.metadata("PDURATION"),(r,n,i)=>(Math.log(i)-Math.log(n))/Math.log(1+r))}xnpv(e,t){return this.runFunction(e.args,t,this.metadata("XNPV"),(r,n,i)=>{const a=n.valuesFromTopLeftCorner();for(const f of a)if(typeof f!="number")return new g(R.VALUE,T.NumberExpected);const o=a,u=i.valuesFromTopLeftCorner();for(const f of u)if(typeof f!="number")return new g(R.VALUE,T.NumberExpected);const l=u;if(l.length!==o.length)return new g(R.NUM,T.EqualLength);const c=l.length;let d=0;if(l[0]<0)return new g(R.NUM,T.ValueSmall);for(let f=0;f<c;f++){if(l[f]=Math.floor(l[f]),l[f]<l[0])return new g(R.NUM,T.ValueSmall);d+=o[f]/Math.pow(1+r,(l[f]-l[0])/365)}return d})}}df.implementedFunctions={PMT:{method:"pmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:k.NUMBER_CURRENCY},IPMT:{method:"ipmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:k.NUMBER_CURRENCY},PPMT:{method:"ppmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:k.NUMBER_CURRENCY},FV:{method:"fv",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:k.NUMBER_CURRENCY},CUMIPMT:{method:"cumipmt",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:0,maxValue:1}],returnNumberType:k.NUMBER_CURRENCY},CUMPRINC:{method:"cumprinc",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:1},{argumentType:h.INTEGER,minValue:0,maxValue:1}],returnNumberType:k.NUMBER_CURRENCY},DB:{method:"db",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:0},{argumentType:h.INTEGER,minValue:1,maxValue:12,defaultValue:12}],returnNumberType:k.NUMBER_CURRENCY},DDB:{method:"ddb",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.INTEGER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0,defaultValue:2}],returnNumberType:k.NUMBER_CURRENCY},DOLLARDE:{method:"dollarde",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},DOLLARFR:{method:"dollarfr",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},EFFECT:{method:"effect",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1}],returnNumberType:k.NUMBER_PERCENT},ISPMT:{method:"ispmt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},NOMINAL:{method:"nominal",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1}],returnNumberType:k.NUMBER_PERCENT},NPER:{method:"nper",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}]},PV:{method:"pv",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0}],returnNumberType:k.NUMBER_CURRENCY},RATE:{method:"rate",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:.1}],returnNumberType:k.NUMBER_PERCENT},RRI:{method:"rri",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:k.NUMBER_PERCENT},SLN:{method:"sln",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:k.NUMBER_CURRENCY},SYD:{method:"syd",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:k.NUMBER_CURRENCY},TBILLEQ:{method:"tbilleq",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:k.NUMBER_PERCENT},TBILLPRICE:{method:"tbillprice",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:k.NUMBER_CURRENCY},TBILLYIELD:{method:"tbillyield",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0}],returnNumberType:k.NUMBER_PERCENT},FVSCHEDULE:{method:"fvschedule",parameters:[{argumentType:h.NUMBER},{argumentType:h.RANGE}],returnNumberType:k.NUMBER_CURRENCY},NPV:{method:"npv",parameters:[{argumentType:h.NUMBER},{argumentType:h.ANY}],repeatLastArgs:1,returnNumberType:k.NUMBER_CURRENCY},MIRR:{method:"mirr",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER}],returnNumberType:k.NUMBER_PERCENT},PDURATION:{method:"pduration",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0}]},XNPV:{method:"xnpv",parameters:[{argumentType:h.NUMBER,greaterThan:-1},{argumentType:h.RANGE},{argumentType:h.RANGE}]}};function vu(s,e,t,r,n){if(s===0)return(-t-r)/e;{const i=Math.pow(1+s,e);return(r*s+t*s*i)*(n?1/(1+s):1)/(1-i)}}function Uo(s,e,t,r,n,i){const a=vu(s,t,r,n,i);return e===1?s*(i?0:-r):s*(i?Po(s,e-2,a,r,i)-a:Po(s,e-1,a,r,i))}function Po(s,e,t,r,n){if(s===0)return-r-t*e;{const i=Math.pow(1+s,e);return t*(n?1+s:1)*(1-i)/s-r*i}}function tc(s,e,t,r,n,i){return vu(s,t,r,n,i)-Uo(s,e,t,r,n,i)}function Za(s,e){let t=0;for(let r=e.length-1;r>=0;r--){if(t+=e[r],s===-1){if(t===0)continue;return new g(R.DIV_BY_ZERO)}t/=1+s}return t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ff extends Q{formulatext(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("FORMULATEXT"),()=>new g(R.NA,T.WrongArgNumber),r=>{var n;return(n=this.serialization.getCellFormula(r))!==null&&n!==void 0?n:new g(R.NA,T.Formula)})}}ff.implementedFunctions={FORMULATEXT:{method:"formulatext",parameters:[{argumentType:h.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,isDependentOnSheetStructureChange:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class pf extends Q{hyperlink(e,t){return this.runFunction(e.args,t,this.metadata("HYPERLINK"),(r,n)=>(e.hyperlink=r,n??r))}}pf.implementedFunctions={HYPERLINK:{method:"hyperlink",parameters:[{argumentType:h.STRING},{argumentType:h.STRING,optionalArg:!0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class mf extends Q{isbinary(e,t){return this.runFunction(e.args,t,this.metadata("ISBINARY"),r=>/^[01]{1,10}$/.test(r))}iserr(e,t){return this.runFunction(e.args,t,this.metadata("ISERR"),r=>r instanceof g&&r.type!==R.NA)}iserror(e,t){return this.runFunction(e.args,t,this.metadata("ISERROR"),r=>r instanceof g)}isformula(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ISFORMULA"),()=>new g(R.NA,T.WrongArgNumber),r=>this.dependencyGraph.addressMapping.getCell(r)instanceof Bt)}isblank(e,t){return this.runFunction(e.args,t,this.metadata("ISBLANK"),r=>r===te)}isna(e,t){return this.runFunction(e.args,t,this.metadata("ISNA"),r=>r instanceof g&&r.type==R.NA)}isnumber(e,t){return this.runFunction(e.args,t,this.metadata("ISNUMBER"),de)}islogical(e,t){return this.runFunction(e.args,t,this.metadata("ISLOGICAL"),r=>typeof r=="boolean")}isref(e,t){return this.runFunction(e.args,t,this.metadata("ISREF"),r=>r instanceof g&&(r.type==R.REF||r.type==R.CYCLE))}istext(e,t){return this.runFunction(e.args,t,this.metadata("ISTEXT"),r=>typeof r=="string")}isnontext(e,t){return this.runFunction(e.args,t,this.metadata("ISNONTEXT"),r=>typeof r!="string")}column(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("COLUMN"),()=>t.formulaAddress.col+1,r=>r.col+1)}columns(e,t){if(e.args.length!==1)return new g(R.NA,T.WrongArgNumber);if(e.args.some(n=>n.type===y.EMPTY))return new g(R.NUM,T.EmptyArg);let r=e.args[0];for(;r.type===y.PARENTHESIS;)r=r.expression;if(r.type===y.CELL_RANGE||r.type===y.COLUMN_RANGE)return r.end.col-r.start.col+1;if(r.type===y.CELL_REFERENCE)return 1;if(r.type===y.ROW_RANGE)return this.config.maxColumns;{const n=this.evaluateAst(r,t);return n instanceof D?n.width():n instanceof g?n:1}}row(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ROW"),()=>t.formulaAddress.row+1,r=>r.row+1)}rows(e,t){if(e.args.length!==1)return new g(R.NA,T.WrongArgNumber);if(e.args.some(n=>n.type===y.EMPTY))return new g(R.NUM,T.EmptyArg);let r=e.args[0];for(;r.type===y.PARENTHESIS;)r=r.expression;if(r.type===y.CELL_RANGE||r.type===y.ROW_RANGE)return r.end.row-r.start.row+1;if(r.type===y.CELL_REFERENCE)return 1;if(r.type===y.COLUMN_RANGE)return this.config.maxRows;{const n=this.evaluateAst(r,t);return n instanceof D?n.height():n instanceof g?n:1}}index(e,t){return this.runFunction(e.args,t,this.metadata("INDEX"),(r,n,i)=>{var a,o,u,l,c,d;return i<1||n<1?new g(R.VALUE,T.LessThanOne):i>r.width()||n>r.height()?new g(R.NUM,T.ValueLarge):(d=(u=(o=(a=r?.data)===null||a===void 0?void 0:a[n-1])===null||o===void 0?void 0:o[i-1])!==null&&u!==void 0?u:(c=(l=r?.data)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c[0])!==null&&d!==void 0?d:new g(R.VALUE,T.CellRangeExpected)})}na(e,t){return new g(R.NA)}sheet(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEET"),()=>t.formulaAddress.sheet+1,r=>r.sheet+1,r=>{const n=this.dependencyGraph.sheetMapping.get(r);return n!==void 0?n+1:new g(R.NA,T.SheetRef)})}sheets(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEETS"),()=>this.dependencyGraph.sheetMapping.numberOfSheets(),()=>1,()=>new g(R.VALUE,T.CellRefExpected))}}mf.implementedFunctions={COLUMN:{method:"column",parameters:[{argumentType:h.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},COLUMNS:{method:"columns",parameters:[{argumentType:h.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISBINARY:{method:"isbinary",parameters:[{argumentType:h.STRING}]},ISERR:{method:"iserr",parameters:[{argumentType:h.SCALAR}]},ISFORMULA:{method:"isformula",parameters:[{argumentType:h.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISNA:{method:"isna",parameters:[{argumentType:h.SCALAR}]},ISREF:{method:"isref",parameters:[{argumentType:h.SCALAR}],vectorizationForbidden:!0},ISERROR:{method:"iserror",parameters:[{argumentType:h.SCALAR}]},ISBLANK:{method:"isblank",parameters:[{argumentType:h.SCALAR}]},ISNUMBER:{method:"isnumber",parameters:[{argumentType:h.SCALAR}]},ISLOGICAL:{method:"islogical",parameters:[{argumentType:h.SCALAR}]},ISTEXT:{method:"istext",parameters:[{argumentType:h.SCALAR}]},ISNONTEXT:{method:"isnontext",parameters:[{argumentType:h.SCALAR}]},INDEX:{method:"index",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1}]},NA:{method:"na",parameters:[]},ROW:{method:"row",parameters:[{argumentType:h.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ROWS:{method:"rows",parameters:[{argumentType:h.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEET:{method:"sheet",parameters:[{argumentType:h.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEETS:{method:"sheets",parameters:[{argumentType:h.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class gf extends Q{iseven(e,t){return this.runFunction(e.args,t,this.metadata("ISEVEN"),r=>r%2===0)}}gf.implementedFunctions={ISEVEN:{method:"iseven",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ef extends Q{isodd(e,t){return this.runFunction(e.args,t,this.metadata("ISODD"),r=>r%2===1)}}Ef.implementedFunctions={ISODD:{method:"isodd",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Rf extends Q{log10(e,t){return this.runFunction(e.args,t,this.metadata("LOG10"),Math.log10)}log(e,t){return this.runFunction(e.args,t,this.metadata("LOG"),(r,n)=>Math.log(r)/Math.log(n))}ln(e,t){return this.runFunction(e.args,t,this.metadata("LN"),Math.log)}}Rf.implementedFunctions={LOG10:{method:"log10",parameters:[{argumentType:h.NUMBER}]},LOG:{method:"log",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,defaultValue:10,greaterThan:0}]},LN:{method:"ln",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Do=parseFloat(Math.PI.toFixed(14));class yf extends Q{pi(e,t){return this.runFunction(e.args,t,this.metadata("PI"),()=>Do)}sqrtpi(e,t){return this.runFunction(e.args,t,this.metadata("SQRTPI"),r=>Math.sqrt(Do*r))}}yf.implementedFunctions={PI:{method:"pi",parameters:[]},SQRTPI:{method:"sqrtpi",parameters:[{argumentType:h.NUMBER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function rc(s,e){return new Z(e.width,s.height)}function Ja(s,e,t){return new Z(1+(s.width-e)/t,1+(s.height-e)/t)}class Nf extends Q{mmult(e,t){return this.runFunction(e.args,t,this.metadata("MMULT"),(r,n)=>{if(!r.hasOnlyNumbers()||!n.hasOnlyNumbers())return new g(R.VALUE,T.NumberRange);if(n.height()!==r.width())return new g(R.VALUE,T.ArrayDimensions);const i=rc(r.size,n.size),a=this.createKernel(function(o,u,l){let c=0;for(let d=0;d<l;++d)c+=o[this.thread.y][d]*u[d][this.thread.x];return c},i)(r.rawNumbers(),n.rawNumbers(),r.width());return D.onlyNumbers(a)})}mmultArraySize(e,t){if(e.args.length!==2)return Z.error();const r=this.metadata("MMULT"),n=e.args.map(o=>{var u;return this.arraySizeForAst(o,new Cr(t.formulaAddress,t.arraysFlag||((u=r?.enableArrayArithmeticForArguments)!==null&&u!==void 0?u:!1)))}),[i,a]=n;return rc(i,a)}maxpool(e,t){return this.runFunction(e.args,t,this.metadata("MAXPOOL"),(r,n,i=n)=>{if(!r.hasOnlyNumbers())return new g(R.VALUE,T.NumberRange);const a=Ja(r.size,n,i),o=this.createKernel(function(u,l,c){const d=this.thread.x*c,f=this.thread.y*c;let p=u[f][d];for(let E=0;E<l;E++)for(let m=0;m<l;m++)p=Math.max(p,u[f+E][d+m]);return p},a)(r.rawNumbers(),n,i);return D.onlyNumbers(o)})}medianpool(e,t){return this.runFunction(e.args,t,this.metadata("MEDIANPOOL"),(r,n,i=n)=>{if(!r.hasOnlyNumbers())return new g(R.VALUE,T.NumberRange);const a=Ja(r.size,n,i),o=this.createKernel(function(u,l,c){const d=this.thread.x*c,f=this.thread.y*c;let p=u[f][d];for(let w=0;w<l;w++)for(let I=0;I<l;I++)p=Math.max(p,u[f+w][d+I]);let E=u[f][d];for(let w=0;w<l;w++)for(let I=0;I<l;I++)E=Math.min(E,u[f+w][d+I]);const m=l*l;let S=E,v=p,A=42;for(let w=0;w<32;w++){const I=(S+v)/2;let O=0;for(let _=0;_<l;_++)for(let x=0;x<l;x++)u[f+_][d+x]>I&&O++;if(l%2===0)if(O===m/2){A=I;break}else O>m/2?S=I:v=I;else if(O===(m-1)/2){A=I;break}else O>(m-1)/2?S=I:v=I}return A},a)(r.rawNumbers(),n,i);return D.onlyNumbers(o)})}maxpoolArraySize(e,t){if(e.args.length<2||e.args.length>3)return Z.error();const r=this.metadata("MAXPOOL"),i=e.args.map(l=>{var c;return this.arraySizeForAst(l,new Cr(t.formulaAddress,t.arraysFlag||((c=r?.enableArrayArithmeticForArguments)!==null&&c!==void 0?c:!1)))})[0],a=e.args[1];let o;a.type===y.NUMBER?o=a.value:o=1;let u=o;if(e.args.length===3){const l=e.args[2];l.type===y.NUMBER?u=l.value:u=1}return o>i.width||o>i.height||u>o||(i.width-o)%u!==0||(i.height-o)%u!==0?Z.error():Ja(i,o,u)}medianpoolArraySize(e,t){return this.maxpoolArraySize(e,t)}transpose(e,t){return this.runFunction(e.args,t,this.metadata("TRANSPOSE"),r=>{const n=r.rawData(),i=r.size,a=[];for(let o=0;o<i.width;++o){a[o]=[];for(let u=0;u<i.height;++u)a[o][u]=n[u][o]}return D.onlyValues(a)})}transposeArraySize(e,t){if(e.args.length!==1)return Z.error();const r=this.metadata("TRANSPOSE"),n=e.args.map(a=>{var o;return this.arraySizeForAst(a,new Cr(t.formulaAddress,t.arraysFlag||((o=r?.enableArrayArithmeticForArguments)!==null&&o!==void 0?o:!1)))}),[i]=n;return new Z(i.height,i.width)}createKernel(e,t){return function(...r){const n=[];for(let i=0;i<t.height;++i){n.push([]);for(let a=0;a<t.width;++a)n[i][a]=e.apply({thread:{x:a,y:i}},r)}return n}}}Nf.implementedFunctions={MMULT:{method:"mmult",sizeOfResultArrayMethod:"mmultArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}],vectorizationForbidden:!0},TRANSPOSE:{method:"transpose",sizeOfResultArrayMethod:"transposeArraySize",parameters:[{argumentType:h.RANGE}],vectorizationForbidden:!0},MAXPOOL:{method:"maxpool",sizeOfResultArrayMethod:"maxpoolArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}],vectorizationForbidden:!0},MEDIANPOOL:{method:"medianpool",sizeOfResultArrayMethod:"medianpoolArraySize",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}],vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Tf extends Q{median(e,t){return this.runFunction(e.args,t,this.metadata("MEDIAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);return n instanceof g?n:n.length===0?new g(R.NUM,T.OneValue):(n.sort((i,a)=>i-a),n.length%2===0?(n[n.length/2-1]+n[n.length/2])/2:n[Math.floor(n.length/2)])})}large(e,t){return this.runFunction(e.args,t,this.metadata("LARGE"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());return i instanceof g?i:(i.sort((a,o)=>a-o),n=Math.trunc(n),n>i.length?new g(R.NUM,T.ValueLarge):i[i.length-n])})}small(e,t){return this.runFunction(e.args,t,this.metadata("SMALL"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());return i instanceof g?i:(i.sort((a,o)=>a-o),n=Math.trunc(n),n>i.length?new g(R.NUM,T.ValueLarge):i[n-1])})}}Tf.implementedFunctions={MEDIAN:{method:"median",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},LARGE:{method:"large",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER,minValue:1}]},SMALL:{method:"small",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER,minValue:1}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class vf extends Q{mod(e,t){return this.runFunction(e.args,t,this.metadata("MOD"),(r,n)=>n===0?new g(R.DIV_BY_ZERO):r%n)}}vf.implementedFunctions={MOD:{method:"mod",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function Ni(s){return de(s)&&!Number.isFinite(F(s))?0:s}class ur{constructor(e,t,r){this.sumsq=e,this.sum=t,this.count=r}static single(e){return new ur(e*e,e,1)}compose(e){return new ur(this.sumsq+e.sumsq,this.sum+e.sum,this.count+e.count)}averageValue(){if(this.count>0)return this.sum/this.count}varSValue(){if(this.count>1)return(this.sumsq-this.sum*this.sum/this.count)/(this.count-1)}varPValue(){if(this.count>0)return(this.sumsq-this.sum*this.sum/this.count)/this.count}}ur.empty=new ur(0,0,0);class Su extends Q{constructor(){super(...arguments),this.addWithEpsilonRaw=(e,t)=>this.arithmeticHelper.addWithEpsilonRaw(e,t)}sum(e,t){return this.doSum(e.args,t)}sumsq(e,t){return this.reduce(e.args,t,0,"SUMSQ",this.addWithEpsilonRaw,r=>Math.pow(F(r),2),Fn)}max(e,t){return this.doMax(e.args,t)}maxa(e,t){const r=this.reduce(e.args,t,Number.NEGATIVE_INFINITY,"MAXA",(n,i)=>Math.max(n,i),F,Ti);return Ni(r)}min(e,t){return this.doMin(e.args,t)}mina(e,t){const r=this.reduce(e.args,t,Number.POSITIVE_INFINITY,"MINA",(n,i)=>Math.min(n,i),F,Ti);return Ni(r)}count(e,t){return this.doCount(e.args,t)}counta(e,t){return this.doCounta(e.args,t)}average(e,t){return this.doAverage(e.args,t)}averagea(e,t){var r;const n=this.reduce(e.args,t,ur.empty,"_AGGREGATE_A",(i,a)=>i.compose(a),i=>ur.single(F(i)),Ti);return n instanceof g?n:(r=n.averageValue())!==null&&r!==void 0?r:new g(R.DIV_BY_ZERO)}vars(e,t){return this.doVarS(e.args,t)}varp(e,t){return this.doVarP(e.args,t)}vara(e,t){var r;const n=this.reduceAggregateA(e.args,t);return n instanceof g?n:(r=n.varSValue())!==null&&r!==void 0?r:new g(R.DIV_BY_ZERO)}varpa(e,t){var r;const n=this.reduceAggregateA(e.args,t);return n instanceof g?n:(r=n.varPValue())!==null&&r!==void 0?r:new g(R.DIV_BY_ZERO)}stdevs(e,t){return this.doStdevS(e.args,t)}stdevp(e,t){return this.doStdevP(e.args,t)}stdeva(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof g)return r;{const n=r.varSValue();return n===void 0?new g(R.DIV_BY_ZERO):Math.sqrt(n)}}stdevpa(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof g)return r;{const n=r.varPValue();return n===void 0?new g(R.DIV_BY_ZERO):Math.sqrt(n)}}product(e,t){return this.doProduct(e.args,t)}subtotal(e,t){if(e.args.length<2)return new g(R.NA,T.WrongArgNumber);const r=this.coerceToType(this.evaluateAst(e.args[0],t),{argumentType:h.NUMBER},t),n=e.args.slice(1);switch(r){case 1:case 101:return this.doAverage(n,t);case 2:case 102:return this.doCount(n,t);case 3:case 103:return this.doCounta(n,t);case 4:case 104:return this.doMax(n,t);case 5:case 105:return this.doMin(n,t);case 6:case 106:return this.doProduct(n,t);case 7:case 107:return this.doStdevS(n,t);case 8:case 108:return this.doStdevP(n,t);case 9:case 109:return this.doSum(n,t);case 10:case 110:return this.doVarS(n,t);case 11:case 111:return this.doVarP(n,t);default:return new g(R.VALUE,T.BadMode)}}reduceAggregate(e,t){return this.reduce(e,t,ur.empty,"_AGGREGATE",(r,n)=>r.compose(n),r=>ur.single(F(r)),Fn)}reduceAggregateA(e,t){return this.reduce(e,t,ur.empty,"_AGGREGATE_A",(r,n)=>r.compose(n),r=>ur.single(F(r)),Ti)}doAverage(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof g?n:(r=n.averageValue())!==null&&r!==void 0?r:new g(R.DIV_BY_ZERO)}doVarS(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof g?n:(r=n.varSValue())!==null&&r!==void 0?r:new g(R.DIV_BY_ZERO)}doVarP(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof g?n:(r=n.varPValue())!==null&&r!==void 0?r:new g(R.DIV_BY_ZERO)}doStdevS(e,t){const r=this.reduceAggregate(e,t);if(r instanceof g)return r;{const n=r.varSValue();return n===void 0?new g(R.DIV_BY_ZERO):Math.sqrt(n)}}doStdevP(e,t){const r=this.reduceAggregate(e,t);if(r instanceof g)return r;{const n=r.varPValue();return n===void 0?new g(R.DIV_BY_ZERO):Math.sqrt(n)}}doCount(e,t){return this.reduce(e,t,0,"COUNT",(r,n)=>r+n,F,r=>de(r)?1:0)}doCounta(e,t){return this.reduce(e,t,0,"COUNTA",(r,n)=>r+n,F,r=>r===te?0:1)}doMax(e,t){const r=this.reduce(e,t,Number.NEGATIVE_INFINITY,"MAX",(n,i)=>Math.max(n,i),F,Fn);return Ni(r)}doMin(e,t){const r=this.reduce(e,t,Number.POSITIVE_INFINITY,"MIN",(n,i)=>Math.min(n,i),F,Fn);return Ni(r)}doSum(e,t){return this.reduce(e,t,0,"SUM",this.addWithEpsilonRaw,F,Fn)}doProduct(e,t){return this.reduce(e,t,1,"PRODUCT",(r,n)=>r*n,F,Fn)}reduce(e,t,r,n,i,a,o){return e.length<1?new g(R.NA,T.WrongArgNumber):e.reduce((u,l)=>{if(u instanceof g)return u;if(l.type===y.CELL_RANGE||l.type===y.COLUMN_RANGE||l.type===y.ROW_RANGE){const d=this.evaluateRange(l,t,r,n,i,a,o);return d instanceof g?d:i(d,u)}let c;if(c=this.evaluateAst(l,t),c instanceof D)return Array.from(c.valuesFromTopLeftCorner()).map(o).filter(f=>f!==void 0).map(f=>f instanceof g?f:a(f)).reduce((f,p)=>f instanceof g?f:p instanceof g?p:i(f,p),u);if(l.type===y.CELL_REFERENCE){if(c=o(c),c===void 0)return u}else if(c=this.coerceScalarToNumberOrError(c),c=o(c),c===void 0)return u;return c instanceof g?c:i(u,a(c))},r)}evaluateRange(e,t,r,n,i,a,o){let u;try{u=W.fromAst(e,t.formulaAddress)}catch(d){if(d instanceof zs)return new g(R.REF,T.RangeManySheets);throw d}const l=this.dependencyGraph.getRange(u.start,u.end);if(l===void 0)throw new Error("Range does not exists in graph");let c=l.getFunctionValue(n);return c===void 0&&(c=this.getRangeValues(n,u,l,a,o).reduce((f,p)=>f instanceof g?f:p instanceof g?p:i(f,p),r),l.setFunctionValue(n,c)),c}getRangeValues(e,t,r,n,i){const a=[],{smallerRangeVertex:o,restRange:u}=this.dependencyGraph.rangeMapping.findSmallerRange(t);let l;if(o!==void 0&&this.dependencyGraph.existsEdge(o,r)){const c=o.getFunctionValue(e);if(c!==void 0)a.push(c);else for(const d of o.range.addresses(this.dependencyGraph)){const f=i(this.dependencyGraph.getScalarValue(d));f instanceof g?a.push(f):f!==void 0&&a.push(n(f))}l=u}else l=t;for(const c of l.addresses(this.dependencyGraph)){const d=i(this.dependencyGraph.getScalarValue(c));d instanceof g?a.push(d):d!==void 0&&a.push(n(d))}return a}}Su.implementedFunctions={SUM:{method:"sum",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},SUMSQ:{method:"sumsq",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MAX:{method:"max",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MIN:{method:"min",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MAXA:{method:"maxa",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MINA:{method:"mina",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},COUNT:{method:"count",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},COUNTA:{method:"counta",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},AVERAGE:{method:"average",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},AVERAGEA:{method:"averagea",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},PRODUCT:{method:"product",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"VAR.S":{method:"vars",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"VAR.P":{method:"varp",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},VARA:{method:"vara",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},VARPA:{method:"varpa",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"STDEV.S":{method:"stdevs",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"STDEV.P":{method:"stdevp",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},STDEVA:{method:"stdeva",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},STDEVPA:{method:"stdevpa",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},SUBTOTAL:{method:"subtotal",parameters:[{argumentType:h.NUMBER},{argumentType:h.ANY}],repeatLastArgs:1}};Su.aliases={VAR:"VAR.S",VARP:"VAR.P",STDEV:"STDEV.S",STDEVP:"STDEV.P",VARS:"VAR.S",STDEVS:"STDEV.S"};function Fn(s){if(de(s)||s instanceof g)return s}function Ti(s){return typeof s=="boolean"?Co(s):de(s)||s instanceof g?s:typeof s=="string"?0:void 0}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Sf extends Q{power(e,t){return this.runFunction(e.args,t,this.metadata("POWER"),Math.pow)}}Sf.implementedFunctions={POWER:{method:"power",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Af extends Q{radians(e,t){return this.runFunction(e.args,t,this.metadata("RADIANS"),r=>r*(Math.PI/180))}}Af.implementedFunctions={RADIANS:{method:"radians",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const et=10,Cf=255,nc=2,sc=36,fv="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";class wf extends Q{dec2bin(e,t){return this.runFunction(e.args,t,this.metadata("DEC2BIN"),(r,n)=>_r(r,2,n))}dec2oct(e,t){return this.runFunction(e.args,t,this.metadata("DEC2OCT"),(r,n)=>_r(r,8,n))}dec2hex(e,t){return this.runFunction(e.args,t,this.metadata("DEC2HEX"),(r,n)=>_r(r,16,n))}bin2dec(e,t){return this.runFunction(e.args,t,this.metadata("BIN2DEC"),r=>{const n=Er(r,2,et);return n===void 0?new g(R.NUM,T.NotBinary):Lr(n,2)})}bin2oct(e,t){return this.runFunction(e.args,t,this.metadata("BIN2OCT"),(r,n)=>{const i=Er(r,2,et);return i===void 0?new g(R.NUM,T.NotBinary):_r(Lr(i,2),8,n)})}bin2hex(e,t){return this.runFunction(e.args,t,this.metadata("BIN2HEX"),(r,n)=>{const i=Er(r,2,et);return i===void 0?new g(R.NUM,T.NotBinary):_r(Lr(i,2),16,n)})}oct2dec(e,t){return this.runFunction(e.args,t,this.metadata("OCT2DEC"),r=>{const n=Er(r,8,et);return n===void 0?new g(R.NUM,T.NotOctal):Lr(n,8)})}oct2bin(e,t){return this.runFunction(e.args,t,this.metadata("OCT2BIN"),(r,n)=>{const i=Er(r,8,et);return i===void 0?new g(R.NUM,T.NotOctal):_r(Lr(i,8),2,n)})}oct2hex(e,t){return this.runFunction(e.args,t,this.metadata("OCT2HEX"),(r,n)=>{const i=Er(r,8,et);return i===void 0?new g(R.NUM,T.NotOctal):_r(Lr(i,8),16,n)})}hex2dec(e,t){return this.runFunction(e.args,t,this.metadata("HEX2DEC"),r=>{const n=Er(r,16,et);return n===void 0?new g(R.NUM,T.NotHex):Lr(n,16)})}hex2bin(e,t){return this.runFunction(e.args,t,this.metadata("HEX2BIN"),(r,n)=>{const i=Er(r,16,et);return i===void 0?new g(R.NUM,T.NotHex):_r(Lr(i,16),2,n)})}hex2oct(e,t){return this.runFunction(e.args,t,this.metadata("HEX2OCT"),(r,n)=>{const i=Er(r,16,et);return i===void 0?new g(R.NUM,T.NotHex):_r(Lr(i,16),8,n)})}base(e,t){return this.runFunction(e.args,t,this.metadata("BASE"),mv)}decimal(e,t){return this.runFunction(e.args,t,this.metadata("DECIMAL"),(r,n)=>{const i=Er(r,n,Cf);return i===void 0?new g(R.NUM,T.NotHex):parseInt(i,n)})}}wf.implementedFunctions={DEC2BIN:{method:"dec2bin",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2OCT:{method:"dec2oct",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2HEX:{method:"dec2hex",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},BIN2DEC:{method:"bin2dec",parameters:[{argumentType:h.STRING}]},BIN2OCT:{method:"bin2oct",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:et}]},BIN2HEX:{method:"bin2hex",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:et}]},OCT2DEC:{method:"oct2dec",parameters:[{argumentType:h.STRING}]},OCT2BIN:{method:"oct2bin",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:et}]},OCT2HEX:{method:"oct2hex",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:et}]},HEX2DEC:{method:"hex2dec",parameters:[{argumentType:h.STRING}]},HEX2BIN:{method:"hex2bin",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:et}]},HEX2OCT:{method:"hex2oct",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:et}]},DECIMAL:{method:"decimal",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,minValue:nc,maxValue:sc}]},BASE:{method:"base",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:nc,maxValue:sc},{argumentType:h.NUMBER,optionalArg:!0,minValue:0,maxValue:Cf}]}};function Er(s,e,t){const r=fv.substr(0,e),n=new RegExp(`^[${r}]+$`);if(!(s.length>t||!n.test(s)))return s}function _r(s,e,t){if(s>pv(e))return new g(R.NUM,T.ValueBaseLarge);if(s<If(e))return new g(R.NUM,T.ValueBaseSmall);const r=Mf(s,e);return t===void 0||s<0?r:r.length>t?new g(R.NUM,T.ValueBaseLong):St(r,t)}function If(s){return-Math.pow(s,et)/2}function pv(s){return-If(s)-1}function mv(s,e,t){const r=Mf(s,e);return t!==void 0&&t>r.length?St(r,t):r}function Mf(s,e){const t=s<0?Math.pow(e,et):0;return(s+t).toString(e).toUpperCase()}function Lr(s,e){const t=parseInt(s,e),r=Math.pow(e,et);return t>=r/2?t-r:t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Of extends Q{rand(e,t){return this.runFunction(e.args,t,this.metadata("RAND"),Math.random)}randbetween(e,t){return this.runFunction(e.args,t,this.metadata("RANDBETWEEN"),(r,n)=>n<r?new g(R.NUM,T.WrongOrder):(r=Math.ceil(r),n=Math.floor(n)+1,r===n&&(n+=1),r+Math.floor(Math.random()*(n-r))))}}Of.implementedFunctions={RAND:{method:"rand",parameters:[],isVolatile:!0},RANDBETWEEN:{method:"randbetween",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}],isVolatile:!0}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function ic(s){const e=Math.ceil(s);return e%2===1?e:e+1}function ac(s){const e=Math.ceil(s);return e%2===0?e:e+1}class Au extends Q{roundup(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.ceil(-r*i)/i:Math.ceil(r*i)/i})}rounddown(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.floor(-r*i)/i:Math.floor(r*i)/i})}round(e,t){return this.runFunction(e.args,t,this.metadata("ROUND"),(r,n)=>{const i=Math.pow(10,n);return r<0?-Math.round(-r*i)/i:Math.round(r*i)/i})}intFunc(e,t){return this.runFunction(e.args,t,this.metadata("INT"),r=>r<0?-Math.floor(-r):Math.floor(r))}even(e,t){return this.runFunction(e.args,t,this.metadata("EVEN"),r=>r<0?-ac(-r):ac(r))}odd(e,t){return this.runFunction(e.args,t,this.metadata("ODD"),r=>r<0?-ic(-r):ic(r))}ceilingmath(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.MATH"),(r,n,i)=>n===0||r===0?0:(n=Math.abs(n),i===1&&r<0&&(n=-n),Math.ceil(r/n)*n))}ceiling(e,t){return this.runFunction(e.args,t,this.metadata("CEILING"),(r,n)=>r===0?0:n===0?new g(R.DIV_BY_ZERO):r>0&&n<0?new g(R.NUM,T.DistinctSigns):Math.ceil(r/n)*n)}ceilingprecise(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.PRECISE"),(r,n)=>n===0||r===0?0:(n=Math.abs(n),Math.ceil(r/n)*n))}floormath(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.MATH"),(r,n,i)=>n===0||r===0?0:(n=Math.abs(n),i===1&&r<0&&(n*=-1),Math.floor(r/n)*n))}floor(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR"),(r,n)=>r===0?0:n===0?new g(R.DIV_BY_ZERO):r>0&&n<0?new g(R.NUM,T.DistinctSigns):Math.floor(r/n)*n)}floorprecise(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.PRECISE"),(r,n)=>n===0||r===0?0:(n=Math.abs(n),Math.floor(r/n)*n))}}Au.implementedFunctions={ROUNDUP:{method:"roundup",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]},ROUNDDOWN:{method:"rounddown",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]},ROUND:{method:"round",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:0}]},INT:{method:"intFunc",parameters:[{argumentType:h.NUMBER}]},EVEN:{method:"even",parameters:[{argumentType:h.NUMBER}]},ODD:{method:"odd",parameters:[{argumentType:h.NUMBER}]},"CEILING.MATH":{method:"ceilingmath",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1},{argumentType:h.NUMBER,defaultValue:0}]},CEILING:{method:"ceiling",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},"CEILING.PRECISE":{method:"ceilingprecise",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1}]},"FLOOR.MATH":{method:"floormath",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1},{argumentType:h.NUMBER,defaultValue:0}]},FLOOR:{method:"floor",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},"FLOOR.PRECISE":{method:"floorprecise",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,defaultValue:1}]}};Au.aliases={"ISO.CEILING":"CEILING.PRECISE",TRUNC:"ROUNDDOWN"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class bf extends Q{sqrt(e,t){return this.runFunction(e.args,t,this.metadata("SQRT"),Math.sqrt)}}bf.implementedFunctions={SQRT:{method:"sqrt",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */function*gv(){}function Ev(s){const e=s[Symbol.iterator](),{done:t,value:r}=e.next();return t?{rest:gv()}:{value:r,rest:e}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const Rv=(s,e,t)=>{if(t.end.row>t.start.row){const r=U(t.end.sheet,t.end.col,t.end.row-1),n=s.getRange(t.start,r);if(n!==void 0)return{smallerRangeVertex:n,restValuesRange:t.withStart(U(t.start.sheet,t.start.col,t.end.row)),restConditionRanges:e.map(i=>i.withStart(U(i.start.sheet,i.start.col,i.end.row)))}}return{restValuesRange:t,restConditionRanges:e}};class yv{constructor(e,t,r,n,i){this.interpreter=e,this.cacheKey=t,this.reduceInitialValue=r,this.composeFunction=n,this.mapFunction=i,this.dependencyGraph=this.interpreter.dependencyGraph}compute(e,t){for(const i of t)if(!i.conditionRange.sameDimensionsAs(e))return new g(R.VALUE,T.EqualLength);const r=this.tryToGetRangeVertexForRangeValue(e),n=t.map(i=>this.tryToGetRangeVertexForRangeValue(i.conditionRange));if(r&&n.every(i=>i!==void 0)){const i=t.map(u=>u.criterionPackage.raw).join(","),a=this.findAlreadyComputedValueInCache(r,this.cacheKey(t),i);if(a!==void 0)return this.interpreter.stats.incrementCriterionFunctionFullCacheUsed(),a;const o=this.buildNewCriterionCache(this.cacheKey(t),t.map(u=>u.conditionRange.range),e.range);return o.has(i)||o.set(i,[this.evaluateRangeValue(e,t),t.map(u=>u.criterionPackage.lambda)]),r.setCriterionFunctionValues(this.cacheKey(t),o),n.forEach(u=>{u!==void 0&&u.addDependentCacheRange(r)}),o.get(i)[0]}else return this.evaluateRangeValue(e,t)}tryToGetRangeVertexForRangeValue(e){const t=e.range;if(t!==void 0)return this.dependencyGraph.getRange(t.start,t.end)}reduceFunction(e){let t=this.reduceInitialValue;for(const r of e)t=this.composeFunction(t,r);return t}findAlreadyComputedValueInCache(e,t,r){return e.getCriterionFunctionValue(t,r)}evaluateRangeValue(e,t){const r=t.map(o=>o.criterionPackage.lambda),n=Array.from(e.valuesFromTopLeftCorner()).map(this.mapFunction)[Symbol.iterator](),i=t.map(o=>o.conditionRange.iterateValuesFromTopLeftCorner()),a=uc(r,i,n);return this.reduceFunction(a)}buildNewCriterionCache(e,t,r){const n=this.dependencyGraph.getRange(r.start,r.end),{smallerRangeVertex:i,restConditionRanges:a,restValuesRange:o}=Rv(this.dependencyGraph,t,r);let u;i!==void 0&&this.dependencyGraph.existsEdge(i,n)?u=i.getCriterionFunctionValues(e):u=new Map;const l=new Map;return u.forEach(([c,d],f)=>{const p=uc(d,a.map(m=>oc(this.dependencyGraph,m)),Array.from(oc(this.dependencyGraph,o)).map(this.mapFunction)[Symbol.iterator]()),E=this.composeFunction(c,this.reduceFunction(p));this.interpreter.stats.incrementCriterionFunctionPartialCacheUsed(),l.set(f,[E,d])}),l}}class Nv{constructor(e,t){this.conditionRange=e,this.criterionPackage=t}}function*oc(s,e){for(const t of e.addresses(s))yield F(s.getScalarValue(t))}function*uc(s,e,t){for(const r of t){const n=e.map(a=>Ev(a));if(!n.every(a=>Object.prototype.hasOwnProperty.call(a,"value")))return;const i=n.map(a=>F(a.value));Tv(i,s).every(([a,o])=>o(a))&&(yield r),e=n.map(a=>a.rest)}}function Tv(s,e){const t=[];for(let r=0;r<Math.min(s.length,e.length);r++)t.push([s[r],e[r]]);return t}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class nn{constructor(e,t){this.sum=e,this.count=t}static single(e){return new nn(e,1)}compose(e){return new nn(this.sum+e.sum,this.count+e.count)}averageValue(){if(this.count>0)return this.sum/this.count}}nn.empty=new nn(0,0);function vv(s){return e=>{const t=e.map(r=>`${r.conditionRange.range.sheet},${r.conditionRange.range.start.col},${r.conditionRange.range.start.row}`);return[s,...t].join(",")}}function lc(s){return de(s)&&!Number.isFinite(F(s))?0:s}function vi(s){if(s instanceof g)return s;if(de(s))return F(s)}class xf extends Q{sumif(e,t){const r="SUMIF",n=(i,a,o)=>this.computeConditionalAggregationFunction(o??i,[i,a],r,0,(u,l)=>this.arithmeticHelper.nonstrictadd(u,l),vi);return this.runFunction(e.args,t,this.metadata(r),n)}sumifs(e,t){const r="SUMIFS",n=(i,...a)=>this.computeConditionalAggregationFunction(i,a,r,0,(o,u)=>this.arithmeticHelper.nonstrictadd(o,u),vi);return this.runFunction(e.args,t,this.metadata(r),n)}averageif(e,t){const r="AVERAGEIF",n=(i,a,o)=>{const u=this.computeConditionalAggregationFunction(o??i,[i,a],r,nn.empty,(l,c)=>l.compose(c),l=>de(l)?nn.single(F(l)):nn.empty);return u instanceof g?u:u.averageValue()||new g(R.DIV_BY_ZERO)};return this.runFunction(e.args,t,this.metadata(r),n)}countif(e,t){const r="COUNTIF",n=(i,a)=>this.computeConditionalAggregationFunction(i,[i,a],r,0,(o,u)=>o+u,()=>1);return this.runFunction(e.args,t,this.metadata(r),n)}countifs(e,t){const r="COUNTIFS",n=(...i)=>this.computeConditionalAggregationFunction(i[0],i,r,0,(a,o)=>a+o,()=>1);return this.runFunction(e.args,t,this.metadata(r),n)}minifs(e,t){const r="MINIFS",n=(a,o)=>o===void 0||a===void 0?o===void 0?a:o:Math.min(a,o),i=(a,...o)=>{const u=this.computeConditionalAggregationFunction(a,o,r,Number.POSITIVE_INFINITY,n,vi);return lc(u)};return this.runFunction(e.args,t,this.metadata(r),i)}maxifs(e,t){const r="MAXIFS",n=(a,o)=>o===void 0||a===void 0?o===void 0?a:o:Math.max(a,o),i=(a,...o)=>{const u=this.computeConditionalAggregationFunction(a,o,r,Number.NEGATIVE_INFINITY,n,vi);return lc(u)};return this.runFunction(e.args,t,this.metadata(r),i)}computeConditionalAggregationFunction(e,t,r,n,i,a){const o=[];for(let u=0;u<t.length;u+=2){const l=t[u],c=this.interpreter.criterionBuilder.fromCellValue(t[u+1],this.arithmeticHelper);if(c===void 0)return new g(R.VALUE,T.BadCriterion);o.push(new Nv(l,c))}return new yv(this.interpreter,vv(r),n,i,a).compute(e,o)}}xf.implementedFunctions={SUMIF:{method:"sumif",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR},{argumentType:h.RANGE,optionalArg:!0}]},COUNTIF:{method:"countif",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR}]},AVERAGEIF:{method:"averageif",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR},{argumentType:h.RANGE,optionalArg:!0}]},SUMIFS:{method:"sumifs",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2},COUNTIFS:{method:"countifs",parameters:[{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2},MINIFS:{method:"minifs",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2},MAXIFS:{method:"maxifs",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.NOERROR}],repeatLastArgs:2}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class _f extends Q{sumproduct(e,t){return this.runFunction(e.args,t,this.metadata("SUMPRODUCT"),(...r)=>{const n=r[0].width(),i=r[0].height();for(const u of r)if(u.width()!==n||u.height()!==i)return new g(R.VALUE,T.EqualLength);let a=0;const o=r.map(u=>u.iterateValuesFromTopLeftCorner());for(let u=0;u<n*i;u++){let l=1;for(const c of o){const d=c.next().value;if(d instanceof g)return d;const f=this.coerceScalarToNumberOrError(d);de(f)?l*=F(f):l=0}a+=l}return a})}}_f.implementedFunctions={SUMPRODUCT:{method:"sumproduct",parameters:[{argumentType:h.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Lf extends Q{concatenate(e,t){return this.runFunction(e.args,t,this.metadata("CONCATENATE"),(...r)=>"".concat(...r))}split(e,t){return this.runFunction(e.args,t,this.metadata("SPLIT"),(r,n)=>{const i=r.split(" ");return n>=i.length||n<0?new g(R.VALUE,T.IndexBounds):i[n]})}len(e,t){return this.runFunction(e.args,t,this.metadata("LEN"),r=>r.length)}lower(e,t){return this.runFunction(e.args,t,this.metadata("LOWER"),r=>r.toLowerCase())}trim(e,t){return this.runFunction(e.args,t,this.metadata("TRIM"),r=>r.replace(/^ +/g,"").replace(/ +$/g,"").replace(/ +/g," "))}proper(e,t){return this.runFunction(e.args,t,this.metadata("PROPER"),r=>r.replace(new RegExp("\\p{L}+","gu"),n=>n.charAt(0).toUpperCase()+n.substring(1).toLowerCase()))}clean(e,t){return this.runFunction(e.args,t,this.metadata("CLEAN"),r=>r.replace(/[\u0000-\u001F]/g,""))}exact(e,t){return this.runFunction(e.args,t,this.metadata("EXACT"),(r,n)=>r===n)}rept(e,t){return this.runFunction(e.args,t,this.metadata("REPT"),(r,n)=>n<0?new g(R.VALUE,T.NegativeCount):r.repeat(n))}right(e,t){return this.runFunction(e.args,t,this.metadata("RIGHT"),(r,n)=>n<0?new g(R.VALUE,T.NegativeLength):n===0?"":r.slice(-n))}left(e,t){return this.runFunction(e.args,t,this.metadata("LEFT"),(r,n)=>n<0?new g(R.VALUE,T.NegativeLength):r.slice(0,n))}mid(e,t){return this.runFunction(e.args,t,this.metadata("MID"),(r,n,i)=>n<1?new g(R.VALUE,T.LessThanOne):i<0?new g(R.VALUE,T.NegativeLength):r.substring(n-1,n+i-1))}replace(e,t){return this.runFunction(e.args,t,this.metadata("REPLACE"),(r,n,i,a)=>n<1?new g(R.VALUE,T.LessThanOne):i<0?new g(R.VALUE,T.NegativeLength):r.substring(0,n-1)+a+r.substring(n+i-1))}search(e,t){return this.runFunction(e.args,t,this.metadata("SEARCH"),(r,n,i)=>{if(i<1||i>n.length)return new g(R.VALUE,T.LengthBounds);const a=r.toLowerCase(),o=n.substring(i-1).toLowerCase(),u=this.arithmeticHelper.requiresRegex(a)?this.arithmeticHelper.searchString(a,o):o.indexOf(a);return u>-1?u+i:new g(R.VALUE,T.PatternNotFound)})}substitute(e,t){return this.runFunction(e.args,t,this.metadata("SUBSTITUTE"),(r,n,i,a)=>{const o=this.escapeRegExpSpecialCharacters(n),u=new RegExp(o,"g");if(a===void 0)return r.replace(u,i);if(a<1)return new g(R.VALUE,T.LessThanOne);let l,c=0;for(;(l=u.exec(r))!==null;)if(a===++c)return r.substring(0,l.index)+i+r.substring(u.lastIndex);return r})}find(e,t){return this.runFunction(e.args,t,this.metadata("FIND"),(r,n,i)=>{if(i<1||i>n.length)return new g(R.VALUE,T.IndexBounds);const o=n.substring(i-1).indexOf(r)+i;return o>0?o:new g(R.VALUE,T.PatternNotFound)})}t(e,t){return this.runFunction(e.args,t,this.metadata("T"),r=>r instanceof g||typeof r=="string"?r:"")}upper(e,t){return this.runFunction(e.args,t,this.metadata("UPPER"),r=>r.toUpperCase())}escapeRegExpSpecialCharacters(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}Lf.implementedFunctions={CONCATENATE:{method:"concatenate",parameters:[{argumentType:h.STRING}],repeatLastArgs:1,expandRanges:!0},EXACT:{method:"exact",parameters:[{argumentType:h.STRING},{argumentType:h.STRING}]},SPLIT:{method:"split",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER}]},LEN:{method:"len",parameters:[{argumentType:h.STRING}]},LOWER:{method:"lower",parameters:[{argumentType:h.STRING}]},MID:{method:"mid",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},TRIM:{method:"trim",parameters:[{argumentType:h.STRING}]},T:{method:"t",parameters:[{argumentType:h.SCALAR}]},PROPER:{method:"proper",parameters:[{argumentType:h.STRING}]},CLEAN:{method:"clean",parameters:[{argumentType:h.STRING}]},REPT:{method:"rept",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER}]},RIGHT:{method:"right",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},LEFT:{method:"left",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},REPLACE:{method:"replace",parameters:[{argumentType:h.STRING},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.STRING}]},SEARCH:{method:"search",parameters:[{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},SUBSTITUTE:{method:"substitute",parameters:[{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.NUMBER,optionalArg:!0}]},FIND:{method:"find",parameters:[{argumentType:h.STRING},{argumentType:h.STRING},{argumentType:h.NUMBER,defaultValue:1}]},UPPER:{method:"upper",parameters:[{argumentType:h.STRING}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ff extends Q{acos(e,t){return this.runFunction(e.args,t,this.metadata("ACOS"),Math.acos)}asin(e,t){return this.runFunction(e.args,t,this.metadata("ASIN"),Math.asin)}cos(e,t){return this.runFunction(e.args,t,this.metadata("COS"),Math.cos)}sin(e,t){return this.runFunction(e.args,t,this.metadata("SIN"),Math.sin)}tan(e,t){return this.runFunction(e.args,t,this.metadata("TAN"),Math.tan)}atan(e,t){return this.runFunction(e.args,t,this.metadata("ATAN"),Math.atan)}atan2(e,t){return this.runFunction(e.args,t,this.metadata("ATAN2"),(r,n)=>r===0&&n===0?new g(R.DIV_BY_ZERO):Math.atan2(n,r))}cot(e,t){return this.runFunction(e.args,t,this.metadata("COT"),r=>r===0?new g(R.DIV_BY_ZERO):1/Math.tan(r))}acot(e,t){return this.runFunction(e.args,t,this.metadata("ACOT"),r=>r===0?Do/2:Math.atan(1/r))}sec(e,t){return this.runFunction(e.args,t,this.metadata("SEC"),r=>1/Math.cos(r))}csc(e,t){return this.runFunction(e.args,t,this.metadata("CSC"),r=>r===0?new g(R.DIV_BY_ZERO):1/Math.sin(r))}sinh(e,t){return this.runFunction(e.args,t,this.metadata("SINH"),Math.sinh)}asinh(e,t){return this.runFunction(e.args,t,this.metadata("ASINH"),Math.asinh)}cosh(e,t){return this.runFunction(e.args,t,this.metadata("COSH"),Math.cosh)}acosh(e,t){return this.runFunction(e.args,t,this.metadata("ACOSH"),Math.acosh)}tanh(e,t){return this.runFunction(e.args,t,this.metadata("TANH"),Math.tanh)}atanh(e,t){return this.runFunction(e.args,t,this.metadata("ATANH"),Math.atanh)}coth(e,t){return this.runFunction(e.args,t,this.metadata("COTH"),r=>r===0?new g(R.DIV_BY_ZERO):1/Math.tanh(r))}acoth(e,t){return this.runFunction(e.args,t,this.metadata("ACOTH"),r=>r===0?new g(R.NUM,T.NonZero):Math.atanh(1/r))}sech(e,t){return this.runFunction(e.args,t,this.metadata("SECH"),r=>1/Math.cosh(r))}csch(e,t){return this.runFunction(e.args,t,this.metadata("CSCH"),r=>r===0?new g(R.DIV_BY_ZERO):1/Math.sinh(r))}}Ff.implementedFunctions={ACOS:{method:"acos",parameters:[{argumentType:h.NUMBER}]},ASIN:{method:"asin",parameters:[{argumentType:h.NUMBER}]},COS:{method:"cos",parameters:[{argumentType:h.NUMBER}]},SIN:{method:"sin",parameters:[{argumentType:h.NUMBER}]},TAN:{method:"tan",parameters:[{argumentType:h.NUMBER}]},ATAN:{method:"atan",parameters:[{argumentType:h.NUMBER}]},ATAN2:{method:"atan2",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},COT:{method:"cot",parameters:[{argumentType:h.NUMBER}]},SEC:{method:"sec",parameters:[{argumentType:h.NUMBER}]},CSC:{method:"csc",parameters:[{argumentType:h.NUMBER}]},SINH:{method:"sinh",parameters:[{argumentType:h.NUMBER}]},COSH:{method:"cosh",parameters:[{argumentType:h.NUMBER}]},TANH:{method:"tanh",parameters:[{argumentType:h.NUMBER}]},COTH:{method:"coth",parameters:[{argumentType:h.NUMBER}]},SECH:{method:"sech",parameters:[{argumentType:h.NUMBER}]},CSCH:{method:"csch",parameters:[{argumentType:h.NUMBER}]},ACOT:{method:"acot",parameters:[{argumentType:h.NUMBER}]},ASINH:{method:"asinh",parameters:[{argumentType:h.NUMBER}]},ACOSH:{method:"acosh",parameters:[{argumentType:h.NUMBER}]},ATANH:{method:"atanh",parameters:[{argumentType:h.NUMBER}]},ACOTH:{method:"acoth",parameters:[{argumentType:h.NUMBER}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Sv extends jd{constructor(e){super(e),this.dependencyGraph=e}find(e,t,r){return this.basicFind(e,t,"col",r)}}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Uf extends Q{constructor(){super(...arguments),this.rowSearch=new Sv(this.dependencyGraph)}vlookup(e,t){return this.runFunction(e.args,t,this.metadata("VLOOKUP"),(r,n,i,a)=>{const o=n.range;if(o===void 0)return new g(R.VALUE,T.WrongType);if(i<1)return new g(R.VALUE,T.LessThanOne);if(i>o.width())return new g(R.REF,T.IndexLarge);const u={ordering:a?"asc":"none",ifNoMatch:a?"returnLowerBound":"returnNotFound"};return this.doVlookup(hi(r),n,i-1,u)})}hlookup(e,t){return this.runFunction(e.args,t,this.metadata("HLOOKUP"),(r,n,i,a)=>{const o=n.range;if(o===void 0)return new g(R.VALUE,T.WrongType);if(i<1)return new g(R.VALUE,T.LessThanOne);if(i>o.height())return new g(R.REF,T.IndexLarge);const u={ordering:a?"asc":"none",ifNoMatch:a?"returnLowerBound":"returnNotFound"};return this.doHlookup(hi(r),n,i-1,u)})}xlookup(e,t){return this.runFunction(e.args,t,this.metadata("XLOOKUP"),(r,n,i,a,o,u)=>{if(![0,-1,1,2].includes(o))return new g(R.VALUE,T.BadMode);if(![1,-1,2,-2].includes(u))return new g(R.VALUE,T.BadMode);const l=n instanceof D?n:D.fromScalar(n),c=i instanceof D?i:D.fromScalar(i),d=o===2,f={ordering:u===2?"asc":u===-2?"desc":"none",returnOccurrence:u===-1?"last":"first",ifNoMatch:o===-1?"returnLowerBound":o===1?"returnUpperBound":"returnNotFound"};return this.doXlookup(hi(r),l,c,a,d,f)})}xlookupArraySize(e){var t,r;const n=(t=e?.args)===null||t===void 0?void 0:t[1],i=(r=e?.args)===null||r===void 0?void 0:r[2];if(n?.start==null||n?.end==null||i?.start==null||i?.end==null)return Z.error();const a=n.end.row-n.start.row+1,o=n.end.col-n.start.col+1,u=i.end.row-i.start.row+1,l=i.end.col-i.start.col+1,c=o===1&&u===a;return!c&&!(a===1&&l===o)?Z.error():c?new Z(l,1):new Z(1,u)}match(e,t){return this.runFunction(e.args,t,this.metadata("MATCH"),(r,n,i)=>this.doMatch(hi(r),n,i))}searchInRange(e,t,r,n,i){return r&&typeof e=="string"&&this.arithmeticHelper.requiresRegex(e)?i.advancedFind(this.arithmeticHelper.eqMatcherFunction(e),t,{returnOccurrence:n.returnOccurrence}):i.find(e,t,n)}doVlookup(e,t,r,n){this.dependencyGraph.stats.start(K.VLOOKUP);const i=t.range;let a;i===void 0?a=D.onlyValues(t.data.map(l=>[l[0]])):a=D.onlyRange(W.spanFrom(i.start,1,i.height()),this.dependencyGraph);const o=this.searchInRange(e,a,n.ordering==="none",n,this.columnSearch);if(this.dependencyGraph.stats.end(K.VLOOKUP),o===-1)return new g(R.NA,T.ValueNotFound);let u;if(i===void 0)u=t.data[o][r];else{const l=U(i.sheet,i.start.col+r,i.start.row+o);u=this.dependencyGraph.getCellValue(l)}return u instanceof D?new g(R.VALUE,T.WrongType):u}doHlookup(e,t,r,n){const i=t.range;let a;i===void 0?a=D.onlyValues([t.data[0]]):a=D.onlyRange(W.spanFrom(i.start,i.width(),1),this.dependencyGraph);const o=this.searchInRange(e,a,n.ordering==="none",n,this.rowSearch);if(o===-1)return new g(R.NA,T.ValueNotFound);let u;if(i===void 0)u=t.data[r][o];else{const l=U(i.sheet,i.start.col+o,i.start.row+r);u=this.dependencyGraph.getCellValue(l)}return u instanceof D?new g(R.VALUE,T.WrongType):u}doXlookup(e,t,r,n,i,a){const o=t.width()===1&&r.height()===t.height(),u=t.height()===1&&r.width()===t.width();if(!o&&!u)return new g(R.VALUE,T.WrongDimension);const l=o?this.columnSearch:this.rowSearch,c=this.searchInRange(e,t,i,a,l);if(c===-1)return n==R.NA?new g(R.NA,T.ValueNotFound):n;const d=o?[r.data[c]]:r.data.map(f=>[f[c]]);return D.onlyValues(d)}doMatch(e,t,r){if(![-1,0,1].includes(r))return new g(R.VALUE,T.BadMode);if(t.width()>1&&t.height()>1)return new g(R.NA);const n=t.width()===1?this.columnSearch:this.rowSearch,i=r===0?{ordering:"none",ifNoMatch:"returnNotFound"}:{ordering:r===-1?"desc":"asc",ifNoMatch:r===-1?"returnUpperBound":"returnLowerBound"},a=n.find(e,t,i);return a===-1?new g(R.NA,T.ValueNotFound):a+1}}Uf.implementedFunctions={VLOOKUP:{method:"vlookup",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.BOOLEAN,defaultValue:!0}]},HLOOKUP:{method:"hlookup",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.BOOLEAN,defaultValue:!0}]},XLOOKUP:{method:"xlookup",sizeOfResultArrayMethod:"xlookupArraySize",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.SCALAR,optionalArg:!0,defaultValue:R.NA},{argumentType:h.NUMBER,optionalArg:!0,defaultValue:0},{argumentType:h.NUMBER,optionalArg:!0,defaultValue:1}]},MATCH:{method:"match",parameters:[{argumentType:h.NOERROR},{argumentType:h.RANGE},{argumentType:h.NUMBER,defaultValue:1}]}};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Pf extends Q{roman(e,t){return this.runFunction(e.args,t,this.metadata("ROMAN"),(r,n)=>(r=Math.trunc(r),n===!1?n=4:n===!0&&(n=0),n=F(this.coerceScalarToNumberOrError(n)),n instanceof g?n:(n=Math.trunc(n),n<0?new g(R.VALUE,T.ValueSmall):n>4?new g(R.VALUE,T.ValueLarge):Av(r,n))))}arabic(e,t){return this.runFunction(e.args,t,this.metadata("ARABIC"),r=>{r=r.trim().toUpperCase();let n=!1;if(r.startsWith("-")&&(r=r.slice(1),n=!0,r===""))return new g(R.VALUE,T.InvalidRoman);const i={input:r,acc:0};return Rr(i,{token:"MMM",val:3e3},{token:"MM",val:2e3},{token:"M",val:1e3}),Rr(i,{token:"IM",val:999},{token:"VM",val:995},{token:"XM",val:990},{token:"LM",val:950},{token:"CM",val:900}),Rr(i,{token:"D",val:500},{token:"ID",val:499},{token:"VD",val:495},{token:"XD",val:490},{token:"LD",val:450},{token:"CD",val:400}),Rr(i,{token:"CCC",val:300},{token:"CC",val:200},{token:"C",val:100}),Rr(i,{token:"IC",val:99},{token:"VC",val:95},{token:"XC",val:90}),Rr(i,{token:"L",val:50},{token:"IL",val:49},{token:"VL",val:45},{token:"XL",val:40}),Rr(i,{token:"XXX",val:30},{token:"XX",val:20},{token:"X",val:10}),Rr(i,{token:"IX",val:9}),Rr(i,{token:"V",val:5},{token:"IV",val:4}),Rr(i,{token:"III",val:3},{token:"II",val:2},{token:"I",val:1}),i.input!==""?new g(R.VALUE,T.InvalidRoman):n?-i.acc:i.acc})}}Pf.implementedFunctions={ROMAN:{method:"roman",parameters:[{argumentType:h.NUMBER,minValue:1,lessThan:4e3},{argumentType:h.NOERROR,optionalArg:!0,defaultValue:0}]},ARABIC:{method:"arabic",parameters:[{argumentType:h.STRING}]}};function Rr(s,...e){for(const t of e)if(s.input.startsWith(t.token)){s.input=s.input.slice(t.token.length),s.acc+=t.val;break}}function Av(s,e){const t={val:s%1e3,acc:"M".repeat(Math.floor(s/1e3))};return e===4&&(We(t,"IM",999,1e3),We(t,"ID",499,500)),e>=3&&(We(t,"VM",995,1e3),We(t,"VD",495,500)),e>=2&&(We(t,"XM",990,1e3),We(t,"XD",490,500)),e>=1&&(We(t,"LM",950,1e3),We(t,"LD",450,500)),We(t,"CM",900,1e3),We(t,"CD",400,500),We(t,"D",500,900),t.acc+="C".repeat(Math.floor(t.val/100)),t.val%=100,e>=2&&(We(t,"IC",99,100),We(t,"IL",49,50)),e>=1&&(We(t,"VC",95,100),We(t,"VL",45,50)),We(t,"XC",90,100),We(t,"XL",40,50),We(t,"L",50,90),t.acc+="X".repeat(Math.floor(t.val/10)),t.val%=10,We(t,"IX",9,10),We(t,"IV",4,5),We(t,"V",5,9),t.acc+="I".repeat(t.val),t.acc}function We(s,e,t,r){s.val>=t&&s.val<r&&(s.val-=t,s.acc+=e)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Df extends Q{add(e,t){return this.runFunction(e.args,t,this.metadata("HF.ADD"),this.arithmeticHelper.addWithEpsilon)}concat(e,t){return this.runFunction(e.args,t,this.metadata("HF.CONCAT"),this.arithmeticHelper.concat)}divide(e,t){return this.runFunction(e.args,t,this.metadata("HF.DIVIDE"),this.arithmeticHelper.divide)}eq(e,t){return this.runFunction(e.args,t,this.metadata("HF.EQ"),this.arithmeticHelper.eq)}gt(e,t){return this.runFunction(e.args,t,this.metadata("HF.GT"),this.arithmeticHelper.gt)}gte(e,t){return this.runFunction(e.args,t,this.metadata("HF.GTE"),this.arithmeticHelper.geq)}lt(e,t){return this.runFunction(e.args,t,this.metadata("HF.LT"),this.arithmeticHelper.lt)}lte(e,t){return this.runFunction(e.args,t,this.metadata("HF.LTE"),this.arithmeticHelper.leq)}minus(e,t){return this.runFunction(e.args,t,this.metadata("HF.MINUS"),this.arithmeticHelper.subtract)}multiply(e,t){return this.runFunction(e.args,t,this.metadata("HF.MULTIPLY"),this.arithmeticHelper.multiply)}ne(e,t){return this.runFunction(e.args,t,this.metadata("HF.NE"),this.arithmeticHelper.neq)}pow(e,t){return this.runFunction(e.args,t,this.metadata("HF.POW"),this.arithmeticHelper.pow)}uminus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UMINUS"),this.arithmeticHelper.unaryMinus)}upercent(e,t){return this.runFunction(e.args,t,this.metadata("HF.UNARY_PERCENT"),this.arithmeticHelper.unaryPercent)}uplus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UPLUS"),this.arithmeticHelper.unaryPlus)}}Df.implementedFunctions={"HF.ADD":{method:"add",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.CONCAT":{method:"concat",parameters:[{argumentType:h.STRING,passSubtype:!0},{argumentType:h.STRING,passSubtype:!0}]},"HF.DIVIDE":{method:"divide",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.EQ":{method:"eq",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.GT":{method:"gt",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.GTE":{method:"gte",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.LT":{method:"lt",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.LTE":{method:"lte",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.MINUS":{method:"minus",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.MULTIPLY":{method:"multiply",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.NE":{method:"ne",parameters:[{argumentType:h.NOERROR,passSubtype:!0},{argumentType:h.NOERROR,passSubtype:!0}]},"HF.POW":{method:"pow",parameters:[{argumentType:h.NUMBER,passSubtype:!0},{argumentType:h.NUMBER,passSubtype:!0}]},"HF.UMINUS":{method:"uminus",parameters:[{argumentType:h.NUMBER,passSubtype:!0}]},"HF.UNARY_PERCENT":{method:"upercent",parameters:[{argumentType:h.NUMBER,passSubtype:!0}]},"HF.UPLUS":{method:"uplus",parameters:[{argumentType:h.NUMBER,passSubtype:!0}]}};/**
 * @license
 bessel.js (C) 2013-present SheetJS -- http://sheetjs.com

 Apache License
 Version 2.0, January 2004
 http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

 "License" shall mean the terms and conditions for use, reproduction,
 and distribution as defined by Sections 1 through 9 of this document.

 "Licensor" shall mean the copyright owner or entity authorized by
 the copyright owner that is granting the License.

 "Legal Entity" shall mean the union of the acting entity and all
 other entities that control, are controlled by, or are under common
 control with that entity. For the purposes of this definition,
 "control" means (i) the power, direct or indirect, to cause the
 direction or management of such entity, whether by contract or
 otherwise, or (ii) ownership of fifty percent (50%) or more of the
 outstanding shares, or (iii) beneficial ownership of such entity.

 "You" (or "Your") shall mean an individual or Legal Entity
 exercising permissions granted by this License.

 "Source" form shall mean the preferred form for making modifications,
 including but not limited to software source code, documentation
 source, and configuration files.

 "Object" form shall mean any form resulting from mechanical
 transformation or translation of a Source form, including but
 not limited to compiled object code, generated documentation,
 and conversions to other media types.

 "Work" shall mean the work of authorship, whether in Source or
 Object form, made available under the License, as indicated by a
 copyright notice that is included in or attached to the work
 (an example is provided in the Appendix below).

 "Derivative Works" shall mean any work, whether in Source or Object
 form, that is based on (or derived from) the Work and for which the
 editorial revisions, annotations, elaborations, or other modifications
 represent, as a whole, an original work of authorship. For the purposes
 of this License, Derivative Works shall not include works that remain
 separable from, or merely link (or bind by name) to the interfaces of,
 the Work and Derivative Works thereof.

 "Contribution" shall mean any work of authorship, including
 the original version of the Work and any modifications or additions
 to that Work or Derivative Works thereof, that is intentionally
 submitted to Licensor for inclusion in the Work by the copyright owner
 or by an individual or Legal Entity authorized to submit on behalf of
 the copyright owner. For the purposes of this definition, "submitted"
 means any form of electronic, verbal, or written communication sent
 to the Licensor or its representatives, including but not limited to
 communication on electronic mailing lists, source code control systems,
 and issue tracking systems that are managed by, or on behalf of, the
 Licensor for the purpose of discussing and improving the Work, but
 excluding communication that is conspicuously marked or otherwise
 designated in writing by the copyright owner as "Not a Contribution."

 "Contributor" shall mean Licensor and any individual or Legal Entity
 on behalf of whom a Contribution has been received by Licensor and
 subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 copyright license to reproduce, prepare Derivative Works of,
 publicly display, publicly perform, sublicense, and distribute the
 Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 (except as stated in this section) patent license to make, have made,
 use, offer to sell, sell, import, and otherwise transfer the Work,
 where such license applies only to those patent claims licensable
 by such Contributor that are necessarily infringed by their
 Contribution(s) alone or by combination of their Contribution(s)
 with the Work to which such Contribution(s) was submitted. If You
 institute patent litigation against any entity (including a
 cross-claim or counterclaim in a lawsuit) alleging that the Work
 or a Contribution incorporated within the Work constitutes direct
 or contributory patent infringement, then any patent licenses
 granted to You under this License for that Work shall terminate
 as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
 Work or Derivative Works thereof in any medium, with or without
 modifications, and in Source or Object form, provided that You
 meet the following conditions:

 (a) You must give any other recipients of the Work or
 Derivative Works a copy of this License; and

 (b) You must cause any modified files to carry prominent notices
 stating that You changed the files; and

 (c) You must retain, in the Source form of any Derivative Works
 that You distribute, all copyright, patent, trademark, and
 attribution notices from the Source form of the Work,
 excluding those notices that do not pertain to any part of
 the Derivative Works; and

 (d) If the Work includes a "NOTICE" text file as part of its
 distribution, then any Derivative Works that You distribute must
 include a readable copy of the attribution notices contained
 within such NOTICE file, excluding those notices that do not
 pertain to any part of the Derivative Works, in at least one
 of the following places: within a NOTICE text file distributed
 as part of the Derivative Works; within the Source form or
 documentation, if provided along with the Derivative Works; or,
 within a display generated by the Derivative Works, if and
 wherever such third-party notices normally appear. The contents
 of the NOTICE file are for informational purposes only and
 do not modify the License. You may add Your own attribution
 notices within Derivative Works that You distribute, alongside
 or as an addendum to the NOTICE text from the Work, provided
 that such additional attribution notices cannot be construed
 as modifying the License.

 You may add Your own copyright statement to Your modifications and
 may provide additional or different license terms and conditions
 for use, reproduction, or distribution of Your modifications, or
 for any such Derivative Works as a whole, provided Your use,
 reproduction, and distribution of the Work otherwise complies with
 the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
 any Contribution intentionally submitted for inclusion in the Work
 by You to the Licensor shall be under the terms and conditions of
 this License, without any additional terms or conditions.
 Notwithstanding the above, nothing herein shall supersede or modify
 the terms of any separate license agreement you may have executed
 with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
 names, trademarks, service marks, or product names of the Licensor,
 except as required for reasonable and customary use in describing the
 origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
 agreed to in writing, Licensor provides the Work (and each
 Contributor provides its Contributions) on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 implied, including, without limitation, any warranties or conditions
 of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
 PARTICULAR PURPOSE. You are solely responsible for determining the
 appropriateness of using or redistributing the Work and assume any
 risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
 whether in tort (including negligence), contract, or otherwise,
 unless required by applicable law (such as deliberate and grossly
 negligent acts) or agreed to in writing, shall any Contributor be
 liable to You for damages, including any direct, indirect, special,
 incidental, or consequential damages of any character arising as a
 result of this License or out of the use or inability to use the
 Work (including but not limited to damages for loss of goodwill,
 work stoppage, computer failure or malfunction, or any and all
 other commercial damages or losses), even if such Contributor
 has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
 the Work or Derivative Works thereof, You may choose to offer,
 and charge a fee for, acceptance of support, warranty, indemnity,
 or other liability obligations and/or rights consistent with this
 License. However, in accepting such obligations, You may act only
 on Your own behalf and on Your sole responsibility, not on behalf
 of any other Contributor, and only if You agree to indemnify,
 defend, and hold each Contributor harmless for any liability
 incurred by, or claims asserted against, such Contributor by reason
 of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

 To apply the Apache License to your work, attach the following
 boilerplate notice, with the fields enclosed by brackets "{}"
 replaced with your own identifying information. (Don't include
 the brackets!)  The text should be enclosed in the appropriate
 comment syntax for the file format. We also recommend that a
 file or class name and description of purpose be included on the
 same "printed page" as the copyright notice for easier
 identification within third-party archives.

 Copyright (C) 2013-present   SheetJS LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 */var J=Math;function xe(s,e){for(var t=0,r=0;t<s.length;++t)r=e*r+s[t];return r}function Vf(s,e,t,r,n){if(e===0)return t;if(e===1)return r;for(var i=2/s,a=r,o=1;o<e;++o)a=r*o*i+n*t,t=r,r=a;return a}function Bf(s,e,t,r,n){return function(a,o){if(r){if(a===0)return r==1?-1/0:1/0;if(a<0)return NaN}if(o===0)return s(a);if(o===1)return e(a);if(o<0)return NaN;o|=0;var u=s(a),l=e(a);return Vf(a,o,u,l,n)}}var Vo=function(){var s=.636619772,e=[57568490574,-13362590354,6516196407e-1,-1121442418e-2,77392.33017,-184.9052456].reverse(),t=[57568490411,1029532985,9494680718e-3,59272.64853,267.8532712,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),n=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934935152e-16].reverse();function i(d){var f=0,p=0,E=0,m=d*d;if(d<8)p=xe(e,m),E=xe(t,m),f=p/E;else{var S=d-.785398164;m=64/m,p=xe(r,m),E=xe(n,m),f=J.sqrt(s/d)*(J.cos(S)*p-J.sin(S)*E*8/d)}return f}var a=[72362614232,-7895059235,2423968531e-1,-2972611439e-3,15704.4826,-30.16036606].reverse(),o=[144725228442,2300535178,1858330474e-2,99447.43394,376.9991397,1].reverse(),u=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function c(d){var f=0,p=0,E=0,m=d*d,S=J.abs(d)-2.356194491;return Math.abs(d)<8?(p=d*xe(a,m),E=xe(o,m),f=p/E):(m=64/m,p=xe(u,m),E=xe(l,m),f=J.sqrt(s/J.abs(d))*(J.cos(S)*p-J.sin(S)*E*8/J.abs(d)),d<0&&(f=-f)),f}return function d(f,p){if(p=Math.round(p),!isFinite(f))return isNaN(f)?f:0;if(p<0)return(p%2?-1:1)*d(f,-p);if(f<0)return(p%2?-1:1)*d(-f,p);if(p===0)return i(f);if(p===1)return c(f);if(f===0)return 0;var E=0;if(f>p)E=Vf(f,p,i(f),c(f),-1);else{for(var m=2*J.floor((p+J.floor(J.sqrt(40*p)))/2),S=!1,v=0,A=0,w=1,I=0,O=2/f,_=m;_>0;_--)I=_*O*w-v,v=w,w=I,J.abs(w)>1e10&&(w*=1e-10,v*=1e-10,E*=1e-10,A*=1e-10),S&&(A+=w),S=!S,_==p&&(E=v);A=2*A-w,E/=A}return E}}(),Cv=function(){var s=.636619772,e=[-2957821389,7062834065,-5123598036e-1,1087988129e-2,-86327.92757,228.4622733].reverse(),t=[40076544269,7452499648e-1,7189466438e-3,47447.2647,226.1030244,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),n=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934945152e-16].reverse();function i(d){var f=0,p=0,E=0,m=d*d,S=d-.785398164;return d<8?(p=xe(e,m),E=xe(t,m),f=p/E+s*Vo(d,0)*J.log(d)):(m=64/m,p=xe(r,m),E=xe(n,m),f=J.sqrt(s/d)*(J.sin(S)*p+J.cos(S)*E*8/d)),f}var a=[-4900604943e3,127527439e4,-51534381390,7349264551e-1,-4237922726e-3,8511.937935].reverse(),o=[249958057e5,424441966400,3733650367,2245904002e-2,102042.605,354.9632885,1].reverse(),u=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function c(d){var f=0,p=0,E=0,m=d*d,S=d-2.356194491;return d<8?(p=d*xe(a,m),E=xe(o,m),f=p/E+s*(Vo(d,1)*J.log(d)-1/d)):(m=64/m,p=xe(u,m),E=xe(l,m),f=J.sqrt(s/d)*(J.sin(S)*p+J.cos(S)*E*8/d)),f}return Bf(i,c,"BESSELY",1,-1)}(),Bo=function(){var s=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),e=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse();function t(a){return a<=3.75?xe(s,a*a/(3.75*3.75)):J.exp(J.abs(a))/J.sqrt(J.abs(a))*xe(e,3.75/J.abs(a))}var r=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),n=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse();function i(a){return a<3.75?a*xe(r,a*a/(3.75*3.75)):(a<0?-1:1)*J.exp(J.abs(a))/J.sqrt(J.abs(a))*xe(n,3.75/J.abs(a))}return function a(o,u){if(u=Math.round(u),u===0)return t(o);if(u===1)return i(o);if(u<0)return NaN;if(J.abs(o)===0)return 0;if(o==1/0)return 1/0;var l=0,c,d=2/J.abs(o),f=0,p=1,E=0,m=2*J.round((u+J.round(J.sqrt(40*u)))/2);for(c=m;c>0;c--)E=c*d*p+f,f=p,p=E,J.abs(p)>1e10&&(p*=1e-10,f*=1e-10,l*=1e-10),c==u&&(l=f);return l*=a(o,0)/p,o<0&&u%2?-l:l}}(),wv=function(){var s=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),e=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();function t(a){return a<=2?-J.log(a/2)*Bo(a,0)+xe(s,a*a/4):J.exp(-a)/J.sqrt(a)*xe(e,2/a)}var r=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),n=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();function i(a){return a<=2?J.log(a/2)*Bo(a,1)+1/a*xe(r,a*a/4):J.exp(-a)/J.sqrt(a)*xe(n,2/a)}return Bf(t,i,"BESSELK",2,1)}();/**
 * @license
 Copyright (c) 2013 jStat

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 */function qn(s){const e=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let t=e.length-1,r=!1,n=0,i=0,a,o,u,l;if(s===0)return 0;for(s<0&&(s=-s,r=!0),a=2/(2+s),o=4*a-2;t>0;t--)u=n,n=o*n-i+e[t],i=u;return l=a*Math.exp(-s*s+.5*(e[0]+o*n)-i),r?l-1:1-l}function kf(s){return 1-qn(s)}function Gf(s){let e=0,t,r,n,i;if(s>=2)return-100;if(s<=0)return 100;for(i=s<1?s:2-s,n=Math.sqrt(-2*Math.log(i/2)),t=-.70711*((2.30753+n*.27061)/(1+n*(.99229+n*.04481))-n);e<2;e++)r=kf(t)-i,t+=r/(1.1283791670955126*Math.exp(-t*t)-t*r);return s<1?t:-t}const cc={pdf:(s,e)=>s<0?0:e*Math.exp(-e*s),cdf:(s,e)=>s<0?0:1-Math.exp(-e*s)};function Ps(s){const e=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],t=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let r=!1,n=0,i=0,a=0,o=s,u,l,c,d;if(s>171.6243769536076)return 1/0;if(o<=0)if(d=o%1,d)r=(o&1?-1:1)*Math.PI/Math.sin(Math.PI*d),o=1-o;else return 1/0;for(c=o,o<1?l=o++:l=(o-=n=(o|0)-1)-1,u=0;u<8;++u)a=(a+e[u])*l,i=i*l+t[u];if(d=a/i+1,c<o)d/=c;else if(c>o)for(u=0;u<n;++u)d*=o,o++;return r&&(d=r/d),d}const eo={pdf:function(e,t,r){return e<0?0:e===0&&t===1?1/r:Math.exp((t-1)*Math.log(e)-e/r-nt(t)-t*Math.log(r))},cdf:function(e,t,r){return e<0?0:Cu(t,e/r)},inv:function(s,e,t){return Hf(s,e)*t}};function nt(s){let e=0;const t=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let r=1.000000000190015,n,i,a;for(a=(i=n=s)+5.5,a-=(n+.5)*Math.log(a);e<6;e++)r+=t[e]/++i;return Math.log(2.5066282746310007*r/n)-a}function Cu(s,e){const t=nt(s);let r=s,n=1/s,i=n,a=e+1-s,o=1/1e-30,u=1/a,l=u,c=1;const d=-~(Math.log(s>=1?s:1/s)*8.5+s*.4+17);let f;if(e<0||s<=0)return NaN;if(e<s+1){for(;c<=d;c++)n+=i*=e/++r;return n*Math.exp(-e+s*Math.log(e)-t)}for(;c<=d;c++)f=-c*(c-s),a+=2,u=f*u+a,o=a+f/o,u=1/u,l*=u*o;return 1-l*Math.exp(-e+s*Math.log(e)-t)}function Hf(s,e){let t=0;const r=e-1,n=1e-8,i=nt(e);let a,o,u,l,c,d,f;if(s>=1)return Math.max(100,e+100*Math.sqrt(e));if(s<=0)return 0;for(e>1?(d=Math.log(r),f=Math.exp(r*(d-1)-i),c=s<.5?s:1-s,u=Math.sqrt(-2*Math.log(c)),a=(2.30753+u*.27061)/(1+u*(.99229+u*.04481))-u,s<.5&&(a=-a),a=Math.max(.001,e*Math.pow(1-1/(9*e)-a/(3*Math.sqrt(e)),3))):(u=1-e*(.253+e*.12),s<u?a=Math.pow(s/u,1/e):a=1-Math.log(1-(s-u)/(1-u)));t<12;t++){if(a<=0)return 0;if(o=Cu(e,a)-s,e>1?u=f*Math.exp(-(a-r)+r*(Math.log(a)-d)):u=Math.exp(-a+r*Math.log(a)-i),l=o/u,a-=u=l/(1-.5*Math.min(1,l*((e-1)/a-1))),a<=0&&(a=.5*(a+u)),Math.abs(u)<n*a)break}return a}const ar={pdf:function(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(e-t,2)/(2*r*r))},cdf:function(e,t,r){return .5*(1+qn((e-t)/Math.sqrt(2*r*r)))},inv:function(s,e,t){return-1.4142135623730951*t*Gf(2*s)+e}},to={pdf:function(e,t,r){return e>1||e<0?0:t==1&&r==1?1:t<512&&r<512?Math.pow(e,t-1)*Math.pow(1-e,r-1)/wu(t,r):Math.exp((t-1)*Math.log(e)+(r-1)*Math.log(1-e)-Wf(t,r))},cdf:function(e,t,r){return e>1||e<0?+(e>1):_a(e,t,r)},inv:function(e,t,r){return Iu(e,t,r)}};function wu(s,e){if(!(s<=0||e<=0))return s+e>170?Math.exp(Wf(s,e)):Ps(s)*Ps(e)/Ps(s+e)}function Wf(s,e){return nt(s)+nt(e)-nt(s+e)}function Iu(s,e,t){var r=1e-8,n=e-1,i=t-1,a=0,o,u,l,c,d,f,p,E,m,S,v;if(s<=0)return 0;if(s>=1)return 1;for(e>=1&&t>=1?(l=s<.5?s:1-s,c=Math.sqrt(-2*Math.log(l)),p=(2.30753+c*.27061)/(1+c*(.99229+c*.04481))-c,s<.5&&(p=-p),E=(p*p-3)/6,m=2/(1/(2*e-1)+1/(2*t-1)),S=p*Math.sqrt(E+m)/m-(1/(2*t-1)-1/(2*e-1))*(E+5/6-2/(3*m)),p=e/(e+t*Math.exp(2*S))):(o=Math.log(e/(e+t)),u=Math.log(t/(e+t)),c=Math.exp(e*o)/e,d=Math.exp(t*u)/t,S=c+d,s<c/S?p=Math.pow(e*S*s,1/e):p=1-Math.pow(t*S*(1-s),1/t)),v=-nt(e)-nt(t)+nt(e+t);a<10;a++){if(p===0||p===1)return p;if(f=_a(p,e,t)-s,c=Math.exp(n*Math.log(p)+i*Math.log(1-p)+v),d=f/c,p-=c=d/(1-.5*Math.min(1,d*(n/p-i/(1-p)))),p<=0&&(p=.5*(p+c)),p>=1&&(p=.5*(p+c+1)),Math.abs(c)<r*p&&a>0)break}return p}function _a(s,e,t){var r=s===0||s===1?0:Math.exp(nt(e+t)-nt(e)-nt(t)+e*Math.log(s)+t*Math.log(1-s));return s<0||s>1?!1:s<(e+1)/(e+t+2)?r*hc(s,e,t)/e:1-r*hc(1-s,t,e)/t}function hc(s,e,t){var r=1e-30,n=1,i=e+t,a=e+1,o=e-1,u=1,l=1-i*s/a,c,d,f,p;for(Math.abs(l)<r&&(l=r),l=1/l,p=l;n<=100&&(c=2*n,d=n*(t-n)*s/((o+c)*(e+c)),l=1+d*l,Math.abs(l)<r&&(l=r),u=1+d/u,Math.abs(u)<r&&(u=r),l=1/l,p*=l*u,d=-(e+n)*(i+n)*s/((e+c)*(a+c)),l=1+d*l,Math.abs(l)<r&&(l=r),u=1+d/u,Math.abs(u)<r&&(u=r),l=1/l,f=l*u,p*=f,!(Math.abs(f-1)<3e-7));n++);return p}const Vi={pdf:function(s,e,t){return t===0||t===1?e*t===s?1:0:zf(e,s)*Math.pow(t,s)*Math.pow(1-t,e-s)},cdf:function(s,e,t){var r,n=1e-10;if(s<0)return 0;if(s>=e)return 1;if(t<0||t>1||e<=0)return NaN;s=Math.floor(s);var i=t,a=s+1,o=e-s,u=a+o,l=Math.exp(nt(u)-nt(o)-nt(a)+a*Math.log(i)+o*Math.log(1-i));return i<(a+1)/(u+2)?r=l*dc(i,a,o,n):r=1-l*dc(1-i,o,a,n),Math.round((1-r)*(1/n))/(1/n)}};function dc(s,e,t,r){for(var n=0,i=1,a=1,o=1,u=0,l=0,c;Math.abs((a-l)/a)>r;)l=a,c=-(e+u)*(e+t+u)*s/(e+2*u)/(e+2*u+1),n=a+c*n,i=o+c*i,u=u+1,c=u*(t-u)*s/(e+2*u-1)/(e+2*u),a=n+c*a,o=i+c*o,n=n/o,i=i/o,a=a/o,o=1;return a/e}function zf(s,e){return s>170||e>170?Math.exp(Iv(s,e)):Bi(s)/Bi(e)/Bi(s-e)}function Iv(s,e){return ro(s)-ro(e)-ro(s-e)}function ro(s){return s<0?NaN:nt(s+1)}function Bi(s){return s<0?NaN:Ps(s+1)}const Bn={pdf:function(e,t){return e<0?0:e===0&&t===2?.5:Math.exp((t/2-1)*Math.log(e)-e/2-t/2*Math.log(2)-nt(t/2))},cdf:function(e,t){return e<0?0:Cu(t/2,e/2)},inv:function(s,e){return 2*Hf(s,.5*e)}},kn={pdf:function(e,t,r){var n,i,a;return e<0?0:t<=2?e===0&&t<2?1/0:e===0&&t===2?1:1/wu(t/2,r/2)*Math.pow(t/r,t/2)*Math.pow(e,t/2-1)*Math.pow(1+t/r*e,-(t+r)/2):(n=t*e/(r+e*t),i=r/(r+e*t),a=t*i/2,a*Vi.pdf((t-2)/2,(t+r-2)/2,n))},cdf:function(e,t,r){return e<0?0:_a(t*e/(t*e+r),t/2,r/2)},inv:function(e,t,r){return r/(t*(1/Iu(e,t/2,r/2)-1))}},fc={pdf:function(e,t,r){return e<0||t<0||r<0?0:r/t*Math.pow(e/t,r-1)*Math.exp(-Math.pow(e/t,r))},cdf:function(e,t,r){return e<0?0:1-Math.exp(-Math.pow(e/t,r))}},ko={pdf:function(e,t){return t<0||e%1!==0||e<0?0:Math.pow(t,e)*Math.exp(-t)/Bi(e)},cdf:function(e,t){var r=0;if(e<0)return 0;for(var n=0;r<=e;r++)n+=ko.pdf(r,t);return n}},Ur={pdf:function(e,t,r,n){if(e<0||e<r-(t-n))return 0;if(e>n||e>r)return 0;if(r*2>t)return n*2>t?Ur.pdf(t-r-n+e,t,t-r,t-n):Ur.pdf(n-e,t,t-r,n);if(n*2>t)return Ur.pdf(r-e,t,r,t-n);if(r<n)return Ur.pdf(e,t,n,r);for(var i=1,a=0,o=0;o<e;o++){for(;i>1&&a<n;)i*=1-r/(t-a),a++;i*=(n-o)*(r-o)/((o+1)*(t-r-n+o+1))}for(;a<n;a++)i*=1-r/(t-a);return Math.min(1,Math.max(0,i))},cdf:function s(e,t,r,n){if(e<0||e<r-(t-n))return 0;if(e>=n||e>=r)return 1;if(r*2>t)return n*2>t?s(t-r-n+e,t,t-r,t-n):1-Ur.cdf(n-e-1,t,t-r,n);if(n*2>t)return 1-Ur.cdf(r-e-1,t,r,t-n);if(r<n)return Ur.cdf(e,t,n,r);for(var i=1,a=1,o=0,u=0;u<e;u++){for(;i>1&&o<n;){var l=1-r/(t-o);a*=l,i*=l,o++}a*=(n-u)*(r-u)/((u+1)*(t-r-n+u+1)),i+=a}for(;o<n;o++)i*=1-r/(t-o);return Math.min(1,Math.max(0,i))}},qt={pdf:function(e,t){return t=t>1e100?1e100:t,1/(Math.sqrt(t)*wu(.5,t/2))*Math.pow(1+e*e/t,-((t+1)/2))},cdf:function(e,t){var r=t/2;return _a((e+Math.sqrt(e*e+t))/(2*Math.sqrt(e*e+t)),r,r)},inv:function(s,e){var t=Iu(2*Math.min(s,1-s),.5*e,.5);return t=Math.sqrt(e*(1-t)/t),s>.5?t:-t}},no={pdf:function(e,t,r){return e<=0?0:Math.exp(-Math.log(e)-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(Math.log(e)-t,2)/(2*r*r))},cdf:function(e,t,r){return e<0?0:.5+.5*qn((Math.log(e)-t)/Math.sqrt(2*r*r))},inv:function(s,e,t){return Math.exp(-1.4142135623730951*t*Gf(2*s)+e)}},Go={pdf:function(e,t,r){return e!==e>>>0?!1:e<0?0:zf(e+t-1,t-1)*Math.pow(1-r,e)*Math.pow(r,t)},cdf:function(e,t,r){var n=0,i=0;if(e<0)return 0;for(;i<=e;i++)n+=Go.pdf(i,t,r);return n}};function jf(s){for(var e=0,t=s.length;--t>=0;)e+=s[t];return e}function Kt(s){return jf(s)/s.length}function En(s){for(var e=Kt(s),t=0,r=s.length,n;--r>=0;)n=s[r]-e,t+=n*n;return t}function As(s,e){return En(s)/(s.length-(e?1:0))}function en(s,e){return Math.sqrt(As(s,e))}function Mv(){var s=[].slice.call(arguments),e=new Array(2),t;return s.length===4?t=Math.abs(ar.inv(s[1]/2,0,1)*s[2]/Math.sqrt(s[3])):t=Math.abs(ar.inv(s[1]/2,0,1)*en(s[2])/Math.sqrt(s[2].length)),e[0]=s[0]-t,e[1]=s[0]+t,e}function Ov(){var s=[].slice.call(arguments),e=new Array(2),t;return s.length===4?t=Math.abs(qt.inv(s[1]/2,s[3]-1)*s[2]/Math.sqrt(s[3])):t=Math.abs(qt.inv(s[1]/2,s[2].length-1)*en(s[2],!0)/Math.sqrt(s[2].length)),e[0]=s[0]-t,e[1]=s[0]+t,e}function bv(s){for(var e=1,t=s.length;--t>=0;)e*=s[t];return e}function xv(s){return Math.pow(bv(s),1/s.length)}function Cs(s,e){var t=Kt(s),r=Kt(e),n=s.length,i=new Array(n),a;for(a=0;a<n;a++)i[a]=(s[a]-t)*(e[a]-r);return jf(i)/(n-1)}function pc(s,e){return Cs(s,e)/en(s,1)/en(e,1)}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Mu extends Q{erf(e,t){return this.runFunction(e.args,t,this.metadata("ERF"),(r,n)=>n===void 0?qn(r):qn(n)-qn(r))}erfc(e,t){return this.runFunction(e.args,t,this.metadata("ERFC"),kf)}expondist(e,t){return this.runFunction(e.args,t,this.metadata("EXPON.DIST"),(r,n,i)=>i?cc.cdf(r,n):cc.pdf(r,n))}fisher(e,t){return this.runFunction(e.args,t,this.metadata("FISHER"),r=>Math.log((1+r)/(1-r))/2)}fisherinv(e,t){return this.runFunction(e.args,t,this.metadata("FISHERINV"),r=>1-2/(Math.exp(2*r)+1))}gamma(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA"),Ps)}gammadist(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.DIST"),(r,n,i,a)=>a?eo.cdf(r,n,i):eo.pdf(r,n,i))}gammaln(e,t){return this.runFunction(e.args,t,this.metadata("GAMMALN"),nt)}gammainv(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.INV"),eo.inv)}gauss(e,t){return this.runFunction(e.args,t,this.metadata("GAUSS"),r=>ar.cdf(r,0,1)-.5)}betadist(e,t){return this.runFunction(e.args,t,this.metadata("BETA.DIST"),(r,n,i,a,o,u)=>r<=o?new g(R.NUM,T.ValueSmall):r>=u?new g(R.NUM,T.ValueLarge):(r=(r-o)/(u-o),a?to.cdf(r,n,i):to.pdf(r,n,i)))}betainv(e,t){return this.runFunction(e.args,t,this.metadata("BETA.INV"),(r,n,i,a,o)=>a>=o?new g(R.NUM,T.WrongOrder):to.inv(r,n,i)*(o-a)+a)}binomialdist(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.DIST"),(r,n,i,a)=>r>n?new g(R.NUM,T.WrongOrder):(r=Math.trunc(r),n=Math.trunc(n),a?Vi.cdf(r,n,i):Vi.pdf(r,n,i)))}binomialinv(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.INV"),(r,n,i)=>{r=Math.trunc(r);let a=-1,o=r;for(;o>a+1;){const u=Math.trunc((a+o)/2);Vi.cdf(u,r,n)>=i?o=u:a=u}return o})}besselifn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELI"),(r,n)=>Bo(r,Math.trunc(n)))}besseljfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELJ"),(r,n)=>Vo(r,Math.trunc(n)))}besselkfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELK"),(r,n)=>wv(r,Math.trunc(n)))}besselyfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELY"),(r,n)=>Cv(r,Math.trunc(n)))}chisqdist(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST"),(r,n,i)=>(n=Math.trunc(n),i?Bn.cdf(r,n):Bn.pdf(r,n)))}chisqdistrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST.RT"),(r,n)=>1-Bn.cdf(r,Math.trunc(n)))}chisqinv(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV"),(r,n)=>Bn.inv(r,Math.trunc(n)))}chisqinvrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV.RT"),(r,n)=>Bn.inv(1-r,Math.trunc(n)))}fdist(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST"),(r,n,i,a)=>(n=Math.trunc(n),i=Math.trunc(i),a?kn.cdf(r,n,i):kn.pdf(r,n,i)))}fdistrt(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST.RT"),(r,n,i)=>1-kn.cdf(r,Math.trunc(n),Math.trunc(i)))}finv(e,t){return this.runFunction(e.args,t,this.metadata("F.INV"),(r,n,i)=>kn.inv(r,Math.trunc(n),Math.trunc(i)))}finvrt(e,t){return this.runFunction(e.args,t,this.metadata("F.INV.RT"),(r,n,i)=>kn.inv(1-r,Math.trunc(n),Math.trunc(i)))}weibulldist(e,t){return this.runFunction(e.args,t,this.metadata("WEIBULL.DIST"),(r,n,i,a)=>a?fc.cdf(r,i,n):fc.pdf(r,i,n))}poissondist(e,t){return this.runFunction(e.args,t,this.metadata("POISSON.DIST"),(r,n,i)=>(r=Math.trunc(r),i?ko.cdf(r,n):ko.pdf(r,n)))}hypgeomdist(e,t){return this.runFunction(e.args,t,this.metadata("HYPGEOM.DIST"),(r,n,i,a,o)=>r>n||r>i||n>a||i>a?new g(R.NUM,T.ValueLarge):r+a<i+n?new g(R.NUM,T.ValueLarge):(r=Math.trunc(r),n=Math.trunc(n),i=Math.trunc(i),a=Math.trunc(a),o?Ur.cdf(r,a,i,n):Ur.pdf(r,a,i,n)))}tdist(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST"),(r,n,i)=>(n=Math.trunc(n),i?qt.cdf(r,n):qt.pdf(r,n)))}tdist2t(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.2T"),(r,n)=>(1-qt.cdf(r,Math.trunc(n)))*2)}tdistrt(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.RT"),(r,n)=>1-qt.cdf(r,Math.trunc(n)))}tdistold(e,t){return this.runFunction(e.args,t,this.metadata("TDIST"),(r,n,i)=>i*(1-qt.cdf(r,Math.trunc(n))))}tinv(e,t){return this.runFunction(e.args,t,this.metadata("T.INV"),(r,n)=>qt.inv(r,Math.trunc(n)))}tinv2t(e,t){return this.runFunction(e.args,t,this.metadata("T.INV.2T"),(r,n)=>qt.inv(1-r/2,Math.trunc(n)))}lognormdist(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.DIST"),(r,n,i,a)=>a?no.cdf(r,n,i):no.pdf(r,n,i))}lognorminv(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.INV"),(r,n,i)=>no.inv(r,n,i))}normdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.DIST"),(r,n,i,a)=>a?ar.cdf(r,n,i):ar.pdf(r,n,i))}norminv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.INV"),(r,n,i)=>ar.inv(r,n,i))}normsdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.DIST"),(r,n)=>n?ar.cdf(r,0,1):ar.pdf(r,0,1))}normsinv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.INV"),r=>ar.inv(r,0,1))}phi(e,t){return this.runFunction(e.args,t,this.metadata("PHI"),r=>ar.pdf(r,0,1))}negbinomdist(e,t){return this.runFunction(e.args,t,this.metadata("NEGBINOM.DIST"),(r,n,i,a)=>(r=Math.trunc(r),n=Math.trunc(n),a?Go.cdf(r,n,i):Go.pdf(r,n,i)))}confidencenorm(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.NORM"),(r,n,i)=>Mv(1,r,n,Math.trunc(i))[1]-1)}confidencet(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.T"),(r,n,i)=>(i=Math.trunc(i),i===1?new g(R.DIV_BY_ZERO):Ov(1,r,n,i)[1]-1))}standardize(e,t){return this.runFunction(e.args,t,this.metadata("STANDARDIZE"),(r,n,i)=>(r-n)/i)}}Mu.implementedFunctions={ERF:{method:"erf",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}]},ERFC:{method:"erfc",parameters:[{argumentType:h.NUMBER}]},"EXPON.DIST":{method:"expondist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},FISHER:{method:"fisher",parameters:[{argumentType:h.NUMBER,greaterThan:-1,lessThan:1}]},FISHERINV:{method:"fisherinv",parameters:[{argumentType:h.NUMBER}]},GAMMA:{method:"gamma",parameters:[{argumentType:h.NUMBER}]},"GAMMA.DIST":{method:"gammadist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},GAMMALN:{method:"gammaln",parameters:[{argumentType:h.NUMBER,greaterThan:0}]},"GAMMA.INV":{method:"gammainv",parameters:[{argumentType:h.NUMBER,minValue:0,lessThan:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0}]},GAUSS:{method:"gauss",parameters:[{argumentType:h.NUMBER}]},"BETA.DIST":{method:"betadist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:1}]},"BETA.INV":{method:"betainv",parameters:[{argumentType:h.NUMBER,greaterThan:0,maxValue:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,defaultValue:0},{argumentType:h.NUMBER,defaultValue:1}]},"BINOM.DIST":{method:"binomialdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.BOOLEAN}]},"BINOM.INV":{method:"binomialinv",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,greaterThan:0,lessThan:1}]},BESSELI:{method:"besselifn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},BESSELJ:{method:"besseljfn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},BESSELK:{method:"besselkfn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},BESSELY:{method:"besselyfn",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:0}]},"CHISQ.DIST":{method:"chisqdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1,maxValue:1e10},{argumentType:h.BOOLEAN}]},"CHISQ.DIST.RT":{method:"chisqdistrt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV":{method:"chisqinv",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV.RT":{method:"chisqinvrt",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1}]},"F.DIST":{method:"fdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1},{argumentType:h.BOOLEAN}]},"F.DIST.RT":{method:"fdistrt",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1}]},"F.INV":{method:"finv",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1}]},"F.INV.RT":{method:"finvrt",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:1}]},"WEIBULL.DIST":{method:"weibulldist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"POISSON.DIST":{method:"poissondist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0},{argumentType:h.BOOLEAN}]},"HYPGEOM.DIST":{method:"hypgeomdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"T.DIST":{method:"tdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1},{argumentType:h.BOOLEAN}]},"T.DIST.2T":{method:"tdist2t",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1}]},"T.DIST.RT":{method:"tdistrt",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER,minValue:1}]},TDIST:{method:"tdistold",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.INTEGER,minValue:1,maxValue:2}]},"T.INV":{method:"tinv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER,minValue:1}]},"T.INV.2T":{method:"tinv2t",parameters:[{argumentType:h.NUMBER,greaterThan:0,maxValue:1},{argumentType:h.NUMBER,minValue:1}]},"LOGNORM.DIST":{method:"lognormdist",parameters:[{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"LOGNORM.INV":{method:"lognorminv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0}]},"NORM.DIST":{method:"normdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.BOOLEAN}]},"NORM.INV":{method:"norminv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0}]},"NORM.S.DIST":{method:"normsdist",parameters:[{argumentType:h.NUMBER},{argumentType:h.BOOLEAN}]},"NORM.S.INV":{method:"normsinv",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1}]},PHI:{method:"phi",parameters:[{argumentType:h.NUMBER}]},"NEGBINOM.DIST":{method:"negbinomdist",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:1},{argumentType:h.NUMBER,minValue:0,maxValue:1},{argumentType:h.BOOLEAN}]},"CONFIDENCE.NORM":{method:"confidencenorm",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,minValue:1}]},"CONFIDENCE.T":{method:"confidencet",parameters:[{argumentType:h.NUMBER,greaterThan:0,lessThan:1},{argumentType:h.NUMBER,greaterThan:0},{argumentType:h.NUMBER,minValue:1}]},STANDARDIZE:{method:"standardize",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER,greaterThan:0}]}};Mu.aliases={NEGBINOMDIST:"NEGBINOM.DIST",EXPONDIST:"EXPON.DIST",BETADIST:"BETA.DIST",NORMDIST:"NORM.DIST",NORMINV:"NORM.INV",NORMSDIST:"NORM.S.DIST",NORMSINV:"NORM.S.INV",LOGNORMDIST:"LOGNORM.DIST",LOGINV:"LOGNORM.INV",TINV:"T.INV.2T",HYPGEOMDIST:"HYPGEOM.DIST",POISSON:"POISSON.DIST",WEIBULL:"WEIBULL.DIST",FINV:"F.INV.RT",FDIST:"F.DIST.RT",CHIDIST:"CHISQ.DIST.RT",CHIINV:"CHISQ.INV.RT",GAMMADIST:"GAMMA.DIST","GAMMALN.PRECISE":"GAMMALN",GAMMAINV:"GAMMA.INV",BETAINV:"BETA.INV",BINOMDIST:"BINOM.DIST",CONFIDENCE:"CONFIDENCE.NORM",CRITBINOM:"BINOM.INV",WEIBULLDIST:"WEIBULL.DIST",TINV2T:"T.INV.2T",TDISTRT:"T.DIST.RT",TDIST2T:"T.DIST.2T",FINVRT:"F.INV.RT",FDISTRT:"F.DIST.RT",CHIDISTRT:"CHISQ.DIST.RT",CHIINVRT:"CHISQ.INV.RT",LOGNORMINV:"LOGNORM.INV",POISSONDIST:"POISSON.DIST"};/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Yf extends Q{fact(e,t){return this.runFunction(e.args,t,this.metadata("FACT"),r=>{r=Math.trunc(r);let n=1;for(let i=1;i<=r;i++)n*=i;return n})}factdouble(e,t){return this.runFunction(e.args,t,this.metadata("FACTDOUBLE"),r=>{r=Math.trunc(r);let n=1;for(let i=r;i>=1;i-=2)n*=i;return n})}combin(e,t){return this.runFunction(e.args,t,this.metadata("COMBIN"),(r,n)=>n>r?new g(R.NUM,T.WrongOrder):(r=Math.trunc(r),n=Math.trunc(n),mc(r,n)))}combina(e,t){return this.runFunction(e.args,t,this.metadata("COMBINA"),(r,n)=>(r=Math.trunc(r),n=Math.trunc(n),r+n-1>=1030?new g(R.NUM,T.ValueLarge):r===0&&n===0?1:mc(r+n-1,n)))}gcd(e,t){return this.runFunction(e.args,t,this.metadata("GCD"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(r);if(n instanceof g)return n;let i=0;for(const a of n){if(a<0)return new g(R.NUM,T.ValueSmall);i=$f(i,Math.trunc(a))}return i>Number.MAX_SAFE_INTEGER?new g(R.NUM,T.ValueLarge):i})}lcm(e,t){return this.runFunction(e.args,t,this.metadata("LCM"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(r);if(n instanceof g)return n;let i=1;for(const a of n){if(a<0)return new g(R.NUM,T.ValueSmall);i=_v(i,Math.trunc(a))}return i>Number.MAX_SAFE_INTEGER?new g(R.NUM,T.ValueLarge):i})}mround(e,t){return this.runFunction(e.args,t,this.metadata("MROUND"),(r,n)=>n===0?0:r>0&&n<0||r<0&&n>0?new g(R.NUM,T.DistinctSigns):Math.round(r/n)*n)}multinomial(e,t){return this.runFunction(e.args,t,this.metadata("MULTINOMIAL"),(...r)=>{let n=0,i=1;for(let a of r){if(a<0)return new g(R.NUM,T.ValueSmall);a=Math.trunc(a);for(let o=1;o<=a;o++)i*=(n+o)/o;n+=a}return Math.round(i)})}quotient(e,t){return this.runFunction(e.args,t,this.metadata("QUOTIENT"),(r,n)=>n===0?new g(R.DIV_BY_ZERO):Math.trunc(r/n))}seriessum(e,t){return this.runFunction(e.args,t,this.metadata("SERIESSUM"),(r,n,i,a)=>{const o=this.arithmeticHelper.manyToOnlyNumbersDropNulls(a.valuesFromTopLeftCorner());if(o instanceof g)return o;let u=0;o.reverse();for(const l of o)u*=Math.pow(r,i),u+=l;return u*Math.pow(r,n)})}sign(e,t){return this.runFunction(e.args,t,this.metadata("SIGN"),r=>r>0?1:r<0?-1:0)}sumx2my2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2MY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new g(R.NA,T.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const c=i[l],d=a[l];if(c instanceof g)return c;if(d instanceof g)return d;typeof c=="number"&&typeof d=="number"&&(u+=Math.pow(c,2)-Math.pow(d,2))}return u})}sumx2py2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2PY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new g(R.NA,T.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const c=i[l],d=a[l];if(c instanceof g)return c;if(d instanceof g)return d;typeof c=="number"&&typeof d=="number"&&(u+=Math.pow(c,2)+Math.pow(d,2))}return u})}sumxmy2(e,t){return this.runFunction(e.args,t,this.metadata("SUMXMY2"),(r,n)=>{const i=r.valuesFromTopLeftCorner(),a=n.valuesFromTopLeftCorner();if(i.length!==a.length)return new g(R.NA,T.EqualLength);const o=i.length;let u=0;for(let l=0;l<o;l++){const c=i[l],d=a[l];if(c instanceof g)return c;if(d instanceof g)return d;typeof c=="number"&&typeof d=="number"&&(u+=Math.pow(c-d,2))}return u})}}Yf.implementedFunctions={FACT:{method:"fact",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:170}]},FACTDOUBLE:{method:"factdouble",parameters:[{argumentType:h.NUMBER,minValue:0,maxValue:288}]},COMBIN:{method:"combin",parameters:[{argumentType:h.NUMBER,minValue:0,lessThan:1030},{argumentType:h.NUMBER,minValue:0}]},COMBINA:{method:"combina",parameters:[{argumentType:h.NUMBER,minValue:0},{argumentType:h.NUMBER,minValue:0}]},GCD:{method:"gcd",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},LCM:{method:"lcm",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},MROUND:{method:"mround",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},MULTINOMIAL:{method:"multinomial",parameters:[{argumentType:h.NUMBER}],repeatLastArgs:1,expandRanges:!0},QUOTIENT:{method:"quotient",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER}]},SERIESSUM:{method:"seriessum",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.RANGE}]},SIGN:{method:"sign",parameters:[{argumentType:h.NUMBER}]},SUMX2MY2:{method:"sumx2my2",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},SUMX2PY2:{method:"sumx2py2",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},SUMXMY2:{method:"sumxmy2",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]}};function mc(s,e){2*e>s&&(e=s-e);let t=1;for(let r=1;r<=e;r++)t*=(s-e+r)/r;return Math.round(t)}function $f(s,e){for(s<e&&([s,e]=[e,s]);e>0;)[s,e]=[e,s%e];return s}function _v(s,e){return s===0||e===0?0:s*(e/$f(s,e))}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Xf extends Q{complex(e,t){return this.runFunction(e.args,t,this.metadata("COMPLEX"),(r,n,i)=>i!=="i"&&i!=="j"?new g(R.VALUE,T.ShouldBeIorJ):Pe([r,n],i))}imabs(e,t){return this.runFunction(e.args,t,this.metadata("IMABS"),Qf)}imaginary(e,t){return this.runFunction(e.args,t,this.metadata("IMAGINARY"),([r,n])=>n)}imreal(e,t){return this.runFunction(e.args,t,this.metadata("IMREAL"),([r,n])=>r)}imargument(e,t){return this.runFunction(e.args,t,this.metadata("IMARGUMENT"),([r,n])=>r===0&&n===0?new g(R.DIV_BY_ZERO):Math.atan2(n,r))}imconjugate(e,t){return this.runFunction(e.args,t,this.metadata("IMCONJUGATE"),([r,n])=>Pe([r,-n]))}imcos(e,t){return this.runFunction(e.args,t,this.metadata("IMCOS"),r=>Pe(Si(r)))}imcosh(e,t){return this.runFunction(e.args,t,this.metadata("IMCOSH"),r=>Pe(gc(r)))}imcot(e,t){return this.runFunction(e.args,t,this.metadata("IMCOT"),r=>Pe(fn(Si(r),Ai(r))))}imcsc(e,t){return this.runFunction(e.args,t,this.metadata("IMCSC"),r=>Pe(fn([1,0],Ai(r))))}imcsch(e,t){return this.runFunction(e.args,t,this.metadata("IMCSCH"),r=>Pe(fn([1,0],Ec(r))))}imsec(e,t){return this.runFunction(e.args,t,this.metadata("IMSEC"),r=>Pe(fn([1,0],Si(r))))}imsech(e,t){return this.runFunction(e.args,t,this.metadata("IMSECH"),r=>Pe(fn([1,0],gc(r))))}imsin(e,t){return this.runFunction(e.args,t,this.metadata("IMSIN"),r=>Pe(Ai(r)))}imsinh(e,t){return this.runFunction(e.args,t,this.metadata("IMSINH"),r=>Pe(Ec(r)))}imtan(e,t){return this.runFunction(e.args,t,this.metadata("IMTAN"),r=>Pe(fn(Ai(r),Si(r))))}imdiv(e,t){return this.runFunction(e.args,t,this.metadata("IMDIV"),(r,n)=>Pe(fn(r,n)))}improduct(e,t){return this.runFunction(e.args,t,this.metadata("IMPRODUCT"),(...r)=>{const n=this.arithmeticHelper.coerceComplexExactRanges(r);if(n instanceof g)return n;let i=[1,0];for(const a of n)i=Kf(i,a);return Pe(i)})}imsum(e,t){return this.runFunction(e.args,t,this.metadata("IMSUM"),(...r)=>{const n=this.arithmeticHelper.coerceComplexExactRanges(r);if(n instanceof g)return n;let i=[0,0];for(const a of n)i=Lv(i,a);return Pe(i)})}imsub(e,t){return this.runFunction(e.args,t,this.metadata("IMSUB"),(r,n)=>Pe(Fv(r,n)))}imexp(e,t){return this.runFunction(e.args,t,this.metadata("IMEXP"),r=>Pe(qf(r)))}imln(e,t){return this.runFunction(e.args,t,this.metadata("IMLN"),r=>Pe(ki(r)))}imlog10(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG10"),r=>{const[n,i]=ki(r),a=Math.log(10);return Pe([n/a,i/a])})}imlog2(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG2"),r=>{const[n,i]=ki(r),a=Math.log(2);return Pe([n/a,i/a])})}impower(e,t){return this.runFunction(e.args,t,this.metadata("IMPOWER"),(r,n)=>Pe(Rc(r,n)))}imsqrt(e,t){return this.runFunction(e.args,t,this.metadata("IMSQRT"),r=>Pe(Rc(r,.5)))}}Xf.implementedFunctions={COMPLEX:{method:"complex",parameters:[{argumentType:h.NUMBER},{argumentType:h.NUMBER},{argumentType:h.STRING,defaultValue:"i"}]},IMABS:{method:"imabs",parameters:[{argumentType:h.COMPLEX}]},IMAGINARY:{method:"imaginary",parameters:[{argumentType:h.COMPLEX}]},IMREAL:{method:"imreal",parameters:[{argumentType:h.COMPLEX}]},IMARGUMENT:{method:"imargument",parameters:[{argumentType:h.COMPLEX}]},IMCONJUGATE:{method:"imconjugate",parameters:[{argumentType:h.COMPLEX}]},IMCOS:{method:"imcos",parameters:[{argumentType:h.COMPLEX}]},IMCOSH:{method:"imcosh",parameters:[{argumentType:h.COMPLEX}]},IMCOT:{method:"imcot",parameters:[{argumentType:h.COMPLEX}]},IMCSC:{method:"imcsc",parameters:[{argumentType:h.COMPLEX}]},IMCSCH:{method:"imcsch",parameters:[{argumentType:h.COMPLEX}]},IMSEC:{method:"imsec",parameters:[{argumentType:h.COMPLEX}]},IMSECH:{method:"imsech",parameters:[{argumentType:h.COMPLEX}]},IMSIN:{method:"imsin",parameters:[{argumentType:h.COMPLEX}]},IMSINH:{method:"imsinh",parameters:[{argumentType:h.COMPLEX}]},IMTAN:{method:"imtan",parameters:[{argumentType:h.COMPLEX}]},IMDIV:{method:"imdiv",parameters:[{argumentType:h.COMPLEX},{argumentType:h.COMPLEX}]},IMPRODUCT:{method:"improduct",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},IMSUM:{method:"imsum",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},IMSUB:{method:"imsub",parameters:[{argumentType:h.COMPLEX},{argumentType:h.COMPLEX}]},IMEXP:{method:"imexp",parameters:[{argumentType:h.COMPLEX}]},IMLN:{method:"imln",parameters:[{argumentType:h.COMPLEX}]},IMLOG10:{method:"imlog10",parameters:[{argumentType:h.COMPLEX}]},IMLOG2:{method:"imlog2",parameters:[{argumentType:h.COMPLEX}]},IMPOWER:{method:"impower",parameters:[{argumentType:h.COMPLEX},{argumentType:h.NUMBER}]},IMSQRT:{method:"imsqrt",parameters:[{argumentType:h.COMPLEX}]}};function Lv([s,e],[t,r]){return[s+t,e+r]}function Fv([s,e],[t,r]){return[s-t,e-r]}function Kf([s,e],[t,r]){return[s*t-e*r,s*r+t*e]}function fn([s,e],[t,r]){const n=Math.pow(t,2)+Math.pow(r,2),[i,a]=Kf([s,e],[t,-r]);return[i/n,a/n]}function Si([s,e]){return[Math.cos(s)*Math.cosh(e),-Math.sin(s)*Math.sinh(e)]}function gc([s,e]){return[Math.cosh(s)*Math.cos(e),Math.sinh(s)*Math.sin(e)]}function Ai([s,e]){return[Math.sin(s)*Math.cosh(e),Math.cos(s)*Math.sinh(e)]}function Ec([s,e]){return[Math.sinh(s)*Math.cos(e),Math.cosh(s)*Math.sin(e)]}function qf([s,e]){return[Math.exp(s)*Math.cos(e),Math.exp(s)*Math.sin(e)]}function Qf([s,e]){return Math.sqrt(s*s+e*e)}function ki([s,e]){return[Math.log(Qf([s,e])),Math.atan2(e,s)]}function Rc(s,e){const[t,r]=ki(s);return qf([e*t,e*r])}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class Ou extends Q{avedev(e,t){return this.runFunction(e.args,t,this.metadata("AVEDEV"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof g)return n;if(n.length===0)return new g(R.DIV_BY_ZERO);const i=Kt(n);return n.reduce((a,o)=>a+Math.abs(o-i),0)/n.length})}devsq(e,t){return this.runFunction(e.args,t,this.metadata("DEVSQ"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);return n instanceof g?n:n.length===0?0:En(n)})}geomean(e,t){return this.runFunction(e.args,t,this.metadata("GEOMEAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof g)return n;if(n.length===0)return new g(R.NUM,T.OneValue);for(const i of n)if(i<=0)return new g(R.NUM,T.ValueSmall);return xv(n)})}harmean(e,t){return this.runFunction(e.args,t,this.metadata("HARMEAN"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof g)return n;if(n.length===0)return new g(R.NUM,T.OneValue);for(const i of n)if(i<=0)return new g(R.NUM,T.ValueSmall);return n.length/n.reduce((i,a)=>i+1/a,0)})}correl(e,t){return this.runFunction(e.args,t,this.metadata("CORREL"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new g(R.NA,T.EqualLength);const i=pn(r,n);return i instanceof g?i:i[0].length<=1?new g(R.DIV_BY_ZERO,T.TwoValues):pc(i[0],i[1])})}rsq(e,t){return this.runFunction(e.args,t,this.metadata("RSQ"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new g(R.NA,T.EqualLength);const i=pn(r,n);return i instanceof g?i:i[0].length<=1?new g(R.DIV_BY_ZERO,T.TwoValues):Math.pow(pc(i[0],i[1]),2)})}covariancep(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.P"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new g(R.NA,T.EqualLength);const i=pn(r,n);if(i instanceof g)return i;const a=i[0].length;return a<1?new g(R.DIV_BY_ZERO,T.OneValue):a===1?0:Cs(i[0],i[1])*(a-1)/a})}covariances(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.S"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new g(R.NA,T.EqualLength);const i=pn(r,n);return i instanceof g?i:i[0].length<=1?new g(R.DIV_BY_ZERO,T.TwoValues):Cs(i[0],i[1])})}ztest(e,t){return this.runFunction(e.args,t,this.metadata("Z.TEST"),(r,n,i)=>{const a=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner());if(a instanceof g)return a;const o=a.length;if(i===void 0){if(o<2)return new g(R.DIV_BY_ZERO,T.TwoValues);i=en(a,!0)}return o<1?new g(R.NA,T.OneValue):i===0?new g(R.DIV_BY_ZERO):1-ar.cdf((Kt(a)-n)/(i/Math.sqrt(o)),0,1)})}ftest(e,t){return this.runFunction(e.args,t,this.metadata("F.TEST"),(r,n)=>{const i=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner()),a=this.arithmeticHelper.manyToExactNumbers(n.valuesFromTopLeftCorner());if(i instanceof g)return i;if(a instanceof g)return a;if(i.length<=1||a.length<=1)return new g(R.DIV_BY_ZERO);const o=As(i,!0),u=As(a,!0);if(o===0||u===0)return new g(R.DIV_BY_ZERO);const l=o/u,c=kn.cdf(l,i.length-1,a.length-1);return 2*Math.min(c,1-c)})}steyx(e,t){return this.runFunction(e.args,t,this.metadata("STEYX"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new g(R.NA,T.EqualLength);const i=pn(r,n);if(i instanceof g)return i;const a=i[0].length;return a<=2?new g(R.DIV_BY_ZERO,T.ThreeValues):Math.sqrt((En(i[0])-Math.pow(Cs(i[0],i[1])*(a-1),2)/En(i[1]))/(a-2))})}slope(e,t){return this.runFunction(e.args,t,this.metadata("SLOPE"),(r,n)=>{if(r.numberOfElements()!==n.numberOfElements())return new g(R.NA,T.EqualLength);const i=pn(r,n);if(i instanceof g)return i;const a=i[0].length;return a<=1?new g(R.DIV_BY_ZERO,T.TwoValues):Cs(i[0],i[1])*(a-1)/En(i[1])})}chisqtest(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.TEST"),(r,n)=>{const i=r.height(),a=r.width();if(n.height()!==i||n.width()!==a)return new g(R.NA,T.EqualLength);const o=pn(r,n);if(o instanceof g)return o;if(o[0].length<=1)return new g(R.DIV_BY_ZERO,T.TwoValues);let u=0;for(let l=0;l<o[0].length;l++){if(o[1][l]===0)return new g(R.DIV_BY_ZERO);u+=Math.pow(o[0][l]-o[1][l],2)/o[1][l]}return u<0?new g(R.NUM,T.NaN):1-Bn.cdf(u,i>1&&a>1?(i-1)*(a-1):i*a-1)})}ttest(e,t){return this.runFunction(e.args,t,this.metadata("T.TEST"),(r,n,i,a)=>{const o=this.arithmeticHelper.manyToExactNumbers(r.valuesFromTopLeftCorner()),u=this.arithmeticHelper.manyToExactNumbers(n.valuesFromTopLeftCorner());if(o instanceof g)return o;if(u instanceof g)return u;const l=o.length,c=u.length;if(a===1){if(c!==l)return new g(R.NA,T.EqualLength);if(l<=1)return new g(R.DIV_BY_ZERO,T.TwoValues);const d=Array(l);for(let E=0;E<l;E++)d[E]=o[E]-u[E];const f=en(d,!0);if(f===0)return new g(R.DIV_BY_ZERO);const p=Math.abs(Math.sqrt(l)*Kt(d)/f);return i*(1-qt.cdf(p,l-1))}else if(a===2){if(l<=1||c<=1)return new g(R.DIV_BY_ZERO,T.TwoValues);const d=(En(o)+En(u))/(l+c-2);if(d===0)return new g(R.DIV_BY_ZERO);const f=Math.abs((Kt(o)-Kt(u))/Math.sqrt(d*(1/l+1/c)));return i*(1-qt.cdf(f,l+c-2))}else{if(l<=1||c<=1)return new g(R.DIV_BY_ZERO,T.TwoValues);const d=As(o,!0),f=As(u,!0);if(d===0&&f===0)return new g(R.DIV_BY_ZERO);const p=Math.abs((Kt(o)-Kt(u))/Math.sqrt(d/l+f/c)),E=Math.pow(d/l+f/c,2)/(Math.pow(d/l,2)/(l-1)+Math.pow(f/c,2)/(c-1));return i*(1-qt.cdf(p,E))}})}skew(e,t){return this.runFunction(e.args,t,this.metadata("SKEW"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof g)return n;const i=n.length;if(i<3)return new g(R.DIV_BY_ZERO,T.ThreeValues);const a=Kt(n),o=en(n,!0);return o===0?new g(R.DIV_BY_ZERO):n.reduce((u,l)=>u+Math.pow((l-a)/o,3),0)*i/(i-1)/(i-2)})}skewp(e,t){return this.runFunction(e.args,t,this.metadata("SKEW.P"),(...r)=>{const n=this.arithmeticHelper.coerceNumbersExactRanges(r);if(n instanceof g)return n;const i=n.length;if(i<3)return new g(R.DIV_BY_ZERO,T.ThreeValues);const a=Kt(n),o=en(n,!1);return o===0?new g(R.DIV_BY_ZERO):n.reduce((u,l)=>u+Math.pow((l-a)/o,3),0)/i})}}Ou.implementedFunctions={AVEDEV:{method:"avedev",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},DEVSQ:{method:"devsq",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},GEOMEAN:{method:"geomean",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},HARMEAN:{method:"harmean",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},CORREL:{method:"correl",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},RSQ:{method:"rsq",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"COVARIANCE.P":{method:"covariancep",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"COVARIANCE.S":{method:"covariances",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"Z.TEST":{method:"ztest",parameters:[{argumentType:h.RANGE},{argumentType:h.NUMBER},{argumentType:h.NUMBER,optionalArg:!0}]},"F.TEST":{method:"ftest",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},STEYX:{method:"steyx",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},SLOPE:{method:"slope",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"CHISQ.TEST":{method:"chisqtest",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE}]},"T.TEST":{method:"ttest",parameters:[{argumentType:h.RANGE},{argumentType:h.RANGE},{argumentType:h.INTEGER,minValue:1,maxValue:2},{argumentType:h.INTEGER,minValue:1,maxValue:3}]},SKEW:{method:"skew",parameters:[{argumentType:h.ANY}],repeatLastArgs:1},"SKEW.P":{method:"skewp",parameters:[{argumentType:h.ANY}],repeatLastArgs:1}};Ou.aliases={COVAR:"COVARIANCE.P",FTEST:"F.TEST",PEARSON:"CORREL",ZTEST:"Z.TEST",CHITEST:"CHISQ.TEST",TTEST:"T.TEST",COVARIANCEP:"COVARIANCE.P",COVARIANCES:"COVARIANCE.S",SKEWP:"SKEW.P"};function pn(s,e){const t=s.iterateValuesFromTopLeftCorner(),r=e.iterateValuesFromTopLeftCorner();let n,i;const a=[],o=[];for(;n=t.next(),i=r.next(),!n.done&&!i.done;){const u=n.value,l=i.value;if(u instanceof g)return u;if(l instanceof g)return l;de(u)&&de(l)&&(a.push(F(u)),o.push(F(l)))}return[a,o]}/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */const yc=Object.freeze(Object.defineProperty({__proto__:null,AbsPlugin:qd,AddressPlugin:Xd,ArrayPlugin:Kd,BitShiftPlugin:Qd,BitwiseLogicOperationsPlugin:tf,BooleanPlugin:rf,CharPlugin:nf,CodePlugin:sf,ComplexPlugin:Xf,ConditionalAggregationPlugin:xf,CountBlankPlugin:af,CountUniquePlugin:of,DateTimePlugin:uf,DegreesPlugin:lf,DeltaPlugin:cf,ExpPlugin:hf,FinancialPlugin:df,FormulaTextPlugin:ff,HyperlinkPlugin:pf,InformationPlugin:mf,IsEvenPlugin:gf,IsOddPlugin:Ef,LogarithmPlugin:Rf,LookupPlugin:Uf,MathConstantsPlugin:yf,MathPlugin:Yf,MatrixPlugin:Nf,MedianPlugin:Tf,ModuloPlugin:vf,NumericAggregationPlugin:Su,PowerPlugin:Sf,RadiansPlugin:Af,RadixConversionPlugin:wf,RandomPlugin:Of,RomanPlugin:Pf,RoundingPlugin:Au,SimpleArithmerticPlugin:Df,SqrtPlugin:bf,StatisticalAggregationPlugin:Ou,StatisticalPlugin:Mu,SumprodPlugin:_f,TextPlugin:Lf,TrigonometryPlugin:Ff},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright (c) 2025 Handsoncode. All rights reserved.
 */class ne extends it{}ne.HyperFormula=it;ne.ErrorType=R;ne.CellError=g;ne.CellType=vt;ne.CellValueType=lr;ne.CellValueDetailedType=mN;ne.DetailedCellError=xd;ne.ExportedCellChange=Lo;ne.ExportedNamedExpressionChange=Wd;ne.ConfigValueTooBigError=yd;ne.ConfigValueTooSmallError=Rd;ne.EvaluationSuspendedError=Td;ne.ExpectedOneOfValuesError=Nd;ne.ExpectedValueOfTypeError=he;ne.ArraySize=Z;ne.SimpleRangeValue=D;ne.EmptyValue=te;ne.FunctionPlugin=Q;ne.FunctionArgumentType=h;ne.FunctionPluginValidationError=es;ne.InvalidAddressError=hd;ne.InvalidArgumentsError=$e;ne.LanguageNotRegisteredError=vo;ne.LanguageAlreadyRegisteredError=Sd;ne.MissingTranslationError=Dn;ne.NamedExpressionDoesNotExistError=js;ne.NamedExpressionNameIsAlreadyTakenError=dd;ne.NamedExpressionNameIsInvalidError=fd;ne.NoOperationToRedoError=md;ne.NoOperationToUndoError=pd;ne.NoRelativeAddressesAllowedError=Ru;ne.NoSheetWithIdError=Le;ne.NoSheetWithNameError=cd;ne.NotAFormulaError=Ui;ne.NothingToPasteError=gd;ne.ProtectedFunctionTranslationError=vd;ne.SheetNameAlreadyTakenError=Ws;ne.SheetSizeLimitExceededError=Tn;ne.SourceLocationHasArrayError=Wn;ne.TargetLocationHasArrayError=na;ne.UnableToParseError=Ed;const Uv=kt.defaultConfig.language;it.registerLanguage(Uv,Fo);it.languages[Fo.langCode]=Fo;for(const s of Object.getOwnPropertyNames(yc))s.startsWith("_")||it.registerFunctionPlugin(yc[s]);vg(Vg);Hc();const Zf=({hotRef:s,search:e,columns:t,rowData:r,colorData:n,colorTextData:i,afterSelection:a,handleAfterColumnResize:o})=>{const{theme:u}=Xc();C.useEffect(()=>{const p=s.current?.hotInstance;if(!p||!r)return;let E=!1;n&&n.forEach((m,S)=>{m&&m.forEach((v,A)=>{const w=p.getCellMeta(S,A).backgroundColor,I=v||void 0;w!==I&&(p.setCellMeta(S,A,"backgroundColor",I),E=!0)})}),i&&i.forEach((m,S)=>{m&&m.forEach((v,A)=>{const w=p.getCellMeta(S,A).color,I=v||void 0;w!==I&&(p.setCellMeta(S,A,"color",I),E=!0)})}),E&&p.render()},[r,n,i,s]);const l=[],c=C.useMemo(()=>{if(!t)return;const p=[];return t.forEach((E,m)=>{E.select&&l.push({value:m,text:E.title,label:E.title}),p.push({...E,title:E.title})}),p},[t]),d=C.useMemo(()=>c&&c.map((p,E)=>{const{readOnly:m,...S}=p;let v={...S,theme:u,isFirstColumn:c.indexOf(p)===0,data:E,colorData:n,colorTextData:i};return p.type==="numeric"?v={...v,type:"numeric",numericFormat:{pattern:"0,0"},originalRenderer:re.renderers.NumericRenderer}:p.type==="date"?v={...v,type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,editorOptions:{i18n:Dv},originalRenderer:re.renderers.DateRenderer}:p.type==="checkbox"?v={...v,type:"checkbox",className:"htCenter",originalRenderer:re.renderers.CheckboxRenderer}:v.originalRenderer=re.renderers.TextRenderer,{...v,renderer:Pv}}),[c,r,u]),f=u==="dark"?"ht-theme-main-dark-auto":"ht-theme-main";return N.jsx("div",{className:"w-full",children:N.jsx(Tg,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:s,data:r,themeName:f,rowHeaders:!0,language:"ko-KR",colHeaders:t&&t.map(p=>p.title),autoWrapRow:!0,height:"auto",contextMenu:!0,search:e,observeChanges:!0,columnSorting:!0,afterSelection:a,formulas:{engine:it.buildEmpty({licenseKey:"gpl-v3"})},columns:d,manualColumnResize:!0,afterColumnResize:o,colWidths:t.map(p=>p.width),filters:!0,licenseKey:"non-commercial-and-evaluation"})})},Pv=(s,e,t,r,n,i,a)=>{a.originalRenderer?a.originalRenderer.apply(void 0,[s,e,t,r,n,i,a]):re.renderers.TextRenderer.apply(void 0,[s,e,t,r,n,i,a]);const o=s.getSettings().search,u=a.theme,l=s.getCellMeta(t,r),c=a.backgroundColor||l.backgroundColor,d=a.color||l.color,f=a.colorData,p=a.colorTextData;e.style.backgroundColor="",e.style.color="",o&&i&&String(i).toLowerCase().includes(o.toLowerCase())?(e.style.backgroundColor=u==="dark"?"#facc15":"yellow",e.style.color="black"):(e.style.backgroundColor=c,c||(t%2===0?e.style.backgroundColor=u==="dark"?"#101010":"#ffffff":e.style.backgroundColor=u==="dark"?"#000000":"#f8f8f8")),d&&(e.style.color=d),f?.[t]?.[r]&&(e.style.backgroundColor=f[t]?.[r]),p?.[t]?.[r]&&(e.style.color=p[t]?.[r])},Dv={previousMonth:"이전 달",nextMonth:"다음 달",months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],weekdaysShort:["일","월","화","수","목","금","토"],firstDay:0,format:"YYYY-MM-DD",toString(s,e){const t=s.getDate(),r=s.getMonth()+1;return`${s.getFullYear()}-${r.toString().padStart(2,"0")}-${t.toString().padStart(2,"0")}`},parse(s,e){const t=s.split("-");return new Date(t[0],t[1]-1,t[2])}},QA=({rootDb:s,detailData:e})=>{console.log("MemoDetailGrid.detailData=",s,e);const{user:t}=Kc(),{ui:r}=Xc(),{t:n}=$o(),{sheetId:i}=Sg(),[a,o]=C.useState([]),u=C.useRef(null);C.useRef(null);const[l,c]=C.useState([]),[d,f]=C.useState(void 0),[p,E]=C.useState(void 0),[m,S]=C.useState(""),[v,A]=C.useState({show:!1,message:""}),[w,I]=C.useState(""),[O,_]=C.useState(!0);if(C.useEffect(()=>{if(e){_(!0);const{columns:L,data:G,color:H,textColor:P,memo:le}=e;o(L||[{title:"title",data:"title",type:"text"}]),I(le||"");const se=G?Object.values(G).map(q=>typeof q=="string"?JSON.parse(q):q):[],ie=H?Object.values(H).map(q=>JSON.parse(q)):[],ce=P?Object.values(P).map(q=>JSON.parse(q)):[];c(se),f(ie),E(ce),_(!1)}},[e]),t===void 0)return N.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:N.jsx(Ag,{children:n("login_required")})});const x=()=>N.jsxs("div",{className:"pt-5",children:[N.jsx("div",{className:"mb-4 h-14 bg-gray-200 dark:bg-zinc-800 rounded-md animate-shimmer relative overflow-hidden"}),N.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 pb-2 items-end",children:N.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-900 rounded-md animate-shimmer relative overflow-hidden"})}),N.jsxs("div",{className:"mt-2 space-y-1",children:[N.jsx("div",{className:"h-10 bg-gray-200 dark:bg-zinc-900 rounded-t-md animate-shimmer relative overflow-hidden"}),[...Array(5)].map((L,G)=>N.jsx("div",{className:"h-8 bg-gray-300 dark:bg-zinc-800 rounded animate-shimmer relative overflow-hidden"},G))]})]});return O?N.jsx(x,{}):l===void 0||d===void 0||p===void 0?N.jsx(x,{}):N.jsxs("div",{className:"relative",children:[N.jsx(qc,{children:v.show&&N.jsx(Zn.div,{initial:{y:"-100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"-100%",opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"fixed top-50 left-1/2 -translate-x-1/2 z-[2000] p-3 rounded-lg shadow-lg bg-green-500 text-white font-semibold",children:v.message})}),N.jsx("div",{className:"mb-4",children:N.jsx("div",{className:`${Zt.card} p-4 min-h-[4rem] prose dark:prose-invert max-w-none`,children:w?N.jsx(Lg,{children:w}):N.jsx("p",{className:"text-gray-400",children:n("double_click_to_edit_memo")})})}),N.jsx("div",{className:"group",children:N.jsx(Zf,{hotRef:u,search:m,columns:a,rowData:l,colorData:d,colorTextData:p})})]})};function Vv(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return C.useMemo(()=>r=>{e.forEach(n=>n(r))},e)}const La=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function is(s){const e=Object.prototype.toString.call(s);return e==="[object Window]"||e==="[object global]"}function bu(s){return"nodeType"in s}function xt(s){var e,t;return s?is(s)?s:bu(s)&&(e=(t=s.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function xu(s){const{Document:e}=xt(s);return s instanceof e}function si(s){return is(s)?!1:s instanceof xt(s).HTMLElement}function Jf(s){return s instanceof xt(s).SVGElement}function as(s){return s?is(s)?s.document:bu(s)?xu(s)?s:si(s)||Jf(s)?s.ownerDocument:document:document:document}const Mr=La?C.useLayoutEffect:C.useEffect;function _u(s){const e=C.useRef(s);return Mr(()=>{e.current=s}),C.useCallback(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.current==null?void 0:e.current(...r)},[])}function Bv(){const s=C.useRef(null),e=C.useCallback((r,n)=>{s.current=setInterval(r,n)},[]),t=C.useCallback(()=>{s.current!==null&&(clearInterval(s.current),s.current=null)},[]);return[e,t]}function qs(s,e){e===void 0&&(e=[s]);const t=C.useRef(s);return Mr(()=>{t.current!==s&&(t.current=s)},e),t}function ii(s,e){const t=C.useRef();return C.useMemo(()=>{const r=s(t.current);return t.current=r,r},[...e])}function pa(s){const e=_u(s),t=C.useRef(null),r=C.useCallback(n=>{n!==t.current&&e?.(n,t.current),t.current=n},[]);return[t,r]}function Ho(s){const e=C.useRef();return C.useEffect(()=>{e.current=s},[s]),e.current}let so={};function ai(s,e){return C.useMemo(()=>{if(e)return e;const t=so[s]==null?0:so[s]+1;return so[s]=t,s+"-"+t},[s,e])}function ep(s){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce((i,a)=>{const o=Object.entries(a);for(const[u,l]of o){const c=i[u];c!=null&&(i[u]=c+s*l)}return i},{...e})}}const Qn=ep(1),ma=ep(-1);function kv(s){return"clientX"in s&&"clientY"in s}function Lu(s){if(!s)return!1;const{KeyboardEvent:e}=xt(s.target);return e&&s instanceof e}function Gv(s){if(!s)return!1;const{TouchEvent:e}=xt(s.target);return e&&s instanceof e}function Wo(s){if(Gv(s)){if(s.touches&&s.touches.length){const{clientX:e,clientY:t}=s.touches[0];return{x:e,y:t}}else if(s.changedTouches&&s.changedTouches.length){const{clientX:e,clientY:t}=s.changedTouches[0];return{x:e,y:t}}}return kv(s)?{x:s.clientX,y:s.clientY}:null}const rs=Object.freeze({Translate:{toString(s){if(!s)return;const{x:e,y:t}=s;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(s){if(!s)return;const{scaleX:e,scaleY:t}=s;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(s){if(s)return[rs.Translate.toString(s),rs.Scale.toString(s)].join(" ")}},Transition:{toString(s){let{property:e,duration:t,easing:r}=s;return e+" "+t+"ms "+r}}}),Nc="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Hv(s){return s.matches(Nc)?s:s.querySelector(Nc)}const Wv={display:"none"};function zv(s){let{id:e,value:t}=s;return yt.createElement("div",{id:e,style:Wv},t)}function jv(s){let{id:e,announcement:t,ariaLiveType:r="assertive"}=s;const n={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return yt.createElement("div",{id:e,style:n,role:"status","aria-live":r,"aria-atomic":!0},t)}function Yv(){const[s,e]=C.useState("");return{announce:C.useCallback(r=>{r!=null&&e(r)},[]),announcement:s}}const tp=C.createContext(null);function $v(s){const e=C.useContext(tp);C.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(s)},[s,e])}function Xv(){const[s]=C.useState(()=>new Set),e=C.useCallback(r=>(s.add(r),()=>s.delete(r)),[s]);return[C.useCallback(r=>{let{type:n,event:i}=r;s.forEach(a=>{var o;return(o=a[n])==null?void 0:o.call(a,i)})},[s]),e]}const Kv={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},qv={onDragStart(s){let{active:e}=s;return"Picked up draggable item "+e.id+"."},onDragOver(s){let{active:e,over:t}=s;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(s){let{active:e,over:t}=s;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(s){let{active:e}=s;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function Qv(s){let{announcements:e=qv,container:t,hiddenTextDescribedById:r,screenReaderInstructions:n=Kv}=s;const{announce:i,announcement:a}=Yv(),o=ai("DndLiveRegion"),[u,l]=C.useState(!1);if(C.useEffect(()=>{l(!0)},[]),$v(C.useMemo(()=>({onDragStart(d){let{active:f}=d;i(e.onDragStart({active:f}))},onDragMove(d){let{active:f,over:p}=d;e.onDragMove&&i(e.onDragMove({active:f,over:p}))},onDragOver(d){let{active:f,over:p}=d;i(e.onDragOver({active:f,over:p}))},onDragEnd(d){let{active:f,over:p}=d;i(e.onDragEnd({active:f,over:p}))},onDragCancel(d){let{active:f,over:p}=d;i(e.onDragCancel({active:f,over:p}))}}),[i,e])),!u)return null;const c=yt.createElement(yt.Fragment,null,yt.createElement(zv,{id:r,value:n.draggable}),yt.createElement(jv,{id:o,announcement:a}));return t?Ns.createPortal(c,t):c}var qe;(function(s){s.DragStart="dragStart",s.DragMove="dragMove",s.DragEnd="dragEnd",s.DragCancel="dragCancel",s.DragOver="dragOver",s.RegisterDroppable="registerDroppable",s.SetDroppableDisabled="setDroppableDisabled",s.UnregisterDroppable="unregisterDroppable"})(qe||(qe={}));function ga(){}function Zv(s,e){return C.useMemo(()=>({sensor:s,options:e??{}}),[s,e])}function Jv(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return C.useMemo(()=>[...e].filter(r=>r!=null),[...e])}const dr=Object.freeze({x:0,y:0});function eS(s,e){return Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2))}function tS(s,e){let{data:{value:t}}=s,{data:{value:r}}=e;return t-r}function rS(s,e){let{data:{value:t}}=s,{data:{value:r}}=e;return r-t}function nS(s,e){if(!s||s.length===0)return null;const[t]=s;return t[e]}function Tc(s,e,t){return e===void 0&&(e=s.left),t===void 0&&(t=s.top),{x:e+s.width*.5,y:t+s.height*.5}}const sS=s=>{let{collisionRect:e,droppableRects:t,droppableContainers:r}=s;const n=Tc(e,e.left,e.top),i=[];for(const a of r){const{id:o}=a,u=t.get(o);if(u){const l=eS(Tc(u),n);i.push({id:o,data:{droppableContainer:a,value:l}})}}return i.sort(tS)};function iS(s,e){const t=Math.max(e.top,s.top),r=Math.max(e.left,s.left),n=Math.min(e.left+e.width,s.left+s.width),i=Math.min(e.top+e.height,s.top+s.height),a=n-r,o=i-t;if(r<n&&t<i){const u=e.width*e.height,l=s.width*s.height,c=a*o,d=c/(u+l-c);return Number(d.toFixed(4))}return 0}const aS=s=>{let{collisionRect:e,droppableRects:t,droppableContainers:r}=s;const n=[];for(const i of r){const{id:a}=i,o=t.get(a);if(o){const u=iS(o,e);u>0&&n.push({id:a,data:{droppableContainer:i,value:u}})}}return n.sort(rS)};function oS(s,e,t){return{...s,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function rp(s,e){return s&&e?{x:s.left-e.left,y:s.top-e.top}:dr}function uS(s){return function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n.reduce((a,o)=>({...a,top:a.top+s*o.y,bottom:a.bottom+s*o.y,left:a.left+s*o.x,right:a.right+s*o.x}),{...t})}}const lS=uS(1);function cS(s){if(s.startsWith("matrix3d(")){const e=s.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(s.startsWith("matrix(")){const e=s.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function hS(s,e,t){const r=cS(e);if(!r)return s;const{scaleX:n,scaleY:i,x:a,y:o}=r,u=s.left-a-(1-n)*parseFloat(t),l=s.top-o-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),c=n?s.width/n:s.width,d=i?s.height/i:s.height;return{width:c,height:d,top:l,right:u+c,bottom:l+d,left:u}}const dS={ignoreTransform:!1};function os(s,e){e===void 0&&(e=dS);let t=s.getBoundingClientRect();if(e.ignoreTransform){const{transform:l,transformOrigin:c}=xt(s).getComputedStyle(s);l&&(t=hS(t,l,c))}const{top:r,left:n,width:i,height:a,bottom:o,right:u}=t;return{top:r,left:n,width:i,height:a,bottom:o,right:u}}function vc(s){return os(s,{ignoreTransform:!0})}function fS(s){const e=s.innerWidth,t=s.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function pS(s,e){return e===void 0&&(e=xt(s).getComputedStyle(s)),e.position==="fixed"}function mS(s,e){e===void 0&&(e=xt(s).getComputedStyle(s));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(n=>{const i=e[n];return typeof i=="string"?t.test(i):!1})}function Fu(s,e){const t=[];function r(n){if(e!=null&&t.length>=e||!n)return t;if(xu(n)&&n.scrollingElement!=null&&!t.includes(n.scrollingElement))return t.push(n.scrollingElement),t;if(!si(n)||Jf(n)||t.includes(n))return t;const i=xt(s).getComputedStyle(n);return n!==s&&mS(n,i)&&t.push(n),pS(n,i)?t:r(n.parentNode)}return s?r(s):t}function np(s){const[e]=Fu(s,1);return e??null}function io(s){return!La||!s?null:is(s)?s:bu(s)?xu(s)||s===as(s).scrollingElement?window:si(s)?s:null:null}function sp(s){return is(s)?s.scrollX:s.scrollLeft}function ip(s){return is(s)?s.scrollY:s.scrollTop}function zo(s){return{x:sp(s),y:ip(s)}}var tt;(function(s){s[s.Forward=1]="Forward",s[s.Backward=-1]="Backward"})(tt||(tt={}));function ap(s){return!La||!s?!1:s===document.scrollingElement}function op(s){const e={x:0,y:0},t=ap(s)?{height:window.innerHeight,width:window.innerWidth}:{height:s.clientHeight,width:s.clientWidth},r={x:s.scrollWidth-t.width,y:s.scrollHeight-t.height},n=s.scrollTop<=e.y,i=s.scrollLeft<=e.x,a=s.scrollTop>=r.y,o=s.scrollLeft>=r.x;return{isTop:n,isLeft:i,isBottom:a,isRight:o,maxScroll:r,minScroll:e}}const gS={x:.2,y:.2};function ES(s,e,t,r,n){let{top:i,left:a,right:o,bottom:u}=t;r===void 0&&(r=10),n===void 0&&(n=gS);const{isTop:l,isBottom:c,isLeft:d,isRight:f}=op(s),p={x:0,y:0},E={x:0,y:0},m={height:e.height*n.y,width:e.width*n.x};return!l&&i<=e.top+m.height?(p.y=tt.Backward,E.y=r*Math.abs((e.top+m.height-i)/m.height)):!c&&u>=e.bottom-m.height&&(p.y=tt.Forward,E.y=r*Math.abs((e.bottom-m.height-u)/m.height)),!f&&o>=e.right-m.width?(p.x=tt.Forward,E.x=r*Math.abs((e.right-m.width-o)/m.width)):!d&&a<=e.left+m.width&&(p.x=tt.Backward,E.x=r*Math.abs((e.left+m.width-a)/m.width)),{direction:p,speed:E}}function RS(s){if(s===document.scrollingElement){const{innerWidth:i,innerHeight:a}=window;return{top:0,left:0,right:i,bottom:a,width:i,height:a}}const{top:e,left:t,right:r,bottom:n}=s.getBoundingClientRect();return{top:e,left:t,right:r,bottom:n,width:s.clientWidth,height:s.clientHeight}}function up(s){return s.reduce((e,t)=>Qn(e,zo(t)),dr)}function yS(s){return s.reduce((e,t)=>e+sp(t),0)}function NS(s){return s.reduce((e,t)=>e+ip(t),0)}function TS(s,e){if(e===void 0&&(e=os),!s)return;const{top:t,left:r,bottom:n,right:i}=e(s);np(s)&&(n<=0||i<=0||t>=window.innerHeight||r>=window.innerWidth)&&s.scrollIntoView({block:"center",inline:"center"})}const vS=[["x",["left","right"],yS],["y",["top","bottom"],NS]];class Uu{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Fu(t),n=up(r);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,a,o]of vS)for(const u of a)Object.defineProperty(this,u,{get:()=>{const l=o(r),c=n[i]-l;return this.rect[u]+c},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ds{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...t)})},this.target=e}add(e,t,r){var n;(n=this.target)==null||n.addEventListener(e,t,r),this.listeners.push([e,t,r])}}function SS(s){const{EventTarget:e}=xt(s);return s instanceof e?s:as(s)}function ao(s,e){const t=Math.abs(s.x),r=Math.abs(s.y);return typeof e=="number"?Math.sqrt(t**2+r**2)>e:"x"in e&&"y"in e?t>e.x&&r>e.y:"x"in e?t>e.x:"y"in e?r>e.y:!1}var Qt;(function(s){s.Click="click",s.DragStart="dragstart",s.Keydown="keydown",s.ContextMenu="contextmenu",s.Resize="resize",s.SelectionChange="selectionchange",s.VisibilityChange="visibilitychange"})(Qt||(Qt={}));function Sc(s){s.preventDefault()}function AS(s){s.stopPropagation()}var Ee;(function(s){s.Space="Space",s.Down="ArrowDown",s.Right="ArrowRight",s.Left="ArrowLeft",s.Up="ArrowUp",s.Esc="Escape",s.Enter="Enter",s.Tab="Tab"})(Ee||(Ee={}));const lp={start:[Ee.Space,Ee.Enter],cancel:[Ee.Esc],end:[Ee.Space,Ee.Enter,Ee.Tab]},CS=(s,e)=>{let{currentCoordinates:t}=e;switch(s.code){case Ee.Right:return{...t,x:t.x+25};case Ee.Left:return{...t,x:t.x-25};case Ee.Down:return{...t,y:t.y+25};case Ee.Up:return{...t,y:t.y-25}}};class cp{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Ds(as(t)),this.windowListeners=new Ds(xt(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Qt.Resize,this.handleCancel),this.windowListeners.add(Qt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Qt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,r=e.node.current;r&&TS(r),t(dr)}handleKeyDown(e){if(Lu(e)){const{active:t,context:r,options:n}=this.props,{keyboardCodes:i=lp,coordinateGetter:a=CS,scrollBehavior:o="smooth"}=n,{code:u}=e;if(i.end.includes(u)){this.handleEnd(e);return}if(i.cancel.includes(u)){this.handleCancel(e);return}const{collisionRect:l}=r.current,c=l?{x:l.left,y:l.top}:dr;this.referenceCoordinates||(this.referenceCoordinates=c);const d=a(e,{active:t,context:r.current,currentCoordinates:c});if(d){const f=ma(d,c),p={x:0,y:0},{scrollableAncestors:E}=r.current;for(const m of E){const S=e.code,{isTop:v,isRight:A,isLeft:w,isBottom:I,maxScroll:O,minScroll:_}=op(m),x=RS(m),L={x:Math.min(S===Ee.Right?x.right-x.width/2:x.right,Math.max(S===Ee.Right?x.left:x.left+x.width/2,d.x)),y:Math.min(S===Ee.Down?x.bottom-x.height/2:x.bottom,Math.max(S===Ee.Down?x.top:x.top+x.height/2,d.y))},G=S===Ee.Right&&!A||S===Ee.Left&&!w,H=S===Ee.Down&&!I||S===Ee.Up&&!v;if(G&&L.x!==d.x){const P=m.scrollLeft+f.x,le=S===Ee.Right&&P<=O.x||S===Ee.Left&&P>=_.x;if(le&&!f.y){m.scrollTo({left:P,behavior:o});return}le?p.x=m.scrollLeft-P:p.x=S===Ee.Right?m.scrollLeft-O.x:m.scrollLeft-_.x,p.x&&m.scrollBy({left:-p.x,behavior:o});break}else if(H&&L.y!==d.y){const P=m.scrollTop+f.y,le=S===Ee.Down&&P<=O.y||S===Ee.Up&&P>=_.y;if(le&&!f.x){m.scrollTo({top:P,behavior:o});return}le?p.y=m.scrollTop-P:p.y=S===Ee.Down?m.scrollTop-O.y:m.scrollTop-_.y,p.y&&m.scrollBy({top:-p.y,behavior:o});break}}this.handleMove(e,Qn(ma(d,this.referenceCoordinates),p))}}}handleMove(e,t){const{onMove:r}=this.props;e.preventDefault(),r(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}cp.activators=[{eventName:"onKeyDown",handler:(s,e,t)=>{let{keyboardCodes:r=lp,onActivation:n}=e,{active:i}=t;const{code:a}=s.nativeEvent;if(r.start.includes(a)){const o=i.activatorNode.current;return o&&s.target!==o?!1:(s.preventDefault(),n?.({event:s.nativeEvent}),!0)}return!1}}];function Ac(s){return!!(s&&"distance"in s)}function Cc(s){return!!(s&&"delay"in s)}class Pu{constructor(e,t,r){var n;r===void 0&&(r=SS(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:a}=i;this.props=e,this.events=t,this.document=as(a),this.documentListeners=new Ds(this.document),this.listeners=new Ds(r),this.windowListeners=new Ds(xt(a)),this.initialCoordinates=(n=Wo(i))!=null?n:dr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:r}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Qt.Resize,this.handleCancel),this.windowListeners.add(Qt.DragStart,Sc),this.windowListeners.add(Qt.VisibilityChange,this.handleCancel),this.windowListeners.add(Qt.ContextMenu,Sc),this.documentListeners.add(Qt.Keydown,this.handleKeydown),t){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Cc(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(Ac(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:r,onPending:n}=this.props;n(r,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Qt.Click,AS,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Qt.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:r,initialCoordinates:n,props:i}=this,{onMove:a,options:{activationConstraint:o}}=i;if(!n)return;const u=(t=Wo(e))!=null?t:dr,l=ma(n,u);if(!r&&o){if(Ac(o)){if(o.tolerance!=null&&ao(l,o.tolerance))return this.handleCancel();if(ao(l,o.distance))return this.handleStart()}if(Cc(o)&&ao(l,o.tolerance))return this.handleCancel();this.handlePending(o,l);return}e.cancelable&&e.preventDefault(),a(u)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===Ee.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const wS={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Du extends Pu{constructor(e){const{event:t}=e,r=as(t.target);super(e,wS,r)}}Du.activators=[{eventName:"onPointerDown",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:r}=e;return!t.isPrimary||t.button!==0?!1:(r?.({event:t}),!0)}}];const IS={move:{name:"mousemove"},end:{name:"mouseup"}};var jo;(function(s){s[s.RightClick=2]="RightClick"})(jo||(jo={}));class MS extends Pu{constructor(e){super(e,IS,as(e.event.target))}}MS.activators=[{eventName:"onMouseDown",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:r}=e;return t.button===jo.RightClick?!1:(r?.({event:t}),!0)}}];const oo={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class OS extends Pu{constructor(e){super(e,oo)}static setup(){return window.addEventListener(oo.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(oo.move.name,e)};function e(){}}}OS.activators=[{eventName:"onTouchStart",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:r}=e;const{touches:n}=t;return n.length>1?!1:(r?.({event:t}),!0)}}];var Vs;(function(s){s[s.Pointer=0]="Pointer",s[s.DraggableRect=1]="DraggableRect"})(Vs||(Vs={}));var Ea;(function(s){s[s.TreeOrder=0]="TreeOrder",s[s.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ea||(Ea={}));function bS(s){let{acceleration:e,activator:t=Vs.Pointer,canScroll:r,draggingRect:n,enabled:i,interval:a=5,order:o=Ea.TreeOrder,pointerCoordinates:u,scrollableAncestors:l,scrollableAncestorRects:c,delta:d,threshold:f}=s;const p=_S({delta:d,disabled:!i}),[E,m]=Bv(),S=C.useRef({x:0,y:0}),v=C.useRef({x:0,y:0}),A=C.useMemo(()=>{switch(t){case Vs.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case Vs.DraggableRect:return n}},[t,n,u]),w=C.useRef(null),I=C.useCallback(()=>{const _=w.current;if(!_)return;const x=S.current.x*v.current.x,L=S.current.y*v.current.y;_.scrollBy(x,L)},[]),O=C.useMemo(()=>o===Ea.TreeOrder?[...l].reverse():l,[o,l]);C.useEffect(()=>{if(!i||!l.length||!A){m();return}for(const _ of O){if(r?.(_)===!1)continue;const x=l.indexOf(_),L=c[x];if(!L)continue;const{direction:G,speed:H}=ES(_,L,A,e,f);for(const P of["x","y"])p[P][G[P]]||(H[P]=0,G[P]=0);if(H.x>0||H.y>0){m(),w.current=_,E(I,a),S.current=H,v.current=G;return}}S.current={x:0,y:0},v.current={x:0,y:0},m()},[e,I,r,m,i,a,JSON.stringify(A),JSON.stringify(p),E,l,O,c,JSON.stringify(f)])}const xS={x:{[tt.Backward]:!1,[tt.Forward]:!1},y:{[tt.Backward]:!1,[tt.Forward]:!1}};function _S(s){let{delta:e,disabled:t}=s;const r=Ho(e);return ii(n=>{if(t||!r||!n)return xS;const i={x:Math.sign(e.x-r.x),y:Math.sign(e.y-r.y)};return{x:{[tt.Backward]:n.x[tt.Backward]||i.x===-1,[tt.Forward]:n.x[tt.Forward]||i.x===1},y:{[tt.Backward]:n.y[tt.Backward]||i.y===-1,[tt.Forward]:n.y[tt.Forward]||i.y===1}}},[t,e,r])}function LS(s,e){const t=e!=null?s.get(e):void 0,r=t?t.node.current:null;return ii(n=>{var i;return e==null?null:(i=r??n)!=null?i:null},[r,e])}function FS(s,e){return C.useMemo(()=>s.reduce((t,r)=>{const{sensor:n}=r,i=n.activators.map(a=>({eventName:a.eventName,handler:e(a.handler,r)}));return[...t,...i]},[]),[s,e])}var Qs;(function(s){s[s.Always=0]="Always",s[s.BeforeDragging=1]="BeforeDragging",s[s.WhileDragging=2]="WhileDragging"})(Qs||(Qs={}));var Yo;(function(s){s.Optimized="optimized"})(Yo||(Yo={}));const wc=new Map;function US(s,e){let{dragging:t,dependencies:r,config:n}=e;const[i,a]=C.useState(null),{frequency:o,measure:u,strategy:l}=n,c=C.useRef(s),d=S(),f=qs(d),p=C.useCallback(function(v){v===void 0&&(v=[]),!f.current&&a(A=>A===null?v:A.concat(v.filter(w=>!A.includes(w))))},[f]),E=C.useRef(null),m=ii(v=>{if(d&&!t)return wc;if(!v||v===wc||c.current!==s||i!=null){const A=new Map;for(let w of s){if(!w)continue;if(i&&i.length>0&&!i.includes(w.id)&&w.rect.current){A.set(w.id,w.rect.current);continue}const I=w.node.current,O=I?new Uu(u(I),I):null;w.rect.current=O,O&&A.set(w.id,O)}return A}return v},[s,i,t,d,u]);return C.useEffect(()=>{c.current=s},[s]),C.useEffect(()=>{d||p()},[t,d]),C.useEffect(()=>{i&&i.length>0&&a(null)},[JSON.stringify(i)]),C.useEffect(()=>{d||typeof o!="number"||E.current!==null||(E.current=setTimeout(()=>{p(),E.current=null},o))},[o,d,p,...r]),{droppableRects:m,measureDroppableContainers:p,measuringScheduled:i!=null};function S(){switch(l){case Qs.Always:return!1;case Qs.BeforeDragging:return t;default:return!t}}}function hp(s,e){return ii(t=>s?t||(typeof e=="function"?e(s):s):null,[e,s])}function PS(s,e){return hp(s,e)}function DS(s){let{callback:e,disabled:t}=s;const r=_u(e),n=C.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(r)},[r,t]);return C.useEffect(()=>()=>n?.disconnect(),[n]),n}function Fa(s){let{callback:e,disabled:t}=s;const r=_u(e),n=C.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(r)},[t]);return C.useEffect(()=>()=>n?.disconnect(),[n]),n}function VS(s){return new Uu(os(s),s)}function Ic(s,e,t){e===void 0&&(e=VS);const[r,n]=C.useState(null);function i(){n(u=>{if(!s)return null;if(s.isConnected===!1){var l;return(l=u??t)!=null?l:null}const c=e(s);return JSON.stringify(u)===JSON.stringify(c)?u:c})}const a=DS({callback(u){if(s)for(const l of u){const{type:c,target:d}=l;if(c==="childList"&&d instanceof HTMLElement&&d.contains(s)){i();break}}}}),o=Fa({callback:i});return Mr(()=>{i(),s?(o?.observe(s),a?.observe(document.body,{childList:!0,subtree:!0})):(o?.disconnect(),a?.disconnect())},[s]),r}function BS(s){const e=hp(s);return rp(s,e)}const Mc=[];function kS(s){const e=C.useRef(s),t=ii(r=>s?r&&r!==Mc&&s&&e.current&&s.parentNode===e.current.parentNode?r:Fu(s):Mc,[s]);return C.useEffect(()=>{e.current=s},[s]),t}function GS(s){const[e,t]=C.useState(null),r=C.useRef(s),n=C.useCallback(i=>{const a=io(i.target);a&&t(o=>o?(o.set(a,zo(a)),new Map(o)):null)},[]);return C.useEffect(()=>{const i=r.current;if(s!==i){a(i);const o=s.map(u=>{const l=io(u);return l?(l.addEventListener("scroll",n,{passive:!0}),[l,zo(l)]):null}).filter(u=>u!=null);t(o.length?new Map(o):null),r.current=s}return()=>{a(s),a(i)};function a(o){o.forEach(u=>{const l=io(u);l?.removeEventListener("scroll",n)})}},[n,s]),C.useMemo(()=>s.length?e?Array.from(e.values()).reduce((i,a)=>Qn(i,a),dr):up(s):dr,[s,e])}function Oc(s,e){e===void 0&&(e=[]);const t=C.useRef(null);return C.useEffect(()=>{t.current=null},e),C.useEffect(()=>{const r=s!==dr;r&&!t.current&&(t.current=s),!r&&t.current&&(t.current=null)},[s]),t.current?ma(s,t.current):dr}function HS(s){C.useEffect(()=>{if(!La)return;const e=s.map(t=>{let{sensor:r}=t;return r.setup==null?void 0:r.setup()});return()=>{for(const t of e)t?.()}},s.map(e=>{let{sensor:t}=e;return t}))}function WS(s,e){return C.useMemo(()=>s.reduce((t,r)=>{let{eventName:n,handler:i}=r;return t[n]=a=>{i(a,e)},t},{}),[s,e])}function dp(s){return C.useMemo(()=>s?fS(s):null,[s])}const bc=[];function zS(s,e){e===void 0&&(e=os);const[t]=s,r=dp(t?xt(t):null),[n,i]=C.useState(bc);function a(){i(()=>s.length?s.map(u=>ap(u)?r:new Uu(e(u),u)):bc)}const o=Fa({callback:a});return Mr(()=>{o?.disconnect(),a(),s.forEach(u=>o?.observe(u))},[s]),n}function jS(s){if(!s)return null;if(s.children.length>1)return s;const e=s.children[0];return si(e)?e:s}function YS(s){let{measure:e}=s;const[t,r]=C.useState(null),n=C.useCallback(l=>{for(const{target:c}of l)if(si(c)){r(d=>{const f=e(c);return d?{...d,width:f.width,height:f.height}:f});break}},[e]),i=Fa({callback:n}),a=C.useCallback(l=>{const c=jS(l);i?.disconnect(),c&&i?.observe(c),r(c?e(c):null)},[e,i]),[o,u]=pa(a);return C.useMemo(()=>({nodeRef:o,rect:t,setRef:u}),[t,o,u])}const $S=[{sensor:Du,options:{}},{sensor:cp,options:{}}],XS={current:{}},Gi={draggable:{measure:vc},droppable:{measure:vc,strategy:Qs.WhileDragging,frequency:Yo.Optimized},dragOverlay:{measure:os}};class Bs extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,r;return(t=(r=this.get(e))==null?void 0:r.node.current)!=null?t:void 0}}const KS={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Bs,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:ga},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Gi,measureDroppableContainers:ga,windowRect:null,measuringScheduled:!1},qS={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:ga,draggableNodes:new Map,over:null,measureDroppableContainers:ga},Ua=C.createContext(qS),fp=C.createContext(KS);function QS(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Bs}}}function ZS(s,e){switch(e.type){case qe.DragStart:return{...s,draggable:{...s.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case qe.DragMove:return s.draggable.active==null?s:{...s,draggable:{...s.draggable,translate:{x:e.coordinates.x-s.draggable.initialCoordinates.x,y:e.coordinates.y-s.draggable.initialCoordinates.y}}};case qe.DragEnd:case qe.DragCancel:return{...s,draggable:{...s.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case qe.RegisterDroppable:{const{element:t}=e,{id:r}=t,n=new Bs(s.droppable.containers);return n.set(r,t),{...s,droppable:{...s.droppable,containers:n}}}case qe.SetDroppableDisabled:{const{id:t,key:r,disabled:n}=e,i=s.droppable.containers.get(t);if(!i||r!==i.key)return s;const a=new Bs(s.droppable.containers);return a.set(t,{...i,disabled:n}),{...s,droppable:{...s.droppable,containers:a}}}case qe.UnregisterDroppable:{const{id:t,key:r}=e,n=s.droppable.containers.get(t);if(!n||r!==n.key)return s;const i=new Bs(s.droppable.containers);return i.delete(t),{...s,droppable:{...s.droppable,containers:i}}}default:return s}}function JS(s){let{disabled:e}=s;const{active:t,activatorEvent:r,draggableNodes:n}=C.useContext(Ua),i=Ho(r),a=Ho(t?.id);return C.useEffect(()=>{if(!e&&!r&&i&&a!=null){if(!Lu(i)||document.activeElement===i.target)return;const o=n.get(a);if(!o)return;const{activatorNode:u,node:l}=o;if(!u.current&&!l.current)return;requestAnimationFrame(()=>{for(const c of[u.current,l.current]){if(!c)continue;const d=Hv(c);if(d){d.focus();break}}})}},[r,e,n,a,i]),null}function eA(s,e){let{transform:t,...r}=e;return s!=null&&s.length?s.reduce((n,i)=>i({transform:n,...r}),t):t}function tA(s){return C.useMemo(()=>({draggable:{...Gi.draggable,...s?.draggable},droppable:{...Gi.droppable,...s?.droppable},dragOverlay:{...Gi.dragOverlay,...s?.dragOverlay}}),[s?.draggable,s?.droppable,s?.dragOverlay])}function rA(s){let{activeNode:e,measure:t,initialRect:r,config:n=!0}=s;const i=C.useRef(!1),{x:a,y:o}=typeof n=="boolean"?{x:n,y:n}:n;Mr(()=>{if(!a&&!o||!e){i.current=!1;return}if(i.current||!r)return;const l=e?.node.current;if(!l||l.isConnected===!1)return;const c=t(l),d=rp(c,r);if(a||(d.x=0),o||(d.y=0),i.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const f=np(l);f&&f.scrollBy({top:d.y,left:d.x})}},[e,a,o,r,t])}const pp=C.createContext({...dr,scaleX:1,scaleY:1});var Qr;(function(s){s[s.Uninitialized=0]="Uninitialized",s[s.Initializing=1]="Initializing",s[s.Initialized=2]="Initialized"})(Qr||(Qr={}));const nA=C.memo(function(e){var t,r,n,i;let{id:a,accessibility:o,autoScroll:u=!0,children:l,sensors:c=$S,collisionDetection:d=aS,measuring:f,modifiers:p,...E}=e;const m=C.useReducer(ZS,void 0,QS),[S,v]=m,[A,w]=Xv(),[I,O]=C.useState(Qr.Uninitialized),_=I===Qr.Initialized,{draggable:{active:x,nodes:L,translate:G},droppable:{containers:H}}=S,P=x!=null?L.get(x):null,le=C.useRef({initial:null,translated:null}),se=C.useMemo(()=>{var ft;return x!=null?{id:x,data:(ft=P?.data)!=null?ft:XS,rect:le}:null},[x,P]),ie=C.useRef(null),[ce,q]=C.useState(null),[fe,ye]=C.useState(null),Se=qs(E,Object.values(E)),Ae=ai("DndDescribedBy",a),Ue=C.useMemo(()=>H.getEnabled(),[H]),ae=tA(f),{droppableRects:Ne,measureDroppableContainers:pe,measuringScheduled:V}=US(Ue,{dragging:_,dependencies:[G.x,G.y],config:ae.droppable}),b=LS(L,x),z=C.useMemo(()=>fe?Wo(fe):null,[fe]),j=Mp(),me=PS(b,ae.draggable.measure);rA({activeNode:x!=null?L.get(x):null,config:j.layoutShiftCompensation,initialRect:me,measure:ae.draggable.measure});const X=Ic(b,ae.draggable.measure,me),Oe=Ic(b?b.parentElement:null),ke=C.useRef({activatorEvent:null,active:null,activeNode:b,collisionRect:null,collisions:null,droppableRects:Ne,draggableNodes:L,draggingNode:null,draggingNodeRect:null,droppableContainers:H,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),at=H.getNodeFor((t=ke.current.over)==null?void 0:t.id),Ge=YS({measure:ae.dragOverlay.measure}),_e=(r=Ge.nodeRef.current)!=null?r:b,Tt=_?(n=Ge.rect)!=null?n:X:null,_t=!!(Ge.nodeRef.current&&Ge.rect),Et=BS(_t?null:X),zt=dp(_e?xt(_e):null),Te=kS(_?at??b:null),He=zS(Te),ee=eA(p,{transform:{x:G.x-Et.x,y:G.y-Et.y,scaleX:1,scaleY:1},activatorEvent:fe,active:se,activeNodeRect:X,containerNodeRect:Oe,draggingNodeRect:Tt,over:ke.current.over,overlayNodeRect:Ge.rect,scrollableAncestors:Te,scrollableAncestorRects:He,windowRect:zt}),Me=z?Qn(z,G):null,ot=GS(Te),Wr=Oc(ot),jt=Oc(ot,[X]),Ze=Qn(ee,Wr),On=Tt?lS(Tt,ee):null,us=se&&On?d({active:se,collisionRect:On,droppableRects:Ne,droppableContainers:Ue,pointerCoordinates:Me}):null,ku=nS(us,"id"),[zr,Gu]=C.useState(null),Sp=_t?ee:Qn(ee,jt),Ap=oS(Sp,(i=zr?.rect)!=null?i:null,X),Pa=C.useRef(null),Hu=C.useCallback((ft,Lt)=>{let{sensor:Ft,options:jr}=Lt;if(ie.current==null)return;const Yt=L.get(ie.current);if(!Yt)return;const Ut=ft.nativeEvent,mr=new Ft({active:ie.current,activeNode:Yt,event:Ut,options:jr,context:ke,onAbort(ut){if(!L.get(ut))return;const{onDragAbort:gr}=Se.current,xr={id:ut};gr?.(xr),A({type:"onDragAbort",event:xr})},onPending(ut,Yr,gr,xr){if(!L.get(ut))return;const{onDragPending:cs}=Se.current,$r={id:ut,constraint:Yr,initialCoordinates:gr,offset:xr};cs?.($r),A({type:"onDragPending",event:$r})},onStart(ut){const Yr=ie.current;if(Yr==null)return;const gr=L.get(Yr);if(!gr)return;const{onDragStart:xr}=Se.current,ls={activatorEvent:Ut,active:{id:Yr,data:gr.data,rect:le}};Ns.unstable_batchedUpdates(()=>{xr?.(ls),O(Qr.Initializing),v({type:qe.DragStart,initialCoordinates:ut,active:Yr}),A({type:"onDragStart",event:ls}),q(Pa.current),ye(Ut)})},onMove(ut){v({type:qe.DragMove,coordinates:ut})},onEnd:bn(qe.DragEnd),onCancel:bn(qe.DragCancel)});Pa.current=mr;function bn(ut){return async function(){const{active:gr,collisions:xr,over:ls,scrollAdjustedTranslate:cs}=ke.current;let $r=null;if(gr&&cs){const{cancelDrop:hs}=Se.current;$r={activatorEvent:Ut,active:gr,collisions:xr,delta:cs,over:ls},ut===qe.DragEnd&&typeof hs=="function"&&await Promise.resolve(hs($r))&&(ut=qe.DragCancel)}ie.current=null,Ns.unstable_batchedUpdates(()=>{v({type:ut}),O(Qr.Uninitialized),Gu(null),q(null),ye(null),Pa.current=null;const hs=ut===qe.DragEnd?"onDragEnd":"onDragCancel";if($r){const Da=Se.current[hs];Da?.($r),A({type:hs,event:$r})}})}}},[L]),Cp=C.useCallback((ft,Lt)=>(Ft,jr)=>{const Yt=Ft.nativeEvent,Ut=L.get(jr);if(ie.current!==null||!Ut||Yt.dndKit||Yt.defaultPrevented)return;const mr={active:Ut};ft(Ft,Lt.options,mr)===!0&&(Yt.dndKit={capturedBy:Lt.sensor},ie.current=jr,Hu(Ft,Lt))},[L,Hu]),Wu=FS(c,Cp);HS(c),Mr(()=>{X&&I===Qr.Initializing&&O(Qr.Initialized)},[X,I]),C.useEffect(()=>{const{onDragMove:ft}=Se.current,{active:Lt,activatorEvent:Ft,collisions:jr,over:Yt}=ke.current;if(!Lt||!Ft)return;const Ut={active:Lt,activatorEvent:Ft,collisions:jr,delta:{x:Ze.x,y:Ze.y},over:Yt};Ns.unstable_batchedUpdates(()=>{ft?.(Ut),A({type:"onDragMove",event:Ut})})},[Ze.x,Ze.y]),C.useEffect(()=>{const{active:ft,activatorEvent:Lt,collisions:Ft,droppableContainers:jr,scrollAdjustedTranslate:Yt}=ke.current;if(!ft||ie.current==null||!Lt||!Yt)return;const{onDragOver:Ut}=Se.current,mr=jr.get(ku),bn=mr&&mr.rect.current?{id:mr.id,rect:mr.rect.current,data:mr.data,disabled:mr.disabled}:null,ut={active:ft,activatorEvent:Lt,collisions:Ft,delta:{x:Yt.x,y:Yt.y},over:bn};Ns.unstable_batchedUpdates(()=>{Gu(bn),Ut?.(ut),A({type:"onDragOver",event:ut})})},[ku]),Mr(()=>{ke.current={activatorEvent:fe,active:se,activeNode:b,collisionRect:On,collisions:us,droppableRects:Ne,draggableNodes:L,draggingNode:_e,draggingNodeRect:Tt,droppableContainers:H,over:zr,scrollableAncestors:Te,scrollAdjustedTranslate:Ze},le.current={initial:Tt,translated:On}},[se,b,us,On,L,_e,Tt,Ne,H,zr,Te,Ze]),bS({...j,delta:G,draggingRect:On,pointerCoordinates:Me,scrollableAncestors:Te,scrollableAncestorRects:He});const wp=C.useMemo(()=>({active:se,activeNode:b,activeNodeRect:X,activatorEvent:fe,collisions:us,containerNodeRect:Oe,dragOverlay:Ge,draggableNodes:L,droppableContainers:H,droppableRects:Ne,over:zr,measureDroppableContainers:pe,scrollableAncestors:Te,scrollableAncestorRects:He,measuringConfiguration:ae,measuringScheduled:V,windowRect:zt}),[se,b,X,fe,us,Oe,Ge,L,H,Ne,zr,pe,Te,He,ae,V,zt]),Ip=C.useMemo(()=>({activatorEvent:fe,activators:Wu,active:se,activeNodeRect:X,ariaDescribedById:{draggable:Ae},dispatch:v,draggableNodes:L,over:zr,measureDroppableContainers:pe}),[fe,Wu,se,X,v,Ae,L,zr,pe]);return yt.createElement(tp.Provider,{value:w},yt.createElement(Ua.Provider,{value:Ip},yt.createElement(fp.Provider,{value:wp},yt.createElement(pp.Provider,{value:Ap},l)),yt.createElement(JS,{disabled:o?.restoreFocus===!1})),yt.createElement(Qv,{...o,hiddenTextDescribedById:Ae}));function Mp(){const ft=ce?.autoScrollEnabled===!1,Lt=typeof u=="object"?u.enabled===!1:u===!1,Ft=_&&!ft&&!Lt;return typeof u=="object"?{...u,enabled:Ft}:{enabled:Ft}}}),sA=C.createContext(null),xc="button",iA="Draggable";function aA(s){let{id:e,data:t,disabled:r=!1,attributes:n}=s;const i=ai(iA),{activators:a,activatorEvent:o,active:u,activeNodeRect:l,ariaDescribedById:c,draggableNodes:d,over:f}=C.useContext(Ua),{role:p=xc,roleDescription:E="draggable",tabIndex:m=0}=n??{},S=u?.id===e,v=C.useContext(S?pp:sA),[A,w]=pa(),[I,O]=pa(),_=WS(a,e),x=qs(t);Mr(()=>(d.set(e,{id:e,key:i,node:A,activatorNode:I,data:x}),()=>{const G=d.get(e);G&&G.key===i&&d.delete(e)}),[d,e]);const L=C.useMemo(()=>({role:p,tabIndex:m,"aria-disabled":r,"aria-pressed":S&&p===xc?!0:void 0,"aria-roledescription":E,"aria-describedby":c.draggable}),[r,p,m,S,E,c.draggable]);return{active:u,activatorEvent:o,activeNodeRect:l,attributes:L,isDragging:S,listeners:r?void 0:_,node:A,over:f,setNodeRef:w,setActivatorNodeRef:O,transform:v}}function oA(){return C.useContext(fp)}const uA="Droppable",lA={timeout:25};function cA(s){let{data:e,disabled:t=!1,id:r,resizeObserverConfig:n}=s;const i=ai(uA),{active:a,dispatch:o,over:u,measureDroppableContainers:l}=C.useContext(Ua),c=C.useRef({disabled:t}),d=C.useRef(!1),f=C.useRef(null),p=C.useRef(null),{disabled:E,updateMeasurementsFor:m,timeout:S}={...lA,...n},v=qs(m??r),A=C.useCallback(()=>{if(!d.current){d.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{l(Array.isArray(v.current)?v.current:[v.current]),p.current=null},S)},[S]),w=Fa({callback:A,disabled:E||!a}),I=C.useCallback((L,G)=>{w&&(G&&(w.unobserve(G),d.current=!1),L&&w.observe(L))},[w]),[O,_]=pa(I),x=qs(e);return C.useEffect(()=>{!w||!O.current||(w.disconnect(),d.current=!1,w.observe(O.current))},[O,w]),C.useEffect(()=>(o({type:qe.RegisterDroppable,element:{id:r,key:i,disabled:t,node:O,rect:f,data:x}}),()=>o({type:qe.UnregisterDroppable,key:i,id:r})),[r]),C.useEffect(()=>{t!==c.current.disabled&&(o({type:qe.SetDroppableDisabled,id:r,key:i,disabled:t}),c.current.disabled=t)},[r,i,t,o]),{active:a,rect:f,isOver:u?.id===r,node:O,over:u,setNodeRef:_}}function Vu(s,e,t){const r=s.slice();return r.splice(t<0?r.length+t:t,0,r.splice(e,1)[0]),r}function hA(s,e){return s.reduce((t,r,n)=>{const i=e.get(r);return i&&(t[n]=i),t},Array(s.length))}function Ci(s){return s!==null&&s>=0}function dA(s,e){if(s===e)return!0;if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0}function fA(s){return typeof s=="boolean"?{draggable:s,droppable:s}:s}const wi={scaleX:1,scaleY:1},ZA=s=>{var e;let{rects:t,activeNodeRect:r,activeIndex:n,overIndex:i,index:a}=s;const o=(e=t[n])!=null?e:r;if(!o)return null;const u=pA(t,a,n);if(a===n){const l=t[i];return l?{x:n<i?l.left+l.width-(o.left+o.width):l.left-o.left,y:0,...wi}:null}return a>n&&a<=i?{x:-o.width-u,y:0,...wi}:a<n&&a>=i?{x:o.width+u,y:0,...wi}:{x:0,y:0,...wi}};function pA(s,e,t){const r=s[e],n=s[e-1],i=s[e+1];return!r||!n&&!i?0:t<e?n?r.left-(n.left+n.width):i.left-(r.left+r.width):i?i.left-(r.left+r.width):r.left-(n.left+n.width)}const mp=s=>{let{rects:e,activeIndex:t,overIndex:r,index:n}=s;const i=Vu(e,r,t),a=e[n],o=i[n];return!o||!a?null:{x:o.left-a.left,y:o.top-a.top,scaleX:o.width/a.width,scaleY:o.height/a.height}},Ii={scaleX:1,scaleY:1},mA=s=>{var e;let{activeIndex:t,activeNodeRect:r,index:n,rects:i,overIndex:a}=s;const o=(e=i[t])!=null?e:r;if(!o)return null;if(n===t){const l=i[a];return l?{x:0,y:t<a?l.top+l.height-(o.top+o.height):l.top-o.top,...Ii}:null}const u=gA(i,n,t);return n>t&&n<=a?{x:0,y:-o.height-u,...Ii}:n<t&&n>=a?{x:0,y:o.height+u,...Ii}:{x:0,y:0,...Ii}};function gA(s,e,t){const r=s[e],n=s[e-1],i=s[e+1];return r?t<e?n?r.top-(n.top+n.height):i?i.top-(r.top+r.height):0:i?i.top-(r.top+r.height):n?r.top-(n.top+n.height):0:0}const gp="Sortable",Ep=yt.createContext({activeIndex:-1,containerId:gp,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:mp,disabled:{draggable:!1,droppable:!1}});function EA(s){let{children:e,id:t,items:r,strategy:n=mp,disabled:i=!1}=s;const{active:a,dragOverlay:o,droppableRects:u,over:l,measureDroppableContainers:c}=oA(),d=ai(gp,t),f=o.rect!==null,p=C.useMemo(()=>r.map(_=>typeof _=="object"&&"id"in _?_.id:_),[r]),E=a!=null,m=a?p.indexOf(a.id):-1,S=l?p.indexOf(l.id):-1,v=C.useRef(p),A=!dA(p,v.current),w=S!==-1&&m===-1||A,I=fA(i);Mr(()=>{A&&E&&c(p)},[A,p,E,c]),C.useEffect(()=>{v.current=p},[p]);const O=C.useMemo(()=>({activeIndex:m,containerId:d,disabled:I,disableTransforms:w,items:p,overIndex:S,useDragOverlay:f,sortedRects:hA(p,u),strategy:n}),[m,d,I.draggable,I.droppable,w,p,S,u,f,n]);return yt.createElement(Ep.Provider,{value:O},e)}const RA=s=>{let{id:e,items:t,activeIndex:r,overIndex:n}=s;return Vu(t,r,n).indexOf(e)},yA=s=>{let{containerId:e,isSorting:t,wasDragging:r,index:n,items:i,newIndex:a,previousItems:o,previousContainerId:u,transition:l}=s;return!l||!r||o!==i&&n===a?!1:t?!0:a!==n&&e===u},NA={duration:200,easing:"ease"},Rp="transform",TA=rs.Transition.toString({property:Rp,duration:0,easing:"linear"}),vA={roleDescription:"sortable"};function SA(s){let{disabled:e,index:t,node:r,rect:n}=s;const[i,a]=C.useState(null),o=C.useRef(t);return Mr(()=>{if(!e&&t!==o.current&&r.current){const u=n.current;if(u){const l=os(r.current,{ignoreTransform:!0}),c={x:u.left-l.left,y:u.top-l.top,scaleX:u.width/l.width,scaleY:u.height/l.height};(c.x||c.y)&&a(c)}}t!==o.current&&(o.current=t)},[e,t,r,n]),C.useEffect(()=>{i&&a(null)},[i]),i}function AA(s){let{animateLayoutChanges:e=yA,attributes:t,disabled:r,data:n,getNewIndex:i=RA,id:a,strategy:o,resizeObserverConfig:u,transition:l=NA}=s;const{items:c,containerId:d,activeIndex:f,disabled:p,disableTransforms:E,sortedRects:m,overIndex:S,useDragOverlay:v,strategy:A}=C.useContext(Ep),w=CA(r,p),I=c.indexOf(a),O=C.useMemo(()=>({sortable:{containerId:d,index:I,items:c},...n}),[d,n,I,c]),_=C.useMemo(()=>c.slice(c.indexOf(a)),[c,a]),{rect:x,node:L,isOver:G,setNodeRef:H}=cA({id:a,data:O,disabled:w.droppable,resizeObserverConfig:{updateMeasurementsFor:_,...u}}),{active:P,activatorEvent:le,activeNodeRect:se,attributes:ie,setNodeRef:ce,listeners:q,isDragging:fe,over:ye,setActivatorNodeRef:Se,transform:Ae}=aA({id:a,data:O,attributes:{...vA,...t},disabled:w.draggable}),Ue=Vv(H,ce),ae=!!P,Ne=ae&&!E&&Ci(f)&&Ci(S),pe=!v&&fe,V=pe&&Ne?Ae:null,z=Ne?V??(o??A)({rects:m,activeNodeRect:se,activeIndex:f,overIndex:S,index:I}):null,j=Ci(f)&&Ci(S)?i({id:a,items:c,activeIndex:f,overIndex:S}):I,me=P?.id,X=C.useRef({activeId:me,items:c,newIndex:j,containerId:d}),Oe=c!==X.current.items,ke=e({active:P,containerId:d,isDragging:fe,isSorting:ae,id:a,index:I,items:c,newIndex:X.current.newIndex,previousItems:X.current.items,previousContainerId:X.current.containerId,transition:l,wasDragging:X.current.activeId!=null}),at=SA({disabled:!ke,index:I,node:L,rect:x});return C.useEffect(()=>{ae&&X.current.newIndex!==j&&(X.current.newIndex=j),d!==X.current.containerId&&(X.current.containerId=d),c!==X.current.items&&(X.current.items=c)},[ae,j,d,c]),C.useEffect(()=>{if(me===X.current.activeId)return;if(me!=null&&X.current.activeId==null){X.current.activeId=me;return}const _e=setTimeout(()=>{X.current.activeId=me},50);return()=>clearTimeout(_e)},[me]),{active:P,activeIndex:f,attributes:ie,data:O,rect:x,index:I,newIndex:j,items:c,isOver:G,isSorting:ae,isDragging:fe,listeners:q,node:L,overIndex:S,over:ye,setNodeRef:Ue,setActivatorNodeRef:Se,setDroppableNodeRef:H,setDraggableNodeRef:ce,transform:at??z,transition:Ge()};function Ge(){if(at||Oe&&X.current.newIndex===I)return TA;if(!(pe&&!Lu(le)||!l)&&(ae||ke))return rs.Transition.toString({...l,property:Rp})}}function CA(s,e){var t,r;return typeof s=="boolean"?{draggable:s,droppable:!1}:{draggable:(t=s?.draggable)!=null?t:e.draggable,droppable:(r=s?.droppable)!=null?r:e.droppable}}Ee.Down,Ee.Right,Ee.Up,Ee.Left;const yp=C.forwardRef(({size:s="md",color:e="default",name:t,placeholder:r,value:n,onChange:i,className:a="",allClassName:o="",min:u,max:l,step:c,disabled:d=!1,control:f,rules:p=null,defaultValue:E="",onKeyDownCapture:m,error:S,helperText:v,...A},w)=>{const O=f?._formState?.errors?.[t]?"error":e,_=P=>{i&&i(P)},x={sm:`h-9 px-3 py-2 ${Zt.textSm}`,md:`h-11 px-4 py-2.5 ${Zt.textSm}`,lg:"h-12 px-4 py-3 text-base"},L={default:"bg-transparent text-gray-800 border-gray-300 focus:border-brand-300 focus:ring-brand-500/20 dark:border-gray-700 dark:text-white/90 dark:focus:border-brand-800",success:"border-green-500 focus:border-green-300 focus:ring-green-500/20 dark:text-green-400 dark:border-green-500 dark:focus:border-green-800",error:"border-red-500 focus:border-red-300 focus:ring-red-500/20 dark:text-red-400 dark:border-red-500 dark:focus:border-red-800"},G="text-gray-500 border-gray-300 bg-gray-100 cursor-not-allowed opacity-60 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700",H=`w-full ${Zt.roundedLg} border appearance-none shadow-theme-xs placeholder:text-gray-400 focus:outline-none focus:ring-3 dark:bg-zinc-950 dark:placeholder:text-white/30`;return N.jsxs("div",{className:`relative ${o}`,children:[N.jsx("input",{type:"text",name:t,placeholder:r,ref:w,onChange:_,min:u,max:l,step:c,disabled:d,onKeyDownCapture:m,className:`
          ${H}
          ${x[s]}
          ${d?G:L[O]}
          ${a}
        `,...A}),v&&N.jsx("p",{className:`mt-1 ${Zt.textSm} text-red-600 dark:text-red-400`,children:v})]})});yp.displayName="TwInputRef";const Np=yt.forwardRef(({title:s,children:e,className:t="",desc:r="",icon:n=null,isDraggable:i=!1},a)=>{const o=C.useRef(null),[u,l]=C.useState({x:0,y:0,isInitialized:!1}),[c,d]=C.useState(!1),f=C.useRef({x:0,y:0});C.useEffect(()=>{if(i&&o.current&&!u.isInitialized){const v=o.current.getBoundingClientRect(),A=window.innerWidth/2-672/2<=0?0:window.innerWidth/2-672/2;l({x:A,y:window.innerHeight/2-v.height/2,isInitialized:!0})}},[i,u.isInitialized]);const p=v=>{if(!i||!o.current)return;d(!0);const A=o.current.getBoundingClientRect();f.current={x:v.clientX-A.left,y:v.clientY-A.top},v.preventDefault()},E=v=>{if(!c)return;const A=v.clientX-f.current.x<=0?0:v.clientX-f.current.x,w=v.clientY-f.current.y<=120?120:v.clientY-f.current.y;l({...u,x:A,y:w})},m=()=>{d(!1)};C.useEffect(()=>(c?(window.addEventListener("mousemove",E),window.addEventListener("mouseup",m)):(window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",m)),()=>{window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",m)}),[c]);const S=i?{position:"absolute",top:u.y,left:u.x,cursor:c?"grabbing":"default"}:{};return N.jsxs("div",{ref:v=>{o.current=v,a&&(a.current=v)},className:`MoveCard ${Zt.card} ${t}`,style:{...S},children:[N.jsxs("div",{className:`flex px-6 py-5 items-center ${i?"cursor-grab":""}`,onMouseDown:p,children:[n!==null?n:"",N.jsxs("div",{className:"flex-grow",children:[N.jsx("h3",{className:`${Zt.textBase} ${Zt.fontMedium} text-gray-800 dark:text-white/90`,children:s}),r&&N.jsx("p",{className:`mt-1 ${Zt.textSm} text-gray-500 dark:text-gray-400`,children:r})]})]}),N.jsx("div",{className:`border-t border-gray-100 dark:border-gray-800 
        p-4 sm:p-6 overflow-x-auto`,children:N.jsx("div",{className:"space-y-6 whitespace-normal",children:e})})]})});Np.displayName="MoveCard";const Tp=C.forwardRef(({name:s,options:e,rules:t,control:r,placeholder:n="Select Option",className:i="",allClassName:a="",...o},u)=>N.jsxs("div",{className:`relative ${a}`,children:[N.jsxs("select",{className:`h-11 w-full appearance-none ${Zt.roundedLg} border border-gray-300 
          bg-transparent px-4 py-2.5 pr-11 text-sm shadow-theme-xs placeholder:text-gray-400 
          focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 
          dark:border-gray-700 dark:bg-zinc-950 dark:text-white/90 dark:placeholder:text-white/30 
          dark:focus:border-brand-800 dark:bg-dark-900
          ${i}`,ref:u,...o,children:[N.jsx("option",{value:"",disabled:!0,className:"text-gray-700 dark:bg-zinc-950 dark:text-gray-400",children:n}),e.map(l=>N.jsx("option",{value:l.value,className:"text-gray-700 dark:bg-zinc-950 dark:text-gray-400",children:l.label},l.value))]}),N.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 h-11",children:N.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:N.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}));Tp.displayName="TwSelectRef";const wA=({isOpen:s,onClose:e,onCreate:t})=>{const r={visible:{opacity:1},hidden:{opacity:0}},n={hidden:{y:"-50px",opacity:0,scale:.95},visible:{y:"0",opacity:1,scale:1,transition:{duration:.2,ease:"easeOut"}},exit:{y:"50px",opacity:0,scale:.95,transition:{duration:.15,ease:"easeIn"}}},{t:i}=$o(),{control:a,handleSubmit:o}=Cg({defaultValues:{columns:[{title:"col_0",type:"text",width:100,data:"col_0"},{title:"col_1",type:"text",width:100,data:"col_1"},{title:"col_2",type:"text",width:100,data:"col_2"}]}}),{fields:u,append:l,remove:c}=wg({control:a,name:"columns"}),d=[{value:"text",label:i("column_type_text")},{value:"numeric",label:i("column_type_numeric")},{value:"date",label:i("column_type_date")},{value:"checkbox",label:i("column_type_checkbox")}],f=p=>{const E=p.columns.map((m,S)=>({...m,data:(m.title||"").toLowerCase().replace(/\s+/g,"_")||`col_${S}`}));t(E)};return N.jsx(qc,{children:s&&N.jsx(Zn.div,{className:"fixed inset-0 bg-black/70 bg-opacity-50 z-180 flex justify-center items-center",variants:r,initial:"hidden",animate:"visible",exit:"hidden",children:N.jsx(Zn.div,{variants:n,initial:"hidden",animate:"visible",exit:"exit",onClick:p=>p.stopPropagation(),children:N.jsx(Np,{isDraggable:!0,className:"w-full max-w-sm sm:max-w-xl max-h-[61vh] overflow-y-auto",title:i("handsontable_column_setup","Handsontable Column Setup"),children:N.jsxs("form",{onSubmit:o(f),children:[N.jsx("h3",{className:"text-md font-semibold mb-2",children:i("columns")}),N.jsx("div",{className:"space-y-3",children:u.map((p,E)=>N.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-5 gap-2 items-center p-2 ${Zt.border} rounded-md`,children:[N.jsx("div",{className:"sm:col-span-2",children:N.jsx(ju,{name:`columns.${E}.title`,control:a,defaultValue:p.title,render:({field:m})=>N.jsx(yp,{...m,placeholder:i("column_title")})})}),N.jsx("div",{className:"sm:col-span-2",children:N.jsx(ju,{name:`columns.${E}.type`,control:a,defaultValue:p.type,render:({field:m})=>N.jsx(Tp,{...m,options:d,className:"dark:bg-gray-700"})})}),N.jsx("div",{className:"flex items-center justify-end",children:N.jsx(oi,{type:"button",size:"sm",color:"warning",onClick:()=>c(E),disabled:u.length<=1,children:i("delete")})})]},p.id))}),N.jsxs("div",{className:"flex justify-between items-center mt-6",children:[N.jsx(oi,{type:"button",onClick:()=>l({title:"",type:"text",data:""}),children:i("add_column")}),N.jsxs("div",{className:"flex gap-2",children:[N.jsx(oi,{type:"button",variant:"outlined",onClick:e,children:i("cancel")}),N.jsx(oi,{type:"submit",children:i("create")})]})]})]})})})})})},IA=({id:s,children:e,onDragEnd:t})=>{const r=Jv(Zv(Du,{activationConstraint:{distance:8}}));return N.jsx(nA,{id:s,sensors:r,collisionDetection:sS,onDragEnd:t,children:e})};var fs={},ps={},_c;function MA(){if(_c)return ps;_c=1,Object.defineProperty(ps,"__esModule",{value:!0}),ps.PopoverPortal=void 0;var s=an(),e=Ig(),t=function(r){var n=r.container,i=r.element,a=r.scoutElement,o=r.children;return(0,s.useLayoutEffect)(function(){return n.appendChild(i),n.appendChild(a),function(){n.removeChild(i),n.removeChild(a)}},[n,i,a]),(0,e.createPortal)(o,i)};return ps.PopoverPortal=t,ps}var ms={},Lc;function Bu(){return Lc||(Lc=1,function(s){var e=ms&&ms.__assign||function(){return e=Object.assign||function(u){for(var l,c=1,d=arguments.length;c<d;c++){l=arguments[c];for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(u[f]=l[f])}return u},e.apply(this,arguments)};Object.defineProperty(s,"__esModule",{value:!0}),s.getNudgedPopoverRect=s.getNewPopoverRect=s.popoverRectForPosition=s.createContainer=s.rectsAreEqual=s.createRect=s.EMPTY_RECT=void 0,s.EMPTY_RECT={top:0,left:0,right:0,bottom:0,width:0,height:0};var t=function(u){var l=u.top,c=u.left,d=u.width,f=u.height;return{top:l,left:c,width:d,height:f,right:c+d,bottom:l+f}};s.createRect=t;var r=function(u,l){return u===l||u?.bottom===l?.bottom&&u?.height===l?.height&&u?.left===l?.left&&u?.right===l?.right&&u?.top===l?.top&&u?.width===l?.width};s.rectsAreEqual=r;var n=function(u){var l=u.containerStyle,c=u.containerClassName,d=window.document.createElement("div");return c&&(d.className=c),Object.assign(d.style,l),d};s.createContainer=n;var i=function(u,l,c,d,f){var p=l.left+l.width/2,E=l.top+l.height/2,m=c.width,S=c.height,v,A;switch(u){case"left":v=E-S/2,A=l.left-d-m,f==="start"&&(v=l.top),f==="end"&&(v=l.bottom-S);break;case"bottom":v=l.bottom+d,A=p-m/2,f==="start"&&(A=l.left),f==="end"&&(A=l.right-m);break;case"right":v=E-S/2,A=l.right+d,f==="start"&&(v=l.top),f==="end"&&(v=l.bottom-S);break;default:v=l.top-S-d,A=p-m/2,f==="start"&&(A=l.left),f==="end"&&(A=l.right-m);break}return(0,s.createRect)({left:A,top:v,width:m,height:S})};s.popoverRectForPosition=i;var a=function(u,l){var c=u.position,d=u.align,f=u.childRect,p=u.popoverRect,E=u.boundaryRect,m=u.padding,S=u.reposition,v=(0,s.popoverRectForPosition)(c,f,p,m,d),A=S&&(c==="top"&&v.top<E.top+l||c==="left"&&v.left<E.left+l||c==="right"&&v.right>E.right-l||c==="bottom"&&v.bottom>E.bottom-l);return{rect:v,boundaryViolation:A}};s.getNewPopoverRect=a;var o=function(u,l,c){var d=l.top+c,f=l.left+c,p=l.right-c,E=l.bottom-c,m=u.top<d?d:u.top;m=m+u.height>E?E-u.height:m;var S=u.left<f?f:u.left;return S=S+u.width>p?p-u.width:S,(0,s.createRect)(e(e({},u),{top:m,left:S}))};s.getNudgedPopoverRect=o}(ms)),ms}var gs={},Es={},Fc;function OA(){if(Fc)return Es;Fc=1,Object.defineProperty(Es,"__esModule",{value:!0}),Es.useElementRef=void 0;var s=an(),e=Bu(),t=function(r){var n=r.containerClassName,i=r.containerStyle,a=(0,s.useRef)(),o=(0,s.useState)(function(){return(0,e.createContainer)({containerStyle:i,containerClassName:n})})[0];return(0,s.useLayoutEffect)(function(){o.className=n},[n,o]),(0,s.useLayoutEffect)(function(){Object.assign(o.style,i)},[i,o]),a.current=o,a};return Es.useElementRef=t,Es}var Uc;function bA(){if(Uc)return gs;Uc=1,Object.defineProperty(gs,"__esModule",{value:!0}),gs.usePopover=void 0;var s=an(),e=Bu(),t=OA(),r={position:"fixed",overflow:"visible",top:"0px",left:"0px"},n={position:"fixed",top:"0px",left:"0px",width:"0px",height:"0px",visibility:"hidden"},i=function(a){var o=a.isOpen,u=a.childRef,l=a.positions,c=a.containerClassName,d=a.parentElement,f=a.transform,p=a.transformMode,E=a.align,m=a.padding,S=a.reposition,v=a.boundaryInset,A=a.boundaryElement,w=a.onPositionPopover,I=(0,t.useElementRef)({containerClassName:"react-tiny-popover-scout",containerStyle:n}),O=(0,t.useElementRef)({containerClassName:c!=null&&c.length>0&&c!=="react-tiny-popover-container"?"react-tiny-popover-container ".concat(c):"react-tiny-popover-container",containerStyle:r}),_=(0,s.useCallback)(function(x){var L,G,H=x===void 0?{}:x,P=H.positionIndex,le=P===void 0?0:P,se=H.parentRect,ie=se===void 0?d.getBoundingClientRect():se,ce=H.childRect,q=ce===void 0?(L=u?.current)===null||L===void 0?void 0:L.getBoundingClientRect():ce,fe=H.scoutRect,ye=fe===void 0?(G=I?.current)===null||G===void 0?void 0:G.getBoundingClientRect():fe,Se=H.popoverRect,Ae=Se===void 0?O.current.getBoundingClientRect():Se,Ue=H.boundaryRect,ae=Ue===void 0?A===d?ie:A.getBoundingClientRect():Ue;if(!(!q||!ie||!o)){if(f&&p==="absolute"){var Ne=typeof f=="function"?f({childRect:q,popoverRect:Ae,parentRect:ie,boundaryRect:ae,padding:m,align:E,nudgedTop:0,nudgedLeft:0,boundaryInset:v,violations:e.EMPTY_RECT,hasViolations:!1}):f,pe=Ne.top,V=Ne.left,b=Math.round(ie.left+V-ye.left),z=Math.round(ie.top+pe-ye.top);O.current.style.transform="translate(".concat(b,"px, ").concat(z,"px)"),w({childRect:q,popoverRect:(0,e.createRect)({left:b,top:z,width:Ae.width,height:Ae.height}),parentRect:ie,boundaryRect:ae,padding:m,align:E,transform:{top:pe,left:V},nudgedTop:0,nudgedLeft:0,boundaryInset:v,violations:e.EMPTY_RECT,hasViolations:!1});return}var j=le===l.length,me=j?l[0]:l[le],X=(0,e.getNewPopoverRect)({childRect:q,popoverRect:Ae,boundaryRect:ae,position:me,align:E,padding:m,reposition:S},v),Oe=X.rect,ke=X.boundaryViolation;if(ke&&S&&!j){_({positionIndex:le+1,childRect:q,popoverRect:Ae,parentRect:ie,boundaryRect:ae});return}var at=Oe.top,Ge=Oe.left,_e=Oe.width,Tt=Oe.height,_t=S&&!j,Et=(0,e.getNudgedPopoverRect)(Oe,ae,v),zt=Et.left,Te=Et.top,He=at,ee=Ge;_t&&(He=Te,ee=zt),He=Math.round(He-ye.top),ee=Math.round(ee-ye.left),O.current.style.transform="translate(".concat(ee,"px, ").concat(He,"px)");var Me={top:ae.top+v-He,left:ae.left+v-ee,right:ee+_e-ae.right+v,bottom:He+Tt-ae.bottom+v},ot={childRect:q,popoverRect:(0,e.createRect)({left:ee,top:He,width:_e,height:Tt}),parentRect:ie,boundaryRect:ae,position:me,align:E,padding:m,nudgedTop:Te-at,nudgedLeft:zt-Ge,boundaryInset:v,violations:{top:Me.top<=0?0:Me.top,left:Me.left<=0?0:Me.left,right:Me.right<=0?0:Me.right,bottom:Me.bottom<=0?0:Me.bottom},hasViolations:Me.top>0||Me.left>0||Me.right>0||Me.bottom>0};if(f){w(ot);var Wr=typeof f=="function"?f(ot):f,jt=Wr.top,Ze=Wr.left;O.current.style.transform="translate(".concat(Math.round(ee+(Ze??0)),"px, ").concat(Math.round(He+(jt??0)),"px)"),ot.nudgedLeft+=Ze??0,ot.nudgedTop+=jt??0,ot.transform={top:jt,left:Ze}}w(ot)}},[d,u,I,O,A,o,f,p,l,E,m,S,v,w]);return{positionPopover:_,popoverRef:O,scoutRef:I}};return gs.usePopover=i,gs}var Rs={},Pc;function xA(){if(Pc)return Rs;Pc=1,Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.useMemoizedArray=void 0;var s=an(),e=function(t){var r=(0,s.useRef)(t),n=(0,s.useMemo)(function(){if(r.current===t)return r.current;if(r.current.length!==t.length)return r.current=t,t;for(var i=0;i<t.length;i+=1)if(t[i]!==r.current[i])return r.current=t,t;return r.current},[t]);return n};return Rs.useMemoizedArray=e,Rs}var ys={},Dc;function _A(){if(Dc)return ys;Dc=1,Object.defineProperty(ys,"__esModule",{value:!0}),ys.useHandlePrevValues=void 0;var s=an(),e=function(t){var r=(0,s.useRef)(t.positions),n=(0,s.useRef)(t.reposition),i=(0,s.useRef)(t.transformMode),a=(0,s.useRef)(t.transform),o=(0,s.useRef)(t.boundaryElement),u=(0,s.useRef)(t.boundaryInset),l=(0,s.useCallback)(function(){r.current=t.positions,n.current=t.reposition,i.current=t.transformMode,a.current=t.transform,o.current=t.boundaryElement,u.current=t.boundaryInset},[t.boundaryElement,t.boundaryInset,t.positions,t.reposition,t.transform,t.transformMode]);return{prev:{positions:r.current,reposition:n.current,transformMode:i.current,transform:a.current,boundaryElement:o.current,boundaryInset:u.current},updatePrevValues:l}};return ys.useHandlePrevValues=e,ys}var mn={},Vc;function vp(){if(Vc)return mn;Vc=1;var s=mn&&mn.__assign||function(){return s=Object.assign||function(r){for(var n,i=1,a=arguments.length;i<a;i++){n=arguments[i];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},s.apply(this,arguments)};Object.defineProperty(mn,"__esModule",{value:!0}),mn.useArrowContainer=void 0;var e=an(),t=function(r){var n=r.childRect,i=r.popoverRect,a=r.position,o=r.arrowSize,u=r.arrowColor,l=(0,e.useMemo)(function(){return{padding:o}},[o]),c=(0,e.useMemo)(function(){return s({position:"absolute"},function(){var d=o*2,f=n.top-i.top+n.height/2-d/2,p=n.left-i.left+n.width/2-d/2,E=o,m=i.width-o,S=i.height-o;switch(p=p<E?E:p,p=p+d>m?m-d:p,f=f<E?E:f,f=f+d>S?S-d:f,f=Number.isNaN(f)?0:f,p=Number.isNaN(p)?0:p,a){case"right":return{borderTop:"".concat(o,"px solid transparent"),borderBottom:"".concat(o,"px solid transparent"),borderRight:"".concat(o,"px solid ").concat(u),left:0,top:f};case"left":return{borderTop:"".concat(o,"px solid transparent"),borderBottom:"".concat(o,"px solid transparent"),borderLeft:"".concat(o,"px solid ").concat(u),right:0,top:f};case"bottom":return{borderLeft:"".concat(o,"px solid transparent"),borderRight:"".concat(o,"px solid transparent"),borderBottom:"".concat(o,"px solid ").concat(u),top:0,left:p};case"top":return{borderLeft:"".concat(o,"px solid transparent"),borderRight:"".concat(o,"px solid transparent"),borderTop:"".concat(o,"px solid ").concat(u),bottom:0,left:p};default:return{display:"hidden"}}}())},[u,o,n.height,n.left,n.top,n.width,i.height,i.left,i.top,i.width,a]);return{arrowContainerStyle:l,arrowStyle:c}};return mn.useArrowContainer=t,mn}var gn={},Bc;function LA(){if(Bc)return gn;Bc=1;var s=gn&&gn.__assign||function(){return s=Object.assign||function(i){for(var a,o=1,u=arguments.length;o<u;o++){a=arguments[o];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(i[l]=a[l])}return i},s.apply(this,arguments)};Object.defineProperty(gn,"__esModule",{value:!0}),gn.ArrowContainer=void 0;var e=Qc(),t=an(),r=vp(),n=function(i){var a=i.childRect,o=i.popoverRect,u=i.position,l=i.arrowColor,c=i.arrowSize,d=i.arrowClassName,f=i.arrowStyle,p=i.className,E=i.children,m=i.style,S=(0,r.useArrowContainer)({childRect:a,popoverRect:o,position:u,arrowColor:l,arrowSize:c}),v=S.arrowContainerStyle,A=S.arrowStyle,w=(0,t.useMemo)(function(){return s(s({},v),m)},[v,m]),I=(0,t.useMemo)(function(){return s(s({},A),f)},[A,f]);return(0,e.jsxs)("div",{className:p,style:w,children:[(0,e.jsx)("div",{style:I,className:d}),E]})};return gn.ArrowContainer=n,gn}var kc;function FA(){return kc||(kc=1,function(s){var e=fs&&fs.__assign||function(){return e=Object.assign||function(p){for(var E,m=1,S=arguments.length;m<S;m++){E=arguments[m];for(var v in E)Object.prototype.hasOwnProperty.call(E,v)&&(p[v]=E[v])}return p},e.apply(this,arguments)};Object.defineProperty(s,"__esModule",{value:!0}),s.Popover=s.usePopover=s.ArrowContainer=s.useArrowContainer=void 0;var t=Qc(),r=an(),n=MA(),i=Bu(),a=bA();Object.defineProperty(s,"usePopover",{enumerable:!0,get:function(){return a.usePopover}});var o=xA(),u=_A(),l=vp();Object.defineProperty(s,"useArrowContainer",{enumerable:!0,get:function(){return l.useArrowContainer}});var c=LA();Object.defineProperty(s,"ArrowContainer",{enumerable:!0,get:function(){return c.ArrowContainer}});var d=["top","left","right","bottom"],f=(0,r.forwardRef)(function(p,E){var m=p.isOpen,S=p.children,v=p.content,A=p.positions,w=A===void 0?d:A,I=p.align,O=I===void 0?"center":I,_=p.padding,x=_===void 0?0:_,L=p.reposition,G=L===void 0?!0:L,H=p.parentElement,P=H===void 0?window.document.body:H,le=p.boundaryElement,se=le===void 0?P:le,ie=p.containerClassName,ce=p.containerStyle,q=p.transform,fe=p.transformMode,ye=fe===void 0?"absolute":fe,Se=p.boundaryInset,Ae=Se===void 0?0:Se,Ue=p.onClickOutside,ae=p.clickOutsideCapture,Ne=ae===void 0?!1:ae,pe=(0,o.useMemoizedArray)(Array.isArray(w)?w:[w]),V=(0,u.useHandlePrevValues)({positions:pe,reposition:G,transformMode:ye,transform:q,boundaryElement:se,boundaryInset:Ae}),b=V.prev,z=V.updatePrevValues,j=(0,r.useRef)(),me=(0,r.useState)({align:O,nudgedLeft:0,nudgedTop:0,position:pe[0],padding:x,childRect:i.EMPTY_RECT,popoverRect:i.EMPTY_RECT,parentRect:i.EMPTY_RECT,boundaryRect:i.EMPTY_RECT,boundaryInset:Ae,violations:i.EMPTY_RECT,hasViolations:!1}),X=me[0],Oe=me[1],ke=(0,r.useCallback)(function(ee){return Oe(ee)},[]),at=(0,a.usePopover)({isOpen:m,childRef:j,containerClassName:ie,parentElement:P,boundaryElement:se,transform:q,transformMode:ye,positions:pe,align:O,padding:x,boundaryInset:Ae,reposition:G,onPositionPopover:ke}),Ge=at.positionPopover,_e=at.popoverRef,Tt=at.scoutRef;(0,r.useLayoutEffect)(function(){var ee=!0,Me=function(){var ot,Wr;if(m&&ee){var jt=(ot=j?.current)===null||ot===void 0?void 0:ot.getBoundingClientRect(),Ze=(Wr=_e?.current)===null||Wr===void 0?void 0:Wr.getBoundingClientRect();jt!=null&&Ze!=null&&(!(0,i.rectsAreEqual)(jt,X.childRect)||Ze.width!==X.popoverRect.width||Ze.height!==X.popoverRect.height||X.padding!==x||X.align!==O||pe!==b.positions||G!==b.reposition||ye!==b.transformMode||q!==b.transform||se!==b.boundaryElement||Ae!==b.boundaryInset)&&Ge(),z(),ee&&window.requestAnimationFrame(Me)}};return Me(),function(){ee=!1}},[O,se,Ae,m,x,_e,X.align,X.childRect,X.padding,X.popoverRect.height,X.popoverRect.width,Ge,pe,b.boundaryElement,b.boundaryInset,b.positions,b.reposition,b.transform,b.transformMode,G,q,ye,z]),(0,r.useEffect)(function(){var ee=_e.current;return Object.assign(ee.style,ce),function(){Object.keys(ce??{}).forEach(function(Me){return delete ee.style[Me]})}},[ce,m,_e]);var _t=(0,r.useCallback)(function(ee){var Me,ot;m&&!(!((Me=_e.current)===null||Me===void 0)&&Me.contains(ee.target))&&!(!((ot=j.current)===null||ot===void 0)&&ot.contains(ee.target))&&Ue?.(ee)},[m,Ue,_e]),Et=(0,r.useCallback)(function(){j.current&&m&&window.requestAnimationFrame(function(){return Ge()})},[Ge,m]);(0,r.useEffect)(function(){var ee=P.ownerDocument.body;return ee.addEventListener("click",_t,Ne),ee.addEventListener("contextmenu",_t,Ne),window.addEventListener("resize",Et),function(){ee.removeEventListener("click",_t,Ne),ee.removeEventListener("contextmenu",_t,Ne),window.removeEventListener("resize",Et)}},[Ne,_t,Et,P]);var zt=(0,r.useCallback)(function(ee){j.current=ee,E!=null&&(typeof E=="object"?E.current=ee:typeof E=="function"&&E(ee))},[E]),Te=function(){return(0,r.cloneElement)(S,{ref:zt})},He=function(){return m?(0,t.jsx)(n.PopoverPortal,{element:_e.current,scoutElement:Tt.current,container:P,children:typeof v=="function"?v(X):v}):null};return(0,t.jsxs)(t.Fragment,{children:[Te(),He()]})});s.Popover=(0,r.forwardRef)(function(p,E){return typeof window>"u"?p.children:(0,t.jsx)(f,e({},p,{ref:E}))})}(fs)),fs}var UA=FA();const Xt="작업메뉴",PA=({isOpen:s,onClose:e,children:t,id:r,block:n,onUpdateBlock:i,onStyleChange:a,onDelete:o,onDuplicate:u})=>{const[l,c]=C.useState(Xt);return N.jsx(UA.Popover,{isOpen:s,positions:["left","right","top","bottom"],padding:10,onClickOutside:e,containerClassName:"z-[9999]",content:({position:d,childRect:f,popoverRect:p})=>N.jsxs(Zn.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.1,ease:"easeOut"},style:{transformOrigin:"center center"},className:"relative flex flex-col space-y-2 w-44 bg-white dark:bg-zinc-900 border border-gray-200 dark:border-zinc-700 rounded-md shadow-lg p-2 pt-8",children:[N.jsx("div",{className:"absolute top-0 left-0 w-full px-2 pt-1 pb-1 text-center",children:N.jsx("div",{className:"bg-zinc-700 dark:bg-zinc-800 text-white text-xs rounded py-1 px-2 min-h-[22px] flex items-center justify-center",children:l})}),N.jsx("div",{className:"w-full",onMouseEnter:()=>c("블록 스타일 변경"),onMouseLeave:()=>c(Xt),children:N.jsxs("select",{value:n.style,onChange:E=>a(r,E.target.value),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded focus:ring-blue-500 focus:border-blue-500 block p-1 dark:bg-zinc-800 dark:border-zinc-600 dark:placeholder-zinc-400 dark:text-gray-200","aria-label":"Change block style",children:[N.jsx("option",{value:"p",children:"본문"}),N.jsx("option",{value:"h1",children:"H1"}),N.jsx("option",{value:"h2",children:"H2"}),N.jsx("option",{value:"todo",children:"할 일"}),N.jsx("option",{value:"quote",children:"인용"}),N.jsx("option",{value:"divider",children:"구분선"}),N.jsx("option",{value:"handsontable",children:"표(고급)"}),N.jsx("option",{value:"code",children:"코드"})]})}),["p","h1","h2","quote"].includes(n.style)&&N.jsxs("div",{className:"flex w-full border-t border-gray-200 dark:border-zinc-700 pt-2",children:[N.jsx("div",{className:"text-sm min-w-10 mr-2 text-gray-600 dark:text-gray-400",children:"정렬"}),N.jsxs("div",{className:"flex w-full items-center justify-center",children:[N.jsx("button",{onMouseEnter:()=>c("왼쪽 정렬"),onMouseLeave:()=>c(Xt),onClick:()=>i(r,{textAlign:"left"}),className:`p-1 rounded ${n.textAlign==="left"?"bg-gray-200 dark:bg-zinc-700":""} text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50`,"aria-label":"Align left",children:N.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[N.jsx("line",{x1:"21",y1:"10",x2:"3",y2:"10"}),N.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),N.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),N.jsx("line",{x1:"21",y1:"18",x2:"3",y2:"18"})]})}),N.jsx("button",{onMouseEnter:()=>c("가운데 정렬"),onMouseLeave:()=>c(Xt),onClick:()=>i(r,{textAlign:"center"}),className:`p-1 rounded ${n.textAlign==="center"?"bg-gray-200 dark:bg-zinc-700":""} text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50`,"aria-label":"Align center",children:N.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[N.jsx("line",{x1:"18",y1:"10",x2:"6",y2:"10"}),N.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),N.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),N.jsx("line",{x1:"18",y1:"18",x2:"6",y2:"18"})]})}),N.jsx("button",{onMouseEnter:()=>c("오른쪽 정렬"),onMouseLeave:()=>c(Xt),onClick:()=>i(r,{textAlign:"right"}),className:`p-1 rounded ${n.textAlign==="right"?"bg-gray-200 dark:bg-zinc-700":""} text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50`,"aria-label":"Align right",children:N.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[N.jsx("line",{x1:"21",y1:"10",x2:"7",y2:"10"}),N.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),N.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),N.jsx("line",{x1:"21",y1:"18",x2:"7",y2:"18"})]})})]})]}),N.jsx("div",{className:"flex items-center justify-center w-full",children:["p","h1","h2","todo","quote"].includes(n.style)&&N.jsxs("div",{className:"flex w-full border-t border-gray-200 dark:border-zinc-700 pt-2",children:[N.jsx("div",{className:"text-sm min-w-10 mr-2 text-gray-600 dark:text-gray-400",children:"색상"}),N.jsxs("div",{className:"flex w-full items-center justify-center",children:[N.jsxs("div",{className:"relative w-6 h-6",onMouseEnter:()=>c("배경색 변경"),onMouseLeave:()=>c(Xt),children:[N.jsx("input",{type:"color",value:n.backgroundColor||"#ffffff",onChange:E=>i(r,{backgroundColor:E.target.value}),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),N.jsx("div",{className:"w-full h-full rounded border border-gray-300 dark:border-zinc-600 pointer-events-none",style:{backgroundColor:n.backgroundColor||"transparent"}})]}),N.jsx("div",{onMouseEnter:()=>c("글자색 변경"),onMouseLeave:()=>c(Xt),children:N.jsx("input",{type:"color",value:n.textColor||"#000000",onChange:E=>i(r,{textColor:E.target.value}),className:"w-6 h-6 p-0.5 bg-transparent border-none rounded cursor-pointer"})}),N.jsx("button",{onMouseEnter:()=>c("색상 초기화"),onMouseLeave:()=>c(Xt),onClick:()=>i(r,{backgroundColor:null,textColor:null}),className:"p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50","aria-label":"Reset colors",children:N.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[N.jsx("path",{d:"M23 4v6h-6"}),N.jsx("path",{d:"M1 20v-6h6"}),N.jsx("path",{d:"M3.5 9a9 9 0 0 1 14.85-3.36L23 10V4"}),N.jsx("path",{d:"M20.5 15a9 9 0 0 1-14.85 3.36L1 14v6"})]})})]})]})}),["p","todo","quote"].includes(n.style)&&N.jsxs("div",{className:"flex w-full border-t border-gray-200 dark:border-zinc-700 pt-2",children:[N.jsx("div",{className:"text-sm min-w-15 mr-2 text-gray-600 dark:text-gray-400",children:"폰트크기"}),N.jsx("div",{onMouseEnter:()=>c("글자 크기 변경"),onMouseLeave:()=>c(Xt),className:"w-full",children:N.jsxs("select",{value:n.fontSize||"base",onChange:E=>i(r,{fontSize:E.target.value}),className:"bg-gray-50 w-full border border-gray-300 text-gray-900 text-xs rounded focus:ring-blue-500 focus:border-blue-500 block p-1 dark:bg-zinc-800 dark:border-zinc-600 dark:placeholder-zinc-400 dark:text-gray-200","aria-label":"Change font size",children:[N.jsx("option",{value:"sm",children:"작게"}),N.jsx("option",{value:"base",children:"보통"}),N.jsx("option",{value:"lg",children:"크게"})]})})]}),["p","h1","h2","todo","quote"].includes(n.style)&&N.jsx("div",{className:"w-full border-t border-gray-200 dark:border-zinc-700 pt-2",onMouseEnter:()=>c("글꼴 변경"),onMouseLeave:()=>c(Xt),children:N.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400",children:[N.jsx("p",{className:"text-sm mr-2",children:"글꼴"}),N.jsxs("select",{value:n.fontFamily||"sans",onChange:E=>i(r,{fontFamily:E.target.value}),className:"bg-gray-50 w-full border border-gray-300 text-gray-900 text-xs rounded focus:ring-blue-500 focus:border-blue-500 block p-1 dark:bg-zinc-800 dark:border-zinc-600 dark:placeholder-zinc-400 dark:text-gray-200","aria-label":"Change font family",children:[N.jsx("option",{value:"monospace",children:"모노스페이스"}),N.jsx("option",{value:"sans",children:"산세리프"}),N.jsx("option",{value:"serif",children:"세리프"}),N.jsx("option",{value:"noto",children:"나눔명조"})]})]})}),n.style==="code"&&N.jsx("div",{className:"w-full border-t border-gray-200 dark:border-zinc-700 pt-2",onMouseEnter:()=>c("언어 변경"),onMouseLeave:()=>c(Xt),children:N.jsx("select",{value:n.language||"javascript",onChange:E=>i(r,{language:E.target.value}),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded focus:ring-blue-500 focus:border-blue-500 block p-1 dark:bg-zinc-800 dark:border-zinc-600 dark:placeholder-zinc-400 dark:text-gray-200",children:["javascript","React","css","html","bash","json","python","java","csharp","sql","typescript"].map(E=>N.jsx("option",{value:E,children:E},E))})}),N.jsxs("div",{className:"flex w-full border-t border-gray-200 dark:border-zinc-700 pt-2",children:[N.jsx("div",{className:"text-sm min-w-15 mr-2 text-gray-600 dark:text-gray-400",children:"작업"}),N.jsx("button",{onMouseEnter:()=>c("블록 복제"),onMouseLeave:()=>c(Xt),onClick:()=>u(r),className:"p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700/50","aria-label":"Duplicate block",children:N.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[N.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),N.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),N.jsx("button",{onMouseEnter:()=>c("블록 삭제"),onMouseLeave:()=>c(),onClick:()=>o(r),className:"p-1 text-gray-500 dark:text-gray-400 hover:text-red-500 dark:hover:bg-red-500/20 rounded-md",children:N.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[N.jsx("polyline",{points:"3 6 5 6 21 6"}),N.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),N.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),N.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]}),children:t})},DA=()=>N.jsx("hr",{className:"border w-full border-gray-300 dark:border-gray-500 my-2 mr-4"}),ws=({type:s="p"})=>{const e="animate-pulse bg-gray-200 dark:bg-zinc-700 rounded-md";switch(s){case"h1":return N.jsx("div",{className:`${e} h-9 w-4/5 my-4`});case"h2":return N.jsx("div",{className:`${e} h-7 w-3/5 my-3`});case"code":return N.jsxs("div",{className:"w-full p-4 bg-gray-100 dark:bg-zinc-800 rounded-md animate-pulse",children:[N.jsx("div",{className:"h-4 bg-gray-300 dark:bg-zinc-700 rounded w-1/4 mb-4"}),N.jsxs("div",{className:"space-y-2",children:[N.jsx("div",{className:"h-3 bg-gray-300 dark:bg-zinc-700 rounded w-full"}),N.jsx("div",{className:"h-3 bg-gray-300 dark:bg-zinc-700 rounded w-5/6"}),N.jsx("div",{className:"h-3 bg-gray-300 dark:bg-zinc-700 rounded w-full"})]})]});case"image":return N.jsx("div",{className:`${e} h-48 w-full my-4`});case"table":return N.jsxs("div",{className:"w-full my-4 space-y-2 animate-pulse",children:[N.jsxs("div",{className:"flex space-x-2",children:[N.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"}),N.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"}),N.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"})]}),N.jsxs("div",{className:"flex space-x-2",children:[N.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"}),N.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"}),N.jsx("div",{className:"h-8 bg-gray-200 dark:bg-zinc-700 rounded w-full"})]})]});case"handsontable":return N.jsx("div",{className:`${e} h-40 w-full my-4`});case"youtube":return N.jsx("div",{className:`${e} h-48 w-full my-4`});case"p":default:return N.jsxs("div",{className:"space-y-2 animate-pulse",children:[N.jsx("div",{className:`${e} h-4 w-full`}),N.jsx("div",{className:`${e} h-4 w-5/6`})]})}},VA=({id:s,block:e,styleClasses:t,onUpdateBlock:r,readOnly:n=!1})=>{const[i,a]=C.useState(!1),[o,u]=C.useState(e.content),[l,c]=C.useState(e.text),d=C.useRef(null);C.useEffect(()=>{i&&d.current?.focus()},[i]);const f=()=>{n||a(!0)},p=()=>{a(!1),r(s,{content:o,text:l||o})};return i?N.jsx("div",{className:"p-2 bg-gray-100 dark:bg-zinc-700 rounded-md w-full",children:N.jsxs("div",{className:"flex flex-col space-y-2",children:[N.jsx("input",{ref:d,type:"text",value:o,onChange:E=>u(E.target.value),onBlur:p,placeholder:"Enter URL",className:"w-full p-1 bg-transparent border-b border-gray-400 focus:outline-none focus:border-blue-500"}),N.jsx("input",{type:"text",value:l,onChange:E=>c(E.target.value),onBlur:p,placeholder:"Enter link text (optional)",className:"w-full p-1 bg-transparent border-b border-gray-400 focus:outline-none focus:border-blue-500"})]})}):N.jsx("a",{href:e.content,target:"_blank",rel:"noopener noreferrer",className:`${t.link} w-full`,onDoubleClick:f,children:e.text||e.content})},Gc=({id:s,block:e,styleClasses:t,onUpdate:r,fontFamily:n,readOnly:i=!1})=>{const a=C.useRef(null),o=u=>{r&&r(s,u.currentTarget.innerHTML)};return N.jsx("div",{ref:a,contentEditable:!i,suppressContentEditableWarning:!0,onBlur:o,className:`${t[e.style]||t.p} w-full focus:outline-none ${i?"":"focus:ring-2 focus:ring-blue-500"} rounded-sm px-1 min-h-[1em]`,style:{fontFamily:n},dangerouslySetInnerHTML:{__html:e.content}})},BA=({id:s,block:e,styleClasses:t,onUpdate:r,onUpdateBlock:n})=>{const i=C.useRef(null),[a,o]=C.useState(!1),u=c=>{o(!1),r&&r(s,c.currentTarget.innerHTML)},l=()=>{n(s,{checked:!e.checked})};return N.jsxs("div",{className:t.todo,children:[N.jsx("input",{type:"checkbox",checked:e.checked||!1,onChange:l,className:"form-checkbox h-5 w-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),N.jsx("div",{ref:i,contentEditable:"true",suppressContentEditableWarning:!0,onFocus:()=>o(!0),onBlur:u,className:`w-full focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-sm px-1 min-h-[1em] ${e.checked?"line-through text-gray-400 dark:text-gray-500":""}`,dangerouslySetInnerHTML:{__html:e.content}})]})},kA=s=>{const{attributes:e,listeners:t,setNodeRef:r,transform:n,transition:i,isDragging:a,isOver:o,rect:u}=AA({id:s,transition:{duration:200,easing:"cubic-bezier(0.25, 1, 0.5, 1)"}}),l=n?`${rs.Transform.toString(n)} scale(1.02)`:null,c={transform:a?l:rs.Transform.toString(n),transition:a?"box-shadow 0.2s ease-in-out, opacity 0.2s ease-in-out":"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s ease-in-out",zIndex:a?10:"auto",opacity:a?.6:1,boxShadow:a?"0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23)":"none"};return{attributes:e,listeners:t,setNodeRef:r,style:c,isDragging:a,isOver:o,rect:u}},GA=({id:s,block:e,styleClasses:t,onUpdateBlock:r,isCodeEditing:n,setIsCodeEditing:i,readOnly:a=!1})=>{const o=u=>{i(!1),r(s,{content:u.target.value})};return N.jsx(N.Fragment,{children:n&&!a?N.jsx("textarea",{defaultValue:e.content,onBlur:o,autoFocus:!0,className:`${t.code} w-full min-h-[100px] focus:outline-none focus:ring-2 focus:ring-blue-500`}):N.jsx(Fg,{language:e.language||"javascript",postData:`${e.content}`})})},HA=["#FFADAD","#FFD6A5","#FDFFB6","#CAFFBF","#9BF6FF","#A0C4FF","#BDB2FF","#FFC6FF"],WA=["#000000","#D00000","#AE4600","#006400","#00529B","#0018A8","#5A00A8","#A800A8"],zA=({id:s,block:e,onUpdateBlock:t})=>{const r=C.useRef(null),n=C.useRef(null),i=c=>{t(s,{content:c})},a=async(c,d,f)=>{const p=r.current?.hotInstance;if(!p)return;const E=e.content.columns.map((m,S)=>({...m,width:p.getColWidth(S)}));t(s,{content:{...e.content,columns:E}})},o=(c,d,f,p)=>{n.current={row:c,col:d,row2:f,col2:p}},u=(c,d)=>{if(console.log("handleColorClick=",c,d),!r.current?.hotInstance||!n.current)return;const{row:p,col:E,row2:m,col2:S}=n.current,v=Math.min(p,m),A=Math.max(p,m),w=Math.min(E,S),I=Math.max(E,S),O=d==="bg"?"colorData":"colorTextData",_=e.content[O]?[...e.content[O]]:[];let x=!1;for(let L=v;L<=A;L++){_[L]||(_[L]=Array(e.content.columns.length).fill(""));for(let G=w;G<=I;G++)_[L][G]!==c&&(_[L][G]=c,x=!0)}for(let L=0;L<_.length;L++)_[L]===void 0&&(_[L]=Array(e.content.columns.length).fill(""));x&&t(s,{content:{...e.content,[O]:_}})},l=(c,d,f)=>{if(c.preventDefault(),!r.current?.hotInstance)return;const E=f==="bg"?"colorData":"colorTextData",m=e.content[E]?[...e.content[E]]:[];let S=!1;for(let v=0;v<m.length;v++)if(m[v])for(let A=0;A<m[v].length;A++)m[v][A]===d&&(m[v][A]=f==="bg"?"":void 0,S=!0);S&&t(s,{content:{...e.content,[E]:m}})};return N.jsxs(N.Fragment,{children:[N.jsx("div",{className:"absolute top-10 right-1 opacity-0 group-hover:opacity-100 transition-opacity z-180",children:N.jsxs("div",{className:"items-center bg-white/80 dark:bg-zinc-800/80 backdrop-blur-sm border border-gray-200 dark:border-zinc-700 rounded-lg shadow-lg p-1 space-x-2",children:[N.jsx("div",{children:N.jsx("div",{className:"flex space-x-1",children:HA.map(c=>N.jsx("button",{onClick:()=>u(c,"bg"),onContextMenu:d=>l(d,c,"bg"),className:"w-4 h-4 rounded-full border",style:{backgroundColor:c}},c))})}),N.jsx("div",{children:N.jsx("div",{className:"flex space-x-1",children:WA.map((c,d)=>N.jsx("button",{onClick:()=>u(c,"text"),onContextMenu:f=>l(f,c,"text"),className:"w-4 h-4 rounded-full border flex items-center justify-center text-white text-sm font-bold",style:{backgroundColor:c},children:d%2===0?"A":"a"},c))})})]})}),N.jsx(Zf,{hotRef:r,columns:e.content.columns,rowData:e.content.data,colorData:e.content.colorData,colorTextData:e.content.colorTextData,gridData:e.content,onGridDataChange:i,afterSelection:o,handleAfterColumnResize:a,isDraggable:!1,onColorClick:u,onColorRightClick:l})]})},jA=({id:s,block:e,onUpdateBlock:t})=>{const r=C.useRef(null),n=i=>{i.preventDefault(),i.stopPropagation();const a=i.clientX,o=r.current.offsetWidth,u=c=>{const d=o+(c.clientX-a);r.current&&(r.current.style.width=`${d}px`)},l=()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",l),t&&r.current&&t(s,{width:r.current.offsetWidth})};document.addEventListener("mousemove",u),document.addEventListener("mouseup",l)};return N.jsxs("div",{className:"relative",children:[N.jsx("img",{ref:r,src:e.content,alt:"Uploaded content",className:"h-auto rounded-md",style:{width:e.width?`${e.width}px`:"auto",maxWidth:"100%"}}),N.jsx("div",{onMouseDown:n,className:"absolute bottom-0 right-0 w-4 h-4 bg-blue-500 cursor-se-resize opacity-0 group-hover:opacity-100 transition-opacity"})]})},YA=({id:s,block:e,onUpdateBlock:t,onDelete:r})=>{const n=C.useRef(null),i=(f,p,E)=>{const m={...e.content};m.rows[p][E].text=f.currentTarget.innerHTML,t(s,{content:m})},a=()=>{const f={...e.content},p=f.rows[0]?.length||1;f.rows.push(Array(p).fill({text:""})),t(s,{content:f})},o=f=>{if(e.content.rows.length<=1)return;const p={...e.content};p.rows.splice(f,1),t(s,{content:p})},u=()=>{const f={...e.content};f.rows.forEach(p=>p.push({text:""})),t(s,{content:f})},l=f=>{if(e.content.rows[0]?.length<=1)return;const p={...e.content};p.rows.forEach(E=>E.splice(f,1)),t(s,{content:p})},c=f=>{f.preventDefault(),f.stopPropagation();const p=f.clientX,E=n.current;if(!E)return;const m=E.offsetWidth,S=A=>{const w=m+(A.clientX-p);E.style.width=`${w}px`},v=()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",v),t&&E&&t(s,{width:E.offsetWidth})};document.addEventListener("mousemove",S),document.addEventListener("mouseup",v)},d=(f,p)=>{f.preventDefault(),f.stopPropagation();const E=f.clientX,S=f.currentTarget.parentElement.offsetWidth,v=w=>{const I=S+(w.clientX-E);if(I>30){const O=n.current.querySelector("table");if(O){const _=O.querySelector("colgroup");_&&_.children[p]&&(_.children[p].style.width=`${I}px`)}}},A=w=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",A);const I=S+(w.clientX-E),O=[...e.content.colWidths||[]];O[p]=Math.max(I,30),t(s,{content:{...e.content,colWidths:O}})};document.addEventListener("mousemove",v),document.addEventListener("mouseup",A)};return N.jsxs("div",{className:"flex items-start group relative w-full",children:[N.jsxs("button",{onClick:a,className:"absolute -bottom-2.5 left-1/2 -translate-x-1/2 w-full h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[N.jsx("div",{className:"w-6 h-px bg-blue-500"}),N.jsx("div",{className:"absolute w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs",children:"＋"})]}),N.jsxs("div",{ref:n,className:"relative w-full",style:{width:e.width?`${e.width}px`:"100%"},children:[N.jsxs("button",{onClick:u,className:"absolute top-1/2 -right-2.5 -translate-y-1/2 h-full w-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[N.jsx("div",{className:"h-6 w-px bg-blue-500"}),N.jsx("div",{className:"absolute w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs",children:"＋"})]}),N.jsxs("table",{className:"w-full border-collapse border border-gray-300 dark:border-zinc-600 table-fixed",children:[N.jsx("colgroup",{children:e.content.rows[0]?.map((f,p)=>N.jsx("col",{style:{width:e.content.colWidths?.[p]?`${e.content.colWidths[p]}px`:"auto"}},p))}),N.jsx("thead",{children:N.jsx("tr",{children:e.content.rows[0]?.map((f,p)=>N.jsxs("th",{className:"relative border-none p-0 h-4 group/col",children:[N.jsx("button",{onClick:()=>l(p),className:"absolute -top-2.5 left-1/2 -translate-x-1/2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs opacity-0 group-hover/col:opacity-100 transition-opacity z-10",children:"－"}),N.jsx("div",{onMouseDown:E=>d(E,p),className:"absolute top-0 right-0 h-full w-1.5 cursor-col-resize opacity-0 group-hover/col:opacity-100",children:N.jsx("div",{className:"h-full w-px bg-blue-500"})})]},p))})}),N.jsx("tbody",{children:e.content.rows.map((f,p)=>N.jsxs("tr",{className:"relative group/row",children:[N.jsx("button",{onClick:()=>o(p),className:"absolute -left-2.5 top-1/2 -translate-y-1/2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs opacity-0 group-hover/row:opacity-100 transition-opacity z-10",children:"－"}),f.map((E,m)=>N.jsx("td",{contentEditable:!0,suppressContentEditableWarning:!0,onBlur:S=>i(S,p,m),className:"border border-gray-300 dark:border-zinc-600 p-2 focus:outline-blue-500 overflow-hidden whitespace-nowrap",dangerouslySetInnerHTML:{__html:E.text}},m))]},p))})]}),N.jsx("div",{onMouseDown:c,className:"absolute bottom-0 right-0 w-4 h-4 bg-blue-500 cursor-se-resize opacity-0 group-hover:opacity-100 transition-opacity"})]}),N.jsx("button",{onClick:()=>r(s),className:"p-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity absolute -top-2 -right-2 bg-white dark:bg-zinc-800 rounded-full","aria-label":"Delete block",children:N.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[N.jsx("path",{d:"M3 6h18"}),N.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),N.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})},$A=({block:s})=>N.jsx("div",{className:"w-full aspect-w-16 aspect-h-9",children:N.jsx("iframe",{src:`https://www.youtube.com/embed/${s.content}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"w-full h-full rounded-md"})}),XA=C.memo(({id:s,block:e,styleClasses:t,onUpdateBlock:r,onUpdate:n,onStyleChange:i,onDelete:a,onDuplicate:o,onInsertBlock:u,readOnly:l=!1})=>{const{attributes:c,listeners:d,setNodeRef:f,style:p,isDragging:E,isOver:m,rect:S}=kA(s),[v,A]=C.useState(!1),[w,I]=C.useState(!1),[O,_]=C.useState(!1),x=C.useRef(null),L={sm:"text-sm",base:"text-base",lg:"text-lg"},G=L[e.fontSize]||L.base,H={monospace:"monospace",sans:"font-sans",serif:"serif",noto:"Noto Serif Korean"},P=H[e.fontFamily]||H.sans,se={left:"text-left",center:"text-center",right:"text-right"}[e.textAlign]||"text-left",ie=(q,fe)=>{q.preventDefault(),q.stopPropagation();const ye=q.clientX,Se=x.current.offsetWidth,Ae=ae=>{let Ne;fe==="left"?Ne=Se-(ae.clientX-ye):Ne=Se+(ae.clientX-ye),x.current&&(x.current.style.width=`${Math.max(Ne,100)}px`)},Ue=()=>{document.removeEventListener("mousemove",Ae),document.removeEventListener("mouseup",Ue),r(s,{width:x.current.offsetWidth})};document.addEventListener("mousemove",Ae),document.addEventListener("mouseup",Ue)},ce=()=>{switch(e.style){case"handsontable":return N.jsx(zA,{id:s,block:e,onUpdateBlock:r,isCodeEditing:v,setIsCodeEditing:A,readOnly:l});case"divider":return N.jsx(DA,{});case"todo":return N.jsx(BA,{id:s,block:e,styleClasses:t,onUpdate:n,onUpdateBlock:r,fontFamily:P,readOnly:l});case"quote":return N.jsx(Gc,{id:s,block:e,styleClasses:t,onUpdate:n,fontFamily:P,readOnly:l});case"link":return N.jsx(VA,{id:s,block:e,styleClasses:t,onUpdateBlock:r,fontFamily:P,readOnly:l});case"code":return N.jsx(GA,{id:s,block:e,styleClasses:t,onUpdateBlock:r,isCodeEditing:v,setIsCodeEditing:A,readOnly:l});case"youtube":return N.jsx($A,{block:e});case"table":return N.jsx(YA,{id:s,block:e,onUpdateBlock:r,onDelete:a,readOnly:l});case"image":return N.jsx(jA,{id:s,block:e,onUpdateBlock:r,readOnly:l});default:return N.jsx(Gc,{id:s,block:e,styleClasses:t,onUpdate:n,fontFamily:P,readOnly:l})}};if(E){const q=fe=>{const ye="bg-gray-100 dark:bg-zinc-800 rounded-md border-2 border-dashed border-gray-300 dark:border-zinc-600";switch(fe){case"divider":return`${ye} h-2`;case"image":case"youtube":case"handsontable":return`${ye} h-24`;case"code":return`${ye} h-20`;default:return`${ye} h-10`}};return N.jsx("div",{ref:f,style:p,className:q(e.style)})}return N.jsxs("div",{ref:f,style:p,className:"group relative mx-auto",children:[m&&N.jsx("div",{className:"absolute top-0 left-0 right-0 h-full pointer-events-none",children:N.jsx("div",{className:"absolute -top-1 left-0 right-0 h-1 bg-blue-500 rounded-full",style:{opacity:m&&S.top>0?1:0,transition:"opacity 0.2s"}})}),!l&&N.jsx("button",{onClick:()=>u(s),className:"absolute -top-3 left-1/2 -translate-x-1/2 w-full h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10","aria-label":"블록 추가",children:N.jsx("div",{className:"w-full h-px bg-blue-500"})}),N.jsxs("div",{ref:x,className:"relative transition-shadow rounded-md",style:{width:e.width?`${e.width}px`:"100%"},children:[!l&&N.jsxs(N.Fragment,{children:[N.jsx("div",{onMouseDown:q=>ie(q,"left"),className:"absolute top-0 left-0 h-full w-2 cursor-ew-resize opacity-0 group-hover:opacity-100 z-20",children:N.jsx("div",{className:"h-full w-0.5 bg-blue-500/50"})}),N.jsx("div",{onMouseDown:q=>ie(q,"right"),className:"absolute top-0 right-0 h-full w-2 cursor-ew-resize opacity-0 group-hover:opacity-100 z-20",children:N.jsx("div",{className:"h-full w-0.5 bg-blue-500/50 ml-auto"})})]}),N.jsxs(Zn.div,{layout:!0,style:{backgroundColor:e.backgroundColor,color:e.textColor},className:`flex w-full rounded-md mx-4 ${G} ${se}
            ${!l&&!e.backgroundColor?"hover:bg-gray-200 group-hover:bg-gray-50 dark:group-hover:bg-zinc-800/50 dark:hover:bg-zinc-800/50":""}`,onDoubleClick:()=>{e.style==="code"&&!l&&A(!0)},children:[N.jsx(C.Suspense,{fallback:N.jsx(ws,{type:e.style}),children:ce()}),N.jsx(PA,{isOpen:w,onClose:()=>I(!1),id:s,block:e,onUpdateBlock:r,onStyleChange:i,onDelete:a,onDuplicate:o,children:N.jsx("div",{role:"button","aria-expanded":"false","aria-label":"드래그","aria-haspopup":"dialog",...c,...!O&&!v&&!l&&d,className:`relative z-30 flex flex-col items-center ${l?"":"cursor-grab"}`,onClick:()=>!l&&I(q=>!q),children:N.jsx("svg",{"aria-hidden":"true",role:"graphics-symbol",viewBox:"0 0 10 10",fill:"currentcolor",className:`dragHandle mt-1 ${l?"opacity-0":"opacity-0 group-hover:opacity-100"} transition-opacity`,style:{width:"14px",height:"14px",display:"block",flexShrink:0},children:N.jsx("path",{d:"M3,2 C2.44771525,2 2,1.55228475 2,1 C2,0.44771525 2.44771525,0 3,0 C3.55228475,0 4,0.44771525 4,1 C4,1.55228475 3.55228475,2 3,2 Z M3,6 C2.44771525,6 2,5.55228475 2,5 C2,4.44771525 2.44771525,4 3,4 C3.55228475,4 4,4.44771525 4,5 C4,5.55228475 3.55228475,6 3,6 Z M3,10 C2.44771525,10 2,9.55228475 2,9 C2,8.44771525 2.44771525,8 3,8 C3.55228475,8 4,8.44771525 4,9 C4,9.55228475 3.55228475,10 3,10 Z M7,2 C6.44771525,2 6,1.55228475 6,1 C6,0.44771525 6.44771525,0 7,0 C7.55228475,0 8,0.44771525 8,1 C8,1.55228475 7.55228475,2 7,2 Z M7,6 C6.44771525,6 6,5.55228475 6,5 C6,4.44771525 6.44771525,4 7,4 C7.55228475,4 8,4.44771525 8,5 C8,5.55228475 7.55228475,6 7,6 Z M7,10 C6.44771525,10 6,9.55228475 6,9 C6,8.44771525 6.44771525,8 7,8 C7.55228475,8 8,8.44771525 8,9 C8,9.55228475 7.55228475,10 7,10 Z"})})})})]})]})]})}),JA=({rootDb:s,memoId:e,readOnly:t=!1})=>{const{user:r}=Kc(),{t:n}=$o(),[i,a]=C.useState([]),[o,u]=C.useState(""),[l,c]=C.useState("p"),d=C.useRef(null),f=C.useRef(null),[p,E]=C.useState(!1),[m,S]=C.useState(""),[v,A]=C.useState(!1),[w,I]=C.useState(0),O=C.useRef(!0),[_,x]=C.useState(!0),L=s==="memo"?`${s}_txt/${r?.uid}/${e}/notion`:`${s}_txt/${e}/notion`;C.useEffect(()=>{r&&e&&(x(!0),Mg(L).then(V=>{V&&a(V),x(!1),O.current=!1}))},[r,e]),C.useEffect(()=>{!O.current&&r&&e&&Og(L,i)},[i,r,e]);const G=[{command:"p",label:"Paragraph"},{command:"h1",label:"Heading 1"},{command:"h2",label:"Heading 2"},{command:"todo",label:"To-do list"},{command:"quote",label:"Quote"},{command:"code",label:"Code Block"},{command:"link",label:"Link"},{command:"image",label:"Image"},{command:"divider",label:"Divider"},{command:"handsontable",label:"Handsontable"},{command:"table",label:"Table"},{command:"youtube",label:"YouTube Video"}],H=m?G.filter(V=>V.label.toLowerCase().includes(m.toLowerCase())):G,P=V=>{if(p){V.key==="ArrowDown"?(V.preventDefault(),I(b=>(b+1)%H.length)):V.key==="ArrowUp"?(V.preventDefault(),I(b=>(b-1+H.length)%H.length)):V.key==="Enter"?(V.preventDefault(),H[w]&&Ae(H[w].command)):V.key==="Escape"&&(V.preventDefault(),E(!1));return}if(V.key==="Enter"&&!V.shiftKey){V.preventDefault();const b=d.current?.innerHTML||"";if(b.trim()==="/"){d.current&&(d.current.innerHTML=""),E(!1);return}if(d.current?.textContent.trim()===""&&!b.includes("<img"))return;const z={id:Date.now(),content:o,style:l,...l==="todo"&&{checked:!1}};a([...i,z]),u(""),d.current&&(d.current.innerHTML="")}},le=V=>{const b=V.currentTarget.textContent;b.startsWith("/")?(E(!0),S(b.substring(1)),I(0)):E(!1),u(V.currentTarget.innerHTML)},se=(V,b)=>{a(z=>z.map(j=>j.id===V?{...j,content:b}:j))},ie=(V,b)=>{a(z=>z.map(j=>j.id===V?{...j,style:b}:j))},ce=(V,b)=>{a(z=>z.map(j=>j.id===V?{...j,...b}:j))},q=V=>{const b=i.find(z=>z.id===V);if(b&&b.style==="image"&&b.content)try{const z=Yu($u,b.content);bg(z).catch(j=>{console.error("Error deleting image from storage:",j)})}catch(z){console.error("Error creating storage reference from URL:",z)}a(z=>z.filter(j=>j.id!==V))},fe=V=>{a(b=>{const z=b.findIndex(Oe=>Oe.id===V);if(z===-1)return b;const me={...b[z],id:Date.now()},X=[...b];return X.splice(z+1,0,me),X})},ye=V=>{const{active:b,over:z}=V;console.log("active=",b),console.log("over=",z),b.id!==z.id&&a(j=>{const me=j.findIndex(Oe=>Oe.id===b.id),X=j.findIndex(Oe=>Oe.id===z.id);return Vu(j,me,X)})},Se=V=>{const b=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,z=V.match(b);return z&&z[2].length===11?z[2]:null},Ae=V=>{if(V==="image")f.current?.click();else if(V==="divider"){const b={id:Date.now(),style:"divider",content:""};a(z=>[...z,b])}else if(V==="handsontable")A(!0);else if(V==="code"){const b={id:Date.now(),style:"code",language:"javascript",content:""};a(z=>[...z,b])}else if(V==="table"){const b={id:Date.now(),style:"table",content:{rows:[[{text:""},{text:""}],[{text:""},{text:""}]]}};a(z=>[...z,b])}else if(V==="youtube"){const b=prompt("Enter YouTube URL:");if(b){const z=Se(b);if(z){const j={id:Date.now(),style:"youtube",content:z};a(me=>[...me,j])}else alert("Invalid YouTube URL")}}else if(V==="link"){const b=prompt("Enter URL:");if(b){const z=prompt("Enter link text (optional):",b),j={id:Date.now(),style:"link",content:b,text:z||b};a(me=>[...me,j])}}else c(V),d.current?.focus();d.current&&(d.current.innerHTML=""),u(""),E(!1),S("")},Ue=V=>{const b={id:Date.now(),style:"handsontable",content:{data:[Array(V.length).fill("")],columns:V,colHeaders:V.map(z=>z.title),rowHeaders:!0,height:"auto",licenseKey:"non-commercial-and-evaluation"}};a(z=>[...z,b]),A(!1)},ae=async V=>{const b=V.target.files[0];if(!b||!r||!e)return;const z=`memo_txt_images/${r.uid}/${e}/${Date.now()}_${b.name}`,j=Yu($u,z);try{const me=await xg(j,b),X=await _g(me.ref),Oe={id:Date.now(),content:X,style:"image"};a(ke=>[...ke,Oe])}catch(me){console.error("Image upload failed:",me)}},Ne=n("notion_input_placeholder","Type '/' for commands, or just start writing..."),pe={p:"text-base",h1:"text-3xl font-bold my-4",h2:"text-2xl font-bold my-3",code:"font-mono bg-gray-100 dark:bg-zinc-700 p-4 rounded-md text-sm",todo:"flex items-center gap-2 my-1",link:"text-blue-600 dark:text-blue-400 hover:underline",quote:"border-l-4 border-gray-300 dark:border-zinc-600 pl-4 italic text-gray-500 dark:text-gray-400 my-2",image:"my-4",divider:"my-4",handsontable:"my-4",youtube:"my-4",table:"my-4 w-full"};return N.jsxs("div",{className:`${Zt.card} mt-1 py-4 border-gray-200 dark:border-zinc-700`,children:[N.jsx(IA,{onDragEnd:ye,blocks:i,styleClasses:pe,onUpdateBlock:ce,onUpdate:se,onStyleChange:ie,onDelete:q,onDuplicate:fe,readOnly:t,children:_?N.jsxs("div",{className:"mb-4 space-y-4 p-2",children:[N.jsx(ws,{type:"h1"}),N.jsx(ws,{type:"p"}),N.jsx(ws,{type:"code"}),N.jsx(ws,{type:"image"})]}):N.jsx(EA,{items:i,strategy:mA,children:N.jsx("div",{className:"mb-4 space-y-2",children:i.map(V=>N.jsx(XA,{id:V.id,block:V,styleClasses:pe,onUpdateBlock:ce,onUpdate:se,onStyleChange:ie,onDelete:q,onDuplicate:fe,readOnly:t},V.id))})})}),N.jsxs("div",{className:"relative",children:[p&&N.jsx(Zn.div,{className:"absolute bottom-full mb-2 w-full sm:w-64 bg-white z-180 dark:bg-zinc-800 border border-gray-200 dark:border-zinc-700 rounded-lg shadow-xl",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.1},children:N.jsxs("div",{className:"p-2",children:[N.jsx("p",{className:"text-xs text-gray-500 px-2 pb-1 font-semibold",children:"BLOCKS"}),H.length>0?H.map((V,b)=>N.jsx("button",{onClick:()=>Ae(V.command),className:`w-full text-left px-2 py-1.5 rounded text-sm ${b===w?"bg-gray-100 dark:bg-zinc-700":""} hover:bg-gray-100 dark:hover:bg-zinc-700`,children:V.label},V.command)):N.jsx("p",{className:"px-2 py-1.5 text-sm text-gray-500",children:"No results"})]})}),!t&&N.jsxs(N.Fragment,{children:[N.jsx("input",{type:"file",ref:f,onChange:ae,accept:"image/*",className:"hidden"}),N.jsx("div",{ref:d,contentEditable:"true",onInput:le,onKeyDown:P,"data-placeholder":Ne,className:`notion-selectable w-full bg-transparent focus:outline-none text-gray-800 dark:text-gray-200 
						min-h-[2.5rem] p-2 border border-transparent focus:border-blue-500 rounded-md
						empty:before:content-[attr(data-placeholder)] empty:before:text-gray-400 empty:before:dark:text-gray-500 empty:before:cursor-text`})]})]}),N.jsx(wA,{isOpen:v,onClose:()=>A(!1),onCreate:Ue})]})};export{rs as C,IA as D,QA as M,JA as N,EA as S,yp as T,Vu as a,Np as b,Tp as c,Zf as d,ZA as h,AA as u};
