const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MemoMain-XhSy_cOV.js","assets/index-CjToi1pz.js","assets/index-C5H3ufRP.css","assets/TailButton-DHXfvsI1.js"])))=>i.map(i=>d[i]);
import{g as E,h as je,i as _e,p as Ae,v as qe,k as Ye,l as Ve,n as Ke,o as we,q as Ge,s as Ue,t as be,w as ke,r as f,x as Xe,y as O,M as Se,z as ie,D as Je,E as Qe,F as Ze,G as et,I as tt,j as i,B as $,J as nt,K as U,N as $e,O as Ie,P as st,Q as le,R as Te,U as ot,V as it,W as lt,a as J,b as Q,X as Me,T as at,Y as rt,Z as ct,_ as ut,A as L,L as H,c as Ee,$ as ne,d as Le,a0 as dt,a1 as ae,a2 as ft,C as Ce,H as mt,e as ht,S as gt,a3 as xt,a4 as De,f as pt,a5 as vt,a6 as yt,a7 as jt,a8 as wt,a9 as re,aa as ce,ab as bt,ac as kt,ad as X,ae as St,af as $t,ag as It,ah as Tt,ai as Mt,aj as Et,ak as q,m as Lt,al as Ct,am as Dt,an as Y,ao as Nt,ap as Bt,aq as Rt,ar as Ot}from"./index-CjToi1pz.js";import{T as Wt,C as Ht,E as Ft,a as Pt,t as V}from"./TreeView-CQJdXqMB.js";import{T as ue}from"./TailButton-DHXfvsI1.js";import{T as zt}from"./TailLayout-Cs70kh3O.js";import{F as _t}from"./Favorite-CvDVJsWR.js";function Ne(e,n){let s;const t=()=>{const{currentTime:o}=n,r=(o===null?0:o.value)/100;s!==r&&e(r),s=r};return E.update(t,!0),()=>je(t)}const K=new WeakMap;let T;function At(e,n){if(n){const{inlineSize:s,blockSize:t}=n[0];return{width:s,height:t}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function qt({target:e,contentRect:n,borderBoxSize:s}){var t;(t=K.get(e))===null||t===void 0||t.forEach(o=>{o({target:e,contentSize:n,get size(){return At(e,s)}})})}function Yt(e){e.forEach(qt)}function Vt(){typeof ResizeObserver>"u"||(T=new ResizeObserver(Yt))}function Kt(e,n){T||Vt();const s=_e(e);return s.forEach(t=>{let o=K.get(t);o||(o=new Set,K.set(t,o)),o.add(n),T?.observe(t)}),()=>{s.forEach(t=>{const o=K.get(t);o?.delete(n),o?.size||T?.unobserve(t)})}}const G=new Set;let W;function Gt(){W=()=>{const e={width:window.innerWidth,height:window.innerHeight},n={target:window,size:e,contentSize:e};G.forEach(s=>s(n))},window.addEventListener("resize",W)}function Ut(e){return G.add(e),W||Gt(),()=>{G.delete(e),!G.size&&W&&(W=void 0)}}function Xt(e,n){return typeof e=="function"?Ut(e):Kt(e,n)}const Jt=50,de=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Qt=()=>({time:0,x:de(),y:de()}),Zt={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function fe(e,n,s,t){const o=s[n],{length:l,position:r}=Zt[n],d=o.current,c=s.time;o.current=e[`scroll${r}`],o.scrollLength=e[`scroll${l}`]-e[`client${l}`],o.offset.length=0,o.offset[0]=0,o.offset[1]=o.scrollLength,o.progress=Ae(0,o.scrollLength,o.current);const a=t-c;o.velocity=a>Jt?0:qe(o.current-d,a)}function en(e,n,s){fe(e,"x",n,s),fe(e,"y",n,s),n.time=s}function tn(e,n){const s={x:0,y:0};let t=e;for(;t&&t!==n;)if(t instanceof HTMLElement)s.x+=t.offsetLeft,s.y+=t.offsetTop,t=t.offsetParent;else if(t.tagName==="svg"){const o=t.getBoundingClientRect();t=t.parentElement;const l=t.getBoundingClientRect();s.x+=o.left-l.left,s.y+=o.top-l.top}else if(t instanceof SVGGraphicsElement){const{x:o,y:l}=t.getBBox();s.x+=o,s.y+=l;let r=null,d=t.parentNode;for(;!r;)d.tagName==="svg"&&(r=d),d=t.parentNode;t=r}else break;return s}const te={start:0,center:.5,end:1};function me(e,n,s=0){let t=0;if(e in te&&(e=te[e]),typeof e=="string"){const o=parseFloat(e);e.endsWith("px")?t=o:e.endsWith("%")?e=o/100:e.endsWith("vw")?t=o/100*document.documentElement.clientWidth:e.endsWith("vh")?t=o/100*document.documentElement.clientHeight:e=o}return typeof e=="number"&&(t=n*e),s+t}const nn=[0,0];function sn(e,n,s,t){let o=Array.isArray(e)?e:nn,l=0,r=0;return typeof e=="number"?o=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?o=e.split(" "):o=[e,te[e]?e:"0"]),l=me(o[0],s,t),r=me(o[1],n),l-r}const on={All:[[0,0],[1,1]]},ln={x:0,y:0};function an(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function rn(e,n,s){const{offset:t=on.All}=s,{target:o=e,axis:l="y"}=s,r=l==="y"?"height":"width",d=o!==e?tn(o,e):ln,c=o===e?{width:e.scrollWidth,height:e.scrollHeight}:an(o),a={width:e.clientWidth,height:e.clientHeight};n[l].offset.length=0;let u=!n[l].interpolate;const m=t.length;for(let g=0;g<m;g++){const I=sn(t[g],a[r],c[r],d[l]);!u&&I!==n[l].interpolatorOffsets[g]&&(u=!0),n[l].offset[g]=I}u&&(n[l].interpolate=Ye(n[l].offset,Ve(t),{clamp:!1}),n[l].interpolatorOffsets=[...n[l].offset]),n[l].progress=Ke(0,1,n[l].interpolate(n[l].current))}function cn(e,n=e,s){if(s.x.targetOffset=0,s.y.targetOffset=0,n!==e){let t=n;for(;t&&t!==e;)s.x.targetOffset+=t.offsetLeft,s.y.targetOffset+=t.offsetTop,t=t.offsetParent}s.x.targetLength=n===e?n.scrollWidth:n.clientWidth,s.y.targetLength=n===e?n.scrollHeight:n.clientHeight,s.x.containerLength=e.clientWidth,s.y.containerLength=e.clientHeight}function un(e,n,s,t={}){return{measure:()=>cn(e,t.target,s),update:o=>{en(e,s,o),(t.offset||t.target)&&rn(e,s,t)},notify:()=>n(s)}}const B=new WeakMap,he=new WeakMap,Z=new WeakMap,ge=e=>e===document.documentElement?window:e;function se(e,{container:n=document.documentElement,...s}={}){let t=Z.get(n);t||(t=new Set,Z.set(n,t));const o=Qt(),l=un(n,e,o,s);if(t.add(l),!B.has(n)){const d=()=>{for(const g of t)g.measure()},c=()=>{for(const g of t)g.update(we.timestamp)},a=()=>{for(const g of t)g.notify()},u=()=>{E.read(d,!1,!0),E.read(c,!1,!0),E.update(a,!1,!0)};B.set(n,u);const m=ge(n);window.addEventListener("resize",u,{passive:!0}),n!==document.documentElement&&he.set(n,Xt(n,u)),m.addEventListener("scroll",u,{passive:!0})}const r=B.get(n);return E.read(r,!1,!0),()=>{var d;je(r);const c=Z.get(n);if(!c||(c.delete(l),c.size))return;const a=B.get(n);B.delete(n),a&&(ge(n).removeEventListener("scroll",a),(d=he.get(n))===null||d===void 0||d(),window.removeEventListener("resize",a))}}function dn({source:e,container:n,axis:s="y"}){e&&(n=e);const t={value:0},o=se(l=>{t.value=l[s].progress*100},{container:n,axis:s});return{currentTime:t,cancel:o}}const ee=new Map;function Be({source:e,container:n=document.documentElement,axis:s="y"}={}){e&&(n=e),ee.has(n)||ee.set(n,{});const t=ee.get(n);return t[s]||(t[s]=Ue()?new ScrollTimeline({source:n,axis:s}):dn({source:n,axis:s})),t[s]}function fn(e){return e.length===2}function Re(e){return e&&(e.target||e.offset)}function mn(e,n){return fn(e)||Re(n)?se(s=>{e(s[n.axis].progress,s)},n):Ne(e,Be(n))}function hn(e,n){if(e.flatten(),Re(n))return e.pause(),se(s=>{e.time=e.duration*s[n.axis].progress},n);{const s=Be(n);return e.attachTimeline?e.attachTimeline(s,t=>(t.pause(),Ne(o=>{t.time=t.duration*o},s))):Ge}}function gn(e,{axis:n="y",...s}={}){const t={axis:n,...s};return typeof e=="function"?mn(e,t):hn(e,t)}function xe(e,n){Xe(!!(!n||n.current))}const xn=()=>({scrollX:O(0),scrollY:O(0),scrollXProgress:O(0),scrollYProgress:O(0)});function Oe({container:e,target:n,layoutEffect:s=!0,...t}={}){const o=be(xn);return(s?ke:f.useEffect)(()=>(xe("target",n),xe("container",e),gn((r,{x:d,y:c})=>{o.scrollX.set(d.current),o.scrollXProgress.set(d.progress),o.scrollY.set(c.current),o.scrollYProgress.set(c.progress)},{...t,container:e?.current||void 0,target:n?.current||void 0})),[e,n,JSON.stringify(t.offset)]),o}function pn(e){const n=be(()=>O(e)),{isStatic:s}=f.useContext(Se);if(s){const[,t]=f.useState(e);f.useEffect(()=>n.on("change",t),[])}return n}function pe(e){return typeof e=="number"?e:parseFloat(e)}function We(e,n={}){const{isStatic:s}=f.useContext(Se),t=f.useRef(null),o=pn(ie(e)?pe(e.get()):e),l=f.useRef(o.get()),r=f.useRef(()=>{}),d=()=>{const a=t.current;a&&a.time===0&&a.sample(we.delta),c(),t.current=Je({keyframes:[o.get(),l.current],velocity:o.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...n,onUpdate:r.current})},c=()=>{t.current&&t.current.stop()};return f.useInsertionEffect(()=>o.attach((a,u)=>s?u(a):(l.current=a,r.current=u,E.update(d),o.get()),c),[JSON.stringify(n)]),ke(()=>{if(ie(e))return e.on("change",a=>o.set(pe(a)))},[o]),o}var R={},ve;function vn(){if(ve)return R;ve=1;var e=Qe();Object.defineProperty(R,"__esModule",{value:!0}),R.default=void 0;var n=e(Ze()),s=et();return R.default=(0,n.default)((0,s.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder"),R}var yn=vn();const jn=tt(yn),wn=nt(Pt)(({theme:e})=>({color:e.palette.text.secondary,[`& .${V.content}`]:{color:e.palette.text.secondary,borderTopRightRadius:e.spacing(2),borderBottomRightRadius:e.spacing(2),paddingRight:e.spacing(1),fontWeight:e.typography.fontWeightMedium,"&.MuiTreeItem-content":{paddingLeft:"3px",paddingRight:"3px"},".MuiTreeItem-label":{paddingLeft:"0px"},".MuiTreeItem-iconContainer":{marginRight:"0px"},"&.Mui-expanded":{fontWeight:e.typography.fontWeightRegular},"&:hover":{backgroundColor:e.palette.action.hover},"&.Mui-selected":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:"rgba(145, 85, 253, 0.16)",color:"var(--tree-view-color)"},[`& .${V.label}`]:{fontWeight:"inherit",color:"inherit"}},[`& .${V.group}`]:{marginLeft:0,[`& .${V.content}`]:{paddingLeft:e.spacing(1)}}})),bn=f.forwardRef(function(n,s){const{labelIcon:t,labelInfo:o,labelText:l,pl:r,...d}=n;return i.jsx(wn,{label:i.jsxs($,{sx:{display:"flex",alignItems:"center",p:.5,pr:2,pl:{pl:r}},children:[i.jsx($,{component:t,color:"inherit",sx:{mr:1,pl:{pl:r}}}),i.jsx(U,{sx:{fontWeight:"inherit",flexGrow:1},component:"div",children:l}),i.jsx(U,{variant:"caption",color:"inherit",children:o})]}),...d,ref:s})}),He=e=>{const{id:n,fullIndex:s,title:t,sub:o}=e.item;if(n===void 0)return console.log("SubTreeItem.item.undefined=",e.item),i.jsx(i.Fragment,{});const l=o&&Object.values(o).length>0?Object.values(o).length+"":"";return i.jsx(bn,{onClick:()=>e.onDetail(n,s),nodeId:n,labelText:t,labelInfo:l,pl:e.pl,children:o!=null?Object.values(o).sort((r,d)=>r.title>d.title?1:-1).map((r,d)=>i.jsx("div",{style:{paddingLeft:e.pl+5},children:i.jsx(He,{onDetail:e.onDetail,item:r,pl:e.pl+5})},d+"")):""})};function Fe(e){const[n,s]=f.useState([]),[t,o]=f.useState([]),l=(c,a)=>{e.onDetail(c,a)};f.useEffect(()=>{if(e.expandIndex!==void 0){let c=e.expandIndex.split("/");c=c.filter(a=>a!=="sub"),e.expandIndex.indexOf("undefined")<0&&(s(c),o(c[c.length-1]))}},[e.expandIndex]);const r=(c,a)=>{},d=(c,a)=>{s(a)};return i.jsx($,{sx:{minHeight:180,flexGrow:1,display:"flex",flexDirection:"column",height:e.maxHeight,overflow:"hidden",overflowY:"auto",width:"100%"},children:i.jsx(Wt,{"aria-label":"icon expansion",defaultCollapseIcon:i.jsx(Ft,{}),defaultExpandIcon:i.jsx(Ht,{}),expanded:n,onNodeSelect:r,selected:t,onNodeToggle:d,sx:{flexGrow:1,overflow:"hidden",overflowY:"auto"},children:e.data&&e.data.map((c,a)=>i.jsx(He,{onDetail:l,item:c,parentIndex:a+1,pl:5},a+1))})})}async function kn(e,n,s=""){if(n==null||n==="")return"";let t=s===""?`${e}/${n}`:`${e}_txt/${n}`;e==="home"&&(t="home_txt");const o=$e(Ie(Te,t)),l=await st(o);if(!l.exists())return console.log("getTreeData.null"),null;if(!l.exists())return console.log("getTreeData.exists"),null;const r=l.val(),d=[],c={};e==="home"&&(le.map(a=>{d.push({title:a.label,id:a.id,sub:[]})}),le.map(a=>{c[a.id]=[]}));for(const a in r){const u=r[a];u.up===void 0?(u.id=a,u.fullIndex=a):(u.id=u.up,u.fullIndex=u.up),e==="home"?u.gbn!==void 0&&c[u.gbn].push(u):s===""||s===void 0?(u.sub!==null&&(u.children=Pe(u,u.up)),d.push(u)):(u.id=a,(u.memo+"").toLowerCase().indexOf(s.toLowerCase())>-1&&d.push(u))}return e==="home"?Object.values(c).map((a,u)=>{a.sort((m,g)=>m.title>g.title?1:-1),d[u].sub=a}):d.sort((a,u)=>a.title>u.title?1:-1),d}function Pe(e,n){const s=[];if(e===void 0||e.sub===void 0)return s;for(let t in e.sub){let o=e.sub[t];o.id=t,o.key=t}return Object.values(e.sub).sort((t,o)=>o.title-t.title).map(t=>{t.id=t.key,t.fullIndex=n+"/sub/"+t.key,t.sub!==null&&(t.children=Pe(t,t.fullIndex)),s.push(t)}),s}const Sn=e=>{const[n,s]=f.useState([]),t=()=>{const o=$e(Ie(Te,`memo_txt/${e}`),it("bookmark"),ot("Y"));lt(o,l=>{if(!l.exists())return;const r=l.val(),d=[];for(let c in r){const a=r[c];a.key=c,d.push(a)}d.sort((c,a)=>c.title>a.title?1:-1),s(d)})};return f.useEffect(()=>{t()},[e]),n};function $n(e){const{user:n}=J(),s=Q(),t=Sn(n?.uid);return n===void 0?i.jsx(i.Fragment,{}):i.jsxs("div",{className:"tail-bookmark justify-items-center",sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"100%"},children:[i.jsx(Me,{}),i.jsx(at,{children:"BookMark"}),i.jsx("div",{className:`tail-bookmark 
        grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1 
        justify-items-center 
        w-full`,children:t&&t.map((o,l)=>i.jsx("div",{children:i.jsx(rt,{component:"button",variant:"body",onClick:()=>{e.onSelected(o.key),s(`/memo/${o.key}`)},children:i.jsx(U,{variant:"body1",children:o.title})})},l))})]})}const In=e=>{const n=f.useRef(null);function s(){e.onSearchDataBtn(n.current.value)}function t(){return e.onNewMemoBtn(),!1}function o(l){l.which===13&&s()}return i.jsxs(i.Fragment,{children:[i.jsx(ct,{id:"edSearch",type:"edSearch",name:"edSearch",inputRef:n,placeholder:"Enter Search...",fullWidth:!0,sx:{pt:0,pl:2,pr:2,pb:1},onKeyDownCapture:o}),i.jsxs("div",{className:"flex justify-center",children:[i.jsx(ue,{variant:"outlined",color:"success",className:"m-1 p-1",onClick:t,children:"새글"}),i.jsx(ue,{variant:"outlined",color:"brand",className:"m-1 p-1",onClick:s,children:"조회"})]})]})},Tn=({className:e="",children:n})=>i.jsx("h4",{className:`mb-2 text-lg font-semibold text-center text-gray-800 dark:text-white/90 
      ${e}}
      `,children:n}),Mn={position:"absolute",top:"50%",left:"50%",display:"flex",flexDirection:"column",alignItems:"center",transform:"translate(-50%, -50%)",width:250,maxHeight:"400px",bgcolor:"background.paper",border:"1px solid #000",boxShadow:24,boxSizing:"border-box",p:4},En=e=>i.jsxs($,{sx:{my:2,mt:3,display:"flex"},children:[i.jsx(L,{type:"submit",variant:"outlined",color:"success",onClick:e.onPost,children:"확인"}),i.jsx(L,{type:"button",variant:"outlined",onClick:e.onClose,children:"취소"})]}),Ln=e=>{const[n,s]=f.useState(e.open),[t,o]=f.useState(),l=()=>{s(!1),o(void 0),e.onClose()};f.useEffect(()=>{s(e.open)},[e.open]);const r=c=>{o(c)},d=()=>{if(t===void 0){alert("이동할 메모장을 선택해 주세요");return}e.onPost(t)};return i.jsx("div",{children:i.jsx(ut,{open:n,onClose:l,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:i.jsxs($,{sx:Mn,children:[i.jsx(U,{id:"modal-modal-title",variant:"h6",component:"h2",children:"이동할 메모장 선택"}),i.jsx(Me,{}),i.jsx($,{sx:{width:"100%",minHeight:110,maxHeight:200,flexGrow:1,minWidth:100,overflow:"hidden"},children:i.jsx(Fe,{data:e.data,onDetail:r,maxHeight:200})}),i.jsx(En,{onPost:d,onClose:l})]})})})},Cn=e=>i.jsxs($,{sx:{flexGrow:1,my:2,width:"100%",display:"grid",gridTemplateColumns:"64px 64px  64px  64px ",flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},children:[i.jsx(L,{type:"button",size:"small",variant:"outlined",color:"success",onClick:e.onEdit,children:"수정"}),i.jsx(L,{type:"button",size:"small",variant:"outlined",onClick:e.onNewMemo,children:"새글"}),e.rootDb==="memo"?i.jsx(L,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:e.onMove,children:"이동"}):"",i.jsx(L,{type:"button",size:"small",variant:"outlined",color:"error",onClick:e.onDelete,children:"삭제"})]}),Dn=e=>{const{rootDb:n,isLoading:s,memoDetailData:t,bookmark:o}=e;if(s)return i.jsx(H,{});const{scrollYProgress:l}=Oe(),r=We(l,{stiffness:100,damping:30,restDelta:.001}),[d,c]=f.useState(!1),a=Q(),u=f.useRef();u.current=e.searchWord;const{memoId:m}=Ee(),I=ne()?.state?.fullIndex,{user:j}=J(),k=()=>{const x=`/${n}/edit/${m}`;a(x,{state:{fullIndex:I}})},C=()=>{const x=`/${n}/insert/${m}`;a(x,{state:{fullIndex:I}})},p=async()=>{const x=n==="memo"?`${n}_txt/${j.uid}/${m}`:`${n}_txt/${m}`,v=n==="memo"?`${n}/${j.uid}`:n;if(await yt(x,v)===void 0){alert("삭제에 실패했습니다.[code:d02]");return}e.onTreeUpdate(),a(`/${n}`)},y=()=>{window.confirm(`하위 자료가 있는 경우 같이 삭제됩니다.
삭제하시겠습니까?`)&&p()},w=()=>{c(!0)},h=()=>{e.onBookmark()},b=async x=>{try{const v=n==="memo"?`${n}_txt/${j.uid}`:`${n}_txt`,M=n==="memo"?`memo/${j.uid}`:n,F=await vt(v,M,m,x);e.onTreeUpdate()}catch(v){console.log("catch",v)}finally{c(!1)}};return f.useEffect(()=>{if(t&&t.title!==void 0){const v=document.querySelector("title");v.innerHTML=`${Le.appTitle} :: ${t.title}`}function x(){t&&t.html!=="N"&&document.querySelectorAll("pre").forEach(v=>{v.innerHTML=pt(v.innerHTML)})}t&&t.memo!==null&&x()},[t]),m===""||j===void 0?i.jsx(i.Fragment,{}):i.jsxs(dt.Fragment,{children:[i.jsx(ae.div,{className:"progress-bar",style:{scaleX:r}}),i.jsxs("div",{className:`grid grid-cols-3 
				items-center w-full 
				dark:bg-stone-950 rounded-md shadow-sm 
				dark:shadow-stone-800 shadow-stone-900`,children:[i.jsx("div",{}),i.jsx("div",{className:"flex justify-center",children:t&&t.title}),i.jsxs("div",{className:"text-right justify-end mr-3.5",children:[i.jsx(ae.div,{whileHover:{scale:1.1},whileTap:{scale:.8},initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:.5,ease:[0,.71,.2,1.01],scale:{type:"spring",damping:2,stiffness:100,restDelta:.001}},children:i.jsx(ft,{"aria-label":"bookmark",onClick:h,children:o==="Y"?i.jsx(_t,{sx:{color:"red"}}):i.jsx(jn,{})})}),i.jsx("div",{className:"text-right mb-3 text-sm text-red-400",children:e.pathNm})]})]}),i.jsxs(Ce,{className:"container",sx:{p:0,width:"100%"},children:[i.jsx(Cn,{rootDb:n,onEdit:k,onNewMemo:C,onMove:w,onDelete:y,onBookmark:h,bookmark:o}),i.jsxs($,{sx:{my:2},children:[t&&t.html==="N"?i.jsx(mt,{postData:t&&t.memo}):t&&t.html!=="N"&&t.memo&&i.jsx(ht,{text:t.memo}),i.jsx(gt,{imageList:t&&t.image}),!t&&i.jsx($,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:i.jsx(xt,{sx:{mt:5}})})]}),i.jsx(Ln,{userId:j?.uid,open:d,data:e.data,onClose:()=>c(!1),onPost:b})]}),i.jsx(De,{})]})},ye=e=>{const{rootDb:n,isLoading:s,memoDetailData:t}=e;if(console.log("MemoDetailEdit.isLoading=",s),s)return i.jsx(H,{});const{scrollYProgress:o}=Oe();We(o,{stiffness:100,damping:30,restDelta:.001});const l=Q(),r=f.useRef(),d=f.useRef();d.current=e.searchWord;const{memoId:c}=Ee(),a=ne(),u=t?.fullIndex,{user:m}=J();r.current=a.pathname.split("/")[2]==="insert",console.log("MemoDetailEdit.newMode=",r.current);const{settings:g,saveSettings:I}=jt(),j=()=>{const p=`/${n}/${c==="insert"?"":c}`;l(p,{state:{fullIndex:u}})},k=async(p,y)=>{console.log("onNewSubmit.values",p),console.log("onNewSubmit.fullIndex",u);const w=n==="memo"?`${n}_txt/${m.uid}/`:`${n}_txt/`,h=n==="memo"?`${n}/${m.uid}/`:`${n}/`;console.log("onNewSubmit.txtLocate",w),console.log("onNewSubmit.locate",h);const b=await re(void 0,w,h,u,p);if(await ce(`${n}_txt`,n,b,y),b!==void 0){const x=`/${n}/${b}`;l(x,{state:{reflash:!0}})}},C=async(p,y,w)=>{const h=n==="memo"?`${n}_txt/${m.uid}`:`${n}_txt`,b=n==="memo"?`${n}/${m.uid}`:n,x=await bt(h,b,c,y);console.log("onPostSubmit.imageDelete",x),console.log("onPostSubmit.memoId",c),console.log("onPostSubmit.values",p);const v=await re(r.current?void 0:c,`${h}/`,`${b}/`,u,p);console.log("onPostSubmit.newKey=",v),console.log("onPostSubmit.files=",w);const M=await ce(`${h}/`,`${b}/`,c,w);if(console.log("onNewSubmit.imageResult",M),console.log("onPostSubmit.fullIndex",u),n==="memo"&&u===void 0){const D=await kt(m.uid,`${c}/fullIndex`);console.log("onPostSubmit.fullPath",D),D!==void 0&&X(`memo/${m.uid}/${D}/title`,p.edTitle)}r.current=!1;const F=`/${n}/${c}`;l(F,{state:{fullIndex:u,reflash:!0}})};return f.useEffect(()=>{if(t&&t.title!==void 0){const y=document.querySelector("title");y.innerHTML=`${Le.appTitle} :: ${t.title}`}function p(){document.querySelectorAll("pre").forEach((y,w)=>{})}t&&t.memo!==null&&p()},[t]),c===""||m===void 0?i.jsx(i.Fragment,{}):i.jsxs(i.Fragment,{children:[i.jsx(Ce,{className:"container",sx:{p:0,width:"100%"},children:r.current===!1&&t&&(t.title===void 0||t.title===""||t.title===null)?i.jsx(H,{}):i.jsx(wt,{newMode:r.current,onPostSubmit:C,onNewSubmit:k,onCancel:j,title:t?.title,gbn:t?.gbn,date:t?.date,htmlCheck:t?.html?t?.html:"Y",content:t?.memo,imageList:t?.image})}),i.jsx(De,{})]})},Nn=async(e,n,s)=>{let t=new Array;for(let o in s){const l=s[o];try{if(l.key=o,l.url===void 0){const r=await $t(It,`${n}/${o}.${l.ext}`),d=await Tt(r);l.url=d,X(`${e}/image/${o}/url`,d)}t.push(l)}catch(r){console.log("getImageList.catch",r)}}return t},Bn=async(e,n,s,t)=>{let o="",l="",r={};((a,u,m)=>{l=a==="memo"?`${a}/${u}/${m}`:`${a}/${m}`,o=a==="memo"?`${a}_txt/${u}/${m}`:`${a}_txt/${m}`})(e,n,s);async function c(){if(o===void 0)return"";if(r=await St(o),r===void 0)return console.log("No data available"),"";if(r?.fullIndex,r.image!==void 0){const a=await Nn(o,l,r.image);(r.imageOK===void 0||r.imageOK==="N")&&(a&&a.map(u=>{u.ext==="jpg"&&(r.memo=r.memo+`<img src='${u.url}'>`)}),console.log("fireMemoDetail.onNeedData.id=",o),X(`${o}/imageOK`,"Y"),X(`${o}/memo`,r.memo))}if(t!==void 0&&t!==""){const a=t,u=new RegExp(a,"gi"),m=r.memo.replace(u,`<span class='lightext'>${a}</span>`);r.memo=m}}return await c(),r},Rn=f.lazy(async()=>await Ot(()=>import("./MemoMain-XhSy_cOV.js"),__vite__mapDeps([0,1,2,3]))),zn=({rootDb:e})=>{const n=Q(),{user:s}=J(),t=f.useRef(),o=f.useRef(),[l,r]=f.useState(!1),[d,c]=f.useState(),[a,u]=f.useState(),[m,g]=f.useState(),[I,j]=f.useState(),k=f.useRef(!1),{isMoble:C,height:p}=Mt(),y=ne(),w=f.useRef(!1);w.current=y?.state?.reflash===!0;const h=Et({queryKey:["treeMemo",s?.uid,t.current],queryFn:()=>kn(e,s?.uid,t.current)});h.data!==void 0&&h.data!==""&&!k.current&&(k.current=!0);const b=()=>{m&&(m.bookmark=m.bookmark==="Y"?"N":"Y"),console.log("onBookmark.memoDetailData.bookmark="+m.bookmark),j(m.bookmark),Rt(s.uid,a,m.bookmark)};f.useEffect(()=>{s!==void 0&&s!=null&&h.refetch()},[s]),f.useEffect(()=>{console.log("useEffect.loadOK=",k.current)},[k.current]),f.useEffect(()=>{const S=async _=>{if(_!==""&&s){const N=await Bn(e,s?.uid,_,t.current);{const oe=ze(h.data,{id:"",nm:""},_),A=oe.id;o.current=oe.nm,N.fullIndex=A,A!==d&&(c(A),Bt(s.uid,_,A))}N.bookmark===void 0&&(N.bookmark="N"),j(N.bookmark),g(N),r(!1)}},P=y.pathname.split("/"),z=P.length>2?P[P.length-1]:"";S(z),u(z)},[y.pathname,s]),f.useEffect(()=>{s!==void 0&&s!=null&&h.refetch()},[w.current]);const x=S=>{k.current=!1,S!==void 0&&(t.current=S),h.refetch()},v=(S,P)=>{r(!0);const z=`/${e}/${S}`;n(z,{state:{fullIndex:d}})},M=()=>{if(s==null){alert("로그인 후 이용 가능합니다.");return}const S=`/${e}/insert/insert`;n(S)},F=S=>{},D=i.jsxs("div",{className:"",children:[i.jsx(Tn,{className:"mt-3 ",children:e==="memo"?"메모장":"홈페이지관리"}),i.jsxs("div",{className:"flex gap-7 justify-center",children:[i.jsx(q,{to:"/",children:"홈"}),e==="memo"?"":i.jsx(q,{to:"/memo",children:"메모"}),i.jsx(q,{to:"/todo",children:"TODO"}),i.jsx(q,{to:"/tail",children:"Sheet"})]}),i.jsx(In,{onNewMemoBtn:M,onSearchDataBtn:x}),i.jsx("div",{className:`grow-1 h-[${p-220}px]`,children:k.current&&h.isFetched?i.jsx(Fe,{expandIndex:d,data:h.data,onDetail:v,maxHeight:p-220-(C?56:0)}):i.jsx(H,{})})]});return s&&s.uid===Lt&&Ct,i.jsxs(zt,{sideType:"memo",title:e==="memo"?"메모장":"홈페이지관리",sideContents:D,children:[i.jsx(f.Suspense,{fallback:i.jsx(H,{}),children:i.jsxs(Dt,{children:[i.jsx(Y,{path:"/edit/:memoId",element:i.jsx(ye,{rootDb:e,isLoading:l,searchWord:t.current,memoDetailData:m})}),i.jsx(Y,{path:"/insert/:memoId",element:i.jsx(ye,{rootDb:e,isLoading:l,searchWord:t.current,memoDetailData:m})}),i.jsx(Y,{path:"/:memoId",element:i.jsx(Dn,{rootDb:e,isLoading:l,searchWord:t.current,memoDetailData:m,bookmark:I,onTreeUpdate:x,pathNm:o.current,onBookmark:b,data:h.data})}),i.jsx(Y,{path:"*",element:i.jsx(Rn,{searchWord:t.current,data:h.data,onNewMemoBtn:M,title:e==="memo"?"메모장 홈":"홈페이지관리 홈"})})]})}),e==="memo"?i.jsx($n,{onSelected:F}):"",i.jsx(Nt,{})]})},ze=(e,n,s)=>{let t={};if(e)for(let o=0;o<e.length;o++){const l=e[o];if(l.id===s)return t.id=n.id+l.id,t.nm=n.nm+l.title,console.log("getFullIndex.result1=",t),t;if(l.sub!==null&&l.sub!==void 0){if(t.id=n.id+l.id+"/sub/",t.nm=n.nm+l.title+" > ",t=ze(Object.values(l.sub),t,s),t.id&&t.id.endsWith(s))return console.log("getFullIndex.result2=",t),t;t={}}}return t};export{zn as M};
