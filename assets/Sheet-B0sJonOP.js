import{h as E,j as t,a4 as C,q as K,a2 as M,r as i,bj as me,bk as fe,bl as he,aP as ge,Q as xe,J as _,bm as pe,bn as ye,t as ve,S as be,bo as je,bp as we,A as O,E as V,bq as Ce,I as x,br as Ne,bs as ke,U as Ie,s as De,e as _e}from"./index-C4YqBfyH.js";import{A as N}from"./AniButton-D1VPJeHo.js";import"./Button-21xMxktQ.js";const Ee=({ui:y,onInsert:d,onDelete:h,onReload:v,onCsvSave:m})=>{const{t:a}=E();return y==="tailwind"?t.jsxs("div",{className:"my-2 flex justify-end items-center",children:[t.jsx(C,{size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:d,children:a("input")}),t.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"warning",className:"mr-2",onClick:h,children:a("delete")}),t.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"brand",className:"mr-2",onClick:v,children:a("reload")}),t.jsx(C,{type:"button",size:"sm",variant:"outlined",color:"brand",onClick:m,children:a("csv_save")})]}):t.jsxs("div",{className:"my-2 flex justify-end items-center gap-1",children:[t.jsx(N,{type:"button",size:"small",variant:"outlined",color:"warning",className:"mr-2",onClick:d,children:a("input")}),t.jsx(N,{type:"button",size:"small",variant:"outlined",color:"error",className:"mr-2",onClick:h,children:a("delete")}),t.jsx(N,{type:"button",size:"small",variant:"outlined",color:"success",className:"mr-2",onClick:v,children:a("reload")}),t.jsx(N,{type:"button",size:"small",variant:"outlined",color:"success",onClick:m,children:a("csv_save")})]})},p=[{title:"division",data:"dv",readOnly:!1,select:!0},{title:"title",type:"text",data:"title",select:!0},{title:"description1",type:"text",data:"t1",select:!0},{title:"description2",type:"text",data:"t2",select:!0},{title:"sort",type:"text",data:"sort",select:!1,hidden:!0},{title:"id",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}];Ie();const Re=({csvFileName:y="exported_sheet",baseUrl:d="sheet",selectDefault:h="1"})=>{const{user:v}=K(),m=v?.uid,{ui:a}=M(),{t:c}=E(),G=p.length-1,f=i.useRef(null),j=i.useRef(null),[R,J]=i.useState(),[Q,S]=i.useState(0),{height:F,width:z}=me(),P=i.useRef(!1),[U,Z]=fe(he),{theme:X,settings:Y,colWidths:ee,setColWidths:k}=M();ge.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd");const{register:te,reset:Se,control:$,setValue:T,getValues:I,formState:{errors:se}}=xe({mode:"submit "}),ne=X==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",re=async e=>{const s=`${d}/${m}/`;if(e.id===void 0||e.id===null||e.id===""){const n=Ne(ke(O(V),s)).key;e.id=n}return x(s+e.id+"/dv",e.dv),x(s+e.id+"/title",e.title),x(s+e.id+"/t1",e.t1),x(s+e.id+"/t2",e.t2),x(s+e.id+"/ing","1"),e},oe=async()=>{const e=`${d}/${m}/`,s=je(O(V,e),we("dv"));Ce(s,n=>{if(!n.exists())return;const o=n.val(),l=[];for(let u in o){const r=o[u];r.id=u,r.sort=`${r.dv}_${r.title}`,l.push(r)}l.sort((u,r)=>u.sort>r.sort?1:-1),J(l),S(l.length)})};i.useEffect(()=>{te("filterField1"),T("columns1",h)},[]),i.useEffect(()=>{m!==void 0&&oe()},[m]),i.useEffect(()=>{z<500&&P.current===!1&&(P.current=!0,k([100,100,100,100,100,100]))},[z]),i.useEffect(()=>{f.current.hotInstance.addHook("afterColumnResize",function(s,n){const o=ee;try{o[n]=s,k(o)}catch{k([130,300,100,100,100,100])}})},[f.current]);const le=async()=>{H()},ie=async()=>{f.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:y,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},W=[],B={indicators:!0},q=[],A=[];p.map((e,s)=>{e.select&&W.push({value:s,text:c(e.title),label:c(e.title)}),A.push({...e,title:c(e.title)}),e.hidden===!0&&q.push(s)}),B.columns=q;const H=()=>{try{const e=f.current?.hotInstance,s=e?.getPlugin("filters");if(s){const n=I("columns1");Z(I("filterField1")),p.forEach((u,r)=>{s?.removeConditions(r)}),s?.addCondition(Number(n),"contains",[I("filterField1")]),s?.filter(),e?.render();const l=e.getData().length;S(l)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function ae(){f.current.hotInstance.alter("insert_row_above",0,1)}const ce=async(e,s)=>{if(e===null)return;const n=f.current?.hotInstance,o=n?.getPlugin("filters");if(o==null)return;const l=n.getData(),u={};e.forEach(async(g,D)=>{u[g[0]]=g[0]});const r=[];Object.keys(u).map(g=>{const D=u[g],w={};p.forEach(async(b,de)=>{w[b.data]=l[D][de]}),r.push(w)}),r.forEach(async(g,D)=>{const w=await re(g);R.map(b=>{(b.id===void 0||b.id===null)&&(b.id=w?.id)})}),n.render()},ue=async()=>{const e=f.current.hotInstance;if(e&&j.current!==null){if(e?.getPlugin("filters")){const o=e.getData()[j.current][G],l=c("delete_confirm_message");window.confirm(l)&&x(`${d}/${m}/${o}`,null)}e.alter("remove_row",j.current,1)}},L=e=>{const s=e.target.value;T(e.target.name,s)};return v===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:t.jsx(_,{children:c("login_required")})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[t.jsx(pe,{id:"columns1",name:"columns1",placeholder:c("search_column"),control:$,className:"dark:bg-dark-900",defaultValue:h||"1",options:W,error:!!se.columns1,onChange:L}),t.jsx(ye,{name:"filterField1",control:$,label:c("search"),placeholder:c("search_placeholder"),variant:"filled",margin:"none",onKeyUp:H,onChange:L,value:U})]}),t.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-end",children:[t.jsx(_,{className:"align-middle pt-2 md:pt-0 text-right md:text-left",children:c("count")+" : "+ve(Q)}),t.jsx(Ee,{ui:a,onInsert:ae,onDelete:ue,onReload:le,onCsvSave:ie})]}),t.jsx("div",{className:"w-full",style:{maxHeight:`${F} - 210`,overflow:"auto"},children:t.jsx(be,{className:"no-scrollbar no-scrollbar-x no-scrollbar-y",ref:f,data:R,themeName:ne,rowHeaders:!0,colHeaders:p.map(e=>c(e.title)),autoWrapRow:!0,height:F-200,contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:ce,afterSelection:e=>{j.current=e},columns:A,cells:(e,s)=>p[s].readOnly===!0?{readOnly:!0}:{},colWidths:Y.colWidths,manualColumnResize:!0,filters:!0,hiddenColumns:B,licenseKey:"non-commercial-and-evaluation"})})]})};function $e(){const{user:y}=K(),{t:d}=E();return i.useEffect(()=>{De({title:"",description:""})},[]),y===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full w-full mt-50",children:t.jsx(_,{children:d("login_required")})}):t.jsx(i.Suspense,{fallback:t.jsx(_e,{}),children:t.jsx(Re,{})})}export{$e as default};
