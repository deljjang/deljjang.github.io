import{j as o,i as le,r as D,P as se,cO as re,aK as ae,q as ie,o as ce,n as a,t as i,am as de,O as g,Y as E,Z as K,A as ue}from"./index-C6qQzj93.js";import{I as N,T as W}from"./InputField-DoJYBue1.js";import{H as me,r as ge}from"./registry-C5Uu3gRY.js";import{D as fe}from"./datetime-BDx6lZXm.js";import{a as he}from"./index.esm-aVFiiBfF.js";import{D as xe}from"./date-picker-DsUz3t9h.js";import{S as ye}from"./Select-UmLzICbc.js";import{n as De}from"./handson-CS9Rir92.js";import{A as b}from"./AniButton-ChngYaBu.js";import"./Button-D6Ete9Yx.js";const ve=n=>o.jsxs(le,{sx:{flexGrow:1,my:2,display:"flex",justifyContent:"flex-end",whiteSpace:"nowrap",pt:"0px"},children:[o.jsx(b,{type:"button",size:"small",variant:"outlined",color:"warning",onClick:n.onInsert,children:"입력"}),o.jsx(b,{type:"button",size:"small",variant:"outlined",color:"error",onClick:n.onDelete,children:"삭제"}),o.jsx(b,{type:"button",size:"small",variant:"outlined",color:"success",onClick:n.onReload,children:"리로드"}),o.jsx(b,{type:"button",size:"small",variant:"outlined",onClick:n.onCsvSave,children:"csv저장"})]});ge();const Ce=n=>{const{userId:m,baseUrl:w}=n,h=D.useRef(null),v=D.useRef(null),[S,U]=D.useState(),[A,T]=D.useState(0),{height:F}=se(),P=fe.now().setZone("Asia/Seoul").toFormat("yyyy-MM-dd"),H={edTitle:"",edDate:P},{register:p,handleSubmit:M,trigger:O,reset:V,control:j,setValue:I,getValues:C,formState:{errors:x}}=he({mode:"submit ",defaultValues:H}),{theme:L}=re(),Y=L==="dark"?"ht-theme-main-dark-auto":"ht-theme-main",q=async e=>{console.log("onFunPost.data",e.id,e);const t=`${w}/${m}/`;if(e.id===void 0){const l=E(K(a(i),t)).key;console.log("onSubmit.newKey",l),e.id=l}return g(a(i,t+e.id+"/title"),e.title),g(a(i,t+e.id+"/date"),e.date),g(a(i,t+e.id+"/t1"),e.t1),g(a(i,t+e.id+"/t2"),e.t2),g(a(i,t+e.id+"/ing"),"1"),e},_=async()=>{const e=`${w}/${m}/`,t=ie(a(i,e),ce("title"));de(t,l=>{if(!l.exists())return;const c=l.val(),d=[];for(let r in c){const s=c[r];s.id=r,s.sort=`${s.ing}_${s.date}_${s.title}`,d.push(s)}const y=d.sort((r,s)=>r.sort>s.sort?1:-1).filter(r=>r.ing==="1"),u=d.sort((r,s)=>r.sort>s.sort?-1:1).filter(r=>r.ing==="2");U([...y,...u]),T(d.length)})};D.useEffect(()=>{p("edDate",{required:!0,minLength:10}),I("columns1",n.selectDefault)},[]),D.useEffect(()=>{m!==void 0&&_()},[m]);const G=async()=>{z()},Z=async()=>{h.current.hotInstance.getPlugin("exportFile").downloadFile("csv",{filename:n.csvFileName,mimeType:"text/csv",bom:!1,columnDelimiter:",",rowDelimiter:`\r
`})},R=[],k={indicators:!0},$=[];n.columns.map((e,t)=>{e.select&&R.push({value:t,text:e.title,label:e.title}),e.hidden===!0&&$.push(t)}),k.columns=$;const z=()=>{try{const e=h.current?.hotInstance,t=e?.getPlugin("filters");if(t){const l=C("columns1");console.log("onKeyUp.columns1=",l,"text=",C("filterField1")),n.columns.forEach((y,u)=>{t?.removeConditions(u)}),t?.addCondition(Number(l),"contains",[C("filterField1")]),t?.filter(),e?.render(),console.log("filtersPlugin=",t),console.log("hotRef=",h.current);const d=e.getData().length;T(d)}}catch(e){console.error("Error:",e),console.error("Error:",e.message)}};async function J(){console.log("onInputBtn.errors=",x),console.log("onInputBtn.edDate=",C("edDate")),console.log("onInputBtn.edTitle=",C("edTitle")),M(Q)()}function Q(e,t){console.log("onSubmit.data=",e),console.log("onSubmit.e=",t),console.log("onSubmit.errors=",x);const l=`${n.baseUrl}/${m}/`,c=E(K(a(i),l)).key;console.log("onSubmit.newKey",e.newKey),g(a(i,l+c+"/title"),e.edTitle),g(a(i,l+c+"/date"),e.edDate),g(a(i,l+c+"/ing"),"1"),V({edTitle:"",edDate:P})}const X=async(e,t)=>{if(console.log("afterChange.change=",e,", source=",t),console.log("afterChange.change.length=",e?.length),e!==null){const l=h.current?.hotInstance;if(l?.getPlugin("filters")){const d=l.getData(),y=[];e.forEach((u,r)=>{const s={};console.log("afterChange.index1=",r,", item1=",u[0]),n.columns.forEach((f,ne)=>{console.log("afterChange.filteredData=",d[u[0]],f),s[f.data]=d[u[0]][ne]}),console.log("afterChange.tmp=",s),y.push(s)}),console.log("afterChange.saveData=",y),y.forEach(async(u,r)=>{console.log("afterChange.item=",u);const s=await q(u);console.log("afterChange.result=",r,", result=",s),S.map(f=>{(f.id===void 0||f.id===null)&&(console.log("afterChange.rowData1=",f),f.id=s?.id,console.log("afterChange.rowData2=",f))})}),l.render()}}},ee=async()=>{const e=h.current.hotInstance;if(console.log("onDelete:",e),e&&v.current!==null){if(e?.getPlugin("filters")){const l=e.getData();console.log("onDelete.filteredData=",l[v.current]);const c=l[v.current][n.keyId];console.log("onDelete.deleteId=",c),window.confirm("삭제하시겠습니까?")&&g(a(i,`${n.baseUrl}/${m}/${c}`),null)}e.alter("remove_row",v.current,1)}},B=e=>{const t=e.target.value;console.log("onChange.target=",e.target.value),I(e.target.name,t)};function te(e,t){console.log("handleChangeDate.dates=",e,"currentDateString=",t),I("edDate",t),O("edDate")}const oe=x?.edTitle?o.jsx("div",{className:"sm:grid-cols-12 md:grid-cols-12 lg:grid-cols-12 xl:grid-cols-12",children:o.jsx("p",{className:"error",children:x.edTitle?.message})}):"";return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[o.jsx(ye,{id:"columns1",name:"columns1",placeholder:"조회 컬럼",mdSize:3,control:j,className:"dark:bg-dark-900",defaultValue:n.selectDefault?n.selectDefault:"1",options:R,error:!!x.columns1,onChange:B}),o.jsx(N,{...p("filterField1"),name:"filterField1",control:j,label:"조회",placeholder:"조회 입력",variant:"filled",margin:"none",size:"small",mdSize:9,fullWidth:!0,onKeyUp:z,onChange:B}),o.jsx(xe,{control:j,id:"edDate",name:"edDate",label:"등록일자",placeholder:"일자 입력",mdSize:3,...p("edDate"),onChange:te}),o.jsxs("div",{children:[o.jsx(W,{htmlFor:"edTitle",children:"등록제목"}),o.jsx(N,{...p("edTitle",{required:"해당 필드는 필수입니다.",minLength:{value:1,message:"1글자 이상 입력해주세요."}}),name:"edTitle",fullWidth:!0,label:"제목",placeholder:"제목 입력",variant:"filled",size:"small",style:{},error:!!x.edTitle})]})]}),oe,o.jsxs("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-2",children:[o.jsx(ae,{textAlign:"left",children:"건수 : "+De(A)}),o.jsx(ve,{onInsert:J,onDelete:ee,onReload:G,onCsvSave:Z})]}),o.jsx("div",{style:{maxHeight:`${F}- 200`,overflow:"auto"},children:o.jsx(me,{ref:h,data:S,themeName:Y,rowHeaders:!0,colHeaders:!0,autoWrapRow:!0,height:F-200,width:"auto",contextMenu:!0,observeChanges:!0,columnSorting:!0,afterChange:X,afterSelection:e=>{v.current=e},licenseKey:"non-commercial-and-evaluation",columns:n.columns,cells:(e,t)=>n.columns[t].readOnly===!0?{readOnly:!0}:{},colWidths:n.colWidths,manualColumnResize:!0,filters:!0,stretchH:"last",hiddenColumns:k})})]})},ke=()=>{const{user:n}=ue(),m=[{title:"일자",data:"date",type:"date",dateFormat:"YYYY-MM-DD",correctFormat:!0,readOnly:!1,select:!0},{title:"제목",type:"text",data:"title",select:!0},{title:"1",type:"text",data:"t1",select:!1},{title:"2",type:"text",data:"t2",select:!1},{title:"정렬",type:"text",data:"sort",select:!1,hidden:!0},{title:"진행중",type:"text",data:"ing",select:!1,hidden:!0},{title:"ID",type:"text",data:"id",readOnly:!0,select:!1,hidden:!0}],w=[130,500,100,100,100];return!n||n?.uid===void 0?o.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"50px",marginBottom:"100px"},children:o.jsx(W,{children:"로그인을 해야 이용 가능합니다."})}):o.jsx(Ce,{csvFileName:"exported_todo",baseUrl:"todo",columns:m,colWidths:w,selectDefault:"1",keyId:m.length-1,userId:n?.uid})};export{ke as default};
